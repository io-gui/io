{"version":3,"file":"IoGL.test.js","sourceRoot":"","sources":["../../src/elements/IoGL.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { IoGl, Node, ThemeSingleton, ReactiveProperty, Register } from 'io-core'\n\n@Register\nclass IoGlTest extends IoGl {\n  @ReactiveProperty({type: Array, init: [0, 0, 0, 0]})\n  declare color: [number, number, number, number]\n  static get Frag() {\n    return /* glsl */`\n      void main(void) {\n        gl_FragColor = uColor;\n      }\\n\\n`\n  }\n}\n\nconst element = new IoGlTest()\nelement.size = [0, 0]\nelement.pxRatio = 1\nelement.style.visibility = 'hidden'\nelement.style.position = 'fixed'\nelement.style.left = '0'\nelement.style.bottom = '0'\nelement.style.zIndex = '1000000'\ndocument.body.appendChild(element as HTMLElement)\n\nexport default class {\n  run() {\n    describe('IoGL', () => {\n      it('Should have core API functions defined', () => {\n        expect(element.initShader).to.be.a('function')\n        expect(element.onResized).to.be.a('function')\n        expect(element.themeMutated).to.be.a('function')\n        expect(element.setShaderProgram).to.be.a('function')\n        expect(element.updatePropertyUniform).to.be.a('function')\n        expect(element.updateThemeUniforms).to.be.a('function')\n        expect(element.setUniform).to.be.a('function')\n      })\n      it('Should initialize properties correctly', () => {\n        element.onResized()\n        expect(element.size).to.be.eql([0, 0])\n        expect(element.color).to.be.eql([0, 0, 0, 0])\n        expect(element.pxRatio).to.be.equal(window.devicePixelRatio)\n        expect(element.theme).to.be.equal(ThemeSingleton)\n\n        expect(element._reactiveProperties.get('size')).to.eql({\n          binding: undefined,\n          init: [0, 0],\n          reflect: false,\n          type: Array,\n          value: [0, 0],\n        })\n\n        expect(element._reactiveProperties.get('pxRatio')).to.eql({\n          binding: undefined,\n          init: undefined,\n          reflect: false,\n          type: Number,\n          value: window.devicePixelRatio,\n        })\n\n        expect(element._reactiveProperties.get('theme')).to.eql({\n          binding: undefined,\n          init: undefined,\n          reflect: false,\n          type: Node,\n          value: ThemeSingleton,\n        })\n      })\n      it('has <canvas> element', () => {\n        expect(element.children[0].localName).to.equal('canvas')\n      })\n      it('has correct size and pxRatio', () => {\n        element.style.border = 'none'\n        element.style.width = '32px'\n        element.style.height = '32px'\n        element.onResized()\n        expect(element.size[0]).to.equal(32)\n        expect(element.size[1]).to.equal(32)\n        expect(element.pxRatio).to.equal(window.devicePixelRatio)\n      })\n      it('has correct color', () => {\n        let color = element.ctx.getImageData(0, 0, 1, 1).data\n        expect(color).to.eql(new Uint8ClampedArray([0, 0, 0, 0]))\n        element.color = [1, 0.5, 0.25, 1]\n        element.onRender()\n        color = element.ctx.getImageData(0, 0, 1, 1).data\n        expect(color).to.eql(new Uint8ClampedArray([255, 128, 64, 255]))\n\n        element.color = [1, 0.25, 0.5, 0.5]\n        element.onRender()\n        color = (element as IoGl).ctx.getImageData(0, 0, 1, 1).data\n        expect(color).to.eql(new Uint8ClampedArray([128, 32, 64, 64]))\n      })\n    })\n  }\n}\n"]}