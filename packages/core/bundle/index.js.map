{"version":3,"file":"index.js","sources":["../src/core/Binding.ts","../src/core/ChangeQueue.ts","../src/core/EventDispatcher.ts","../src/core/NodeArray.ts","../src/core/ReactiveProperty.ts","../src/decorators/Property.ts","../src/decorators/Style.ts","../src/core/ProtoChain.ts","../src/core/Queue.ts","../src/vdom/VDOM.ts","../src/decorators/Register.ts","../src/core/Style.ts","../src/elements/IoElement.ts","../src/nodes/Node.ts","../src/nodes/Storage.ts","../src/nodes/Theme.ts","../src/elements/IoGL.glsl.ts","../src/elements/IoGL.ts","../src/elements/IoNative.ts","../src/elements/IoOverlay.ts","../src/utils/Focus.ts","../src/utils/Nudge.ts","../src/index.ts"],"sourcesContent":["import { ChangeEvent } from './ChangeQueue.js'\nimport { Node } from '../nodes/Node.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: Improve types!\n\ntype Properties = string[]\ntype TargetProperties = WeakMap<Node | IoElement, Properties>\n\n// This helper checks if both values are NaN because NaN === NaN is false.\nconst bothAreNaNs = function(value: any, oldValue: any) {\n  return typeof value === 'number' && isNaN(value) && typeof oldValue === 'number' && isNaN(oldValue)\n}\n\nconst isTypeCompatible = (type1: any, type2: any) => {\n  // Handle primitive types\n  if (type1 === type2) return true\n  // Handle class inheritance\n  if (typeof type1 === 'function' && typeof type2 === 'function') {\n    return type1 instanceof type2 || type2 instanceof type1\n  }\n  return false\n}\n/**\n * This class is used internally by the framework to enable two-way data synchronization between reactive properties.\n * It manages bindings between a source node's reactive property and one or more target nodes and reactive properties.\n * It uses hub-and-spoke pub/sub event system and maintains data consistency by automatically propagating changes to all bound nodes and properties.\n *\n * Key features:\n * - Listens for `[propName]-changed` events to detect changes\n * - Supports one-to-many property bindings\n * - Prevents circular update loops\n * - Automatically cleans up listeners when disposed\n *\n * @example\n * const binding = new Binding<number>(nodeA, 'value');\n * binding.addTarget(nodeB, 'value');\n */\nexport class Binding<T extends unknown> {\n  readonly node: Node | IoElement\n  readonly property: string\n  readonly targets: Array<Node | IoElement> = []\n  readonly targetProperties: TargetProperties = new WeakMap()\n  /**\n   * Creates a binding object for specified source `node` and `property`.\n   * It attaches a `[propName]-changed` listener to the source node.\n   * @param {Node | IoElement} node - Source node\n   * @param {string} property - Name of the sourceproperty\n   */\n  constructor(node: Node | IoElement, property: string) {\n    debug: {\n      if (!(node as Node)._isNode && !(node as IoElement)._isIoElement) console.warn('Source node is not a Node or IoElement instance!')\n      if (!node._reactiveProperties.has(property)) console.warn(`Source node does not have a reactive property \"${property}\"!`)\n    }\n    this.node = node\n    this.property = property\n    this.onSourceChanged = this.onSourceChanged.bind(this)\n    this.onTargetChanged = this.onTargetChanged.bind(this)\n    this.node.addEventListener(`${this.property}-changed`, this.onSourceChanged)\n  }\n  set value(value: T) {\n    (this.node as any)[this.property] = value\n  }\n  get value(): T {\n    return (this.node as any)[this.property]\n  }\n  /**\n   * Adds a target node and property.\n   * Sets itself as the binding reference on the target `ReactivePropertyInstance`.\n   * Adds a `[propName]-changed` listener to the target node.\n   * @param {Node | IoElement} target - Target node\n   * @param {string} property - Target property\n   */\n  addTarget(target: Node | IoElement, property: string) {\n    const targetProps = this.getTargetProperties(target)\n\n    debug: {\n      if (!(target as Node)._isNode && !(target as IoElement)._isIoElement) console.warn('Target node is not a Node or IoElement instance!')\n      if (!target._reactiveProperties.has(property)) console.warn(`Target node does not have a reactive property \"${property}\"!`)\n      if (targetProps.indexOf(property) !== -1) console.error(`Target property \"${property}\" already added!`)\n    }\n\n    if (this.targets.indexOf(target) === -1) this.targets.push(target)\n    if (targetProps.indexOf(property) === -1) {\n      targetProps.push(property)\n\n      const targetP = target._reactiveProperties.get(property)!\n      if (targetP.binding && targetP.binding !== this) {\n        debug: {\n          console.warn('Improper usage detected!')\n          console.info('Target property is already a target of another binding. Undinding previous binding!')\n        }\n        targetP.binding.removeTarget(target, property)\n      }\n      targetP.binding = this\n\n      debug: {\n        const srcP = this.node._reactiveProperties.get(this.property)!\n        const valueMismatch = srcP.value !== undefined && targetP.value !== undefined && typeof srcP.value !== typeof targetP.value\n        const typeMismatch = srcP.type !== undefined && targetP.type !== undefined && !isTypeCompatible(srcP.type, targetP.type)\n        if (valueMismatch || typeMismatch) {\n          console.warn(`Source property \"${this.property}\" does not match type of target property \"${property}\"!`)\n          console.info(`Source \"${this.property}\" value: ${srcP.value} type: ${srcP.type} typeof: ${typeof srcP.value}`)\n          console.info(`Target \"${property}\" value: ${targetP.value} type: ${targetP.type} typeof: ${typeof targetP.value}`)\n        }\n      }\n\n      target.addEventListener(`${property}-changed`, this.onTargetChanged)\n      target.setProperty(property, this.value, true)\n    }\n  }\n  /**\n   * Removes target node and property.\n   * If `property` is not specified, it removes all target properties.\n   * Removes binding reference from the target `ReactivePropertyInstance`.\n   * Removes `[propName]-changed` listener from the target node.\n   * @param {Node | IoElement} target - Target node\n   * @param {string} property - Target property\n   */\n  removeTarget(target: Node | IoElement, property?: string) {\n    const targetProperties = this.getTargetProperties(target)\n\n    if (property) {\n\n      const i = targetProperties.indexOf(property)\n      debug: if (i === -1) {\n        console.error('Target property not found!')\n      }\n      targetProperties.splice(i, 1)\n\n      const propertyInstance = target._reactiveProperties.get(property)!\n      debug: if (propertyInstance.binding !== this) {\n        console.error('Target property has a different binding!')\n      }\n      propertyInstance.binding = undefined\n      target.removeEventListener(`${property}-changed`, this.onTargetChanged)\n\n    } else {\n\n      for (let i = targetProperties.length; i--;) {\n        const prop = targetProperties[i]\n        const propertyInstance = target._reactiveProperties.get(prop)!\n        debug: if (propertyInstance.binding !== this) {\n          console.error('Target property has a different binding!')\n        }\n        propertyInstance.binding = undefined\n        target.removeEventListener(`${prop}-changed`, this.onTargetChanged)\n      }\n      targetProperties.length = 0\n\n    }\n\n    if (targetProperties.length === 0) this.targets.splice(this.targets.indexOf(target), 1)\n  }\n  /**\n   * Event handler that updates source property when one of the targets emits `[propName]-changed` event.\n   * @param {ChangeEvent} event - Property change event.\n   */\n  onTargetChanged(event: ChangeEvent){\n    debug: if (this.targets.indexOf(event.target) === -1) {\n      console.error('onTargetChanged() should never fire if target is not accounted for!')\n    }\n    const oldValue = this.value\n    const value = event.detail.value\n    if (oldValue !== value) {\n      if (bothAreNaNs(value, oldValue)) return;\n      (this.node as any)[this.property] = value\n    }\n  }\n  /**\n   * Event handler that updates bound properties on target nodes when source node emits `[propName]-changed` event.\n   * @param {ChangeEvent} event - Property change event.\n   */\n  onSourceChanged(event: ChangeEvent) {\n    debug: if (event.target !== this.node) {\n      console.error('onSourceChanged() should always originate form source node!')\n    }\n    const value = event.detail.value\n    for (let i = this.targets.length; i--;) {\n      const target = this.targets[i]\n      const targetProperties = this.getTargetProperties(target)\n      for (let j = targetProperties.length; j--;) {\n        const propName = targetProperties[j]\n        const oldValue = (target as any)[propName]\n        if (oldValue !== value) {\n          if (bothAreNaNs(value, oldValue)) continue;\n          (target as any)[propName] = value\n        }\n      }\n    }\n  }\n  /**\n   * Returns a list of target properties for specified target node.\n   * @param {Node | IoElement} target - Target node.\n   * @return {Properties} list of target property names.\n   */\n  getTargetProperties(target: Node | IoElement): Properties {\n    if (!this.targetProperties.has(target)) this.targetProperties.set(target, [])\n    return this.targetProperties.get(target)!\n  }\n  /**\n   * Returns a JSON representation of the binding.\n   * This is required for `JSON.stringify(protoProperties)` in `ProtoChain`.\n   * @return {string} JSON representation of the binding.\n   */\n  toJSON() {\n    const targetProperties: Properties[] = []\n    for (let i = 0; i < this.targets.length; i++) {\n      const target = this.targets[i]\n      const props = this.getTargetProperties(target)\n      targetProperties[i] = props\n    }\n    return {\n      node: this.node.constructor.name,\n      property: this.property,\n      targets: this.targets.map(t => t.constructor.name),\n      targetProperties: targetProperties,\n    }\n  }\n  /**\n   * Disposes the binding and removes all targets and listeners.\n   */\n  dispose() {\n    this.node.removeEventListener(`${this.property}-changed`, this.onSourceChanged)\n    for (let i = this.targets.length; i--;) {\n      this.removeTarget(this.targets[i])\n    }\n    this.targets.length = 0\n    delete (this as any).node\n    delete (this as any).property\n    delete (this as any).targets\n    delete (this as any).targetProperties\n  }\n}\n","import { Node } from '../nodes/Node.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: Improve types!\n\nexport interface Change {\n  property: string\n  value: any\n  oldValue: any\n}\n\nexport interface Changes {\n  [property: string]: Change\n}\n\nexport interface ChangeEvent extends Omit<CustomEvent<Change>, 'target'> {\n  readonly target: Node | IoElement\n  readonly detail: Change\n  readonly path: Node[]\n}\n\n/**\n * This class is used internally by the framework to manage property changes in `Node` and `IoElement` nodes.\n *\n * This class implements a First-In-First-Out (FIFO) queue that:\n * - Collects property changes and their associated values\n * - Coalesces multiple changes to the same property\n * - Dispatches change events (e.g., '[propName]-changed')\n * - Invokes corresponding change handlers (e.g., [propName]Changed())\n * - Triggers a final 'changed()' handler after processing all changes\n * - Triggers a final 'dispatchMutation()' handler after processing all changes\n *\n * The queue helps optimize performance by batching multiple property changes\n * and preventing redundant updates when the same property changes multiple\n * times within a single execution cycle.\n *\n * @example\n * const node = new Node();\n * const changeQueue = new ChangeQueue(node);\n * changeQueue.queue('prop1', 1, 0);\n * changeQueue.queue('prop1', 2, 1);\n * changeQueue.dispatch();\n */\nexport class ChangeQueue {\n  declare readonly node: Node | IoElement\n  declare readonly changes: Change[]\n  dispatchedChange = false\n  dispatching = false\n  /**\n   * Creates change queue for the specified owner instance of `Node`.\n   * @param {Node} node - Owner node.\n   */\n  constructor(node: Node | IoElement) {\n    this.changes = []\n    this.node = node\n    Object.defineProperty(this, 'dispatch', {\n      value: this.dispatch.bind(this),\n      enumerable: false,\n      writable: false,\n      configurable: false,\n    })\n  }\n  /**\n   * Adds property change payload to the queue by specifying property name, previous and the new value.\n   * If the change is already in the queue, the new value is updated in-queue.\n   * If the new value is the same as the original value, the change is removed from the queue.\n   * @param {string} property - Property name.\n   * @param {any} value Property value.\n   * @param {any} oldValue Old property value.\n   */\n  queue(property: string, value: any, oldValue: any) {\n    debug: if (value === oldValue) {\n      console.warn('ChangeQueue: queuing change with same value and oldValue!')\n    }\n    const i = this.changes.findIndex(change => change.property === property)\n    if (i === -1) {\n      this.changes.push({property, value, oldValue})\n    } else if (value === this.changes[i].oldValue) {\n      this.changes.splice(i, 1)\n    } else {\n      this.changes[i].value = value\n    }\n  }\n  /**\n   * Dispatches and clears the queue.\n   * For each property change in the queue:\n   *  - It executes node's `[propName]Changed(change)` change handler function if it is defined.\n   *  - It fires the `'[propName]-changed'` `ChangeEvent` from the owner node with `Change` data as `event.detail`.\n   * After all changes are dispatched it invokes `.changed()` function of the owner node instance and fires `'changed'` event.\n   */\n  dispatch() {\n    if (this.dispatching === true) {\n      debug: console.error('ChangeQueue: dispatching already in progress!')\n      return\n    }\n    this.dispatching = true\n    const properties = []\n    while (this.changes.length) {\n      const change = this.changes[0]\n      this.changes.splice(0, 1)\n      const property = change.property\n      if (change.value !== change.oldValue) {\n        this.dispatchedChange = true\n        if ((this.node as any)[property + 'Changed']) (this.node as any)[property + 'Changed'](change)\n        this.node.dispatch(property + '-changed' as any, change)\n        properties.push(property)\n      }\n    }\n    if (this.dispatchedChange) {\n      this.node.changed()\n      if ((this.node as Node)._isNode) {\n        (this.node as Node).dispatchMutation(this.node, properties)\n      }\n    }\n    this.dispatchedChange = false\n    this.dispatching = false\n  }\n  /**\n   * Clears the queue and removes the node reference for garbage collection.\n   * Use this when node queue is no longer needed.\n   */\n  dispose() {\n    this.changes.length = 0\n    delete (this as any).node\n    delete (this as any).changes\n  }\n}","import { ChangeEvent } from './ChangeQueue.js'\nimport { Node } from '../nodes/Node.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: Improve types!\n\n/**\n * Event listener types.\n */\nexport interface KeyboardEventListener { (event: KeyboardEvent): void }\nexport interface PointerEventListener { (event: PointerEvent): void }\nexport interface CustomEventListener { (event: CustomEvent): void }\nexport interface FocusEventListener { (event: FocusEvent): void }\nexport interface TouchEventListener { (event: TouchEvent): void }\nexport interface ChangeEventListener { (event: ChangeEvent): void }\nexport interface IoEventListener { (event: {detail: any; target: Node | IoElement | EventTarget; path: Array<Node | IoElement | EventTarget>}): void }\nexport type AnyEventListener = EventListener |\n                               KeyboardEventListener |\n                               PointerEventListener |\n                               CustomEventListener |\n                               FocusEventListener |\n                               TouchEventListener |\n                               ChangeEventListener |\n                               IoEventListener |\n                               EventListenerOrEventListenerObject\n/**\n * Listener definition type.\n * The first item is a string (function name) or an event listener function.\n * The second item is an optional object of event listener options.\n */\nexport type ListenerDefinition = [string | AnyEventListener, AddEventListenerOptions?]\n\n/**\n * Loose listener definition type.\n * It can be a string (function name), an event AnyEventListener function or a ListenerDefinition array.\n */\nexport type ListenerDefinitionLoose = string | AnyEventListener | ListenerDefinition\n\nexport type Listener = [AnyEventListener, AddEventListenerOptions?]\nexport type Listeners = Record<string, Listener[]>\n\n/**\n * Converts a loose listener definition into a strongly typed ListenerDefinition array format.\n * This ensures consistent handling of listeners regardless of how they were initially defined.\n *\n * @param {ListenerDefinitionLoose} listenerDefinition - Loosely typed listener definition\n * @return {ListenerDefinition} Normalized listener definition in [string | listener, options?] format\n */\nexport const hardenListenerDefinition = (listenerDefinition: ListenerDefinitionLoose): ListenerDefinition => {\n  return Array.isArray(listenerDefinition) ? listenerDefinition : [listenerDefinition]\n}\n\nconst LISTENER_OPTIONS = ['capture', 'passive']\n\n/**\n * Converts a listener definition into a normalized Listener tuple.\n * If the first item is a string, it looks up the method on the node.\n *\n * @param {Node | IoElement | EventTarget} node - The node instance containing potential method references\n * @param {ListenerDefinition} def - The listener definition to normalize\n * @return {Listener} Normalized [listener, options?] tuple\n */\nexport const listenerFromDefinition = (node: Node | IoElement | EventTarget, def: ListenerDefinition): Listener => {\n  const handlerDef = def[0]\n  const options = def[1]\n\n  debug: {\n    if (typeof handlerDef !== 'string' && typeof handlerDef !== 'function') {\n      console.error('listenerFromDefinition: Listener must be a function or method name')\n    }\n    if (options) {\n      if (typeof options !== 'object') {\n        console.error('listenerFromDefinition: Listener options must be an object')\n      } else {\n        const invalidOptions = Object.keys(options).filter(k => !LISTENER_OPTIONS.includes(k))\n        if (invalidOptions.length > 0) {\n          console.error(`listenerFromDefinition: Invalid listener options: ${invalidOptions.join(', ')}`)\n        }\n      }\n    }\n    if (typeof handlerDef === 'string' && !(handlerDef in node)) {\n      console.error(`listenerFromDefinition: Method \"${handlerDef}\" not found on node`)\n    }\n  }\n\n  const handler = typeof handlerDef === 'string' ? (node as unknown as Record<string, AnyEventListener>)[handlerDef] : handlerDef\n\n  return options ? [handler, options] : [handler]\n}\n\n/**\n * Internal utility class responsible for handling listeners and dispatching events.\n * It makes events of all `Node` class instances compatible with DOM events.\n * It maintains three independent lists of listeners:\n *  - `protoListeners` specified as `get Listeners()` return value of class.\n *  - `propListeners` specified as inline properties prefixed with \"@\".\n *  - `addedListeners` explicitly added/removed using `addEventListener()` and `removeEventListener()`.\n */\nexport class EventDispatcher {\n  readonly node: Node | IoElement | EventTarget\n  readonly nodeIsEventTarget: boolean\n  readonly protoListeners: Listeners = {}\n  readonly propListeners: Listeners = {}\n  readonly addedListeners: Listeners = {}\n  /**\n   * Creates an instance of `EventDispatcher` for specified `Node` instance.\n   * It initializes `protoListeners` from `ProtoChain`.\n   * @param {Node | IoElement | EventTarget} node owner Node\n   */\n  constructor(node: Node | IoElement | EventTarget) {\n    this.node = node\n    this.nodeIsEventTarget = node instanceof EventTarget\n    this.setProtoListeners(node as Node)\n  }\n\n  /**\n   * Sets `protoListeners` specified as `get Listeners()` class definitions.\n   * Definitions from subclass replace the ones from parent class.\n   * @param {Node | IoElement} node owner Node\n   */\n  setProtoListeners(node: Node | IoElement) {\n    for (const name in node._protochain?.listeners) {\n      for (let i = 0; i < node._protochain.listeners[name].length; i++) {\n        const listener = listenerFromDefinition(node, node._protochain.listeners[name][i])\n        this.protoListeners[name] = [listener]\n      }\n      if (this.nodeIsEventTarget && this.protoListeners[name]) {\n        const listener = this.protoListeners[name][0]\n        EventTarget.prototype.addEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n      }\n    }\n  }\n  /**\n   * Sets `propListeners` specified as inline properties prefixed with \"@\".\n   * It removes existing `propListeners` that are no longer specified and it replaces the ones that changed.\n   * @param {Record<string, any>} properties - Inline properties\n   */\n  applyPropListeners(properties: Record<string, any>) {\n    // Create and object with new listeners\n    const newPropListeners: Listeners = {}\n    for (const prop in properties) {\n      if (!prop.startsWith('@')) continue\n\n      const name = prop.slice(1)\n      const definition = hardenListenerDefinition(properties[prop])\n      const listener = listenerFromDefinition(this.node, definition)\n      newPropListeners[name] = [listener]\n    }\n\n    // Remove listeners that are no longer specified\n    const propListeners = this.propListeners\n    for (const name in propListeners) {\n      if (!newPropListeners[name]) {\n        if (this.nodeIsEventTarget) {\n          const listener = propListeners[name][0]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n        delete propListeners[name]\n      }\n    }\n\n    // Add new listeners and remove old ones if they are different\n    for (const name in newPropListeners) {\n      if (this.nodeIsEventTarget) {\n        const newListener = newPropListeners[name][0]\n        if (propListeners[name]) {\n          const oldListener = propListeners[name][0]\n          if ((oldListener !== newListener || newListener[1] && (JSON.stringify(oldListener[1]) !== JSON.stringify(newListener[1])))) {\n            EventTarget.prototype.removeEventListener.call(this.node, name, oldListener[0] as EventListener, oldListener[1])\n          }\n        }\n        EventTarget.prototype.addEventListener.call(this.node, name, newListener[0] as EventListener, newListener[1])\n      }\n      propListeners[name] = newPropListeners[name]\n    }\n  }\n  /**\n   * Proxy for `addEventListener` method.\n   * Adds an event listener to the node's `addedListeners` collection.\n   * If the node is an EventTarget, also registers the listener with the DOM.\n   * @param {string} name - Name of the event\n   * @param {AnyEventListener} listener - Event listener handler\n   * @param {AddEventListenerOptions} [options] - Event listener options\n   */\n  addEventListener(name: string, listener: AnyEventListener, options?: AddEventListenerOptions) {\n    debug: {\n      if (typeof listener !== 'function') {\n        console.error('EventDispatcher.addEventListener: Invalid listener type - must be a function')\n      }\n      if (options) {\n        if (typeof options !== 'object') {\n          console.error('EventDispatcher.addEventListener: Invalid listener options type - must be an object')\n        } else {\n          const invalidOptions = Object.keys(options).filter(k => !LISTENER_OPTIONS.includes(k))\n          if (invalidOptions.length > 0) {\n            console.warn(`EventDispatcher.addEventListener: Invalid listener options: ${invalidOptions.join(', ')}`)\n          }\n        }\n      }\n    }\n\n    // Initialize listener array if needed\n    if (!this.addedListeners[name]) {\n      this.addedListeners[name] = []\n    }\n\n    // Check for duplicate listener\n    const existingIndex = this.addedListeners[name].findIndex(l => l[0] === listener)\n    if (existingIndex !== -1) {\n      debug: console.warn(`EventDispatcher.addEventListener: Listener for '${name}' event already added`, this.node)\n      return\n    }\n\n    // Create and store listener tuple\n    const listenerTuple: Listener = options ? [listener, options] : [listener]\n    this.addedListeners[name].push(listenerTuple)\n\n    if (this.nodeIsEventTarget) {\n      EventTarget.prototype.addEventListener.call(this.node, name, listener as EventListener, options)\n    }\n  }\n\n  /**\n   * Proxy for `removeEventListener` method.\n   * Removes an event listener from the node's `addedListeners` collection.\n   * If `listener` is not specified it removes all listeners for specified `type`.\n   * @param {string} name - Name of the event\n   * @param {AnyEventListener} listener - Event listener handler\n   * @param {AddEventListenerOptions} [options] - Event listener options\n  */\n  removeEventListener(name: string, listener?: AnyEventListener, options?: AddEventListenerOptions) {\n    debug: {\n      if (listener && typeof listener !== 'function') {\n        console.error('EventDispatcher.removeEventListener: Invalid listener type!')\n      }\n      if (options) {\n        if (typeof options !== 'object') {\n          console.error('EventDispatcher.removeEventListener: Invalid listener options type - must be an object')\n        } else {\n          const invalidOptions = Object.keys(options).filter(k => !LISTENER_OPTIONS.includes(k))\n          if (invalidOptions.length > 0) {\n            console.warn(`EventDispatcher.removeEventListener: Invalid listener options: ${invalidOptions.join(', ')}`)\n          }\n        }\n\n      }\n      if (!this.addedListeners[name]) {\n        console.error(`EventDispatcher.removeEventListener: Listener ${name} not found!`)\n      }\n    }\n\n    if (!this.addedListeners[name]) return\n\n    if (!listener) {\n      for (let i = 0; i < this.addedListeners[name].length; i ++) {\n        if (this.nodeIsEventTarget) {\n          const listener = this.addedListeners[name][i]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n      }\n      this.addedListeners[name].length = 0\n    } else {\n      const index = this.addedListeners[name].findIndex(item => item[0] === listener)\n      debug: if (index === -1) {\n        console.error(`EventDispatcher.removeEventListener: Listener ${name} not found!`)\n      }\n      if (index !== -1) {\n        this.addedListeners[name].splice(index, 1)\n        if (this.nodeIsEventTarget) {\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener as EventListener, options)\n        }\n      }\n    }\n\n    if (this.addedListeners[name].length === 0) {\n      delete this.addedListeners[name]\n    }\n  }\n  /**\n   * Shorthand for custom event dispatch.\n   * @param {string} name - Name of the event\n   * @param {any} detail - Event detail data\n   * @param {boolean} [bubbles] - Makes event bubble\n   * @param {Node | IoElement | EventTarget} [node] - Event target override to dispatch the event from\n   */\n  dispatchEvent(name: string, detail?: any, bubbles = true, node: Node | IoElement | EventTarget = this.node, path: Array<Node | IoElement | EventTarget> = []) {\n    path = [...path, node]\n\n    if ((node instanceof EventTarget)) {\n      EventTarget.prototype.dispatchEvent.call(node, new CustomEvent(name, {detail: detail, bubbles: bubbles, composed: true, cancelable: true}))\n    } else {\n      const payload = {detail: detail, target: node, path: path}\n      if (this.protoListeners[name]) {\n        for (let i = 0; i < this.protoListeners[name].length; i ++) {\n          const handler = this.protoListeners[name][i][0] as IoEventListener\n          handler.call(node, payload)\n        }\n      }\n      if (this.propListeners[name]) {\n        debug: if (this.propListeners[name].length > 1) {\n          console.error(`EventDispatcher.dispathEvent: PropListeners[${name}] array too long!`)\n        }\n        const handler = this.propListeners[name][0][0] as IoEventListener\n        handler.call(node, payload)\n      }\n      if (this.addedListeners[name]) {\n        for (let i = 0; i < this.addedListeners[name].length; i ++) {\n          const handler = this.addedListeners[name][i][0] as IoEventListener\n          handler.call(node, payload)\n        }\n      }\n      if (bubbles) {\n        for (const parent of node._parents) {\n          if (parent._isNode) {\n            // TODO: prevent event multiplication when children contain multiple instances of the same node.\n            // TODO: enable propagation across Node / IoElement boundaries?\n            // TODO: implement stopPropagation() and stopImmediatePropagation()\n            parent._eventDispatcher.dispatchEvent(name, detail, bubbles, parent, path)\n          }\n        }\n      }\n    }\n  }\n  /**\n   * Disconnects all event listeners and removes all references for garbage collection.\n   * Use this when node is discarded.\n   */\n  dispose() {\n    for (const name in this.protoListeners) {\n      if (this.nodeIsEventTarget) {\n        for (let i = 0; i < this.protoListeners[name].length; i++) {\n          const listener = this.protoListeners[name][i]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n      }\n      this.protoListeners[name].length = 0\n      delete this.protoListeners[name]\n    }\n    for (const name in this.propListeners) {\n      if (this.nodeIsEventTarget) {\n        const listener = this.propListeners[name][0]\n        EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n      }\n      this.propListeners[name].length = 0\n      delete this.propListeners[name]\n    }\n    for (const name in this.addedListeners) {\n      if (this.nodeIsEventTarget) {\n        for (let i = this.addedListeners[name].length; i--;) {\n          const listener = this.addedListeners[name][i]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n      }\n      this.addedListeners[name].length = 0\n      delete this.addedListeners[name]\n    }\n    delete (this as any).node\n    delete (this as any).protoListeners\n    delete (this as any).propListeners\n    delete (this as any).addedListeners\n  }\n}","import { Node } from '../nodes/Node.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: test!!!\nexport class NodeArray<N extends Node> extends Array<N> {\n  declare private proxy: typeof Proxy\n  private _isInternalOperation = false\n\n  static get [Symbol.species]() { return Array }\n\n  constructor(public node: Node | IoElement, ...args: any[]) {\n    super(...args)\n    // TODO: Avoid creating empty NodeArrays in models!\n    // TODO: Test thoroughly! Check initializations with items!\n    // console.log('NodeArray constructor', args);\n    this.itemMutated = this.itemMutated.bind(this)\n    this.dispatchMutation = this.dispatchMutation.bind(this)\n\n    debug: if (!(node as Node)._isNode && !(node as IoElement)._isIoElement) {\n      console.error('NodeArray constructor called with non-node!')\n    }\n\n    const self = this\n    const proxy = new Proxy(this, {\n      get(target: NodeArray<N>, property: string | symbol) {\n        if (typeof property === 'symbol') {\n          return target[property as any]\n        }\n        const index = Number(property)\n        if (!isNaN(index) && index >= 0) {\n          return target[index]\n        }\n        return target[property as any]\n      },\n      set(target: NodeArray<N>, property: string | symbol, value: any) {\n        if (property === 'length') {\n          if (!self._isInternalOperation) {\n            const oldLength = target.length\n            const newLength = Number(value)\n            if (newLength < oldLength) {\n              for (let i = newLength; i < oldLength; i++) {\n                const item = target[i]\n                if (item._isNode) {\n                  item.removeEventListener('io-object-mutation', self.itemMutated)\n                  item.removeParent(self.node as Node)\n                }\n              }\n            } else if (newLength > oldLength) {\n              console.warn('NodeArray: cannot extend array with empty slots')\n              return true\n            }\n          }\n          target[property] = value\n          if (!self._isInternalOperation) self.dispatchMutation()\n          return true\n        }\n        const index = Number(property)\n        if (!isNaN(index) && index >= 0) {\n          // TODO Prevent adding to index greater than length?\n          const oldValue = target[index]\n          if (oldValue !== undefined && oldValue._isNode && !self._isInternalOperation) {\n            oldValue.removeEventListener('io-object-mutation', self.itemMutated)\n            oldValue.removeParent(self.node as Node)\n          }\n          target[property as any] = value\n          if (value._isNode && !self._isInternalOperation) {\n            value.addEventListener('io-object-mutation', self.itemMutated)\n            value.addParent(self.node)\n          }\n          if (!self._isInternalOperation) self.dispatchMutation()\n          return true\n        }\n        target[property as any] = value\n        return true\n      }\n    })\n    Object.defineProperty(this, 'proxy', {value: proxy, enumerable: false, configurable: false})\n    return proxy\n  }\n  // TODO: test!\n  withInternalOperation<T>(operation: () => T): T {\n    this._isInternalOperation = true\n    try {\n      return operation()\n    } finally {\n      this._isInternalOperation = false\n    }\n  }\n  splice(start: number, deleteCount: number, ...items: N[]): N[] {\n    return this.withInternalOperation(() => {\n      for (let i = start; i < start + deleteCount; i++) {\n        const item = this[i]\n        if (item._isNode) {\n          item.removeEventListener('io-object-mutation', this.itemMutated)\n          item.removeParent(this.node as Node)\n        }\n      }\n      const result = super.splice(start, deleteCount, ...items)\n      for (let i = start; i < start + items.length; i++) {\n        const item = this[i]\n        if (item._isNode) {\n          item.addEventListener('io-object-mutation', this.itemMutated)\n          item.addParent(this.node as Node)\n        }\n      }\n      if (deleteCount || items.length) this.dispatchMutation()\n      return result\n    })\n  }\n  push(...items: N[]): number {\n    return this.withInternalOperation(() => {\n      const result = super.push(...items)\n      for (const item of items) {\n        if (item._isNode) {\n          item.addEventListener('io-object-mutation', this.itemMutated)\n          item.addParent(this.node as Node)\n        }\n      }\n      if (items.length) this.dispatchMutation()\n      return result\n    })\n  }\n  unshift(...items: N[]): number {\n    return this.withInternalOperation(() => {\n      const result = super.unshift(...items)\n      for (const item of items) {\n        if (item._isNode) {\n          item.addEventListener('io-object-mutation', this.itemMutated)\n          item.addParent(this.node as Node)\n        }\n      }\n      if (items.length) this.dispatchMutation()\n      return result\n    })\n  }\n  pop(): N | undefined {\n    return this.withInternalOperation(() => {\n      const item = super.pop()\n      if (item !== undefined && item._isNode) {\n        item.removeEventListener('io-object-mutation', this.itemMutated)\n        item.removeParent(this.node as Node)\n      }\n      if (item !== undefined) this.dispatchMutation()\n      return item\n    })\n  }\n  shift(): N | undefined {\n    return this.withInternalOperation(() => {\n      const item = super.shift()\n      if (item !== undefined && item._isNode) {\n        item.removeEventListener('io-object-mutation', this.itemMutated)\n        item.removeParent(this.node as Node)\n      }\n      if (item !== undefined) this.dispatchMutation()\n      return item\n    })\n  }\n  reverse() {\n    return this.withInternalOperation(() => {\n      const result = super.reverse()\n      if (result.length) this.dispatchMutation()\n      return result\n    })\n  }\n  sort(compareFn?: (a: N, b: N) => number) {\n    return this.withInternalOperation(() => {\n      const result = super.sort(compareFn)\n      if (result.length) this.dispatchMutation()\n      return result\n    })\n  }\n  fill() {\n    console.warn('NodeArray: fill is not supported')\n    return this\n  }\n  copyWithin() {\n    console.warn('NodeArray: copyWithin is not supported')\n    return this\n  }\n  itemMutated(event: CustomEvent) {\n    this.node.dispatch('io-object-mutation', {object: this.proxy}, false, window)\n  }\n  dispatchMutation() {\n    this.node.dispatch('io-object-mutation', {object: this.proxy}, false, window)\n  }\n}","import { Binding } from './Binding.js'\nimport { AnyConstructor, Node } from '../nodes/Node.js'\nimport { IoElement } from '../elements/IoElement.js'\nimport { NodeArray } from '../core/NodeArray.js'\n\n/**\n * Configuration for a property of an Node class.\n * @typedef {Object} ReactivePropertyDefinition\n * @property {*} [value] The property's value. Can be any type unless `type` is specified.\n * @property {AnyConstructor} [type] Constructor function defining the property's type.\n * @property {Binding} [binding] Binding object for two-way data synchronization.\n * @property {boolean} [reflect] Whether to reflect the property to an HTML attribute.\n * @property {*} [init] Initialization arguments for constructing initial value.\n */\nexport type ReactivePropertyDefinition= {\n  value?: any\n  type?: AnyConstructor\n  binding?: Binding<any>\n  reflect?: boolean\n  init?: any\n}\n\n/**\n * Allows loose definition of properties by specifying only partial definitions, such as default value, type or a binding object.\n * @typedef {(string|number|boolean|Array<*>|null|undefined|AnyConstructor|Binding|ReactivePropertyDefinition)} ReactivePropertyDefinitionLoose\n */\nexport type ReactivePropertyDefinitionLoose = string | number | boolean | Array<any> | null | undefined | AnyConstructor | Binding<any> | ReactivePropertyDefinition\n\n/**\n * Instantiates a property definition object from a loosely or strongly typed property definition.\n * It facilitates merging of inherited property definitions from the prototype chain.\n * @class\n * @property {*} [value] The property's value. Can be any type.\n * @property {AnyConstructor} [type] Constructor function defining the property's type.\n * @property {Binding} [binding] Binding object for two-way data synchronization.\n * @property {boolean} [reflect] Whether to reflect the property to an HTML attribute.\n * @property {*} [init] Initialization arguments for constructing initial values.\n */\nexport class ReactiveProtoProperty {\n  declare value?: any\n  declare type?: AnyConstructor\n  declare binding?: Binding<any>\n  declare reflect?: boolean\n  declare init?: any\n  /**\n   * Creates a property definition from various input types.\n   * @param {ReactivePropertyDefinitionLoose} def Input definition which can be:\n   * - `undefined` or `null`: Sets as value\n   * - `AnyConstructor`: Sets as type\n   * - `Binding`: Sets value from binding and stores binding reference\n   * - `ReactivePropertyDefinition`: Copies all defined fields\n   * - Other values: Sets as value\n   * @example\n   * new ReactiveProtoProperty(String) // {type: String}\n   * new ReactiveProtoProperty('hello') // {value: 'hello'}\n   * new ReactiveProtoProperty({value: 42, type: Number}) // {value: 42, type: Number}\n   * new ReactiveProtoProperty(new Binding(node, 'value')) // {value: node.value, binding: ...}\n   */\n  constructor(def: ReactivePropertyDefinitionLoose) {\n    if (def === undefined || def === null) {\n      this.value = def\n    } else if (typeof def === 'function') {\n      this.type = def as AnyConstructor\n    } else if (def instanceof Binding) {\n      this.value = def.value\n      this.binding = def\n    } else if (def && def.constructor === Object) {\n      const d = def as ReactivePropertyDefinition\n      if (Object.hasOwn(d, 'value')) this.value = d.value\n      if (Object.hasOwn(d, 'type')) this.type = d.type\n      if (d.binding instanceof Binding) {\n        this.binding = d.binding\n        this.value = this.binding.value\n      }\n      if (Object.hasOwn(d, 'reflect')) this.reflect = d.reflect\n      if (Object.hasOwn(d, 'init')) this.init = d.init\n    } else if (!(def && def.constructor === Object)) {\n      this.value = def\n    }\n  }\n  /**\n   * Assigns values of another ReactiveProtoProperty to itself, unless they are default values.\n   * @param {ReactiveProtoProperty} protoProp Source ReactiveProtoProperty\n   */\n  assign(protoProp: ReactiveProtoProperty) {\n    if (Object.hasOwn(protoProp, 'value')) this.value = protoProp.value\n    if (Object.hasOwn(protoProp, 'type')) this.type = protoProp.type\n    if (Object.hasOwn(protoProp, 'reflect')) this.reflect = protoProp.reflect\n    if (Object.hasOwn(protoProp, 'init')) this.init = protoProp.init\n    if (Object.hasOwn(protoProp, 'binding')) this.binding = protoProp.binding\n  }\n  /**\n   * Creates a serializable representation of the property definition.\n   * Handles special cases for better JSON serialization:\n   * - Converts object values to their constructor names\n   * - Converts function types to their names\n   * - Only includes defined fields\n   * @returns {object} A plain object suitable for JSON serialization\n   */\n  toJSON() {\n    const json: any = {\n      value: this.value,\n      type: this.type,\n      reflect: this.reflect,\n      init: this.init,\n      binding: this.binding,\n    }\n    if (json.value && typeof json.value === 'object') {\n      json.value = json.value.constructor.name\n    }\n    if (json.type && typeof json.type === 'function') {\n      json.type = json.type.name\n    }\n    return json\n  }\n}\n\nfunction decodeInitArgument(item: any, node: Node | IoElement) {\n  if (item === 'this') {\n    return node\n  } else if (typeof item === 'string' && item.startsWith('this.')) {\n    const keys = item.split('.')\n    let target: any = node\n    for (let i = 1; i < keys.length; i++) {\n      target = target[keys[i]]\n    }\n    if (target) return target\n    console.error(`ReactivePropertyInstance: Invalid path ${item}`)\n  } else return item\n}\n\n/**\n * ReactivePropertyInstance object constructed from `ReactiveProtoProperty`.\n */\nexport class ReactivePropertyInstance {\n  // Property value.\n  value?: any\n  // Constructor of the property value.\n  type?: AnyConstructor\n  // Binding object.\n  binding?: Binding<any>\n  // Reflects to HTML attribute.\n  reflect = false\n  // Initialize property with provided constructor arguments. `null` prevents initialization.\n  init?: any = undefined\n  /**\n   * Creates the property configuration object and copies values from `ReactiveProtoProperty`.\n   * @param node owner Node instance\n   * @param propDef ReactiveProtoProperty object\n   */\n  constructor(node: Node | IoElement, propDef: ReactiveProtoProperty) {\n    debug: {\n      Object.keys(propDef).forEach(key => {\n        if (['value', 'type', 'reflect', 'init', 'binding'].indexOf(key) === -1) {\n          console.warn(`ReactiveProtoProperty: Invalid field ${key}`)\n        }\n      })\n      if (propDef.type !== undefined) {\n        if (typeof propDef.type !== 'function') console.warn('Incorrect type for \"type\" field')\n      }\n      if (propDef.type === NodeArray && propDef.init !== 'this') {\n        console.warn('NodeArray property should be initialized with \"this\"')\n      }\n      if (propDef.binding !== undefined && propDef.binding.constructor !== Binding) console.warn('Incorrect type for \"binding\" field')\n      if (propDef.reflect !== undefined && typeof propDef.reflect !== 'boolean') console.error(`Invalid reflect field ${propDef.reflect}!`)\n    }\n\n    this.value = propDef.value\n    this.type = propDef.type\n    this.binding = propDef.binding\n    if (typeof propDef.reflect === 'boolean') this.reflect = propDef.reflect\n    if (propDef.init !== undefined) this.init = propDef.init\n\n    if (this.binding instanceof Binding) {\n      this.value = this.binding.value\n    } else if (this.value === undefined) {\n      if (this.type === Boolean) this.value = false\n      else if (this.type === String) this.value = ''\n      else if (this.type === Number) this.value = 0\n      else if (typeof this.type === 'function') {\n        if (this.init !== undefined) {\n          if (this.init instanceof Array) {\n            const args = this.init.map(item => decodeInitArgument(item, node))\n            this.value = new this.type(...args)\n          } else if (this.init instanceof Object) {\n            const args: any = {}\n            Object.keys(this.init).forEach(key => {\n              args[key] = decodeInitArgument(this.init[key], node)\n            })\n            this.value = new this.type(args)\n          } else if (this.init === null) {\n            this.value = new this.type()\n          } else {\n            const argument = decodeInitArgument(this.init, node)\n            this.value = new this.type(argument)\n          }\n        }\n      }\n    }\n\n    debug: {\n      if (this.value !== undefined && this.init !== undefined) {\n        if ([String, Number, Boolean].indexOf(this.type as any) !== -1) {\n          if (this.type === Boolean && typeof this.value !== 'boolean' ||\n              this.type === Number && typeof this.value !== 'number' ||\n              this.type === String && typeof this.value !== 'string') {\n            console.warn(`Property: Uninitialized value for type \"${this.type.name}\"!`)\n          }\n        } else {\n          if (typeof this.type === 'function' && !(this.value instanceof this.type)) {\n            console.warn(`Property: Incorrect value \"${this.value}\" for type \"${this.type.name}\"!`)\n          }\n        }\n      }\n    }\n  }\n}","import { ReactivePropertyDefinitionLoose } from '../core/ReactiveProperty.js'\nimport { Node, AnyConstructor, ReactivePropertyDefinitions } from '../nodes/Node.js'\nimport { IoElement } from '../elements/IoElement.js'\n\nexport const propertyDecorators: WeakMap<AnyConstructor, Record<string, any>> = new WeakMap()\nexport const reactivePropertyDecorators: WeakMap<AnyConstructor, ReactivePropertyDefinitions> = new WeakMap()\n\n/**\n * Declares a property and an initial value for a property.\n * @decorator\n * @param {any} initialValue - Initial value.\n * @returns {Function} Property decorator function.\n *\n * @example\n * \\@Register\n * class MyClass extends Node {\n *   \\@Property('default text')\n *   declare title: string;\n * }\n */\nexport function Property(initialValue: any = undefined) {\n  return (target: Node | IoElement, propertyName: string) => {\n    const constructor = target.constructor as AnyConstructor\n    const properties = propertyDecorators.get(constructor) || {}\n    propertyDecorators.set(constructor, properties)\n    properties[propertyName] = initialValue\n  }\n};\n\n/**\n * Declares a reactive property and defines its inital value and behavior using a loose or strict definition.\n * @decorator\n * @param {ReactivePropertyDefinitionLoose} defLoose - Property definition.\n * @returns {Function} Property decorator function.\n *\n * @example\n * \\@Register\n * class MyClass extends Node {\n *   \\@ReactiveProperty({type: String, value: 'default text', reflect: true})\n *   declare title: string;\n * }\n *\n * @example\n * \\@Register\n * class MyClass extends Node {\n *   \\@ReactiveProperty({type: Array, init: [0, 0]})\n *   declare size: [number, number];\n * }\n */\nexport function ReactiveProperty(defLoose: ReactivePropertyDefinitionLoose = {}) {\n  return (target: Node | IoElement, propertyName: string) => {\n    const constructor = target.constructor as AnyConstructor\n    const properties = reactivePropertyDecorators.get(constructor) || {}\n    reactivePropertyDecorators.set(constructor, properties)\n    properties[propertyName] = defLoose\n  }\n};","import { AnyConstructor } from '../nodes/Node.js'\n\nexport const styleDecorators: WeakMap<AnyConstructor, string> = new WeakMap()\n\nexport function Style(style: string) {\n  return (target: AnyConstructor) => {\n    // Add the Style static property to the class\n    Object.defineProperty(target, 'Style', {\n      get() {\n        return style\n      },\n      configurable: true,\n      enumerable: true\n    })\n\n    // Also store in WeakMap for potential future use\n    styleDecorators.set(target, style)\n  }\n}","import { ReactiveProtoProperty } from './ReactiveProperty.js'\nimport { ListenerDefinition, hardenListenerDefinition } from './EventDispatcher.js'\nimport { Node, NodeConstructor, ReactivePropertyDefinitions, ListenerDefinitions, AnyConstructor } from '../nodes/Node.js'\nimport { reactivePropertyDecorators } from '../decorators/Property.js'\nimport { propertyDecorators } from '../decorators/Property.js'\nimport { styleDecorators } from '../decorators/Style.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: Improve types!\n\ntype ProtoConstructors = Array<NodeConstructor>\ntype ProtoHandlers = string[]\ntype ReactiveProtoProperties = { [property: string]: ReactiveProtoProperty }\ntype ProtoListeners = { [property: string]: ListenerDefinition[] }\n\n/**\n * ProtoChain manages class inheritance metadata and configuration.\n *\n * This utility class traverses the prototype chain during class registration to:\n * - Aggregate property configurations\n * - Aggregate event listeners\n * - Aggregate CSS styles strings\n * - Auto-bind event handlers to maintain proper 'this' context\n *\n * This class is internal and instantiated during the `Register()` process.\n */\nexport class ProtoChain {\n  /**\n   * Array of inherited class constructors\n   */\n  constructors: ProtoConstructors = []\n  /**\n   * Aggregated initial value for properties declared in `static get Properties()` or @Property() decorators\n  */\n  properties: Record<string, any> = {}\n  /**\n   * Aggregated reactive property definition declared in `static get ReactiveProperties()` or @ReactiveProperty() decorators\n   */\n  reactiveProperties: ReactiveProtoProperties = {}\n  /**\n   * Aggregated listener definition declared in `static get Listeners()`\n   */\n  listeners: ProtoListeners = {}\n  /**\n   * Aggregated CSS style definition declared in `static get Style()`\n   */\n  style: string = ''\n  /**\n   * Array of function names that start with \"on[A-Z]\" or \"_on[A-Z]\" for auto-binding.\n   */\n  handlers: ProtoHandlers = []\n  /**\n   * Creates an instance of `ProtoChain` for specified class constructor.\n   * @param {NodeConstructor} ioNodeConstructor - Owner `Node` constructor.\n   */\n  constructor(ioNodeConstructor: NodeConstructor) {\n    let proto = ioNodeConstructor.prototype\n    // Iterate through the prototype chain to aggregate constructors.\n    // Terminates at `HTMLElement`, `Object` or `Array`.\n    while (\n      proto\n      && (ioNodeConstructor) !== HTMLElement\n      && (ioNodeConstructor) !== Object) {\n        this.constructors.push(ioNodeConstructor)\n        proto = Object.getPrototypeOf(proto)\n        ioNodeConstructor = proto.constructor\n    }\n\n    // Iterate through the prototype chain in reverse to aggregate inherited properties and listeners.\n    let reactivePropertyHash = ''\n    let propertyHash = ''\n    for (let i = this.constructors.length; i--;) {\n      ioNodeConstructor = this.constructors[i]\n      this.addPropertiesFromDecorators(ioNodeConstructor)\n      propertyHash = this.addProperties(ioNodeConstructor.Properties, propertyHash)\n      this.addReactivePropertiesFromDecorators(ioNodeConstructor)\n      reactivePropertyHash = this.addReactiveProperties(ioNodeConstructor.ReactiveProperties, reactivePropertyHash)\n      this.addListeners(ioNodeConstructor.Listeners)\n      this.addStyle(ioNodeConstructor.Style)\n      this.addStyleFromDecorators(ioNodeConstructor)\n      this.addHandlers(ioNodeConstructor.prototype as Node | IoElement)\n    }\n    debug: this.validateReactiveProperties()\n  }\n  /**\n   * Auto-binds event handler methods (starting with 'on[A-Z]' or '_on[A-Z]') to preserve their 'this' context.\n   * NOTE: Defining handlers as arrow functions will not work because they are not defined before constructor has finished.\n   * @param {Node | IoElement} node - Target node instance\n   */\n  init(node: Node | IoElement) {\n    for (let i = this.handlers.length; i--;) {\n      Object.defineProperty(node, this.handlers[i], {\n        value: (node as any)[this.handlers[i]].bind(node),\n        writable: true,\n        configurable: true\n      })\n    }\n    debug: {\n      if (this.constructors[0] !== node.constructor) {\n        console.error(`${node.constructor.name} not registered!\\nUse @Register decorator before using ${node.constructor.name} class!`)\n      }\n    }\n  }\n  /**\n   * Adds properties defined in decorators to the properties array.\n   * @param {NodeConstructor} ioNodeConstructor - Owner `Node` constructor.\n   */\n  addPropertiesFromDecorators(ioNodeConstructor: NodeConstructor) {\n    const props = propertyDecorators.get(ioNodeConstructor as AnyConstructor)\n    if (props) for (const name in props) {\n      this.properties[name] = props[name]\n    }\n  }\n  addProperties(properties: Record<string, any> = {}, prevHash = ''): string {\n    const newHash = JSON.stringify(properties)\n    if (newHash !== prevHash) {\n      for (const name in properties) {\n        this.properties[name] = properties[name]\n      }\n      prevHash = newHash\n    }\n    return prevHash\n  }\n  /**\n   * Adds reactive properties defined in decorators to the properties array.\n   * @param {NodeConstructor} ioNodeConstructor - Owner `Node` constructor.\n   */\n  addReactivePropertiesFromDecorators(ioNodeConstructor: NodeConstructor) {\n    const props = reactivePropertyDecorators.get(ioNodeConstructor as AnyConstructor)\n    if (props) for (const name in props) {\n      const protoProperty = new ReactiveProtoProperty(props[name])\n      if (!this.reactiveProperties[name]) this.reactiveProperties[name] = protoProperty\n      this.reactiveProperties[name].assign(protoProperty)\n    }\n  }\n  /**\n   * Adds reactive properties from `static get ReactiveProperties()` to the properties array.\n   * Only process properties if they differ from superclass.\n   * This prevents 'static get ReactiveProperties()' from overriding subclass properties defined in decorators.\n   * @param {ReactivePropertyDefinitions} properties - Properties to add\n   * @param {string} prevHash - Previous properties hash\n   * @returns {string} - Updated properties hash\n   */\n  addReactiveProperties(properties: ReactivePropertyDefinitions = {}, prevHash = ''): string {\n    const reativeProtoProperties: Record<string, ReactiveProtoProperty> = {}\n    for (const name in properties) {\n      reativeProtoProperties[name] = new ReactiveProtoProperty(properties[name])\n    }\n    const newHash = JSON.stringify(reativeProtoProperties)\n    if (newHash !== prevHash) {\n      for (const name in properties) {\n        if (!this.reactiveProperties[name]) this.reactiveProperties[name] = reativeProtoProperties[name]\n        else this.reactiveProperties[name].assign(reativeProtoProperties[name])\n      }\n      prevHash = newHash\n    }\n    return prevHash\n  }\n  /**\n   * Merges or appends a listener definitions to the existing listeners array.\n   * @param {ListenerDefinitions} listenerDefs - Listener definitions to add\n   */\n  addListeners(listenerDefs?: ListenerDefinitions) {\n    for (const name in listenerDefs) {\n      if (listenerDefs[name]) {\n        const lsnDef = hardenListenerDefinition(listenerDefs[name])\n        const listeners = this.listeners[name] = this.listeners[name] || []\n        const i = listeners.findIndex(def => def[0] === lsnDef[0])\n        if (i !== -1) {\n          if (listeners[i][1]) listeners[i][1] = Object.assign(listeners[i][1] as ListenerDefinition, lsnDef[1])\n          else if (lsnDef[1]) listeners[i][1] = lsnDef[1]\n        } else {\n          listeners.push(lsnDef)\n        }\n      }\n    }\n  }\n  /**\n   * Adds a style string to the styles array.\n   * @param {string} style - Style string to add\n   */\n  addStyle(style?: string) {\n    if (style && this.style.indexOf(style) === -1) {\n      this.style = this.style ? this.style + '\\n' + style : style\n    }\n  };\n  /**\n   * Adds style defined in decorators to the style string.\n   * @param {NodeConstructor} ioNodeConstructor - Owner `Node` constructor.\n   */\n  addStyleFromDecorators(ioNodeConstructor: NodeConstructor) {\n    const style = styleDecorators.get(ioNodeConstructor as AnyConstructor)\n    if (style) {\n      this.style = this.style ? this.style + '\\n' + style : style\n    }\n  }\n  /**\n   * Adds function names that start with \"on[A-Z]\" or \"_on[A-Z]\" to the handlers array.\n   * @param {Node} proto - Prototype object to search for handlers\n   */\n  addHandlers(proto: Node | IoElement) {\n    const names = Object.getOwnPropertyNames(proto)\n    for (let j = 0; j < names.length; j++) {\n      const fn = names[j]\n      if (/^on[A-Z]/.test(fn) || /^_on[A-Z]/.test(fn) || fn.endsWith('Changed') || fn.endsWith('Mutated') || fn === 'changed') {\n        const propDesr = Object.getOwnPropertyDescriptor(proto, fn)\n        if (propDesr === undefined || propDesr.get || propDesr.set) continue\n        if (typeof (proto as any)[fn] === 'function') {\n          if (this.handlers.indexOf(fn) === -1) {\n            this.handlers.push(fn)\n          }\n        }\n      }\n    }\n  };\n  /**\n   * Validates reactive property definitions in debug mode.\n   * Logs warnings for incorrect property definitions.\n   * @returns {void}\n   */\n  validateReactiveProperties() {\n    for (const name in this.reactiveProperties) {\n      const prop = this.reactiveProperties[name]\n      if ([String, Number, Boolean].indexOf(prop.type as any) !== -1) {\n        if (prop.type === Boolean && prop.value !== undefined && typeof prop.value !== 'boolean' ||\n            prop.type === Number && prop.value !== undefined && typeof prop.value !== 'number' ||\n            prop.type === String && prop.value !== undefined && typeof prop.value !== 'string') {\n          console.warn(`Reactive property \"${name}\" value \"${prop.value}\" type for ${prop.type.name} property!`)\n        }\n      } else {\n        const isNull = prop.value === null\n        const isUndefined = prop.value === undefined\n        if (typeof prop.type === 'function' && !(prop.value instanceof prop.type) && !isNull && !isUndefined) {\n            console.warn(`Reactive property \"${name}\" value \"${prop.value}\" type for ${prop.type.name} property!`)\n        }\n      }\n    }\n  }\n}\n","import { Node } from '../nodes/Node.js'\nimport { IoElement } from '../elements/IoElement.js'\n\nexport type CallbackFunction = (arg?: any) => void\n\ninterface QueueOptions {\n  node: Node | IoElement | undefined\n  arg: any\n  frame: number\n}\n\nlet currentFrame = 0\n\nconst queueSync: CallbackFunction[] = []\nconst queue0: CallbackFunction[] = []\nconst queue1: CallbackFunction[] = []\nconst queueOptions0: WeakMap<CallbackFunction, QueueOptions> = new WeakMap()\nconst queueOptions1: WeakMap<CallbackFunction, QueueOptions> = new WeakMap()\nlet queue = queue0\nlet queueOptions = queueOptions0\n\n/**\n * Returns a promise that resolves when the next frame is rendered.\n * Used for testing purposes.\n * @returns {Promise<void>}\n */\nexport async function nextQueue(): Promise<void> {\n  return new Promise((resolve) => {\n    queue.push(resolve)\n    queueOptions.set(resolve, {\n      arg: undefined,\n      node: undefined,\n      frame: currentFrame + 1,\n    })\n  })\n}\n\n/**\n * Throttles function execution once per frame (rAF).\n * @param {CallbackFunction} func - Function to throttle.\n * @param {*} [arg] - Optional argument for throttled function.\n * @param {Node | IoElement} [node] - Node instance.\n * @param {number} [delay] - Delay in frames.\n *\n * @example\n * throttle(someFunction, 'someArg', someNode);\n */\nexport function throttle(func: CallbackFunction, arg?: any, node?: Node | IoElement, delay = 1) {\n  if (queue.indexOf(func) === -1) {\n    queue.push(func)\n  }\n  if (!queueOptions.has(func)) {\n    queueOptions.set(func, {\n      arg: arg,\n      node: node,\n      frame: currentFrame + delay,\n    })\n  } else {\n    const options = queueOptions.get(func)!\n    options.arg = arg\n  }\n}\n\n/**\n * Debounces function execution to next frame (rAF).\n * @param {CallbackFunction} func - Function to debounce.\n * @param {*} [arg] - Optional argument for debounced function.\n * @param {Node | IoElement} [node] - Node instance.\n * @param {number} [delay] - Delay in frames.\n *\n * @example\n * debounce(someFunction, 'someArg', someNode);\n */\nexport function debounce(func: CallbackFunction, arg?: any, node?: Node | IoElement, delay = 1) {\n  if (queue.indexOf(func) === -1) {\n    queue.push(func)\n  }\n  if (!queueOptions.has(func)) {\n    queueOptions.set(func, {\n      arg: arg,\n      node: node,\n      frame: currentFrame + delay,\n    })\n  } else {\n    const options = queueOptions.get(func)!\n    options.arg = arg\n    options.frame = currentFrame + delay\n  }\n}\n\n/**\n * Executes the queue of throttled/debounced functions.\n * Internally it swaps between two queues to avoid allocating new queue items to a queue that is currently being executed.\n * Therfore, functions queued from another queued function will always move to the next queue.\n */\nfunction executeQueue () {\n\n  currentFrame++\n\n  const activeQueue = queue\n  const activeQueueOptions = queueOptions\n  queue = queue === queue0 ? queue1 : queue0\n  queueOptions = queueOptions === queueOptions0 ? queueOptions1 : queueOptions0\n\n  for (let i = 0; i < activeQueue.length; i++) {\n    const func = activeQueue[i]\n    const options = activeQueueOptions.get(func)!\n    activeQueueOptions.delete(func)\n\n    if (options === undefined) {\n      console.warn(func)\n      continue\n    }\n\n    if (options.frame > currentFrame) {\n      if (queue.indexOf(func) === -1) {\n        queue.push(func)\n      }\n      if (!queueOptions.has(func)) {\n        queueOptions.set(func, options)\n      }\n      continue\n    }\n\n    if (options.node?._disposed) continue\n    try {\n      if (options.arg !== undefined) func(options.arg)\n      else func()\n    } catch (e) {\n      console.error(e)\n    }\n  }\n  queueSync.length = 0\n  activeQueue.length = 0\n  requestAnimationFrame(executeQueue)\n}\nrequestAnimationFrame(executeQueue)","import { EventDispatcher } from '../core/EventDispatcher.js'\nimport { IoElement } from '../elements/IoElement.js'\nimport { Binding } from '../core/Binding.js'\n\nexport type VDOMElement = {\n  tag: string\n  props?: Record<string, any>\n  children?: Array<VDOMElement | null> | string\n}\n\ntype IntegerNumeric = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 30 | 31 | 32\ntype IntegerString = `${IntegerNumeric}`\ntype IntegerAny = IntegerNumeric | IntegerString\ntype Boolean = boolean | 'true' | 'false'\ntype Lang = 'ab'|'aa'|'af'|'ak'|'sq'|'am'|'ar'|'an'|'hy'|'as'|'av'|'ae'|'ay'|'az'|'bm'|'ba'|'eu'|'be'|'bn'|'bh'|'bi'|'bs'|'br'|'bg'|'my'|'ca'|'ch'|'ce'|\n      'ny'|'zh'|'zh-ans'|'zh-ant'|'cv'|'kw'|'co'|'cr'|'hr'|'cs'|'da'|'dv'|'nl'|'dz'|'en'|'eo'|'et'|'ee'|'fo'|'fj'|'fi'|'fr'|'ff'|'gl'|'gd'|\n      'ka'|'de'|'el'|'kl'|'gn'|'gu'|'ht'|'ha'|'he'|'hz'|'hi'|'ho'|'hu'|'is'|'io'|'ig'|'id in'|'ia'|'ie'|'iu'|'ik'|'ga'|'it'|'ja'|'jv'|'kn'|\n      'kr'|'ks'|'kk'|'km'|'ki'|'rw'|'rn'|'ky'|'kv'|'kg'|'ko'|'ku'|'kj'|'lo'|'la'|'lv'|'li'|'ln'|'lt'|'lu'|'lg'|'lb'|'gv'|'mk'|'mg'|'ms'|'ml'|'mt'|\n      'mi'|'mr'|'mh'|'mo'|'mn'|'na'|'nv'|'ng'|'nd'|'ne'|'no'|'nb'|'nn'|'oc'|'oj'|'cu'|'or'|'om'|'os'|'pi'|'ps'|'fa'|'pl'|'pt'|'pa'|'qu'|'rm'|\n      'ro'|'ru'|'se'|'sm'|'sg'|'sa'|'sr'|'sh'|'st'|'tn'|'sn'|'ii'|'sd'|'si'|'ss'|'sk'|'sl'|'so'|'nr'|'es'|'su'|'sw'|'sv'|'tl'|'ty'|'tg'|'ta'|\n      'tt'|'te'|'th'|'bo'|'ti'|'to'|'ts'|'tr'|'tk'|'tw'|'ug'|'uk'|'ur'|'uz'|'ve'|'vi'|'vo'|'wa'|'cy'|'wo'|'fy'|'xh'|'yi'|'ji'|'yo'|'za'|'zu'\n\ntype PropsWithUndefined<T> = {[K in keyof T]: T[K] | undefined}\n\nexport type AriaProps = PropsWithUndefined<{\n  role?: 'alert'|'alertdialog'|'application'|'article'|'banner'|'button'|'cell'|'checkbox'|'columnheader'|'combobox'|'complementary'|\n      'contentinfo'|'definition'|'dialog'|'directory'|'document'|'feed'|'figure'|'form'|'grid'|'gridcell'|'group'|'heading'|'img'|\n      'link'|'list'|'listbox'|'listitem'|'log'|'main'|'marquee'|'math'|'menu'|'menubar'|'menuitem'|'menuitemcheckbox'|'menuitemradio'|\n      'navigation'|'none'|'note'|'option'|'presentation'|'progressbar'|'radio'|'radiogroup'|'region'|'row'|'rowgroup'|'rowheader'|\n      'scrollbar'|'search'|'searchbox'|'separator'|'slider'|'spinbutton'|'status'|'switch'|'tab'|'table'|'tablist'|'tabpanel'|'term'|\n      'textbox'|'timer'|'toolbar'|'tooltip'|'tree'|'treegrid'|'treeitem'\n  ariaAtomic?: Boolean\n  ariaAutoComplete?: 'inline' | 'list' | 'both' | 'none'\n  ariaBusy?: Boolean\n  ariaBrailleLabel?: string\n  ariaBrailleRoleDescription?: string\n  ariaChecked?: Boolean | 'mixed'\n  ariaColCount?: IntegerAny\n  ariaColIndex?: IntegerAny\n  ariaColSpan?: IntegerAny\n  ariaCurrent?: Boolean | 'page' | 'step' | 'location' | 'date' | 'time' | 'true' | 'false'\n  ariaDescription?: string\n  ariaDisabled?: Boolean\n  ariaExpanded?: Boolean | 'undefined'\n  ariaHasPopup?: Boolean | 'menu' | 'listbox' | 'tree' | 'grid' | 'dialog'\n  ariaHidden?: Boolean | 'undefined'\n  ariaInvalid?: Boolean | 'grammar' | 'spelling'\n  ariaKeyShortcuts?: string\n  ariaLabel?: string\n  ariaLevel?: IntegerAny\n  ariaLive?: 'assertive' | 'polite' | 'off'\n  ariaModal?: Boolean\n  ariaMultiLine?: Boolean\n  ariaMultiSelectable?: Boolean\n  ariaOrientation?: 'horizontal' | 'vertical' | 'undefined'\n  ariaPlaceholder?: string\n  ariaPosInSet?: IntegerAny\n  ariaPressed?: Boolean | 'mixed' | 'undefined'\n  ariaReadOnly?: Boolean\n  ariaRequired?: Boolean\n  ariaRelevant?: 'additions' | 'all' | 'removals' | 'text'\n  ariaRoleDescription?: string\n  ariaRowCount?: IntegerAny\n  ariaRowIndex?: IntegerAny\n  ariaRowSpan?: IntegerAny\n  ariaSelected?: Boolean | 'undefined'\n  ariaSetSize?: IntegerAny\n  ariaSort?: 'none' | 'ascending' | 'descending' | 'other'\n  ariaValueMax?: number | `${number}`\n  ariaValueMin?: number | `${number}`\n  ariaValueNow?: number | `${number}`\n  ariaValueText?: string\n  ariaColIndexText?: string\n  ariaRowIndexText?: string\n  // TODO: Implement and test in VDOM!\n  ariaActiveDescendantElement?: HTMLElement\n  ariaControlsElements?: HTMLElement\n  ariaDescribedByElements?: HTMLElement\n  ariaDetailsElements?: HTMLElement\n  ariaErrorMessageElements?: HTMLElement\n  ariaFlowToElements?: HTMLElement\n  ariaLabelledByElements?: HTMLElement\n}>\n\nexport type OtherHTMLElementProps = PropsWithUndefined<{\n  target?: '_blank' | '_self' | '_parent' | '_top' | string\n  download?: string\n  ping?: string\n  rel?: string\n  relList?: DOMTokenList\n  hreflang?: Lang\n  type?: string\n  referrerPolicy?: 'no-referrer' | 'no-referrer-when-downgrade' | 'origin' | 'origin-when-cross-origin' | 'same-origin' | 'strict-origin' | 'strict-origin-when-cross-origin' | 'unsafe-url'\n  text?: string\n  coords?: string\n  charset?: string\n  name?: string\n  rev?: string\n  shape?: 'rect' | 'circle' | 'poly' | 'default'\n  protocol?: string\n  username?: string\n  password?: string\n  host?: string\n  hostname?: string\n  port?: string\n  pathname?: string\n  search?: string\n  hash?: string\n  href?: string\n  attributionSrc?: string\n  alt?: string\n  noHref?: boolean\n  cite?: string\n  clear?: 'left' | 'right' | 'both' | 'all' | 'none'\n  disabled?: boolean\n  formAction?: string\n  formEnctype?: 'application/x-www-form-urlencoded' | 'multipart/form-data' | 'text/plain'\n  formMethod?: 'get' | 'post' | 'dialog'\n  formNoValidate?: boolean\n  formTarget?: '_blank' | '_self' | '_parent' | '_top' | string\n  value?: string | number\n  commandForElement?: string\n  command?: string\n  width?: number | string\n  height?: number | string\n  span?: number\n  ch?: string\n  chOff?: string\n  vAlign?: 'top' | 'middle' | 'bottom' | 'baseline'\n  dateTime?: string\n  open?: boolean\n  returnValue?: string\n  closedBy?: string\n  compact?: boolean\n  src?: string\n  color?: string\n  face?: string\n  size?: number | string\n  acceptCharset?: string\n  action?: string\n  autocomplete?: 'on' | 'off'\n  enctype?: 'application/x-www-form-urlencoded' | 'multipart/form-data' | 'text/plain'\n  encoding?: string\n  method?: 'get' | 'post' | 'dialog'\n  noValidate?: boolean\n  scrolling?: 'yes' | 'no' | 'auto'\n  frameBorder?: '0' | '1'\n  longDesc?: string\n  noResize?: boolean\n  marginHeight?: number | string\n  marginWidth?: number | string\n  cols?: number | string\n  rows?: number | string\n  noShade?: boolean\n  version?: string\n  srcdoc?: string\n  sandbox?: string\n  allowFullscreen?: boolean\n  csp?: string\n  allow?: string\n  loading?: 'eager' | 'lazy'\n  credentialless?: boolean\n  allowPaymentRequest?: boolean\n  privateToken?: boolean\n  browsingTopics?: boolean\n  adAuctionHeaders?: boolean\n  sharedStorageWritable?: boolean\n  srcset?: string\n  sizes?: string\n  crossOrigin?: 'anonymous' | 'use-credentials' | ''\n  useMap?: string\n  isMap?: boolean\n  decoding?: 'sync' | 'async' | 'auto'\n  fetchPriority?: 'high' | 'low' | 'auto'\n  lowsrc?: string\n  hspace?: number | string\n  vspace?: number | string\n  border?: number | string\n  accept?: string\n  defaultChecked?: boolean\n  checked?: boolean\n  dirName?: string\n  files?: FileList\n  indeterminate?: boolean\n  max?: number | string\n  maxLength?: number\n  min?: number | string\n  minLength?: number\n  multiple?: boolean\n  pattern?: string\n  placeholder?: string\n  readOnly?: boolean\n  required?: boolean\n  step?: number | string\n  defaultValue?: string\n  valueAsDate?: Date | null\n  valueAsNumber?: number\n  selectionStart?: number\n  selectionEnd?: number\n  selectionDirection?: 'forward' | 'backward' | 'none'\n  webkitdirectory?: boolean\n  incremental?: boolean\n  htmlFor?: string\n  media?: string\n  as?: string\n  imageSrcset?: string\n  imageSizes?: string\n  integrity?: string\n  blocking?: boolean\n  httpEquiv?: string\n  content?: string\n  scheme?: string\n  low?: number | string\n  high?: number | string\n  optimum?: number | string\n  data?: string\n  archive?: string\n  code?: string\n  declare?: boolean\n  standby?: string\n  codeBase?: string\n  codeType?: string\n  reversed?: boolean\n  start?: number\n  label?: string\n  defaultSelected?: boolean\n  selected?: boolean\n  valueType?: string\n  noModule?: boolean\n  async?: boolean\n  defer?: boolean\n  event?: string\n  length?: number\n  selectedIndex?: number\n  caption?: string\n  tHead?: string\n  tFoot?: string\n  frame?: string\n  rules?: string\n  summary?: string\n  cellPadding?: string\n  cellSpacing?: string\n  colSpan?: number\n  rowSpan?: number\n  headers?: string\n  axis?: string\n  noWrap?: boolean\n  abbr?: string\n  scope?: 'row' | 'col' | 'rowgroup' | 'colgroup'\n  shadowRootMode?: 'open' | 'closed'\n  shadowRootDelegatesFocus?: boolean\n  shadowRootClonable?: boolean\n  shadowRootSerializable?: boolean\n  wrap?: 'soft' | 'hard'\n  kind?: string\n  srclang?: Lang\n  default?: boolean\n  poster?: string\n  playsInline?: boolean\n  disablePictureInPicture?: boolean\n}>\n\ntype prefix<TKey, TPrefix extends string> = TKey extends string ? `${TPrefix}${TKey}` : never\ntype AnyEventHandler = ((event: CustomEvent<any>) => void) | ((event: PointerEvent) => void) | ((event: KeyboardEvent) => void) | ((event: MouseEvent) => void) | ((event: TouchEvent) => void) | ((event: WheelEvent) => void) | ((event: InputEvent) => void) | ((event: ClipboardEvent) => void) | ((event: DragEvent) => void) | ((event: FocusEvent) => void) | ((event: TransitionEvent) => void) | ((event: AnimationEvent) => void) | ((event: ErrorEvent) => void) | ((event: Event) => void)\n\nexport type NativeElementProps = AriaProps & PropsWithUndefined<{\n  [key: prefix<string, '@'>]: string | AnyEventHandler\n  title?: string\n  lang?: Lang\n  translate?: any\n  dir?: any\n  hidden?: any\n  inert?: any\n  accessKey?: any\n  draggable?: any\n  spellcheck?: boolean\n  autocapitalize?: any\n  contentEditable?: Boolean\n  enterKeyHint?: 'enter' | 'done' | 'go' | 'next' | 'previous' | 'search' | 'send'\n  inputMode?: 'decimal' | 'email' | 'numeric' | 'tel' | 'search' | 'url' | 'text'\n  virtualKeyboardPolicy?: 'manual' | 'auto'\n  // offsetParent?: any,\n  innerText?: string\n  outerText?: string\n  writingSuggestions?: Boolean\n  autofocus?: boolean\n  tabIndex?: IntegerAny | -1 | '-1'\n  style?: Record<string, string>\n  id?: string\n  class?: string // Shorthand for className\n  innerHTML?: string\n  outerHTML?: string\n  scrollTop?: number\n  scrollLeft?: number\n  scrollWidth?: number\n  scrollHeight?: number\n  textContent?: string\n}>\n\nconst defaultPropsMap = new WeakMap<HTMLElement, NativeElementProps>()\n\n// TODO: Fix types. Remove any.\n\n/**\n * Sets native element's properties and attributes.\n * - style: formatted as Object.\n * - class: shorthand for className.\n * - \"@\" + event: name for event listener.\n * @param {HTMLElement} element - Native HTMLElement to apply properties to.\n * @param {Object} props - Element properties.\n */\nexport const applyNativeElementProps = function(element: HTMLElement, props: NativeElementProps) {\n\n  let defaultPropValues: any = defaultPropsMap.get(element) || {}\n\n  defaultPropsMap.set(element, defaultPropValues)\n\n  for (const _p in props) {\n    const p = _p as keyof HTMLElement\n    const prop = props[p as keyof NativeElementProps]\n\n    debug: if (prop instanceof Binding) {\n      console.warn(`VDOM: Cannot set binding on \"${element.localName}.${_p}\"`)\n    }\n\n    if (!Object.hasOwn(defaultPropValues, p)) defaultPropValues[p] = element[p]\n\n    if (p === 'style') {\n      for (const s in prop) {\n        element.style.setProperty(s, prop[s])\n      }\n    } else if ((p as any) === 'class') {\n      element['className'] = prop\n    } else if (p.startsWith('data-')) {\n      // TODO: Test this!\n      if (prop === undefined) {\n        element.removeAttribute(p)\n      } else {\n        element.setAttribute(p, prop)\n      }\n    } else {\n      if (prop === undefined) {\n        (element as any)[p] = defaultPropValues[p]\n      } else {\n        (element as any)[p] = prop\n      }\n    }\n\n    if (prop === undefined) element.removeAttribute(p)\n    else if (prop === defaultPropValues[p]) element.removeAttribute(p)\n  }\n  // Reset properties to defaults if they are not in the props.\n  for (const _p in defaultPropValues) {\n    const p = _p as keyof NativeElementProps\n    if (!Object.hasOwn(props, p)) {\n      (element as any)[p] = defaultPropValues[p]\n      element.removeAttribute(p)\n    }\n  }\n  if (!(element as IoElement)._eventDispatcher) {\n    Object.defineProperty(element, '_eventDispatcher', {enumerable: false, configurable: true, value: new EventDispatcher(element as unknown as IoElement)})\n  }\n  (element as IoElement)._eventDispatcher.applyPropListeners(props)\n}\n\n/**\n * Creates an element from a virtual DOM object.\n * @param {VDOMElement} vDOMElement - Virtual DOM object.\n * @return {HTMLElement} - Created element.\n */\nexport const constructElement = function(vDOMElement: VDOMElement) {\n  const props = vDOMElement.props || {}\n  // IoElement classes constructed with constructor.\n  const ConstructorClass = window.customElements ? window.customElements.get(vDOMElement.tag) : null\n  if (ConstructorClass && (ConstructorClass as any)._isIoElement) {\n    return new ConstructorClass(props)\n  }\n  // Other element classes constructed with document.createElement.\n  const element = document.createElement(vDOMElement.tag)\n  applyNativeElementProps(element, props)\n  return element\n}\n\n/**\n * Disposes the element's children.\n * @param {IoElement} element - Element to dispose children of.\n */\nexport const disposeChildren = function(element: IoElement) {\n  // NOTE: This rAF ensures that element's change queue is emptied before disposing.\n  requestAnimationFrame(() => {\n    const elements = Array.from(element.querySelectorAll('*')).concat([element]) as IoElement[]\n    for (let i = elements.length; i--;) {\n      if (typeof elements[i].dispose === 'function') {\n        elements[i].dispose()\n      } else if (elements[i]._eventDispatcher) {\n        elements[i]._eventDispatcher.dispose()\n        delete (elements[i] as any)._eventDispatcher\n      }\n    }\n  })\n}\n\nconst vDOMAttributes = function(element: IoElement | HTMLElement): Record<string, any> {\n  const attributes: Record<string, any> = {}\n  for (let i = 0; i < element.attributes.length; i++) {\n    const name = element.attributes[i].name\n    const value = element.getAttribute(name)\n    if (value !== null) attributes[name] = value\n  }\n  return attributes\n}\n\nconst toVDOMChildren = function(htmlCollection: [IoElement | HTMLElement]): VDOMElement[] {\n  const children = []\n  for (let i = 0; i < htmlCollection.length; i++) {\n    children.push(toVDOM(htmlCollection[i]))\n  }\n  return children\n}\n\n/**\n * Converts an element to a virtual dom object.\n * NODE: This vDOM contains elements only attributes (not properties).\n * Used for testing but might be useful for other things.\n * @param {IoElement | HTMLElement} element - Element to convert.\n * @return {VDOMElement} - Virtual dom object.\n */\nexport const toVDOM = function(element: IoElement | HTMLElement): VDOMElement {\n  return {\n    tag: element.localName,\n    props: vDOMAttributes(element),\n    children: element.children.length > 0 ? toVDOMChildren((element as any).children) : element.textContent as string\n  }\n}","import { Node } from '../nodes/Node.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n/**\n * Registers a new Node or IoElement subclass. This needs to be called for each new class that extends Node or IoElement.\n * @param {Node | IoElement} ioNodeConstructor - Node class to register.\n *\n * @example\n * // Creating a new Node subclass.\n * \\@Register\n * class MyNode extends Node {\n * }\n *\n * @example\n * // Creating a new IoElement subclass.\n * \\@Register\n * class MyIoElement extends IoElement {\n * }\n *\n * @example\n * //Javascript without decorator syntax.\n * class MyNode extends Node {\n * }\n * Register(MyNode);\n*/\nexport function Register(ioNodeConstructor: typeof Node | typeof IoElement) {\n  (ioNodeConstructor as any).prototype.Register(ioNodeConstructor)\n}","// Global mixin record\nconst mixinRecord: Record<string, string> = {}\n\n// Regular expressions for style string processing.\nconst commentsRegex =  new RegExp('(\\\\/\\\\*[\\\\s\\\\S]*?\\\\*\\\\/)', 'gi')\nconst keyframeRegex =  new RegExp('((@.*?keyframes [\\\\s\\\\S]*?){([\\\\s\\\\S]*?}\\\\s*?)})', 'gi')\nconst mediaQueryRegex =  new RegExp('((@media [\\\\s\\\\S]*?){([\\\\s\\\\S]*?}\\\\s*?)})', 'gi')\nconst mixinRegex = new RegExp('(( --[\\\\s\\\\S]*?): {([\\\\s\\\\S]*?)})', 'gi')\nconst applyRegex = new RegExp('(@apply\\\\s.*?;)', 'gi')\nconst cssRegex =  new RegExp('((\\\\s*?(?:\\\\/\\\\*[\\\\s\\\\S]*?\\\\*\\\\/)?\\\\s*?@media[\\\\s\\\\S]*?){([\\\\s\\\\S]*?)}\\\\s*?})|(([\\\\s\\\\S]*?){([\\\\s\\\\S]*?)})', 'gi')\n\nexport function applyElementStyleToDocument(localName: string, style: string) {\n  let mixinsString = ''\n    const mixins = style.match(mixinRegex)\n    if (mixins) {\n      for (let i = 0; i < mixins.length; i++) {\n        // TODO: improve mixing regex and string handling.\n        const m = mixins[i].split(': {')\n        const name = m[0].replace(' --', '--')\n        const value = m[1].replace(/}/g, '').trim().replace(/^ +/gm, '')\n        mixinRecord[name] = value\n        mixinsString += mixins[i].replace(' --', '.').replace(': {', ' {')\n      }\n    }\n\n    // Remove mixins\n    style = style.replace(mixinRegex, '')\n\n    // Apply mixins\n    const apply = style.match(applyRegex)\n    if (apply) {\n      for (let i = 0; i < apply.length; i++) {\n        const name = apply[i].split('@apply ')[1].replace(';', '')\n        if (mixinRecord[name]) {\n          style = style.replace(apply[i], mixinRecord[name])\n        } else {\n          console.warn('IoElement: cound not find mixin:', name)\n        }\n      }\n    }\n\n    debug: {\n      let styleStripped = style\n      styleStripped = styleStripped.replace(commentsRegex, '')\n      styleStripped = styleStripped.replace(keyframeRegex, '')\n      styleStripped = styleStripped.replace(mediaQueryRegex, '')\n      const match = styleStripped.match(cssRegex)\n      if (match) {\n        match.forEach((selector: any) => {\n          selector = selector.trim()\n          if (!selector.startsWith(':host')) {\n            console.warn(localName + ': CSS Selector not prefixed with \":host\"! This will cause style leakage!')\n            console.warn(selector)\n          }\n        })\n      }\n    }\n\n    // Replace `:host` with element tag and add mixin CSS variables.\n    style = mixinsString + style.replace(new RegExp(':host', 'g'), localName)\n\n    const styleElement = document.createElement('style')\n    styleElement.innerHTML = style\n    styleElement.setAttribute('id', 'io-style-' + localName.replace('io-', ''))\n    document.head.appendChild(styleElement)\n}","import { Property, ReactiveProperty } from '../decorators/Property.js'\nimport { Register } from '../decorators/Register.js'\nimport { ProtoChain } from '../core/ProtoChain.js'\nimport { applyNativeElementProps, constructElement, disposeChildren, VDOMElement, toVDOM, NativeElementProps } from '../vdom/VDOM.js'\nimport { Node, ReactivityType, dispose, bind, unbind, onPropertyMutated, setProperty, dispatchQueue, setProperties, initReactiveProperties, initProperties, ReactivePropertyDefinitions, ListenerDefinitions } from '../nodes/Node.js'\nimport { Binding } from '../core/Binding.js'\nimport { applyElementStyleToDocument } from '../core/Style.js'\nimport { EventDispatcher, AnyEventListener } from '../core/EventDispatcher.js'\nimport { ChangeQueue } from '../core/ChangeQueue.js'\nimport { ReactivePropertyInstance } from '../core/ReactiveProperty.js'\nimport { throttle, debounce, CallbackFunction } from '../core/Queue.js'\n\nconst resizeObserver = new ResizeObserver(entries => {\n  for (const entry of entries) (entry.target as any).onResized()\n})\n\ntype prefix<TKey, TPrefix extends string> = TKey extends string ? `${TPrefix}${TKey}` : never\ntype AnyEventHandler = ((event: CustomEvent<any>) => void) | ((event: PointerEvent) => void) | ((event: KeyboardEvent) => void) | ((event: MouseEvent) => void) | ((event: TouchEvent) => void) | ((event: WheelEvent) => void) | ((event: InputEvent) => void) | ((event: ClipboardEvent) => void) | ((event: DragEvent) => void) | ((event: FocusEvent) => void) | ((event: TransitionEvent) => void) | ((event: AnimationEvent) => void) | ((event: ErrorEvent) => void) | ((event: Event) => void)\n\nexport type IoElementProps = NativeElementProps & {\n  reactivity?: ReactivityType\n  [key: prefix<string, '@'>]: string | AnyEventHandler\n}\n\n@Register\nexport class IoElement extends HTMLElement {\n  declare static vConstructor: (arg0?: IoElementProps | Array<VDOMElement | null> | string, arg1?: Array<VDOMElement | null> | string) => VDOMElement\n  static get Style() {\n    return /* css */`\n      :host {\n        display: block;\n        box-sizing: border-box;\n        -webkit-touch-callout: none;\n      }\n      :host[hidden] {\n        display: none;\n      }\n      --unselectable: {\n        user-select: none;\n        -webkit-user-select: none;\n        -webkit-touch-callout: none;\n        -webkit-tap-highlight-color: transparent;\n      }\n      --io_focus: {\n        border-color: var(--io_colorWhite) !important;\n        outline: var(--io_borderWidth) solid var(--io_borderColorBlue) !important;\n        z-index: 1;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: String, value: 'immediate'})\n  declare reactivity: ReactivityType\n\n  @Property(Object)\n  declare $: Record<string, HTMLElement | IoElement>\n\n  static get ReactiveProperties(): ReactivePropertyDefinitions {\n    return {}\n  }\n\n  static get Properties(): Record<string, any> {\n    return {}\n  }\n\n  static get Listeners(): ListenerDefinitions {\n    return {}\n  }\n\n  declare readonly _protochain: ProtoChain\n  declare readonly _reactiveProperties: Map<string, ReactivePropertyInstance>\n  declare readonly _bindings: Map<string, Binding<any>>\n  declare readonly _changeQueue: ChangeQueue\n  declare readonly _eventDispatcher: EventDispatcher\n  declare readonly _observedObjectProperties: string[]\n  declare readonly _observedNodeProperties: string[]\n  declare readonly _isIoElement: boolean\n  declare _disposed: boolean\n  declare _textNode: Text\n\n  constructor(args: IoElementProps = {}) {\n    super()\n    this._protochain.init(this)\n\n    Object.defineProperty(this, '_changeQueue', {enumerable: false, configurable: true, value: new ChangeQueue(this)})\n    Object.defineProperty(this, '_reactiveProperties', {enumerable: false, configurable: true, value: new Map()})\n    Object.defineProperty(this, '_bindings', {enumerable: false, configurable: true, value: new Map()})\n    Object.defineProperty(this, '_eventDispatcher', {enumerable: false, configurable: true, value: new EventDispatcher(this)})\n    Object.defineProperty(this, '_observedObjectProperties', {enumerable: false, configurable: true, value: []})\n    Object.defineProperty(this, '_observedNodeProperties', {enumerable: false, configurable: true, value: []})\n    // Object.defineProperty(this, '_parents', {enumerable: false, configurable: true, value: []});\n\n    this.init()\n\n    initReactiveProperties(this)\n    initProperties(this)\n\n    this.applyProperties(args, true)\n\n    this.ready()\n    this.dispatchQueue()\n  }\n  // TODO: add types\n  applyProperties(props: any, skipDispatch = false) {\n    for (const name in props) {\n      if (this._reactiveProperties.has(name)) {\n        this.setProperty(name, props[name], true)\n      } else {\n        if (name === 'class') {\n          this.className = props[name]\n        } else if (name === 'style') {\n          for (const s in props[name]) {\n            this.style[s as any] = props[name][s]\n          }\n        } else if (name.startsWith('data-')) {\n          // TODO: Test this!\n          if (props[name] === undefined) {\n            this.removeAttribute(name)\n          } else {\n            this.setAttribute(name, props[name])\n          }\n        } else if (!name.startsWith('@')) {\n          debug: if (props[name] as any instanceof Binding) {\n            console.warn(`IoElement: Not a ReactiveProperty! Cannot set binding to \"${name}\" property on element \"${this.localName}\"`)\n          }\n          this[name as keyof this] = props[name]\n          // TODO: test and check if type can be attribute.\n          if (props[name] === undefined && this.hasAttribute(name)) {\n            this.removeAttribute(name)\n          }\n        }\n      }\n    }\n    this._eventDispatcher.applyPropListeners(props)\n    if (!skipDispatch) this.dispatchQueue()\n  }\n  // TODO: add types\n  setProperties(props: any) {\n    setProperties(this, props)\n  }\n  setProperty(name: string, value: any, debounce = false) {\n    if (this._disposed) return\n    setProperty(this, name, value, debounce)\n    const prop = this._reactiveProperties.get(name)!\n    if (prop.reflect) this.setAttribute(name.toLowerCase(), value)\n  }\n  init() {}\n  ready() {}\n  changed() {}\n  queue(name: string, value: any, oldValue: any) {\n    this._changeQueue.queue(name, value, oldValue)\n  }\n  dispatchQueue(debounce = false) {\n    dispatchQueue(this, debounce)\n  }\n  throttle(func: CallbackFunction, arg?: any, timeout = 1) {\n    throttle(func, arg, this, timeout)\n  }\n  debounce(func: CallbackFunction, arg?: any, timeout = 1) {\n    debounce(func, arg, this, timeout)\n  }\n  onPropertyMutated(event: CustomEvent) {\n    return onPropertyMutated(this, event)\n  };\n  dispatchMutation(object: Object | Node = this, properties: string[] = []) {\n    if ((object as Node)._isNode || (object as IoElement)._isIoElement) {\n      this.dispatch('io-object-mutation', {object, properties})\n    } else {\n      this.dispatch('io-object-mutation', {object, properties}, false, window)\n    }\n  }\n  bind<T>(name: string): Binding<T> {\n    return bind<T>(this, name)\n  }\n  unbind(name: string): void {\n    unbind(this, name)\n  }\n  addEventListener(type: string, listener: AnyEventListener, options?: AddEventListenerOptions) {\n    if (this._disposed) return\n    this._eventDispatcher.addEventListener(type, listener as EventListener, options)\n  }\n  removeEventListener(type: string, listener?: AnyEventListener, options?: AddEventListenerOptions) {\n    if (this._disposed) return\n    this._eventDispatcher.removeEventListener(type, listener as EventListener, options)\n  }\n  dispatch(type: string, detail: any = undefined, bubbles = false, src?: Node | HTMLElement | Document | Window) {\n    if (this._disposed) return\n    this._eventDispatcher.dispatchEvent(type, detail, bubbles, src)\n  }\n  dispose() {\n    dispose(this)\n  }\n\n  connectedCallback() {\n    if (typeof (this as any).onResized === 'function') {\n      resizeObserver.observe(this)\n    }\n  }\n  disconnectedCallback() {\n    if (typeof (this as any).onResized === 'function') {\n      resizeObserver.unobserve(this)\n    }\n  }\n\n  /**\n   * Renders DOM from virtual DOM arrays.\n   * @param {Array} vDOMElements - Array of VDOMElement[] children.\n   * @param {HTMLElement} [host] - Optional template target.\n   * @param {boolean} [noDispose] - Skip disposal of existing elements.\n   */\n  render(vDOMElements: Array<VDOMElement | null>, host?: HTMLElement | IoElement, noDispose?: boolean) {\n    host = (host || this) as any\n    const vDOMElementsOnly = vDOMElements.filter(item => item !== null)\n    this.$ = {}\n    this.traverse(vDOMElementsOnly, host as HTMLElement, noDispose)\n  }\n  /**\n   * Recurively traverses virtual DOM elements.\n   * TODO: test element.traverse() function!\n   * @param {Array} vDOMElements - Array of VDOMElements elements.\n   * @param {HTMLElement} [host] - Optional template target.\n   * @param {boolean} [noDispose] - Skip disposal of existing elements.\n   */\n  traverse(vChildren: VDOMElement[], host: HTMLElement | IoElement, noDispose?: boolean) {\n    const children = host.children\n    // remove trailing elements\n    while (children.length > vChildren.length) {\n      const child = children[children.length - 1]\n      host.removeChild(child)\n      if (!noDispose) disposeChildren(child as IoElement)\n    }\n    // replace elements\n    for (let i = 0; i < children.length; i++) {\n      const child = children[i] as HTMLElement | IoElement\n      // replace existing elements\n      if (child.localName !== vChildren[i].tag || noDispose) {\n        const oldElement = child as HTMLElement\n        const element = constructElement(vChildren[i])\n        host.insertBefore(element, oldElement)\n        host.removeChild(oldElement)\n        if (!noDispose) disposeChildren(oldElement as IoElement)\n      // update existing elements\n      } else {\n        // TODO: improve setting/removal/cleanup of native element properties/attributes.\n        child.removeAttribute('className')\n        child.removeAttribute('style')\n        if (vChildren[i].props) {\n          if ((child as IoElement)._isIoElement) {\n            // Set IoElement element properties\n            (child as IoElement).applyProperties(vChildren[i].props as Record<keyof this, any>)\n          } else {\n            // Set native HTML element properties\n            applyNativeElementProps(child as HTMLElement, vChildren[i].props!)\n          }\n        }\n      }\n    }\n    // TODO: doing this before \"replace elements\" cached (noDispose) elements to be created twice.\n    // TODO: rename nodispose to dispose.\n    // TODO: test\n    // create new elements after existing\n    if (children.length < vChildren.length) {\n      const frag = document.createDocumentFragment()\n      for (let i = children.length; i < vChildren.length; i++) {\n        const element = constructElement(vChildren[i])\n        frag.appendChild(element)\n      }\n      host.appendChild(frag)\n    }\n    for (let i = 0; i < vChildren.length; i++) {\n      const vChild = vChildren[i]\n      const child = children[i] as HTMLElement | IoElement\n      if (vChild.props?.id) {\n        // Update this.$ map of ids.\n        debug: {\n          if (this.$[vChild.props!.id] !== undefined) {\n            console.warn('IoElement: Duplicate id in template.')\n          }\n        }\n        this.$[vChild.props!.id] = child\n      }\n      if (vChild.children !== undefined) { // TODO: test this! Look for more cases of truthy check bugs!\n        if (typeof vChild.children === 'string') {\n          // Set textNode value.\n          this._flattenTextNode(child as HTMLElement);\n          (child as IoElement)._textNode.nodeValue = String(vChild.children)\n        } else if (vChild.children instanceof Array) {\n          // Traverse deeper.\n          const vDOMElementsOnly = (vChild.children as Array<VDOMElement | null>).filter(item => item !== null)\n          this.traverse(vDOMElementsOnly, child as HTMLElement, noDispose)\n        }\n      }\n    }\n  }\n\n  /**\n  * Helper function to flatten textContent into a single TextNode.\n  * Update textContent via TextNode is better for layout performance.\n  * TODO: Consider using normalize()? Is it the same function?\n  * @param {HTMLElement} element - Element to flatten.\n  */\n  _flattenTextNode(element: HTMLElement | IoElement) {\n    if (element.childNodes.length === 0) {\n      element.appendChild(document.createTextNode(''))\n    }\n    if (element.childNodes[0].nodeName !== '#text') {\n      element.innerHTML = ''\n      element.appendChild(document.createTextNode(''))\n    }\n    (element as IoElement)._textNode = element.childNodes[0] as Text\n    if (element.childNodes.length > 1) {\n      const textContent = element.textContent\n      for (let i = element.childNodes.length; i--;) {\n        if (i !== 0) element.removeChild(element.childNodes[i])\n      }\n      (element as IoElement)._textNode.nodeValue = textContent\n    }\n  }\n  /**\n  * Alias for HTMLElement setAttribute where falsey values remove the attribute.\n  * @param {string} attr - Attribute name.\n  * @param {*} value - Attribute value.\n  */\n  setAttribute(attr: string, value: boolean | number | string) {\n    if (value === true) {\n      HTMLElement.prototype.setAttribute.call(this, attr, '')\n    } else if (value === false || value === '') {\n      this.removeAttribute(attr)\n    } else if (typeof value === 'string' || typeof value === 'number') {\n      if (this.getAttribute(attr) !== String(value)) HTMLElement.prototype.setAttribute.call(this, attr, String(value))\n    }\n  }\n  /**\n   * Returns a vDOM-like representation of the element with children and attributes. This feature is used in testing.\n   */\n  toVDOM() {\n    return toVDOM(this)\n  }\n  Register(ioNodeConstructor: typeof IoElement) {\n    Object.defineProperty(ioNodeConstructor.prototype, '_protochain', {value: new ProtoChain(ioNodeConstructor)})\n\n    const localName = ioNodeConstructor.name.replace(/([a-z])([A-Z,0-9])/g, '$1-$2').toLowerCase()\n\n    Object.defineProperty(ioNodeConstructor, 'localName', {value: localName})\n    Object.defineProperty(ioNodeConstructor.prototype, 'localName', {value: localName})\n\n    Object.defineProperty(ioNodeConstructor, '_isIoElement', {enumerable: false, value: true, writable: false})\n    Object.defineProperty(ioNodeConstructor.prototype, '_isIoElement', {enumerable: false, value: true, writable: false})\n    Object.defineProperty(window, ioNodeConstructor.name, {value: ioNodeConstructor})\n\n    window.customElements.define(localName, ioNodeConstructor as unknown as CustomElementConstructor)\n\n    applyElementStyleToDocument(localName, ioNodeConstructor.prototype._protochain.style)\n\n    // TODO: Define all overloads with type guards.\n    // TODO: Add runtime debug type checks.\n    // TODO: Test thoroughly.\n    Object.defineProperty(ioNodeConstructor, 'vConstructor', {value: function(arg0?: IoElementProps | Array<VDOMElement | null> | string, arg1?: Array<VDOMElement | null> | string): VDOMElement {\n      const vDOMElement: VDOMElement = {tag: localName}\n      if (arg0 !== undefined) {\n        if (typeof arg0 === 'string') {\n          vDOMElement.children = arg0\n        } else if (arg0 instanceof Array) {\n          vDOMElement.children = arg0\n        } else if (typeof arg0 === 'object') {\n          vDOMElement.props = arg0\n        }\n        if (arg1 !== undefined) {\n          if (typeof arg1 === 'string') {\n            vDOMElement.children = arg1\n          } else if (arg1 instanceof Array) {\n            vDOMElement.children = arg1\n          }\n        }\n      }\n      return vDOMElement\n    }})\n  }\n}\n\nexport const ioElement = IoElement.vConstructor","import { Register } from '../decorators/Register.js'\nimport { ProtoChain } from '../core/ProtoChain.js'\nimport { Binding } from '../core/Binding.js'\nimport { ChangeQueue } from '../core/ChangeQueue.js'\nimport { ReactivePropertyInstance, ReactivePropertyDefinitionLoose } from '../core/ReactiveProperty.js'\nimport { EventDispatcher, ListenerDefinitionLoose, AnyEventListener } from '../core/EventDispatcher.js'\nimport { NodeArray } from '../core/NodeArray.js'\nimport { throttle, debounce, CallbackFunction } from '../core/Queue.js'\nimport { ReactiveProperty } from '../decorators/Property.js'\nimport { IoElement } from '../elements/IoElement.js'\n\nexport type AnyConstructor = new (...args: any[]) => unknown\nexport type ReactivePropertyDefinitions = Record<string, ReactivePropertyDefinitionLoose>\n\nexport type ListenerDefinitions = {\n  [key: string]: ListenerDefinitionLoose\n}\nexport interface NodeConstructor {\n  ReactiveProperties?: ReactivePropertyDefinitions\n  Properties?: Record<string, any>\n  Listeners?: ListenerDefinitions\n  Style?: string\n  name?: string\n  prototype: NodeConstructor | Object | HTMLElement\n}\n\nexport const NODES = {\n  active: new Set<Node>(),\n  disposed: new Set<Node>(),\n}\n\nexport type ReactivityType = 'immediate' | 'throttled' | 'debounced'\n\n// Utility type to add Binding to all properties of a type\nexport type WithBinding<T> = T | Binding<T>\n\ntype prefix<TKey, TPrefix extends string> = TKey extends string ? `${TPrefix}${TKey}` : never\ntype AnyEventHandler = ((event: CustomEvent<any>) => void) | ((event: PointerEvent) => void) | ((event: KeyboardEvent) => void) | ((event: MouseEvent) => void) | ((event: TouchEvent) => void) | ((event: WheelEvent) => void) | ((event: InputEvent) => void) | ((event: ClipboardEvent) => void) | ((event: DragEvent) => void) | ((event: FocusEvent) => void) | ((event: TransitionEvent) => void) | ((event: AnimationEvent) => void) | ((event: ErrorEvent) => void) | ((event: Event) => void)\n\nexport type NodeProps = {\n  reactivity?: ReactivityType\n  [key: prefix<string, '@'>]: string | AnyEventHandler\n}\n\nfunction isNonNodeObject(value: any) {\n  return (typeof value === 'object' && value !== null && !value._isNode)\n}\n\n@Register\nexport class Node extends Object {\n\n  @ReactiveProperty({type: String, value: 'immediate'})\n  declare reactivity: ReactivityType\n\n  static get ReactiveProperties(): ReactivePropertyDefinitions {\n    return {}\n  }\n\n  static get Properties(): Record<string, any> {\n    return {}\n  }\n\n  static get Listeners(): ListenerDefinitions {\n    return {}\n  }\n\n  declare readonly _protochain: ProtoChain\n  declare readonly _reactiveProperties: Map<string, ReactivePropertyInstance>\n  declare readonly _bindings: Map<string, Binding<any>>\n  declare readonly _changeQueue: ChangeQueue\n  declare readonly _eventDispatcher: EventDispatcher\n  declare readonly _observedObjectProperties: string[]\n  declare readonly _observedNodeProperties: string[]\n  declare readonly _parents: Array<Node>\n  declare readonly _isNode: boolean\n  declare readonly _isIoElement: boolean\n  declare _disposed: boolean\n\n  constructor(args?: any) {\n    super()\n    this._protochain.init(this)\n\n    Object.defineProperty(this, '_changeQueue', {enumerable: false, configurable: true, value: new ChangeQueue(this)})\n    Object.defineProperty(this, '_reactiveProperties', {enumerable: false, configurable: true, value: new Map()})\n    Object.defineProperty(this, '_bindings', {enumerable: false, configurable: true, value: new Map()})\n    Object.defineProperty(this, '_eventDispatcher', {enumerable: false, configurable: true, value: new EventDispatcher(this)})\n    Object.defineProperty(this, '_observedObjectProperties', {enumerable: false, configurable: true, value: []})\n    Object.defineProperty(this, '_observedNodeProperties', {enumerable: false, configurable: true, value: []})\n    Object.defineProperty(this, '_parents', {enumerable: false, configurable: true, value: []})\n\n    this.init()\n\n    initReactiveProperties(this)\n    initProperties(this)\n\n    this.applyProperties(typeof args === 'object' ? args : {}, true)\n\n    NODES.active.add(this)\n\n    this.ready()\n    this.dispatchQueue()\n  }\n  // TODO: add types\n  applyProperties(props: any, skipDispatch = false) {\n    for (const name in props) {\n      if (this._reactiveProperties.has(name)) {\n        this.setProperty(name, props[name], true)\n      } else {\n        if (!name.startsWith('@')) {\n          this[name as keyof this] = props[name]\n          debug: if (props[name] instanceof Binding) {\n            console.warn(`IoElement: Not a ReactiveProperty! Cannot set binding to \"${name}\" property on \"${this.constructor.name}\"`)\n          }\n        }\n      }\n    }\n    this._eventDispatcher.applyPropListeners(props)\n    if (!skipDispatch) this.dispatchQueue()\n  }\n  // TODO: add types\n  setProperties(props: any) {\n    setProperties(this, props)\n  }\n  setProperty(name: string, value: any, debounce = false) {\n    if (this._disposed) return\n    setProperty(this, name, value, debounce)\n  }\n  init() {}\n  ready() {}\n  changed() {}\n  queue(name: string, value: any, oldValue: any) {\n    this._changeQueue.queue(name, value, oldValue)\n  }\n  dispatchQueue(debounce = false) {\n    dispatchQueue(this, debounce)\n  }\n  throttle(func: CallbackFunction, arg?: any, timeout = 1) {\n    throttle(func, arg, this, timeout)\n  }\n  debounce(func: CallbackFunction, arg?: any, timeout = 1) {\n    debounce(func, arg, this, timeout)\n  }\n  onPropertyMutated(event: CustomEvent) {\n    return onPropertyMutated(this, event)\n  };\n  dispatchMutation(object: Object | Node = this, properties: string[] = []) {\n    if ((object as Node)._isNode || (object as IoElement)._isIoElement) {\n      this.dispatch('io-object-mutation', {object, properties})\n    } else {\n      this.dispatch('io-object-mutation', {object, properties}, false, window)\n    }\n  }\n  bind<T>(name: string): Binding<T> {\n    return bind<T>(this, name)\n  }\n  unbind(name: string): void {\n    unbind(this, name)\n  }\n  addEventListener(type: string, listener: AnyEventListener, options?: AddEventListenerOptions) {\n    this._eventDispatcher.addEventListener(type, listener as EventListener, options)\n  }\n  removeEventListener(type: string, listener?: AnyEventListener, options?: AddEventListenerOptions) {\n    this._eventDispatcher.removeEventListener(type, listener as EventListener, options)\n  }\n  dispatch(type: string, detail: any = undefined, bubbles = false, src?: Node | HTMLElement | Document | Window) {\n    this._eventDispatcher.dispatchEvent(type, detail, bubbles, src)\n  }\n  // TODO: test!\n  addParent(parent: Node) {\n    if (parent._isNode) {\n      this._parents.push(parent)\n    }\n  }\n  removeParent(parent: Node) {\n    if (parent._isNode) {\n      debug: if (!this._parents.includes(parent)) {\n        console.error('Node.removeParent(): Parent not found!', parent)\n      }\n      this._parents.splice(this._parents.indexOf(parent), 1)\n    }\n  }\n  dispose() {\n    dispose(this)\n    NODES.active.delete(this)\n    NODES.disposed.add(this)\n  }\n  Register(ioNodeConstructor: typeof Node) {\n    Object.defineProperty(ioNodeConstructor, '_isNode', {enumerable: false, value: true, writable: false})\n    Object.defineProperty(ioNodeConstructor.prototype, '_isNode', {enumerable: false, value: true, writable: false})\n    Object.defineProperty(ioNodeConstructor, '_isIoElement', {enumerable: false, value: false, writable: false})\n    Object.defineProperty(ioNodeConstructor.prototype, '_isIoElement', {enumerable: false, value: false, writable: false})\n    Object.defineProperty(ioNodeConstructor.prototype, '_protochain', {value: new ProtoChain(ioNodeConstructor)})\n  }\n}\n\nexport function initReactiveProperties(node: Node | IoElement) {\n  for (const name in node._protochain.reactiveProperties) {\n    Object.defineProperty(node, name, {\n      get: function() {\n        return node._reactiveProperties.get(name)!.value\n      },\n      set: function(value) {\n        node.setProperty(name, value)\n      },\n      configurable: true,\n      enumerable: true,\n    })\n    const property = new ReactivePropertyInstance(node, node._protochain.reactiveProperties[name])\n    node._reactiveProperties.set(name, property)\n    if (property.binding) property.binding.addTarget(node, name)\n\n    observeObjectProperty(node, name, property)\n    observeNodeProperty(node, name, property)\n\n    if (node instanceof IoElement) {\n      if (property.reflect && property.value !== undefined && property.value !== null) {\n        node.setAttribute(name, property.value)\n      }\n    }\n  }\n}\nexport function initProperties(node: Node | IoElement) {\n  for (const name in node._protochain.properties) {\n    let initialValue = node._protochain.properties[name]\n    if (typeof initialValue === 'function') {\n      initialValue = new initialValue()\n    } else if (initialValue instanceof Array) {\n      initialValue = initialValue.slice()\n    } else if (typeof initialValue === 'object') {\n      initialValue = Object.assign({}, initialValue)\n    }\n    (node as any)[name] = initialValue\n  }\n}\nexport function setProperties(node: Node | IoElement, props: any) {\n  for (const name in props) {\n    if (!node._reactiveProperties.has(name)) {\n      debug: console.warn(`Property \"${name}\" is not defined`, node)\n      continue\n    }\n    node.setProperty(name, props[name], true)\n  }\n  node.dispatchQueue()\n}\nexport function setProperty(node: Node | IoElement, name: string, value: any, debounce = false) {\n  const prop = node._reactiveProperties.get(name)!\n  const oldValue = prop.value\n\n  if (value !== oldValue) {\n    const binding = (value instanceof Binding) ? value : null\n    if (binding) {\n      const oldBinding = prop.binding\n      if (binding !== oldBinding) {\n        if (oldBinding) {\n          oldBinding.removeTarget(node, name)\n        }\n        binding.addTarget(node, name)\n        // NOTE: We return here because binding.setTarget() will trigger execution of setProperty() again.\n        return\n      } else {\n        // NOTE: This was a remedy for an old bug that might not be relevant anymore.\n        // Whenusing change() > template() > setProperties() to batch-set multiple properties with bindings,\n        // it used to cause all but one of those properties to be reset to original value once parent changed.\n        // This ugly hack fixed the bug by setting binding value from target when binding already exists.\n        // TODO: keep an eye on this and remove if not needed.\n        // binding.value = value = prop.value;\n        return\n      }\n    }\n\n    observeObjectProperty(node, name, prop)\n\n    // TODO: test!\n    // TODO: Document magic!\n    if (prop.type === NodeArray && value.constructor === Array) {\n      const nodeArray = prop.value as NodeArray<Node>\n\n      debug: if ((value as Array<any>).some(item => !item._isNode)) {\n        console.error(`Node: Property \"${name}\" should be assigned as an Array of nodes!`, value)\n      }\n      debug: if (nodeArray.constructor !== NodeArray) {\n        console.error(`Node: Property \"${name}\" should be initialized as a NodeArray!`, nodeArray)\n      }\n\n      // TODO: test, benchmark!\n      nodeArray.withInternalOperation(() => {\n        nodeArray.length = 0\n        nodeArray.push(...value as Array<Node>)\n        if (value.length === 0) {\n          nodeArray.dispatchMutation()\n        }\n      })\n      return\n    }\n\n    prop.value = value\n\n    // TODO: test!\n    if (value !== oldValue) {\n      let hasNewValueAtOtherProperty = false\n      let hasOldValueAtOtherProperty = false\n      node._reactiveProperties.forEach((property, n) => {\n        if (property.value === value && n !== name) hasNewValueAtOtherProperty = true\n        if (property.value === oldValue && n !== name) hasOldValueAtOtherProperty = true\n      })\n      if (value?._isNode && !hasNewValueAtOtherProperty) {\n        node._observedNodeProperties.push(name)\n        value.addEventListener('io-object-mutation', node.onPropertyMutated)\n        value.addParent(node)\n      }\n      if (oldValue?._isNode && !hasOldValueAtOtherProperty && !oldValue._disposed) {\n        node._observedNodeProperties.splice(node._observedNodeProperties.indexOf(name), 1)\n        oldValue.removeEventListener('io-object-mutation', node.onPropertyMutated)\n        oldValue.removeParent(node)\n      }\n    }\n\n    debug: {\n      if (prop.type === String) {\n        if (typeof value !== 'string') {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      } else if (prop.type === Number) {\n        if (typeof value !== 'number') {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      } else if (prop.type === Boolean) {\n        if (typeof value !== 'boolean') {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      } else if (prop.type === Array) {\n        if (!(value instanceof Array)) {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      } else if (prop.type === Object) {\n        if (value instanceof Array) {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${JSON.stringify(value)}\". Expected type: ${prop.type.name}`, node)\n        }\n      } else if (prop.type === NodeArray) {\n        if (!(value instanceof NodeArray)) {\n          console.error(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n        if ((value as Array<any>).some(item => !item._isNode)) {\n          console.error(`Wrong type of property \"${name}\". NodeArray items should be nodes!`, value)\n        }\n      } else if (typeof prop.type === 'function') {\n        if (!(value instanceof prop.type)) {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      }\n    }\n    if (oldValue !== value) {\n      node.queue(name, value, oldValue)\n      node.dispatchQueue(debounce)\n    }\n  }\n}\nexport function dispatchQueue(node: Node | IoElement, debounce = false) {\n  if (node.reactivity === 'debounced' || debounce || node._changeQueue.dispatching) {\n    node.debounce(node._changeQueue.dispatch)\n  } else if (node.reactivity === 'throttled') {\n    node.throttle(node._changeQueue.dispatch)\n  } else if (node.reactivity === 'immediate') {\n    node._changeQueue.dispatch()\n  }\n  debug: if (['immediate', 'throttled', 'debounced'].indexOf(node.reactivity) === -1) {\n    console.warn(`Node.dispatchQueue(): Invalid reactivity property value: \"${node.reactivity}\". Expected one of: \"immediate\", \"throttled\", \"debounced\".`)\n  }\n}\nexport function onPropertyMutated(node: Node | IoElement, event: CustomEvent) {\n  const object = event.detail.object\n\n  let hasMutated = false\n  // TODO: consider situations where node is listening to io-object-mutation events from multiple sources (window and property).\n  // This might cause multiple executions of the same handler.\n  // TODO: consider optimizing. This handler might be called a lot.\n  const properties = [...new Set([...node._observedObjectProperties, ...node._observedNodeProperties])]\n  for (let i = 0; i < properties.length; i++) {\n    const name = properties[i]\n    const value = node._reactiveProperties.get(name)!.value\n\n    if (value === object) {\n      const handlerName = name + 'Mutated' as keyof Node\n      if (typeof (node as Node)[handlerName] === 'function') {\n        // node.throttle(node[handlerName] as CallbackFunction, event);\n        (node as any)[handlerName](event) //TODO: Check for regressions.\n      }\n      hasMutated = true\n    }\n  }\n  return hasMutated\n}\nexport function observeObjectProperty(node: Node | IoElement, name: string, property: ReactivePropertyInstance) {\n  if (!node._observedObjectProperties.includes(name)) {\n    if(isNonNodeObject(property.value)) {\n      node._observedObjectProperties.push(name)\n      if (node._observedObjectProperties.length === 1) {\n        window.addEventListener('io-object-mutation', node.onPropertyMutated as unknown as EventListener)\n      }\n    }\n  }\n}\n\nexport function observeNodeProperty(node: Node | IoElement, name: string, property: ReactivePropertyInstance) {\n  if (property.value?._isNode) {\n    let hasSameValueAtOtherProperty = false\n    node._reactiveProperties.forEach((p, n) => {\n      if (p.value === property.value && n !== name) hasSameValueAtOtherProperty = true\n    })\n    if (!hasSameValueAtOtherProperty) {\n      node._observedNodeProperties.push(name)\n      property.value.addEventListener('io-object-mutation', node.onPropertyMutated)\n    }\n  }\n}\n\nexport function bind<T>(node: Node | IoElement, name: string) {\n  debug: if (!node._reactiveProperties.has(name)) {\n    console.warn(`IoGUI Node: cannot bind to ${name} property. Does not exist!`)\n  }\n  if (!node._bindings.has(name)) {\n    node._bindings.set(name, new Binding<T>(node, name))\n  }\n  return node._bindings.get(name)! as Binding<T>\n}\nexport function unbind(node: Node | IoElement, name: string) {\n  const binding = node._bindings.get(name)\n  if (binding) {\n    binding.dispose()\n    node._bindings.delete(name)\n  }\n  const property = node._reactiveProperties.get(name)\n  property?.binding?.removeTarget(node, name)\n}\nexport function dispose(node: Node | IoElement) {\n  debug: if (node._disposed) {\n    console.warn('Node.dispose(): Already disposed!', node.constructor.name)\n  }\n\n  if (node._disposed) return\n\n  node._bindings.forEach((binding, name) => {\n    binding.dispose()\n    node._bindings.delete(name)\n  })\n  delete (node as any)._bindings\n\n  if (node._observedObjectProperties.length) {\n    window.removeEventListener('io-object-mutation', node.onPropertyMutated as unknown as EventListener)\n    node._observedObjectProperties.length = 0\n    delete (node as any)._observedObjectProperties\n  }\n  delete (node as any)._protochain\n\n  node._changeQueue.dispose()\n  delete (node as any)._changeQueue\n\n  let removed: Node[] = []\n  node._reactiveProperties.forEach((property, name) => {\n    property.binding?.removeTarget(node, name)\n    if (property.value?._isNode && !removed.includes(property.value) && !property.value._disposed) {\n      property.value.removeEventListener('io-object-mutation', node.onPropertyMutated)\n      removed.push(property.value)\n    }\n  })\n\n  for (const name in node._protochain.properties) {\n    delete (node as Node)[name as keyof Node]\n  }\n\n  // NOTE: _eventDispatcher.dispose must happen AFTER disposal of bindings!\n  node._eventDispatcher.dispose()\n  delete (node as any)._eventDispatcher\n  delete (node as any)._reactiveProperties\n\n  if ((node as any)._parents) {\n    (node as any)._parents.length = 0\n    delete (node as any)._parents\n  }\n\n  Object.defineProperty(node, '_disposed', {value: true})\n};","import { ReactiveProperty } from '../decorators/Property.js'\nimport { Register } from '../decorators/Register.js'\nimport { Binding } from '../core/Binding.js'\nimport { Node, NodeProps, AnyConstructor } from '../nodes/Node.js'\n\nclass EmulatedLocalStorage {\n  declare store: Map<string, unknown>\n  declare warned: boolean\n  constructor() {\n    Object.defineProperty(this, 'store', {value: new Map()})\n    Object.defineProperty(this, 'warned', {value: false, writable: true})\n  }\n  get permitted(): boolean {\n    try {\n      return self.localStorage.getItem('Storage:user-permitted') === 'true'\n    } catch (error) {\n      console.warn('Storage: Cannot access localStorage. Check browser privacy settings!')\n    }\n    return false\n  }\n  set permitted(permitted: boolean) {\n    try {\n      if (permitted) {\n        console.info('Storage: localStorage permission granted.')\n        this.store.set('Storage:user-permitted', String(permitted))\n        this.store.forEach((value: unknown, key: string) => {\n          self.localStorage.setItem(key, String(value))\n          this.store.delete(key)\n        })\n      } else {\n        console.info('Storage: localStorage permission revoked.')\n        self.localStorage.setItem('Storage:user-permitted', String(permitted))\n        new Map(Object.entries(self.localStorage)).forEach((value: unknown, key: string) => {\n          this.store.set(key, value)\n        })\n        self.localStorage.clear()\n      }\n    } catch (error) {\n      console.warn('Storage: Cannot access localStorage. Check browser privacy settings!')\n    }\n  }\n  setItem(key: string, value: unknown) {\n    const strValue = typeof value === 'object' ? JSON.stringify(value) : String(value)\n    if (key === 'Storage:user-permitted') {\n      this.permitted = value === 'true'\n      return\n    }\n    if (this.permitted) {\n      self.localStorage.setItem(key, strValue)\n    } else {\n      this.store.set(key, strValue)\n      if (!this.warned && !this.permitted) {\n        console.warn('Storage: localStorage permission not set.')\n        this.warned = true\n      }\n    }\n  }\n  getItem(key: string): string | null {\n    if (this.permitted) {\n      return self.localStorage.getItem(key)\n    } else if (this.store.has(key)) {\n      return this.store.get(key) as string\n    }\n    return null\n  }\n  removeItem(key: string) {\n    if (this.permitted) {\n      return self.localStorage.removeItem(key)\n    } else {\n      this.store.delete(key)\n    }\n  }\n  clear() {\n    if (this.permitted) {\n      return self.localStorage.clear()\n    } else {\n      this.store.clear()\n    }\n  }\n}\n\nconst localStorage = new EmulatedLocalStorage()\n\ntype StorageNodes = {\n  local: Map<string, StorageNode>\n  hash: Map<string, StorageNode>\n}\n\nconst nodes: StorageNodes = {\n  local: new Map(),\n  hash: new Map(),\n}\n\nlet hashValues: Record<string, any> = {}\n\nexport type StorageProps = NodeProps & {\n  key: string\n  value: any\n  storage?: 'hash' | 'local'\n}\n\n@Register\nexport class StorageNode extends Node {\n\n  @ReactiveProperty({value: '', type: String})\n  declare key: string\n\n  @ReactiveProperty()\n  declare value: any\n\n  @ReactiveProperty({value: 'local', type: String})\n  declare storage: 'hash' | 'local'\n\n  declare binding: Binding<any>\n\n  declare default: any\n\n  constructor(props: StorageProps) {\n    debug: {\n      if (typeof props !== 'object') {\n        console.warn('Ivalid Storage arguments!')\n      } else {\n        if (typeof props.key !== 'string' || !props.key)\n          console.warn('Ivalid Storage key!')\n        if (props.storage && ['hash', 'local'].indexOf(props.storage) === -1)\n          console.warn('Ivalid Storage storage!')\n      }\n    }\n\n    if (props.storage === undefined) props.storage = 'local'\n    if (nodes[props.storage].has(props.key)) {\n      return nodes[props.storage].get(props.key)!\n    } else {\n      let def: any\n      // TODO: test!\n      let constructor: AnyConstructor | undefined\n      if (typeof props.value === 'object' && props.value !== null) {\n        constructor = props.value.constructor as AnyConstructor\n        def = JSON.stringify(props.value)\n      } else {\n        def = props.value\n      }\n\n      let storedValue: string | null = null\n      switch (props.storage) {\n        case 'hash':\n          storedValue = getValueFromHash(props.key)\n          break\n        case 'local':\n          storedValue = localStorage.getItem('Storage:' + props.key)\n          break\n      }\n      if (storedValue !== null) {\n        try {\n          const value = JSON.parse(storedValue)\n          props.value = constructor ? new constructor(value) : value\n        } catch (error) {\n          props.value = storedValue\n        }\n      }\n\n      super(props)\n\n      this.valueMutatedDebounced = this.valueMutatedDebounced.bind(this)\n\n      this.default = def\n\n      this.binding = this.bind('value')\n      this.binding.dispose = () => {\n        this.clearStorage()\n      }\n\n      if (props.key !== '__proto__') { // TODO: Why is this here ffs?\n        nodes[props.storage].set(props.key, this)\n      }\n\n      return this\n    }\n  }\n  dispose() {\n    this.clearStorage()\n    super.dispose()\n  }\n  clearStorage() {\n    switch (this.storage) {\n      case 'hash': {\n        this.removeValueToHash()\n        break\n      }\n      case 'local': {\n        localStorage.removeItem('Storage:' + this.key)\n        break\n      }\n    }\n    const s = (this.storage) as keyof StorageNodes\n    nodes[s].delete(this.key)\n  }\n  valueMutated() {\n    this.debounce(this.valueMutatedDebounced)\n  }\n  valueMutatedDebounced() {\n    this.valueChanged()\n  }\n  valueChanged() {\n    switch (this.storage) {\n      case 'hash': {\n        this.saveValueToHash()\n        break\n      }\n      case 'local': {\n        if (this.value === null || this.value === undefined || (this.value === this.default && typeof this.value !== 'object')) {\n          localStorage.removeItem('Storage:' + this.key)\n        } else {\n          localStorage.setItem('Storage:' + this.key, JSON.stringify(this.value))\n        }\n        break\n      }\n    }\n  }\n  removeValueToHash() {\n    hashValues = parseHash(self.location.hash)\n    delete hashValues[this.key]\n\n    let hashString = ''\n    for (const h in hashValues) {\n      hashString += h + '=' + hashValues[h] + '&'\n    }\n    if (hashString) {\n      hashString = hashString.slice(0, -1)\n      self.location.hash = hashString\n    } else {\n      history.replaceState('', document.title, self.location.pathname + self.location.search)\n    }\n  }\n  saveValueToHash() {\n    hashValues = parseHash(self.location.hash)\n\n    const value = this.value\n    if (value !== undefined && value !== '' && value !== this.default) {\n      if (typeof value === 'string') {\n        if (isNaN(value as unknown as number)) {\n          hashValues[this.key] = value\n        } else {\n          hashValues[this.key] = '\"' + value + '\"'\n        }\n      } else {\n        hashValues[this.key] = JSON.stringify(value)\n      }\n    } else {\n      delete hashValues[this.key]\n    }\n\n    let hashString = ''\n    for (const h in hashValues) {\n      hashString += h + '=' + hashValues[h] + '&'\n    }\n    if (hashString) {\n      hashString = hashString.slice(0, -1)\n      self.location.hash = hashString\n    } else {\n      history.replaceState('', document.title, self.location.pathname + self.location.search)\n    }\n  }\n}\n\n\nexport const Storage = Object.assign(\n  (props: StorageProps) => {\n    const storageNode = new StorageNode(props)\n    return storageNode.binding\n  }, {\n    permit() {\n      localStorage.permitted = true\n    },\n    unpermit() {\n      localStorage.permitted = false\n    }\n  }\n)\n\n// TODO: unhack and test\nfunction parseHash(hash: string) {\n  return hash.substring(1).split('&').reduce(function (result: Record<string, string>, item) {\n    const parts = item.split('=')\n    if (parts[0] && parts[1]) {\n      result[parts[0]] = parts[1].replace(/%22/g, '\"').replace(/%20/g, ' ')\n    }\n    return result\n  }, {})\n}\n\nfunction getValueFromHash(key: string) {\n  hashValues = parseHash(self.location.hash)\n  return hashValues[key] || null\n}\n\nfunction updateAllFromHash() {\n  hashValues = parseHash(self.location.hash)\n  for (const h in hashValues) {\n    if (nodes.hash.has(h)) {\n      const node = nodes.hash.get(h) as StorageNode\n      try {\n        node.value = JSON.parse(hashValues[h])\n      } catch (error) {\n        node.value = hashValues[h]\n      }\n    }\n  }\n\n  for (const [key, node] of nodes.hash.entries()) {\n    if (hashValues[key] === undefined) {\n      node.value = node.default\n    }\n  }\n}\n\nself.addEventListener('hashchange', updateAllFromHash, false)\nupdateAllFromHash()\n","import { Register } from '../decorators/Register.js'\nimport { ReactiveProperty } from '../decorators/Property.js'\nimport { ReactivePropertyDefinitions, Node, ReactivityType } from '../nodes/Node.js'\nimport { Storage as $ } from '../nodes/Storage.js'\n\nconst THEME_VERSION = 'v0.11'\nconst styleElement = document.createElement('style')\nstyleElement.setAttribute('id', 'io-theme-variables-' + THEME_VERSION)\ndocument.head.appendChild(styleElement)\n\nexport class Color {\n  r: number\n  g: number\n  b: number\n  a: number\n  constructor(r: number, g: number, b: number, a: number) {\n    this.r = r\n    this.g = g\n    this.b = b\n    this.a = a\n  }\n  toCss() {\n    const r = Math.floor(this.r * 255)\n    const g = Math.floor(this.g * 255)\n    const b = Math.floor(this.b * 255)\n    if (this.a !== undefined && this.a !== 1) {\n      return `rgba(${r}, ${g}, ${b}, ${this.a})`\n    } else {\n      return `rgb(${r}, ${g}, ${b})`\n    }\n  }\n}\n\nexport type ThemeVars = {\n  spacing: number\n  spacing2: number\n  spacing3: number\n  spacing5: number\n  spacing8: number\n\n  fontSize: number\n  lineHeight: number\n  fieldHeight: number\n\n  borderRadius: number\n  borderWidth: number\n  borderColor: Color\n  borderColorLight: Color\n  borderColorStrong: Color\n  borderColorRed: Color\n  borderColorBlue: Color\n  borderColorGreen: Color\n\n  bgColor: Color\n  bgColorStrong: Color\n  bgColorLight: Color\n  bgColorRed: Color\n  bgColorGreen: Color\n  bgColorBlue: Color\n  bgColorInput: Color\n\n  color: Color\n  colorStrong: Color\n  colorLight: Color\n  colorRed: Color\n  colorGreen: Color\n  colorBlue: Color\n  colorWhite: Color\n  colorInput: Color\n\n  gradientColorStart: Color\n  gradientColorEnd: Color\n\n  shadowColor: Color\n}\n\nexport const LIGHT_THEME: ThemeVars = {\n  spacing: 2,\n  spacing2: 0,\n  spacing3: 0,\n  spacing5: 0,\n  spacing8: 0,\n\n  lineHeight: 20,\n  fontSize: 14,\n  fieldHeight: 0,\n\n  borderRadius: 2,\n  borderWidth: 1,\n  borderColor: new Color(0.2, 0.2, 0.2, 1),\n  borderColorLight: new Color(0.3, 0.3, 0.3, 1),\n  borderColorStrong: new Color(0.6, 0.6, 0.6, 1),\n  borderColorRed: new Color(1, 0.35, 0.15, 1),\n  borderColorGreen: new Color(0.1, 0.7, 0.2, 1),\n  borderColorBlue: new Color(0.2, 0.4, 0.95, 1),\n\n  bgColor: new Color(0.85, 0.85, 0.85, 1),\n  bgColorStrong: new Color(0.9, 0.9, 0.9, 1),\n  bgColorLight: new Color(0.8, 0.8, 0.8, 1),\n  bgColorRed: new Color(1, 0.5, 0.3, 1),\n  bgColorGreen: new Color(0.2, 0.9, 0.3, 1),\n  bgColorBlue: new Color(0.2, 0.5, 0.9, 1),\n  bgColorInput: new Color(0.95, 0.96, 0.95, 1),\n\n  color: new Color(0.25, 0.25, 0.2, 1),\n  colorStrong: new Color(0, 0, 0, 1),\n  colorLight: new Color(0.6, 0.6, 0.6, 1),\n  colorRed: new Color(1, 0.2, 0.0, 1),\n  colorGreen: new Color(0, 0.6, 0.1, 1),\n  colorBlue: new Color(0.2, 0.3, 1, 1),\n  colorWhite: new Color(1, 1, 1, 1),\n  colorInput: new Color(0, 0.05, 0.02, 1),\n\n  gradientColorStart: new Color(0.9, 0.9, 0.9, 1),\n  gradientColorEnd: new Color(0.75, 0.75, 0.75, 1),\n\n  shadowColor: new Color(0, 0, 0, 0.2),\n}\n\nexport const DARK_THEME: ThemeVars = {\n  spacing: 2,\n  spacing2: 0,\n  spacing3: 0,\n  spacing5: 0,\n  spacing8: 0,\n\n  lineHeight: 20,\n  fontSize: 14,\n  fieldHeight: 0,\n\n  borderRadius: 2,\n  borderWidth: 1,\n  borderColor: new Color(0.5, 0.5, 0.5, 1),\n  borderColorLight: new Color(0.3, 0.3, 0.3, 1),\n  borderColorStrong: new Color(0, 0, 0, 1),\n  borderColorRed: new Color(1, 0.2, 0.0, 1),\n  borderColorBlue: new Color(0.4, 0.5, 0.9, 1),\n  borderColorGreen: new Color(0, 0.6, 0.1, 1),\n\n  bgColor: new Color(0.2, 0.2, 0.2, 1),\n  bgColorStrong: new Color(0.15, 0.15, 0.15, 1),\n  bgColorLight: new Color(0.25, 0.25, 0.25, 1),\n  bgColorRed: new Color(0.7, 0.2, 0.1, 1),\n  bgColorGreen: new Color(0.1, 0.5, 0.2, 1),\n  bgColorBlue: new Color(0.2, 0.4, 0.8, 1),\n  bgColorInput: new Color(0.02, 0.02, 0.02, 1),\n\n  color: new Color(0.6, 0.6, 0.6, 1),\n  colorStrong: new Color(0.86, 0.86, 0.86, 1),\n  colorLight: new Color(0.3, 0.3, 0.3, 1),\n  colorRed: new Color(1, 0.4, 0.4, 1),\n  colorGreen: new Color(0.4, 0.95, 0.3, 1),\n  colorBlue: new Color(0.6, 0.9, 1, 1),\n  colorWhite: new Color(1, 1, 1, 1),\n  colorInput: new Color(0.65, 0.7, 0.68, 1),\n\n  gradientColorStart: new Color(0.45, 0.45, 0.45, 1),\n  gradientColorEnd: new Color(0.2, 0.2, 0.2, 1),\n\n  shadowColor: new Color(0, 0, 0, 0.2),\n}\n\nconst $ThemeID = $({\n  value: window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light',\n  storage: 'local',\n  key: 'theme-' + THEME_VERSION\n})\n\nconst $Themes = $({\n  value: {},\n  storage: 'local',\n  key: 'io-themes-' + THEME_VERSION\n})\n\nconst compositeVariables = /* css */`\n  body {\n    --io_border: var(--io_borderWidth) solid var(--io_borderColor);\n    --io_borderColorInset: var(--io_borderColorStrong) var(--io_borderColorLight) var(--io_borderColorLight) var(--io_borderColorStrong);\n    --io_borderColorOutset: var(--io_borderColorLight) var(--io_borderColorStrong) var(--io_borderColorStrong) var(--io_borderColorLight);\n    --io_gradientOutset: linear-gradient(180deg, var(--io_gradientColorStart), var(--io_gradientColorEnd) 100%);\n    --io_gradientInset: linear-gradient(0deg, var(--io_gradientColorStart), var(--io_gradientColorEnd) 150%);\n    --io_shadow: 2px 2px 6px var(--io_shadowColor), 1px 1px 1px var(--io_shadowColor);\n    --io_shadowInset: 0.75px 0.75px 2px inset var(--io_shadowColor);\n    --io_shadowOutset: 1px 1px 2px var(--io_shadowColor);\n  }\n`\n\n/**\n * `Theme` is designed to be used as `ThemeSingleton`. It holds top-level CSS variables for Io-Gui design system.\n * CSS Variables are grouped in different themes and can be collectively switched by changing `theme` property.\n *\n * ```javascript\n * ThemeSingleton.themeID = 'dark';\n * ```\n *\n * CSS color variables such as `'--io_color'` and `'--io_bgColor'` are mapped to numeric properties `io_color` and `io_bgColor`.\n */\n@Register\nexport class Theme extends Node {\n  static get ReactiveProperties(): ReactivePropertyDefinitions {\n    const props: ReactivePropertyDefinitions = {}\n    for (const p in LIGHT_THEME) {\n      const prop = LIGHT_THEME[p as keyof typeof LIGHT_THEME]\n      if (prop instanceof Object) {\n        props[p] = {value: prop, type: Color, init: null}\n      } else {\n        props[p] = prop\n      }\n    }\n    return props\n  }\n\n  declare spacing: number\n  declare spacing2: number\n  declare spacing3: number\n  declare spacing5: number\n  declare spacing8: number\n  declare lineHeight: number\n  declare fontSize: number\n  declare fieldHeight: number\n  declare borderRadius: number\n  declare borderWidth: number\n  declare borderColor: Color\n  declare borderColorLight: Color\n  declare borderColorStrong: Color\n  declare borderColorRed: Color\n  declare borderColorGreen: Color\n  declare borderColorBlue: Color\n  declare bgColor: Color\n  declare bgColorStrong: Color\n  declare bgColorLight: Color\n  declare bgColorRed: Color\n  declare bgColorGreen: Color\n  declare bgColorBlue: Color\n  declare bgColorInput: Color\n  declare color: Color\n  declare colorStrong: Color\n  declare colorLight: Color\n  declare colorRed: Color\n  declare colorGreen: Color\n  declare colorBlue: Color\n  declare colorWhite: Color\n  declare colorInput: Color\n  declare gradientColorStart: Color\n  declare gradientColorEnd: Color\n  declare shadowColor: Color\n\n  // Default theme values\n  @ReactiveProperty({type: Object, init: null})\n  declare themeDefaults: Record<string, ThemeVars>\n\n  @ReactiveProperty({type: String, binding: $ThemeID})\n  declare themeID: string\n\n  @ReactiveProperty('debounced')\n  declare reactivity: ReactivityType\n\n  ready() {\n    this.registerTheme('light', LIGHT_THEME)\n    this.registerTheme('dark', DARK_THEME)\n    this.themeIDChanged()\n  }\n  registerTheme(themeID: string, theme: ThemeVars) {\n    // Save default theme\n    this.themeDefaults[themeID] = theme\n    this.setProperty('themeDefaults', JSON.parse(JSON.stringify(this.themeDefaults)), true)\n    // Save persistant theme\n    $Themes.value[themeID] = $Themes.value[themeID] || theme\n    $Themes.value = JSON.parse(JSON.stringify($Themes.value))\n  }\n  reset() {\n    // Load persistant themes from default themes\n    $Themes.value = JSON.parse(JSON.stringify(this.themeDefaults))\n    this.themeIDChanged()\n  }\n  themeIDChanged() {\n    const values = $Themes.value[this.themeID]\n    for (const p in values) {\n      if (values[p] instanceof Object && JSON.stringify(Object.keys(values[p])) === '[\"r\",\"g\",\"b\",\"a\"]') {\n         values[p] = new Color(values[p].r, values[p].g, values[p].b, values[p].a)\n      }\n    }\n    this.setProperties(values)\n  }\n\n  onPropertyMutated(event: CustomEvent) {\n    // TODO: Add properties to mutation handler.\n    const mutated = super.onPropertyMutated(event)\n    if (mutated) {\n      this.changed()\n      this.dispatchMutation()\n      return true\n    }\n    return false\n  }\n  fontSizeChanged() {\n    this.lineHeight = Math.max(this.fontSize, this.lineHeight)\n  }\n  lineHeightChanged() {\n    this.fontSize = Math.min(this.lineHeight, this.fontSize)\n  }\n  changed() {\n    this.fieldHeight = this.lineHeight + 2 * (this.spacing + this.borderWidth)\n\n    this.spacing2 = this.spacing * 2\n    this.spacing3 = this.spacing * 3\n    this.spacing5 = this.spacing * 5\n    this.spacing8 = this.spacing * 8\n\n    const propertyVariables = Array.from(Object.keys(LIGHT_THEME) as Array<keyof ThemeVars>).reduce(\n      (result, prop) => {\n        $Themes.value[this.themeID][prop] = this[prop]\n        if (typeof this[prop] === 'object') {\n          return `${result}--io_${prop}: ${this[prop].toCss()};\\n    `\n        } else {\n          return `${result}--io_${prop}: ${this[prop]}px;\\n    `\n        }\n      }, '')\n\n      styleElement.innerHTML = /* css */`body {\\n  ${propertyVariables}\\n}\\n${compositeVariables}`\n      this.debounce(this.onSaveTheme, undefined, 60)\n  }\n  onSaveTheme() {\n    $Themes.value = JSON.parse(JSON.stringify($Themes.value))\n  }\n}\n\nconst ThemeSingleton = new Theme()\nexport { ThemeSingleton }","const saturate = /* glsl */`\n  #ifndef saturate\n    #define saturate(v) clamp(v, 0., 1.)\n  #endif\n`\n\n// Transform functions\nconst translate = /* glsl */`\n  vec2 translate(vec2 samplePosition, vec2 xy){\n    return samplePosition - vec2(xy.x, xy.y);\n  }\n  vec2 translate(vec2 samplePosition, float x, float y){\n    return samplePosition - vec2(x, y);\n  }\n`\n\n// SDF functions\nconst circle = /* glsl */`\n  float circle(vec2 samplePosition, float radius){\n    return saturate((length(samplePosition) - radius) * uPxRatio);\n  }\n`\nconst rectangle = /* glsl */`\n  float rectangle(vec2 samplePosition, vec2 halfSize){\n    vec2 edgeDistance = abs(samplePosition) - halfSize;\n    float outside = length(max(edgeDistance, 0.));\n    float inside = min(max(edgeDistance.x, edgeDistance.y), 0.);\n    return 1.0 - saturate((outside + inside) * 1000000.0);\n  }\n`\nconst paintDerivativeGrid2D = /* glsl*/`\n  float paintDerivativeGrid2D(vec2 samplePosition, vec2 gridWidth, float lineWidth) {\n    vec2 sp = samplePosition / gridWidth;\n    float fractx = abs(fract(sp.x - 0.5) - 0.5) * 2.0;\n    float fracty = abs(fract(sp.y - 0.5) - 0.5) * 2.0;\n\n    float sx = ((sp.x - 0.5) - 0.5) * 2.0;\n    float sy = ((sp.y - 0.5) - 0.5) * 2.0;\n    \n    float absx = abs(max(dFdx(sx), dFdy(sx)));\n    float absy = abs(max(dFdy(sy), dFdx(sy)));\n\n    float fadeX = 1.0 - dFdx(sx);\n    float fadeY = 1.0 - dFdy(sx);\n    if (fadeX <= 0.0 || fadeY <= 0.0) return 1.0;\n\n    float linex = fractx / absx - (0.5 * max(uPxRatio, 2.0) * lineWidth - 1.0) - 0.5;\n    float liney = fracty / absy - (0.5 * max(uPxRatio, 2.0) * lineWidth - 1.0) - 0.5;\n\n    return (1.0 - saturate(min(linex, liney)));\n  }\n`\nconst lineVertical = /* glsl*/`\n  float lineVertical(vec2 samplePosition, float lineWidth) {\n    return (abs(samplePosition.x) * 2.0 > lineWidth) ? 0.0 : 1.0;\n  }\n`\nconst lineHorizontal = /* glsl*/`\n  float lineHorizontal(vec2 samplePosition, float lineWidth) {\n    return (abs(samplePosition.y) * 2.0 > lineWidth) ? 0.0 : 1.0;\n  }\n`\nconst lineCross2d = /* glsl*/`\n  float lineCross2d(vec2 samplePosition, float lineWidth) {\n    return (min(abs(samplePosition.x), abs(samplePosition.y)) * 2.0 > lineWidth) ? 0.0 : 1.0;\n  }\n`\nconst checker = /* glsl*/`\n  float checker(vec2 samplePosition, float size) {\n    vec2 checkerPos = floor(samplePosition / size);\n    float checkerMask = mod(checkerPos.x + mod(checkerPos.y, 2.0), 2.0);\n    return checkerMask;\n  }\n`\nconst checkerX = /* glsl*/`\n  float checkerX(vec2 samplePosition, float size) {\n    vec2 checkerPos = floor(samplePosition / size);\n    float checkerMask = mod(checkerPos.x, 2.0);\n    return checkerMask;\n  }\n`\nconst checkerY = /* glsl*/`\n  float checkerY(vec2 samplePosition, float size) {\n    vec2 checkerPos = floor(samplePosition / size);\n    float checkerMask = mod(checkerPos.y, 2.0);\n    return checkerMask;\n  }\n`\n\n// Compositing functions\nconst compose = /* glsl*/`\n  vec3 compose(vec3 dst, vec4 src) {\n    return mix(dst, src.rgb, src.a);\n  }\n`\n\n/**\n * GLSL Color Functions\n */\n\nconst hue2rgb = /* glsl*/`\n  vec3 hue2rgb(float hue) {\n    hue = fract(hue);\n    float R = abs(hue * 6. - 3.) - 1.;\n    float G = 2. - abs(hue * 6. - 2.);\n    float B = 2. - abs(hue * 6. - 4.);\n    return saturate(vec3(R,G,B));\n  }\n`\n\nconst hsv2rgb = /* glsl*/`\n  vec3 hsv2rgb(vec3 hsv) {\n    vec3 rgb = hue2rgb(hsv.r);\n    return ((rgb - 1.) * hsv.g + 1.) * hsv.b;\n  }\n`\n\nconst hsl2rgb = /* glsl*/`\n  vec3 hsl2rgb(vec3 hsl) {\n    vec3 rgb = hue2rgb(hsl.x);\n    float C = (1. - abs(2. * hsl.z - 1.)) * hsl.y;\n    return (rgb - 0.5) * C + hsl.z;\n  }\n`\n\nexport const glsl = {\n  saturate,\n  translate,\n  circle,\n  rectangle,\n  paintDerivativeGrid2D,\n  lineVertical,\n  lineHorizontal,\n  lineCross2d,\n  checker,\n  checkerX,\n  checkerY,\n  compose,\n  hue2rgb,\n  hsv2rgb,\n  hsl2rgb,\n}\n","import { Register } from '../decorators/Register.js'\nimport { ReactiveProperty } from '../decorators/Property.js'\nimport { ReactivePropertyInstance, ReactivePropertyDefinition } from '../core/ReactiveProperty.js'\nimport { Node } from '../nodes/Node.js'\nimport { ThemeSingleton, Color } from '../nodes/Theme.js'\nimport { IoElement, IoElementProps } from './IoElement.js'\nimport { glsl } from './IoGL.glsl.js'\n\nconst canvas = document.createElement('canvas')\nconst gl = canvas.getContext('webgl', {antialias: false, premultipliedAlpha: false}) as WebGLRenderingContext\n\ngl.getExtension('OES_standard_derivatives')\n\ngl.enable(gl.BLEND)\ngl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\ngl.disable(gl.DEPTH_TEST)\n\nconst positionBuff = gl.createBuffer()\ngl.bindBuffer(gl.ARRAY_BUFFER, positionBuff)\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,1,0.0,-1,-1,0.0,1,-1,0.0,1,1,0.0]), gl.STATIC_DRAW)\ngl.bindBuffer(gl.ARRAY_BUFFER, null)\n\nconst uvBuff = gl.createBuffer()\ngl.bindBuffer(gl.ARRAY_BUFFER, uvBuff)\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0,1,0,0,1,0,1,1]), gl.STATIC_DRAW)\ngl.bindBuffer(gl.ARRAY_BUFFER, null)\n\nconst indexBuff = gl.createBuffer()\ngl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuff)\ngl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array([3,2,1,3,1,0]), gl.STATIC_DRAW)\ngl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null)\n\ngl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuff)\n\nconst shadersCache = new WeakMap()\nlet currentProgram: WebGLProgram | null\n\n@Register\nexport class IoGl extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        position: relative;\n        overflow: hidden !important;\n        @apply --unselectable;\n      }\n      :host > canvas {\n        position: absolute;\n        pointer-events: none;\n        image-rendering: pixelated;\n      }\n      :host > span {\n        position: absolute;\n        text-shadow: 0 0 3px var(--io_bgColorStrong), 0 0 3px var(--io_bgColorStrong), 0 0 3px var(--io_bgColorStrong);\n        left: 3px;\n        pointer-events: none;\n        color: var(--io_colorStrong);\n      }\n    `\n  }\n\n  @ReactiveProperty({type: Node, value: ThemeSingleton})\n  declare theme: typeof ThemeSingleton\n\n  @ReactiveProperty({type: Array, init: [0, 0]})\n  declare size: [number, number]\n\n  @ReactiveProperty({type: Number, value: 1})\n  declare pxRatio: number\n\n  // @ReactiveProperty('throttled')\n  // declare reactivity: ReactivityType\n\n  #needsResize = false\n  #canvas: HTMLCanvasElement\n  // #counter: HTMLSpanElement;\n  #ctx: CanvasRenderingContext2D\n  #vecLengths: Record<string, number>\n  #shader: WebGLProgram\n\n  static get Vert() {\n    return /* glsl */`\n      attribute vec3 position;\n      attribute vec2 uv;\n      varying vec2 vUv;\n\n      void main(void) {\n        vUv = uv;\n        gl_Position = vec4(position, 1.0);\n      }\\n\\n`\n  }\n  static get GlUtils() {\n    return /* glsl */`\n      ${glsl.saturate}\n      ${glsl.translate}\n      ${glsl.circle}\n      ${glsl.rectangle}\n      ${glsl.paintDerivativeGrid2D}\n      ${glsl.lineVertical}\n      ${glsl.lineHorizontal}\n      ${glsl.lineCross2d}\n      ${glsl.checker}\n      ${glsl.checkerX}\n      ${glsl.checkerY}\n      ${glsl.compose}\n    `\n  }\n  static get Frag() {\n    return /* glsl */`\n      void main(void) {\n        gl_FragColor = io_color;\n      }\\n\\n`\n  }\n  initPropertyUniform(name: string, property: ReactivePropertyDefinition) {\n    const type = property.value.constructor\n    switch (type) {\n      case Boolean:\n        return 'uniform int ' + name + ';\\n'\n      case Number:\n        return 'uniform float ' + name + ';\\n'\n      case Array:\n        this.#vecLengths[name] = property.value.length\n        return 'uniform vec' + property.value.length + ' ' + name + ';\\n'\n      case Color:\n        this.#vecLengths[name] = 4\n        return 'uniform vec4 ' + name + ';\\n'\n      default:\n    }\n    return ''\n  }\n  initShader() {\n    let frag = /* glsl */`\n    #extension GL_OES_standard_derivatives : enable\n    precision highp float;\\n`\n\n    this.theme._reactiveProperties.forEach((property, name) => {\n      frag += this.initPropertyUniform('io_' + name, property)\n    })\n\n    frag += '\\n'\n\n    this._reactiveProperties.forEach((property, prop) => {\n      const name = 'u' + prop.charAt(0).toUpperCase() + prop.slice(1)\n      frag += this.initPropertyUniform(name, property)\n    })\n\n    frag += this.constructor.prototype._glUtils\n\n    const vertShader = gl.createShader(gl.VERTEX_SHADER) as WebGLShader\n    gl.shaderSource(vertShader, (this.constructor as typeof IoGl).Vert)\n    gl.compileShader(vertShader)\n\n    if (!gl.getShaderParameter(vertShader, gl.COMPILE_STATUS)) {\n      const compilationLog = gl.getShaderInfoLog(vertShader)\n      console.error('IoGl [Vertex Shader] ' + this.localName + ' error:')\n      console.warn(compilationLog)\n    }\n\n    const fragShader = gl.createShader(gl.FRAGMENT_SHADER) as WebGLShader\n    gl.shaderSource(fragShader, frag + (this.constructor as typeof IoGl).Frag)\n    gl.compileShader(fragShader)\n\n    if (!gl.getShaderParameter(fragShader, gl.COMPILE_STATUS)) {\n      const compilationLog = gl.getShaderInfoLog(fragShader)\n      console.error('IoGl [Frament Shader] ' + this.localName + ' error:')\n      console.warn(compilationLog)\n    }\n\n    const program = gl.createProgram() as WebGLProgram\n    gl.attachShader(program, vertShader)\n    gl.attachShader(program, fragShader)\n\n    return program\n  }\n  constructor(args: IoElementProps = {}) {\n    super(args)\n\n    this.#canvas = document.createElement('canvas')\n    this.appendChild(this.#canvas)\n    this.#ctx = this.#canvas.getContext('2d', {alpha: true}) as CanvasRenderingContext2D\n\n    // this.#counter = document.createElement('span');\n    // this.#counter.innerText = '0';\n    // this.appendChild(this.#counter);\n\n    // TODO: improve code clarity\n    this.#vecLengths = {}\n    this.theme._reactiveProperties.forEach((property, name) => {\n      // TODO: consider making more type agnostic\n      if (property.type === Color) {\n        this.#vecLengths['io_' + name] = 4\n      }\n    })\n\n    this._reactiveProperties.forEach((property, name) => {\n      const uname = 'u' + name.charAt(0).toUpperCase() + name.slice(1)\n      if (property.type === Array) {\n        this.#vecLengths[uname] = property.value.length\n      }\n    })\n\n    if (shadersCache.has(this.constructor)) {\n      this.#shader = shadersCache.get(this.constructor)\n    } else {\n      this.#shader = this.initShader()\n      shadersCache.set(this.constructor, this.#shader)\n    }\n\n    gl.linkProgram(this.#shader)\n\n    const position = gl.getAttribLocation(this.#shader, 'position')\n    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuff)\n    gl.vertexAttribPointer(position, 3, gl.FLOAT, false, 0, 0)\n    gl.enableVertexAttribArray(position)\n\n    const uv = gl.getAttribLocation(this.#shader, 'uv')\n    gl.bindBuffer(gl.ARRAY_BUFFER, uvBuff)\n    gl.vertexAttribPointer(uv, 2, gl.FLOAT, false, 0, 0)\n    gl.enableVertexAttribArray(uv)\n\n    this.updateThemeUniforms()\n  }\n  onResized() {\n    // TODO: consider optimizing\n    const pxRatio = window.devicePixelRatio\n    const rect = this.getBoundingClientRect()\n    const style = window.getComputedStyle(this)\n    const bw = parseInt(style.borderRightWidth) + parseInt(style.borderLeftWidth)\n    const bh = parseInt(style.borderTopWidth) + parseInt(style.borderBottomWidth)\n\n    // TODO: confirm and test\n    const width = Math.max(0, Math.floor(rect.width - bw))\n    const height = Math.max(0, Math.floor(rect.height - bh))\n\n    const hasResized = (width !== this.size[0] || height !== this.size[1] || pxRatio !== this.pxRatio)\n\n    if (hasResized) {\n      // NOTE: Resizing only in inline CSS. Buffer resize postponed until `onRender()`.`\n      this.#canvas.style.width = Math.floor(width) + 'px'\n      this.#canvas.style.height = Math.floor(height) + 'px'\n      this.#needsResize = true\n\n      this.setProperties({\n        size: [width, height],\n        pxRatio: pxRatio,\n      })\n    }\n  }\n  get ctx() {\n    return this.#ctx\n  }\n  themeMutated() {\n    this.updateThemeUniforms()\n    this.throttle(this.onRender)\n  }\n  changed() {\n    this.throttle(this.onRender)\n  }\n  onRender() {\n    const width = Math.floor(this.size[0] * this.pxRatio)\n    const height = Math.floor(this.size[1] * this.pxRatio)\n\n    if (!width || !height) return\n\n    this.setShaderProgram()\n\n    // TODO: dont brute-force uniform update.\n    this._reactiveProperties.forEach((property, name) => {\n      const uname = 'u' + name.charAt(0).toUpperCase() + name.slice(1)\n      this.updatePropertyUniform(uname, property)\n    })\n\n    if (this.#needsResize) {\n      this.#canvas.width = width\n      this.#canvas.height = height\n      this.#needsResize = false\n    }\n\n    canvas.width = width\n    canvas.height = height\n    gl.viewport(0, 0, width, height)\n\n    gl.clearColor(0, 0, 0, 0)\n    gl.clear(gl.COLOR_BUFFER_BIT)\n    this.#ctx.clearRect(0, 0, width, height)\n\n    gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0)\n\n    this.#ctx.drawImage(canvas, 0, 0)\n\n    // this.#counter.innerText = String(Number(this.#counter.innerText) + 1);\n  }\n  setShaderProgram() {\n    if (currentProgram !== this.#shader) {\n      currentProgram = this.#shader\n      gl.useProgram(this.#shader)\n    }\n  }\n  updatePropertyUniform(name: string, property: ReactivePropertyInstance) {\n    this.setShaderProgram()\n    this.setUniform(name, property.value)\n  }\n  updateThemeUniforms() {\n    this.theme._reactiveProperties.forEach((property, name) => {\n      this.updatePropertyUniform('io_' + name, property)\n    })\n  }\n  setUniform(name: string, value: any) {\n    const uniform = gl.getUniformLocation(this.#shader, name)\n    if (uniform === null) return\n    let type: string = typeof value\n    if (value instanceof Array) type = 'array'\n    let _c\n    switch (type) {\n      case 'boolean':\n        gl.uniform1i(uniform, value ? 1 : 0)\n        break\n      case 'number':\n        gl.uniform1f(uniform, value ?? 1)\n        break\n      case 'object':\n      case 'array':\n        _c = [0, 1, 2, 3]\n        if (typeof value === 'object') {\n          if (value.x !== undefined) _c = ['x', 'y', 'z', 'w']\n          else if (value.r !== undefined) _c = ['r', 'g', 'b', 'a']\n          else if (value.h !== undefined) _c = ['h', 's', 'v', 'a']\n          else if (value.c !== undefined) _c = ['c', 'm', 'y', 'k']\n        }\n        switch (this.#vecLengths[name]) {\n          case 2:\n            if (value === undefined) {\n              gl.uniform2f(uniform, 0, 0)\n              break\n            }\n            gl.uniform2f(uniform,\n                value[_c[0]] ?? 1,\n                value[_c[1]] ?? 1)\n            break\n          case 3:\n            if (value === undefined) {\n              gl.uniform3f(uniform, 0, 0, 0)\n              break\n            }\n            gl.uniform3f(uniform,\n                value[_c[0]] ?? 1,\n                value[_c[1]] ?? 1,\n                value[_c[2]] ?? 1)\n            break\n          case 4:\n            if (value === undefined) {\n              gl.uniform4f(uniform, 0, 0, 0, 0)\n              break\n            }\n            gl.uniform4f(uniform,\n                value[_c[0]] ?? 1,\n                value[_c[1]] ?? 1,\n                value[_c[2]] ?? 1,\n                value[_c[3]] ?? 1)\n                break\n          default:\n        }\n        break\n      default:\n    }\n  }\n  Register(ioNodeConstructor: typeof IoElement) {\n    super.Register(ioNodeConstructor)\n    let _glUtils = ''\n    const constructors = ioNodeConstructor.prototype._protochain.constructors\n    for (let i = constructors.length; i--;) {\n      const constructor = constructors[i]\n      const glUtilsProp = Object.getOwnPropertyDescriptor(constructor, 'GlUtils')\n      if (glUtilsProp && glUtilsProp.get) {\n        _glUtils += (constructor as typeof IoGl).GlUtils\n      }\n    }\n    Object.defineProperty(ioNodeConstructor.prototype, '_glUtils', {enumerable: false, value: _glUtils})\n  }\n}","import { VDOMElement, NativeElementProps, OtherHTMLElementProps } from '../vdom/VDOM.js'\n\n// export const HTML_CORE_PROPERTIES: Record<string, string[]> = {\n//   Node: ['ownerDocument','parentNode','parentElement','childNodes','firstChild','lastChild','previousSibling','nextSibling','textContent'],\n//   Element: ['id','innerHTML','outerHTML','scrollTop','scrollLeft','scrollWidth','scrollHeight','clientTop','clientLeft','clientWidth','clientHeight','role','ariaAtomic','ariaAutoComplete','ariaBusy','ariaBrailleLabel','ariaBrailleRoleDescription','ariaChecked','ariaColCount','ariaColIndex','ariaColSpan','ariaCurrent','ariaDescription','ariaDisabled','ariaExpanded','ariaHasPopup','ariaHidden','ariaInvalid','ariaKeyShortcuts','ariaLabel','ariaLevel','ariaLive','ariaModal','ariaMultiLine','ariaMultiSelectable','ariaOrientation','ariaPlaceholder','ariaPosInSet','ariaPressed','ariaReadOnly','ariaRelevant','ariaRequired','ariaRoleDescription','ariaRowCount','ariaRowIndex','ariaRowSpan','ariaSelected','ariaSetSize','ariaSort','ariaValueMax','ariaValueMin','ariaValueNow','ariaValueText','children','firstElementChild','lastElementChild','childElementCount','previousElementSibling','nextElementSibling','currentCSSZoom','ariaColIndexText','ariaRowIndexText','ariaActiveDescendantElement','ariaControlsElements','ariaDescribedByElements','ariaDetailsElements','ariaErrorMessageElements','ariaFlowToElements','ariaLabelledByElements'],\n//   HTMLElement: ['title','lang','translate','dir','hidden','inert','accessKey','draggable','spellcheck','autocapitalize','contentEditable','enterKeyHint','inputMode','virtualKeyboardPolicy','offsetParent','offsetTop','offsetLeft','offsetWidth','offsetHeight','innerText','outerText','writingSuggestions','autofocus','tabIndex','style'],\n// };\n\n// export const HTML_ELEMENT_PROPERTIES: Record<string, string[]> = {\n//   a: ['target','download','ping','rel','relList','hreflang','type','referrerPolicy','text','coords','charset','name','rev','shape','protocol','username','password','host','hostname','port','pathname','search','hash','href','attributionSrc'],\n//   area: ['alt','coords','download','shape','target','ping','rel','relList','referrerPolicy','noHref','protocol','username','password','host','hostname','port','pathname','search','hash','href','attributionSrc'],\n//   base: ['href','target'],\n//   blockquote: ['cite'],\n//   br: ['clear'],\n//   button: ['disabled','formAction','formEnctype','formMethod','formNoValidate','formTarget','name','type','value','commandForElement','command'],\n//   canvas: ['width','height'],\n//   col: ['span','ch','chOff','vAlign','width'],\n//   colgroup: ['span','ch','chOff','vAlign','width'],\n//   data: ['value'],\n//   del: ['cite','dateTime'],\n//   details: ['open','name'],\n//   dialog: ['open','returnValue','closedBy'],\n//   dir: ['compact'],\n//   dl: ['compact'],\n//   embed: ['src','type','width','height','name'],\n//   fieldset: ['disabled','name'],\n//   font: ['color','face','size'],\n//   form: ['acceptCharset','action','autocomplete','enctype','encoding','method','name','noValidate','target','rel','relList'],\n//   frame: ['name','scrolling','src','frameBorder','longDesc','noResize','marginHeight','marginWidth'],\n//   frameset: ['cols','rows'],\n//   hr: ['color','noShade','size','width'],\n//   html: ['version'],\n//   iframe: ['src','srcdoc','name','sandbox','allowFullscreen','width','height','referrerPolicy','csp','allow','loading','scrolling','frameBorder','longDesc','marginHeight','marginWidth','credentialless','allowPaymentRequest','privateToken','browsingTopics','adAuctionHeaders','sharedStorageWritable'],\n//   img: ['alt','src','srcset','sizes','crossOrigin','useMap','isMap','width','height','referrerPolicy','decoding','fetchPriority','loading','name','lowsrc','hspace','vspace','longDesc','border','browsingTopics','attributionSrc','sharedStorageWritable'],\n//   input: ['accept','alt','autocomplete','defaultChecked','checked','dirName','disabled','files','formAction','formEnctype','formMethod','formNoValidate','formTarget','height','indeterminate','max','maxLength','min','minLength','multiple','name','pattern','placeholder','readOnly','required','size','src','step','type','defaultValue','value','valueAsDate','valueAsNumber','width','selectionStart','selectionEnd','selectionDirection','useMap','webkitdirectory','incremental'],\n//   ins: ['cite','dateTime'],\n//   label: ['htmlFor'],\n//   li: ['value','type'],\n//   link: ['disabled','href','crossOrigin','rel','relList','media','hreflang','type','as','referrerPolicy','sizes','fetchPriority','imageSrcset','imageSizes','charset','rev','target','integrity','blocking'],\n//   map: ['name'],\n//   menu: ['compact'],\n//   meta: ['name','httpEquiv','content','media','scheme'],\n//   meter: ['value','min','max','low','high','optimum'],\n//   object: ['data','type','name','useMap','width','height','archive','code','declare','hspace','standby','vspace','codeBase','codeType','border'],\n//   ol: ['reversed','start','type','compact'],\n//   optgroup: ['disabled','label'],\n//   option: ['disabled','label','defaultSelected','selected','value','text'],\n//   output: ['htmlFor','name','defaultValue','value'],\n//   param: ['name','value','type','valueType'],\n//   pre: ['width'],\n//   progress: ['value','max'],\n//   q: ['cite'],\n//   script: ['src','type','noModule','charset','async','defer','crossOrigin','text','referrerPolicy','fetchPriority','event','htmlFor','integrity','blocking','attributionSrc'],\n//   select: ['autocomplete','disabled','multiple','name','required','size','length','selectedIndex','value'],\n//   source: ['src','type','srcset','sizes','media','width','height'],\n//   style: ['disabled','media','type','blocking'],\n//   table: ['caption','tHead','tFoot','border','frame','rules','summary','width','cellPadding','cellSpacing'],\n//   tbody: ['ch','chOff','vAlign'],\n//   td: ['colSpan','rowSpan','headers','axis','height','width','ch','chOff','noWrap','vAlign','abbr','scope'],\n//   template: ['shadowRootMode','shadowRootDelegatesFocus','shadowRootClonable','shadowRootSerializable'],\n//   textarea: ['autocomplete','cols','dirName','disabled','maxLength','minLength','name','placeholder','readOnly','required','rows','wrap','defaultValue','value','selectionStart','selectionEnd','selectionDirection'],\n//   tfoot: ['ch','chOff','vAlign'],\n//   th: ['colSpan','rowSpan','headers','axis','height','width','ch','chOff','noWrap','vAlign','abbr','scope'],\n//   thead: ['ch','chOff','vAlign'],\n//   time: ['dateTime'],\n//   title: ['text'],\n//   tr: ['ch','chOff','vAlign'],\n//   track: ['kind','src','srclang','label','default'],\n//   ul: ['compact','type'],\n//   video: ['width','height','poster','playsInline','disablePictureInPicture']\n// };\n\nexport const HTML_ELEMENTS: string[] = [\n  'a', 'abbr', 'acronym', 'address', 'applet', 'area', 'article', 'aside', 'audio', 'b', 'base', 'basefont', 'bdi', 'bdo', 'big', 'blockquote',\n  'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'data', 'datalist', 'dd', 'del', 'details', 'dfn',\n  'dialog', 'dir', 'div', 'dl', 'dt', 'em', 'embed', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'frame', 'frameset', 'head',\n  'header', 'hgroup', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'hr', 'html', 'i', 'iframe', 'img', 'input', 'ins', 'kbd', 'keygen', 'label', 'legend',\n   'li', 'link', 'main', 'map', 'mark', 'menu', 'menuitem', 'meta', 'meter', 'nav', 'noframes', 'noscript', 'object', 'ol', 'optgroup', 'option',\n  'output', 'p', 'param', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'script', 'section', 'select', 'small', 'source',\n  'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'svg', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead',\n  'time', 'title', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr'\n]\n\nconst nativeVDOMConstructors: Record<string, (arg0?: NativeElementProps & OtherHTMLElementProps | Array<VDOMElement | null> | string, arg1?: Array<VDOMElement | null> | string) => VDOMElement> = {}\n\nHTML_ELEMENTS.forEach((element) => {\n  // TODO: Add runtime debug type checks?\n  // TODO: Test thoroughly.\n  const vConstructor = function(arg0?: NativeElementProps & OtherHTMLElementProps | Array<VDOMElement | null> | string, arg1?: Array<VDOMElement | null> | string): VDOMElement {\n    const vDOMElement: VDOMElement = {tag: element}\n    if (arg0 !== undefined) {\n      if (typeof arg0 === 'string') {\n        vDOMElement.children = arg0\n      } else if (arg0 instanceof Array) {\n        vDOMElement.children = arg0\n      } else if (typeof arg0 === 'object') {\n        vDOMElement.props = arg0\n      }\n      if (arg1 !== undefined) {\n        if (typeof arg1 === 'string') {\n          vDOMElement.children = arg1\n        } else if (arg1 instanceof Array) {\n          vDOMElement.children = arg1\n        }\n      }\n    }\n    return vDOMElement\n\n  }\n  nativeVDOMConstructors[element] = vConstructor\n})\n\n//TODO: test element vDOM factories!\n\nexport const {\n  a, abbr, acronym, address, applet, area, article, aside, audio, b, base, basefont, bdi, bdo, big, blockquote,\n  body, br, button, canvas, caption, center, cite, code, col, colgroup, data, datalist, dd, del, details, dfn,\n  dialog, dir, div, dl, dt, em, embed, fieldset, figcaption, figure, font, footer, form, frame, frameset, head,\n  header, hgroup, h1, h2, h3, h4, h5, h6, hr, html, i, iframe, img, input, ins, kbd, keygen, label, legend, li,\n  link, main, map, mark, menu, menuitem, meta, meter, nav, noframes, noscript, object, ol, optgroup, option,\n  output, p, param, picture, pre, progress, q, rp, rt, ruby, s, samp, script, section, select, small, source,\n  span, strike, strong, style, sub, summary, sup, svg, table, tbody, td, template, textarea, tfoot, th, thead,\n  time, title, tr, track, tt, u, ul, video, wbr\n} = nativeVDOMConstructors","import { ReactiveProperty } from '../decorators/Property.js'\nimport { Register } from '../decorators/Register.js'\nimport { ListenerDefinitions } from '../nodes/Node.js'\nimport { IoElement, IoElementProps } from './IoElement.js'\n\nlet focusRestoreTarget: Element | null = null\n\n/**\n * This element is designed to be used as a singleton `IoOverlaySingleton`.\n * It is a pointer-blocking element covering the entire window at a very high z-index.\n * It is designed to be displayed on top all other elements and contain elements like modals, popovers, floating menus etc.\n * When clicked, IoOverlay collapses all child elements by setting their `expanded` property to `false`.\n * Child elements should emmit bubbling `\"expanded\"` event when expanded/collapsed.\n **/\n@Register\nclass IoOverlay extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: block;\n        position: fixed;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        right: 0;\n        z-index: 100000;\n        overflow: hidden;\n        pointer-events: none;\n        touch-action: none;\n        background: transparent;\n        @apply --unselectable;\n      }\n      :host[expanded] {\n        background: rgba(0, 0, 0, 0.25);\n        pointer-events: all;\n      }\n      :host > * {\n        position: absolute !important;\n        box-shadow: var(--io_shadow);\n      }\n    `\n  }\n  @ReactiveProperty({value: false, type: Boolean, reflect: true})\n  declare expanded: boolean\n\n  static get Listeners(): ListenerDefinitions {\n    return {\n      'pointerdown': ['stopPropagation', {passive: false}],\n      'pointermove': ['stopPropagation', {passive: false}],\n      'pointerup': 'onPointerup',\n      'contextmenu': 'onContextmenu',\n      'mousedown': ['stopPropagation', {passive: false}],\n      'mousemove': ['stopPropagation', {passive: false}],\n      'mouseup': ['stopPropagation', {passive: false}],\n      'touchstart': ['stopPropagation', {passive: false}],\n      'touchmove': ['stopPropagation', {passive: false}],\n      'touchend': ['stopPropagation', {passive: false}],\n      'keydown': ['stopPropagation', {passive: false}],\n      'keyup': ['stopPropagation', {passive: false}],\n      'focusin': ['stopPropagation', {passive: false}],\n      'blur': ['stopPropagation', {passive: false}],\n      'scroll': 'onScroll',\n      'wheel': ['onScroll', {passive: false}],\n    }\n  }\n\n  constructor(args: IoElementProps = {}) { super(args) }\n\n  init() {\n    this.expandAsChildren = this.expandAsChildren.bind(this)\n  }\n  stopPropagation(event: Event) {\n    event.stopPropagation()\n  }\n  onPointerup(event: PointerEvent) {\n    if (event.composedPath()[0] === this as unknown as EventTarget) {\n      this.collapse()\n    }\n    event.stopPropagation()\n  }\n  onContextmenu(event: Event) {\n    event.preventDefault()\n    event.stopPropagation()\n  }\n  onScroll(event: Event) {\n    if (event.composedPath()[0] === this as unknown as EventTarget) {\n      this.collapse()\n    }\n  }\n  onResized() {\n    this.collapse()\n  }\n  appendChild<El extends Node>(child: El) {\n    super.appendChild(child)\n    child.addEventListener('expanded-changed', this.onChildExpandedChanged)\n    this.debounce(this.expandAsChildren)\n    return child\n  }\n  removeChild<El extends Node>(child: El) {\n    super.removeChild(child)\n    child.removeEventListener('expanded-changed', this.onChildExpandedChanged)\n    this.debounce(this.expandAsChildren)\n    return child\n  }\n  onChildExpandedChanged() {\n    this.debounce(this.expandAsChildren)\n  }\n  collapse() {\n    for (let i = this.children.length; i--;) {\n      this.expanded = false\n    }\n    this.expanded = false\n  }\n  expandAsChildren() {\n    for (let i = this.children.length; i--;) {\n      if ((this.children[i] as any).expanded) {\n        this.expanded = true\n        return\n      }\n    }\n    this.expanded = false\n  }\n  expandedChanged() {\n    if (!this.expanded) {\n      for (let i = this.children.length; i--;) {\n        (this.children[i] as any).expanded = false\n      }\n      if (focusRestoreTarget) (focusRestoreTarget as HTMLElement).focus()\n    }\n  }\n}\n\nexport const IoOverlaySingleton = new IoOverlay()\n\nsetTimeout(() => {\n  document.body.appendChild(IoOverlaySingleton as HTMLElement)\n}, 100)\n\n// TODO: Test\nwindow.addEventListener('focusin', () => {\n  focusRestoreTarget = document.activeElement\n}, {capture: false})\n\nwindow.addEventListener('blur', () => {\n  setTimeout(() => {\n    if (!IoOverlaySingleton.expanded && document.activeElement === document.body) {\n      focusRestoreTarget = null\n    }\n  })\n}, {capture: true})","import { IoElement } from '../elements/IoElement.js'\nimport { ThemeSingleton } from '../nodes/Theme.js'\nimport { IoOverlaySingleton as Overlay } from '../elements/IoOverlay.js'\n\n// TODO: improve focus algorithm\n// Note: focus string field in IoInspector demo and use arrowleft - notice focus shift is not intuitive.\n\n// TODO: Home, End, PageUp, PageDown?\n\nlet focusBacktrack = new WeakMap()\ntype Direction = 'ArrowLeft' | 'ArrowRight' | 'ArrowDown' | 'ArrowUp'\nconst backtrackDir: Record<Direction, Direction> = {\n  ArrowLeft: 'ArrowRight',\n  ArrowRight: 'ArrowLeft',\n  ArrowDown: 'ArrowUp',\n  ArrowUp: 'ArrowDown'\n}\n\nfunction setFocusBacktrack(element: HTMLElement | IoElement, dir: Direction, source: HTMLElement | IoElement) {\n  focusBacktrack.set(element, {\n    dir: backtrackDir[dir],\n    source: source\n  })\n}\n\nfunction getRectDistance(rect1: DOMRect, rect2: DOMRect, dirBias: number = 1) {\n  if (rect1.right > rect2.left && rect2.right > rect1.left && rect1.bottom > rect2.top && rect2.bottom > rect1.top) {\n    return 0\n  }\n  let dx = 0, dy = 0\n  const MIN_DISTANCE = ThemeSingleton.fieldHeight / 2\n\n  if (rect1.right < rect2.left) dx = Math.max(MIN_DISTANCE, rect2.left - rect1.right)\n  else if (rect2.right < rect1.left) dx = Math.max(MIN_DISTANCE, rect1.left - rect2.right)\n  if (rect1.bottom < rect2.top) dy = Math.max(MIN_DISTANCE, rect2.top - rect1.bottom)\n  else if (rect2.bottom < rect1.top) dy = Math.max(MIN_DISTANCE, rect1.top - rect2.bottom)\n  dx = dx * dirBias\n  dy = dy / dirBias\n  return (dx**2 + dy**2)**0.5\n}\n\nfunction getCenterDistance(rect1: DOMRect, rect2: DOMRect, dirBias: number = 1) {\n  let c1 = {x: rect1.x + rect1.width / 2, y: rect1.y + rect1.height / 2}\n  let c2 = {x: rect2.x + rect2.width / 2, y: rect2.y + rect2.height / 2}\n  let dx = c1.x - c2.x\n  let dy = c1.y - c2.y\n  dx = dx * dirBias\n  dy = dy / dirBias\n  return (dx**2 + dy**2)**0.5\n}\n\nfunction onIoFocusTo(event: CustomEvent) {\n  const src = event.detail.source\n  const srcRect = src.getBoundingClientRect()\n  const cmd = event.detail.command\n\n  const inoverlay = Overlay.contains(src)\n\n  let closestElement = src\n  let closestDistance = Infinity\n  let closestCenterDistance = Infinity\n\n  const backtrack = focusBacktrack.get(src)\n\n  if (backtrack && backtrack.dir === cmd) {\n    const source = backtrack.source\n    let visible = true\n    if (!source.offsetParent || source === src) {\n      visible = false\n    } else {\n      const sStyle = window.getComputedStyle(source)\n      if (sStyle.visibility !== 'visible' || sStyle.display === 'none') {\n        visible = false\n      }\n    }\n    if (visible) {\n      source.focus()\n      setFocusBacktrack(source, cmd, src)\n      return\n    }\n  }\n\n  const root = inoverlay ? Overlay as HTMLElement : document\n  let focusableCandidates = Array.from(root.querySelectorAll(`[tabIndex=\"${src.tabIndex || 0}\"]:not([disabled]):not([inert]):not([hidden])`)) as HTMLElement[]\n  let focusableSiblingCandidates = Array.from(src.parentElement.querySelectorAll(`[tabIndex=\"${src.tabIndex || 0}\"]:not([disabled]):not([inert]):not([hidden])`)) as HTMLElement[]\n  focusableCandidates = focusableCandidates.filter(el => el.offsetParent !== null)\n  focusableCandidates = focusableCandidates.filter(el => {\n    const style = window.getComputedStyle(el)\n    return style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0'\n  })\n\n  if (cmd === 'Tab') {\n    const index = focusableCandidates.indexOf(src)\n    if (index !== -1) {\n      focusableCandidates[(index + 1) % focusableCandidates.length].focus()\n    }\n    return\n  } else if (cmd === 'Home') {\n    focusableCandidates[0].focus()\n    return\n  } else if (cmd === 'End') {\n    focusableCandidates[focusableCandidates.length - 1].focus()\n    return\n  } else if (cmd === 'PageUp') {\n    focusableSiblingCandidates[0].focus()\n    return\n  } else if (cmd === 'PageDown') {\n    focusableSiblingCandidates[focusableSiblingCandidates.length - 1].focus()\n    return\n  } else if (['ArrowLeft', 'ArrowRight', 'ArrowDown', 'ArrowUp'].includes(cmd)) {\n    for (let i = focusableCandidates.length; i--;) {\n      const candidate = focusableCandidates[i]\n      if (!candidate.offsetParent || candidate === src) {\n        continue\n      }\n      const sStyle = window.getComputedStyle(candidate)\n      if (sStyle.visibility !== 'visible' || sStyle.display === 'none') {\n        continue\n      }\n      const rect = candidate.getBoundingClientRect()\n      if (cmd === 'ArrowRight' && rect.left < srcRect.right) continue\n      if (cmd === 'ArrowLeft' && rect.right > srcRect.left) continue\n      if (cmd === 'ArrowDown' && rect.top < srcRect.bottom) continue\n      if (cmd === 'ArrowUp' && rect.bottom > srcRect.top) continue\n\n      const biasMagnitude = 4\n      const dirBias = cmd === 'ArrowLeft' || cmd === 'ArrowRight' ? 1 / biasMagnitude : biasMagnitude\n\n      const distance = getRectDistance(srcRect, rect, dirBias)\n      const centerDistance = getCenterDistance(srcRect, rect, dirBias)\n      if (distance < closestDistance) {\n        closestDistance = distance\n        closestCenterDistance = centerDistance\n        closestElement = candidate\n      } else if (distance === closestDistance && centerDistance < closestCenterDistance) {\n        closestCenterDistance = centerDistance\n        closestElement = candidate\n      }\n    }\n    if (closestElement !== src) {\n      (closestElement as any).focus()\n      setFocusBacktrack(closestElement, cmd, src)\n    }\n  }\n}\n\ndocument.addEventListener('io-focus-to', onIoFocusTo as EventListener)\n","import { IoElement } from '../elements/IoElement.js'\n\n/**\n * Nudge direction.\n *\n * @description Nudge direction.\n * @example\n *\n */\nexport type NudgeDirection = 'none' | 'up' | 'left' | 'down' | 'right' | 'over'\n\nconst viewport = {\n  get width(): number {\n    return window.visualViewport\n      ? window.visualViewport.width * window.visualViewport.scale\n      : document.documentElement.clientWidth\n  },\n  get height(): number {\n    return window.visualViewport\n      ? window.visualViewport.height * window.visualViewport.scale\n      : document.documentElement.clientHeight\n  },\n  get offsetLeft(): number {\n    return window.visualViewport ? window.visualViewport.offsetLeft : 0\n  },\n  get offsetTop(): number {\n    return window.visualViewport ? window.visualViewport.offsetTop : 0\n  },\n}\n\nfunction nudgeUp(element: HTMLElement | IoElement, x: number, y: number, elemRect: DOMRect, force?: boolean, doClip?: boolean) {\n  x = Math.max(0, Math.min(x, viewport.width - elemRect.width))\n  let clipWidth = -1\n  let clipHeight = -1\n  const fitsHeight = y - elemRect.height >= 0\n  const fitsWidth = x + elemRect.width <= viewport.width\n  if (fitsHeight || force) {\n    if (!fitsHeight) {\n      if (doClip) {\n        clipHeight = y\n        y = 0\n      } else {\n        y = elemRect.height - y\n      }\n    } else {\n      y = y - elemRect.height\n    }\n    if (!fitsWidth) {\n      if (doClip) {\n        clipWidth = viewport.width\n      } else {\n        x = viewport.width - elemRect.width\n      }\n    }\n    element.style.top = y + 'px'\n    element.style.left = x + 'px'\n    element.style.width = clipWidth !== -1 ? clipWidth + 'px' : ''\n    element.style.height = clipHeight !== -1 ? clipHeight + 'px' : ''\n    return true\n  }\n  return false\n}\n\nfunction nudgeDown(element: HTMLElement | IoElement, x: number, y: number, elemRect: DOMRect, force?: boolean, doClip?: boolean) {\n  y = y + viewport.offsetTop\n  x = x + viewport.offsetLeft\n  x = Math.max(0, Math.min(x, viewport.width - elemRect.width))\n  let clipWidth = -1\n  let clipHeight = -1\n  const fitsHeight = y + elemRect.height <= viewport.height\n  const fitsWidth = x + elemRect.width <= viewport.width\n  if (fitsHeight || force) {\n    if (!fitsHeight) {\n      if (doClip) {\n        clipHeight = viewport.height - y\n      } else {\n        y = viewport.height - elemRect.height\n      }\n    }\n    if (!fitsWidth) {\n      if (doClip) {\n        clipWidth = viewport.width\n      } else {\n        x = viewport.width - elemRect.width\n      }\n    }\n    element.style.top = y + 'px'\n    element.style.left = x + 'px'\n    element.style.width = clipWidth !== -1 ? clipWidth + 'px' : ''\n    element.style.height = clipHeight !== -1 ? clipHeight + 'px' : ''\n    return true\n  }\n  return false\n}\n\nfunction nudgeLeft(element: HTMLElement | IoElement, x: number, y: number, elemRect: DOMRect, force?: boolean, doClip?: boolean) {\n  y = Math.max(0, Math.min(y, viewport.height - elemRect.height))\n  let clipWidth = -1\n  let clipHeight = -1\n  const fitsWidth = x - elemRect.width >= 0\n  const fitsHeight = y + elemRect.height <= viewport.height\n  if (fitsWidth || force) {\n    if (!fitsWidth) {\n      if (doClip) {\n        clipWidth = x\n        x = 0\n      } else {\n        x = 0\n      }\n    } else {\n      x = x - elemRect.width\n    }\n    if (!fitsHeight) {\n      if (doClip) {\n        clipHeight = viewport.height\n      } else {\n        y = viewport.height - elemRect.height\n      }\n    }\n    element.style.top = y + 'px'\n    element.style.left = x + 'px'\n    element.style.width = clipWidth !== -1 ? clipWidth + 'px' : ''\n    element.style.height = clipHeight !== -1 ? clipHeight + 'px' : ''\n    return true\n  }\n  return false\n}\n\nfunction nudgeRight(element: HTMLElement | IoElement, x: number, y: number, elemRect: DOMRect, force?: boolean, doClip?: boolean) {\n  y = Math.max(0, Math.min(y, viewport.height - elemRect.height))\n  let clipWidth = -1\n  let clipHeight = -1\n  const fitsWidth = x + elemRect.width <= viewport.width\n  const fitsHeight = y + elemRect.height <= viewport.height\n  if (fitsWidth || force) {\n    if (!fitsWidth) {\n      if (doClip) {\n        clipWidth = viewport.width - x\n      } else {\n        x = viewport.width - elemRect.width\n      }\n    }\n    if (!fitsHeight) {\n      if (doClip) {\n        clipHeight = viewport.height\n      } else {\n        y = viewport.height - elemRect.height\n      }\n    }\n    element.style.top = y + 'px'\n    element.style.left = x + 'px'\n    element.style.width = clipWidth !== -1 ? clipWidth + 'px' : ''\n    element.style.height = clipHeight !== -1 ? clipHeight + 'px' : ''\n    return true\n  }\n  return false\n}\n\nexport function nudge(element: HTMLElement | IoElement, srcElement: HTMLElement | IoElement, direction: NudgeDirection, doClip?: boolean) {\n  const elemRect = element.getBoundingClientRect()\n  const srcRect = srcElement.getBoundingClientRect()\n  const left = srcRect.left\n  const top = srcRect.top\n  const right = srcRect.right\n  const bottom = srcRect.bottom\n  const bottomToHeight = viewport.height - bottom\n  const rightToWidth = viewport.width - right\n  const x = elemRect.left\n  const y = elemRect.top\n  switch (direction) {\n    case 'none':\n      nudgeRight(element, x, y, elemRect, false, doClip) ||\n      nudgeLeft(element, x, y, elemRect, false, doClip) ||\n      nudgeRight(element, x, y, elemRect, rightToWidth > left, doClip) ||\n      nudgeLeft(element, left, top, elemRect, rightToWidth <= left, doClip)\n      break\n    case 'up':\n      nudgeUp(element, left, top, elemRect, false, doClip) ||\n      nudgeDown(element, left, bottom, elemRect, false, doClip) ||\n      nudgeUp(element, left, top, elemRect, top > bottomToHeight, doClip) ||\n      nudgeDown(element, left, bottom, elemRect, top <= bottomToHeight, doClip)\n      break\n    case 'left':\n      nudgeLeft(element, left, top, elemRect, false, doClip) ||\n      nudgeRight(element, right, top, elemRect, false, doClip) ||\n      nudgeLeft(element, left, top, elemRect, left > rightToWidth, doClip) ||\n      nudgeRight(element, right, top, elemRect, left <= rightToWidth, doClip)\n      break\n    case 'down':\n      nudgeDown(element, left, bottom, elemRect, false, doClip) ||\n      nudgeUp(element, left, top, elemRect, false, doClip) ||\n      nudgeDown(element, left, bottom, elemRect, bottomToHeight > top, doClip) ||\n      nudgeUp(element, left, top, elemRect, bottomToHeight <= top, doClip)\n      break\n    case 'right':\n      nudgeRight(element, right, top, elemRect, false, doClip) ||\n      nudgeLeft(element, left, top, elemRect, false, doClip) ||\n      nudgeRight(element, right, top, elemRect, rightToWidth > left, doClip) ||\n      nudgeLeft(element, left, top, elemRect, rightToWidth <= left, doClip)\n      break\n    case 'over':\n    default:\n      nudgeRight(element, left, top, elemRect, false, doClip) ||\n      nudgeLeft(element, right, top, elemRect, false, doClip) ||\n      nudgeRight(element, left, top, elemRect, rightToWidth > left, doClip) ||\n      nudgeLeft(element, right, top, elemRect, rightToWidth <= left, doClip)\n      break\n  }\n}","/** @License\n * Copyright 2025 Aleksandar (Aki) Rodic\n *\n * The MIT License\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\nexport * from './core/Binding.js'\nexport * from './core/ChangeQueue.js'\nexport * from './core/EventDispatcher.js'\nexport * from './core/NodeArray.js'\nexport * from './core/ProtoChain.js'\nexport * from './core/Queue.js'\nexport * from './core/ReactiveProperty.js'\nexport * from './vdom/VDOM.js'\nexport * from './decorators/Property.js'\nexport * from './decorators/Register.js'\nexport * from './decorators/Style.js'\nexport * from './nodes/Node.js'\nexport * from './nodes/Storage.js'\nexport * from './nodes/Theme.js'\nexport * from './elements/IoElement.js'\nexport * from './elements/IoGL.js'\nexport * from './elements/IoGL.glsl.js'\nexport * from './elements/IoNative.js'\nexport * from './elements/IoOverlay.js'\nexport * from './utils/Focus.js'\nexport * from './utils/Nudge.js'\n\n/** @License\n * Copyright 2025 Aleksandar (Aki) Rodic\n *\n * The MIT License\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\nconst LICENSE = 'MIT'\nexport { LICENSE }"],"names":["bothAreNaNs","value","oldValue","isTypeCompatible","type1","type2","Binding","node","property","target","targetProps","targetP","srcP","valueMismatch","typeMismatch","targetProperties","i","propertyInstance","prop","event","j","propName","props","t","ChangeQueue","change","properties","hardenListenerDefinition","listenerDefinition","LISTENER_OPTIONS","listenerFromDefinition","def","handlerDef","options","invalidOptions","k","handler","EventDispatcher","name","listener","newPropListeners","definition","propListeners","newListener","oldListener","l","listenerTuple","index","item","detail","bubbles","path","payload","parent","NodeArray","args","self","proxy","oldLength","newLength","operation","start","deleteCount","items","result","compareFn","ReactiveProtoProperty","d","protoProp","json","decodeInitArgument","keys","ReactivePropertyInstance","propDef","key","argument","propertyDecorators","reactivePropertyDecorators","Property","initialValue","propertyName","constructor","ReactiveProperty","defLoose","styleDecorators","Style","style","ProtoChain","ioNodeConstructor","proto","reactivePropertyHash","propertyHash","prevHash","newHash","protoProperty","reativeProtoProperties","listenerDefs","lsnDef","listeners","names","fn","propDesr","isNull","isUndefined","currentFrame","queue0","queue1","queueOptions0","queueOptions1","queue","queueOptions","nextQueue","resolve","throttle","func","arg","delay","debounce","executeQueue","activeQueue","activeQueueOptions","e","defaultPropsMap","applyNativeElementProps","element","defaultPropValues","_p","p","s","constructElement","vDOMElement","ConstructorClass","disposeChildren","elements","vDOMAttributes","attributes","toVDOMChildren","htmlCollection","children","toVDOM","Register","mixinRecord","commentsRegex","keyframeRegex","mediaQueryRegex","mixinRegex","applyRegex","cssRegex","applyElementStyleToDocument","localName","mixinsString","mixins","m","apply","styleStripped","match","selector","styleElement","resizeObserver","entries","entry","IoElement","initReactiveProperties","initProperties","skipDispatch","setProperties","setProperty","dispatchQueue","timeout","onPropertyMutated","object","bind","unbind","type","src","dispose","vDOMElements","host","noDispose","vDOMElementsOnly","vChildren","child","oldElement","frag","vChild","textContent","attr","arg0","arg1","__decorateClass","ioElement","NODES","isNonNodeObject","Node","observeObjectProperty","observeNodeProperty","binding","oldBinding","nodeArray","hasNewValueAtOtherProperty","hasOldValueAtOtherProperty","n","hasMutated","handlerName","hasSameValueAtOtherProperty","removed","EmulatedLocalStorage","permitted","strValue","localStorage","nodes","hashValues","StorageNode","storedValue","getValueFromHash","parseHash","hashString","h","Storage","hash","parts","updateAllFromHash","THEME_VERSION","Color","r","g","b","a","LIGHT_THEME","DARK_THEME","$ThemeID","$","$Themes","compositeVariables","Theme","themeID","theme","values","propertyVariables","ThemeSingleton","saturate","translate","circle","rectangle","paintDerivativeGrid2D","lineVertical","lineHorizontal","lineCross2d","checker","checkerX","checkerY","compose","hue2rgb","hsv2rgb","hsl2rgb","glsl","_needsResize","_canvas","_ctx","_vecLengths","_shader","canvas","gl","positionBuff","uvBuff","indexBuff","shadersCache","currentProgram","IoGl","__privateAdd","__privateSet","__privateGet","uname","position","uv","vertShader","compilationLog","fragShader","program","pxRatio","rect","bw","bh","width","height","uniform","_c","_glUtils","constructors","glUtilsProp","HTML_ELEMENTS","nativeVDOMConstructors","vConstructor","abbr","acronym","address","applet","area","article","aside","audio","base","basefont","bdi","bdo","big","blockquote","body","br","button","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","head","header","hgroup","h1","h2","h3","h4","h5","h6","hr","html","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noframes","noscript","ol","optgroup","option","output","param","picture","pre","progress","q","rp","rt","ruby","samp","script","section","select","small","source","span","strike","strong","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","video","wbr","focusRestoreTarget","IoOverlay","IoOverlaySingleton","focusBacktrack","backtrackDir","setFocusBacktrack","getRectDistance","rect1","rect2","dirBias","dx","dy","MIN_DISTANCE","getCenterDistance","c1","c2","onIoFocusTo","srcRect","cmd","inoverlay","Overlay","closestElement","closestDistance","closestCenterDistance","backtrack","visible","sStyle","focusableCandidates","focusableSiblingCandidates","el","candidate","biasMagnitude","distance","centerDistance","viewport","nudgeUp","x","y","elemRect","force","doClip","clipWidth","clipHeight","fitsHeight","fitsWidth","nudgeDown","nudgeLeft","nudgeRight","nudge","srcElement","direction","left","top","right","bottom","bottomToHeight","rightToWidth","LICENSE"],"mappings":"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"}