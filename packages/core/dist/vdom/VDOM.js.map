{"version":3,"file":"VDOM.js","sourceRoot":"","sources":["../../src/vdom/VDOM.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventDispatcher } from '../core/EventDispatcher.js'\nimport { IoElement } from '../elements/IoElement.js'\nimport { Binding } from '../core/Binding.js'\n\nexport type VDOMElement = {\n  tag: string\n  props?: Record<string, any>\n  children?: Array<VDOMElement | null> | string\n}\n\ntype IntegerNumeric = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 30 | 31 | 32\ntype IntegerString = `${IntegerNumeric}`\ntype IntegerAny = IntegerNumeric | IntegerString\ntype Boolean = boolean | 'true' | 'false'\ntype Lang = 'ab'|'aa'|'af'|'ak'|'sq'|'am'|'ar'|'an'|'hy'|'as'|'av'|'ae'|'ay'|'az'|'bm'|'ba'|'eu'|'be'|'bn'|'bh'|'bi'|'bs'|'br'|'bg'|'my'|'ca'|'ch'|'ce'|\n      'ny'|'zh'|'zh-ans'|'zh-ant'|'cv'|'kw'|'co'|'cr'|'hr'|'cs'|'da'|'dv'|'nl'|'dz'|'en'|'eo'|'et'|'ee'|'fo'|'fj'|'fi'|'fr'|'ff'|'gl'|'gd'|\n      'ka'|'de'|'el'|'kl'|'gn'|'gu'|'ht'|'ha'|'he'|'hz'|'hi'|'ho'|'hu'|'is'|'io'|'ig'|'id in'|'ia'|'ie'|'iu'|'ik'|'ga'|'it'|'ja'|'jv'|'kn'|\n      'kr'|'ks'|'kk'|'km'|'ki'|'rw'|'rn'|'ky'|'kv'|'kg'|'ko'|'ku'|'kj'|'lo'|'la'|'lv'|'li'|'ln'|'lt'|'lu'|'lg'|'lb'|'gv'|'mk'|'mg'|'ms'|'ml'|'mt'|\n      'mi'|'mr'|'mh'|'mo'|'mn'|'na'|'nv'|'ng'|'nd'|'ne'|'no'|'nb'|'nn'|'oc'|'oj'|'cu'|'or'|'om'|'os'|'pi'|'ps'|'fa'|'pl'|'pt'|'pa'|'qu'|'rm'|\n      'ro'|'ru'|'se'|'sm'|'sg'|'sa'|'sr'|'sh'|'st'|'tn'|'sn'|'ii'|'sd'|'si'|'ss'|'sk'|'sl'|'so'|'nr'|'es'|'su'|'sw'|'sv'|'tl'|'ty'|'tg'|'ta'|\n      'tt'|'te'|'th'|'bo'|'ti'|'to'|'ts'|'tr'|'tk'|'tw'|'ug'|'uk'|'ur'|'uz'|'ve'|'vi'|'vo'|'wa'|'cy'|'wo'|'fy'|'xh'|'yi'|'ji'|'yo'|'za'|'zu'\n\ntype PropsWithUndefined<T> = {[K in keyof T]: T[K] | undefined}\n\nexport type AriaProps = PropsWithUndefined<{\n  role?: 'alert'|'alertdialog'|'application'|'article'|'banner'|'button'|'cell'|'checkbox'|'columnheader'|'combobox'|'complementary'|\n      'contentinfo'|'definition'|'dialog'|'directory'|'document'|'feed'|'figure'|'form'|'grid'|'gridcell'|'group'|'heading'|'img'|\n      'link'|'list'|'listbox'|'listitem'|'log'|'main'|'marquee'|'math'|'menu'|'menubar'|'menuitem'|'menuitemcheckbox'|'menuitemradio'|\n      'navigation'|'none'|'note'|'option'|'presentation'|'progressbar'|'radio'|'radiogroup'|'region'|'row'|'rowgroup'|'rowheader'|\n      'scrollbar'|'search'|'searchbox'|'separator'|'slider'|'spinbutton'|'status'|'switch'|'tab'|'table'|'tablist'|'tabpanel'|'term'|\n      'textbox'|'timer'|'toolbar'|'tooltip'|'tree'|'treegrid'|'treeitem'\n  ariaAtomic?: Boolean\n  ariaAutoComplete?: 'inline' | 'list' | 'both' | 'none'\n  ariaBusy?: Boolean\n  ariaBrailleLabel?: string\n  ariaBrailleRoleDescription?: string\n  ariaChecked?: Boolean | 'mixed'\n  ariaColCount?: IntegerAny\n  ariaColIndex?: IntegerAny\n  ariaColSpan?: IntegerAny\n  ariaCurrent?: Boolean | 'page' | 'step' | 'location' | 'date' | 'time' | 'true' | 'false'\n  ariaDescription?: string\n  ariaDisabled?: Boolean\n  ariaExpanded?: Boolean | 'undefined'\n  ariaHasPopup?: Boolean | 'menu' | 'listbox' | 'tree' | 'grid' | 'dialog'\n  ariaHidden?: Boolean | 'undefined'\n  ariaInvalid?: Boolean | 'grammar' | 'spelling'\n  ariaKeyShortcuts?: string\n  ariaLabel?: string\n  ariaLevel?: IntegerAny\n  ariaLive?: 'assertive' | 'polite' | 'off'\n  ariaModal?: Boolean\n  ariaMultiLine?: Boolean\n  ariaMultiSelectable?: Boolean\n  ariaOrientation?: 'horizontal' | 'vertical' | 'undefined'\n  ariaPlaceholder?: string\n  ariaPosInSet?: IntegerAny\n  ariaPressed?: Boolean | 'mixed' | 'undefined'\n  ariaReadOnly?: Boolean\n  ariaRequired?: Boolean\n  ariaRelevant?: 'additions' | 'all' | 'removals' | 'text'\n  ariaRoleDescription?: string\n  ariaRowCount?: IntegerAny\n  ariaRowIndex?: IntegerAny\n  ariaRowSpan?: IntegerAny\n  ariaSelected?: Boolean | 'undefined'\n  ariaSetSize?: IntegerAny\n  ariaSort?: 'none' | 'ascending' | 'descending' | 'other'\n  ariaValueMax?: number | `${number}`\n  ariaValueMin?: number | `${number}`\n  ariaValueNow?: number | `${number}`\n  ariaValueText?: string\n  ariaColIndexText?: string\n  ariaRowIndexText?: string\n  // TODO: Implement and test in VDOM!\n  ariaActiveDescendantElement?: HTMLElement\n  ariaControlsElements?: HTMLElement\n  ariaDescribedByElements?: HTMLElement\n  ariaDetailsElements?: HTMLElement\n  ariaErrorMessageElements?: HTMLElement\n  ariaFlowToElements?: HTMLElement\n  ariaLabelledByElements?: HTMLElement\n}>\n\nexport type OtherHTMLElementProps = PropsWithUndefined<{\n  target?: '_blank' | '_self' | '_parent' | '_top' | string\n  download?: string\n  ping?: string\n  rel?: string\n  relList?: DOMTokenList\n  hreflang?: Lang\n  type?: string\n  referrerPolicy?: 'no-referrer' | 'no-referrer-when-downgrade' | 'origin' | 'origin-when-cross-origin' | 'same-origin' | 'strict-origin' | 'strict-origin-when-cross-origin' | 'unsafe-url'\n  text?: string\n  coords?: string\n  charset?: string\n  name?: string\n  rev?: string\n  shape?: 'rect' | 'circle' | 'poly' | 'default'\n  protocol?: string\n  username?: string\n  password?: string\n  host?: string\n  hostname?: string\n  port?: string\n  pathname?: string\n  search?: string\n  hash?: string\n  href?: string\n  attributionSrc?: string\n  alt?: string\n  noHref?: boolean\n  cite?: string\n  clear?: 'left' | 'right' | 'both' | 'all' | 'none'\n  disabled?: boolean\n  formAction?: string\n  formEnctype?: 'application/x-www-form-urlencoded' | 'multipart/form-data' | 'text/plain'\n  formMethod?: 'get' | 'post' | 'dialog'\n  formNoValidate?: boolean\n  formTarget?: '_blank' | '_self' | '_parent' | '_top' | string\n  value?: string | number\n  commandForElement?: string\n  command?: string\n  width?: number | string\n  height?: number | string\n  span?: number\n  ch?: string\n  chOff?: string\n  vAlign?: 'top' | 'middle' | 'bottom' | 'baseline'\n  dateTime?: string\n  open?: boolean\n  returnValue?: string\n  closedBy?: string\n  compact?: boolean\n  src?: string\n  color?: string\n  face?: string\n  size?: number | string\n  acceptCharset?: string\n  action?: string\n  autocomplete?: 'on' | 'off'\n  enctype?: 'application/x-www-form-urlencoded' | 'multipart/form-data' | 'text/plain'\n  encoding?: string\n  method?: 'get' | 'post' | 'dialog'\n  noValidate?: boolean\n  scrolling?: 'yes' | 'no' | 'auto'\n  frameBorder?: '0' | '1'\n  longDesc?: string\n  noResize?: boolean\n  marginHeight?: number | string\n  marginWidth?: number | string\n  cols?: number | string\n  rows?: number | string\n  noShade?: boolean\n  version?: string\n  srcdoc?: string\n  sandbox?: string\n  allowFullscreen?: boolean\n  csp?: string\n  allow?: string\n  loading?: 'eager' | 'lazy'\n  credentialless?: boolean\n  allowPaymentRequest?: boolean\n  privateToken?: boolean\n  browsingTopics?: boolean\n  adAuctionHeaders?: boolean\n  sharedStorageWritable?: boolean\n  srcset?: string\n  sizes?: string\n  crossOrigin?: 'anonymous' | 'use-credentials' | ''\n  useMap?: string\n  isMap?: boolean\n  decoding?: 'sync' | 'async' | 'auto'\n  fetchPriority?: 'high' | 'low' | 'auto'\n  lowsrc?: string\n  hspace?: number | string\n  vspace?: number | string\n  border?: number | string\n  accept?: string\n  defaultChecked?: boolean\n  checked?: boolean\n  dirName?: string\n  files?: FileList\n  indeterminate?: boolean\n  max?: number | string\n  maxLength?: number\n  min?: number | string\n  minLength?: number\n  multiple?: boolean\n  pattern?: string\n  placeholder?: string\n  readOnly?: boolean\n  required?: boolean\n  step?: number | string\n  defaultValue?: string\n  valueAsDate?: Date | null\n  valueAsNumber?: number\n  selectionStart?: number\n  selectionEnd?: number\n  selectionDirection?: 'forward' | 'backward' | 'none'\n  webkitdirectory?: boolean\n  incremental?: boolean\n  htmlFor?: string\n  media?: string\n  as?: string\n  imageSrcset?: string\n  imageSizes?: string\n  integrity?: string\n  blocking?: boolean\n  httpEquiv?: string\n  content?: string\n  scheme?: string\n  low?: number | string\n  high?: number | string\n  optimum?: number | string\n  data?: string\n  archive?: string\n  code?: string\n  declare?: boolean\n  standby?: string\n  codeBase?: string\n  codeType?: string\n  reversed?: boolean\n  start?: number\n  label?: string\n  defaultSelected?: boolean\n  selected?: boolean\n  valueType?: string\n  noModule?: boolean\n  async?: boolean\n  defer?: boolean\n  event?: string\n  length?: number\n  selectedIndex?: number\n  caption?: string\n  tHead?: string\n  tFoot?: string\n  frame?: string\n  rules?: string\n  summary?: string\n  cellPadding?: string\n  cellSpacing?: string\n  colSpan?: number\n  rowSpan?: number\n  headers?: string\n  axis?: string\n  noWrap?: boolean\n  abbr?: string\n  scope?: 'row' | 'col' | 'rowgroup' | 'colgroup'\n  shadowRootMode?: 'open' | 'closed'\n  shadowRootDelegatesFocus?: boolean\n  shadowRootClonable?: boolean\n  shadowRootSerializable?: boolean\n  wrap?: 'soft' | 'hard'\n  kind?: string\n  srclang?: Lang\n  default?: boolean\n  poster?: string\n  playsInline?: boolean\n  disablePictureInPicture?: boolean\n}>\n\ntype prefix<TKey, TPrefix extends string> = TKey extends string ? `${TPrefix}${TKey}` : never\ntype AnyEventHandler = ((event: CustomEvent<any>) => void) | ((event: PointerEvent) => void) | ((event: KeyboardEvent) => void) | ((event: MouseEvent) => void) | ((event: TouchEvent) => void) | ((event: WheelEvent) => void) | ((event: InputEvent) => void) | ((event: ClipboardEvent) => void) | ((event: DragEvent) => void) | ((event: FocusEvent) => void) | ((event: TransitionEvent) => void) | ((event: AnimationEvent) => void) | ((event: ErrorEvent) => void) | ((event: Event) => void)\n\nexport type NativeElementProps = AriaProps & PropsWithUndefined<{\n  [key: prefix<string, '@'>]: string | AnyEventHandler\n  title?: string\n  lang?: Lang\n  translate?: any\n  dir?: any\n  hidden?: any\n  inert?: any\n  accessKey?: any\n  draggable?: any\n  spellcheck?: boolean\n  autocapitalize?: any\n  contentEditable?: Boolean\n  enterKeyHint?: 'enter' | 'done' | 'go' | 'next' | 'previous' | 'search' | 'send'\n  inputMode?: 'decimal' | 'email' | 'numeric' | 'tel' | 'search' | 'url' | 'text'\n  virtualKeyboardPolicy?: 'manual' | 'auto'\n  // offsetParent?: any,\n  innerText?: string\n  outerText?: string\n  writingSuggestions?: Boolean\n  autofocus?: boolean\n  tabIndex?: IntegerAny | -1 | '-1'\n  style?: Record<string, string>\n  id?: string\n  class?: string // Shorthand for className\n  innerHTML?: string\n  outerHTML?: string\n  scrollTop?: number\n  scrollLeft?: number\n  scrollWidth?: number\n  scrollHeight?: number\n  textContent?: string\n}>\n\nconst defaultPropsMap = new WeakMap<HTMLElement, NativeElementProps>()\n\n// TODO: Fix types. Remove any.\n\n/**\n * Sets native element's properties and attributes.\n * - style: formatted as Object.\n * - class: shorthand for className.\n * - \"@\" + event: name for event listener.\n * @param {HTMLElement} element - Native HTMLElement to apply properties to.\n * @param {Object} props - Element properties.\n */\nexport const applyNativeElementProps = function(element: HTMLElement, props: NativeElementProps) {\n\n  const defaultPropValues: any = defaultPropsMap.get(element) || {}\n\n  defaultPropsMap.set(element, defaultPropValues)\n\n  for (const _p in props) {\n    const p = _p as keyof HTMLElement\n    const prop = props[p as keyof NativeElementProps]\n\n    debug: if (prop instanceof Binding) {\n      console.warn(`VDOM: Cannot set binding on \"${element.localName}.${_p}\"`)\n    }\n\n    if (!Object.hasOwn(defaultPropValues, p)) defaultPropValues[p] = element[p]\n\n    if (p === 'style') {\n      for (const s in prop) {\n        element.style.setProperty(s, prop[s])\n      }\n    } else if ((p as any) === 'class') {\n      element['className'] = prop\n    } else if (p.startsWith('data-')) {\n      // TODO: Test this!\n      if (prop === undefined) {\n        element.removeAttribute(p)\n      } else {\n        element.setAttribute(p, prop)\n      }\n    } else {\n      if (prop === undefined) {\n        (element as any)[p] = defaultPropValues[p]\n      } else {\n        (element as any)[p] = prop\n      }\n    }\n\n    if (prop === undefined) element.removeAttribute(p)\n    else if (prop === defaultPropValues[p]) element.removeAttribute(p)\n  }\n  // Reset properties to defaults if they are not in the props.\n  for (const _p in defaultPropValues) {\n    const p = _p as keyof NativeElementProps\n    if (!Object.hasOwn(props, p)) {\n      (element as any)[p] = defaultPropValues[p]\n      element.removeAttribute(p)\n    }\n  }\n  if (!(element as IoElement)._eventDispatcher) {\n    Object.defineProperty(element, '_eventDispatcher', {enumerable: false, configurable: true, value: new EventDispatcher(element as unknown as IoElement)})\n  }\n  (element as IoElement)._eventDispatcher.applyPropListeners(props)\n}\n\n/**\n * Creates an element from a virtual DOM object.\n * @param {VDOMElement} vDOMElement - Virtual DOM object.\n * @return {HTMLElement} - Created element.\n */\nexport const constructElement = function(vDOMElement: VDOMElement) {\n  const props = vDOMElement.props || {}\n  // IoElement classes constructed with constructor.\n  const ConstructorClass = window.customElements ? window.customElements.get(vDOMElement.tag) : null\n  if (ConstructorClass && (ConstructorClass as any)._isIoElement) {\n    return new ConstructorClass(props)\n  }\n  // Other element classes constructed with document.createElement.\n  const element = document.createElement(vDOMElement.tag)\n  applyNativeElementProps(element, props)\n  return element\n}\n\n/**\n * Disposes the element's children.\n * @param {IoElement} element - Element to dispose children of.\n */\nexport const disposeChildren = function(element: IoElement) {\n  // NOTE: This rAF ensures that element's change queue is emptied before disposing.\n  requestAnimationFrame(() => {\n    const elements = Array.from(element.querySelectorAll('*')).concat([element]) as IoElement[]\n    for (let i = elements.length; i--;) {\n      if (typeof elements[i].dispose === 'function') {\n        elements[i].dispose()\n      } else if (elements[i]._eventDispatcher) {\n        elements[i]._eventDispatcher.dispose()\n        delete (elements[i] as any)._eventDispatcher\n      }\n    }\n  })\n}\n\nconst vDOMAttributes = function(element: IoElement | HTMLElement): Record<string, any> {\n  const attributes: Record<string, any> = {}\n  for (let i = 0; i < element.attributes.length; i++) {\n    const name = element.attributes[i].name\n    const value = element.getAttribute(name)\n    if (value !== null) attributes[name] = value\n  }\n  return attributes\n}\n\nconst toVDOMChildren = function(htmlCollection: [IoElement | HTMLElement]): VDOMElement[] {\n  const children = []\n  for (let i = 0; i < htmlCollection.length; i++) {\n    children.push(toVDOM(htmlCollection[i]))\n  }\n  return children\n}\n\n/**\n * Converts an element to a virtual dom object.\n * NODE: This vDOM contains elements only attributes (not properties).\n * Used for testing but might be useful for other things.\n * @param {IoElement | HTMLElement} element - Element to convert.\n * @return {VDOMElement} - Virtual dom object.\n */\nexport const toVDOM = function(element: IoElement | HTMLElement): VDOMElement {\n  return {\n    tag: element.localName,\n    props: vDOMAttributes(element),\n    children: element.children.length > 0 ? toVDOMChildren((element as any).children) : element.textContent as string\n  }\n}"]}