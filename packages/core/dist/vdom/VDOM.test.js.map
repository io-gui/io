{"version":3,"file":"VDOM.test.js","sourceRoot":"","sources":["../../src/vdom/VDOM.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from 'vitest'\nimport { Register, IoElement, applyNativeElementProps, constructElement, div, span, ReactivePropertyDefinitions } from '@io-gui/core'\n\ndescribe('VDOM', () => {\n  it('Should construct an native DIV element', () => {\n    const element = constructElement(div())\n    expect(element).toBeDefined()\n    expect(element.localName).toBe('div')\n  })\n  it('Should apply native element properties to the native DIV element', () => {\n    const element = document.createElement('div')\n\n    applyNativeElementProps(element, {\n      tabIndex: 0,\n      contentEditable: true,\n      spellcheck: false,\n    })\n\n    expect(element.tabIndex).toBe(0)\n    expect(element.contentEditable).toBe('true')\n    expect(element.spellcheck).toBe(false)\n\n    expect(element.getAttribute('tabindex')).toBe('0')\n    expect(element.getAttribute('contenteditable')).toBe('true')\n    expect(element.getAttribute('spellcheck')).toBe('false')\n\n    applyNativeElementProps(element, {\n      tabIndex: undefined,\n      contentEditable: undefined,\n      spellcheck: undefined,\n    })\n\n    expect(element.tabIndex).toBe(-1)\n    expect(element.contentEditable).toBe('inherit')\n    expect(element.spellcheck).toBe(true)\n\n    expect(element.getAttribute('tabindex')).toBe(null)\n    expect(element.getAttribute('contenteditable')).toBe(null)\n    expect(element.getAttribute('spellcheck')).toBe(null)\n  })\n  it('Should reset properties to defaults if they are not in the props when the element is updated after initial applyNativeElementProps', () => {\n    const element = document.createElement('div')\n    applyNativeElementProps(element, {\n      tabIndex: 0,\n      contentEditable: true,\n      spellcheck: false,\n    })\n\n    expect(element.tabIndex).toBe(0)\n    expect(element.contentEditable).toBe('true')\n    expect(element.spellcheck).toBe(false)\n\n    expect(element.getAttribute('tabindex')).toBe('0')\n    expect(element.getAttribute('contenteditable')).toBe('true')\n    expect(element.getAttribute('spellcheck')).toBe('false')\n\n    applyNativeElementProps(element, {\n      tabIndex: 1,\n      contentEditable: undefined,\n      spellcheck: undefined,\n    })\n\n    expect(element.tabIndex).toBe(1)\n    expect(element.contentEditable).toBe('inherit')\n    expect(element.spellcheck).toBe(true)\n\n    expect(element.getAttribute('tabindex')).toBe('1')\n    expect(element.getAttribute('contenteditable')).toBe(null)\n    expect(element.getAttribute('spellcheck')).toBe(null)\n  })\n  it('Should clear text content when reusing element with undefined children', () => {\n    // This test verifies that when a span with text content is reused\n    // for a vDOM element with undefined children, the text content is cleared.\n    // Bug scenario: IoTab renders [span.drop-marker, span.label(\"Text\"), ...]\n    // When tab selection changes, positions shift and span.label becomes span.drop-marker\n    // The text content \"Text\" should be cleared but wasn't due to the bug.\n\n    @Register\n    class TestVDOMClearChildren extends IoElement {\n      static get ReactiveProperties(): ReactivePropertyDefinitions {\n        return {\n          showMarker: false,\n        }\n      }\n      declare showMarker: boolean\n      ready() {\n        this.changed()\n      }\n      changed() {\n        // Mimics IoTab render pattern where selected tab has a drop-marker span\n        // and all tabs have a label span. When showMarker changes, the first\n        // span switches between drop-marker (no children) and label (with text).\n        if (this.showMarker) {\n          this.render([\n            span({class: 'drop-marker'}),  // no children - should be empty\n            span({class: 'label'}, 'Label Text'),\n          ])\n        } else {\n          this.render([\n            span({class: 'label'}, 'Label Text'),\n          ])\n        }\n      }\n    }\n\n    const element = new TestVDOMClearChildren()\n    document.body.appendChild(element as unknown as HTMLElement)\n\n    // Initial render without marker - just the label span\n    expect(element.children.length).toBe(1)\n    expect(element.children[0].className).toBe('label')\n    expect(element.children[0].textContent).toBe('Label Text')\n\n    // Now show marker - first span should be drop-marker with NO text content\n    element.showMarker = true\n    expect(element.children.length).toBe(2)\n    expect(element.children[0].className).toBe('drop-marker')\n    // BUG: The drop-marker span inherited text content from the previous label span\n    // because it was reused (same tag 'span') and vChild.children was undefined\n    expect(element.children[0].textContent).toBe('')  // This should pass after fix\n    expect(element.children[1].className).toBe('label')\n    expect(element.children[1].textContent).toBe('Label Text')\n\n    element.remove()\n  })\n})\n"]}