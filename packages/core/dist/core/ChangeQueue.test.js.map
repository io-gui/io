{"version":3,"file":"ChangeQueue.test.js","sourceRoot":"","sources":["../../src/core/ChangeQueue.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from 'vitest'\nimport { ChangeQueue, Change, Node, Register } from '@io-gui/core'\n\n@Register\nclass MockNode extends Node {\n  eventStack: string[] = []\n  changeStack: string[] = []\n  prop1Changed(change: Change) {\n    this.changeStack.push(`prop1Changed ${change.property} ${change.value} ${change.oldValue}`)\n  }\n  prop2Changed(change: Change) {\n    this.changeStack.push(`prop2Changed ${change.property} ${change.value} ${change.oldValue}`)\n  }\n  dispatch(eventName: string, change?: Change) {\n    if (change && change.property) {\n      this.eventStack.push(`${eventName} ${change.property} ${change.value} ${change.oldValue}`)\n    } else {\n      this.eventStack.push(`${eventName}`)\n    }\n  }\n  changed() {\n    this.changeStack.push('changed')\n  }\n}\n\ndescribe('ChangeQueue', () => {\n  it('Should initialize with correct default values', () => {\n    const node = new MockNode()\n    const changeQueue = new ChangeQueue(node)\n    expect(changeQueue.node).toBe(node)\n    expect(JSON.stringify(changeQueue.changes)).toBe('[]')\n    expect(changeQueue.changes.length).toBe(0)\n    expect(changeQueue.dispatching).toBe(false)\n  })\n  it('Should keep track of changes correctly', () => {\n    const node = new MockNode()\n    const changeQueue = new ChangeQueue(node)\n    changeQueue.queue('prop1', 1, 0)\n    changeQueue.queue('prop1', 2, 1)\n    expect(JSON.stringify(changeQueue.changes)).toBe('[{\"property\":\"prop1\",\"value\":2,\"oldValue\":0}]')\n    changeQueue.dispatch()\n    expect(JSON.stringify(changeQueue.changes)).toBe('[]')\n  })\n  it('Should dispatch change events with correct payloads', () => {\n    const node = new MockNode()\n    const changeQueue = new ChangeQueue(node)\n    changeQueue.queue('prop1', 1, 0)\n    changeQueue.queue('prop1', 2, 1)\n    changeQueue.dispatch()\n    expect(JSON.stringify(node.eventStack)).toBe('[\"prop1-changed prop1 2 0\",\"io-object-mutation\"]')\n  })\n  it('Should invoke handler functions with correct payloads', () => {\n    const node = new MockNode()\n    const changeQueue = new ChangeQueue(node)\n    changeQueue.queue('prop1', 1, 0)\n    changeQueue.queue('prop1', 2, 1)\n    changeQueue.dispatch()\n    expect(JSON.stringify(node.changeStack)).toBe('[\"prop1Changed prop1 2 0\",\"changed\"]')\n  })\n  it('Should handle changes in first-in, first-out (FIFO) order', () => {\n    const node = new MockNode()\n    const changeQueue = new ChangeQueue(node)\n    changeQueue.queue('prop1', 1, 0)\n    changeQueue.queue('prop1', 3, 1)\n    changeQueue.queue('prop2', 2, 0)\n    changeQueue.dispatch()\n    expect(JSON.stringify(node.changeStack)).toBe('[\"prop1Changed prop1 3 0\",\"prop2Changed prop2 2 0\",\"changed\"]')\n    expect(JSON.stringify(node.eventStack)).toBe('[\"prop1-changed prop1 3 0\",\"prop2-changed prop2 2 0\",\"io-object-mutation\"]')\n  })\n  it('Setting new value to the same value as oldValue should not trigger change event', () => {\n    const node = new MockNode()\n    const changeQueue = new ChangeQueue(node)\n    changeQueue.queue('prop1', 1, 0)\n    expect(JSON.stringify(changeQueue.changes)).toBe('[{\"property\":\"prop1\",\"value\":1,\"oldValue\":0}]')\n    changeQueue.queue('prop1', 0, 1)\n    expect(JSON.stringify(changeQueue.changes)).toBe('[]')\n    changeQueue.dispatch()\n    expect(JSON.stringify(node.changeStack)).toBe('[]')\n    expect(JSON.stringify(node.eventStack)).toBe('[]')\n  })\n  it('Should skip dispatch if value is same as oldValue', () => {\n    const node = new MockNode()\n    const changeQueue = new ChangeQueue(node)\n    changeQueue.queue('prop1', 0, 0)\n    changeQueue.dispatch()\n    expect(node.changeStack).toEqual([])\n    expect(node.eventStack).toEqual([])\n  })\n  it('Should dispose correctly', () => {\n    const node = new MockNode()\n    const changeQueue = new ChangeQueue(node)\n    changeQueue.dispose()\n    expect(changeQueue.node).toBe(undefined)\n    expect(changeQueue.changes).toBe(undefined)\n  })\n})\n"]}