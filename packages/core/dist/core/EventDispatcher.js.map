{"version":3,"file":"EventDispatcher.js","sourceRoot":"","sources":["../../src/core/EventDispatcher.ts"],"names":[],"mappings":"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","sourcesContent":["import { ChangeEvent } from './ChangeQueue.js'\nimport { ReactiveNode } from '../nodes/ReactiveNode.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: Improve types!\n\n/**\n * Event listener types.\n */\nexport interface KeyboardEventListener { (event: KeyboardEvent): void }\nexport interface PointerEventListener { (event: PointerEvent): void }\nexport interface CustomEventListener { (event: CustomEvent): void }\nexport interface FocusEventListener { (event: FocusEvent): void }\nexport interface TouchEventListener { (event: TouchEvent): void }\nexport interface ChangeEventListener { (event: ChangeEvent): void }\nexport interface IoEventListener { (event: {detail: any; target: ReactiveNode | IoElement | EventTarget; path: Array<ReactiveNode | IoElement | EventTarget>}): void }\nexport type AnyEventListener = EventListener |\n                               KeyboardEventListener |\n                               PointerEventListener |\n                               CustomEventListener |\n                               FocusEventListener |\n                               TouchEventListener |\n                               ChangeEventListener |\n                               IoEventListener |\n                               EventListenerOrEventListenerObject\n/**\n * Listener definition type.\n * The first item is a string (function name) or an event listener function.\n * The second item is an optional object of event listener options.\n */\nexport type ListenerDefinition = [string | AnyEventListener, AddEventListenerOptions?]\n\n/**\n * Loose listener definition type.\n * It can be a string (function name), an event AnyEventListener function or a ListenerDefinition array.\n */\nexport type ListenerDefinitionLoose = string | AnyEventListener | ListenerDefinition\n\nexport type Listener = [AnyEventListener, AddEventListenerOptions?]\nexport type Listeners = Record<string, Listener[]>\n\n/**\n * Converts a loose listener definition into a strongly typed ListenerDefinition array format.\n * This ensures consistent handling of listeners regardless of how they were initially defined.\n *\n * @param {ListenerDefinitionLoose} listenerDefinition - Loosely typed listener definition\n * @return {ListenerDefinition} Normalized listener definition in [string | listener, options?] format\n */\nexport const hardenListenerDefinition = (listenerDefinition: ListenerDefinitionLoose): ListenerDefinition => {\n  return Array.isArray(listenerDefinition) ? listenerDefinition : [listenerDefinition]\n}\n\nconst LISTENER_OPTIONS = ['capture', 'passive']\n\n/**\n * Detects whether native bubbling from `node` would reach a DOM ancestor\n * that was already visited by the current synthetic bubbling dispatch.\n *\n * Edge case:\n * A single logical event can traverse one branch via synthetic ReactiveNode\n * parents, then get converted into a native CustomEvent at an IoElement\n * boundary and bubble through DOM again. Without this guard, shared ancestors\n * can receive the same event twice.\n */\nconst hasVisitedDomAncestor = (node: ReactiveNode | IoElement | EventTarget, visited: Set<ReactiveNode | IoElement | EventTarget>) => {\n  if (!(node instanceof Node)) return false\n  let current: Node | null = node.parentNode\n  while (current) {\n    if (visited.has(current as unknown as ReactiveNode | IoElement | EventTarget)) return true\n    current = current.parentNode\n  }\n  return false\n}\n\n/**\n * Converts a listener definition into a normalized Listener tuple.\n * If the first item is a string, it looks up the method on the node.\n *\n * @param {ReactiveNode | IoElement | EventTarget} node - The node instance containing potential method references\n * @param {ListenerDefinition} def - The listener definition to normalize\n * @return {Listener} Normalized [listener, options?] tuple\n */\nexport const listenerFromDefinition = (node: ReactiveNode | IoElement | EventTarget, def: ListenerDefinition): Listener => {\n  const handlerDef = def[0]\n  const options = def[1]\n\n  debug: {\n    if (typeof handlerDef !== 'string' && typeof handlerDef !== 'function') {\n      console.error('listenerFromDefinition: Listener must be a function or method name')\n    }\n    if (options) {\n      if (typeof options !== 'object') {\n        console.error('listenerFromDefinition: Listener options must be an object')\n      } else {\n        const invalidOptions = Object.keys(options).filter(k => !LISTENER_OPTIONS.includes(k))\n        if (invalidOptions.length > 0) {\n          console.error(`listenerFromDefinition: Invalid listener options: ${invalidOptions.join(', ')}`)\n        }\n      }\n    }\n    if (typeof handlerDef === 'string' && !(handlerDef in node)) {\n      console.error(`listenerFromDefinition: Method \"${handlerDef}\" not found on node`)\n    }\n  }\n\n  const handler = typeof handlerDef === 'string' ? (node as unknown as Record<string, AnyEventListener>)[handlerDef] : handlerDef\n\n  return options ? [handler, options] : [handler]\n}\n\n/**\n * Internal utility class responsible for handling listeners and dispatching events.\n * It makes events of all `ReactiveNode` class instances compatible with DOM events.\n * It maintains three independent lists of listeners:\n *  - `protoListeners` specified as `get Listeners()` return value of class.\n *  - `propListeners` specified as inline properties prefixed with \"@\".\n *  - `addedListeners` explicitly added/removed using `addEventListener()` and `removeEventListener()`.\n */\nexport class EventDispatcher {\n  readonly node: ReactiveNode | IoElement | EventTarget\n  readonly nodeIsEventTarget: boolean\n  readonly protoListeners: Listeners = {}\n  readonly propListeners: Listeners = {}\n  readonly addedListeners: Listeners = {}\n  /**\n   * Creates an instance of `EventDispatcher` for specified `ReactiveNode` instance.\n   * It initializes `protoListeners` from `ProtoChain`.\n   * @param {ReactiveNode | IoElement | EventTarget} node owner ReactiveNode\n   */\n  constructor(node: ReactiveNode | IoElement | EventTarget) {\n    this.node = node\n    this.nodeIsEventTarget = node instanceof EventTarget\n    this.setProtoListeners(node as ReactiveNode)\n  }\n\n  /**\n   * Sets `protoListeners` specified as `get Listeners()` class definitions.\n   * Definitions from subclass replace the ones from parent class.\n   * @param {ReactiveNode | IoElement} node owner ReactiveNode\n   */\n  setProtoListeners(node: ReactiveNode | IoElement) {\n    for (const name in node._protochain?.listeners) {\n      for (let i = 0; i < node._protochain.listeners[name].length; i++) {\n        const listener = listenerFromDefinition(node, node._protochain.listeners[name][i])\n        this.protoListeners[name] = [listener]\n      }\n      if (this.nodeIsEventTarget && this.protoListeners[name]) {\n        const listener = this.protoListeners[name][0]\n        EventTarget.prototype.addEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n      }\n    }\n  }\n  /**\n   * Sets `propListeners` specified as inline properties prefixed with \"@\".\n   * It removes existing `propListeners` that are no longer specified and it replaces the ones that changed.\n   * @param {Record<string, any>} properties - Inline properties\n   */\n  applyPropListeners(properties: Record<string, any>) {\n    // Create and object with new listeners\n    const newPropListeners: Listeners = {}\n    for (const prop in properties) {\n      if (!prop.startsWith('@')) continue\n\n      const name = prop.slice(1)\n      const definition = hardenListenerDefinition(properties[prop])\n      const listener = listenerFromDefinition(this.node, definition)\n      newPropListeners[name] = [listener]\n    }\n\n    // Remove listeners that are no longer specified\n    const propListeners = this.propListeners\n    for (const name in propListeners) {\n      if (!newPropListeners[name]) {\n        if (this.nodeIsEventTarget) {\n          const listener = propListeners[name][0]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n        delete propListeners[name]\n      }\n    }\n\n    // Add new listeners and remove old ones if they are different\n    for (const name in newPropListeners) {\n      if (this.nodeIsEventTarget) {\n        const newListener = newPropListeners[name][0]\n        if (propListeners[name]) {\n          const oldListener = propListeners[name][0]\n          if ((oldListener !== newListener || newListener[1] && (JSON.stringify(oldListener[1]) !== JSON.stringify(newListener[1])))) {\n            EventTarget.prototype.removeEventListener.call(this.node, name, oldListener[0] as EventListener, oldListener[1])\n          }\n        }\n        EventTarget.prototype.addEventListener.call(this.node, name, newListener[0] as EventListener, newListener[1])\n      }\n      propListeners[name] = newPropListeners[name]\n    }\n  }\n  /**\n   * Proxy for `addEventListener` method.\n   * Adds an event listener to the node's `addedListeners` collection.\n   * If the node is an EventTarget, also registers the listener with the DOM.\n   * @param {string} name - Name of the event\n   * @param {AnyEventListener} listener - Event listener handler\n   * @param {AddEventListenerOptions} [options] - Event listener options\n   */\n  addEventListener(name: string, listener: AnyEventListener, options?: AddEventListenerOptions) {\n    debug: {\n      if (typeof listener !== 'function') {\n        console.error('EventDispatcher.addEventListener: Invalid listener type - must be a function')\n      }\n      if (options) {\n        if (typeof options !== 'object') {\n          console.error('EventDispatcher.addEventListener: Invalid listener options type - must be an object')\n        } else {\n          const invalidOptions = Object.keys(options).filter(k => !LISTENER_OPTIONS.includes(k))\n          if (invalidOptions.length > 0) {\n            console.warn(`EventDispatcher.addEventListener: Invalid listener options: ${invalidOptions.join(', ')}`)\n          }\n        }\n      }\n    }\n\n    // Initialize listener array if needed\n    if (!this.addedListeners[name]) {\n      this.addedListeners[name] = []\n    }\n\n    // Check for duplicate listener\n    const existingIndex = this.addedListeners[name].findIndex(l => l[0] === listener)\n    if (existingIndex !== -1) {\n      debug: console.warn(`EventDispatcher.addEventListener: Listener for '${name}' event already added`, this.node)\n      return\n    }\n\n    // Create and store listener tuple\n    const listenerTuple: Listener = options ? [listener, options] : [listener]\n    this.addedListeners[name].push(listenerTuple)\n\n    if (this.nodeIsEventTarget) {\n      EventTarget.prototype.addEventListener.call(this.node, name, listener as EventListener, options)\n    }\n  }\n\n  /**\n   * Proxy for `removeEventListener` method.\n   * Removes an event listener from the node's `addedListeners` collection.\n   * If `listener` is not specified it removes all listeners for specified `type`.\n   * @param {string} name - Name of the event\n   * @param {AnyEventListener} listener - Event listener handler\n   * @param {AddEventListenerOptions} [options] - Event listener options\n  */\n  removeEventListener(name: string, listener?: AnyEventListener, options?: AddEventListenerOptions) {\n    debug: {\n      if (listener && typeof listener !== 'function') {\n        console.error('EventDispatcher.removeEventListener: Invalid listener type!')\n      }\n      if (options) {\n        if (typeof options !== 'object') {\n          console.error('EventDispatcher.removeEventListener: Invalid listener options type - must be an object')\n        } else {\n          const invalidOptions = Object.keys(options).filter(k => !LISTENER_OPTIONS.includes(k))\n          if (invalidOptions.length > 0) {\n            console.warn(`EventDispatcher.removeEventListener: Invalid listener options: ${invalidOptions.join(', ')}`)\n          }\n        }\n\n      }\n      if (!this.addedListeners[name]) {\n        console.error(`EventDispatcher.removeEventListener: Listener ${name} not found!`)\n      }\n    }\n\n    if (!this.addedListeners[name]) return\n\n    if (!listener) {\n      for (let i = 0; i < this.addedListeners[name].length; i ++) {\n        if (this.nodeIsEventTarget) {\n          const listener = this.addedListeners[name][i]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n      }\n      this.addedListeners[name].length = 0\n    } else {\n      const index = this.addedListeners[name].findIndex(item => item[0] === listener)\n      debug: if (index === -1) {\n        console.error(`EventDispatcher.removeEventListener: Listener ${name} not found!`)\n      }\n      if (index !== -1) {\n        this.addedListeners[name].splice(index, 1)\n        if (this.nodeIsEventTarget) {\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener as EventListener, options)\n        }\n      }\n    }\n\n    if (this.addedListeners[name].length === 0) {\n      delete this.addedListeners[name]\n    }\n  }\n  /**\n   * Shorthand for custom event dispatch.\n   * @param {string} name - Name of the event\n   * @param {any} detail - Event detail data\n   * @param {boolean} [bubbles] - Makes event bubble\n   * @param {ReactiveNode | IoElement | EventTarget} [node] - Event target override to dispatch the event from\n   */\n  dispatchEvent(name: string, detail?: any, bubbles = true, node: ReactiveNode | IoElement | EventTarget = this.node, path: Array<ReactiveNode | IoElement | EventTarget> = [], visited: Set<ReactiveNode | IoElement | EventTarget> = new Set()) {\n    if ((this.node as ReactiveNode)._disposed) return\n    if (visited.has(node)) return\n    visited.add(node)\n\n    path = [...path, node]\n\n    if ((node instanceof EventTarget)) {\n      const bubblesNative = bubbles && !hasVisitedDomAncestor(node, visited)\n      EventTarget.prototype.dispatchEvent.call(node, new CustomEvent(name, {detail: detail, bubbles: bubblesNative, composed: true, cancelable: true}))\n    } else {\n      const payload = {detail: detail, target: node, path: path}\n      if (this.protoListeners[name]) {\n        for (let i = 0; i < this.protoListeners[name].length; i ++) {\n          const handler = this.protoListeners[name][i][0] as IoEventListener\n          handler.call(node, payload)\n        }\n      }\n      if (this.propListeners[name]) {\n        debug: if (this.propListeners[name].length > 1) {\n          console.error(`EventDispatcher.dispathEvent: PropListeners[${name}] array too long!`)\n        }\n        const handler = this.propListeners[name][0][0] as IoEventListener\n        handler.call(node, payload)\n      }\n      if (this.addedListeners[name]) {\n        for (let i = 0; i < this.addedListeners[name].length; i ++) {\n          const handler = this.addedListeners[name][i][0] as IoEventListener\n          handler.call(node, payload)\n        }\n      }\n      if (bubbles) {\n        for (const parent of node._parents) {\n          if (((parent as ReactiveNode)._isNode || (parent as IoElement)._isIoElement) && !parent._disposed && !visited.has(parent)) {\n            // TODO: implement stopPropagation() and stopImmediatePropagation()\n            parent._eventDispatcher.dispatchEvent(name, detail, bubbles, parent, path, visited)\n          }\n        }\n      }\n    }\n  }\n  /**\n   * Disconnects all event listeners and removes all references for garbage collection.\n   * Use this when node is discarded.\n   */\n  dispose() {\n    for (const name in this.protoListeners) {\n      if (this.nodeIsEventTarget) {\n        for (let i = 0; i < this.protoListeners[name].length; i++) {\n          const listener = this.protoListeners[name][i]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n      }\n      this.protoListeners[name].length = 0\n      delete this.protoListeners[name]\n    }\n    for (const name in this.propListeners) {\n      if (this.nodeIsEventTarget) {\n        const listener = this.propListeners[name][0]\n        EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n      }\n      this.propListeners[name].length = 0\n      delete this.propListeners[name]\n    }\n    for (const name in this.addedListeners) {\n      if (this.nodeIsEventTarget) {\n        for (let i = this.addedListeners[name].length; i--;) {\n          const listener = this.addedListeners[name][i]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n      }\n      this.addedListeners[name].length = 0\n      delete this.addedListeners[name]\n    }\n    delete (this as any).node\n    delete (this as any).protoListeners\n    delete (this as any).propListeners\n    delete (this as any).addedListeners\n  }\n}"]}