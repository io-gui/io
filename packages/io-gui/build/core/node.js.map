{"version":3,"file":"node.js","sourceRoot":"","sources":["../../src/core/node.ts"],"names":[],"mappings":"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","sourcesContent":["import {ProtoChain} from './internals/protoChain';\nimport {Binding} from './internals/binding';\nimport {ChangeQueue} from './internals/changeQueue';\nimport {PropertyInstance, PropertyDefinitionLoose} from './internals/property';\nimport {EventDispatcher, ListenerDefinitionLoose, AnyEventListener} from './internals/eventDispatcher';\nimport { Register } from './decorators/register';\n\nexport type Constructor = new (...args: any[]) => unknown;\nexport type PropertyDefinitions = Record<string, PropertyDefinitionLoose>;\nexport type ListenerDefinitions = Record<string, ListenerDefinitionLoose>;\n\nexport interface IoNodeConstructor<T> {\n  new (...args: any[]): T;\n  Properties?: PropertyDefinitions;\n  Listeners?: ListenerDefinitions;\n  Style?: string;\n}\n\nexport type CallbackFunction = (arg?: any) => void;\n\ntype prefix<TKey, TPrefix extends string> = TKey extends string ? `${TPrefix}${TKey}` : never;\n\nexport type IoNodeArgs = {\n  reactivity?: 'none' | 'immediate' | 'debounced';\n  [key: prefix<string, '@'>]: string | ((event: CustomEvent<any>) => void)\n}\n\n/**\n * Core mixin for `Node` classes.\n * @param {function} superclass - Class to extend.\n * @return {function} - Extended class constructor with `IoNodeMixin` applied to it.\n */\nexport function IoNodeMixin<T extends IoNodeConstructor<any>>(superclass: T) {\n  return class IoNodeMixinConstructor extends (superclass as any) {\n    static get Properties(): PropertyDefinitions {\n      return {\n        reactivity: {\n          value: 'immediate',\n          type: String,\n        }\n      };\n    }\n    declare readonly _protochain: ProtoChain;\n    declare readonly _properties: Map<string, PropertyInstance>;\n    declare readonly _bindings: Map<string, Binding>;\n    declare readonly _changeQueue: ChangeQueue;\n    declare readonly _eventDispatcher: EventDispatcher;\n\n     /**\n     * Creates a class instance and initializes the internals.\n     * @overload\n     * @constructor\n     * @param {...any} args - Additional arguments\n     *\n     * Creates a class instance and initializes the internals with properties.\n     * @overload\n     * @constructor\n     * @param {IoNodeArgs} properties - Initial property values\n     * @param {...any} args - Additional arguments\n     */\n    constructor(...args: any[]);\n    constructor(properties: IoNodeArgs = {}, ...args: any[]) {\n      // eslint-disable-next-line constructor-super\n      super(...args);\n\n      if (this._isIoElement) {\n        Object.defineProperty(this, '$', {\n          value: {},\n          writable: true,\n          enumerable: false,\n        });\n      }\n\n      debug: {\n        const constructor = Object.getPrototypeOf(this).constructor;\n        if (this._protochain.constructors[0] !== constructor) {\n          console.error(`${constructor.name} not registered! Call \"Register([ClassName])\" of @Register decorator before using ${constructor.name} class!`);\n        }\n      }\n\n      this._protochain.autobindHandlers(this);\n\n      Object.defineProperty(this, '_changeQueue', {enumerable: false, configurable: true, value: new ChangeQueue(this)});\n      Object.defineProperty(this, '_properties', {enumerable: false, configurable: true, value: new Map()});\n      Object.defineProperty(this, '_bindings', {enumerable: false, configurable: true, value: new Map()});\n      Object.defineProperty(this, '_eventDispatcher', {enumerable: false, configurable: true, value: new EventDispatcher(this)});\n\n      for (const name in this._protochain.properties) {\n        Object.defineProperty(this, name, {\n          get: function() {\n            return this._properties.get(name).value;\n          },\n          set: function(value) {\n            (this as IoNode).setProperty(name, value);\n          },\n          configurable: true,\n          enumerable: true,\n        });\n      }\n\n      for (const name in this._protochain.properties) {\n        const property = new PropertyInstance(this, this._protochain.properties[name]);\n        this._properties.set(name, property);\n\n        if (property.binding) property.binding.addTarget(this, name);\n        if (property.value?._isIoNode) {\n          property.value.addEventListener('object-mutated', this.onPropertyMutated);\n        }\n      }\n\n      this.applyProperties(properties);\n\n      if (this._protochain.observedObjectProperties.length) {\n        window.addEventListener('object-mutated', this.onPropertyMutated as EventListener);\n      }\n\n      this.init();\n    }\n    /**\n     * Sets multiple properties in batch.\n     * [property]-changed` events will be broadcast in the end.\n     * @param {Object} props - Map of property names and values.\n     */\n    applyProperties(props: any) {\n      for (const name in props) {\n        if (!this._properties.has(name)) {\n          // TODO: document!\n          debug: if (!name.startsWith('@') && name !== 'style' && name !== 'config' && name !== '$') {\n            console.warn(`Property \"${name}\" is not defined`, this);\n          }\n          continue;\n        }\n        this.setProperty(name, props[name], true);\n      }\n      this._eventDispatcher.applyPropListeners(props);\n      this.dispatchQueue();\n    }\n    /**\n     * Sets multiple properties in batch.\n     * [property]-changed` events will be broadcast in the end.\n     * @param {Object} props - Map of property names and values.\n     */\n    setProperties(props: any) {\n      for (const name in props) {\n        if (!this._properties.has(name)) {\n          debug: console.warn(`Property \"${name}\" is not defined`, this);\n          continue;\n        }\n        this.setProperty(name, props[name], true);\n      }\n      this.dispatchQueue();\n    }\n    /**\n     * Sets the property value, connects the bindings and sets attributes for properties with attribute reflection enabled.\n     * @param {string} name Property name to set value of.\n     * @param {any} value Peroperty value.\n     * @param {boolean} [debounce] flag to skip event dispatch.\n     */\n    setProperty(name: string, value: any, debounce = false) {\n      const prop = this._properties.get(name)!;\n      const oldValue = prop.value;\n\n      if (value !== oldValue) {\n        const binding = (value instanceof Binding) ? value : null;\n        if (binding) {\n          const oldBinding = prop.binding;\n          if (binding !== oldBinding) {\n            if (oldBinding) {\n              oldBinding.removeTarget(this, name);\n            }\n            binding.addTarget(this, name);\n            // NOTE: We return here because binding.setTarget() will trigger execution of setProperty() again.\n            return;\n          } else {\n            // NOTE: This was a remedy for an old bug that might not be relevant anymore.\n            // Whenusing change() > template() > setProperties() to batch-set multiple properties with bindings,\n            // it used to cause all but one of those properties to be reset to original value once parent changed.\n            // This ugly hack fixed the bug by setting binding value from target when binding already exists.\n            // TODO: keep an eye on this and remove if not needed.\n            // binding.value = value = prop.value;\n            return;\n          }\n        }\n\n        prop.value = value;\n\n        // TODO: test removal of event listeners.\n        if (value !== oldValue) {\n          if (value?._isIoNode) {\n            value.addEventListener('object-mutated', this.onPropertyMutated);\n          }\n          if (oldValue?._isIoNode) {\n            oldValue.removeEventListener('object-mutated', this.onPropertyMutated);\n          }\n        }\n\n        debug: {\n          if (prop.type === String) {\n            if (typeof value !== 'string') {\n              console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, this);\n            }\n          } else if (prop.type === Number) {\n            if (typeof value !== 'number') {\n              console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, this);\n            }\n          } else if (prop.type === Boolean) {\n            if (typeof value !== 'boolean') {\n              console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, this);\n            }\n          } else if (prop.type === Array) {\n            if (!(value instanceof Array)) {\n              console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, this);\n            }\n          } else if (prop.type === Object) {\n            if (value instanceof Array) {\n              console.warn(`Wrong type of property \"${name}\". Value: \"${JSON.stringify(value)}\". Expected type: ${prop.type.name}`, this);\n            }\n          } else if (typeof prop.type === 'function') {\n            if (!(value instanceof prop.type)) {\n              console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, this);\n            }\n          }\n        }\n        if (oldValue !== value) {\n          this.queue(name, value, oldValue);\n          this.dispatchQueue(debounce);\n        }\n      }\n    }\n    /**\n     * Sets value property and emits `value-input` event.\n     * Use this when value property is set by user action (e.g. mouse click).\n     * @param {*} value - Property value.\n     */\n    inputValue(value: any) {\n      if (this.value !== value || typeof this.value === 'object') {\n        const oldValue = this.value;\n        this.setProperty('value', value);\n        this.dispatchEvent('value-input', {value: value, oldValue: oldValue}, false);\n      }\n    }\n    /**\n     * default change handler.\n     * Invoked when one of the properties change.\n     */\n\n    changed() {}\n\n    init() {}\n    /**\n     * Adds property change to the queue.\n     * @param {string} name - Property name.\n     * @param {*} value - Property value.\n     * @param {*} oldValue - Old property value.\n     */\n    queue(name: string, value: any, oldValue: any) {\n      if (this.reactivity === 'none') return;\n      this._changeQueue.queue(name, value, oldValue);\n    }\n    /**\n     * Dispatches the queue in the next rAF cycle if `reactivity` property is set to `\"debounced\"`. Otherwise it dispatches the queue immediately.\n     */\n    dispatchQueue(debounce = false) {\n      if (this.reactivity === 'debounced' || debounce || this._changeQueue.dispatching) {\n        this.debounce(this._changeQueue.dispatch);\n      } else if (this.reactivity === 'immediate') {\n        this._changeQueue.dispatch();\n      }\n      debug: if (['none', 'immediate', 'debounced'].indexOf(this.reactivity) === -1) {\n        console.warn(`IoNode.dispatchQueue(): Invalid reactivity property value: \"${this.reactivity}\". Expected one of: \"none\", \"immediate\", \"debounced\".`);\n      }\n    }\n    /**\n     * Throttles function execution once per frame (rAF).\n     * @param {function} func - Function to throttle.\n     * @param {*} arg - argument for throttled function.\n     */\n    throttle(func: CallbackFunction, arg: any = undefined) {\n      throttle(this, func, arg, 0);\n    }\n    /**\n     * Debounces function execution to next frame (rAF).\n     * @param {function} func - Function to throttle.\n     * @param {*} arg - argument for debounced function.\n     * @param {number} timeout - minimum delay in ms before executing the function.\n     */\n    debounce(func: CallbackFunction, arg: any = undefined, timeout = 1) {\n      throttle(this, func, arg, timeout);\n    }\n    /**\n     * Event handler for 'object-mutated' events emitted from the properties which are IoNode instances.\n     * Aditionally, it handles events emitted from the `window` object (used for observing non-IoNode object properties).\n     * NOTE: non-IoNode objects don't emit 'object-mutated' event automatically - something needs to emit this for them.\n     * This is used to evoke '[propName]Mutated()' mutation handler\n     * @param {Object} event - Event payload.\n     * @param {EventTarget} event.target - Node that emitted the event.\n     * @param {IoNode} event.detail.object - Mutated node.\n     */\n    onPropertyMutated(event: CustomEvent) {\n      const object = event.detail.object;\n      // TODO: consider situations where node is listening to object-mutated events from multiple sources (window and property).\n      // This might cause multiple executions of the same handler.\n      // TODO: consider optimizing. This handler might be called a lot.\n      const properties = [...new Set([...this._protochain.observedObjectProperties, ...this._protochain.observedIoNodeProperties])];\n      for (let i = 0; i < properties.length; i++) {\n        const name = properties[i];\n        const value = this._properties.get(name)!.value;\n        if (value === object) {\n          if (typeof this[name + 'Mutated'] === 'function') {\n            this.throttle(this[name + 'Mutated']);\n          }\n          return;\n        }\n      }\n    };\n    /**\n     * Returns a binding to a specified property`.\n     * @param {string} name - Property name to bind to.\n     * @return {Binding} Binding object.\n     */\n    bind(name: string): Binding {\n      debug: if (!this._properties.has(name)) {\n        console.warn(`IoGUI Node: cannot bind to ${name} property. Does not exist!`);\n      }\n      if (!this._bindings.has(name)) {\n        this._bindings.set(name, new Binding(this, name));\n      }\n      return this._bindings.get(name) as Binding;\n    }\n    /**\n     * Unbinds a binding to a specified property`.\n     * @param {string} name - Property name to unbind.\n     */\n    unbind(name: string) {\n      const binding = this._bindings.get(name);\n      if (binding) {\n        binding.dispose();\n        this._bindings.delete(name);\n      }\n\n      const property = this._properties.get(name);\n      property?.binding?.removeTarget(this, name);\n    }\n    /**\n     * Wrapper for addEventListener.\n     * @param {string} type - listener name.\n     * @param {function} listener - listener handler.\n     * @param {Object} options - event listener options.\n     */\n    addEventListener(type: string, listener: AnyEventListener, options?: AddEventListenerOptions) {\n      debug: if (typeof listener !== 'function') {\n        console.warn(`${this.constructor.name}incorrect listener type.`, this);\n        return;\n      }\n      this._eventDispatcher.addEventListener(type, listener as EventListener, options);\n    }\n    /**\n     * Wrapper for removeEventListener.\n     * @param {string} type - event name to listen to.\n     * @param {function} listener - listener handler.\n     * @param {Object} options - event listener options.\n     */\n    removeEventListener(type: string, listener?: AnyEventListener, options?: AddEventListenerOptions) {\n      this._eventDispatcher.removeEventListener(type, listener as EventListener, options);\n    }\n    /**\n     * Wrapper for dispatchEvent.\n     * @param {string} type - event name to dispatch.\n     * @param {Object} detail - event detail.\n     * @param {boolean} bubbles - event bubbles.\n     * @param {HTMLElement|Node} src source node/element to dispatch event from.\n     */\n    dispatchEvent(type: string, detail: any = undefined, bubbles = false, src?: Node | HTMLElement | Document | Window) {\n      this._eventDispatcher.dispatchEvent(type, detail, bubbles, src);\n    }\n    /**\n     * Disposes all internals.\n     * Use this when instance is no longer needed.\n     */\n    dispose() {\n      debug: if (this._disposed) {\n        // TODO: figure out how to prevent redundant disposals from nested io-selectors with cache:false\n        // console.warn('IoNode.dispose(): Already disposed!', this.constructor.name);\n      }\n      if (this._disposed) return;\n\n      this._bindings.forEach((binding, name) => {\n        binding.dispose();\n        this._bindings.delete(name);\n      });\n      delete (this as any)._bindings;\n\n      if (this._protochain.observedObjectProperties.length) {\n        window.removeEventListener('object-mutated', this.onPropertyMutated as EventListener);\n      }\n      delete (this as any)._protochain;\n\n      this._changeQueue.dispose();\n      delete (this as any)._changeQueue;\n\n      this._properties.forEach((property, name) => {\n        property.binding?.removeTarget(this, name);\n        if (property.value?._isIoNode) {\n          property.value.removeEventListener('object-mutated', this.onPropertyMutated);\n        }\n      });\n\n      // NOTE: _eventDispatcher.dispose must happen AFTER disposal of bindings!\n      this._eventDispatcher.dispose();\n      delete (this as any)._eventDispatcher;\n      delete (this as any)._properties;\n\n      Object.defineProperty(this, '_disposed', {value: true});\n    }\n    Register(ioNodeConstructor: typeof IoNode) {\n      Object.defineProperty(ioNodeConstructor, '_isIoNode', {enumerable: false, value: true});\n      Object.defineProperty(ioNodeConstructor.prototype, '_isIoNode', {enumerable: false, value: true});\n      Object.defineProperty(ioNodeConstructor.prototype, '_protochain', {value: new ProtoChain(ioNodeConstructor)});\n    }\n  };\n}\n\n/**\n * IoNodeMixin applied to `Object` class.\n */\n@Register\nexport class IoNode extends IoNodeMixin(Object) {}\n\ninterface QueueOptions {\n  node: IoNode | undefined;\n  arg: any;\n  timeout: number;\n}\n\nconst throttleQueueSync: CallbackFunction[] = [];\nconst throttleQueue0: CallbackFunction[] = [];\nconst throttleQueue1: CallbackFunction[] = [];\nconst throttleQueueOptions0: WeakMap<CallbackFunction, QueueOptions> = new WeakMap();\nconst throttleQueueOptions1: WeakMap<CallbackFunction, QueueOptions> = new WeakMap();\nlet throttleQueue = throttleQueue0;\nlet throttleQueueOptions = throttleQueueOptions0;\n\nexport async function nextQueue(): Promise<void> {\n  return new Promise((resolve) => {\n    throttleQueue.push(resolve);\n    throttleQueueOptions.set(resolve, {\n      arg: undefined,\n      timeout: Date.now() + 1,\n      node: undefined,\n    });\n  });\n}\n\nfunction throttle(node: IoNode, func: CallbackFunction, arg: any = undefined, timeout = 1) {\n  if (timeout === 0) {\n    if (throttleQueueSync.indexOf(func) === -1) {\n      throttleQueueSync.push(func);\n      try {\n        func(arg);\n      } catch (e) {\n        console.error(e);\n      }\n      return;\n    } else {\n      timeout = 1;\n    }\n  }\n  if (throttleQueue.indexOf(func) === -1) {\n    throttleQueue.push(func);\n  }\n  if (!throttleQueueOptions.has(func)) {\n    throttleQueueOptions.set(func, {\n      node: node,\n      arg: arg,\n      timeout: Date.now() + timeout,\n    });\n  } else {\n    throttleQueueOptions.get(func)!.arg = arg;\n    // throttleQueueOptions.get(func)!.timeout = Date.now() + timeout;\n  }\n}\n\nfunction animate () {\n  throttleQueueSync.length = 0;\n\n  const activeThrottleQueue = throttleQueue;\n  const activeThrottleQueueOptions = throttleQueueOptions;\n  throttleQueue = throttleQueue === throttleQueue0 ? throttleQueue1 : throttleQueue0;\n  throttleQueueOptions = throttleQueueOptions === throttleQueueOptions0 ? throttleQueueOptions1 : throttleQueueOptions0;\n\n  const time = Date.now();\n  for (let i = 0; i < activeThrottleQueue.length; i++) {\n    const func = activeThrottleQueue[i];\n    const options = activeThrottleQueueOptions.get(func)!;\n    activeThrottleQueueOptions.delete(func);\n\n    if (options === undefined) {\n      console.warn(func);\n    }\n    if (options.timeout > time) {\n      if (throttleQueue.indexOf(func) === -1) {\n        throttleQueue.push(func);\n      }\n      throttleQueueOptions.set(func, options);\n      continue;\n    }\n\n    if (options.node?._disposed) continue;\n    try {\n      if (options.arg !== undefined) func(options.arg);\n      else func();\n    } catch (e) {\n      console.error(e);\n    }\n  }\n  activeThrottleQueue.length = 0;\n  requestAnimationFrame(animate);\n}\nrequestAnimationFrame(animate);\n"]}