{"version":3,"file":"IoPanel.js","sourceRoot":"","sources":["../../src/elements/IoPanel.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAE,QAAQ,EAAE,SAAS,EAA+B,gBAAgB,EAAE,QAAQ,EAAE,MAAM,SAAS,CAAC;AACvG,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAC3C,OAAO,EAAc,UAAU,EAAE,MAAM,UAAU,CAAC;AAClD,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAC;AAErC,OAAO,EAAE,GAAG,EAAE,MAAM,iBAAiB,CAAC;AAGtC,OAAO,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AASlC,IAAM,OAAO,GAAb,MAAM,OAAQ,SAAQ,SAAS;IACpC,MAAM,KAAK,KAAK;QACd,OAAO,SAAS,CAAA;;;;;;;;;;;;;KAaf,CAAC;IACJ,CAAC;IAWD,MAAM,KAAK,SAAS;QAClB,OAAO;YACL,aAAa,EAAE,WAAW;SAC3B,CAAC;IACJ,CAAC;IAED,SAAS,CAAC,KAAkB;QAC1B,KAAK,CAAC,eAAe,EAAE,CAAC;QACxB,MAAM,GAAG,GAAQ,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;QAClC,MAAM,GAAG,GAAG,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;QAC7B,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAC3C,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE,CAAC;YACjB,KAAK,EAAE,OAAO,CAAC,IAAI,CAAC,+BAA+B,EAAE,GAAG,CAAC,CAAC;YAC1D,OAAO;QACT,CAAC;QACD,QAAQ,GAAG,EAAE,CAAC;YACZ,KAAK,QAAQ,CAAC,CAAC,CAAC;gBACd,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;gBACpB,MAAM;YACR,CAAC;YACD,KAAK,WAAW,CAAC,CAAC,CAAC;gBACjB,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;gBACpB,MAAM;YACR,CAAC;YACD,KAAK,WAAW,CAAC,CAAC,CAAC;gBACjB,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;gBAC7B,MAAM;YACR,CAAC;YACD,KAAK,YAAY,CAAC,CAAC,CAAC;gBAClB,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;gBAC7B,MAAM;YACR,CAAC;YACD,KAAK,SAAS,CAAC,CAAC,CAAC;gBACf,mDAAmD;gBACnD,MAAM;YACR,CAAC;YACD,KAAK,WAAW,CAAC,CAAC,CAAC;gBACjB,mDAAmD;gBACnD,MAAM;YACR,CAAC;QACH,CAAC;IACH,CAAC;IACD,IAAI;QACF,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC7D,CAAC;IACD,eAAe,CAAC,KAAkB;QAChC,KAAK,CAAC,eAAe,EAAE,CAAC;QACxB,MAAM,MAAM,GAAe,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC;QAC/C,IAAI,MAAM,CAAC,EAAE,IAAI,MAAM,CAAC,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAC7C,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,EAAC,EAAE,EAAE,MAAM,CAAC,EAAE,EAAE,KAAK,EAAE,MAAM,CAAC,KAAK,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAC,CAAC,CAAC;YAC7E,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACjB,MAAM,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,UAAU,CAAe,CAAC;YACnE,IAAI,aAAa;gBAAE,aAAa,CAAC,QAAQ,GAAG,KAAK,CAAC;QACpD,CAAC;IACH,CAAC;IACD,WAAW,CAAC,KAAa;QACvB,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACpD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;QAClD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,iBAAiB,EAAE,KAAK,CAAC,CAAC;IAC/C,CAAC;IACD,SAAS,CAAC,GAAQ;QAChB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAC3C,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QAC/B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,iBAAiB,EAAE,KAAK,CAAC,CAAC;IAC/C,CAAC;IACD,cAAc,CAAC,WAAoB,EAAE,GAAQ,EAAE,SAAyB;QACtE,MAAM,WAAW,GAAG,IAAI,CAAC,aAAwB,CAAC;QAClD,IAAI,SAAS,KAAK,QAAQ,EAAE,CAAC;YAC3B,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;YAC3B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QACnB,CAAC;aAAM,CAAC;YACN,WAAW,CAAC,cAAc,CAAC,WAAW,EAAE,IAAI,CAAC,KAAK,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC;QACtE,CAAC;IACH,CAAC;IACD,MAAM,CAAC,GAAQ,EAAE,KAAc;QAC7B,MAAM,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,GAAG,CAAC,EAAE,CAAC,CAAC;QACtE,IAAI,aAAa,KAAK,CAAC,CAAC,EAAE,CAAC;YACzB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC;QAC3C,CAAC;QACD,KAAK,GAAG,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC;QACxC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;QACtC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;IAC1B,CAAC;IACD,SAAS,CAAC,GAAQ;QAChB,oFAAoF;QACpF,MAAM,WAAW,GAAG,IAAI,CAAC,aAAwB,CAAC;QAClD,MAAM,iBAAiB,GAAG,CAAC,WAAW,CAAC,aAAa,YAAY,QAAQ,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC;QAC7G,IAAI,iBAAiB,IAAI,WAAW,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACjG,OAAO;QACT,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAC3C,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QACjC,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC/B,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YAC7D,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QAC7B,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE,EAAC,KAAK,EAAE,IAAI,CAAC,KAAK,EAAC,EAAE,IAAI,CAAC,CAAC;QAC9D,CAAC;IACH,CAAC;IACD,OAAO,CAAC,GAAQ,EAAE,KAAa;QAC7B,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACjE,MAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,GAAG,CAAC,EAAE,CAAC,CAAC;QAClE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;QACrC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;QACtC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;IAC1B,CAAC;IACD,iBAAiB,CAAC,KAAa;QAC7B,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAkB,CAAC;QAC1E,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACzC,IAAI,IAAI,CAAC,KAAK,CAAC;YAAE,IAAI,CAAC,KAAK,CAAC,CAAC,KAAK,EAAE,CAAC;IACvC,CAAC;IACD,YAAY;QACV,IAAI,CAAC,OAAO,EAAE,CAAC;IACjB,CAAC;IACD,OAAO;QACL,IAAI,CAAC,MAAM,CAAC;YACV,MAAM,CAAC;gBACL,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI;gBACrB,aAAa,EAAE,IAAI,CAAC,aAAa;gBACjC,yBAAyB,EAAE,IAAI,CAAC,eAAe;aAChD,CAAC;YACF,UAAU,CAAC;gBACT,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE;gBAClC,QAAQ,EAAE,IAAI,CAAC,QAAQ;gBACvB,MAAM,EAAE,EAAE;aACX,CAAC;SACH,CAAC,CAAC;IACL,CAAC;CACF,CAAA;AA3IS;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,MAAM,EAAC,CAAC;sCACZ;AAGb;IADP,gBAAgB,CAAC,KAAK,CAAC;yCACQ;AAGhB;IADf,QAAQ,CAAC,UAAU,CAAC;8CACqB;AAzB/B,OAAO;IADnB,QAAQ;GACI,OAAO,CA8JnB;;AACD,MAAM,CAAC,MAAM,OAAO,GAAG,UAAS,IAAkB;IAChD,OAAO,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;AACpC,CAAC,CAAC","sourcesContent":["import { Register, IoElement, VDOMElement, IoElementProps, ReactiveProperty, Property } from 'io-core';\nimport { ioSelector } from 'io-navigation';\nimport { IoMenuItem, MenuOption } from 'io-menus';\nimport { ioTabs } from './IoTabs.js';\nimport { IoSplit } from './IoSplit.js';\nimport { Tab } from '../nodes/Tab.js';\nimport { Panel } from '../nodes/Panel.js';\nimport { SplitDirection } from '../nodes/Split.js';\nimport { IoLayout } from './IoLayout.js';\n\nexport type IoPanelProps = IoElementProps & {\n  panel: Panel,\n  elements: VDOMElement[],\n  addMenuOption: MenuOption,\n};\n\n@Register\nexport class IoPanel extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        overflow: hidden;\n        flex-direction: column;\n        flex: 1 1 auto;\n        background-color: var(--io_bgColorLight);\n      }\n      :host > io-selector {\n        margin-top: calc(-1 * var(--io_borderWidth));\n        border-top: var(--io_border);\n        border-top-color: var(--io_borderColorStrong);\n      }\n    `;\n  }\n\n  @ReactiveProperty({type: Object})\n  declare panel: Panel;\n\n  @ReactiveProperty(Array)\n  declare elements: VDOMElement[];\n\n  @Property(MenuOption)\n  declare private addMenuOption: MenuOption;\n\n  static get Listeners() {\n    return {\n      'io-edit-tab': 'onEditTab',\n    };\n  }\n\n  onEditTab(event: CustomEvent) {\n    event.stopPropagation();\n    const tab: Tab = event.detail.tab;\n    const key = event.detail.key;\n    const index = this.panel.tabs.indexOf(tab);\n    if (index === -1) {\n      debug: console.warn('IoTabs:Tab not found in panel', tab);\n      return;\n    }\n    switch (key) {\n      case 'Select': {\n        this.selectTab(tab);\n        break;\n      }\n      case 'Backspace': {\n        this.removeTab(tab);\n        break;\n      }\n      case 'ArrowLeft': {\n        this.moveTab(tab, index - 1);\n        break;\n      }\n      case 'ArrowRight': {\n        this.moveTab(tab, index + 1);\n        break;\n      }\n      case 'ArrowUp': {\n        // TODO: move tab to panel above or split the panel\n        break;\n      }\n      case 'ArrowDown': {\n        // TODO: move tab to panel below or split the panel\n        break;\n      }\n    }\n  }\n  init() {\n    this.focusTabDebounced = this.focusTabDebounced.bind(this);\n  }\n  onNewTabClicked(event: CustomEvent) {\n    event.stopPropagation();\n    const option: MenuOption = event.detail.option;\n    if (option.id && option.options.length === 0) {\n      const tab = new Tab({id: option.id, label: option.label, icon: option.icon});\n      this.addTab(tab);\n      const addMenuOption = this.querySelector('.add-tab') as IoMenuItem;\n      if (addMenuOption) addMenuOption.expanded = false;\n    }\n  }\n  selectIndex(index: number) {\n    index = Math.min(index, this.panel.tabs.length - 1);\n    this.panel.setSelected(this.panel.tabs[index].id);\n    this.debounce(this.focusTabDebounced, index);\n  }\n  selectTab(tab: Tab) {\n    const index = this.panel.tabs.indexOf(tab);\n    this.panel.setSelected(tab.id);\n    this.debounce(this.focusTabDebounced, index);\n  }\n  moveTabToSplit(sourcePanel: IoPanel, tab: Tab, direction: SplitDirection) {\n    const parentSplit = this.parentElement as IoSplit;\n    if (direction === 'center') {\n      sourcePanel.removeTab(tab);\n      this.addTab(tab);\n    } else {\n      parentSplit.moveTabToSplit(sourcePanel, this.panel, tab, direction);\n    }\n  }\n  addTab(tab: Tab, index?: number) {\n    const existingIndex = this.panel.tabs.findIndex(t => t.id === tab.id);\n    if (existingIndex !== -1) {\n      this.panel.tabs.splice(existingIndex, 1);\n    }\n    index = index ?? this.panel.tabs.length;\n    index = Math.min(index, this.panel.tabs.length);\n    this.panel.tabs.splice(index, 0, tab);\n    this.selectIndex(index);\n  }\n  removeTab(tab: Tab) {\n    // Prevent removing the last tab from a layout with only one split, panel and a tab.\n    const parentSplit = this.parentElement as IoSplit;\n    const grandParentLayout = (parentSplit.parentElement instanceof IoLayout) ? parentSplit.parentElement : null;\n    if (grandParentLayout && parentSplit.split.children.length === 1 && this.panel.tabs.length === 1) {\n      return;\n    }\n\n    const index = this.panel.tabs.indexOf(tab);\n    this.panel.tabs.splice(index, 1);\n    if (this.panel.tabs.length > 0) {\n      const newIndex = Math.min(index, this.panel.tabs.length - 1);\n      this.selectIndex(newIndex);\n    } else {\n      this.dispatch('io-panel-remove', {panel: this.panel}, true);\n    }\n  }\n  moveTab(tab: Tab, index: number) {\n    index = Math.max(Math.min(index, this.panel.tabs.length - 1), 0);\n    const currIndex = this.panel.tabs.findIndex(t => t.id === tab.id);\n    this.panel.tabs.splice(currIndex, 1);\n    index = Math.min(index, this.panel.tabs.length);\n    this.panel.tabs.splice(index, 0, tab);\n    this.selectIndex(index);\n  }\n  focusTabDebounced(index: number) {\n    const tabs = Array.from(this.querySelectorAll('io-tab')) as HTMLElement[];\n    index = Math.min(index, tabs.length - 1);\n    if (tabs[index]) tabs[index].focus();\n  }\n  panelMutated() {\n    this.changed();\n  }\n  changed() {\n    this.render([\n      ioTabs({\n        tabs: this.panel.tabs,\n        addMenuOption: this.addMenuOption,\n        '@io-menu-option-clicked': this.onNewTabClicked,\n      }),\n      ioSelector({\n        selected: this.panel.getSelected(),\n        elements: this.elements,\n        anchor: '',\n      })\n    ]);\n  }\n}\nexport const ioPanel = function(arg0: IoPanelProps) {\n  return IoPanel.vConstructor(arg0);\n};"]}