{"version":3,"file":"index.js","sources":["../src/nodes/ThreeState.ts","../src/nodes/ViewCameras.ts","../src/elements/IoThreeViewport.ts"],"sourcesContent":["import { Register, Node, ReactiveProperty } from '@io-gui/core'\nimport { Scene, WebGPURenderer } from 'three/webgpu'\n\n@Register\nexport class ThreeState extends Node {\n\n  @ReactiveProperty({type: Scene, init: null})\n  declare scene: Scene\n\n  public renderer: WebGPURenderer | null = null\n\n  public width: number = 0\n  public height: number = 0\n\n  setViewportSize(width: number, height: number) {\n    if (this.width !== width || this.height !== height) {\n      if (!!width && !!height) {\n        this.width = width\n        this.height = height\n        this.onResized(width, height)\n      }\n    }\n\n  }\n  isRendererInitialized() {\n    return !!this.renderer && this.renderer.initialized === true\n  }\n  onRendererInitialized(renderer: WebGPURenderer) {\n    this.renderer = renderer\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onResized(width: number, height: number) {}\n  onAnimate() {}\n}","import { Register, Node, ReactiveProperty, Property, NodeProps, Binding } from '@io-gui/core'\nimport { IoThreeViewport } from '../elements/IoThreeViewport.js'\nimport { ThreeState } from './ThreeState.js'\nimport { Box3, Camera, Object3D, OrthographicCamera, PerspectiveCamera, Sphere, Vector3 } from 'three/webgpu'\nimport { OrbitControls } from 'three/addons/controls/OrbitControls.js'\n\nconst box = new Box3()\nconst sphere = new Sphere()\nconst center = new Vector3()\nconst delta = new Vector3()\n\nfunction setAspect(camera: PerspectiveCamera | OrthographicCamera, width: number, height: number) {\n  const aspect = width / height\n  if (camera instanceof PerspectiveCamera) {\n    camera.aspect = aspect\n  } else if (camera instanceof OrthographicCamera) {\n    const frustumHeight = camera.top - camera.bottom\n    camera.left = - frustumHeight * aspect / 2\n    camera.right = frustumHeight * aspect / 2\n  }\n  camera.updateProjectionMatrix()\n}\n\nclass DefaultCameras {\n  public perspective: PerspectiveCamera\n  public top: OrthographicCamera\n  public bottom: OrthographicCamera\n  public left: OrthographicCamera\n  public right: OrthographicCamera\n  public front: OrthographicCamera\n  public back: OrthographicCamera\n  constructor() {\n    this.perspective = new PerspectiveCamera(75, 1, 0.1, 1000)\n    this.top = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.bottom = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.left = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.right = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.front = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.back = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n\n    this.perspective.position.set(0.5, 0.25, 1)\n    this.perspective.lookAt(0, 0, 0)\n    this.perspective.name = 'perspective'\n\n    this.top.userData.position = new Vector3(0, 1, 0)\n    this.top.position.copy(this.top.userData.position)\n    this.top.lookAt(0, 0, 0)\n    this.top.name = 'top'\n\n    this.bottom.userData.position = new Vector3(0, -1, 0)\n    this.bottom.position.copy(this.bottom.userData.position)\n    this.bottom.lookAt(0, 0, 0)\n    this.bottom.name = 'bottom'\n\n    this.left.userData.position = new Vector3(-1, 0, 0)\n    this.left.position.copy(this.left.userData.position)\n    this.left.lookAt(0, 0, 0)\n    this.left.name = 'left'\n\n    this.right.userData.position = new Vector3(1, 0, 0)\n    this.right.position.copy(this.right.userData.position)\n    this.right.lookAt(0, 0, 0)\n    this.right.name = 'right'\n\n    this.front.userData.position = new Vector3(0, 0, 1)\n    this.front.position.copy(this.front.userData.position)\n    this.front.lookAt(0, 0, 0)\n    this.front.name = 'front'\n\n    this.back.userData.position = new Vector3(0, 0, -1)\n    this.back.position.copy(this.back.userData.position)\n    this.back.lookAt(0, 0, 0)\n    this.back.name = 'back'\n  }\n  get cameras() {\n    return [this.perspective, this.top, this.bottom, this.left, this.right, this.front, this.back]\n  }\n  getCamera(name: string) {\n    return this.cameras.find(camera => camera.name === name)\n  }\n}\n\n\n\nexport type ViewCamerasProps = NodeProps & {\n  viewport: IoThreeViewport\n  state: ThreeState\n  cameraSelect: string | Binding<string>\n}\n\n@Register\nexport class ViewCameras extends Node {\n  @Property(0)\n  declare private width: number\n  @Property(0)\n  declare private height: number\n\n  @Property()\n  declare private viewport: IoThreeViewport\n\n  @ReactiveProperty({type: ThreeState})\n  declare public state: ThreeState\n\n  @ReactiveProperty({type: String, value: 'perspective'})\n  declare public cameraSelect: string\n\n  @ReactiveProperty({type: Camera})\n  declare public camera: PerspectiveCamera | OrthographicCamera\n\n  @ReactiveProperty({type: DefaultCameras, init: null})\n  declare private readonly defaultCameras: DefaultCameras\n\n  @ReactiveProperty({type: OrbitControls, init: ['this.defaultCameras.perspective']})\n  declare private readonly orbitControls: OrbitControls\n\n  constructor(args: ViewCamerasProps) {\n    super(args)\n\n    this.orbitControls.connect(this.viewport)\n    this.orbitControls.addEventListener('change', () => {\n      this.state.dispatchMutation()\n    })\n\n    if (this.camera === undefined) this.camera = this.defaultCameras.perspective\n  }\n\n  cameraSelectChanged() {\n    if (this.cameraSelect.startsWith('scene')) {\n      const cameraId = this.cameraSelect.split(':')[1] || ''\n      const persp = this.state.scene.getObjectsByProperty('isPerspectiveCamera', true)\n      const ortho = this.state.scene.getObjectsByProperty('isOrthographicCamera', true)\n      const cameras = [...persp, ...ortho]\n\n      let matchedCamera: PerspectiveCamera | OrthographicCamera | undefined\n      if (cameraId) {\n        matchedCamera = cameras.find(camera => camera.name === cameraId) as PerspectiveCamera | OrthographicCamera | undefined\n      } else {\n        matchedCamera = cameras[0] as PerspectiveCamera | OrthographicCamera | undefined\n      }\n      if (matchedCamera) {\n        this.camera = matchedCamera\n      } else {\n        this.camera = this.defaultCameras.perspective\n        console.warn(`Camera ${cameraId} not found in the scene, using default perspective camera`)\n      }\n    } else {\n      this.camera = this.defaultCameras.getCamera(this.cameraSelect) || this.defaultCameras.perspective\n    }\n    this.orbitControls.object = this.camera\n  }\n\n  setSize(width: number, height: number) {\n    if (width === 0 || height === 0) return\n    if (this.width !== width || this.height !== height) {\n      for (const camera of this.defaultCameras.cameras) {\n        setAspect(camera, width, height)\n      }\n      // setAspect(this.camera, width, height)\n      this.width = width\n      this.height = height\n    }\n  }\n\n  cameraChanged() {\n    // TODO: redundant if camera is one of the defaults?\n    // TODO: Consider leaving scene camera aspect ratio unchanged or:\n    // - Set it temporarily to match viewport aspect ratio (show frame mask) and restore it\n\n    // if (!this.defaultCameras.cameras.includes(this.camera)) {\n    //   console.log('cameraChanged', this.camera, this.width, this.height)\n    //   setAspect(this.camera, this.width, this.height)\n    // }\n  }\n\n  stateChanged() {\n    for (const camera of this.defaultCameras.cameras) {\n      this.frameObject(this.state.scene, camera)\n    }\n  }\n\n  frameObject(object: Object3D, camera: Camera) {\n\n    let distance\n\n    box.setFromObject( object )\n\n    if ( box.isEmpty() === false ) {\n      box.getCenter( center )\n      distance = box.getBoundingSphere( sphere ).radius\n    } else {\n      // Focusing on an Group, AmbientLight, etc\n      // TODO: Investigate and make more robust\n      center.setFromMatrixPosition( camera.matrixWorld )\n      distance = 0.1\n    }\n\n    // TODO: Consider frustum geometry (fov) when framing\n\n    delta.set( 0, 0, 1 )\n    delta.applyQuaternion( camera.quaternion )\n    delta.multiplyScalar( distance * 2 )\n\n    if (camera instanceof PerspectiveCamera) {\n      camera.near = distance * 0.001\n      camera.far = distance * 16\n      camera.updateProjectionMatrix()\n      camera.position.copy( center ).add( delta )\n    } else if (camera instanceof OrthographicCamera) {\n      delta.copy(camera.userData.position).multiplyScalar(distance)\n      const aspect = this.width / this.height\n      camera.top = distance\n      camera.bottom = - distance\n      camera.left = - distance * aspect\n      camera.right = distance * aspect\n\n      camera.near = 0\n      camera.far = distance * 8\n\n      camera.position.copy( center ).add( delta)\n      camera.lookAt( center )\n      camera.updateProjectionMatrix()\n    }\n  }\n\n  dispose() {\n    this.orbitControls.dispose()\n    super.dispose()\n  }\n}","import { Register, IoElement, IoElementProps, ReactiveProperty, ReactivityType, Binding } from '@io-gui/core'\nimport { WebGPURenderer, CanvasTarget } from 'three/webgpu'\nimport WebGPU from 'three/addons/capabilities/WebGPU.js'\nimport { ThreeState } from '../nodes/ThreeState.js'\nimport { ViewCameras } from '../nodes/ViewCameras.js'\n\nif ( WebGPU.isAvailable() === false ) {\n  throw new Error( 'No WebGPU support' )\n}\n\nconst observer = new IntersectionObserver((entries) => {\n  entries.forEach(entry => {\n    (entry.target as IoThreeViewport).visible = entry.isIntersecting\n  })\n})\n\n\nconst _renderer = new WebGPURenderer({antialias: false, alpha: true})\n_renderer.setPixelRatio(window.devicePixelRatio)\nvoid _renderer.init()\n\nconst _playingViewports: IoThreeViewport[] = []\n\nnew Promise((resolve, reject) => {\n  _renderer.setAnimationLoop((time: number) => {\n    for (const viewport of _playingViewports) {\n      viewport.onAnimate(time)\n    }\n  }).then(resolve).catch(reject)\n  }).then(() => {\n    console.log('animation loop initialized')\n  }).catch(error => {\n    console.error('animation loop initialization failed', error)\n  })\n\nexport type IoThreeViewportProps = IoElementProps & {\n  state: ThreeState | Binding<ThreeState>\n  cameraSelect?: string | Binding<string>\n  playing?: boolean | Binding<boolean>\n  clearColor?: number | Binding<number>\n  clearAlpha?: number | Binding<number>\n}\n\n@Register\nexport class IoThreeViewport extends IoElement {\n\n  public width: number = 0\n  public height: number = 0\n  public visible: boolean = false\n\n  @ReactiveProperty({type: Number, value: 0x000000})\n  declare public clearColor: number\n\n  @ReactiveProperty({type: Number, value: 1})\n  declare public clearAlpha: number\n\n  @ReactiveProperty({type: String, value: 'throttled'})\n  declare reactivity: ReactivityType\n\n  @ReactiveProperty({type: ThreeState, init: null})\n  declare state: ThreeState\n\n  @ReactiveProperty({type: Boolean})\n  declare playing: boolean\n\n  @ReactiveProperty({type: String, value: 'perspective'})\n  declare cameraSelect: string\n\n  declare private readonly viewCameras: ViewCameras\n  declare private readonly renderTarget: CanvasTarget\n\n  static get Style() {\n    return /* css */`\n      :host {\n        position: relative;\n        display: flex;\n        flex: 1 1 auto;\n        flex-direction: column;\n        max-width: 100%;\n        max-height: 100%;\n        overflow: hidden;\n      }\n      :host > canvas {\n        position: absolute;\n      }\n    `\n  }\n\n  constructor(args: IoThreeViewportProps) {\n    super(args)\n    this.renderViewport = this.renderViewport.bind(this)\n\n    this.renderTarget = new CanvasTarget(document.createElement('canvas'))\n    this.appendChild(this.renderTarget.domElement)\n\n    this.viewCameras = new ViewCameras({viewport: this, state: this.state, cameraSelect: this.bind('cameraSelect')})\n\n    this.debounce(this.renderViewport)\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n    observer.observe(this)\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    observer.unobserve(this)\n    this.visible = false\n  }\n\n  playingChanged() {\n    if (this.playing) {\n      _playingViewports.push(this)\n    } else if (_playingViewports.includes(this)) {\n      _playingViewports.splice(_playingViewports.indexOf(this), 1)\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onAnimate(time: number) {\n    if (!this.visible) return\n    this.debounce(this.renderViewport)\n  }\n\n  onResized() {\n    const rect = this.getBoundingClientRect()\n    this.width = Math.floor(rect.width)\n    this.height = Math.floor(rect.height)\n    this.renderTarget.setSize(this.width, this.height)\n    this.renderTarget.setPixelRatio(window.devicePixelRatio)\n    this.viewCameras.setSize(this.width, this.height)\n    this.renderViewport()\n  }\n\n  stateChanged() {\n    this.debounce(this.renderViewport)\n  }\n  stateMutated() {\n    this.debounce(this.renderViewport)\n  }\n  changed() {\n    this.debounce(this.renderViewport)\n  }\n\n  renderViewport() {\n    if (_renderer.initialized === false) {\n      this.debounce(this.renderViewport)\n      return\n    }\n    if (this.state.isRendererInitialized() === false) {\n      void this.state.onRendererInitialized(_renderer)\n    }\n    if (!this.width || !this.height) {\n      return\n    }\n    _renderer.setCanvasTarget(this.renderTarget)\n    _renderer.setClearColor(this.clearColor, this.clearAlpha)\n    _renderer.setSize(this.width, this.height)\n    _renderer.clear()\n\n    this.state.setViewportSize(this.width, this.height)\n    this.state.onAnimate()\n    _renderer.render(this.state.scene, this.viewCameras.camera)\n  }\n\n  dispose() {\n    super.dispose()\n    this.renderTarget.dispose()\n    this.viewCameras.dispose()\n  }\n}\n\nexport const ioThreeViewport = function(arg0: IoThreeViewportProps) {\n  return IoThreeViewport.vConstructor(arg0)\n}"],"names":["ThreeState","Node","renderer","width","height","setViewportSize","this","onResized","isRendererInitialized","initialized","onRendererInitialized","onAnimate","__decorateClass","ReactiveProperty","type","Scene","init","prototype","Register","box","Box3","sphere","Sphere","center","Vector3","delta","setAspect","camera","aspect","PerspectiveCamera","OrthographicCamera","frustumHeight","top","bottom","left","right","updateProjectionMatrix","ViewCameras","constructor","args","super","orbitControls","connect","viewport","addEventListener","state","dispatchMutation","defaultCameras","perspective","cameraSelectChanged","cameraSelect","startsWith","cameraId","split","cameras","scene","getObjectsByProperty","matchedCamera","find","name","console","warn","getCamera","object","setSize","cameraChanged","stateChanged","frameObject","distance","setFromObject","isEmpty","getCenter","getBoundingSphere","radius","setFromMatrixPosition","matrixWorld","set","applyQuaternion","quaternion","multiplyScalar","near","far","position","copy","add","userData","lookAt","dispose","Property","String","value","Camera","front","back","OrbitControls","WebGPU","isAvailable","Error","observer","IntersectionObserver","entries","forEach","entry","target","visible","isIntersecting","_renderer","WebGPURenderer","antialias","alpha","setPixelRatio","window","devicePixelRatio","_playingViewports","Promise","resolve","reject","setAnimationLoop","time","then","catch","log","error","IoThreeViewport","IoElement","Style","renderViewport","bind","renderTarget","CanvasTarget","document","createElement","appendChild","domElement","viewCameras","debounce","connectedCallback","observe","disconnectedCallback","unobserve","playingChanged","playing","push","includes","splice","indexOf","rect","getBoundingClientRect","Math","floor","stateMutated","changed","setCanvasTarget","setClearColor","clearColor","clearAlpha","clear","render","Number","Boolean","ioThreeViewport","arg0","vConstructor"],"mappings":"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"}