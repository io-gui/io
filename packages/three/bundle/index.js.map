{"version":3,"file":"index.js","sources":["../src/nodes/ThreeState.ts","../src/nodes/ViewCameras.ts","../src/elements/IoThreeViewport.ts"],"sourcesContent":["import { Register, Node, ReactiveProperty } from '@io-gui/core'\nimport { Scene, WebGPURenderer } from 'three/webgpu'\n\n@Register\nexport class ThreeState extends Node {\n\n  @ReactiveProperty({type: Scene, init: null})\n  declare scene: Scene\n\n  public renderer: WebGPURenderer | null = null\n\n  public width: number = 0\n  public height: number = 0\n\n  setViewportSize(width: number, height: number) {\n    if (this.width !== width || this.height !== height) {\n      if (!!width && !!height) {\n        this.width = width\n        this.height = height\n        this.onResized(width, height)\n      }\n    }\n\n  }\n  isRendererInitialized() {\n    return !!this.renderer && this.renderer.initialized === true\n  }\n  onRendererInitialized(renderer: WebGPURenderer) {\n    this.renderer = renderer\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onResized(width: number, height: number) {}\n  onAnimate() {}\n}","import { Register, Node, ReactiveProperty, Property, NodeProps, Binding } from '@io-gui/core'\nimport { IoThreeViewport } from '../elements/IoThreeViewport.js'\nimport { ThreeState } from './ThreeState.js'\nimport { Box3, Camera, Object3D, OrthographicCamera, PerspectiveCamera, Sphere, Vector3 } from 'three/webgpu'\nimport { OrbitControls } from 'three/addons/controls/OrbitControls.js'\n\nconst box = new Box3()\nconst sphere = new Sphere()\nconst center = new Vector3()\nconst delta = new Vector3()\n\nfunction setAspect(camera: PerspectiveCamera | OrthographicCamera, width: number, height: number) {\n  const aspect = width / height\n  if (camera instanceof PerspectiveCamera) {\n    camera.aspect = aspect\n  } else if (camera instanceof OrthographicCamera) {\n    const frustumHeight = camera.top - camera.bottom\n    camera.left = - frustumHeight * aspect / 2\n    camera.right = frustumHeight * aspect / 2\n  }\n  camera.updateProjectionMatrix()\n}\n\nclass DefaultCameras {\n  public perspective: PerspectiveCamera\n  public top: OrthographicCamera\n  public bottom: OrthographicCamera\n  public left: OrthographicCamera\n  public right: OrthographicCamera\n  public front: OrthographicCamera\n  public back: OrthographicCamera\n  constructor() {\n    this.perspective = new PerspectiveCamera(75, 1, 0.1, 1000)\n    this.top = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.bottom = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.left = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.right = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.front = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.back = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n\n    this.perspective.position.set(0.5, 0.25, 1)\n    this.perspective.lookAt(0, 0, 0)\n    this.perspective.name = 'perspective'\n\n    this.top.userData.position = new Vector3(0, 1, 0)\n    this.top.position.copy(this.top.userData.position)\n    this.top.lookAt(0, 0, 0)\n    this.top.name = 'top'\n\n    this.bottom.userData.position = new Vector3(0, -1, 0)\n    this.bottom.position.copy(this.bottom.userData.position)\n    this.bottom.lookAt(0, 0, 0)\n    this.bottom.name = 'bottom'\n\n    this.left.userData.position = new Vector3(-1, 0, 0)\n    this.left.position.copy(this.left.userData.position)\n    this.left.lookAt(0, 0, 0)\n    this.left.name = 'left'\n\n    this.right.userData.position = new Vector3(1, 0, 0)\n    this.right.position.copy(this.right.userData.position)\n    this.right.lookAt(0, 0, 0)\n    this.right.name = 'right'\n\n    this.front.userData.position = new Vector3(0, 0, 1)\n    this.front.position.copy(this.front.userData.position)\n    this.front.lookAt(0, 0, 0)\n    this.front.name = 'front'\n\n    this.back.userData.position = new Vector3(0, 0, -1)\n    this.back.position.copy(this.back.userData.position)\n    this.back.lookAt(0, 0, 0)\n    this.back.name = 'back'\n  }\n  get cameras() {\n    return [this.perspective, this.top, this.bottom, this.left, this.right, this.front, this.back]\n  }\n  getCamera(name: string) {\n    return this.cameras.find(camera => camera.name === name)\n  }\n}\n\n\n\nexport type ViewCamerasProps = NodeProps & {\n  viewport: IoThreeViewport\n  state: ThreeState\n  cameraSelect: string | Binding<string>\n}\n\n@Register\nexport class ViewCameras extends Node {\n  @Property(0)\n  declare private width: number\n  @Property(0)\n  declare private height: number\n\n  @Property()\n  declare private viewport: IoThreeViewport\n\n  @ReactiveProperty({type: ThreeState})\n  declare public state: ThreeState\n\n  @ReactiveProperty({type: String, value: 'perspective'})\n  declare public cameraSelect: string\n\n  @ReactiveProperty({type: Camera})\n  declare public camera: PerspectiveCamera | OrthographicCamera\n\n  @ReactiveProperty({type: DefaultCameras, init: null})\n  declare private readonly defaultCameras: DefaultCameras\n\n  @ReactiveProperty({type: OrbitControls, init: ['this.defaultCameras.perspective']})\n  declare private readonly orbitControls: OrbitControls\n\n  constructor(args: ViewCamerasProps) {\n    super(args)\n\n    this.orbitControls.connect(this.viewport)\n    this.orbitControls.addEventListener('change', () => {\n      this.state.dispatchMutation()\n    })\n\n    if (this.camera === undefined) this.camera = this.defaultCameras.perspective\n  }\n\n  cameraSelectChanged() {\n    if (this.cameraSelect.startsWith('scene')) {\n      const cameraId = this.cameraSelect.split(':')[1] || ''\n      const persp = this.state.scene.getObjectsByProperty('isPerspectiveCamera', true)\n      const ortho = this.state.scene.getObjectsByProperty('isOrthographicCamera', true)\n      const cameras = [...persp, ...ortho]\n\n      let matchedCamera: PerspectiveCamera | OrthographicCamera | undefined\n      if (cameraId) {\n        matchedCamera = cameras.find(camera => camera.name === cameraId) as PerspectiveCamera | OrthographicCamera | undefined\n      } else {\n        matchedCamera = cameras[0] as PerspectiveCamera | OrthographicCamera | undefined\n      }\n      if (matchedCamera) {\n        this.camera = matchedCamera\n      } else {\n        this.camera = this.defaultCameras.perspective\n        console.warn(`Camera ${cameraId} not found in the scene, using default perspective camera`)\n      }\n    } else {\n      this.camera = this.defaultCameras.getCamera(this.cameraSelect) || this.defaultCameras.perspective\n    }\n    this.orbitControls.object = this.camera\n  }\n\n  setSize(width: number, height: number) {\n    if (width === 0 || height === 0) return\n    if (this.width !== width || this.height !== height) {\n      for (const camera of this.defaultCameras.cameras) {\n        setAspect(camera, width, height)\n      }\n      // setAspect(this.camera, width, height)\n      this.width = width\n      this.height = height\n    }\n  }\n\n  cameraChanged() {\n    // TODO: redundant if camera is one of the defaults?\n    // TODO: Consider leaving scene camera aspect ratio unchanged or:\n    // - Set it temporarily to match viewport aspect ratio (show frame mask) and restore it\n\n    // if (!this.defaultCameras.cameras.includes(this.camera)) {\n    //   console.log('cameraChanged', this.camera, this.width, this.height)\n    //   setAspect(this.camera, this.width, this.height)\n    // }\n  }\n\n  stateChanged() {\n    for (const camera of this.defaultCameras.cameras) {\n      this.frameObject(this.state.scene, camera)\n    }\n  }\n\n  frameObject(object: Object3D, camera: Camera) {\n\n    let distance\n\n    box.setFromObject( object )\n\n    if ( box.isEmpty() === false ) {\n      box.getCenter( center )\n      distance = box.getBoundingSphere( sphere ).radius\n    } else {\n      // Focusing on an Group, AmbientLight, etc\n      // TODO: Investigate and make more robust\n      center.setFromMatrixPosition( camera.matrixWorld )\n      distance = 0.1\n    }\n\n    // TODO: Consider frustum geometry (fov) when framing\n\n    delta.set( 0, 0, 1 )\n    delta.applyQuaternion( camera.quaternion )\n    delta.multiplyScalar( distance * 2 )\n\n    if (camera instanceof PerspectiveCamera) {\n      camera.near = distance * 0.001\n      camera.far = distance * 16\n      camera.updateProjectionMatrix()\n      camera.position.copy( center ).add( delta )\n    } else if (camera instanceof OrthographicCamera) {\n      delta.copy(camera.userData.position).multiplyScalar(distance)\n      const aspect = this.width / this.height\n      camera.top = distance\n      camera.bottom = - distance\n      camera.left = - distance * aspect\n      camera.right = distance * aspect\n\n      camera.near = 0\n      camera.far = distance * 8\n\n      camera.position.copy( center ).add( delta)\n      camera.lookAt( center )\n      camera.updateProjectionMatrix()\n    }\n  }\n\n  dispose() {\n    this.orbitControls.dispose()\n    super.dispose()\n  }\n}","import { Register, IoElement, IoElementProps, ReactiveProperty, ReactivityType, Binding } from '@io-gui/core'\nimport { WebGPURenderer, CanvasTarget } from 'three/webgpu'\nimport WebGPU from 'three/addons/capabilities/WebGPU.js'\nimport { ThreeState } from '../nodes/ThreeState.js'\nimport { ViewCameras } from '../nodes/ViewCameras.js'\n\nif ( WebGPU.isAvailable() === false ) {\n  throw new Error( 'No WebGPU support' )\n}\n\nconst observer = new IntersectionObserver((entries) => {\n  entries.forEach(entry => {\n    (entry.target as IoThreeViewport).visible = entry.isIntersecting\n  })\n})\n\n\nconst _renderer = new WebGPURenderer({antialias: false, alpha: true})\n_renderer.setPixelRatio(window.devicePixelRatio)\n_renderer.init()\n\nconst _playingViewports: IoThreeViewport[] = []\n\nnew Promise((resolve, reject) => {\n  _renderer.setAnimationLoop((time: number) => {\n    for (const viewport of _playingViewports) {\n      viewport.onAnimate(time)\n    }\n  }).then(resolve).catch(reject)\n  }).then(() => {\n    console.log('animation loop initialized')\n  }).catch(error => {\n    console.error('animation loop initialization failed', error)\n  })\n\nexport type IoThreeViewportProps = IoElementProps & {\n  state: ThreeState | Binding<ThreeState>\n  cameraSelect?: string | Binding<string>\n  playing?: boolean | Binding<boolean>\n  clearColor?: number | Binding<number>\n  clearAlpha?: number | Binding<number>\n}\n\n@Register\nexport class IoThreeViewport extends IoElement {\n\n  public width: number = 0\n  public height: number = 0\n  public visible: boolean = false\n\n  @ReactiveProperty({type: Number, value: 0x000000})\n  declare public clearColor: number\n\n  @ReactiveProperty({type: Number, value: 1})\n  declare public clearAlpha: number\n\n  @ReactiveProperty({type: String, value: 'throttled'})\n  declare reactivity: ReactivityType\n\n  @ReactiveProperty({type: ThreeState, init: null})\n  declare state: ThreeState\n\n  @ReactiveProperty({type: Boolean})\n  declare playing: boolean\n\n  @ReactiveProperty({type: String, value: 'perspective'})\n  declare cameraSelect: string\n\n  declare private readonly viewCameras: ViewCameras\n  declare private readonly renderTarget: CanvasTarget\n\n  static get Style() {\n    return /* css */`\n      :host {\n        position: relative;\n        display: flex;\n        flex: 1 1 auto;\n        flex-direction: column;\n        max-width: 100%;\n        max-height: 100%;\n        overflow: hidden;\n      }\n      :host > canvas {\n        position: absolute;\n      }\n    `\n  }\n\n  constructor(args: IoThreeViewportProps) {\n    super(args)\n    this.renderViewport = this.renderViewport.bind(this)\n\n    this.renderTarget = new CanvasTarget(document.createElement('canvas'))\n    this.appendChild(this.renderTarget.domElement)\n\n    this.viewCameras = new ViewCameras({viewport: this, state: this.state, cameraSelect: this.bind('cameraSelect')})\n\n    this.debounce(this.renderViewport)\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n    observer.observe(this)\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    observer.unobserve(this)\n    this.visible = false\n  }\n\n  playingChanged() {\n    if (this.playing) {\n      _playingViewports.push(this)\n    } else if (_playingViewports.includes(this)) {\n      _playingViewports.splice(_playingViewports.indexOf(this), 1)\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onAnimate(time: number) {\n    if (!this.visible) return\n    this.debounce(this.renderViewport)\n  }\n\n  onResized() {\n    const rect = this.getBoundingClientRect()\n    this.width = Math.floor(rect.width)\n    this.height = Math.floor(rect.height)\n    this.renderTarget.setSize(this.width, this.height)\n    this.renderTarget.setPixelRatio(window.devicePixelRatio)\n    this.viewCameras.setSize(this.width, this.height)\n    this.renderViewport()\n  }\n\n  stateChanged() {\n    this.debounce(this.renderViewport)\n  }\n  stateMutated() {\n    this.debounce(this.renderViewport)\n  }\n  changed() {\n    this.debounce(this.renderViewport)\n  }\n\n  renderViewport() {\n    if (_renderer.initialized === false) {\n      this.debounce(this.renderViewport)\n      return\n    }\n    if (this.state.isRendererInitialized() === false) {\n      this.state.onRendererInitialized(_renderer)\n    }\n    if (!this.width || !this.height) {\n      return\n    }\n    _renderer.setCanvasTarget(this.renderTarget)\n    _renderer.setClearColor(this.clearColor, this.clearAlpha)\n    _renderer.setSize(this.width, this.height)\n    _renderer.clear()\n\n    this.state.setViewportSize(this.width, this.height)\n    this.state.onAnimate()\n    _renderer.render(this.state.scene, this.viewCameras.camera)\n  }\n\n  dispose() {\n    super.dispose()\n    this.renderTarget.dispose()\n    this.viewCameras.dispose()\n  }\n}\n\nexport const ioThreeViewport = function(arg0: IoThreeViewportProps) {\n  return IoThreeViewport.vConstructor(arg0)\n}"],"names":["ThreeState","Node","width","height","renderer","__decorateClass","ReactiveProperty","Scene","Register","box","Box3","sphere","Sphere","center","Vector3","delta","setAspect","camera","aspect","PerspectiveCamera","OrthographicCamera","frustumHeight","DefaultCameras","name","ViewCameras","args","cameraId","persp","ortho","cameras","matchedCamera","object","distance","Property","Camera","OrbitControls","WebGPU","observer","entries","entry","_renderer","WebGPURenderer","_playingViewports","resolve","reject","time","viewport","error","IoThreeViewport","IoElement","CanvasTarget","rect","ioThreeViewport","arg0"],"mappings":"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"}