{"version":3,"file":"IoBackdropExample.js","sourceRoot":"","sources":["../../../src/demos/examples/IoBackdropExample.ts"],"names":[],"mappings":"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","sourcesContent":["import { ReactiveProperty, Register } from '@io-gui/core'\nimport { ThreeApplet, IoThreeExample, ThreeAppletProps } from '@io-gui/three'\nimport {\n  AnimationMixer,\n  Group,\n  Mesh,\n  MeshStandardNodeMaterial,\n  SphereGeometry,\n  SpotLight,\n  MathUtils,\n  Node,\n  NeutralToneMapping,\n} from 'three/webgpu'\nimport {\n  float,\n  vec3,\n  color,\n  viewportSharedTexture,\n  hue,\n  blendOverlay,\n  posterize,\n  grayscale,\n  saturation,\n  viewportSafeUV,\n  screenUV,\n  checker,\n  uv,\n  time,\n  oscSine,\n  output,\n} from 'three/tsl'\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js'\n\n@Register\nexport class BackdropExample extends ThreeApplet {\n\n  @ReactiveProperty({type: AnimationMixer, init: new Group()})\n  declare public mixer: AnimationMixer\n\n  public portals: Group\n\n  constructor(args: ThreeAppletProps) {\n    super(args)\n\n    this.toneMapping = NeutralToneMapping\n    this.toneMappingExposure = 0.3\n\n    // Background\n    this.scene.backgroundNode = screenUV.y.mix(color(0x66bbff), color(0x4466ff))\n\n    // Light\n    const light = new SpotLight(0xffffff, 1)\n    light.position.set(1, 2, 3)\n    light.lookAt(0, 1, 0)\n    light.power = 2000\n    this.scene.add(light)\n\n    // Portals\n    this.portals = new Group()\n    this.scene.add(this.portals)\n\n    const geometry = new SphereGeometry(.3, 32, 16)\n\n    const addBackdropSphere = (backdropNode: Node, backdropAlphaNode: Node | null = null) => {\n      const distance = 1\n      const id = this.portals.children.length\n      const rotation = MathUtils.degToRad(id * 45)\n\n      const material = new MeshStandardNodeMaterial({ color: 0x0066ff })\n      material.roughnessNode = float(.2)\n      material.metalnessNode = float(0)\n      material.backdropNode = backdropNode\n      material.backdropAlphaNode = backdropAlphaNode\n      material.transparent = true\n\n      const mesh = new Mesh(geometry, material)\n      mesh.position.set(\n        Math.cos(rotation) * distance,\n        1,\n        Math.sin(rotation) * distance\n      )\n\n      this.portals.add(mesh)\n    }\n\n    addBackdropSphere(hue(viewportSharedTexture().bgr, oscSine().mul(Math.PI)))\n    addBackdropSphere(viewportSharedTexture().rgb.oneMinus())\n    addBackdropSphere(grayscale(viewportSharedTexture().rgb))\n    addBackdropSphere(saturation(viewportSharedTexture().rgb, 10), oscSine())\n    addBackdropSphere(blendOverlay(viewportSharedTexture().rgb, checker(uv().mul(10))))\n    addBackdropSphere(viewportSharedTexture(viewportSafeUV(screenUV.mul(40).floor().div(40))))\n    addBackdropSphere(viewportSharedTexture(viewportSafeUV(screenUV.mul(80).floor().div(80))).add(color(0x0033ff)))\n    addBackdropSphere(vec3(0, 0, viewportSharedTexture().b))\n\n    // Load model\n    void this.loadModel()\n  }\n\n  private async loadModel() {\n    const loader = new GLTFLoader()\n    loader.load('https://threejs.org/examples/models/gltf/Michelle.glb', (gltf) => {\n      const object = gltf.scene\n      this.mixer = new AnimationMixer(object)\n\n      const mesh = object.children[0].children[0] as Mesh\n      const material = mesh.material as MeshStandardNodeMaterial\n\n      // TODO: Time is respecting the animation mixer timeScale\n      material.outputNode = oscSine(time.mul(.1)).mix(output, posterize(output.add(.1), 4).mul(2))\n\n      const action = this.mixer.clipAction(gltf.animations[0])\n      action.play()\n\n      this.scene.add(object)\n    })\n  }\n\n  onAnimate(delta: number) {\n    this.mixer.update(delta)\n    debug: {\n      this.dispatchMutation(this.mixer)\n    }\n    this.portals.rotation.y += delta * this.mixer.timeScale * 0.5\n  }\n}\n\n@Register\nexport class IoBackdropExample extends IoThreeExample {\n\n  @ReactiveProperty({type: BackdropExample, init: {playing: true}})\n  declare applet: BackdropExample\n\n}\n\nexport const ioBackdropExample = IoBackdropExample.vConstructor\n"]}