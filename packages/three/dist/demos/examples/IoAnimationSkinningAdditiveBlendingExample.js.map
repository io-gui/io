{"version":3,"file":"IoAnimationSkinningAdditiveBlendingExample.js","sourceRoot":"","sources":["../../../src/demos/examples/IoAnimationSkinningAdditiveBlendingExample.ts"],"names":[],"mappings":"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","sourcesContent":["import { ReactiveProperty, Register } from '@io-gui/core'\nimport {\n  AnimationAction,\n  AnimationMixer,\n  AnimationUtils,\n  Color,\n  DirectionalLight,\n  Fog,\n  Group,\n  HemisphereLight,\n  Mesh,\n  MeshPhongMaterial,\n  PlaneGeometry,\n} from 'three/webgpu'\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js'\nimport { ThreeApplet, IoThreeExample, ThreeAppletProps, ioThreeViewport } from '@io-gui/three'\nimport { ioSplit, Split } from '@io-gui/layout'\nimport { ioObject, ioPropertyEditor } from '@io-gui/editors'\n\nconst loader = new GLTFLoader()\n\n@Register\nexport class AnimationSkinningAdditiveBlendingExample extends ThreeApplet {\n\n  @ReactiveProperty({type: Boolean, value: false})\n  declare isLoaded: boolean\n\n  public mixer: AnimationMixer = new AnimationMixer(new Group())\n\n  public currentBaseAction: string = 'idle'\n\n  public baseActions: Record<string, AnimationAction | null> = {\n    idle: null,\n    walk: null,\n    run: null,\n  }\n\n  public additiveActions: Record<string, AnimationAction | null> = {\n    sneak_pose: null,\n    sad_pose: null,\n    agree: null,\n    headShake: null,\n  }\n\n  constructor(args: ThreeAppletProps) {\n    super(args)\n\n    // Scene setup\n    this.scene.background = new Color(0xa0a0a0)\n    this.scene.fog = new Fog(0xa0a0a0, 10, 50)\n\n    // Lights\n    const hemiLight = new HemisphereLight(0xffffff, 0x8d8d8d, 3)\n    hemiLight.position.set(0, 20, 0)\n    this.scene.add(hemiLight)\n\n    const dirLight = new DirectionalLight(0xffffff, 3)\n    dirLight.position.set(3, 10, 10)\n    dirLight.castShadow = true\n    dirLight.shadow.camera.top = 2\n    dirLight.shadow.camera.bottom = -2\n    dirLight.shadow.camera.left = -2\n    dirLight.shadow.camera.right = 2\n    dirLight.shadow.camera.near = 0.1\n    dirLight.shadow.camera.far = 40\n    this.scene.add(dirLight)\n\n    const ground = new Mesh(\n      new PlaneGeometry(100, 100),\n      new MeshPhongMaterial({color: 0xcbcbcb, depthWrite: false})\n    )\n    ground.rotation.x = -Math.PI / 2\n    ground.receiveShadow = true\n    this.scene.add(ground)\n\n    void this.loadModel()\n  }\n\n  private async loadModel() {\n    loader.load('https://threejs.org/examples/models/gltf/Xbot.glb', (gltf) => {\n      const model = gltf.scene as Group\n      this.scene.add(model)\n\n      model.traverse((object) => {\n        if ((object as Mesh).isMesh) {\n          object.castShadow = true\n        }\n      })\n\n      this.mixer = new AnimationMixer(model)\n      const animations = gltf.animations\n\n      for (let i = 0; i < animations.length; i++) {\n        let clip = animations[i]\n        const name = clip.name\n\n        if (name in this.baseActions) {\n          const action = this.mixer.clipAction(clip)\n          this.setWeight(action, name === 'idle' ? 1 : 0)\n          action.play()\n          this.baseActions[name] = action\n        } else if (name in this.additiveActions) {\n          // Make the clip additive and remove the reference frame\n          AnimationUtils.makeClipAdditive(clip)\n\n          if (clip.name.endsWith('_pose')) {\n            clip = AnimationUtils.subclip(clip, clip.name, 2, 3, 30)\n          }\n\n          const action = this.mixer.clipAction(clip)\n          this.setWeight(action, 0)\n          action.play()\n          this.additiveActions[name] = action\n        }\n        this.additiveActions = Object.assign({}, this.additiveActions)\n        this.dispatchMutation(this.additiveActions)\n      }\n\n      this.setProperties({\n        isLoaded: true,\n      })\n\n      this.dispatch('frame-object', {object: model}, true)\n    })\n  }\n\n  private setWeight(action: AnimationAction, weight: number) {\n    action.enabled = true\n    action.setEffectiveTimeScale(1)\n    action.setEffectiveWeight(weight)\n  }\n\n  // Base action crossfade triggers\n  none = () => { this.prepareCrossFade(null) }\n  idle = () => { this.prepareCrossFade('idle') }\n  walk = () => { this.prepareCrossFade('walk') }\n  run = () => { this.prepareCrossFade('run') }\n\n  private prepareCrossFade(targetName: string | null) {\n    const currentAction = this.baseActions[this.currentBaseAction]\n    const targetAction = targetName ? this.baseActions[targetName] : null\n\n    if (currentAction === targetAction) return\n\n    const duration = 0.35\n\n    if (this.currentBaseAction === 'idle' || !currentAction || !targetAction) {\n      this.executeCrossFade(currentAction, targetAction, duration)\n    } else {\n      this.synchronizeCrossFade(currentAction, targetAction, duration)\n    }\n\n    this.currentBaseAction = targetName || 'None'\n  }\n\n  private synchronizeCrossFade(startAction: AnimationAction, endAction: AnimationAction, duration: number) {\n    const onLoopFinished = (event: {action: AnimationAction}) => {\n      if (event.action === startAction) {\n        this.mixer.removeEventListener('loop', onLoopFinished as any)\n        this.executeCrossFade(startAction, endAction, duration)\n      }\n    }\n\n    this.mixer.addEventListener('loop', onLoopFinished as any)\n  }\n\n  private executeCrossFade(startAction: AnimationAction | null, endAction: AnimationAction | null, duration: number) {\n    if (endAction) {\n      this.setWeight(endAction, 1)\n      endAction.time = 0\n\n      if (startAction) {\n        startAction.crossFadeTo(endAction, duration, true)\n      } else {\n        endAction.fadeIn(duration)\n      }\n    } else if (startAction) {\n      startAction.fadeOut(duration)\n    }\n  }\n\n  onAnimate(delta: number) {\n    if (!this.isLoaded || !this.mixer) return\n\n    debug: {\n      // Dispatch mutations for UI reactivity\n      Object.values(this.baseActions).forEach(action => {\n        if (action) this.dispatchMutation(action)\n      })\n      Object.values(this.additiveActions).forEach(action => {\n        if (action) this.dispatchMutation(action)\n      })\n      this.dispatchMutation(this.mixer)\n    }\n\n    this.mixer.update(delta)\n  }\n}\n\n@Register\nexport class IoAnimationSkinningAdditiveBlendingExample extends IoThreeExample {\n\n  @ReactiveProperty({type: AnimationSkinningAdditiveBlendingExample, init: {isPlaying: true}})\n  declare applet: AnimationSkinningAdditiveBlendingExample\n\n  ready() {\n\n    this.render([\n      ioSplit({\n        elements: [\n          ioThreeViewport({id: 'Top', applet: this.applet, cameraSelect: 'top'}),\n          ioThreeViewport({id: 'Left', applet: this.applet, cameraSelect: 'left'}),\n          ioThreeViewport({id: 'Back', applet: this.applet, cameraSelect: 'back'}),\n          ioThreeViewport({id: 'Perspective', applet: this.applet, cameraSelect: 'perspective'}),\n          ioPropertyEditor({id: 'PropertyEditor', value: this.applet,\n            config: [\n              [AnimationMixer, ioObject({expanded: true, properties: ['timeScale']})],\n              [AnimationAction, ioObject({expanded: true, properties: ['weight']})],\n              ['additiveActions', ioPropertyEditor({label: '_hidden_'})],\n            ],\n            groups: {\n              'Main': [\n                'none',\n                'idle',\n                'walk',\n                'run',\n                'additiveActions',\n                'mixer',\n              ],\n              Hidden: [\n                'isLoaded',\n                'scene',\n                'camera',\n                'baseActions',\n                'currentBaseAction',\n              ],\n            }\n          })\n        ],\n        split: new Split({\n          type: 'split',\n          orientation: 'horizontal',\n          children: [\n            {\n              type: 'split',\n              flex: '2 1 auto',\n              orientation: 'vertical',\n              children: [\n                {\n                  type: 'split',\n                  flex: '1 1 50%',\n                  orientation: 'horizontal',\n                  children: [\n                    {type: 'panel',flex: '1 1 50%',tabs: [{id: 'Top'}]},\n                    {type: 'panel',flex: '1 1 50%',tabs: [{id: 'Left'}]}\n                  ]\n                },\n                {\n                  type: 'split',\n                  flex: '1 1 50%',\n                  orientation: 'horizontal',\n                  children: [\n                    {type: 'panel',flex: '1 1 50%',tabs: [{id: 'Back'}]},\n                    {type: 'panel',flex: '1 1 50%',tabs: [{id: 'Perspective'}]},\n                  ]\n                }\n              ]\n            },\n            {\n              type: 'panel',\n              flex: '0 0 280px',\n              tabs: [{id: 'PropertyEditor'}]\n            }\n          ]\n        })\n      })\n    ])\n\n  }\n\n}\n\nexport const ioAnimationSkinningAdditiveBlendingExample = IoAnimationSkinningAdditiveBlendingExample.vConstructor\n"]}