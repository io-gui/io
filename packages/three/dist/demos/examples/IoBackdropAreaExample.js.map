{"version":3,"file":"IoBackdropAreaExample.js","sourceRoot":"","sources":["../../../src/demos/examples/IoBackdropAreaExample.ts"],"names":[],"mappings":"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","sourcesContent":["import { ReactiveProperty, Register } from '@io-gui/core'\nimport {\n  AmbientLight,\n  AnimationMixer,\n  BoxGeometry,\n  DoubleSide,\n  Mesh,\n  MeshBasicNodeMaterial,\n  Vector3,\n} from 'three/webgpu'\nimport {\n  color,\n  positionWorld,\n  linearDepth,\n  viewportLinearDepth,\n  viewportSharedTexture,\n  screenUV,\n  hue,\n  time,\n  checker,\n  uv,\n  modelScale,\n} from 'three/tsl'\nimport { hashBlur } from 'three/addons/tsl/display/hashBlur.js'\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js'\nimport { ThreeApplet, IoThreeExample, ioVector3 } from '@io-gui/three'\nimport { ioOptionSelect, MenuOption } from '@io-gui/menus'\n\n@Register\nexport class BackdropAreaExample extends ThreeApplet {\n  public mixer?: AnimationMixer\n  public box: Mesh\n\n  // Materials\n  public blurredBlurMaterial: MeshBasicNodeMaterial\n  public depthMaterial: MeshBasicNodeMaterial\n  public checkerMaterial: MeshBasicNodeMaterial\n  public pixelMaterial: MeshBasicNodeMaterial\n\n  public materials: Record<string, MeshBasicNodeMaterial>\n\n  public boxScale: Vector3\n\n  @ReactiveProperty({type: String, value: 'blurred'})\n  declare public material: string\n\n  constructor() {\n    super()\n\n    this.toneMappingExposure = 0.9\n\n    // Background\n    this.scene.backgroundNode = hue(screenUV.y.mix(color(0x66bbff), color(0x4466ff)), time.mul(0.1))\n\n    // Lighting\n    const ambient = new AmbientLight(0xffffff, 2.5)\n    this.scene.add(ambient)\n\n    // Create materials\n    // Compare depth from viewportLinearDepth with linearDepth() to create a distance field\n    const depthDistance = viewportLinearDepth.distance(linearDepth())\n\n    const depthAlphaNode = depthDistance.oneMinus().smoothstep( .90, 2 ).mul( 10 ).saturate()\n    const depthBlurred = hashBlur( viewportSharedTexture(), depthDistance.smoothstep( 0, .6 ).mul( 40 ).clamp().mul( .1 ) )\n\n    // Blurred material\n    this.blurredBlurMaterial = new MeshBasicNodeMaterial()\n    this.blurredBlurMaterial.backdropNode = depthBlurred.add(depthAlphaNode.mix(color(0x003399).mul(.3), 0))\n    this.blurredBlurMaterial.transparent = true\n    this.blurredBlurMaterial.side = DoubleSide\n\n    // Depth material\n    this.depthMaterial = new MeshBasicNodeMaterial()\n    this.depthMaterial.backdropNode = depthAlphaNode\n    this.depthMaterial.transparent = true\n    this.depthMaterial.side = DoubleSide\n\n    // Checker material\n    this.checkerMaterial = new MeshBasicNodeMaterial()\n    this.checkerMaterial.backdropNode = hashBlur(viewportSharedTexture(), .05)\n    this.checkerMaterial.backdropAlphaNode = checker(uv().mul(3).mul(modelScale.xy))\n    this.checkerMaterial.opacityNode = this.checkerMaterial.backdropAlphaNode\n    this.checkerMaterial.transparent = true\n    this.checkerMaterial.side = DoubleSide\n\n    // Pixel material\n    this.pixelMaterial = new MeshBasicNodeMaterial()\n    this.pixelMaterial.backdropNode = viewportSharedTexture(screenUV.mul(100).floor().div(100))\n    this.pixelMaterial.transparent = true\n\n    // Materials map\n    this.materials = {\n      'blurred': this.blurredBlurMaterial,\n      'depth': this.depthMaterial,\n      'checker': this.checkerMaterial,\n      'pixel': this.pixelMaterial\n    }\n\n    // Box\n    this.box = new Mesh(new BoxGeometry(2, 2, 2), this.blurredBlurMaterial)\n    this.box.position.set(0, 1, 0)\n    this.boxScale = this.box.scale\n    this.box.renderOrder = 1\n    this.scene.add(this.box)\n\n    // Floor\n    const floor = new Mesh(new BoxGeometry(3, .01, 3), new MeshBasicNodeMaterial({\n      color: 0xff6600,\n      opacityNode: positionWorld.xz.distance(0).oneMinus().clamp(),\n      transparent: true,\n      depthWrite: false\n    }))\n    this.scene.add(floor)\n\n    // Load model\n    void this.loadModel()\n    this.materialChanged()\n  }\n\n  materialChanged() {\n    if (this.materials[this.material]) {\n      this.box.material = this.materials[this.material]\n    }\n  }\n\n  private async loadModel() {\n    const loader = new GLTFLoader()\n    loader.load('https://threejs.org/examples/models/gltf/Michelle.glb', (gltf) => {\n      const object = gltf.scene\n      this.mixer = new AnimationMixer(object)\n\n      const action = this.mixer.clipAction(gltf.animations[0])\n      action.play()\n\n      this.scene.add(object)\n\n      this.dispatchMutation()\n      this.dispatch('frame-object', {object: this.scene.children[1]}, true)\n    })\n  }\n\n  onAnimate(delta: number) {\n    if (this.mixer) {\n      this.mixer.update(delta)\n    }\n  }\n}\n\n@Register\nexport class IoBackdropAreaExample extends IoThreeExample {\n\n  @ReactiveProperty({type: BackdropAreaExample, init: null})\n  declare applet: BackdropAreaExample\n\n  init() {\n    this.uiConfig = [\n      ['material', ioOptionSelect({\n        option: new MenuOption({\n          options: ['blurred', 'depth', 'checker', 'pixel']\n        }),\n        selectBy: 'id'\n      })],\n      [Vector3, ioVector3({linkable: true})]\n    ]\n  }\n}\n\nexport const ioBackdropAreaExample = IoBackdropAreaExample.vConstructor\n"]}