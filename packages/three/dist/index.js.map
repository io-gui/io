{"version":3,"file":"index.js","sources":["../src/nodes/ThreeState.ts","../src/nodes/ViewCameras.ts","../src/elements/IoThreeViewport.ts"],"sourcesContent":["import { Register, Node, ReactiveProperty } from '@io-gui/core'\nimport { Scene, WebGPURenderer } from 'three/webgpu'\n\n@Register\nexport class ThreeState extends Node {\n\n  @ReactiveProperty({type: Scene, init: null})\n  declare scene: Scene\n\n  public renderer: WebGPURenderer | null = null\n\n  public width: number = 0\n  public height: number = 0\n\n  setViewportSize(width: number, height: number) {\n    if (this.width !== width || this.height !== height) {\n      if (!!width && !!height) {\n        this.width = width\n        this.height = height\n        this.onResized(width, height)\n      }\n    }\n\n  }\n  isRendererInitialized() {\n    return !!this.renderer && this.renderer.initialized === true\n  }\n  onRendererInitialized(renderer: WebGPURenderer) {\n    this.renderer = renderer\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onResized(width: number, height: number) {}\n  onAnimate() {}\n}","import { Register, Node, ReactiveProperty, Property, NodeProps, Binding } from '@io-gui/core'\nimport { IoThreeViewport } from '../elements/IoThreeViewport.js'\nimport { ThreeState } from './ThreeState.js'\nimport { Box3, Camera, Object3D, OrthographicCamera, PerspectiveCamera, Sphere, Vector3 } from 'three/webgpu'\nimport { OrbitControls } from 'three/addons/controls/OrbitControls.js'\n\nconst box = new Box3()\nconst sphere = new Sphere()\nconst center = new Vector3()\nconst delta = new Vector3()\n\nfunction setAspect(camera: PerspectiveCamera | OrthographicCamera, width: number, height: number) {\n  const aspect = width / height\n  if (camera instanceof PerspectiveCamera) {\n    camera.aspect = aspect\n  } else if (camera instanceof OrthographicCamera) {\n    const frustumHeight = camera.top - camera.bottom\n    camera.left = - frustumHeight * aspect / 2\n    camera.right = frustumHeight * aspect / 2\n  }\n  camera.updateProjectionMatrix()\n}\n\nclass DefaultCameras {\n  public perspective: PerspectiveCamera\n  public top: OrthographicCamera\n  public bottom: OrthographicCamera\n  public left: OrthographicCamera\n  public right: OrthographicCamera\n  public front: OrthographicCamera\n  public back: OrthographicCamera\n  constructor() {\n    this.perspective = new PerspectiveCamera(75, 1, 0.1, 1000)\n    this.top = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.bottom = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.left = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.right = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.front = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.back = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n\n    this.perspective.position.set(0.5, 0.25, 1)\n    this.perspective.lookAt(0, 0, 0)\n    this.perspective.name = 'perspective'\n\n    this.top.userData.position = new Vector3(0, 1, 0)\n    this.top.position.copy(this.top.userData.position)\n    this.top.lookAt(0, 0, 0)\n    this.top.name = 'top'\n\n    this.bottom.userData.position = new Vector3(0, -1, 0)\n    this.bottom.position.copy(this.bottom.userData.position)\n    this.bottom.lookAt(0, 0, 0)\n    this.bottom.name = 'bottom'\n\n    this.left.userData.position = new Vector3(-1, 0, 0)\n    this.left.position.copy(this.left.userData.position)\n    this.left.lookAt(0, 0, 0)\n    this.left.name = 'left'\n\n    this.right.userData.position = new Vector3(1, 0, 0)\n    this.right.position.copy(this.right.userData.position)\n    this.right.lookAt(0, 0, 0)\n    this.right.name = 'right'\n\n    this.front.userData.position = new Vector3(0, 0, 1)\n    this.front.position.copy(this.front.userData.position)\n    this.front.lookAt(0, 0, 0)\n    this.front.name = 'front'\n\n    this.back.userData.position = new Vector3(0, 0, -1)\n    this.back.position.copy(this.back.userData.position)\n    this.back.lookAt(0, 0, 0)\n    this.back.name = 'back'\n  }\n  get cameras() {\n    return [this.perspective, this.top, this.bottom, this.left, this.right, this.front, this.back]\n  }\n  getCamera(name: string) {\n    return this.cameras.find(camera => camera.name === name)\n  }\n}\n\n\n\nexport type ViewCamerasProps = NodeProps & {\n  viewport: IoThreeViewport\n  state: ThreeState\n  cameraSelect: string | Binding<string>\n}\n\n@Register\nexport class ViewCameras extends Node {\n  @Property(0)\n  declare private width: number\n  @Property(0)\n  declare private height: number\n\n  @Property()\n  declare private viewport: IoThreeViewport\n\n  @ReactiveProperty({type: ThreeState})\n  declare public state: ThreeState\n\n  @ReactiveProperty({type: String, value: 'perspective'})\n  declare public cameraSelect: string\n\n  @ReactiveProperty({type: Camera})\n  declare public camera: PerspectiveCamera | OrthographicCamera\n\n  @ReactiveProperty({type: DefaultCameras, init: null})\n  declare private readonly defaultCameras: DefaultCameras\n\n  @ReactiveProperty({type: OrbitControls, init: ['this.defaultCameras.perspective']})\n  declare private readonly orbitControls: OrbitControls\n\n  constructor(args: ViewCamerasProps) {\n    super(args)\n\n    this.orbitControls.connect(this.viewport)\n    this.orbitControls.addEventListener('change', () => {\n      this.state.dispatchMutation()\n    })\n\n    if (this.camera === undefined) this.camera = this.defaultCameras.perspective\n  }\n\n  cameraSelectChanged() {\n    if (this.cameraSelect.startsWith('scene')) {\n      const cameraId = this.cameraSelect.split(':')[1] || ''\n      const persp = this.state.scene.getObjectsByProperty('isPerspectiveCamera', true)\n      const ortho = this.state.scene.getObjectsByProperty('isOrthographicCamera', true)\n      const cameras = [...persp, ...ortho]\n\n      let matchedCamera: PerspectiveCamera | OrthographicCamera | undefined\n      if (cameraId) {\n        matchedCamera = cameras.find(camera => camera.name === cameraId) as PerspectiveCamera | OrthographicCamera | undefined\n      } else {\n        matchedCamera = cameras[0] as PerspectiveCamera | OrthographicCamera | undefined\n      }\n      if (matchedCamera) {\n        this.camera = matchedCamera\n      } else {\n        this.camera = this.defaultCameras.perspective\n        console.warn(`Camera ${cameraId} not found in the scene, using default perspective camera`)\n      }\n    } else {\n      this.camera = this.defaultCameras.getCamera(this.cameraSelect) || this.defaultCameras.perspective\n    }\n    this.orbitControls.object = this.camera\n  }\n\n  setSize(width: number, height: number) {\n    if (width === 0 || height === 0) return\n    if (this.width !== width || this.height !== height) {\n      for (const camera of this.defaultCameras.cameras) {\n        setAspect(camera, width, height)\n      }\n      // setAspect(this.camera, width, height)\n      this.width = width\n      this.height = height\n    }\n  }\n\n  cameraChanged() {\n    // TODO: redundant if camera is one of the defaults?\n    // TODO: Consider leaving scene camera aspect ratio unchanged or:\n    // - Set it temporarily to match viewport aspect ratio (show frame mask) and restore it\n\n    // if (!this.defaultCameras.cameras.includes(this.camera)) {\n    //   console.log('cameraChanged', this.camera, this.width, this.height)\n    //   setAspect(this.camera, this.width, this.height)\n    // }\n  }\n\n  stateChanged() {\n    for (const camera of this.defaultCameras.cameras) {\n      this.frameObject(this.state.scene, camera)\n    }\n  }\n\n  frameObject(object: Object3D, camera: Camera) {\n\n    let distance\n\n    box.setFromObject( object )\n\n    if ( box.isEmpty() === false ) {\n      box.getCenter( center )\n      distance = box.getBoundingSphere( sphere ).radius\n    } else {\n      // Focusing on an Group, AmbientLight, etc\n      // TODO: Investigate and make more robust\n      center.setFromMatrixPosition( camera.matrixWorld )\n      distance = 0.1\n    }\n\n    // TODO: Consider frustum geometry (fov) when framing\n\n    delta.set( 0, 0, 1 )\n    delta.applyQuaternion( camera.quaternion )\n    delta.multiplyScalar( distance * 2 )\n\n    if (camera instanceof PerspectiveCamera) {\n      camera.near = distance * 0.001\n      camera.far = distance * 16\n      camera.updateProjectionMatrix()\n      camera.position.copy( center ).add( delta )\n    } else if (camera instanceof OrthographicCamera) {\n      delta.copy(camera.userData.position).multiplyScalar(distance)\n      const aspect = this.width / this.height\n      camera.top = distance\n      camera.bottom = - distance\n      camera.left = - distance * aspect\n      camera.right = distance * aspect\n\n      camera.near = 0\n      camera.far = distance * 8\n\n      camera.position.copy( center ).add( delta)\n      camera.lookAt( center )\n      camera.updateProjectionMatrix()\n    }\n  }\n\n  dispose() {\n    this.orbitControls.dispose()\n    super.dispose()\n  }\n}","import { Register, IoElement, IoElementProps, ReactiveProperty, ReactivityType, Binding } from '@io-gui/core'\nimport { WebGPURenderer, CanvasTarget } from 'three/webgpu'\nimport WebGPU from 'three/addons/capabilities/WebGPU.js'\nimport { ThreeState } from '../nodes/ThreeState.js'\nimport { ViewCameras } from '../nodes/ViewCameras.js'\n\nif ( WebGPU.isAvailable() === false ) {\n  throw new Error( 'No WebGPU support' )\n}\n\nconst observer = new IntersectionObserver((entries) => {\n  entries.forEach(entry => {\n    (entry.target as IoThreeViewport).visible = entry.isIntersecting\n  })\n})\n\n\nconst _renderer = new WebGPURenderer({antialias: false, alpha: true})\n_renderer.setPixelRatio(window.devicePixelRatio)\nvoid _renderer.init()\n\nconst _playingViewports: IoThreeViewport[] = []\n\nnew Promise((resolve, reject) => {\n  _renderer.setAnimationLoop((time: number) => {\n    for (const viewport of _playingViewports) {\n      viewport.onAnimate(time)\n    }\n  }).then(resolve).catch(reject)\n  }).then(() => {\n    console.log('animation loop initialized')\n  }).catch(error => {\n    console.error('animation loop initialization failed', error)\n  })\n\nexport type IoThreeViewportProps = IoElementProps & {\n  state: ThreeState | Binding<ThreeState>\n  cameraSelect?: string | Binding<string>\n  playing?: boolean | Binding<boolean>\n  clearColor?: number | Binding<number>\n  clearAlpha?: number | Binding<number>\n}\n\n@Register\nexport class IoThreeViewport extends IoElement {\n\n  public width: number = 0\n  public height: number = 0\n  public visible: boolean = false\n\n  @ReactiveProperty({type: Number, value: 0x000000})\n  declare public clearColor: number\n\n  @ReactiveProperty({type: Number, value: 1})\n  declare public clearAlpha: number\n\n  @ReactiveProperty({type: String, value: 'throttled'})\n  declare reactivity: ReactivityType\n\n  @ReactiveProperty({type: ThreeState, init: null})\n  declare state: ThreeState\n\n  @ReactiveProperty({type: Boolean})\n  declare playing: boolean\n\n  @ReactiveProperty({type: String, value: 'perspective'})\n  declare cameraSelect: string\n\n  declare private readonly viewCameras: ViewCameras\n  declare private readonly renderTarget: CanvasTarget\n\n  static get Style() {\n    return /* css */`\n      :host {\n        position: relative;\n        display: flex;\n        flex: 1 1 auto;\n        flex-direction: column;\n        max-width: 100%;\n        max-height: 100%;\n        overflow: hidden;\n      }\n      :host > canvas {\n        position: absolute;\n      }\n    `\n  }\n\n  constructor(args: IoThreeViewportProps) {\n    super(args)\n    this.renderViewport = this.renderViewport.bind(this)\n\n    this.renderTarget = new CanvasTarget(document.createElement('canvas'))\n    this.appendChild(this.renderTarget.domElement)\n\n    this.viewCameras = new ViewCameras({viewport: this, state: this.state, cameraSelect: this.bind('cameraSelect')})\n\n    this.debounce(this.renderViewport)\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n    observer.observe(this)\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    observer.unobserve(this)\n    this.visible = false\n  }\n\n  playingChanged() {\n    if (this.playing) {\n      _playingViewports.push(this)\n    } else if (_playingViewports.includes(this)) {\n      _playingViewports.splice(_playingViewports.indexOf(this), 1)\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onAnimate(time: number) {\n    if (!this.visible) return\n    this.debounce(this.renderViewport)\n  }\n\n  onResized() {\n    const rect = this.getBoundingClientRect()\n    this.width = Math.floor(rect.width)\n    this.height = Math.floor(rect.height)\n    this.renderTarget.setSize(this.width, this.height)\n    this.renderTarget.setPixelRatio(window.devicePixelRatio)\n    this.viewCameras.setSize(this.width, this.height)\n    this.renderViewport()\n  }\n\n  stateChanged() {\n    this.debounce(this.renderViewport)\n  }\n  stateMutated() {\n    this.debounce(this.renderViewport)\n  }\n  changed() {\n    this.debounce(this.renderViewport)\n  }\n\n  renderViewport() {\n    if (_renderer.initialized === false) {\n      this.debounce(this.renderViewport)\n      return\n    }\n    if (this.state.isRendererInitialized() === false) {\n      void this.state.onRendererInitialized(_renderer)\n    }\n    if (!this.width || !this.height) {\n      return\n    }\n    _renderer.setCanvasTarget(this.renderTarget)\n    _renderer.setClearColor(this.clearColor, this.clearAlpha)\n    _renderer.setSize(this.width, this.height)\n    _renderer.clear()\n\n    this.state.setViewportSize(this.width, this.height)\n    this.state.onAnimate()\n    _renderer.render(this.state.scene, this.viewCameras.camera)\n  }\n\n  dispose() {\n    super.dispose()\n    this.renderTarget.dispose()\n    this.viewCameras.dispose()\n  }\n}\n\nexport const ioThreeViewport = function(arg0: IoThreeViewportProps) {\n  return IoThreeViewport.vConstructor(arg0)\n}"],"names":["ThreeState","Node","renderer","width","height","setViewportSize","this","onResized","isRendererInitialized","initialized","onRendererInitialized","onAnimate","__decorateClass","ReactiveProperty","type","Scene","init","prototype","Register","box","Box3","sphere","Sphere","center","Vector3","delta","setAspect","camera","aspect","PerspectiveCamera","OrthographicCamera","frustumHeight","top","bottom","left","right","updateProjectionMatrix","ViewCameras","constructor","args","super","orbitControls","connect","viewport","addEventListener","state","dispatchMutation","defaultCameras","perspective","cameraSelectChanged","cameraSelect","startsWith","cameraId","split","cameras","scene","getObjectsByProperty","matchedCamera","find","name","console","warn","getCamera","object","setSize","cameraChanged","stateChanged","frameObject","distance","setFromObject","isEmpty","getCenter","getBoundingSphere","radius","setFromMatrixPosition","matrixWorld","set","applyQuaternion","quaternion","multiplyScalar","near","far","position","copy","add","userData","lookAt","dispose","Property","String","value","Camera","DefaultCameras","front","back","OrbitControls","WebGPU","isAvailable","Error","observer","IntersectionObserver","entries","forEach","entry","target","visible","isIntersecting","_renderer","WebGPURenderer","antialias","alpha","setPixelRatio","window","devicePixelRatio","_playingViewports","Promise","resolve","reject","setAnimationLoop","time","then","catch","log","error","IoThreeViewport","IoElement","Style","renderViewport","bind","renderTarget","CanvasTarget","document","createElement","appendChild","domElement","viewCameras","debounce","connectedCallback","observe","disconnectedCallback","unobserve","playingChanged","playing","push","includes","splice","indexOf","rect","getBoundingClientRect","Math","floor","stateMutated","changed","setCanvasTarget","setClearColor","clearColor","clearAlpha","clear","render","Number","Boolean","ioThreeViewport","arg0","vConstructor"],"mappings":"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"}