{"version":3,"file":"index.js","sources":["../src/nodes/ThreeState.ts","../src/nodes/ViewCameras.ts","../src/elements/IoThreeViewport.ts"],"sourcesContent":["import { Register, Node, ReactiveProperty } from '@io-gui/core'\nimport { Scene, WebGPURenderer } from 'three/webgpu'\n\n@Register\nexport class ThreeState extends Node {\n\n  @ReactiveProperty({type: Scene, init: null})\n  declare scene: Scene\n\n  public renderer: WebGPURenderer | null = null\n\n  public width: number = 0\n  public height: number = 0\n\n  private _lastAnimatedFrame: number = -1\n\n  setViewportSize(width: number, height: number) {\n    if (this.width !== width || this.height !== height) {\n      if (!!width && !!height) {\n        this.width = width\n        this.height = height\n        this.onResized(width, height)\n      }\n    }\n\n  }\n  isRendererInitialized() {\n    return !!this.renderer && this.renderer.initialized === true\n  }\n  onRendererInitialized(renderer: WebGPURenderer) {\n    this.renderer = renderer\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onResized(width: number, height: number) {}\n\n  animate(time: number, delta: number) {\n    if (this._lastAnimatedFrame === time) return\n    this._lastAnimatedFrame = time\n    this.onAnimate(delta)\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onAnimate(delta: number) {}\n}","import { Register, Node, ReactiveProperty, Property, NodeProps, Binding } from '@io-gui/core'\nimport { IoThreeViewport } from '../elements/IoThreeViewport.js'\nimport { ThreeState } from './ThreeState.js'\nimport { Box3, Camera, Object3D, OrthographicCamera, PerspectiveCamera, Sphere, Vector3 } from 'three/webgpu'\nimport { OrbitControls } from 'three/addons/controls/OrbitControls.js'\n\nconst box = new Box3()\nconst sphere = new Sphere()\nconst center = new Vector3()\nconst delta = new Vector3()\n\nfunction setAspect(camera: PerspectiveCamera | OrthographicCamera, width: number, height: number) {\n  const aspect = width / height\n  if (camera instanceof PerspectiveCamera) {\n    camera.aspect = aspect\n  } else if (camera instanceof OrthographicCamera) {\n    const frustumHeight = camera.top - camera.bottom\n    camera.left = - frustumHeight * aspect / 2\n    camera.right = frustumHeight * aspect / 2\n  }\n  camera.updateProjectionMatrix()\n}\n\nclass DefaultCameras {\n  public perspective: PerspectiveCamera\n  public top: OrthographicCamera\n  public bottom: OrthographicCamera\n  public left: OrthographicCamera\n  public right: OrthographicCamera\n  public front: OrthographicCamera\n  public back: OrthographicCamera\n  constructor() {\n    this.perspective = new PerspectiveCamera(75, 1, 0.1, 1000)\n    this.top = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.bottom = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.left = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.right = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.front = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.back = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n\n    this.perspective.position.set(0.5, 0.25, 1)\n    this.perspective.lookAt(0, 0, 0)\n    this.perspective.name = 'perspective'\n\n    this.top.userData.position = new Vector3(0, 1, 0)\n    this.top.position.copy(this.top.userData.position)\n    this.top.lookAt(0, 0, 0)\n    this.top.name = 'top'\n\n    this.bottom.userData.position = new Vector3(0, -1, 0)\n    this.bottom.position.copy(this.bottom.userData.position)\n    this.bottom.lookAt(0, 0, 0)\n    this.bottom.name = 'bottom'\n\n    this.left.userData.position = new Vector3(-1, 0, 0)\n    this.left.position.copy(this.left.userData.position)\n    this.left.lookAt(0, 0, 0)\n    this.left.name = 'left'\n\n    this.right.userData.position = new Vector3(1, 0, 0)\n    this.right.position.copy(this.right.userData.position)\n    this.right.lookAt(0, 0, 0)\n    this.right.name = 'right'\n\n    this.front.userData.position = new Vector3(0, 0, 1)\n    this.front.position.copy(this.front.userData.position)\n    this.front.lookAt(0, 0, 0)\n    this.front.name = 'front'\n\n    this.back.userData.position = new Vector3(0, 0, -1)\n    this.back.position.copy(this.back.userData.position)\n    this.back.lookAt(0, 0, 0)\n    this.back.name = 'back'\n  }\n  get cameras() {\n    return [this.perspective, this.top, this.bottom, this.left, this.right, this.front, this.back]\n  }\n  getCamera(name: string) {\n    return this.cameras.find(camera => camera.name === name)\n  }\n}\n\n\n\nexport type ViewCamerasProps = NodeProps & {\n  viewport: IoThreeViewport\n  state: ThreeState\n  cameraSelect: string | Binding<string>\n}\n\n@Register\nexport class ViewCameras extends Node {\n  @Property(0)\n  declare private width: number\n  @Property(0)\n  declare private height: number\n\n  @Property()\n  declare private viewport: IoThreeViewport\n\n  @ReactiveProperty({type: ThreeState})\n  declare public state: ThreeState\n\n  @ReactiveProperty({type: String, value: 'perspective'})\n  declare public cameraSelect: string\n\n  @ReactiveProperty({type: Camera})\n  declare public camera: PerspectiveCamera | OrthographicCamera\n\n  @ReactiveProperty({type: DefaultCameras, init: null})\n  declare private readonly defaultCameras: DefaultCameras\n\n  @ReactiveProperty({type: OrbitControls, init: ['this.defaultCameras.perspective']})\n  declare private readonly orbitControls: OrbitControls\n\n  static get Listeners() {\n    return {\n      'scene-ready': 'onSceneReady'\n    }\n  }\n\n  constructor(args: ViewCamerasProps) {\n    super(args)\n\n    this.orbitControls.connect(this.viewport)\n    this.orbitControls.addEventListener('change', () => {\n      this.state.dispatchMutation()\n    })\n\n    if (this.camera === undefined) this.camera = this.defaultCameras.perspective\n  }\n\n  cameraSelectChanged() {\n    if (this.cameraSelect.startsWith('scene')) {\n      const cameraId = this.cameraSelect.split(':')[1] || ''\n      const persp = this.state.scene.getObjectsByProperty('isPerspectiveCamera', true)\n      const ortho = this.state.scene.getObjectsByProperty('isOrthographicCamera', true)\n      const cameras = [...persp, ...ortho]\n\n      let matchedCamera: PerspectiveCamera | OrthographicCamera | undefined\n      if (cameraId) {\n        matchedCamera = cameras.find(camera => camera.name === cameraId) as PerspectiveCamera | OrthographicCamera | undefined\n      } else {\n        matchedCamera = cameras[0] as PerspectiveCamera | OrthographicCamera | undefined\n      }\n      if (matchedCamera) {\n        this.camera = matchedCamera\n      } else {\n        this.camera = this.defaultCameras.perspective\n        console.warn(`Camera ${cameraId} not found in the scene, using default perspective camera`)\n      }\n    } else {\n      this.camera = this.defaultCameras.getCamera(this.cameraSelect) || this.defaultCameras.perspective\n    }\n  }\n\n  setSize(width: number, height: number) {\n    if (width === 0 || height === 0) return\n    if (this.width !== width || this.height !== height) {\n      for (const camera of this.defaultCameras.cameras) {\n        setAspect(camera, width, height)\n      }\n      // setAspect(this.camera, width, height)\n      this.width = width\n      this.height = height\n    }\n  }\n\n  cameraChanged() {\n    // TODO: redundant if camera is one of the defaults?\n    // TODO: Consider leaving scene camera aspect ratio unchanged or:\n    // - Set it temporarily to match viewport aspect ratio (show frame mask) and restore it\n    if (!this.defaultCameras.cameras.includes(this.camera)) {\n      this.orbitControls.enabled = false\n    } else {\n      this.orbitControls.enabled = true\n      this.orbitControls.object = this.camera\n    }\n  }\n\n  stateChanged() {\n    for (const camera of this.defaultCameras.cameras) {\n      this.frameObject(this.state.scene, camera)\n    }\n  }\n\n  onSceneReady() {\n    this.frameObject(this.state.scene, this.camera)\n  }\n\n  frameObject(object: Object3D, camera: Camera) {\n\n    let distance\n\n    box.setFromObject( object )\n\n    if ( box.isEmpty() === false ) {\n      box.getCenter( center )\n      distance = box.getBoundingSphere( sphere ).radius\n    } else {\n      // Focusing on an Group, AmbientLight, etc\n      // TODO: Investigate and make more robust\n      center.setFromMatrixPosition( camera.matrixWorld )\n      distance = 0.1\n    }\n\n    // TODO: Consider frustum geometry (fov) when framing\n\n    delta.set( 0, 0, 1 )\n    delta.applyQuaternion( camera.quaternion )\n    delta.multiplyScalar( distance * 2 )\n\n    if (camera instanceof PerspectiveCamera) {\n      camera.near = distance * 0.001\n      camera.far = distance * 16\n      camera.updateProjectionMatrix()\n      camera.position.copy( center ).add( delta )\n    } else if (camera instanceof OrthographicCamera) {\n      delta.copy(camera.userData.position).multiplyScalar(distance)\n      const aspect = this.width / this.height\n      camera.top = distance\n      camera.bottom = - distance\n      camera.left = - distance * aspect\n      camera.right = distance * aspect\n\n      camera.near = 0\n      camera.far = distance * 8\n\n      camera.position.copy( center ).add( delta)\n      camera.lookAt( center )\n      camera.updateProjectionMatrix()\n    }\n\n    this.orbitControls.target.copy( center )\n  }\n\n  dispose() {\n    this.orbitControls.dispose()\n    super.dispose()\n  }\n}","import { Register, IoElement, IoElementProps, ReactiveProperty, ReactivityType, Binding } from '@io-gui/core'\nimport { WebGPURenderer, CanvasTarget, Clock } from 'three/webgpu'\nimport WebGPU from 'three/addons/capabilities/WebGPU.js'\nimport { ThreeState } from '../nodes/ThreeState.js'\nimport { ViewCameras } from '../nodes/ViewCameras.js'\n\nif ( WebGPU.isAvailable() === false ) {\n  throw new Error( 'No WebGPU support' )\n}\n\nconst observer = new IntersectionObserver((entries) => {\n  entries.forEach(entry => {\n    (entry.target as IoThreeViewport).visible = entry.isIntersecting\n  })\n})\n\n// TODO: Add support for logarithmic depth buffer\n// TODO: Add support for unique renderer instances per viewport\nconst _renderer = new WebGPURenderer({antialias: false, alpha: true})\n_renderer.setPixelRatio(window.devicePixelRatio)\nvoid _renderer.init()\n\nconst _clock = new Clock()\n\nconst _playingViewports: IoThreeViewport[] = []\nlet _currentFrameTime = -1\nlet _currentFrameDelta = 0\n\nnew Promise((resolve, reject) => {\n  _renderer.setAnimationLoop((time: number) => {\n    _currentFrameTime = time\n    _currentFrameDelta = _clock.getDelta()\n    for (const viewport of _playingViewports) {\n      viewport.onAnimate()\n    }\n  }).then(resolve).catch(reject)\n}).then(() => {\n  console.log('animation loop initialized')\n}).catch(error => {\n  console.error('animation loop initialization failed', error)\n})\n\nexport type IoThreeViewportProps = IoElementProps & {\n  state: ThreeState | Binding<ThreeState>\n  cameraSelect?: string | Binding<string>\n  playing?: boolean | Binding<boolean>\n  clearColor?: number | Binding<number>\n  clearAlpha?: number | Binding<number>\n}\n\n@Register\nexport class IoThreeViewport extends IoElement {\n\n  public width: number = 0\n  public height: number = 0\n  public visible: boolean = false\n\n  @ReactiveProperty({type: Number, value: 0x000000})\n  declare public clearColor: number\n\n  @ReactiveProperty({type: Number, value: 1})\n  declare public clearAlpha: number\n\n  @ReactiveProperty({type: String, value: 'throttled'})\n  declare reactivity: ReactivityType\n\n  @ReactiveProperty({type: ThreeState, init: null})\n  declare state: ThreeState\n\n  @ReactiveProperty({type: Boolean})\n  declare playing: boolean\n\n  @ReactiveProperty({type: String, value: 'perspective'})\n  declare cameraSelect: string\n\n  declare private readonly viewCameras: ViewCameras\n  declare private readonly renderTarget: CanvasTarget\n\n  static get Style() {\n    return /* css */`\n      :host {\n        position: relative;\n        display: flex;\n        flex: 1 1 auto;\n        flex-direction: column;\n        max-width: 100%;\n        max-height: 100%;\n        overflow: hidden;\n      }\n      :host > canvas {\n        position: absolute;\n      }\n    `\n  }\n\n  constructor(args: IoThreeViewportProps) {\n    super(args)\n    this.renderViewport = this.renderViewport.bind(this)\n\n    this.renderTarget = new CanvasTarget(document.createElement('canvas'))\n    this.appendChild(this.renderTarget.domElement)\n\n    this.viewCameras = new ViewCameras({viewport: this, state: this.state, cameraSelect: this.bind('cameraSelect')})\n\n    this.debounce(this.renderViewport)\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n    observer.observe(this)\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    observer.unobserve(this)\n    this.visible = false\n  }\n\n  playingChanged() {\n    if (this.playing) {\n      _playingViewports.push(this)\n    } else if (_playingViewports.includes(this)) {\n      _playingViewports.splice(_playingViewports.indexOf(this), 1)\n    }\n  }\n\n\n  onAnimate() {\n    if (!this.visible) return\n    this.debounce(this.renderViewport)\n  }\n\n  onResized() {\n    const rect = this.getBoundingClientRect()\n    this.width = Math.floor(rect.width)\n    this.height = Math.floor(rect.height)\n    this.renderTarget.setSize(this.width, this.height)\n    this.renderTarget.setPixelRatio(window.devicePixelRatio)\n    this.viewCameras.setSize(this.width, this.height)\n    this.renderViewport()\n  }\n\n  stateChanged() {\n    this.debounce(this.renderViewport)\n  }\n  stateMutated() {\n    this.debounce(this.renderViewport)\n  }\n  changed() {\n    this.debounce(this.renderViewport)\n  }\n\n  renderViewport() {\n    if (_renderer.initialized === false) {\n      this.debounce(this.renderViewport)\n      return\n    }\n    if (this.state.isRendererInitialized() === false) {\n      void this.state.onRendererInitialized(_renderer)\n    }\n    if (!this.width || !this.height) {\n      return\n    }\n    _renderer.setCanvasTarget(this.renderTarget)\n    _renderer.setClearColor(this.clearColor, this.clearAlpha)\n    _renderer.setSize(this.width, this.height)\n    _renderer.clear()\n\n    this.state.setViewportSize(this.width, this.height)\n    this.state.animate(_currentFrameTime, _currentFrameDelta)\n    _renderer.render(this.state.scene, this.viewCameras.camera)\n  }\n\n  dispose() {\n    super.dispose()\n    this.renderTarget.dispose()\n    this.viewCameras.dispose()\n  }\n}\n\nexport const ioThreeViewport = function(arg0: IoThreeViewportProps) {\n  return IoThreeViewport.vConstructor(arg0)\n}"],"names":["ThreeState","Node","renderer","width","height","_lastAnimatedFrame","setViewportSize","this","onResized","isRendererInitialized","initialized","onRendererInitialized","animate","time","delta","onAnimate","__decorateClass","ReactiveProperty","type","Scene","init","prototype","Register","box","Box3","sphere","Sphere","center","Vector3","setAspect","camera","aspect","PerspectiveCamera","OrthographicCamera","frustumHeight","top","bottom","left","right","updateProjectionMatrix","ViewCameras","Listeners","constructor","args","super","orbitControls","connect","viewport","addEventListener","state","dispatchMutation","defaultCameras","perspective","cameraSelectChanged","cameraSelect","startsWith","cameraId","split","cameras","scene","getObjectsByProperty","matchedCamera","find","name","console","warn","getCamera","setSize","cameraChanged","includes","enabled","object","stateChanged","frameObject","onSceneReady","distance","setFromObject","isEmpty","getCenter","getBoundingSphere","radius","setFromMatrixPosition","matrixWorld","set","applyQuaternion","quaternion","multiplyScalar","near","far","position","copy","add","userData","lookAt","target","dispose","Property","String","value","Camera","DefaultCameras","front","back","OrbitControls","WebGPU","isAvailable","Error","observer","IntersectionObserver","entries","forEach","entry","visible","isIntersecting","_renderer","WebGPURenderer","antialias","alpha","setPixelRatio","window","devicePixelRatio","_clock","Clock","_playingViewports","_currentFrameTime","_currentFrameDelta","Promise","resolve","reject","setAnimationLoop","getDelta","then","catch","log","error","IoThreeViewport","IoElement","Style","renderViewport","bind","renderTarget","CanvasTarget","document","createElement","appendChild","domElement","viewCameras","debounce","connectedCallback","observe","disconnectedCallback","unobserve","playingChanged","playing","push","splice","indexOf","rect","getBoundingClientRect","Math","floor","stateMutated","changed","setCanvasTarget","setClearColor","clearColor","clearAlpha","clear","render","Number","Boolean","ioThreeViewport","arg0","vConstructor"],"mappings":"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"}