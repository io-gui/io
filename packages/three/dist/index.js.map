{"version":3,"file":"index.js","sources":["../src/elements/IoBuildGeometry.ts","../src/nodes/ThreeApplet.ts","../src/nodes/ViewCameras.ts","../src/elements/IoThreeViewport.ts"],"sourcesContent":["import { Register, IoElement, IoElementProps, ReactiveProperty, WithBinding } from '@io-gui/core'\nimport { ioButton } from '@io-gui/inputs'\nimport { ioPropertyEditor } from '@io-gui/editors'\nimport { BufferGeometry, type NormalOrGLBufferAttributes } from 'three/webgpu'\n\ntype GeometryConstructor<T extends BufferGeometry<NormalOrGLBufferAttributes>> = new (...args: any[]) => T\n\nexport type IoBuildGeometryProps = IoElementProps & {\n  value?: WithBinding<BufferGeometry<NormalOrGLBufferAttributes>>\n}\n\n@Register\nexport class IoBuildGeometry extends IoElement {\n\n  @ReactiveProperty({type: Object, init: null})\n  declare value: BufferGeometry<NormalOrGLBufferAttributes> | null\n\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex-direction: column;\n      }\n    `\n  }\n\n  constructor(args: IoBuildGeometryProps = {}) {\n    super(args)\n  }\n\n  buildGeometry() {\n    const geometry = this.value\n    if (!geometry) return\n\n    const parameters = (geometry as any).parameters\n    if (!parameters) {\n      debug: {\n        console.warn('IoBuildGeometry: geometry has no parameters property')\n      }\n      return\n    }\n\n    const GeometryClass = geometry.constructor as GeometryConstructor<typeof geometry>\n    const parameterValues = Object.values(parameters)\n\n    const newGeometry = new GeometryClass(...parameterValues)\n    geometry.copy(newGeometry as BufferGeometry)\n    newGeometry.dispose()\n\n    geometry.computeVertexNormals()\n    geometry.computeTangents()\n    geometry.computeBoundingSphere()\n    geometry.computeBoundingBox()\n\n    this.dispatchMutation(geometry)\n    this.dispatchMutation(geometry.boundingBox!)\n    this.dispatchMutation(geometry.boundingSphere!)\n  }\n\n  changed() {\n    const hasParameters = this.value && (this.value as any).parameters\n    this.render([\n      ioPropertyEditor({\n        value: this.value as any,\n        properties: ['parameters'],\n        labeled: false,\n      }),\n      ioButton({\n        label: 'Build Geometry',\n        action: () => this.buildGeometry(),\n        disabled: !hasParameters,\n      }),\n      ioButton({\n        label: 'Compute Vertex Normals',\n        action: () => {\n          this.value?.computeVertexNormals()\n        },\n      }),\n      ioButton({\n        label: 'Compute Tangents',\n        action: () => {\n          this.value?.computeTangents()\n        },\n      }),\n      ioButton({\n        label: 'Compute Bounding Sphere',\n        action: () => {\n          this.value?.computeBoundingSphere()\n          this.dispatchMutation(this.value!.boundingSphere!)\n          this.dispatchMutation(this.value!.boundingSphere!.center!)\n        },\n      }),\n      ioButton({\n        label: 'Compute Bounding Box',\n        action: () => {\n          this.value?.computeBoundingBox()\n          this.dispatchMutation(this.value!.boundingBox!.max!)\n          this.dispatchMutation(this.value!.boundingBox!.min!)\n        },\n      }),\n    ])\n  }\n}\n\nexport const ioBuildGeometry = function(arg0?: IoBuildGeometryProps) {\n  return IoBuildGeometry.vConstructor(arg0)\n}\n","import { Register, ReactiveNode, ReactiveProperty, ReactiveNodeProps } from '@io-gui/core'\nimport { ioNumberSlider } from '@io-gui/sliders'\nimport { ioPropertyEditor, PropertyConfig, PropertyGroups, registerEditorConfig, registerEditorGroups } from '@io-gui/editors'\nimport { ACESFilmicToneMapping, AgXToneMapping, CineonToneMapping, LinearToneMapping, NeutralToneMapping, NoToneMapping, ReinhardToneMapping, Scene, ToneMapping, WebGPURenderer } from 'three/webgpu'\nimport { ioOptionSelect, MenuOption } from '@io-gui/menus'\n\nexport type ThreeAppletProps = ReactiveNodeProps & {\n  scene?: Scene\n  toneMappingExposure?: number\n  toneMapping?: ToneMapping\n  uiConfig?: PropertyConfig[]\n}\n\n@Register\nexport class ThreeApplet extends ReactiveNode {\n\n  @ReactiveProperty({type: Scene, init: null})\n  declare scene: Scene\n\n  @ReactiveProperty({type: Number, value: 1})\n  declare toneMappingExposure: number\n\n  @ReactiveProperty({type: Number, value: NoToneMapping})\n  declare toneMapping: ToneMapping\n\n  // TODO: dispose uiConfig when applet is disposed\n  @ReactiveProperty({type: Array, init: null})\n  declare uiConfig: PropertyConfig[]\n\n  @ReactiveProperty({type: Object, init: null})\n  declare uiGroups: PropertyGroups\n\n  private _renderer: WebGPURenderer | null = null\n  private _width: number = 0\n  private _height: number = 0\n  private _prevTime: number = -1\n\n  constructor(args?: ThreeAppletProps) {\n    super(args)\n  }\n  updateViewportSize(width: number, height: number) {\n    if (this._width !== width || this._height !== height) {\n      if (!!width && !!height) {\n        this._width = width\n        this._height = height\n        this.onResized(width, height)\n      }\n    }\n\n  }\n  isRendererInitialized() {\n    return !!this._renderer && this._renderer.initialized === true\n  }\n  onRendererInitialized(renderer: WebGPURenderer) {\n    this._renderer = renderer\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onResized(width: number, height: number) {}\n\n  animate(time: number, delta: number) {\n    if (this._prevTime === time) return\n    this._prevTime = time\n    this.onAnimate(delta)\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onAnimate(delta: number) {}\n}\n\nregisterEditorConfig(ThreeApplet, [\n  ['toneMappingExposure', ioNumberSlider({min: 0, max: 3, step: 0.01, exponent: 2})],\n  ['toneMapping', ioOptionSelect({option: new MenuOption({options: [\n    {value: NoToneMapping, id: 'NoToneMapping'},\n    {value: LinearToneMapping, id: 'LinearToneMapping'},\n    {value: ReinhardToneMapping, id: 'ReinhardToneMapping'},\n    {value: CineonToneMapping, id: 'CineonToneMapping'},\n    {value: ACESFilmicToneMapping, id: 'ACESFilmicToneMapping'},\n    // {value: CustomToneMapping, id: 'CustomToneMapping'},\n    {value: AgXToneMapping, id: 'AgXToneMapping'},\n    {value: NeutralToneMapping, id: 'NeutralToneMapping'},\n  ]})})],\n  ['scene', ioPropertyEditor({properties: ['children'], label: '_hidden_'})],\n])\n\nregisterEditorGroups(ThreeApplet, {\n  Main: [\n    'scene',\n  ],\n  Hidden: [\n    'toneMapping',\n    'toneMappingExposure',\n    'uiConfig',\n    'uiGroups',\n    '_renderer',\n    '_width',\n    '_height',\n    '_prevTime',\n  ],\n})","import { Register, ReactiveNode, ReactiveProperty, Property, ReactiveNodeProps, Binding  } from '@io-gui/core'\nimport { IoThreeViewport } from '../elements/IoThreeViewport.js'\nimport { ThreeApplet } from './ThreeApplet.js'\nimport { Box3, Camera, Object3D, OrthographicCamera, PerspectiveCamera, Sphere, Vector3 } from 'three/webgpu'\nimport { OrbitControls } from 'three/addons/controls/OrbitControls.js'\n\nconst box = new Box3()\nconst sphere = new Sphere()\nconst center = new Vector3()\nconst size = new Vector3()\nconst delta = new Vector3()\nconst cameraRight = new Vector3()\nconst cameraUp = new Vector3()\nconst cameraForward = new Vector3()\nconst corner = new Vector3()\nlet radius = 0\n\nconst resetCameras = new WeakMap<Camera, Camera>()\n\nclass DefaultCameras {\n  public perspective: PerspectiveCamera\n  public top: OrthographicCamera\n  public bottom: OrthographicCamera\n  public left: OrthographicCamera\n  public right: OrthographicCamera\n  public front: OrthographicCamera\n  public back: OrthographicCamera\n  constructor() {\n    this.perspective = new PerspectiveCamera(50, 1, 0.1, 1000)\n    this.top = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.bottom = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.left = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.right = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.front = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n    this.back = new OrthographicCamera(-1, 1, 1, -1, 0, 1000)\n\n    this.perspective.userData.position = new Vector3(0.5, 0.25, 1)\n    this.perspective.position.copy(this.perspective.userData.position)\n    this.perspective.lookAt(0, 0, 0)\n    this.perspective.name = 'perspective'\n\n    this.top.userData.position = new Vector3(0, 1, 0)\n    this.top.position.copy(this.top.userData.position)\n    this.top.lookAt(0, 0, 0)\n    this.top.name = 'top'\n\n    this.bottom.userData.position = new Vector3(0, -1, 0)\n    this.bottom.position.copy(this.bottom.userData.position)\n    this.bottom.lookAt(0, 0, 0)\n    this.bottom.name = 'bottom'\n\n    this.left.userData.position = new Vector3(-1, 0, 0)\n    this.left.position.copy(this.left.userData.position)\n    this.left.lookAt(0, 0, 0)\n    this.left.name = 'left'\n\n    this.right.userData.position = new Vector3(1, 0, 0)\n    this.right.position.copy(this.right.userData.position)\n    this.right.lookAt(0, 0, 0)\n    this.right.name = 'right'\n\n    this.front.userData.position = new Vector3(0, 0, 1)\n    this.front.position.copy(this.front.userData.position)\n    this.front.lookAt(0, 0, 0)\n    this.front.name = 'front'\n\n    this.back.userData.position = new Vector3(0, 0, -1)\n    this.back.position.copy(this.back.userData.position)\n    this.back.lookAt(0, 0, 0)\n    this.back.name = 'back'\n  }\n  get cameras() {\n    return [this.perspective, this.top, this.bottom, this.left, this.right, this.front, this.back]\n  }\n  getCamera(name: string) {\n    return this.cameras.find(camera => camera.name === name)\n  }\n}\n\n\n\nexport type ViewCamerasProps = ReactiveNodeProps & {\n  viewport: IoThreeViewport\n  applet: ThreeApplet | Binding\n  cameraSelect: string | Binding\n}\n\n@Register\nexport class ViewCameras extends ReactiveNode {\n\n  @Property()\n  declare private viewport: IoThreeViewport\n\n  @ReactiveProperty({type: ThreeApplet})\n  declare public applet: ThreeApplet\n\n  @ReactiveProperty({type: String, value: 'perspective'})\n  declare public cameraSelect: string\n\n  @ReactiveProperty({type: Camera})\n  declare public camera: PerspectiveCamera | OrthographicCamera\n\n  @ReactiveProperty({type: DefaultCameras, init: null})\n  declare private readonly defaultCameras: DefaultCameras\n\n  @ReactiveProperty({type: OrbitControls, init: ['this.defaultCameras.perspective']})\n  declare private readonly orbitControls: OrbitControls\n\n  static get Listeners() {\n    return {\n      'frame-object': 'onFrameObject'\n    }\n  }\n\n  constructor(args: ViewCamerasProps) {\n    super(args)\n\n    this.orbitControls.connect(this.viewport)\n    this.orbitControls.addEventListener('change', () => {\n      this.applet.dispatchMutation()\n    })\n\n    if (this.camera === undefined) this.camera = this.defaultCameras.perspective\n  }\n\n  cameraSelectChanged() {\n    this.debounce(this.cameraSelectChangedDebounced)\n  }\n\n  cameraSelectChangedDebounced() {\n    let matchedCamera: PerspectiveCamera | OrthographicCamera | undefined\n    if (this.cameraSelect.startsWith('scene')) {\n      const cameraId = this.cameraSelect.split(':')[1] || ''\n      const persp = this.applet.scene.getObjectsByProperty('isPerspectiveCamera', true)\n      const ortho = this.applet.scene.getObjectsByProperty('isOrthographicCamera', true)\n      const cameras = [...persp, ...ortho]\n\n      if (cameraId) {\n        matchedCamera = cameras.find(camera => camera.name === cameraId) as PerspectiveCamera | OrthographicCamera | undefined\n        if (!matchedCamera) {\n          console.warn(`Camera ${cameraId} not found in the scene, using default perspective camera`)\n        }\n      } else {\n        matchedCamera = cameras[0] as PerspectiveCamera | OrthographicCamera | undefined\n        if (!matchedCamera) {\n          console.warn('No cameras found in the scene, using default perspective camera')\n        }\n      }\n      if (matchedCamera) {\n        this.camera = matchedCamera\n      } else {\n        this.camera = this.defaultCameras.perspective\n      }\n    } else {\n      matchedCamera = this.defaultCameras.getCamera(this.cameraSelect)\n      if (matchedCamera) {\n        this.camera = matchedCamera\n      } else {\n        console.warn(`Camera ${this.cameraSelect} not found in the default cameras, using default perspective camera`)\n        this.camera = this.defaultCameras.perspective\n      }\n    }\n  }\n\n  cameraChanged() {\n    // TODO: redundant if camera is one of the defaults?\n    // TODO: Consider leaving scene camera aspect ratio unchanged or:\n    // - Set it temporarily to match viewport aspect ratio (show frame mask) and restore it\n    if (!this.defaultCameras.cameras.includes(this.camera)) {\n      this.orbitControls.enabled = false\n    } else {\n      this.orbitControls.enabled = true\n      this.orbitControls.object = this.camera\n      this.orbitControls.enableRotate = !!(this.camera as PerspectiveCamera).isPerspectiveCamera\n    }\n  }\n\n  appletChanged() {\n    this.frameObjectAll(this.applet.scene)\n  }\n\n  onFrameObject(event: CustomEvent<{object: Object3D; overscan: number}>) {\n    this.frameObjectAll(event.detail.object, event.detail.overscan)\n  }\n\n  frameObjectAll(object: Object3D, overscan: number = 1) {\n    debug: {\n      if (object === undefined) {\n        console.error('frameObject: object is undefined')\n        return\n      }\n    }\n    for (const camera of this.defaultCameras.cameras) {\n      camera.position.copy(camera.userData.position)\n      camera.lookAt(0, 0, 0)\n      this.frameObject(object, camera, overscan)\n    }\n    // TODO: Reconsider\n    this.debounce(this.cameraSelectChangedDebounced)\n  }\n\n  frameObject(object: Object3D, camera: Camera, overscan: number = 1) {\n\n    box.setFromObject( object )\n\n    if ( box.isEmpty() === false ) {\n      box.getCenter( center )\n      radius = box.getBoundingSphere( sphere ).radius\n    } else {\n      // Focusing on an Group, AmbientLight, etc\n      // TODO: Investigate and make more robust\n      center.setFromMatrixPosition( camera.matrixWorld )\n      radius = 0.1\n    }\n\n    // Project box onto camera axes\n    cameraRight.set(1, 0, 0).applyQuaternion(camera.quaternion)\n    cameraUp.set(0, 1, 0).applyQuaternion(camera.quaternion)\n    cameraForward.set(0, 0, -1).applyQuaternion(camera.quaternion)\n\n    box.getSize(size).multiplyScalar(0.5)\n\n    const halfWidth = Math.abs(size.x * cameraRight.x) + Math.abs(size.y * cameraRight.y) + Math.abs(size.z * cameraRight.z)\n    const halfHeight = Math.abs(size.x * cameraUp.x) + Math.abs(size.y * cameraUp.y) + Math.abs(size.z * cameraUp.z)\n    const halfDepth = Math.abs(size.x * cameraForward.x) + Math.abs(size.y * cameraForward.y) + Math.abs(size.z * cameraForward.z)\n\n    if (camera instanceof PerspectiveCamera) {\n\n      const vfov = camera.fov * Math.PI / 180\n      const tanHalfVfov = Math.tan(vfov / 2)\n      const aspect = camera.aspect || 1\n\n      let distance = 0\n      for (let i = 0; i < 8; i++) {\n        corner.set(\n          (i & 1) ? box.max.x : box.min.x,\n          (i & 2) ? box.max.y : box.min.y,\n          (i & 4) ? box.max.z : box.min.z\n        ).sub(center)\n\n        const x = corner.dot(cameraRight)\n        const y = corner.dot(cameraUp)\n        const z = corner.dot(cameraForward)\n\n        const distV = Math.abs(y) / tanHalfVfov - z\n        const distH = Math.abs(x) / (tanHalfVfov * aspect) - z\n        distance = Math.max(distance, distV, distH)\n      }\n\n      delta.set(0, 0, 1)\n        .applyQuaternion(camera.quaternion)\n        .multiplyScalar(distance)\n      camera.position.copy(center).add(delta)\n\n      camera.near = halfDepth * 0.01\n      camera.far = distance + halfDepth * 20\n      camera.zoom = 1 / overscan\n      camera.updateProjectionMatrix()\n\n    } else if (camera instanceof OrthographicCamera) {\n\n      delta.set(0, 0, 1).applyQuaternion(camera.quaternion).multiplyScalar(radius)\n      camera.position.copy(center).add(delta)\n      camera.lookAt(center)\n\n      camera.left = -halfWidth\n      camera.right = halfWidth\n      camera.bottom = -halfHeight\n      camera.top = halfHeight\n\n      camera.zoom = 1 / overscan\n      camera.near = 0\n      camera.far = radius + halfDepth * 20\n\n      camera.updateProjectionMatrix()\n    }\n\n    this.orbitControls.target.copy( center )\n  }\n\n  setOverscan(width: number, height: number, overscan: number) {\n\n    const camera = this.camera\n    const resetCamera = resetCameras.get(camera) || camera.clone(false)\n    resetCamera.copy(camera, false)\n    resetCameras.set(camera, resetCamera)\n\n    const aspect = width / height\n    if (camera instanceof PerspectiveCamera) {\n      camera.aspect = aspect\n      camera.fov *= overscan\n    } else if (camera instanceof OrthographicCamera) {\n      const frustumHeight = camera.top - camera.bottom\n      const frustumWidth = camera.right - camera.left\n      const frustumAspect = frustumWidth / frustumHeight\n\n      if (frustumAspect > aspect) {\n        camera.top = frustumWidth / 2 / aspect\n        camera.bottom = -frustumWidth / 2 / aspect\n      } else {\n        camera.left = -frustumHeight / 2 * aspect\n        camera.right = frustumHeight / 2 * aspect\n      }\n\n      camera.top *= overscan\n      camera.bottom *= overscan\n      camera.left *= overscan\n      camera.right *= overscan\n    }\n    camera.updateProjectionMatrix()\n  }\n\n  resetOverscan() {\n    const camera = this.camera\n    const resetCamera = resetCameras.get(camera)\n    if (resetCamera) {\n      camera.copy(resetCamera, false)\n    }\n  }\n\n  dispose() {\n    this.orbitControls.dispose()\n    super.dispose()\n  }\n}","import { Register, IoElement, IoElementProps, ReactiveProperty, ReactivityType, Binding } from '@io-gui/core'\nimport { WebGPURenderer, CanvasTarget, Clock, NeutralToneMapping } from 'three/webgpu'\nimport WebGPU from 'three/addons/capabilities/WebGPU.js'\nimport { ThreeApplet } from '../nodes/ThreeApplet.js'\nimport { ViewCameras } from '../nodes/ViewCameras.js'\n\nif ( WebGPU.isAvailable() === false ) {\n  throw new Error( 'No WebGPU support' )\n}\n\nconst observer = new IntersectionObserver((entries) => {\n  entries.forEach(entry => {\n    (entry.target as IoThreeViewport).visible = entry.isIntersecting\n  })\n})\n\n// TODO: Add support for logarithmic depth buffer\n// TODO: Add support for unique renderer instances per viewport\nconst _renderer = new WebGPURenderer({antialias: false, alpha: true})\n_renderer.toneMapping = NeutralToneMapping\n_renderer.setPixelRatio(window.devicePixelRatio)\n_renderer.shadowMap.enabled = true\nvoid _renderer.init()\n\nconst _clock = new Clock()\n\nconst _playingViewports: IoThreeViewport[] = []\nlet _time = -1\nlet _delta = 0\n\nnew Promise((resolve, reject) => {\n  _renderer.setAnimationLoop((time: number) => {\n    _time = time\n    _delta = _clock.getDelta()\n    for (const viewport of _playingViewports) {\n      viewport.onAnimate()\n    }\n  }).then(resolve).catch(reject)\n}).then(() => {\n  console.log('animation loop initialized')\n}).catch(error => {\n  console.error('animation loop initialization failed', error)\n})\n\nexport type IoThreeViewportProps = IoElementProps & {\n  clearColor?: number | Binding\n  clearAlpha?: number | Binding\n  applet: ThreeApplet | Binding\n  playing?: boolean | Binding\n  cameraSelect?: string | Binding\n  renderer?: WebGPURenderer\n}\n\n@Register\nexport class IoThreeViewport extends IoElement {\n\n  public width: number = 0\n  public height: number = 0\n  public visible: boolean = false\n\n  @ReactiveProperty({type: Number, value: 0x000000})\n  declare public clearColor: number\n\n  @ReactiveProperty({type: Number, value: 1})\n  declare public clearAlpha: number\n\n  @ReactiveProperty({type: String, value: 'throttled'})\n  declare reactivity: ReactivityType\n\n  @ReactiveProperty({type: ThreeApplet, init: null})\n  declare applet: ThreeApplet\n\n  @ReactiveProperty({type: Boolean})\n  declare playing: boolean\n\n  @ReactiveProperty({type: String, value: 'perspective'})\n  declare cameraSelect: string\n\n  @ReactiveProperty({type: WebGPURenderer, value: _renderer})\n  declare renderer: WebGPURenderer\n\n  declare private readonly viewCameras: ViewCameras\n  declare private readonly renderTarget: CanvasTarget\n\n  static get Style() {\n    return /* css */`\n      :host {\n        position: relative;\n        display: flex;\n        flex: 1 1 auto;\n        flex-direction: column;\n        max-width: 100%;\n        max-height: 100%;\n        overflow: hidden;\n      }\n      :host > canvas {\n        position: absolute;\n      }\n    `\n  }\n\n  constructor(args: IoThreeViewportProps) {\n    super(args)\n\n    this.renderTarget = new CanvasTarget(document.createElement('canvas'))\n    this.appendChild(this.renderTarget.domElement)\n\n    this.viewCameras = new ViewCameras({viewport: this, applet: this.bind('applet'), cameraSelect: this.bind('cameraSelect')})\n\n    this.debounce(this.renderViewportDebounced)\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n    observer.observe(this)\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    observer.unobserve(this)\n    this.visible = false\n  }\n\n  playingChanged() {\n    if (this.playing) {\n      _playingViewports.push(this)\n    } else if (_playingViewports.includes(this)) {\n      _playingViewports.splice(_playingViewports.indexOf(this), 1)\n    }\n  }\n\n\n  onAnimate() {\n    if (!this.visible) return\n    this.debounce(this.renderViewportDebounced)\n  }\n\n  onResized() {\n    const rect = this.getBoundingClientRect()\n    this.width = Math.floor(rect.width)\n    this.height = Math.floor(rect.height)\n    this.renderTarget.setSize(this.width, this.height)\n    this.renderTarget.setPixelRatio(window.devicePixelRatio)\n    this.renderViewportDebounced()\n  }\n\n  appletChanged() {\n    this.debounce(this.renderViewportDebounced)\n  }\n  appletMutated() {\n    this.debounce(this.renderViewportDebounced)\n  }\n  changed() {\n    this.debounce(this.renderViewportDebounced)\n  }\n\n  renderViewportDebounced() {\n    if (this.renderer.initialized === false) {\n      this.debounce(this.renderViewportDebounced)\n      return\n    }\n    if (this.applet.isRendererInitialized() === false) {\n      void this.applet.onRendererInitialized(this.renderer)\n    }\n    if (!this.width || !this.height) {\n      return\n    }\n    this.renderer.setCanvasTarget(this.renderTarget)\n    this.renderer.setClearColor(this.clearColor, this.clearAlpha)\n    this.renderer.setSize(this.width, this.height)\n    this.renderer.clear()\n\n    this.applet.updateViewportSize(this.width, this.height)\n    this.applet.animate(_time, _delta)\n\n    const toneMapping = this.renderer.toneMapping\n    const toneMappingExposure = this.renderer.toneMappingExposure\n\n    this.renderer.toneMapping = this.applet.toneMapping\n    this.renderer.toneMappingExposure = this.applet.toneMappingExposure\n\n    this.viewCameras.setOverscan(this.width, this.height, 1.1)\n    this.renderer.render(this.applet.scene, this.viewCameras.camera)\n    this.viewCameras.resetOverscan()\n\n    this.renderer.toneMapping = toneMapping\n    this.renderer.toneMappingExposure = toneMappingExposure\n  }\n\n  dispose() {\n    this.renderTarget.dispose()\n    this.viewCameras.dispose()\n    if (this.renderer !== _renderer) {\n      this.renderer.dispose()\n    }\n    super.dispose()\n  }\n}\n\nexport const ioThreeViewport = function(arg0: IoThreeViewportProps) {\n  return IoThreeViewport.vConstructor(arg0)\n}"],"names":["IoBuildGeometry","IoElement","Style","constructor","args","super","buildGeometry","geometry","this","value","parameters","console","warn","newGeometry","GeometryClass","Object","values","copy","dispose","computeVertexNormals","computeTangents","computeBoundingSphere","computeBoundingBox","dispatchMutation","boundingBox","boundingSphere","changed","hasParameters","render","ioPropertyEditor","properties","labeled","ioButton","label","action","disabled","center","max","min","__decorateClass","ReactiveProperty","type","init","prototype","Register","ioBuildGeometry","arg0","vConstructor","ThreeApplet","ReactiveNode","_renderer","_width","_height","_prevTime","updateViewportSize","width","height","onResized","isRendererInitialized","initialized","onRendererInitialized","renderer","animate","time","delta","onAnimate","Scene","Number","NoToneMapping","Array","registerEditorConfig","ioNumberSlider","step","exponent","ioOptionSelect","option","MenuOption","options","id","LinearToneMapping","ReinhardToneMapping","CineonToneMapping","ACESFilmicToneMapping","AgXToneMapping","NeutralToneMapping","registerEditorGroups","Main","Hidden","box","Box3","sphere","Sphere","Vector3","size","cameraRight","cameraUp","cameraForward","corner","radius","resetCameras","WeakMap","ViewCameras","Listeners","orbitControls","connect","viewport","addEventListener","applet","camera","defaultCameras","perspective","cameraSelectChanged","debounce","cameraSelectChangedDebounced","matchedCamera","cameraSelect","startsWith","cameraId","split","cameras","scene","getObjectsByProperty","find","name","getCamera","cameraChanged","includes","enabled","object","enableRotate","isPerspectiveCamera","appletChanged","frameObjectAll","onFrameObject","event","detail","overscan","position","userData","lookAt","frameObject","error","setFromObject","isEmpty","getCenter","getBoundingSphere","setFromMatrixPosition","matrixWorld","set","applyQuaternion","quaternion","getSize","multiplyScalar","halfWidth","Math","abs","x","y","z","halfHeight","halfDepth","PerspectiveCamera","vfov","fov","PI","tanHalfVfov","tan","aspect","distance","i","sub","dot","distV","distH","add","near","far","zoom","updateProjectionMatrix","OrthographicCamera","left","right","bottom","top","target","setOverscan","resetCamera","get","clone","frustumHeight","frustumWidth","resetOverscan","Property","String","Camera","DefaultCameras","front","back","OrbitControls","WebGPU","isAvailable","Error","observer","IntersectionObserver","entries","forEach","entry","visible","isIntersecting","WebGPURenderer","antialias","alpha","toneMapping","setPixelRatio","window","devicePixelRatio","shadowMap","_clock","Clock","_playingViewports","_time","_delta","Promise","resolve","reject","setAnimationLoop","getDelta","then","catch","log","IoThreeViewport","renderTarget","CanvasTarget","document","createElement","appendChild","domElement","viewCameras","bind","renderViewportDebounced","connectedCallback","observe","disconnectedCallback","unobserve","playingChanged","playing","push","splice","indexOf","rect","getBoundingClientRect","floor","setSize","appletMutated","setCanvasTarget","setClearColor","clearColor","clearAlpha","clear","toneMappingExposure","Boolean","ioThreeViewport"],"mappings":"qkCAYO,IAAMA,gBAAN,cAA8BC,UAKnC,gBAAWC,GACT,MAAgB,yFAMlB,CAEA,WAAAC,CAAYC,KAA6B,IACvCC,MAAMD,KACR,CAEA,aAAAE,GACE,MAAMC,SAAWC,KAAKC,MACtB,IAAKF,SAAU,OAEf,MAAMG,WAAcH,SAAiBG,WACrC,IAAKA,WAIH,YAFEC,QAAQC,KAAK,wDAKjB,MAGMC,YAAc,IAAIC,EAHFP,SAASJ,gBACPY,OAAOC,OAAON,aAGtCH,SAASU,KAAKJ,aACdA,YAAYK,UAEZX,SAASY,uBACTZ,SAASa,kBACTb,SAASc,wBACTd,SAASe,qBAETd,KAAKe,iBAAiBhB,UACtBC,KAAKe,iBAAiBhB,SAASiB,aAC/BhB,KAAKe,iBAAiBhB,SAASkB,eACjC,CAEA,OAAAC,GACE,MAAMC,cAAgBnB,KAAKC,OAAUD,KAAKC,MAAcC,WACxDF,KAAKoB,OAAO,CACVC,iBAAiB,CACfpB,MAAOD,KAAKC,MACZqB,WAAY,CAAC,cACbC,SAAS,IAEXC,SAAS,CACPC,MAAO,iBACPC,OAAQ,IAAM1B,KAAKF,gBACnB6B,UAAWR,gBAEbK,SAAS,CACPC,MAAO,yBACPC,OAAQ,KACN1B,KAAKC,OAAOU,0BAGhBa,SAAS,CACPC,MAAO,mBACPC,OAAQ,KACN1B,KAAKC,OAAOW,qBAGhBY,SAAS,CACPC,MAAO,0BACPC,OAAQ,KACN1B,KAAKC,OAAOY,wBACZb,KAAKe,iBAAiBf,KAAKC,MAAOgB,gBAClCjB,KAAKe,iBAAiBf,KAAKC,MAAOgB,eAAgBW,WAGtDJ,SAAS,CACPC,MAAO,uBACPC,OAAQ,KACN1B,KAAKC,OAAOa,qBACZd,KAAKe,iBAAiBf,KAAKC,MAAOe,YAAaa,KAC/C7B,KAAKe,iBAAiBf,KAAKC,MAAOe,YAAac,SAIvD,GAtFQC,kBAAA,CADPC,iBAAiB,CAACC,KAAM1B,OAAQ2B,KAAM,QAF5B1C,gBAGH2C,UAAA,QAAA,GAHG3C,gBAANuC,kBAAA,CADNK,UACY5C,iBA4FN,MAAM6C,gBAAkB,SAASC,MACtC,OAAO9C,gBAAgB+C,aAAaD,KACtC,2ZC5FO,IAAME,YAAN,cAA0BC,aAkBvBC,UAAmC,KACnCC,OAAiB,EACjBC,QAAkB,EAClBC,WAAoB,EAE5B,WAAAlD,CAAYC,MACVC,MAAMD,KACR,CACA,kBAAAkD,CAAmBC,MAAeC,QAC5BhD,KAAK2C,SAAWI,OAAS/C,KAAK4C,UAAYI,QACtCD,OAAWC,SACfhD,KAAK2C,OAASI,MACd/C,KAAK4C,QAAUI,OACfhD,KAAKiD,UAAUF,MAAOC,QAI5B,CACA,qBAAAE,GACE,QAASlD,KAAK0C,YAA4C,IAA/B1C,KAAK0C,UAAUS,WAC5C,CACA,qBAAAC,CAAsBC,UACpBrD,KAAK0C,UAAYW,QACnB,CAEA,SAAAJ,CAAUF,MAAeC,QAAiB,CAE1C,OAAAM,CAAQC,KAAcC,OAChBxD,KAAK6C,YAAcU,OACvBvD,KAAK6C,UAAYU,KACjBvD,KAAKyD,UAAUD,OACjB,CAEA,SAAAC,CAAUD,OAAgB,GAhDlBzB,kBAAA,CADPC,iBAAiB,CAACC,KAAMyB,MAAOxB,KAAM,QAF3BM,YAGHL,UAAA,QAAA,GAGAJ,kBAAA,CADPC,iBAAiB,CAACC,KAAM0B,OAAQ1D,MAAO,KAL7BuC,YAMHL,UAAA,sBAAA,GAGAJ,kBAAA,CADPC,iBAAiB,CAACC,KAAM0B,OAAQ1D,MAAO2D,iBAR7BpB,YASHL,UAAA,cAAA,GAIAJ,kBAAA,CADPC,iBAAiB,CAACC,KAAM4B,MAAO3B,KAAM,QAZ3BM,YAaHL,UAAA,WAAA,GAGAJ,kBAAA,CADPC,iBAAiB,CAACC,KAAM1B,OAAQ2B,KAAM,QAf5BM,YAgBHL,UAAA,WAAA,GAhBGK,YAANT,kBAAA,CADNK,UACYI,aAsDbsB,qBAAqBtB,YAAa,CAChC,CAAC,sBAAuBuB,eAAe,CAACjC,IAAK,EAAGD,IAAK,EAAGmC,KAAM,IAAMC,SAAU,KAC9E,CAAC,cAAeC,eAAe,CAACC,OAAQ,IAAIC,WAAW,CAACC,QAAS,CAC/D,CAACpE,MAAO2D,cAAeU,GAAI,iBAC3B,CAACrE,MAAOsE,kBAAmBD,GAAI,qBAC/B,CAACrE,MAAOuE,oBAAqBF,GAAI,uBACjC,CAACrE,MAAOwE,kBAAmBH,GAAI,qBAC/B,CAACrE,MAAOyE,sBAAuBJ,GAAI,yBAEnC,CAACrE,MAAO0E,eAAgBL,GAAI,kBAC5B,CAACrE,MAAO2E,mBAAoBN,GAAI,4BAElC,CAAC,QAASjD,iBAAiB,CAACC,WAAY,CAAC,YAAaG,MAAO,gBAG/DoD,qBAAqBrC,YAAa,CAChCsC,KAAM,CACJ,SAEFC,OAAQ,CACN,cACA,sBACA,WACA,WACA,YACA,SACA,UACA,waCzFJ,MAAMC,IAAM,IAAIC,KACVC,OAAS,IAAIC,OACbvD,OAAS,IAAIwD,QACbC,KAAO,IAAID,QACX5B,MAAQ,IAAI4B,QACZE,YAAc,IAAIF,QAClBG,SAAW,IAAIH,QACfI,cAAgB,IAAIJ,QACpBK,OAAS,IAAIL,QACnB,IAAIM,OAAS,EAEb,MAAMC,gCAAmBC,QAuElB,IAAMC,YAAN,cAA0BpD,aAoB/B,oBAAWqD,GACT,MAAO,CACL,eAAgB,gBAEpB,CAEA,WAAAnG,CAAYC,MACVC,MAAMD,MAENI,KAAK+F,cAAcC,QAAQhG,KAAKiG,UAChCjG,KAAK+F,cAAcG,iBAAiB,SAAU,KAC5ClG,KAAKmG,OAAOpF,0BAGM,IAAhBf,KAAKoG,SAAsBpG,KAAKoG,OAASpG,KAAKqG,eAAeC,YACnE,CAEA,mBAAAC,GACEvG,KAAKwG,SAASxG,KAAKyG,6BACrB,CAEA,4BAAAA,GACE,IAAIC,cACJ,GAAI1G,KAAK2G,aAAaC,WAAW,SAAU,CACzC,MAAMC,SAAW7G,KAAK2G,aAAaG,MAAM,KAAK,IAAM,GAG9CC,QAAU,IAFF/G,KAAKmG,OAAOa,MAAMC,qBAAqB,uBAAuB,MAC9DjH,KAAKmG,OAAOa,MAAMC,qBAAqB,wBAAwB,IAGzEJ,UACFH,cAAgBK,QAAQG,KAAKd,QAAUA,OAAOe,OAASN,UAClDH,eACHvG,QAAQC,KAAK,UAAUyG,uEAGzBH,cAAgBK,QAAQ,GACnBL,eACHvG,QAAQC,KAAK,oEAIfJ,KAAKoG,OADHM,eAGY1G,KAAKqG,eAAeC,WAEtC,MACEI,cAAgB1G,KAAKqG,eAAee,UAAUpH,KAAK2G,cAC/CD,cACF1G,KAAKoG,OAASM,eAEdvG,QAAQC,KAAK,UAAUJ,KAAK2G,mFAC5B3G,KAAKoG,OAASpG,KAAKqG,eAAeC,YAGxC,CAEA,aAAAe,GAIOrH,KAAKqG,eAAeU,QAAQO,SAAStH,KAAKoG,SAG7CpG,KAAK+F,cAAcwB,SAAU,EAC7BvH,KAAK+F,cAAcyB,OAASxH,KAAKoG,OACjCpG,KAAK+F,cAAc0B,eAAkBzH,KAAKoG,OAA6BsB,qBAJvE1H,KAAK+F,cAAcwB,SAAU,CAMjC,CAEA,aAAAI,GACE3H,KAAK4H,eAAe5H,KAAKmG,OAAOa,MAClC,CAEA,aAAAa,CAAcC,OACZ9H,KAAK4H,eAAeE,MAAMC,OAAOP,OAAQM,MAAMC,OAAOC,SACxD,CAEA,cAAAJ,CAAeJ,OAAkBQ,SAAmB,GAEhD,QAAe,IAAXR,OAAJ,CAKF,IAAA,MAAWpB,UAAUpG,KAAKqG,eAAeU,QACvCX,OAAO6B,SAASxH,KAAK2F,OAAO8B,SAASD,UACrC7B,OAAO+B,OAAO,EAAG,EAAG,GACpBnI,KAAKoI,YAAYZ,OAAQpB,OAAQ4B,UAGnChI,KAAKwG,SAASxG,KAAKyG,6BARjB,MAFEtG,QAAQkI,MAAM,mCAWpB,CAEA,WAAAD,CAAYZ,OAAkBpB,OAAgB4B,SAAmB,GAE/DhD,IAAIsD,cAAed,SAEI,IAAlBxC,IAAIuD,WACPvD,IAAIwD,UAAW5G,QACf8D,OAASV,IAAIyD,kBAAmBvD,QAASQ,SAIzC9D,OAAO8G,sBAAuBtC,OAAOuC,aACrCjD,OAAS,IAIXJ,YAAYsD,IAAI,EAAG,EAAG,GAAGC,gBAAgBzC,OAAO0C,YAChDvD,SAASqD,IAAI,EAAG,EAAG,GAAGC,gBAAgBzC,OAAO0C,YAC7CtD,cAAcoD,IAAI,EAAG,GAAG,GAAIC,gBAAgBzC,OAAO0C,YAEnD9D,IAAI+D,QAAQ1D,MAAM2D,eAAe,IAEjC,MAAMC,UAAYC,KAAKC,IAAI9D,KAAK+D,EAAI9D,YAAY8D,GAAKF,KAAKC,IAAI9D,KAAKgE,EAAI/D,YAAY+D,GAAKH,KAAKC,IAAI9D,KAAKiE,EAAIhE,YAAYgE,GAChHC,WAAaL,KAAKC,IAAI9D,KAAK+D,EAAI7D,SAAS6D,GAAKF,KAAKC,IAAI9D,KAAKgE,EAAI9D,SAAS8D,GAAKH,KAAKC,IAAI9D,KAAKiE,EAAI/D,SAAS+D,GACxGE,UAAYN,KAAKC,IAAI9D,KAAK+D,EAAI5D,cAAc4D,GAAKF,KAAKC,IAAI9D,KAAKgE,EAAI7D,cAAc6D,GAAKH,KAAKC,IAAI9D,KAAKiE,EAAI9D,cAAc8D,GAE5H,GAAIlD,kBAAkBqD,kBAAmB,CAEvC,MAAMC,KAAOtD,OAAOuD,IAAMT,KAAKU,GAAK,IAC9BC,YAAcX,KAAKY,IAAIJ,KAAO,GAC9BK,OAAS3D,OAAO2D,QAAU,EAEhC,IAAIC,SAAW,EACf,IAAA,IAASC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1BxE,OAAOmD,IACA,EAAJqB,EAASjF,IAAInD,IAAIuH,EAAIpE,IAAIlD,IAAIsH,EACzB,EAAJa,EAASjF,IAAInD,IAAIwH,EAAIrE,IAAIlD,IAAIuH,EACzB,EAAJY,EAASjF,IAAInD,IAAIyH,EAAItE,IAAIlD,IAAIwH,GAC9BY,IAAItI,QAEN,MAAMwH,EAAI3D,OAAO0E,IAAI7E,aACf+D,EAAI5D,OAAO0E,IAAI5E,UACf+D,EAAI7D,OAAO0E,IAAI3E,eAEf4E,MAAQlB,KAAKC,IAAIE,GAAKQ,YAAcP,EACpCe,MAAQnB,KAAKC,IAAIC,IAAMS,YAAcE,QAAUT,EACrDU,SAAWd,KAAKrH,IAAImI,SAAUI,MAAOC,MACvC,CAEA7G,MAAMoF,IAAI,EAAG,EAAG,GACbC,gBAAgBzC,OAAO0C,YACvBE,eAAegB,UAClB5D,OAAO6B,SAASxH,KAAKmB,QAAQ0I,IAAI9G,OAEjC4C,OAAOmE,KAAmB,IAAZf,UACdpD,OAAOoE,IAAMR,SAAuB,GAAZR,UACxBpD,OAAOqE,KAAO,EAAIzC,SAClB5B,OAAOsE,wBAET,MAAWtE,kBAAkBuE,qBAE3BnH,MAAMoF,IAAI,EAAG,EAAG,GAAGC,gBAAgBzC,OAAO0C,YAAYE,eAAetD,QACrEU,OAAO6B,SAASxH,KAAKmB,QAAQ0I,IAAI9G,OACjC4C,OAAO+B,OAAOvG,QAEdwE,OAAOwE,MAAQ3B,UACf7C,OAAOyE,MAAQ5B,UACf7C,OAAO0E,QAAUvB,WACjBnD,OAAO2E,IAAMxB,WAEbnD,OAAOqE,KAAO,EAAIzC,SAClB5B,OAAOmE,KAAO,EACdnE,OAAOoE,IAAM9E,OAAqB,GAAZ8D,UAEtBpD,OAAOsE,0BAGT1K,KAAK+F,cAAciF,OAAOvK,KAAMmB,OAClC,CAEA,WAAAqJ,CAAYlI,MAAeC,OAAgBgF,UAEzC,MAAM5B,OAASpG,KAAKoG,OACd8E,YAAcvF,aAAawF,IAAI/E,SAAWA,OAAOgF,OAAM,GAC7DF,YAAYzK,KAAK2F,QAAQ,GACzBT,aAAaiD,IAAIxC,OAAQ8E,aAEzB,MAAMnB,OAAShH,MAAQC,OACvB,GAAIoD,kBAAkBqD,kBACpBrD,OAAO2D,OAASA,OAChB3D,OAAOuD,KAAO3B,cAChB,GAAW5B,kBAAkBuE,mBAAoB,CAC/C,MAAMU,cAAgBjF,OAAO2E,IAAM3E,OAAO0E,OACpCQ,aAAelF,OAAOyE,MAAQzE,OAAOwE,KACrBU,aAAeD,cAEjBtB,QAClB3D,OAAO2E,IAAMO,aAAe,EAAIvB,OAChC3D,OAAO0E,QAAUQ,aAAe,EAAIvB,SAEpC3D,OAAOwE,MAAQS,cAAgB,EAAItB,OACnC3D,OAAOyE,MAAQQ,cAAgB,EAAItB,QAGrC3D,OAAO2E,KAAO/C,SACd5B,OAAO0E,QAAU9C,SACjB5B,OAAOwE,MAAQ5C,SACf5B,OAAOyE,OAAS7C,QAClB,CACA5B,OAAOsE,wBACT,CAEA,aAAAa,GACE,MAAMnF,OAASpG,KAAKoG,OACd8E,YAAcvF,aAAawF,IAAI/E,QACjC8E,aACF9E,OAAO3F,KAAKyK,aAAa,EAE7B,CAEA,OAAAxK,GACEV,KAAK+F,cAAcrF,UACnBb,MAAMa,SACR,GAxOgBqB,kBAAA,CADfyJ,YAFU3F,YAGK1D,UAAA,WAAA,GAGDJ,kBAAA,CADdC,iBAAiB,CAACC,KAAMO,eALdqD,YAMI1D,UAAA,SAAA,GAGAJ,kBAAA,CADdC,iBAAiB,CAACC,KAAMwJ,OAAQxL,MAAO,iBAR7B4F,YASI1D,UAAA,eAAA,GAGAJ,kBAAA,CADdC,iBAAiB,CAACC,KAAMyJ,UAXd7F,YAYI1D,UAAA,SAAA,GAGUJ,kBAAA,CADxBC,iBAAiB,CAACC,KAnFrB,MAAM0J,eACGrF,YACAyE,IACAD,OACAF,KACAC,MACAe,MACAC,KACP,WAAAlM,GACEK,KAAKsG,YAAc,IAAImD,kBAAkB,GAAI,EAAG,GAAK,KACrDzJ,KAAK+K,IAAM,IAAIJ,oBAAmB,EAAI,EAAG,GAAG,EAAI,EAAG,KACnD3K,KAAK8K,OAAS,IAAIH,oBAAmB,EAAI,EAAG,GAAG,EAAI,EAAG,KACtD3K,KAAK4K,KAAO,IAAID,oBAAmB,EAAI,EAAG,GAAG,EAAI,EAAG,KACpD3K,KAAK6K,MAAQ,IAAIF,oBAAmB,EAAI,EAAG,GAAG,EAAI,EAAG,KACrD3K,KAAK4L,MAAQ,IAAIjB,oBAAmB,EAAI,EAAG,GAAG,EAAI,EAAG,KACrD3K,KAAK6L,KAAO,IAAIlB,oBAAmB,EAAI,EAAG,GAAG,EAAI,EAAG,KAEpD3K,KAAKsG,YAAY4B,SAASD,SAAW,IAAI7C,QAAQ,GAAK,IAAM,GAC5DpF,KAAKsG,YAAY2B,SAASxH,KAAKT,KAAKsG,YAAY4B,SAASD,UACzDjI,KAAKsG,YAAY6B,OAAO,EAAG,EAAG,GAC9BnI,KAAKsG,YAAYa,KAAO,cAExBnH,KAAK+K,IAAI7C,SAASD,SAAW,IAAI7C,QAAQ,EAAG,EAAG,GAC/CpF,KAAK+K,IAAI9C,SAASxH,KAAKT,KAAK+K,IAAI7C,SAASD,UACzCjI,KAAK+K,IAAI5C,OAAO,EAAG,EAAG,GACtBnI,KAAK+K,IAAI5D,KAAO,MAEhBnH,KAAK8K,OAAO5C,SAASD,SAAW,IAAI7C,QAAQ,GAAG,EAAI,GACnDpF,KAAK8K,OAAO7C,SAASxH,KAAKT,KAAK8K,OAAO5C,SAASD,UAC/CjI,KAAK8K,OAAO3C,OAAO,EAAG,EAAG,GACzBnI,KAAK8K,OAAO3D,KAAO,SAEnBnH,KAAK4K,KAAK1C,SAASD,SAAW,IAAI7C,SAAQ,EAAI,EAAG,GACjDpF,KAAK4K,KAAK3C,SAASxH,KAAKT,KAAK4K,KAAK1C,SAASD,UAC3CjI,KAAK4K,KAAKzC,OAAO,EAAG,EAAG,GACvBnI,KAAK4K,KAAKzD,KAAO,OAEjBnH,KAAK6K,MAAM3C,SAASD,SAAW,IAAI7C,QAAQ,EAAG,EAAG,GACjDpF,KAAK6K,MAAM5C,SAASxH,KAAKT,KAAK6K,MAAM3C,SAASD,UAC7CjI,KAAK6K,MAAM1C,OAAO,EAAG,EAAG,GACxBnI,KAAK6K,MAAM1D,KAAO,QAElBnH,KAAK4L,MAAM1D,SAASD,SAAW,IAAI7C,QAAQ,EAAG,EAAG,GACjDpF,KAAK4L,MAAM3D,SAASxH,KAAKT,KAAK4L,MAAM1D,SAASD,UAC7CjI,KAAK4L,MAAMzD,OAAO,EAAG,EAAG,GACxBnI,KAAK4L,MAAMzE,KAAO,QAElBnH,KAAK6L,KAAK3D,SAASD,SAAW,IAAI7C,QAAQ,EAAG,MAC7CpF,KAAK6L,KAAK5D,SAASxH,KAAKT,KAAK6L,KAAK3D,SAASD,UAC3CjI,KAAK6L,KAAK1D,OAAO,EAAG,EAAG,GACvBnI,KAAK6L,KAAK1E,KAAO,MACnB,CACA,WAAIJ,GACF,MAAO,CAAC/G,KAAKsG,YAAatG,KAAK+K,IAAK/K,KAAK8K,OAAQ9K,KAAK4K,KAAM5K,KAAK6K,MAAO7K,KAAK4L,MAAO5L,KAAK6L,KAC3F,CACA,SAAAzE,CAAUD,MACR,OAAOnH,KAAK+G,QAAQG,KAAKd,QAAUA,OAAOe,OAASA,KACrD,GA0ByCjF,KAAM,QAdpC2D,YAec1D,UAAA,iBAAA,GAGAJ,kBAAA,CADxBC,iBAAiB,CAACC,KAAM6J,cAAe5J,KAAM,CAAC,sCAjBpC2D,YAkBc1D,UAAA,gBAAA,GAlBd0D,YAAN9D,kBAAA,CADNK,UACYyD,4ZClFb,IAA8B,IAAzBkG,OAAOC,cACV,MAAM,IAAIC,MAAO,qBAGnB,MAAMC,SAAW,IAAIC,qBAAsBC,UACzCA,QAAQC,QAAQC,QACbA,MAAMtB,OAA2BuB,QAAUD,MAAME,mBAMhD9J,UAAY,IAAI+J,eAAe,CAACC,WAAW,EAAOC,OAAO,IAC/DjK,UAAUkK,YAAchI,mBACxBlC,UAAUmK,cAAcC,OAAOC,kBAC/BrK,UAAUsK,UAAUzF,SAAU,EACzB7E,UAAUR,OAEf,MAAM+K,OAAS,IAAIC,MAEbC,kBAAuC,GAC7C,IAAIC,OAAQ,EACRC,OAAS,EAEb,IAAIC,QAAQ,CAACC,QAASC,UACpB9K,UAAU+K,iBAAkBlK,OAC1B6J,MAAQ7J,KACR8J,OAASJ,OAAOS,WAChB,IAAA,MAAWzH,YAAYkH,kBACrBlH,SAASxC,cAEVkK,KAAKJ,SAASK,MAAMJ,UACtBG,KAAK,KACNxN,QAAQ0N,IAAI,gCACXD,MAAMvF,QACPlI,QAAQkI,MAAM,uCAAwCA,SAajD,IAAMyF,gBAAN,cAA8BrO,UAE5BsD,MAAgB,EAChBC,OAAiB,EACjBuJ,SAAmB,EA0B1B,gBAAW7M,GACT,MAAgB,6RAclB,CAEA,WAAAC,CAAYC,MACVC,MAAMD,MAENI,KAAK+N,aAAe,IAAIC,aAAaC,SAASC,cAAc,WAC5DlO,KAAKmO,YAAYnO,KAAK+N,aAAaK,YAEnCpO,KAAKqO,YAAc,IAAIxI,YAAY,CAACI,SAAUjG,KAAMmG,OAAQnG,KAAKsO,KAAK,UAAW3H,aAAc3G,KAAKsO,KAAK,kBAEzGtO,KAAKwG,SAASxG,KAAKuO,wBACrB,CAEA,iBAAAC,GACE3O,MAAM2O,oBACNtC,SAASuC,QAAQzO,KACnB,CACA,oBAAA0O,GACE7O,MAAM6O,uBACNxC,SAASyC,UAAU3O,MACnBA,KAAKuM,SAAU,CACjB,CAEA,cAAAqC,GACM5O,KAAK6O,QACP1B,kBAAkB2B,KAAK9O,MACdmN,kBAAkB7F,SAAStH,OACpCmN,kBAAkB4B,OAAO5B,kBAAkB6B,QAAQhP,MAAO,EAE9D,CAGA,SAAAyD,GACOzD,KAAKuM,SACVvM,KAAKwG,SAASxG,KAAKuO,wBACrB,CAEA,SAAAtL,GACE,MAAMgM,KAAOjP,KAAKkP,wBAClBlP,KAAK+C,MAAQmG,KAAKiG,MAAMF,KAAKlM,OAC7B/C,KAAKgD,OAASkG,KAAKiG,MAAMF,KAAKjM,QAC9BhD,KAAK+N,aAAaqB,QAAQpP,KAAK+C,MAAO/C,KAAKgD,QAC3ChD,KAAK+N,aAAalB,cAAcC,OAAOC,kBACvC/M,KAAKuO,yBACP,CAEA,aAAA5G,GACE3H,KAAKwG,SAASxG,KAAKuO,wBACrB,CACA,aAAAc,GACErP,KAAKwG,SAASxG,KAAKuO,wBACrB,CACA,OAAArN,GACElB,KAAKwG,SAASxG,KAAKuO,wBACrB,CAEA,uBAAAA,GACE,IAAkC,IAA9BvO,KAAKqD,SAASF,YAEhB,YADAnD,KAAKwG,SAASxG,KAAKuO,yBAMrB,IAH4C,IAAxCvO,KAAKmG,OAAOjD,yBACTlD,KAAKmG,OAAO/C,sBAAsBpD,KAAKqD,WAEzCrD,KAAK+C,QAAU/C,KAAKgD,OACvB,OAEFhD,KAAKqD,SAASiM,gBAAgBtP,KAAK+N,cACnC/N,KAAKqD,SAASkM,cAAcvP,KAAKwP,WAAYxP,KAAKyP,YAClDzP,KAAKqD,SAAS+L,QAAQpP,KAAK+C,MAAO/C,KAAKgD,QACvChD,KAAKqD,SAASqM,QAEd1P,KAAKmG,OAAOrD,mBAAmB9C,KAAK+C,MAAO/C,KAAKgD,QAChDhD,KAAKmG,OAAO7C,QAAQ8J,MAAOC,QAE3B,MAAMT,YAAc5M,KAAKqD,SAASuJ,YAC5B+C,oBAAsB3P,KAAKqD,SAASsM,oBAE1C3P,KAAKqD,SAASuJ,YAAc5M,KAAKmG,OAAOyG,YACxC5M,KAAKqD,SAASsM,oBAAsB3P,KAAKmG,OAAOwJ,oBAEhD3P,KAAKqO,YAAYpD,YAAYjL,KAAK+C,MAAO/C,KAAKgD,OAAQ,KACtDhD,KAAKqD,SAASjC,OAAOpB,KAAKmG,OAAOa,MAAOhH,KAAKqO,YAAYjI,QACzDpG,KAAKqO,YAAY9C,gBAEjBvL,KAAKqD,SAASuJ,YAAcA,YAC5B5M,KAAKqD,SAASsM,oBAAsBA,mBACtC,CAEA,OAAAjP,GACEV,KAAK+N,aAAarN,UAClBV,KAAKqO,YAAY3N,UACbV,KAAKqD,WAAaX,WACpB1C,KAAKqD,SAAS3C,UAEhBb,MAAMa,SACR,GAtIeqB,gBAAA,CADdC,iBAAiB,CAACC,KAAM0B,OAAQ1D,MAAO,KAN7B6N,gBAOI3L,UAAA,aAAA,GAGAJ,gBAAA,CADdC,iBAAiB,CAACC,KAAM0B,OAAQ1D,MAAO,KAT7B6N,gBAUI3L,UAAA,aAAA,GAGPJ,gBAAA,CADPC,iBAAiB,CAACC,KAAMwJ,OAAQxL,MAAO,eAZ7B6N,gBAaH3L,UAAA,aAAA,GAGAJ,gBAAA,CADPC,iBAAiB,CAACC,KAAMO,YAAaN,KAAM,QAfjC4L,gBAgBH3L,UAAA,SAAA,GAGAJ,gBAAA,CADPC,iBAAiB,CAACC,KAAM2N,WAlBd9B,gBAmBH3L,UAAA,UAAA,GAGAJ,gBAAA,CADPC,iBAAiB,CAACC,KAAMwJ,OAAQxL,MAAO,iBArB7B6N,gBAsBH3L,UAAA,eAAA,GAGAJ,gBAAA,CADPC,iBAAiB,CAACC,KAAMwK,eAAgBxM,MAAOyC,aAxBrCoL,gBAyBH3L,UAAA,WAAA,GAzBG2L,gBAAN/L,gBAAA,CADNK,UACY0L,iBAgJN,MAAM+B,gBAAkB,SAASvN,MACtC,OAAOwL,gBAAgBvL,aAAaD,KACtC"}