{"version":3,"file":"ThreeApplet.js","sourceRoot":"","sources":["../../src/nodes/ThreeApplet.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, ReactiveNode, ReactiveProperty, ReactiveNodeProps } from '@io-gui/core'\nimport { ioNumberSlider } from '@io-gui/sliders'\nimport { ioPropertyEditor, registerEditorConfig, registerEditorGroups } from '@io-gui/editors'\nimport { ACESFilmicToneMapping, AgXToneMapping, CineonToneMapping, Clock, LinearToneMapping, NeutralToneMapping, NoToneMapping, ReinhardToneMapping, Scene, ToneMapping, WebGPURenderer } from 'three/webgpu'\nimport { ioOptionSelect, MenuOption } from '@io-gui/menus'\n\nexport type ThreeAppletProps = ReactiveNodeProps & {\n  scene?: Scene\n  toneMappingExposure?: number\n  toneMapping?: ToneMapping\n  playing?: boolean\n}\n\nconst _playingApplets: ThreeApplet[] = []\nfunction rAFLoop() {\n  for (const applet of _playingApplets) {\n    applet.onRAF()\n  }\n  requestAnimationFrame(rAFLoop)\n}\nrAFLoop()\n\n@Register\nexport class ThreeApplet extends ReactiveNode {\n\n  @ReactiveProperty({type: Scene, init: null})\n  declare scene: Scene\n\n  @ReactiveProperty({type: Number, value: 1})\n  declare toneMappingExposure: number\n\n  @ReactiveProperty({type: Number, value: NoToneMapping})\n  declare toneMapping: ToneMapping\n\n  @ReactiveProperty({type: Boolean, value: false})\n  declare playing: boolean\n\n  private _renderer: WebGPURenderer | null = null\n  private _width: number = 0\n  private _height: number = 0\n\n  private readonly _clock: Clock = new Clock()\n\n  constructor(args?: ThreeAppletProps) {\n    super(args)\n    this.playingChanged()\n  }\n\n  playingChanged() {\n    if (this.playing === true && _playingApplets.includes(this) === false) {\n      _playingApplets.push(this)\n    } else if (this.playing === false && _playingApplets.includes(this)) {\n      _playingApplets.splice(_playingApplets.indexOf(this), 1)\n    }\n  }\n\n  onRAF() {\n    if (!this.playing) return\n    const delta = this._clock.getDelta()\n    const time = this._clock.getElapsedTime()\n    this.onAnimate(delta, time)\n    this.dispatch('io-three-animate', {time, delta}, true)\n  }\n\n  updateViewportSize(width: number, height: number) {\n    if (this._width !== width || this._height !== height) {\n      if (!!width && !!height) {\n        this._width = width\n        this._height = height\n        this.onResized(width, height)\n      }\n    }\n  }\n\n  isRendererInitialized() {\n    return !!this._renderer && this._renderer.initialized === true\n  }\n\n  onRendererInitialized(renderer: WebGPURenderer) {\n    this._renderer = renderer\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onResized(width: number, height: number) {}\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onAnimate(delta?: number, time?: number) {}\n\n  dispose() {\n    this.playing = false\n    super.dispose()\n  }\n}\n\nregisterEditorConfig(ThreeApplet, [\n  ['toneMappingExposure', ioNumberSlider({min: 0, max: 3, step: 0.01, exponent: 2})],\n  ['toneMapping', ioOptionSelect({option: new MenuOption({options: [\n    {value: NoToneMapping, id: 'NoToneMapping'},\n    {value: LinearToneMapping, id: 'LinearToneMapping'},\n    {value: ReinhardToneMapping, id: 'ReinhardToneMapping'},\n    {value: CineonToneMapping, id: 'CineonToneMapping'},\n    {value: ACESFilmicToneMapping, id: 'ACESFilmicToneMapping'},\n    // {value: CustomToneMapping, id: 'CustomToneMapping'},\n    {value: AgXToneMapping, id: 'AgXToneMapping'},\n    {value: NeutralToneMapping, id: 'NeutralToneMapping'},\n  ]})})],\n  ['scene', ioPropertyEditor({properties: ['children'], label: '_hidden_'})],\n])\n\nregisterEditorGroups(ThreeApplet, {\n  Main: [\n    'scene',\n  ],\n  Hidden: [\n    'playing',\n    'toneMapping',\n    'toneMappingExposure',\n    '_renderer',\n    '_width',\n    '_height',\n    '_prevTime',\n    '_rafId',\n    '_clock',\n  ],\n})"]}