{"version":3,"file":"ToolBase.js","sourceRoot":"","sources":["../../src/nodes/ToolBase.ts"],"names":[],"mappings":"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","sourcesContent":["import { ReactiveNode, ReactiveNodeProps, Register } from '@io-gui/core'\nimport { IoThreeViewport, Pointer3D } from '../elements/IoThreeViewport'\n\nexport type ToolBaseProps = ReactiveNodeProps & {\n\n}\n\n@Register\nexport class ToolBase extends ReactiveNode {\n\n  private readonly viewports: IoThreeViewport[] = []\n\n  constructor(args: ToolBaseProps) {\n    super(args)\n  }\n\n  registerViewport(viewport: IoThreeViewport) {\n    this.viewports.push(viewport)\n    viewport.addEventListener('pointerdown', this._onPointerDown)\n    viewport.addEventListener('pointermove', this._onPointerMove)\n    viewport.addEventListener('pointerup', this._onPointerUp)\n    viewport.addEventListener('pointercancel', this._onPointerCancel)\n  }\n\n  unregisterViewport(viewport: IoThreeViewport) {\n    this.viewports.splice(this.viewports.indexOf(viewport), 1)\n    viewport.removeEventListener('pointerdown', this._onPointerDown)\n    viewport.removeEventListener('pointermove', this._onPointerMove)\n    viewport.removeEventListener('pointerup', this._onPointerUp)\n    viewport.removeEventListener('pointercancel', this._onPointerCancel)\n  }\n\n  private _activePointers: Pointer3D[] = []\n\n  _onPointerDown(event: PointerEvent) {\n    event.stopPropagation()\n    event.preventDefault()\n    const viewport = event.target as IoThreeViewport\n    viewport.setPointerCapture(event.pointerId)\n    const pointer3D = viewport.pointerTo3D(event)\n    this._activePointers.push(pointer3D)\n    this.on3DPointerDown([...this._activePointers])\n  }\n  _onPointerMove(event: PointerEvent) {\n    event.stopPropagation()\n    event.preventDefault()\n    const index = this._activePointers.findIndex(p => p.event.pointerId === event.pointerId)\n    if (index === -1) return\n    const viewport = event.target as IoThreeViewport\n    const pointer3D = viewport.pointerTo3D(event)\n    this._activePointers[index] = pointer3D\n    this.on3DPointerMove([...this._activePointers])\n  }\n  _onPointerUp(event: PointerEvent) {\n    event.stopPropagation()\n    event.preventDefault()\n    const index = this._activePointers.findIndex(p => p.event.pointerId === event.pointerId)\n    if (index === -1) return\n    this._activePointers.splice(index, 1)\n    this.on3DPointerUp([...this._activePointers])\n  }\n  _onPointerCancel(event: PointerEvent) {\n    event.stopPropagation()\n    event.preventDefault()\n    const index = this._activePointers.findIndex(p => p.event.pointerId === event.pointerId)\n    if (index === -1) return\n    this._activePointers.splice(index, 1)\n    this.on3DPointerCancel([...this._activePointers])\n  }\n\n  on3DPointerDown(pointers: Pointer3D[]) {\n    console.log('on3DPointerDown', pointers)\n  }\n  on3DPointerMove(pointers: Pointer3D[]) {\n    console.log('on3DPointerMove', pointers)\n  }\n  on3DPointerUp(pointers: Pointer3D[]) {\n    console.log('on3DPointerUp', pointers)\n  }\n  on3DPointerCancel(pointers: Pointer3D[]) {\n    console.log('on3DPointerCancel', pointers)\n  }\n}"]}