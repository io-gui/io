{"version":3,"file":"animation_skinning_blending.js","sourceRoot":"","sources":["../../src/examples/animation_skinning_blending.ts"],"names":[],"mappings":"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","sourcesContent":["import { ReactiveProperty, Register } from '@io-gui/core'\nimport {\n  AnimationAction,\n  AnimationMixer,\n  Color,\n  DirectionalLight,\n  Fog,\n  Group,\n  HemisphereLight,\n  Mesh,\n  MeshPhongMaterial,\n  PerspectiveCamera,\n  PlaneGeometry,\n} from 'three/webgpu'\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js'\nimport { ThreeApplet } from '@io-gui/three'\nimport { ioButton, ioBoolean } from '@io-gui/inputs'\nimport { ioPropertyEditor, registerEditorGroups } from '@io-gui/editors'\n\nconst loader = new GLTFLoader()\n\n@Register\nexport class AnimationSkinningBlendingExample extends ThreeApplet {\n\n  @ReactiveProperty({type: Boolean, value: false})\n  declare isActive: boolean\n\n  @ReactiveProperty({type: Boolean, value: false})\n  declare isPlaying: boolean\n\n  public camera: PerspectiveCamera\n  public mixer?: AnimationMixer\n  public actions: Record<string, AnimationAction> = {}\n\n  // Pausing/Stepping\n  public stepSize: number = 0.05\n  // Crossfading\n  public useDefaultDuration: boolean = true\n  public customDuration: number = 3.5\n  // General Speed\n  public timeScale: number = 1\n\n  constructor() {\n    super()\n\n    // Camera\n    this.camera = new PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 100 )\n    this.camera.position.set( 1, 2, - 3 )\n    this.camera.lookAt( 0, 1, 0 )\n    this.scene.add(this.camera)\n\n    // Scene setup\n    this.scene.background = new Color(0xa0a0a0)\n    this.scene.fog = new Fog(0xa0a0a0, 10, 50)\n\n    // Lights\n    const hemiLight = new HemisphereLight(0xffffff, 0x8d8d8d, 3)\n    hemiLight.position.set(0, 20, 0)\n    this.scene.add(hemiLight)\n\n    const dirLight = new DirectionalLight(0xffffff, 3)\n    dirLight.position.set(-3, 10, -10)\n    dirLight.castShadow = true\n    dirLight.shadow.camera.top = 2\n    dirLight.shadow.camera.bottom = -2\n    dirLight.shadow.camera.left = -2\n    dirLight.shadow.camera.right = 2\n    dirLight.shadow.camera.near = 0.1\n    dirLight.shadow.camera.far = 40\n    this.scene.add(dirLight)\n\n    const ground = new Mesh(\n      new PlaneGeometry(10, 10),\n      new MeshPhongMaterial({color: 0xcbcbcb, depthWrite: false})\n    )\n    ground.rotation.x = -Math.PI / 2\n    ground.receiveShadow = true\n    this.scene.add(ground)\n\n    this.uiConfig = [\n      ['isPlaying', ioBoolean({true: 'io:circle_pause', false: 'io:circle_fill_arrow_right'})],\n      ['makeSingleStep', ioButton({label: 'Make Single Step'})],\n      ['actions', ioPropertyEditor()],\n      [AnimationAction, ioPropertyEditor()],\n    ]\n\n    void this.loadModel()\n  }\n\n  private async loadModel() {\n    loader.load('https://threejs.org/examples/models/gltf/Soldier.glb', (gltf) => {\n      const model = gltf.scene as Group\n      this.scene.add(model)\n\n      model.traverse((object) => {\n        if ((object as Mesh).isMesh) {\n          object.castShadow = true\n        }\n      })\n\n      this.mixer = new AnimationMixer(model)\n\n      this.actions = {\n        idle: this.mixer.clipAction(gltf.animations[0]),\n        walk: this.mixer.clipAction(gltf.animations[3]),\n        run: this.mixer.clipAction(gltf.animations[1]),\n      }\n\n      this.setProperties({\n        isActive: true,\n        isPlaying: true,\n      })\n\n      this.dispatch('scene-ready', {scene: this.scene}, true)\n    })\n  }\n\n  isActiveChanged() {\n    if (this.isActive) {\n      // this.setWeight(this.actions.idle!, this.idleWeight as number)\n      // this.setWeight(this.actions.walk!, this.walkWeight as number)\n      // this.setWeight(this.actions.run!, this.runWeight as number)\n      Object.values(this.actions).forEach((action: AnimationAction) => action.play())\n    } else {\n      Object.values(this.actions).forEach((action: AnimationAction) => action.stop())\n    }\n\n  }\n\n  // idle = () => { this.prepareCrossFade(this.idleAction!, 1.0) }\n  // walk = () => { this.prepareCrossFade(this.walkAction!, 0.5) }\n  // run = () => { this.prepareCrossFade(this.runAction!, 2.5) }\n\n  public makeSingleStep = () => {\n    if (this.mixer && !this.isPlaying) {\n      this.mixer.update(this.stepSize)\n    }\n  }\n\n  // private prepareCrossFade(action: AnimationAction, defaultDuration: number) {\n  //   if (!this.mixer) return\n\n  //   // const duration = this.setCrossFadeDuration(defaultDuration)\n\n  //   // // this.unpause()\n\n  //   // if (startAction === this.idleAction) {\n  //   //   this.executeCrossFade(startAction, endAction, duration)\n  //   // } else {\n  //   //   this.synchronizeCrossFade(startAction, endAction, duration)\n  //   // }\n  // }\n\n  // private setCrossFadeDuration(defaultDuration: number): number {\n  //   if (this.useDefaultDuration) {\n  //     return defaultDuration\n  //   } else {\n  //     return this.customDuration as number\n  //   }\n  // }\n\n  // private synchronizeCrossFade(startAction: AnimationAction, endAction: AnimationAction, duration: number) {\n  //   if (!this.mixer) return\n\n  //   const onLoopFinished = (event: {action: AnimationAction}) => {\n  //     if (event.action === startAction) {\n  //       this.mixer!.removeEventListener('loop', onLoopFinished as any)\n  //       this.executeCrossFade(startAction, endAction, duration)\n  //     }\n  //   }\n\n  //   this.mixer.addEventListener('loop', onLoopFinished as any)\n  // }\n\n  // private executeCrossFade(startAction: AnimationAction, endAction: AnimationAction, duration: number) {\n  //   this.setWeight(endAction, 1)\n  //   endAction.time = 0\n  //   startAction.crossFadeTo(endAction, duration, true)\n  // }\n\n  // private setWeight(action: AnimationAction, weight: number) {\n  //   action.enabled = true\n  //   action.setEffectiveTimeScale(1)\n  //   action.setEffectiveWeight(weight)\n  // }\n\n  onAnimate(delta: number) {\n    if (!this.mixer) return\n\n    debug: {\n      this.dispatchMutation(this.actions.idle)\n      this.dispatchMutation(this.actions.walk)\n      this.dispatchMutation(this.actions.run)\n    }\n    // this.dispatchMutation(this.options)\n\n    if (this.isPlaying) {\n      this.mixer.update(delta)\n    }\n  }\n}\n\nregisterEditorGroups(AnimationSkinningBlendingExample, {\n  Playback: [\n    'isActive',\n    'isPlaying',\n    'stepSize',\n    'makeSingleStep',\n  ],\n  Crossfade: [\n    'actions',\n    'walk',\n    'run',\n    'idle',\n    'useDefaultDuration',\n    'customDuration',\n  ],\n  'General Speed': [\n    'timeScale',\n  ],\n  Rendering: [],\n  Scene: [\n    'camera',\n  ],\n  Hidden: [\n    'mixer',\n    'singleStepMode',\n    'sizeOfNextStep',\n  ],\n})\n"]}