{"version":3,"file":"animation_backdrop.js","sourceRoot":"","sources":["../../src/examples/animation_backdrop.ts"],"names":[],"mappings":"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","sourcesContent":["import { ReactiveProperty, Register } from '@io-gui/core'\nimport { ThreeApplet } from '@io-gui/three'\nimport {\n\tAnimationMixer,\n\tGroup,\n\tMesh,\n\tMeshStandardNodeMaterial,\n\tSphereGeometry,\n\tSpotLight,\n\tMathUtils,\n  Node,\n  NeutralToneMapping,\n} from 'three/webgpu'\nimport {\n\tfloat,\n\tvec3,\n\tcolor,\n\tviewportSharedTexture,\n\thue,\n\tblendOverlay,\n\tposterize,\n\tgrayscale,\n\tsaturation,\n\tviewportSafeUV,\n\tscreenUV,\n\tchecker,\n\tuv,\n\ttime,\n\toscSine,\n\toutput,\n} from 'three/tsl'\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js'\n\n@Register\nexport class AnimationBackdropExample extends ThreeApplet {\n\n  @ReactiveProperty({type: AnimationMixer, init: new Group()})\n\tdeclare public mixer: AnimationMixer\n\n  public portals: Group\n\n\tconstructor() {\n\t\tsuper()\n\n    this.toneMapping = NeutralToneMapping\n\t\tthis.toneMappingExposure = 0.3\n\n\t\t// Background\n\t\tthis.scene.backgroundNode = screenUV.y.mix(color(0x66bbff), color(0x4466ff))\n\n\t\t// Light\n\t\tconst light = new SpotLight(0xffffff, 1)\n    light.position.set(1, 2, 3)\n\t\tlight.lookAt(0, 1, 0)\n\t\tlight.power = 2000\n\t\tthis.scene.add(light)\n\n\t\t// Portals\n\t\tthis.portals = new Group()\n\t\tthis.scene.add(this.portals)\n\n\t\tconst geometry = new SphereGeometry(.3, 32, 16)\n\n\t\tconst addBackdropSphere = (backdropNode: Node, backdropAlphaNode: Node | null = null) => {\n\t\t\tconst distance = 1\n\t\t\tconst id = this.portals.children.length\n\t\t\tconst rotation = MathUtils.degToRad(id * 45)\n\n\t\t\tconst material = new MeshStandardNodeMaterial({ color: 0x0066ff })\n\t\t\tmaterial.roughnessNode = float(.2)\n\t\t\tmaterial.metalnessNode = float(0)\n\t\t\tmaterial.backdropNode = backdropNode\n\t\t\tmaterial.backdropAlphaNode = backdropAlphaNode\n\t\t\tmaterial.transparent = true\n\n\t\t\tconst mesh = new Mesh(geometry, material)\n\t\t\tmesh.position.set(\n\t\t\t\tMath.cos(rotation) * distance,\n\t\t\t\t1,\n\t\t\t\tMath.sin(rotation) * distance\n\t\t\t)\n\n\t\t\tthis.portals.add(mesh)\n\t\t}\n\n\t\taddBackdropSphere(hue(viewportSharedTexture().bgr, oscSine().mul(Math.PI)))\n\t\taddBackdropSphere(viewportSharedTexture().rgb.oneMinus())\n\t\taddBackdropSphere(grayscale(viewportSharedTexture().rgb))\n\t\taddBackdropSphere(saturation(viewportSharedTexture().rgb, 10), oscSine())\n\t\taddBackdropSphere(blendOverlay(viewportSharedTexture().rgb, checker(uv().mul(10))))\n\t\taddBackdropSphere(viewportSharedTexture(viewportSafeUV(screenUV.mul(40).floor().div(40))))\n\t\taddBackdropSphere(viewportSharedTexture(viewportSafeUV(screenUV.mul(80).floor().div(80))).add(color(0x0033ff)))\n\t\taddBackdropSphere(vec3(0, 0, viewportSharedTexture().b))\n\n\t\t// Load model\n\t\tvoid this.loadModel()\n\t}\n\n\tprivate async loadModel() {\n\t\tconst loader = new GLTFLoader()\n\t\tloader.load('https://threejs.org/examples/models/gltf/Michelle.glb', (gltf) => {\n\t\t\tconst object = gltf.scene\n\t\t\tthis.mixer = new AnimationMixer(object)\n\n      const mesh = object.children[0].children[0] as Mesh\n\t\t\tconst material = mesh.material as MeshStandardNodeMaterial\n\n      // TODO: Time is respecting the animation mixer timeScale\n      material.outputNode = oscSine(time.mul(.1)).mix(output, posterize(output.add(.1), 4).mul(2))\n\n\t\t\tconst action = this.mixer.clipAction(gltf.animations[0])\n\t\t\taction.play()\n\n\t\t\tthis.scene.add(object)\n\t\t})\n\t}\n\n\tonAnimate(delta: number) {\n    this.mixer.update(delta)\n    debug: {\n      this.dispatchMutation(this.mixer)\n    }\n\t\tthis.portals.rotation.y += delta * this.mixer.timeScale * 0.5\n\t}\n}\n\n"]}