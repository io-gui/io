{"version":3,"file":"backdrop_area.js","sourceRoot":"","sources":["../../src/examples/backdrop_area.ts"],"names":[],"mappings":"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","sourcesContent":["import { ReactiveProperty, Register } from '@io-gui/core'\nimport {\n\tAmbientLight,\n\tAnimationMixer,\n\tBoxGeometry,\n\tDoubleSide,\n\tMesh,\n\tMeshBasicNodeMaterial,\n  Vector3,\n} from 'three/webgpu'\nimport {\n\tcolor,\n\tpositionWorld,\n\tlinearDepth,\n\tviewportLinearDepth,\n\tviewportSharedTexture,\n\tscreenUV,\n\thue,\n\ttime,\n\tchecker,\n\tuv,\n\tmodelScale,\n} from 'three/tsl'\nimport { hashBlur } from 'three/addons/tsl/display/hashBlur.js'\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js'\nimport { ThreeApplet, ioVector3 } from '@io-gui/three'\nimport { ioOptionSelect, MenuOption } from '@io-gui/menus'\n\n@Register\nexport class WebGPUBackdropAreaExample extends ThreeApplet {\n\tpublic mixer?: AnimationMixer\n\tpublic box: Mesh\n\n\t// Materials\n\tpublic blurredBlurMaterial: MeshBasicNodeMaterial\n\tpublic depthMaterial: MeshBasicNodeMaterial\n\tpublic checkerMaterial: MeshBasicNodeMaterial\n\tpublic pixelMaterial: MeshBasicNodeMaterial\n\n\tpublic materials: Record<string, MeshBasicNodeMaterial>\n\n  public boxScale: Vector3\n\n  @ReactiveProperty({type: String, value: 'blurred'})\n\tdeclare public material: string\n\n\tconstructor() {\n\t\tsuper()\n\n\t\tthis.toneMappingExposure = 0.9\n\n\t\t// Background\n\t\tthis.scene.backgroundNode = hue(screenUV.y.mix(color(0x66bbff), color(0x4466ff)), time.mul(0.1))\n\n\t\t// Lighting\n\t\tconst ambient = new AmbientLight(0xffffff, 2.5)\n\t\tthis.scene.add(ambient)\n\n\t\t// Create materials\n\t\t// Compare depth from viewportLinearDepth with linearDepth() to create a distance field\n\t\tconst depthDistance = viewportLinearDepth.distance(linearDepth())\n\n\t\tconst depthAlphaNode = depthDistance.oneMinus().smoothstep( .90, 2 ).mul( 10 ).saturate()\n\t\tconst depthBlurred = hashBlur( viewportSharedTexture(), depthDistance.smoothstep( 0, .6 ).mul( 40 ).clamp().mul( .1 ) )\n\n\t\t// Blurred material\n\t\tthis.blurredBlurMaterial = new MeshBasicNodeMaterial()\n\t\tthis.blurredBlurMaterial.backdropNode = depthBlurred.add(depthAlphaNode.mix(color(0x003399).mul(.3), 0))\n\t\tthis.blurredBlurMaterial.transparent = true\n\t\tthis.blurredBlurMaterial.side = DoubleSide\n\n\t\t// Depth material\n\t\tthis.depthMaterial = new MeshBasicNodeMaterial()\n\t\tthis.depthMaterial.backdropNode = depthAlphaNode\n\t\tthis.depthMaterial.transparent = true\n\t\tthis.depthMaterial.side = DoubleSide\n\n\t\t// Checker material\n\t\tthis.checkerMaterial = new MeshBasicNodeMaterial()\n\t\tthis.checkerMaterial.backdropNode = hashBlur(viewportSharedTexture(), .05)\n\t\tthis.checkerMaterial.backdropAlphaNode = checker(uv().mul(3).mul(modelScale.xy))\n\t\tthis.checkerMaterial.opacityNode = this.checkerMaterial.backdropAlphaNode\n\t\tthis.checkerMaterial.transparent = true\n\t\tthis.checkerMaterial.side = DoubleSide\n\n\t\t// Pixel material\n\t\tthis.pixelMaterial = new MeshBasicNodeMaterial()\n\t\tthis.pixelMaterial.backdropNode = viewportSharedTexture(screenUV.mul(100).floor().div(100))\n\t\tthis.pixelMaterial.transparent = true\n\n\t\t// Materials map\n\t\tthis.materials = {\n\t\t\t'blurred': this.blurredBlurMaterial,\n\t\t\t'depth': this.depthMaterial,\n\t\t\t'checker': this.checkerMaterial,\n\t\t\t'pixel': this.pixelMaterial\n\t\t}\n\n\t\t// Box\n\t\tthis.box = new Mesh(new BoxGeometry(2, 2, 2), this.blurredBlurMaterial)\n\t\tthis.box.position.set(0, 1, 0)\n\t\tthis.boxScale = this.box.scale\n\t\tthis.box.renderOrder = 1\n\t\tthis.scene.add(this.box)\n\n\t\t// Floor\n\t\tconst floor = new Mesh(new BoxGeometry(3, .01, 3), new MeshBasicNodeMaterial({\n\t\t\tcolor: 0xff6600,\n\t\t\topacityNode: positionWorld.xz.distance(0).oneMinus().clamp(),\n\t\t\ttransparent: true,\n\t\t\tdepthWrite: false\n\t\t}))\n  \tthis.scene.add(floor)\n\n    this.uiConfig = [\n      ['material', ioOptionSelect({\n        option: new MenuOption({\n          selectedID: this.bind('material'),\n          options: ['blurred', 'depth', 'checker', 'pixel']\n        }),\n        selectBy: 'id'\n      })],\n      [Vector3, ioVector3({linkable: true})]\n    ]\n\n\t\t// Load model\n\t\tvoid this.loadModel()\n    this.materialChanged()\n\t}\n\n  materialChanged() {\n    if (this.materials[this.material]) {\n\t\t\tthis.box.material = this.materials[this.material]\n\t\t}\n  }\n\n\tprivate async loadModel() {\n\t\tconst loader = new GLTFLoader()\n\t\tloader.load('https://threejs.org/examples/models/gltf/Michelle.glb', (gltf) => {\n\t\t\tconst object = gltf.scene\n\t\t\tthis.mixer = new AnimationMixer(object)\n\n\t\t\tconst action = this.mixer.clipAction(gltf.animations[0])\n\t\t\taction.play()\n\n\t\t\tthis.scene.add(object)\n\n      this.dispatchMutation()\n      this.dispatch('frame-object', {scene: this.scene.children[1]}, true)\n\t\t})\n\t}\n\n\tonAnimate(delta: number) {\n\t\tif (this.mixer) {\n\t\t\tthis.mixer.update(delta)\n\t\t}\n\t}\n}\n\n"]}