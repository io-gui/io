{"version":3,"file":"IoBuildGeometry.js","sourceRoot":"","sources":["../../src/elements/IoBuildGeometry.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAkB,gBAAgB,EAAe,MAAM,cAAc,CAAA;AACjG,OAAO,EAAE,QAAQ,EAAE,MAAM,gBAAgB,CAAA;AACzC,OAAO,EAAE,gBAAgB,EAAE,MAAM,iBAAiB,CAAA;AAU3C,IAAM,eAAe,GAArB,MAAM,eAAgB,SAAQ,SAAS;IAK5C,MAAM,KAAK,KAAK;QACd,OAAO,SAAS,CAAA;;;;;KAKf,CAAA;IACH,CAAC;IAED,YAAY,OAA6B,EAAE;QACzC,KAAK,CAAC,IAAI,CAAC,CAAA;IACb,CAAC;IAED,aAAa;QACX,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAA;QAC3B,IAAI,CAAC,QAAQ;YAAE,OAAM;QAErB,MAAM,UAAU,GAAI,QAAgB,CAAC,UAAU,CAAA;QAC/C,IAAI,CAAC,UAAU,EAAE,CAAC;YAChB,KAAK,EAAE,CAAC;gBACN,OAAO,CAAC,IAAI,CAAC,sDAAsD,CAAC,CAAA;YACtE,CAAC;YACD,OAAM;QACR,CAAC;QAED,MAAM,aAAa,GAAG,QAAQ,CAAC,WAAmD,CAAA;QAClF,MAAM,eAAe,GAAG,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAA;QAEjD,MAAM,WAAW,GAAG,IAAI,aAAa,CAAC,GAAG,eAAe,CAAC,CAAA;QACzD,QAAQ,CAAC,IAAI,CAAC,WAA6B,CAAC,CAAA;QAC5C,WAAW,CAAC,OAAO,EAAE,CAAA;QAErB,QAAQ,CAAC,oBAAoB,EAAE,CAAA;QAC/B,QAAQ,CAAC,eAAe,EAAE,CAAA;QAC1B,QAAQ,CAAC,qBAAqB,EAAE,CAAA;QAChC,QAAQ,CAAC,kBAAkB,EAAE,CAAA;QAE7B,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAA;QAC/B,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,WAAY,CAAC,CAAA;QAC5C,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,cAAe,CAAC,CAAA;IACjD,CAAC;IAED,OAAO;QACL,MAAM,aAAa,GAAG,IAAI,CAAC,KAAK,IAAK,IAAI,CAAC,KAAa,CAAC,UAAU,CAAA;QAClE,IAAI,CAAC,MAAM,CAAC;YACV,gBAAgB,CAAC;gBACf,KAAK,EAAE,IAAI,CAAC,KAAY;gBACxB,UAAU,EAAE,CAAC,YAAY,CAAC;gBAC1B,OAAO,EAAE,KAAK;aACf,CAAC;YACF,QAAQ,CAAC;gBACP,KAAK,EAAE,gBAAgB;gBACvB,MAAM,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,EAAE;gBAClC,QAAQ,EAAE,CAAC,aAAa;aACzB,CAAC;YACF,QAAQ,CAAC;gBACP,KAAK,EAAE,wBAAwB;gBAC/B,MAAM,EAAE,GAAG,EAAE;oBACX,IAAI,CAAC,KAAK,EAAE,oBAAoB,EAAE,CAAA;gBACpC,CAAC;aACF,CAAC;YACF,QAAQ,CAAC;gBACP,KAAK,EAAE,kBAAkB;gBACzB,MAAM,EAAE,GAAG,EAAE;oBACX,IAAI,CAAC,KAAK,EAAE,eAAe,EAAE,CAAA;gBAC/B,CAAC;aACF,CAAC;YACF,QAAQ,CAAC;gBACP,KAAK,EAAE,yBAAyB;gBAChC,MAAM,EAAE,GAAG,EAAE;oBACX,IAAI,CAAC,KAAK,EAAE,qBAAqB,EAAE,CAAA;oBACnC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAM,CAAC,cAAe,CAAC,CAAA;oBAClD,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAM,CAAC,cAAe,CAAC,MAAO,CAAC,CAAA;gBAC5D,CAAC;aACF,CAAC;YACF,QAAQ,CAAC;gBACP,KAAK,EAAE,sBAAsB;gBAC7B,MAAM,EAAE,GAAG,EAAE;oBACX,IAAI,CAAC,KAAK,EAAE,kBAAkB,EAAE,CAAA;oBAChC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAM,CAAC,WAAY,CAAC,GAAI,CAAC,CAAA;oBACpD,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAM,CAAC,WAAY,CAAC,GAAI,CAAC,CAAA;gBACtD,CAAC;aACF,CAAC;SACH,CAAC,CAAA;IACJ,CAAC;CACF,CAAA;AAvFS;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC;8CACmB;AAHrD,eAAe;IAD3B,QAAQ;GACI,eAAe,CA0F3B;;AAED,MAAM,CAAC,MAAM,eAAe,GAAG,UAAS,IAA2B;IACjE,OAAO,eAAe,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;AAC3C,CAAC,CAAA","sourcesContent":["import { Register, IoElement, IoElementProps, ReactiveProperty, WithBinding } from '@io-gui/core'\nimport { ioButton } from '@io-gui/inputs'\nimport { ioPropertyEditor } from '@io-gui/editors'\nimport { BufferGeometry, type NormalOrGLBufferAttributes } from 'three/webgpu'\n\ntype GeometryConstructor<T extends BufferGeometry<NormalOrGLBufferAttributes>> = new (...args: any[]) => T\n\nexport type IoBuildGeometryProps = IoElementProps & {\n  value?: WithBinding<BufferGeometry<NormalOrGLBufferAttributes>>\n}\n\n@Register\nexport class IoBuildGeometry extends IoElement {\n\n  @ReactiveProperty({type: Object, init: null})\n  declare value: BufferGeometry<NormalOrGLBufferAttributes> | null\n\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex-direction: column;\n      }\n    `\n  }\n\n  constructor(args: IoBuildGeometryProps = {}) {\n    super(args)\n  }\n\n  buildGeometry() {\n    const geometry = this.value\n    if (!geometry) return\n\n    const parameters = (geometry as any).parameters\n    if (!parameters) {\n      debug: {\n        console.warn('IoBuildGeometry: geometry has no parameters property')\n      }\n      return\n    }\n\n    const GeometryClass = geometry.constructor as GeometryConstructor<typeof geometry>\n    const parameterValues = Object.values(parameters)\n\n    const newGeometry = new GeometryClass(...parameterValues)\n    geometry.copy(newGeometry as BufferGeometry)\n    newGeometry.dispose()\n\n    geometry.computeVertexNormals()\n    geometry.computeTangents()\n    geometry.computeBoundingSphere()\n    geometry.computeBoundingBox()\n\n    this.dispatchMutation(geometry)\n    this.dispatchMutation(geometry.boundingBox!)\n    this.dispatchMutation(geometry.boundingSphere!)\n  }\n\n  changed() {\n    const hasParameters = this.value && (this.value as any).parameters\n    this.render([\n      ioPropertyEditor({\n        value: this.value as any,\n        properties: ['parameters'],\n        labeled: false,\n      }),\n      ioButton({\n        label: 'Build Geometry',\n        action: () => this.buildGeometry(),\n        disabled: !hasParameters,\n      }),\n      ioButton({\n        label: 'Compute Vertex Normals',\n        action: () => {\n          this.value?.computeVertexNormals()\n        },\n      }),\n      ioButton({\n        label: 'Compute Tangents',\n        action: () => {\n          this.value?.computeTangents()\n        },\n      }),\n      ioButton({\n        label: 'Compute Bounding Sphere',\n        action: () => {\n          this.value?.computeBoundingSphere()\n          this.dispatchMutation(this.value!.boundingSphere!)\n          this.dispatchMutation(this.value!.boundingSphere!.center!)\n        },\n      }),\n      ioButton({\n        label: 'Compute Bounding Box',\n        action: () => {\n          this.value?.computeBoundingBox()\n          this.dispatchMutation(this.value!.boundingBox!.max!)\n          this.dispatchMutation(this.value!.boundingBox!.min!)\n        },\n      }),\n    ])\n  }\n}\n\nexport const ioBuildGeometry = function(arg0?: IoBuildGeometryProps) {\n  return IoBuildGeometry.vConstructor(arg0)\n}\n"]}