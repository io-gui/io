{"version":3,"file":"IoBuildGeometry.js","sourceRoot":"","sources":["../../src/elements/IoBuildGeometry.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, IoElementProps, ReactiveProperty, WithBinding, div } from '@io-gui/core'\nimport { ioButton } from '@io-gui/inputs'\nimport { ioPropertyEditor } from '@io-gui/editors'\nimport { BufferGeometry, type NormalOrGLBufferAttributes } from 'three/webgpu'\n\ntype GeometryConstructor<T extends BufferGeometry<NormalOrGLBufferAttributes>> = new (...args: any[]) => T\n\nexport type IoBuildGeometryProps = IoElementProps & {\n  value?: WithBinding<BufferGeometry<NormalOrGLBufferAttributes>>\n}\n\n@Register\nexport class IoBuildGeometry extends IoElement {\n\n  @ReactiveProperty({type: Object, init: null})\n  declare value: BufferGeometry<NormalOrGLBufferAttributes> | null\n\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex-direction: column;\n      }\n      :host > div {\n        display: flex;\n        flex-direction: row;\n      }\n      :host > div > * {\n        flex: 1 1 auto;\n      }\n    `\n  }\n\n  constructor(args: IoBuildGeometryProps = {}) {\n    super(args)\n  }\n\n  buildGeometry() {\n    const geometry = this.value\n    if (!geometry) return\n\n    const parameters = (geometry as any).parameters\n    if (!parameters) {\n      debug: {\n        console.warn('IoBuildGeometry: geometry has no parameters property')\n      }\n      return\n    }\n\n    const GeometryClass = geometry.constructor as GeometryConstructor<typeof geometry>\n    const parameterValues = Object.values(parameters)\n\n    const newGeometry = new GeometryClass(...parameterValues)\n\n    const version = geometry.index?.version ?? 0\n    geometry.copy(newGeometry as BufferGeometry)\n    newGeometry.dispose()\n\n    // Workaround for #32903\n    if (geometry.index) {\n      geometry.index.version = version\n    }\n\n    for (const name in geometry.attributes) {\n      geometry.attributes[name].needsUpdate = true\n    }\n    if (geometry.index) {\n      geometry.index.needsUpdate = true\n    }\n\n    geometry.computeVertexNormals()\n\n    if (geometry.index && geometry.attributes.position && geometry.attributes.normal && geometry.attributes.uv) {\n      geometry.computeTangents()\n    }\n\n    geometry.computeBoundingSphere()\n    geometry.computeBoundingBox()\n\n    this.dispatchMutation(geometry)\n    this.dispatchMutation(geometry.boundingBox!)\n    this.dispatchMutation(geometry.boundingSphere!)\n  }\n\n  changed() {\n    const geometry = this.value\n    if (!geometry) {\n      this.render([])\n      return\n    }\n    const hasParameters = geometry && (geometry as any).parameters\n    const hasIndexNormalsUv = geometry.index && geometry.attributes.position && geometry.attributes.normal && geometry.attributes.uv\n    this.render([\n      ioPropertyEditor({\n        widget: null,\n        value: geometry as any,\n        properties: ['parameters'],\n        labeled: false,\n      }),\n      div([\n        ioButton({\n          label: 'Build',\n          action: () => this.buildGeometry(),\n          disabled: !hasParameters,\n        }),\n        ioButton({\n          label: 'vtx',\n          action: () => {\n            geometry?.computeVertexNormals()\n          },\n        }),\n        ioButton({\n          label: 'tng',\n          disabled: !hasIndexNormalsUv,\n          action: () => {\n            geometry?.computeTangents()\n          },\n        }),\n        ioButton({\n          label: 'bSphere',\n          action: () => {\n            geometry?.computeBoundingSphere()\n            this.dispatchMutation(geometry!.boundingSphere!)\n            this.dispatchMutation(geometry!.boundingSphere!.center!)\n          },\n        }),\n        ioButton({\n          label: 'bBox',\n          action: () => {\n            geometry?.computeBoundingBox()\n            this.dispatchMutation(geometry!.boundingBox!.max!)\n            this.dispatchMutation(geometry!.boundingBox!.min!)\n          },\n        }),\n      ])\n    ])\n  }\n}\n\nexport const ioBuildGeometry = function(arg0?: IoBuildGeometryProps) {\n  return IoBuildGeometry.vConstructor(arg0)\n}\n"]}