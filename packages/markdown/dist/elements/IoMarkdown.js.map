{"version":3,"file":"IoMarkdown.js","sourceRoot":"","sources":["../../src/elements/IoMarkdown.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, ReactiveProperty, ThemeSingleton, IoElementProps, WithBinding, Property } from '@io-gui/core'\nimport { Marked } from 'marked'\nimport { markedHighlight } from 'marked-highlight'\nimport purify from 'dompurify'\nimport { MD_DARK_THEME, MD_LIGHT_THEME } from './IoMarkdownTheme.js'\nimport hljs from '../../lib/highlight.min.js'\n\nconst marked = new Marked(\n  markedHighlight({\n    langPrefix: 'hljs language-',\n    highlight(code, lang) {\n      const language = hljs.getLanguage(lang) ? lang : 'plaintext'\n      return hljs.highlight(code, { language }).value\n    }\n  })\n)\n\nconst renderer = new marked.Renderer()\nrenderer.heading = function({ tokens, depth }: { tokens: any[]; depth: number }) {\n  const text = tokens.map(token => token.text).join('')\n  return `<h${depth} data-heading=\"${text}\">${text}</h${depth}>`\n}\n\nmarked.setOptions({ renderer })\n\nfunction strip(innerHTML: string, strip: string[]) {\n  for (let i = 0; i < strip.length; i++) {\n    innerHTML = innerHTML.replace(new RegExp(strip[i], 'g'),'')\n  }\n  return innerHTML\n}\n\nexport type IoMarkdownProps = IoElementProps & {\n  src?: string\n  strip?: string[]\n  loading?: WithBinding<boolean>\n  sanitize?: boolean\n  scroll?: WithBinding<string>\n}\n\n/**\n * This elements loads a markdown file from path specified as `src` property and renders it as HTML using marked and dompurify.\n */\n@Register\nexport class IoMarkdown extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex-direction: column;\n        align-self: stretch;\n        justify-self: stretch;\n        flex: 1 1 auto;\n        /* overflow-x: hidden; */\n        /* overflow-y: auto; */\n        -webkit-overflow-scrolling: touch;\n        -webkit-tap-highlight-color: transparent;\n        padding: 0 var(--io_lineHeight);\n        padding-bottom: var(--io_lineHeight);\n        color: var(--io_color);\n        background-color: var(--io_bgColor);\n        font-size: var(--io_fontSize);\n      }\n      :host p {\n        line-height: 1.45em;\n        margin: 0.35em 0;\n      }\n      :host a {\n        text-decoration: none;\n        color: var(--io_colorBlue);\n      }\n      :host h1 {\n        padding: 0.7em 0;\n        margin: 0;\n        border-bottom: var(--io_border);\n        color: var(--io_colorStrong);\n      }\n      :host h2 {\n        padding: 0.6em 0;\n        margin: 0;\n        color: var(--io_colorStrong);\n      }\n      :host h3 {\n        padding: 0.5em 0;\n        margin: 0;\n        color: var(--io_colorStrong);\n      }\n      :host h4 {\n        padding: 0.4em 0;\n        margin: 0;\n        color: var(--io_colorStrong);\n      }\n      :host code {\n        background-color: var(--io_bgColorLight);\n      }\n      :host strong code {}\n      :host pre > code {\n        line-height: 1.3em;\n      }\n      \n      :host code[class] {\n        background-color: var(--io_bgColorLight);\n        padding: var(--io_spacing3);\n        display: block;\n        overflow-x: auto;\n        font-size: var(--io-code-size);\n      }\n      :host blockquote {\n        font-size: 0.85em;\n        opacity: 0.75;\n        margin: var(--io_lineHeight) 0;\n        padding: var(--io_spacing3) var(--io_lineHeight);\n        background-color: var(--io_bgColorStrong);\n        color: var(--io_color);\n        border-left: var(--io_border);\n        border-left-width: var(--io_spacing2);\n      }\n      :host blockquote strong {\n        color: var(--io_colorStrong);\n      }\n      :host table  {\n        width: 100% !important;\n        border: var(--io_border);\n        border-collapse: collapse;\n        table-layout: auto;\n      }\n      :host table th {\n        background-color: var(--io_bgColorLight);\n        color: var(--io_colorStrong);\n        font-weight: bold;\n      }\n      :host table td,\n      :host table tr,\n      :host table th {\n        border: var(--io_border);\n        padding: var(--io_spacing) var(--io_spacing2);\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: nowrap;\n        width: auto;\n      }\n      :host .videocontainer {\n          width: 100%;\n          height: 0;\n          position: relative;\n          padding-bottom: 56.25%;\n      }\n      :host .videocontainer > iframe {\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n      }\n      @keyframes spinner {\n        to {transform: rotate(360deg);}\n      }\n      :host[loading]:after {\n        content: '';\n        box-sizing: border-box;\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        width: 40px;\n        height: 40px;\n        margin-top: -20px;\n        margin-left: -20px;\n        border-radius: 50%;\n        border: var(--io_border);\n        border-top-color: #000;\n        animation: spinner .6s linear infinite;\n      }\n    `\n  }\n\n  @ReactiveProperty({value: '', reflect: true})\n  declare src: string\n\n  @ReactiveProperty({type: Array, init: null})\n  declare strip: string[]\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare loading: boolean\n\n  @ReactiveProperty(true)\n  declare sanitize: boolean\n\n  @Property('document')\n  declare role: string\n\n  constructor(args: IoMarkdownProps = {}) { super(args) }\n\n  onResized() {\n    let width = this.getBoundingClientRect().width\n    width = Math.min(Math.max((width - 30) / 45, 11), 14)\n    this.style.setProperty('--io-code-size', width + 'px')\n  }\n\n  srcChanged() {\n    this.loading = true\n    this.innerHTML = ''\n    void fetch(this.src)\n      .then(response => response.text())\n      .then(markdown => {\n        let md = marked.parse(markdown) as string\n        if (this.sanitize) md = purify.sanitize(md)\n        this.innerHTML = strip(md, this.strip)\n        this.loading = false\n      })\n  }\n}\nexport const ioMarkdown = function(arg0?: IoMarkdownProps) {\n  return IoMarkdown.vConstructor(arg0)\n}\n\nconst styleElement = document.createElement('style')\nstyleElement.id = 'io-highlight-theme'\ndocument.head.appendChild(styleElement)\n\nfunction setTheme() {\n  if (ThemeSingleton.themeID === 'dark') {\n    styleElement.innerHTML = MD_DARK_THEME\n  } else {\n    styleElement.innerHTML = MD_LIGHT_THEME\n  }\n}\nsetTheme()\nThemeSingleton.addEventListener('themeID-changed', setTheme)\n"]}