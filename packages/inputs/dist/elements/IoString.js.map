{"version":3,"file":"IoString.js","sourceRoot":"","sources":["../../src/elements/IoString.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, ReactiveProperty, Property, WithBinding } from '@io-gui/core'\nimport { IoField, IoFieldProps } from './IoField.js'\n\nexport type IoStringProps = IoFieldProps & {\n  value?: WithBinding<string>\n  live?: boolean\n  placeholder?: string\n  appearance?: 'neutral' | 'inset' | 'outset'\n}\n\n/**\n * Input element for `String` data type.\n **/\n@Register\nexport class IoString extends IoField {\n  static get Style() {\n    return /* css */`\n      :host {\n        cursor: text;\n        user-select: text;\n        -webkit-user-select: text;\n        -webkit-touch-callout: default;\n      }\n      :host[placeholder]:empty:before {\n        content: attr(placeholder);\n        visibility: visible;\n        color: var(--io_colorInput);\n        padding: 0 calc(var(--io_spacing) + var(--io_borderWidth));\n        opacity: 0.5;\n      }\n    `\n  }\n  @ReactiveProperty({value: '', type: String})\n  declare value: string\n\n  @ReactiveProperty({value: false, type: Boolean})\n  declare live: boolean\n\n  @ReactiveProperty({value: '', type: String, reflect: true})\n  declare placeholder: string\n\n  @ReactiveProperty({value: 'inset', reflect: true})\n  declare appearance: 'neutral' | 'inset' | 'outset'\n\n  @Property('true')\n  declare contentEditable: string\n\n  @Property('textbox')\n  declare role: string\n\n  constructor(args: IoStringProps = {}) { super(args) }\n\n  get textNode() {\n    this._flattenTextNode(this)\n    return this._textNode.nodeValue\n  }\n  set textNode(value) {\n    this._flattenTextNode(this)\n    this._textNode.nodeValue = String(value)\n  }\n\n  _setFromTextNode() {\n    const textNode = this.textNode\n    if (typeof this.value === 'string' && textNode !== String(this.value)) {\n      this.inputValue(textNode)\n    }\n  }\n  // TODO: reconsider this feature\n  _setObjectFromTextNodeJSON() {\n    const textNode = this.textNode!\n    try {\n      const value = JSON.parse(textNode.replace(/[\\t\\n\\r ]+/g, ' '))\n      this.inputValue(value)\n    } catch (error) {\n      console.warn('IoString: Cannot parse value', textNode)\n      console.error(error)\n      this._setFromTextNode()\n    }\n  }\n  onBlur(event: FocusEvent) {\n    super.onBlur(event)\n    this._setFromTextNode()\n    this.scrollTop = 0\n    this.scrollLeft = 0\n  }\n  onPointerup(event: PointerEvent) {\n    super.onPointerup(event)\n    if (document.activeElement !== this as unknown as Element) {\n      this.focus()\n      this.setCaretPosition(this.textNode!.length)\n    }\n  }\n  onKeydown(event: KeyboardEvent) {\n    const range = (window.getSelection() as Selection).getRangeAt(0)\n    const rangeStart = range.startOffset\n    const rangeEnd = range.endOffset\n    const length = this.childNodes[0] ? (this.childNodes[0] as Text).length : 0\n    const rangeInside = range.startContainer === range.endContainer && (range.startContainer === this.childNodes[0] || range.startContainer === this as unknown as Node)\n\n    switch (event.key) {\n      case 'Enter':\n        event.preventDefault()\n        if (event.shiftKey) {\n          // TODO: reconsider this feature\n          this._setObjectFromTextNodeJSON()\n        } else {\n          this._setFromTextNode()\n        }\n        break\n      case 'ArrowLeft':\n        if (event.ctrlKey || (rangeInside && rangeStart === rangeEnd && rangeStart === 0)) {\n          event.preventDefault()\n          this.dispatch('io-focus-to', {source: this, command: 'ArrowLeft'}, true)\n        }\n        break\n      case 'ArrowUp':\n        if (event.ctrlKey || (rangeInside && rangeStart === rangeEnd && rangeStart === 0)) {\n          event.preventDefault()\n          this.dispatch('io-focus-to', {source: this, command: 'ArrowUp'}, true)\n        }\n        break\n      case 'ArrowRight':\n        if (event.ctrlKey || (rangeInside && rangeStart === rangeEnd && rangeStart === length)) {\n          event.preventDefault()\n          this.dispatch('io-focus-to', {source: this, command: 'ArrowRight'}, true)\n        }\n        break\n      case 'ArrowDown':\n        if (event.ctrlKey || (rangeInside && rangeStart === rangeEnd && rangeStart === length)) {\n          event.preventDefault()\n          this.dispatch('io-focus-to', {source: this, command: 'ArrowDown'}, true)\n        }\n        break\n      default:\n        if (['Tab', 'Home', 'End', 'PageUp', 'PageDown'].includes(event.key)) {\n          event.preventDefault()\n          this.dispatch('io-focus-to', {source: this, command: event.key}, true)\n        }\n    }\n  }\n  onKeyup(event: KeyboardEvent) {\n    super.onKeyup(event)\n    if (this.live) {\n      const carretPosition = this.getCaretPosition()\n      this._setFromTextNode()\n      this.setCaretPosition(carretPosition)\n    }\n  }\n  ready() {\n    this.disabledChanged()\n  }\n  valueChanged() {\n    this.invalid = (typeof this.value !== 'string' && this.value !== null && this.value !== undefined)\n  }\n  changed() {\n    this.textNode = String(this.value || '')\n  }\n}\nexport const ioString = function(arg0?: IoStringProps) {\n  return IoString.vConstructor(arg0)\n}\n"]}