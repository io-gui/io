{"version":3,"file":"index.js","sources":["../src/nodes/MenuOption.ts","../src/utils/MenuDOMUtils.ts","../src/utils/MenuNodeUtils.ts","../src/elements/IoMenuOptions.ts","../src/elements/IoMenuItem.ts","../src/elements/IoMenuHamburger.ts","../src/elements/IoMenuTreeBranch.ts","../src/elements/IoMenuTree.ts","../src/elements/IoOptionSelect.ts","../src/elements/IoContextMenu.ts"],"sourcesContent":["import { Node, Register, ReactiveProperty, WithBinding, NodeArray } from '@io-gui/core'\n\nexport type MenuOptionMode = 'select' | 'toggle' | 'none'\n\nexport type MenuOptionProps = {\n  id?: string\n  value?: any\n  label?: string\n  icon?: string\n  hint?: string\n  action?: (value?: any) => void\n  mode?: MenuOptionMode\n  disabled?: boolean\n  selected?: WithBinding<boolean>\n  selectedID?: WithBinding<string>\n  selectedIDImmediate?: WithBinding<string>\n  path?: WithBinding<string>\n  options?: Array<string | number | boolean | null | undefined | MenuOptionProps>\n}\n\n@Register\nexport class MenuOption extends Node {\n\n  @ReactiveProperty({value: '', type: String})\n  declare id: string\n\n  @ReactiveProperty({value: undefined})\n  declare value: any\n\n  @ReactiveProperty({value: '', type: String})\n  declare label: string\n\n  @ReactiveProperty({value: '', type: String})\n  declare icon: string\n\n  @ReactiveProperty({value: '', type: String})\n  declare hint: string\n\n  @ReactiveProperty({value: false, type: Boolean})\n  declare disabled: boolean\n\n  @ReactiveProperty()\n  declare action?: (value?: any) => void\n\n  @ReactiveProperty({value: 'select', type: String})\n  declare mode: MenuOptionMode\n\n  @ReactiveProperty({value: false, type: Boolean})\n  declare selected: boolean\n\n  @ReactiveProperty({value: '', type: String})\n  declare selectedIDImmediate: string\n\n  @ReactiveProperty({value: '', type: String})\n  declare selectedID: string\n\n  @ReactiveProperty({value: '', type: String})\n  declare path: string\n\n  @ReactiveProperty({type: NodeArray, init: 'this'})\n  declare options: NodeArray<MenuOption>\n\n  static get Listeners() {\n    return {\n      'option-selected-changed': 'onOptionSelectedChanged',\n    }\n  }\n\n  constructor(args: string | number | boolean | null | undefined | MenuOptionProps) {\n\n    if (typeof args === 'string' || typeof args === 'number' || typeof args === 'boolean' || args === null || args === undefined) {\n      args = {\n        id: String(args),\n        value: args,\n      }\n    }\n\n    args = { ...args }\n    args.id = args.id ?? 'null' // TODO: Reconsider.\n    args.label = args.label ?? args.id\n    args.value = args.value ?? args.id\n    args.options = args.options ?? []\n    args.options = args.options.map(option => (option instanceof MenuOption) ? option : new MenuOption(option))\n\n    const hardenedOptions = args.options as MenuOption[]\n    const selectedOptions = hardenedOptions.filter(option => option.mode === 'select' && option.selected)\n    for (let i = 1; i < selectedOptions.length; i++) {\n      debug: console.warn('Duplicate selected options with mode \"select\" found!', selectedOptions)\n      selectedOptions[i].selected = false\n    }\n\n    super(args as MenuOptionProps)\n  }\n  getAllOptions() {\n    const options: MenuOption[] = [this]\n    for (let i = 0; i < this.options.length; i++) {\n      options.push(...this.options[i].getAllOptions())\n    }\n    debug: {\n      const ids = new Set()\n      for (let i = 0; i < options.length; i++) {\n        if (ids.has(options[i].id)) console.warn(`Duplicate id \"${options[i].id}\"`, this)\n        ids.add(options[i].id)\n      }\n    }\n    return options\n  }\n  findItemByValue(value: any) {\n    const allItems = this.getAllOptions()\n    for (let i = 0; i < allItems.length; i++) {\n      if (allItems[i].value === value) return allItems[i]\n    }\n  }\n  findItemById(id: string) {\n    const allItems = this.getAllOptions()\n    for (let i = 0; i < allItems.length; i++) {\n      if (allItems[i].id === id) return allItems[i]\n    }\n  }\n  selectDefault() {\n    let walker: MenuOption | undefined = this.mode === 'select' ? this : undefined\n    while (walker) {\n      const next = walker.options.find(option => option.mode === 'select')\n      if (walker.mode === 'select' && next) {\n        walker = next\n      } else {\n        break\n      }\n    }\n    if (walker) walker.selected = true\n  }\n  selectedChanged() {\n    if (this.selected === false) {\n      this.unselectSuboptions()\n    }\n    this.dispatch('option-selected-changed', {option: this}, true)\n  }\n  selectedIDChanged() {\n    const option = this.findItemById(this.selectedID)\n    if (option) {\n      option.selected = true\n      this.dispatch('option-selected', {option: option}, false)\n    }\n  }\n  selectedIDImmediateChanged() {\n    if (this.selectedIDImmediate) {\n      this.selected = true\n      const option = this.options.find(option => option.id === this.selectedIDImmediate)\n      if (option) option.selected = true\n    }\n    this.updatePaths()\n  }\n  getSelectedIDImmediate() {\n    let selected = ''\n    for (let i = 0; i < this.options.length; i++) {\n      const item = this.options[i]\n      if (item.selected && item.id && item.mode === 'select') {\n        selected = item.id\n        break\n      }\n    }\n    return selected\n  }\n  setSelectedIDImmediate(id: string) {\n    // TODO Test and reconsider withInternalOperation\n    this.options.withInternalOperation(() => {\n      for (let i = 0; i < this.options.length; i++) {\n        const item = this.options[i]\n        if (item.id === id) {\n          item.selected = true\n        } else {\n          item.selected = false\n        }\n      }\n    })\n    this.options.dispatchMutation()\n  }\n  onOptionSelectedChanged(event: CustomEvent) {\n    // TODO: Instead of this check, use event.stopPropagation() once implemented in EventDispatcher.\n    if (this.options.indexOf(event.detail.option) === -1) return\n    if (event.detail.option === this) return\n    const selectedOption = event.detail.option\n    if (selectedOption.selected) {\n      for (let i = 0; i < this.options.length; i++) {\n        const option = this.options[i] as MenuOption\n        if (option !== selectedOption && option.mode === 'select' && selectedOption.mode === 'select') {\n          option.selected = false\n        }\n      }\n    }\n    const hasSelected = this.options.some(option => option.selected && option.mode === 'select')\n    if (hasSelected) {\n      // this.updatePaths();\n    } else {\n      this.setProperties({\n        selectedID: '',\n        selectedIDImmediate: '',\n        path: '',\n      })\n    }\n  }\n  unselectSuboptions() {\n    for (let i = 0; i < this.options.length; i++) {\n      const option = this.options[i]\n      if (option.mode === 'select') {\n        option.selected = false\n        option.unselectSuboptions()\n      }\n    }\n  }\n  updatePaths() {\n    const path: string[] = []\n    if (this.mode !== 'select' || !this.selected) {\n      this.path = ''\n      return\n    }\n\n    let selectedIDImmediate = this.getSelectedIDImmediate()\n    let walker = selectedIDImmediate ? this.options.find(option => option.mode === 'select' && option.selected && option.id === selectedIDImmediate) : undefined\n    if (!walker) return\n\n    while (walker) {\n      path.push(walker.id)\n      selectedIDImmediate = walker.getSelectedIDImmediate()\n      walker = selectedIDImmediate ? walker.options.find(option => option.mode === 'select' && option.selected && option.id === selectedIDImmediate) : undefined\n    }\n    this.path = path.join(',')\n  }\n  pathChanged() {\n    const path = this.path ? [...this.path.split(',')] : []\n    if (path.length) this.selectedID = path[path.length - 1]\n  }\n  optionsMutated(event: CustomEvent) {\n    // console.log('optionsMutated', this.id, this.options.length);\n    const selectedIDImmediate = this.getSelectedIDImmediate()\n    if (this.mode === 'select' && selectedIDImmediate && this.options.length) {\n      this.setProperties({\n        // selected: !!selectedIDImmediate,\n        selectedIDImmediate: selectedIDImmediate,\n      })\n    }\n    this.updatePaths()\n    this.dispatchMutation()\n  }\n  toJSON(): MenuOptionProps {\n    return {\n      id: this.id,\n      value: this.value,\n      label: this.label,\n      icon: this.icon,\n      hint: this.hint,\n      disabled: this.disabled,\n      // action: N/A for serialization\n      mode: this.mode,\n      options: this.options.map(option => option.toJSON()),\n    }\n  }\n  fromJSON(json: MenuOptionProps) {\n    this.setProperties({\n      id: json.id,\n      value: json.value ?? undefined,\n      label: json.label ?? json.id,\n      icon: json.icon ?? '',\n      hint: json.hint ?? '',\n      disabled: json.disabled ?? false,\n      // action: N/A for serialization\n      mode: json.mode ?? 'select',\n      selected: json.selected ?? false,\n      options: json.options?.map(option => new MenuOption(option)) ?? [],\n    })\n    return this\n  }\n  changed() {\n    debug: {\n      if (['select', 'toggle', 'none'].indexOf(this.mode) === -1) {\n        console.warn(`Unknown \"mode\" property \"${this.mode}\"!`, this)\n      }\n      if (this.selected && ['select', 'toggle'].indexOf(this.mode) === -1) {\n        console.warn('\"selected\" property is only valid when mode is \"select\" or \"toggle\"!', this)\n      }\n      if (!this.id) {\n        console.warn('\"id\" property is required!', this)\n      }\n      if (this.action && typeof this.action !== 'function') {\n        console.warn(`Invalid type \"${typeof this.action}\" of \"action\" property!`, this)\n      }\n    }\n  }\n  dispose() {\n    this.options.length = 0 // TODO: test magic!\n    super.dispose()\n  }\n}","import { IoOverlaySingleton } from '@io-gui/core'\nimport { IoString } from '@io-gui/inputs'\nimport { IoMenuItem } from '../elements/IoMenuItem.js'\nimport { IoMenuOptions } from '../elements/IoMenuOptions.js'\nimport { IoMenuTree } from '../elements/IoMenuTree.js'\n\n// TODO: Fix type remove any!\n\nexport type IoMenuElementType = IoMenuItem | IoMenuOptions | IoMenuTree | IoString\n\nconst MenuElementTags = ['io-menu-item', 'io-menu-options', 'io-menu-hamburger', 'io-option-select', 'io-string', 'io-menu-tree']\nconst MenuElementTagsSelector = MenuElementTags.join(', ')\n\nexport function getHoveredMenuItem(event: PointerEvent) {\n  const options = Array.from(IoOverlaySingleton.querySelectorAll('io-menu-item, io-menu-options')) as IoMenuItem[]\n  const hovered: IoMenuElementType[] = []\n  if (IoOverlaySingleton.expanded) {\n    for (let i = options.length; i--;) {\n      if (isPointerAboveIoMenuItem(event, options[i])) hovered.push(options[i])\n    }\n  }\n  if (hovered.length) {\n    hovered.sort((a: IoMenuElementType, b: IoMenuElementType) => {\n      if ((a as any).depth > (b as any).depth) return 1\n      if ((a as any).depth < (b as any).depth) return -1\n      if (a.localName === 'io-menu-item') return 1\n      if (b.localName === 'io-menu-item') return -1\n      return 0\n    })\n    const first = hovered[0]\n    const second = hovered[1]\n    if (first.localName === 'io-menu-item') {\n      return first\n    // NOTE: This effectively blocks picking io-menu-item behind io-menu-options.\n    } else if (first.localName === 'io-menu-options' && second) {\n      if (second.localName === 'io-menu-item' && (second as any).depth === (first as any).depth) {\n        return second\n      }\n    }\n  }\n  return undefined\n}\n\nexport function getMenuDescendants(element: IoMenuElementType) {\n  const descendants: IoMenuElementType[] = []\n  if ((element as any).$options) {\n    descendants.push((element as any).$options)\n    const options = (element as any).$options.querySelectorAll(MenuElementTagsSelector)\n    for (let i = options.length; i--;) {\n      descendants.push(options[i])\n      descendants.push(...getMenuDescendants(options[i]))\n    }\n  } else {\n    const options = Array.from(element.querySelectorAll(MenuElementTagsSelector)) as IoMenuElementType[]\n    for (let i = options.length; i--;) {\n      descendants.push(options[i])\n      descendants.push(...getMenuDescendants(options[i]))\n    }\n  }\n  return descendants\n}\n\nexport function getMenuAncestors(element: IoMenuElementType) {\n  const ancestors: IoMenuElementType[] = []\n  let option = element\n  while (option && (option as any).$parent) { // && !option.$parent._disposed\n    option = (option as any).$parent\n    if (option) ancestors.push(option)\n  }\n  return ancestors\n}\n\nexport function getMenuChildren(element: IoMenuElementType) {\n  const children: IoMenuElementType[] = []\n  const options = Array.from(element.querySelectorAll(MenuElementTagsSelector)) as IoMenuElementType[]\n  for (let i = options.length; i--;) {\n    children.push(options[i])\n  }\n  if ((element as any).$options) {\n    children.push((element as any).$options)\n    const options = (element as any).$options.querySelectorAll(MenuElementTagsSelector)\n    for (let i = options.length; i--;) {\n      children.push(options[i])\n    }\n  }\n  return children\n}\n\nexport function getMenuSiblings(element: IoMenuItem) {\n  const siblings: IoMenuItem[] = []\n  const parent = element.parentElement\n  if (parent) {\n    siblings.push(...Array.from(parent.querySelectorAll(MenuElementTagsSelector)) as IoMenuItem[])\n  }\n  return siblings\n}\n\nexport function getMenuRoot(element: IoMenuElementType) {\n  let root: IoMenuElementType = element\n  while (root && (root as any).$parent) {\n    root = (root as any).$parent\n  }\n  return root\n}\n\nexport function isPointerAboveIoMenuItem(event: PointerEvent, element: IoMenuElementType) {\n  if (MenuElementTags.indexOf(element.localName) !== -1) {\n    if (!(element as any).disabled) {\n      if (element.parentElement !== IoOverlaySingleton && (element.parentElement as any)!.expanded) {\n        const r = element.getBoundingClientRect()\n        const x = event.clientX\n        const y = event.clientY\n        const hovered = (r.top <= y && r.bottom >= y && r.left <= x && r.right >= x )\n        return hovered\n      }\n    }\n  }\n  return false\n}","import { MenuOption } from '../nodes/MenuOption.js'\n\nfunction matchMenuOption(option: MenuOption, search: string) {\n  if (option.options.length) return false\n  if (option.value !== undefined && String(option.value).toLowerCase().indexOf(search) !== -1) return true\n  if (option.label && option.label.toLowerCase().indexOf(search) !== -1) return true\n  if (option.hint && option.hint.toLowerCase().indexOf(search) !== -1) return true\n  return false\n}\n\nexport function searchMenuOption(option: MenuOption, search: string, depth = 5, d = 0) {\n  search = search.toLowerCase()\n  const subitems: MenuOption[] = []\n  if (d <= depth) for (let i = 0; i < option.options.length; i++) {\n    if (matchMenuOption(option.options[i], search)) {\n      subitems.push(option.options[i])\n    }\n    if (option.options[i].options.length) {\n      subitems.push(...searchMenuOption(option.options[i], search, depth, d + 1))\n    }\n  }\n  return subitems\n}","import { Register, IoElement, ReactiveProperty, VDOMElement, IoOverlaySingleton as Overlay, NudgeDirection, IoElementProps, WithBinding, Property, nudge, ListenerDefinition, span } from '@io-gui/core'\nimport { ioField, ioString } from '@io-gui/inputs'\nimport { MenuOption } from '../nodes/MenuOption.js'\nimport { ioMenuItem, IoMenuItem } from './IoMenuItem.js'\nimport { IoContextMenu } from './IoContextMenu.js'\nimport { getMenuDescendants, getMenuSiblings } from '../utils/MenuDOMUtils.js'\nimport { searchMenuOption } from '../utils/MenuNodeUtils.js'\n\n// const rects = new WeakMap();\n\n// TODO: improve focusto nav and in-layer navigation.\n\nexport type IoMenuOptionsProps = IoElementProps & {\n  option?: MenuOption\n  expanded?: WithBinding<boolean>\n  horizontal?: boolean\n  searchable?: boolean\n  search?: WithBinding<string>\n  direction?: NudgeDirection\n  depth?: number\n  widget?: VDOMElement | null\n  $parent?: IoMenuItem | IoContextMenu\n}\n\n/**\n * It generates a list of `IoMenuItem` elements from `options` property. If `horizontal` property is set, menu options are displayed in horizontal direction.\n **/\n@Register\nexport class IoMenuOptions extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: calc(var(--io_borderRadius) + var(--io_spacing2));\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: calc(var(--io_spacing) + var(--io_borderWidth));\n      transition: opacity 0.3s ease-in-out;\n      @apply --unselectable;\n    }\n    :host[horizontal] {\n      padding: var(--io_spacing) 0;\n      flex-direction: row;\n      align-self: stretch;\n    }\n    :host[inoverlay] {\n      overflow-y: auto;\n      box-shadow: 1px 1px 16px var(--io_shadowColor),\n                  1px 1px 8px var(--io_shadowColor), \n                  1px 1px 4px var(--io_shadowColor);\n    }\n    :host[inoverlay]:not([expanded]) {\n      visibility: hidden;\n      opacity: 0;\n    }\n    :host > io-menu-item[hidden] ~ span.divider {\n      display: none;\n    }\n    :host > span.divider {\n      flex: 0 0 0;\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n      margin: var(--io_spacing) 0;\n      opacity: 0.1;\n    }\n    :host[horizontal] > span.divider {\n      margin: 0 var(--io_spacing);\n    }\n    :host[horizontal] > io-menu-item > .hint {\n      display: none;\n    }\n    :host:not([horizontal]) > #search {\n      margin: var(--io_spacing);\n      margin-top: 0;\n    }\n    :host[horizontal] > #search {\n      margin: 0 var(--io_spacing);\n      flex: 0 0 10em;\n    }\n    `\n  }\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare expanded: boolean\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare horizontal: boolean\n\n  @ReactiveProperty(false)\n  declare searchable: boolean\n\n  @ReactiveProperty('')\n  declare search: string\n\n  @ReactiveProperty({value: 'none', reflect: true})\n  declare direction: NudgeDirection\n\n  @ReactiveProperty(100)\n  declare depth: number\n\n  @ReactiveProperty({value: '', reflect: true})\n  declare overflow: string\n\n  @ReactiveProperty(null)\n  declare widget: VDOMElement | null\n\n  @Property()\n  declare $parent?: IoMenuItem\n\n  @Property('listbox')\n  declare role: string\n\n  static get Listeners() {\n    return {\n      'touchstart': ['stopPropagation'] as ListenerDefinition,\n      'io-focus-to': 'onIoFocusTo',\n    }\n  }\n  get inoverlay() {\n    return Overlay.contains(this.parentElement)\n  }\n  constructor(args: IoMenuOptionsProps = {}) { super(args) }\n\n  stopPropagation(event: TouchEvent) {\n    if (this.inoverlay) {\n      // TODO: Prevent pull-down-to-refresh on scrollable menus.\n      // Stops overlay from capturing touch events\n      event.stopPropagation()\n    }\n  }\n  connectedCallback() {\n    super.connectedCallback()\n    if (this.inoverlay) {\n      this.setAttribute('inoverlay', 'true')\n    }\n  }\n  onIoFocusTo(event: CustomEvent) {\n    const source = event.detail.source\n    const cmd = event.detail.command\n    const siblings = getMenuSiblings(source)\n    const index = siblings.indexOf(source)\n\n    const inoverlay = this.inoverlay\n\n    let parentIsAbove = false\n    let parentIsBelow = false\n    let parentIsLeft = false\n    let parentIsRight = false\n\n    if (this.$parent) {\n      const rect = this.getBoundingClientRect()\n      const parentRect = this.$parent.getBoundingClientRect()\n      parentIsAbove = rect.top > parentRect.top\n      parentIsBelow = rect.bottom < parentRect.bottom\n      parentIsLeft = rect.left > parentRect.left\n      parentIsRight = rect.right < parentRect.right\n    }\n\n    let cmdOverride = ''\n\n    if (this.horizontal) {\n      if (cmd === 'ArrowRight' && inoverlay) cmdOverride = 'Next'\n      if (cmd === 'ArrowLeft' && inoverlay) cmdOverride = 'Prev'\n      if (cmd === 'ArrowUp' && parentIsAbove) cmdOverride = 'Out'\n      if (cmd === 'ArrowDown' && parentIsBelow) cmdOverride = 'Out'\n    } else {\n      if (cmd === 'ArrowDown' && inoverlay) cmdOverride = 'Next'\n      if (cmd === 'ArrowUp' && inoverlay) cmdOverride = 'Prev'\n      if (cmd === 'ArrowLeft' && parentIsLeft) cmdOverride = 'Out'\n      if (cmd === 'ArrowRight' && parentIsRight) cmdOverride = 'Out'\n    }\n    if (cmd === 'Tab' && inoverlay) cmdOverride = 'Next'\n\n    if (cmdOverride) {\n      if (cmdOverride === 'Next') {\n        siblings[(index + 1) % siblings.length].focus()\n      } else if (cmdOverride === 'Prev') {\n        siblings[(index - 1 + siblings.length) % siblings.length].focus()\n      } else if (cmdOverride === 'Out') {\n        if (this.$parent) this.$parent.focus()\n      }\n      event.stopPropagation()\n    }\n  }\n  collapse() {\n    const optionWasFocused = this.contains(document.activeElement)\n    const searchHadInput = this.searchable && !!this.search\n    getMenuDescendants(this).forEach(descendant => {\n      (descendant as any).expanded = false\n    })\n    this.expanded = false\n    if (searchHadInput && optionWasFocused && !this.inoverlay) {\n      this.search = ''\n      this.$.search.focus()\n    }\n  }\n  expandedChanged() {\n    if (this.expanded) {\n      if (this.inoverlay) {\n        this.debounce(this.onExpandInOverlay)\n      }\n    } else {\n      this.style.top = ''\n      this.style.height = ''\n      this.scrollTop = 0\n      this.search = ''\n    }\n  }\n  searchChanged() {\n    // TODO: focus drifts when filtered option is clicked\n    if (this.inoverlay && this.$parent) {\n      this.debounce(this.onExpandInOverlay)\n    }\n  }\n  // TODO: Move functionality to Overlay\n  onExpandInOverlay() {\n    if (this.$parent) {\n      nudge(this, this.$parent, this.direction, true)\n    }\n  }\n  changed() {\n    const vChildren: VDOMElement[] = this.widget ? [this.widget] : []\n    if (this.searchable) {\n      vChildren.push(ioString({\n        id: 'search',\n        role: 'search',\n        value: this.bind('search'),\n        placeholder: 'Search',\n        live: true\n      }))\n    }\n    if (this.search) {\n      const filteredItems = searchMenuOption(this.option, this.search, this.depth)\n      if (filteredItems.length === 0) {\n        vChildren.push(ioField({label: 'No matches'}))\n      } else {\n        for (let i = 0; i < filteredItems.length; i++) {\n          vChildren.push(ioMenuItem({option: filteredItems[i], depth: 0}))\n          if (i < filteredItems.length - 1) {\n            vChildren.push({tag: 'span', props: {class: 'divider'}})\n          }\n        }\n      }\n    } else {\n      let direction: 'left' | 'right' | 'up' | 'down' = this.horizontal ? 'down' : 'right'\n      if (this.horizontal && this.direction === 'up') {\n        direction = 'up'\n      }\n      for (let i = 0; i < this.option.options.length; i++) {\n        vChildren.push(ioMenuItem({\n          option: this.option.options[i],\n          direction: direction,\n          $parent: this,\n          depth: this.depth\n        }))\n        if (i < this.option.options.length - 1) {\n          vChildren.push(span({class: 'divider'}))\n        }\n      }\n    }\n    this.render(vChildren)\n  }\n}\nexport const ioMenuOptions = function(arg0?: IoMenuOptionsProps) {\n  return IoMenuOptions.vConstructor(arg0)\n}","import { Register, ReactiveProperty, Property, IoOverlaySingleton as Overlay, span, WithBinding, NudgeDirection } from '@io-gui/core'\nimport { IoField, IoFieldProps } from '@io-gui/inputs'\nimport { ioIcon } from '@io-gui/icons'\nimport { IoMenuElementType, getMenuRoot, getMenuAncestors, getMenuDescendants, getMenuSiblings, getHoveredMenuItem } from '../utils/MenuDOMUtils.js'\nimport { MenuOption } from '../nodes/MenuOption.js'\nimport { IoMenuOptions } from './IoMenuOptions.js'\nimport { IoMenuTree } from './IoMenuTree.js'\n\nlet timeoutOpen = -1\n\nlet hovered: IoMenuElementType | undefined\nlet prevHovered: IoMenuElementType | undefined\n\nexport function onOverlayPointerdown(event: PointerEvent) {\n  hovered = undefined\n  prevHovered = undefined\n}\n\nexport function onOverlayPointermove(event: PointerEvent) {\n  clearTimeout(timeoutOpen)\n  hovered = getHoveredMenuItem(event)\n  if (hovered && hovered !== prevHovered) {\n    const v = Math.abs(event.movementY) - Math.abs(event.movementX)\n    const h = (hovered.parentElement as IoMenuOptions)?.horizontal\n    if (prevHovered?.parentElement !== hovered.parentElement) {\n      prevHovered = hovered\n      hovered.focus()\n    } else if (h ? v < -0.25 : v > 0.25) {\n      prevHovered = hovered\n      hovered.focus()\n    } else {\n      timeoutOpen = setTimeout(() => {\n        prevHovered = hovered\n        if (hovered) hovered.focus()\n      }, 250)\n    }\n  }\n}\n\nexport function onOverlayPointeup(event: PointerEvent) {\n  if (hovered) (hovered as any).onClick()\n}\n\nOverlay.addEventListener('pointermove', onOverlayPointermove)\n\nexport type IoMenuItemProps = IoFieldProps & {\n  option?: MenuOption\n  label?: string\n  expanded?: WithBinding<boolean>\n  direction?: NudgeDirection\n  depth?: number\n  $parent?: IoMenuOptions | IoMenuTree\n}\n\n/**\n * It displays `option.icon`, `option.label` and `option.hint` property and it creates expandable `IoMenuOptions` from the `option.options` array. Options are expand in the direction specified by `direction` property. If `selectable` property is set, selecting an option sets its `value` to the entire menu tree and `selected` atribute is set on menu options whose `option.value` matches selected value.\n **/\n\n// TODO: fix and improve keyboard navigation in all cases.\n@Register\nexport class IoMenuItem extends IoField {\n  static get Style() {\n    return /* css */`\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n      :host > .label {\n        flex: 1 1 auto;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hint {\n        flex: 0 1 auto;\n        opacity: 0.25;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hasmore {\n        opacity: 0.5;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @Property('')\n  declare label: string\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare expanded: boolean\n\n  @ReactiveProperty({value: 'right', reflect: true})\n  declare direction: NudgeDirection\n\n  @ReactiveProperty({value: 1000, reflect: true})\n  declare depth: number\n\n  @Property('false')\n  declare contentEditable: string\n\n  @Property()\n  declare $parent?: IoMenuOptions | IoMenuTree\n\n  declare $options?: IoMenuOptions\n\n  static get Listeners(): any {\n    return {\n      'click': 'preventDefault',\n      'focus': 'onFocus',\n      'blur': 'onBlur',\n    }\n  }\n\n  constructor(args: IoMenuItemProps = {}) { super(args) }\n\n  preventDefault(event: Event) {\n    event.stopPropagation()\n    event.preventDefault()\n  }\n  get hasmore() {\n    return this.option.options.length && this.depth > 0\n  }\n  get inoverlay() {\n    return Overlay.contains(this.parentElement?.parentElement as HTMLElement)\n  }\n  connectedCallback() {\n    super.connectedCallback()\n    if (this.$options) Overlay.appendChild(this.$options as HTMLElement)\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    if (this.$options) Overlay.removeChild(this.$options as HTMLElement)\n  }\n  onClick() {\n    const o = this.option\n    if (this.hasmore) {\n      if (!this.expanded) this.expanded = true\n    } else if (o.mode === 'toggle') {\n      o.selected = !o.selected\n    } else {\n      if (o.action) {\n        o.action.apply(null, [o.value])\n        this.collapseRoot()\n      }\n      if (o.mode === 'select') {\n        if (o.options.length && this.depth <= 0) {\n          o.selectDefault()\n        } else {\n          o.selected = true\n          // TODO: figure out OptionSelect value input with NodeArray options\n          // o.dispatch('option-selected', {option: o}, true);\n        }\n        this.collapseRoot()\n      }\n    }\n    getMenuRoot(this).dispatch('io-menu-option-clicked', {option: o}, true)\n  }\n  onPointerdown(event: PointerEvent) {\n    super.onPointerdown(event)\n    if (event.pointerType !== 'touch') {\n      this.setPointerCapture(event.pointerId)\n      event.stopPropagation()\n      if (this.hasmore) this.expanded = true\n      onOverlayPointerdown.call(this, event)\n    }\n  }\n  onPointermove(event: PointerEvent) {\n    event.stopPropagation()\n    if (event.pointerType !== 'touch') {\n      onOverlayPointermove.call(this, event)\n    }\n  }\n  onPointerup(event: PointerEvent) {\n    super.onPointerup(event)\n    event.stopPropagation()\n    this.onPointerupAction(event)\n  }\n  onPointerupAction(event: PointerEvent) {\n    this.onClick()\n  }\n  onFocus(event: FocusEvent) {\n    super.onFocus(event)\n    if (this.hasmore && this.inoverlay) this.expanded = true\n    const $allitems = getMenuDescendants(getMenuRoot(this))\n    const $ancestoritems = getMenuAncestors(this)\n    for (let i = $allitems.length; i--;) {\n      if ($allitems[i] !== this && $allitems[i] !== this.$options && $ancestoritems.indexOf($allitems[i]) === -1 && ($allitems[i] as any).expanded) {\n        ($allitems[i] as any).collapse()\n      }\n    }\n  }\n  onBlur(event: FocusEvent) {\n    super.onBlur(event)\n    this.debounce(this.onBlurDebounced)\n  }\n  onBlurDebounced() {\n    if (this._disposed) return\n    // TODO: rewrite this.\n    const descendants = getMenuDescendants(this)\n    const siblings = getMenuSiblings(this)\n    const ancestors = getMenuAncestors(this)\n    const descendantIsFocused = descendants.some(descendant => descendant === document.activeElement as unknown as IoMenuElementType)\n    const siblingIsFocused = siblings.some(sibling => sibling === document.activeElement as unknown as IoMenuElementType)\n    const ancestorIsFocused = ancestors.some(ancestor => ancestor === document.activeElement as unknown as IoMenuElementType)\n    const nothingIsFocused = document.activeElement === document.body\n\n    const fucusLeftOverlay = !Overlay.contains(document.activeElement)\n\n    if (descendantIsFocused || nothingIsFocused) return\n    if (ancestorIsFocused || siblingIsFocused) {\n      this.collapse()\n    } else if (fucusLeftOverlay) {\n      this.collapseRoot()\n    }\n  }\n  onKeydown(event: KeyboardEvent) {\n    const inoverlay = this.inoverlay\n    let direction = this.direction\n\n    // Determine relative position of expanded options. If they are nudged to the opposite direction, flip direction.\n    let optionsAreAbove = false\n    let optionsAreBelow = false\n    let optionsAreLeft = false\n    let optionsAreRight = false\n    if (this.expanded && this.$options) {\n      const rect = this.getBoundingClientRect()\n      const optionsRect = this.$options.getBoundingClientRect()\n      optionsAreAbove = rect.top > optionsRect.top\n      optionsAreBelow = rect.bottom < optionsRect.bottom\n      optionsAreLeft = rect.left > optionsRect.left\n      optionsAreRight = rect.right < optionsRect.right\n    }\n    // Flip direction if options are nudged to the opposite direction.\n    if (direction === 'up' && optionsAreBelow) direction = 'down'\n    if (direction === 'down' && optionsAreAbove) direction = 'up'\n    if (direction === 'left' && optionsAreRight) direction = 'right'\n    if (direction === 'right' && optionsAreLeft) direction = 'left'\n\n    // TODO: types!\n    let cmd = null\n\n    // TODO: 'Home', 'End', 'PageUp', 'PageDown' keys should be handled.\n    if (event.key === 'Enter' || event.key === ' ') {\n      if (this.hasmore) {\n        cmd = 'In'\n      } else {\n        event.preventDefault()\n        this.onClick()\n        return\n      }\n    } else if (event.key === 'Backspace') {\n      cmd = 'Out'\n    } else if (event.key === 'Escape') {\n      cmd = 'Collapse'\n    } else if (event.key === 'ArrowLeft' && (inoverlay || this.expanded)) {\n      if (this.hasmore && direction === 'left') {\n        cmd = 'In'\n      } else if (direction === 'right') {\n        cmd = 'Out'\n      }\n    } else if (event.key === 'ArrowRight' && (inoverlay || this.expanded)) {\n      if (this.hasmore && direction === 'right') {\n        cmd = 'In'\n      } else if (direction === 'left') {\n        cmd = 'Out'\n      }\n    } else if (event.key === 'ArrowUp' && (inoverlay || this.expanded)) {\n      if (this.hasmore && direction === 'up') {\n        cmd = 'In'\n      } else if (direction === 'down') {\n        cmd = 'Out'\n      }\n    } else if (event.key === 'ArrowDown' && (inoverlay || this.expanded)) {\n      if (this.hasmore && direction === 'down') {\n        cmd = 'In'\n      } else if (direction === 'up') {\n        cmd = 'Out'\n      }\n    }\n\n    if (cmd) {\n      event.preventDefault()\n      switch (cmd) {\n        case 'Collapse':\n          this.collapseRoot()\n          break\n        case 'In':\n          if (this.hasmore) this.expanded = true\n          if (this.$options && this.$options.children.length) {\n            const option = this.$options!.querySelector('[selected]') as IoMenuItem\n            if (option) option.focus()\n            else (this.$options!.children[0] as IoMenuItem).focus()\n          }\n          break\n        case 'Out':\n          if (this.$parent && this.$parent.$parent) {\n            this.$parent.$parent.focus()\n            this.$parent.$parent.collapse()\n          }\n          break\n        default:\n          break\n      }\n    } else {\n      super.onKeydown(event)\n    }\n  }\n  collapse() {\n    getMenuDescendants(this).forEach(descendant => {\n      (descendant as any).expanded = false\n    })\n    this.expanded = false\n  }\n  collapseRoot() {\n    (getMenuRoot(this) as any).collapse()\n  }\n  optionChanged() {\n    this.setProperties({\n      selected: this.option.selected,\n      disabled: this.option.disabled,\n    })\n    this.initOptions()\n  }\n  optionMutated() {\n    this.setProperties({\n      selected: this.option.selected,\n      disabled: this.option.disabled,\n    })\n    this.changed()\n  }\n  initOptions() {\n    if (this.option.options && this.depth > 0) {\n      if (this.$options === undefined) {\n        this.$options = new IoMenuOptions({\n          expanded: this.bind('expanded'),\n          depth: this.depth - 1,\n          option: this.option,\n          direction: this.direction,\n          $parent: this,\n        })\n      } else {\n        this.$options.option = this.option\n      }\n    }\n  }\n  changed() {\n    const icon = this.icon || this.option.icon\n    const label = this.label || this.option.label\n\n    this.render([\n      this.hasmore && this.direction === 'left' ? ioIcon({value: 'io:triangle_left', class: 'hasmore'}) : null,\n      this.hasmore && this.direction === 'up' ? ioIcon({value: 'io:triangle_up', class: 'hasmore'}) : null,\n      icon ? ioIcon({value: icon}) : null,\n      label ? span({class: 'label'}, label) : null,\n      this.option.hint ? span({class: 'hint'}, this.option.hint) : null,\n      this.hasmore && this.direction === 'right' ? ioIcon({value: 'io:triangle_right', class: 'hasmore'}) : null,\n      this.hasmore && this.direction === 'down' ? ioIcon({value: 'io:triangle_down', class: 'hasmore'}) : null,\n    ])\n  }\n  dispose() {\n    super.dispose()\n    delete this.$options\n  }\n}\nexport const ioMenuItem = function(arg0?: IoMenuItemProps) {\n  return IoMenuItem.vConstructor(arg0)\n}\n\n\n\n\n","import { NudgeDirection, ReactiveProperty, Register } from '@io-gui/core'\nimport { ioIcon } from '@io-gui/icons'\nimport { IoMenuItem } from './IoMenuItem.js'\n\n@Register\nexport class IoMenuHamburger extends IoMenuItem {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex-shrink: 0;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n    `\n  }\n\n  @ReactiveProperty({value: 'down', reflect: true})\n  declare direction: NudgeDirection\n\n  changed() {\n    this.render([ioIcon({value: 'io:hamburger'})])\n  }\n}\nexport const ioMenuHamburger = IoMenuHamburger.vConstructor","import { IoElement, Register, ReactiveProperty, IoElementProps, WithBinding, Property } from '@io-gui/core'\nimport { ioBoolean } from '@io-gui/inputs'\nimport { MenuOption } from '../nodes/MenuOption.js'\nimport { ioMenuTree } from './IoMenuTree.js'\n\nexport type IoMenuTreeBranchProps = IoElementProps & {\n  depth?: number\n  option?: MenuOption\n  expanded?: WithBinding<boolean>\n}\n/**\n * An element with collapsible content.\n * When clicked or activated by space/enter key, it toggles the visibility of the child elements defined as `elements` property.\n **/\n\n@Register\nexport class IoMenuTreeBranch extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n    }\n    :host > io-boolean {\n      overflow: visible;\n      padding-left: var(--io_spacing3);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-boolean:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: \"▸\"\n    }\n    :host > io-boolean[value]:before {\n      content: \"▾\"\n    }\n    :host > io-menu-tree {\n      background: transparent;\n      border: none;\n      border-left: var(--io_border);\n      border-color: var(--io_colorLight);\n      margin-left: var(--io_spacing5);\n    }\n    `\n  }\n\n  @ReactiveProperty(Number)\n  declare depth: number\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @ReactiveProperty({value: false, type: Boolean, reflect: true})\n  declare expanded: boolean\n\n  @Property('region')\n  declare role: string\n\n  optionMutated() {\n    if (this.option.selected) this.expanded = this.option.selected\n  }\n\n  changed() {\n    this.render([\n      ioBoolean({icon: this.option.icon, true: this.option.label, false: this.option.label, value: this.bind('expanded')}),\n      this.expanded ? ioMenuTree({option: this.option, depth: this.depth + 1}) : null,\n    ])\n  }\n}\nexport const ioMenuTreeBranch = function(arg0?: IoMenuTreeBranchProps) {\n  return IoMenuTreeBranch.vConstructor(arg0)\n}","import { Register, IoElement, ReactiveProperty, VDOMElement, Storage as $, IoElementProps, WithBinding, Property } from '@io-gui/core'\nimport { ioField, ioString } from '@io-gui/inputs'\nimport { MenuOption } from '../nodes/MenuOption.js'\nimport { ioMenuItem, IoMenuItem } from './IoMenuItem.js'\nimport { ioMenuTreeBranch } from './IoMenuTreeBranch.js'\nimport { searchMenuOption } from '../utils/MenuNodeUtils.js'\n\nfunction genObjectStorageID(object: Record<string, any>) {\n  const string = JSON.stringify(object)\n  let hash = 0\n  for (let i = 0; i < string.length; i++) {\n    hash = Math.imul(31, hash) + string.charCodeAt(i) | 0\n  }\n  return 'io-local-state-' + String(hash)\n}\n\nfunction addMenuOptionsOrTreeBranches(option: MenuOption, depth: number, d = 0) {\n  const elements: VDOMElement[] = []\n  if (d <= depth) for (let i = 0; i < option.options.length; i++) {\n    const subOption = option.options[i] as MenuOption\n    if (subOption.options.length) {\n      const collapsibleState = $({value: false, storage: 'local', key: genObjectStorageID(subOption)})\n      if (subOption.selected === true) collapsibleState.value = true\n      elements.push(ioMenuTreeBranch({option: subOption, depth: d, expanded: collapsibleState}))\n    } else {\n      elements.push(ioMenuItem({option: subOption, depth: d}))\n    }\n  }\n  return elements\n}\n\nexport type IoMenuTreeProps = IoElementProps & {\n  option?: MenuOption\n  searchable?: boolean\n  search?: WithBinding<string>\n  depth?: number\n  widget?: VDOMElement | null\n}\n\n@Register\nexport class IoMenuTree extends IoElement {\n\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: var(--io_borderRadius);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: var(--io_spacing);\n      @apply --unselectable;\n    }\n    :host io-menu-tree {\n      padding: 0 !important;\n    }\n    :host > io-menu-item {\n      padding-left: var(--io_spacing);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-menu-item[selected] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: \"\"\n    }\n    `\n  }\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @ReactiveProperty({value: false, type: Boolean})\n  declare searchable: boolean\n\n  @ReactiveProperty({value: '', type: String})\n  declare search: string\n\n  @ReactiveProperty({value: Infinity, type: Number})\n  declare depth: number\n\n  @ReactiveProperty(null)\n  declare widget: VDOMElement | null\n\n  @Property()\n  declare $parent?: IoMenuItem\n\n  @Property('listbox')\n  declare role: string\n\n  constructor(args: IoMenuTreeProps = {}) { super(args) }\n\n  changed() {\n    const vChildren: VDOMElement[] = this.widget ? [this.widget] : []\n\n    if (this.searchable) {\n      vChildren.push(ioString({\n        id: 'search',\n        role: 'search',\n        value: this.bind('search'),\n        placeholder: 'Search',\n        live: true\n      }))\n    }\n\n    if (this.search) {\n      const filteredItems = searchMenuOption(this.option, this.search, this.depth)\n      if (filteredItems.length === 0) {\n        vChildren.push(ioField({label: 'No matches'}))\n      } else for (let i = 0; i < filteredItems.length; i++) {\n        vChildren.push(ioMenuItem({option: filteredItems[i], depth: 0}))\n      }\n\n    } else {\n      vChildren.push(...addMenuOptionsOrTreeBranches(this.option, this.depth))\n    }\n\n    this.render(vChildren)\n  }\n}\nexport const ioMenuTree = function(arg0?: IoMenuTreeProps) {\n  return IoMenuTree.vConstructor(arg0)\n}","import { Register, IoElement, Change, ReactiveProperty, IoElementProps, WithBinding, Property } from '@io-gui/core'\nimport { MenuOption } from '../nodes/MenuOption.js'\nimport { ioMenuItem } from './IoMenuItem.js'\n\nexport type SelectBy = 'value' | 'id'\n\nexport type IoOptionSelectProps = IoElementProps & {\n  option: MenuOption\n  value?: WithBinding<any>\n  label?: string\n  icon?: string\n  selectBy?: SelectBy\n}\n\n/**\n * Option select element. Similar to `IoMenuItem`, except it is displayed as a button and uses `options` property instead of ~~`option.options`~~  and it is `selectable` by default. It displays selected `value` or `label` followed by the `â–¾` character.\n * When clicked or activated by space/enter key, it expands a menu with selectable options.\n **/\n@Register\nexport class IoOptionSelect extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: inline-block;\n      text-align: center;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      background-image: var(--io_gradientOutset);\n      text-align: left;\n    }\n    :host > io-menu-item {\n      margin: calc(-1 * var(--io_borderWidth));\n      background-color: transparent !important;\n      border-color: transparent !important;\n    }\n    `\n  }\n\n  @ReactiveProperty({value: undefined})\n  declare value: any\n\n  @ReactiveProperty('')\n  declare label: string\n\n  @ReactiveProperty('')\n  declare icon: string\n\n  // TODO: consider deprecating\n  @ReactiveProperty('value')\n  declare selectBy: SelectBy\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @Property('button')\n  declare role: string\n\n  constructor(args: IoOptionSelectProps) {\n    super(args)\n  }\n\n  // TODO: Consider triggering inputValue() only by user-input!\n  onOptionSelected(event: CustomEvent) {\n    if (this._disposed) return\n    if (this.selectBy === 'value') {\n      this.inputValue(event.detail.option.value)\n    } else if (this.selectBy === 'id') {\n      this.inputValue(event.detail.option.id)\n    }\n  }\n  inputValue(value: any) {\n    if (this.value !== value || typeof this.value === 'object') {\n      const oldValue = this.value\n      this.setProperty('value', value)\n      this.dispatch('value-input', {value: value, oldValue: oldValue}, false)\n    }\n  }\n  optionChanged(change: Change) {\n    if (change.oldValue) {\n      change.oldValue.removeEventListener('option-selected', this.onOptionSelected)\n    }\n    if (change.value) {\n      change.value.addEventListener('option-selected', this.onOptionSelected)\n    }\n  }\n  changed() {\n    let selectedItem\n    if (this.selectBy === 'value') {\n      selectedItem = this.option.findItemByValue(this.value)\n    } else if (this.selectBy === 'id') {\n      selectedItem = this.option.findItemById(this.value)\n    }\n    const label = selectedItem ? selectedItem.label : this.label || String(this.value)\n    this.render([ioMenuItem({option: this.option, label: label, icon: this.icon, direction: 'down'})])\n  }\n}\nexport const ioOptionSelect = function(arg0: IoOptionSelectProps) {\n  return IoOptionSelect.vConstructor(arg0)\n}","import { Register, IoElement, ReactiveProperty, IoOverlaySingleton as Overlay, IoElementProps, WithBinding } from '@io-gui/core'\nimport { IoMenuOptions } from './IoMenuOptions.js'\nimport { onOverlayPointerdown, onOverlayPointermove, onOverlayPointeup } from './IoMenuItem.js'\nimport { MenuOption } from '../nodes/MenuOption.js'\n\nexport type IoContextMenuProps = IoElementProps & {\n  option: MenuOption\n  expanded?: WithBinding<boolean>\n  button?: number\n}\n\n/**\n * An invisible element that inserts a floating menu when its `parentElement` is clicked. Menu position is set by the pointer by default but it can be configured to expand to the side of the parent element by setting the `position` property. Default `button` property for menu expansion is `0` (left mouse button), but it can be configured for other buttons. You can have multiple `IoContextMenu` instances under the same `parentElement` as long as the `button` properties are different.\n **/\n@Register\nexport class IoContextMenu extends IoElement {\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare expanded: boolean\n\n  @ReactiveProperty(0)\n  declare button: number\n\n  declare $options: IoMenuOptions\n  declare _contextTimeout: number\n\n  static get ReactiveProperties(): any {\n    return {\n      $options: null,\n    }\n  }\n\n  constructor(args: IoContextMenuProps) {\n    super(args)\n    this.$options = new IoMenuOptions({\n      expanded: this.bind('expanded'),\n      option: this.option,\n      $parent: this,\n    })\n  }\n\n  init() {\n    this.collapse = this.collapse.bind(this)\n  }\n\n  optionChanged() {\n    if (this.$options) this.$options.option = this.option\n  }\n  connectedCallback() {\n    super.connectedCallback()\n    Overlay.appendChild(this.$options as HTMLElement)\n    this.parentElement!.addEventListener('pointerdown', this.onPointerdown)\n    this.parentElement!.addEventListener('click', (this as any).onClick)\n    this.parentElement!.addEventListener('contextmenu', this.onContextmenu)\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    Overlay.removeChild(this.$options as HTMLElement)\n    this.parentElement!.removeEventListener('pointerdown', this.onPointerdown)\n    this.parentElement!.removeEventListener('click', (this as any).onClick)\n    this.parentElement!.removeEventListener('contextmenu', this.onContextmenu)\n  }\n  getBoundingClientRect() {\n    return this.parentElement!.getBoundingClientRect()\n  }\n  onContextmenu(event: MouseEvent) {\n    if (this.button === 2) event.preventDefault()\n  }\n  onPointerdown(event: PointerEvent) {\n    event.stopPropagation()\n\n    this.$options.style.left = `${event.clientX}px`\n    this.$options.style.top = `${event.clientY}px`\n\n    this.parentElement!.addEventListener('pointermove', this.onPointermove)\n    this.parentElement!.addEventListener('pointerleave', this.onPointerleave)\n    this.parentElement!.addEventListener('pointerup', this.onPointerup)\n\n    clearTimeout(this._contextTimeout)\n    if (event.pointerType !== 'touch') {\n      if (event.button === this.button) {\n        this.setPointerCapture(event.pointerId)\n        this.expanded = true\n        // TODO: keyboard focus navigation\n      }\n    } else {\n      // iOS Safari contextmenu event emulation.\n      event.preventDefault()\n      this._contextTimeout = setTimeout(() => {\n        this.setPointerCapture(event.pointerId)\n        this.expanded = true\n        // TODO: keyboard focus navigation\n      }, 150)\n    }\n    onOverlayPointerdown.call(this, event)\n  }\n  onPointermove(event: PointerEvent) {\n    event.stopPropagation()\n    clearTimeout(this._contextTimeout)\n    if (event.pointerType === 'touch') {\n      // Let touch scroll the document.\n      if (!this.expanded) return\n    }\n    onOverlayPointermove.call(this, event)\n  }\n  onPointerup(event: PointerEvent) {\n    clearTimeout(this._contextTimeout)\n    this.releasePointerCapture(event.pointerId)\n    this.parentElement!.removeEventListener('pointermove', this.onPointermove)\n    this.parentElement!.removeEventListener('pointerleave', this.onPointerleave)\n    this.parentElement!.removeEventListener('pointerup', this.onPointerup)\n    onOverlayPointeup.call(this, event)\n  }\n  onPointerleave(event: PointerEvent) {\n    this.releasePointerCapture(event.pointerId)\n    this.parentElement!.removeEventListener('pointermove', this.onPointermove)\n    this.parentElement!.removeEventListener('pointerleave', this.onPointerleave)\n    this.parentElement!.removeEventListener('pointerup', this.onPointerup)\n  }\n  collapse() {\n    Overlay.collapse()\n  }\n}\nexport const ioContextMenu = function(arg0?: IoContextMenuProps) {\n  return IoContextMenu.vConstructor(arg0)\n}"],"names":["MenuOption","Node","args","option","selectedOptions","options","i","ids","value","allItems","id","walker","next","selected","item","event","selectedOption","path","selectedIDImmediate","json","__decorateClass","ReactiveProperty","NodeArray","Register","MenuElementTags","MenuElementTagsSelector","getHoveredMenuItem","IoOverlaySingleton","hovered","isPointerAboveIoMenuItem","a","b","first","second","getMenuDescendants","element","descendants","getMenuAncestors","ancestors","getMenuSiblings","siblings","parent","getMenuRoot","root","r","x","y","matchMenuOption","search","searchMenuOption","depth","d","subitems","IoMenuOptions","IoElement","Overlay","source","cmd","index","inoverlay","parentIsAbove","parentIsBelow","parentIsLeft","parentIsRight","rect","parentRect","cmdOverride","optionWasFocused","searchHadInput","descendant","nudge","vChildren","ioString","filteredItems","ioField","ioMenuItem","direction","span","Property","ioMenuOptions","arg0","timeoutOpen","prevHovered","onOverlayPointerdown","onOverlayPointermove","v","h","onOverlayPointeup","IoMenuItem","IoField","o","$allitems","$ancestoritems","descendantIsFocused","siblingIsFocused","sibling","ancestorIsFocused","ancestor","nothingIsFocused","fucusLeftOverlay","optionsAreAbove","optionsAreBelow","optionsAreLeft","optionsAreRight","optionsRect","icon","label","ioIcon","IoMenuHamburger","ioMenuHamburger","IoMenuTreeBranch","ioBoolean","ioMenuTree","ioMenuTreeBranch","genObjectStorageID","object","string","hash","addMenuOptionsOrTreeBranches","elements","subOption","collapsibleState","$","IoMenuTree","IoOptionSelect","oldValue","change","selectedItem","ioOptionSelect","IoContextMenu","ioContextMenu"],"mappings":"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"}