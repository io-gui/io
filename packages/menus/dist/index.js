import{ReactiveProperty,NodeArray,ReactiveNode,Register,IoOverlaySingleton,Property,IoElement,nudge,span,Storage}from"@io-gui/core";import{ioIcon}from"@io-gui/icons";import{ioString,ioField,IoField,ioBoolean}from"@io-gui/inputs";var __defProp$7=Object.defineProperty,__getOwnPropDesc$7=Object.getOwnPropertyDescriptor,__decorateClass$7=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$7(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$7(target,key,result),result};let MenuOption=class extends ReactiveNode{static get Listeners(){return{"option-selected-changed":"onOptionSelectedChanged"}}constructor(args){"string"!=typeof args&&"number"!=typeof args&&"boolean"!=typeof args&&null!=args||(args={id:String(args),value:args}),(args={...args}).id=args.id??"",args.label=args.label??args.id,args.value=args.value??args.id,args.options=args.options??[],args.options=args.options.map(option=>option instanceof MenuOption?option:new MenuOption(option));const selectedOptions=args.options.filter(option=>"select"===option.mode&&option.selected);for(let i=1;i<selectedOptions.length;i++)console.warn('Duplicate selected options with mode "select" found!',selectedOptions),selectedOptions[i].selected=!1;super(args)}getAllOptions(){const options=[this];for(let i=0;i<this.options.length;i++)options.push(...this.options[i].getAllOptions());{const ids=/* @__PURE__ */new Set;for(let i=0;i<options.length;i++)ids.has(options[i].id)&&console.warn(`Duplicate id "${options[i].id}"`,this),ids.add(options[i].id)}return options}findItemByValue(value){const allItems=this.getAllOptions();for(let i=0;i<allItems.length;i++)if(allItems[i].value===value)return allItems[i]}findItemById(id){const allItems=this.getAllOptions();for(let i=0;i<allItems.length;i++)if(allItems[i].id===id)return allItems[i]}selectDefault(){let walker="select"===this.mode?this:void 0;for(;walker;){const next=walker.options.find(option=>"select"===option.mode);if("select"!==walker.mode||!next)break;walker=next}walker&&(walker.selected=!0)}selectedChanged(){!1===this.selected&&this.unselectSuboptions(),this.dispatch("option-selected-changed",{option:this},!0)}selectedIDChanged(){const option=this.findItemById(this.selectedID);option&&(option.selected=!0,this.dispatch("option-selected",{option:option},!1))}selectedIDImmediateChanged(){if(this.selectedIDImmediate){this.selected=!0;const option=this.options.find(option2=>option2.id===this.selectedIDImmediate);option&&(option.selected=!0)}this.updatePaths()}getSelectedIDImmediate(){let selected="";for(let i=0;i<this.options.length;i++){const item=this.options[i];if(item.selected&&item.id&&"select"===item.mode){selected=item.id;break}}return selected}setSelectedIDImmediate(id){this.options.withInternalOperation(()=>{for(let i=0;i<this.options.length;i++){const item=this.options[i];item.id===id?item.selected=!0:item.selected=!1}}),this.options.dispatchMutation()}onOptionSelectedChanged(event){if(-1===this.options.indexOf(event.detail.option))return;if(event.detail.option===this)return;const selectedOption=event.detail.option;if(selectedOption.selected)for(let i=0;i<this.options.length;i++){const option=this.options[i];option!==selectedOption&&"select"===option.mode&&"select"===selectedOption.mode&&(option.selected=!1)}this.options.some(option=>option.selected&&"select"===option.mode)||this.setProperties({selectedID:"",selectedIDImmediate:"",path:""})}unselectSuboptions(){for(let i=0;i<this.options.length;i++){const option=this.options[i];"select"===option.mode&&(option.selected=!1,option.unselectSuboptions())}}updatePaths(){const path=[];if("select"!==this.mode||!this.selected)return void(this.path="");let selectedIDImmediate=this.getSelectedIDImmediate(),walker=selectedIDImmediate?this.options.find(option=>"select"===option.mode&&option.selected&&option.id===selectedIDImmediate):void 0;if(walker){for(;walker;)path.push(walker.id),selectedIDImmediate=walker.getSelectedIDImmediate(),walker=selectedIDImmediate?walker.options.find(option=>"select"===option.mode&&option.selected&&option.id===selectedIDImmediate):void 0;this.path=path.join(",")}}pathChanged(){const path=this.path?[...this.path.split(",")]:[];path.length&&(this.selectedID=path[path.length-1])}optionsMutated(event){const selectedIDImmediate=this.getSelectedIDImmediate();"select"===this.mode&&selectedIDImmediate&&this.options.length&&this.setProperties({selectedIDImmediate:selectedIDImmediate}),this.updatePaths(),this.dispatchMutation()}toJSON(){return{id:this.id,value:this.value,label:this.label,icon:this.icon,hint:this.hint,disabled:this.disabled,mode:this.mode,options:this.options.map(option=>option.toJSON())}}fromJSON(json){return this.setProperties({id:json.id,value:json.value??void 0,label:json.label??json.id,icon:json.icon??"",hint:json.hint??"",disabled:json.disabled??!1,mode:json.mode??"select",selected:json.selected??!1,options:json.options?.map(option=>new MenuOption(option))??[]}),this}changed(){-1===["select","toggle","none"].indexOf(this.mode)&&console.warn(`Unknown "mode" property "${this.mode}"!`,this),this.selected&&-1===["select","toggle"].indexOf(this.mode)&&console.warn('"selected" property is only valid when mode is "select" or "toggle"!',this),this.action&&"function"!=typeof this.action&&console.warn(`Invalid type "${typeof this.action}" of "action" property!`,this)}dispose(){this.options.length=0,super.dispose()}};__decorateClass$7([ReactiveProperty({value:"",type:String})],MenuOption.prototype,"id",2),__decorateClass$7([ReactiveProperty({value:void 0})],MenuOption.prototype,"value",2),__decorateClass$7([ReactiveProperty({value:"",type:String})],MenuOption.prototype,"label",2),__decorateClass$7([ReactiveProperty({value:"",type:String})],MenuOption.prototype,"icon",2),__decorateClass$7([ReactiveProperty({value:"",type:String})],MenuOption.prototype,"hint",2),__decorateClass$7([ReactiveProperty({value:!1,type:Boolean})],MenuOption.prototype,"disabled",2),__decorateClass$7([ReactiveProperty()],MenuOption.prototype,"action",2),__decorateClass$7([ReactiveProperty({value:"select",type:String})],MenuOption.prototype,"mode",2),__decorateClass$7([ReactiveProperty({value:!1,type:Boolean})],MenuOption.prototype,"selected",2),__decorateClass$7([ReactiveProperty({value:"",type:String})],MenuOption.prototype,"selectedIDImmediate",2),__decorateClass$7([ReactiveProperty({value:"",type:String})],MenuOption.prototype,"selectedID",2),__decorateClass$7([ReactiveProperty({value:"",type:String})],MenuOption.prototype,"path",2),__decorateClass$7([ReactiveProperty({type:NodeArray,init:"this"})],MenuOption.prototype,"options",2),MenuOption=__decorateClass$7([Register],MenuOption);const MenuElementTags=["io-menu-item","io-menu-options","io-menu-hamburger","io-option-select","io-string","io-menu-tree"],MenuElementTagsSelector=MenuElementTags.join(", ");function getMenuDescendants(element){const descendants=[];if(element.$options){descendants.push(element.$options);const options=element.$options.querySelectorAll(MenuElementTagsSelector);for(let i=options.length;i--;)descendants.push(options[i]),descendants.push(...getMenuDescendants(options[i]))}else{const options=Array.from(element.querySelectorAll(MenuElementTagsSelector));for(let i=options.length;i--;)descendants.push(options[i]),descendants.push(...getMenuDescendants(options[i]))}return descendants}function getMenuAncestors(element){const ancestors=[];let option=element;for(;option&&option.$parent;)option=option.$parent,option&&ancestors.push(option);return ancestors}function getMenuSiblings(element){const siblings=[],parent=element.parentElement;return parent&&siblings.push(...Array.from(parent.querySelectorAll(MenuElementTagsSelector))),siblings}function getMenuRoot(element){let root=element;for(;root&&root.$parent;)root=root.$parent;return root}function isPointerAboveIoMenuItem(event,element){if(-1!==MenuElementTags.indexOf(element.localName)&&!element.disabled&&element.parentElement!==IoOverlaySingleton&&element.parentElement.expanded){const r=element.getBoundingClientRect(),x=event.clientX,y=event.clientY;return r.top<=y&&r.bottom>=y&&r.left<=x&&r.right>=x}return!1}function matchMenuOption(option,search){return!option.options.length&&(void 0!==option.value&&-1!==String(option.value).toLowerCase().indexOf(search)||(!(!option.label||-1===option.label.toLowerCase().indexOf(search))||!(!option.hint||-1===option.hint.toLowerCase().indexOf(search))))}function searchMenuOption(option,search,depth=5,d=0){search=search.toLowerCase();const subitems=[];if(d<=depth)for(let i=0;i<option.options.length;i++)matchMenuOption(option.options[i],search)&&subitems.push(option.options[i]),option.options[i].options.length&&subitems.push(...searchMenuOption(option.options[i],search,depth,d+1));return subitems}var __defProp$6=Object.defineProperty,__getOwnPropDesc$6=Object.getOwnPropertyDescriptor,__decorateClass$6=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$6(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$6(target,key,result),result};let IoMenuOptions=class extends IoElement{static get Style(){return"\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: calc(var(--io_borderRadius) + var(--io_spacing2));\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: calc(var(--io_spacing) + var(--io_borderWidth));\n      transition: opacity 0.3s ease-in-out;\n      @apply --unselectable;\n    }\n    :host[horizontal] {\n      padding: var(--io_spacing) 0;\n      flex-direction: row;\n      align-self: stretch;\n    }\n    :host[inoverlay] {\n      overflow-y: auto;\n      box-shadow: 1px 1px 16px var(--io_shadowColor),\n                  1px 1px 8px var(--io_shadowColor), \n                  1px 1px 4px var(--io_shadowColor);\n    }\n    :host[inoverlay]:not([expanded]) {\n      visibility: hidden;\n      opacity: 0;\n    }\n    :host > io-menu-item[hidden] ~ span.divider {\n      display: none;\n    }\n    :host > span.divider {\n      flex: 0 0 0;\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n      margin: var(--io_spacing) 0;\n      opacity: 0.1;\n    }\n    :host[horizontal] > span.divider {\n      margin: 0 var(--io_spacing);\n    }\n    :host[horizontal] > io-menu-item > .hint {\n      display: none;\n    }\n    :host:not([horizontal]) > #search {\n      margin: var(--io_spacing);\n      margin-top: 0;\n    }\n    :host[horizontal] > #search {\n      margin: 0 var(--io_spacing);\n      flex: 0 0 10em;\n    }\n    "}static get Listeners(){return{touchstart:["stopPropagation"],"io-focus-to":"onIoFocusTo"}}get inoverlay(){return IoOverlaySingleton.contains(this.parentElement)}constructor(args={}){super(args)}stopPropagation(event){this.inoverlay&&event.stopPropagation()}connectedCallback(){super.connectedCallback(),this.inoverlay&&this.setAttribute("inoverlay","true")}onIoFocusTo(event){const source=event.detail.source,cmd=event.detail.command,siblings=getMenuSiblings(source),index=siblings.indexOf(source),inoverlay=this.inoverlay;let parentIsAbove=!1,parentIsBelow=!1,parentIsLeft=!1,parentIsRight=!1;if(this.$parent){const rect=this.getBoundingClientRect(),parentRect=this.$parent.getBoundingClientRect();parentIsAbove=rect.top>parentRect.top,parentIsBelow=rect.bottom<parentRect.bottom,parentIsLeft=rect.left>parentRect.left,parentIsRight=rect.right<parentRect.right}let cmdOverride="";this.horizontal?("ArrowRight"===cmd&&inoverlay&&(cmdOverride="Next"),"ArrowLeft"===cmd&&inoverlay&&(cmdOverride="Prev"),"ArrowUp"===cmd&&parentIsAbove&&(cmdOverride="Out"),"ArrowDown"===cmd&&parentIsBelow&&(cmdOverride="Out")):("ArrowDown"===cmd&&inoverlay&&(cmdOverride="Next"),"ArrowUp"===cmd&&inoverlay&&(cmdOverride="Prev"),"ArrowLeft"===cmd&&parentIsLeft&&(cmdOverride="Out"),"ArrowRight"===cmd&&parentIsRight&&(cmdOverride="Out")),"Tab"===cmd&&inoverlay&&(cmdOverride="Next"),cmdOverride&&("Next"===cmdOverride?siblings[(index+1)%siblings.length].focus():"Prev"===cmdOverride?siblings[(index-1+siblings.length)%siblings.length].focus():"Out"===cmdOverride&&this.$parent&&this.$parent.focus(),event.stopPropagation())}collapse(){const optionWasFocused=this.contains(document.activeElement),searchHadInput=this.searchable&&!!this.search;getMenuDescendants(this).forEach(descendant=>{descendant.expanded=!1}),this.expanded=!1,searchHadInput&&optionWasFocused&&!this.inoverlay&&(this.search="",this.$.search.focus())}expandedChanged(){this.expanded?this.inoverlay&&this.debounce(this.onExpandInOverlay):(this.style.top="",this.style.height="",this.scrollTop=0,this.search="")}searchChanged(){this.inoverlay&&this.$parent&&this.debounce(this.onExpandInOverlay)}onExpandInOverlay(){this.$parent&&nudge(this,this.$parent,this.direction,!0)}changed(){const vChildren=this.widget?[this.widget]:[];if(this.searchable&&vChildren.push(ioString({id:"search",role:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const filteredItems=searchMenuOption(this.option,this.search,this.depth);if(0===filteredItems.length)vChildren.push(ioField({label:"No matches"}));else for(let i=0;i<filteredItems.length;i++)vChildren.push(ioMenuItem({option:filteredItems[i],depth:0})),i<filteredItems.length-1&&vChildren.push({tag:"span",props:{class:"divider"}})}else{let direction=this.horizontal?"down":"right";this.horizontal&&"up"===this.direction&&(direction="up");for(let i=0;i<this.option.options.length;i++)vChildren.push(ioMenuItem({option:this.option.options[i],direction:direction,$parent:this,depth:this.depth})),i<this.option.options.length-1&&vChildren.push(span({class:"divider"}))}this.render(vChildren)}};__decorateClass$6([ReactiveProperty({type:MenuOption})],IoMenuOptions.prototype,"option",2),__decorateClass$6([ReactiveProperty({value:!1,reflect:!0})],IoMenuOptions.prototype,"expanded",2),__decorateClass$6([ReactiveProperty({value:!1,reflect:!0})],IoMenuOptions.prototype,"horizontal",2),__decorateClass$6([ReactiveProperty(!1)],IoMenuOptions.prototype,"searchable",2),__decorateClass$6([ReactiveProperty("")],IoMenuOptions.prototype,"search",2),__decorateClass$6([ReactiveProperty({value:"none",reflect:!0})],IoMenuOptions.prototype,"direction",2),__decorateClass$6([ReactiveProperty(100)],IoMenuOptions.prototype,"depth",2),__decorateClass$6([ReactiveProperty({value:"",reflect:!0})],IoMenuOptions.prototype,"overflow",2),__decorateClass$6([ReactiveProperty(null)],IoMenuOptions.prototype,"widget",2),__decorateClass$6([Property()],IoMenuOptions.prototype,"$parent",2),__decorateClass$6([Property("listbox")],IoMenuOptions.prototype,"role",2),IoMenuOptions=__decorateClass$6([Register],IoMenuOptions);const ioMenuOptions=function(arg0){return IoMenuOptions.vConstructor(arg0)};var __defProp$5=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$5=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$5(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$5(target,key,result),result};let timeoutOpen,hovered,prevHovered;function onOverlayPointerdown(event){hovered=void 0,prevHovered=void 0}function onOverlayPointermove(event){if(clearTimeout(timeoutOpen),hovered=function getHoveredMenuItem(event){const options=Array.from(IoOverlaySingleton.querySelectorAll("io-menu-item, io-menu-options")),hovered=[];if(IoOverlaySingleton.expanded)for(let i=options.length;i--;)isPointerAboveIoMenuItem(event,options[i])&&hovered.push(options[i]);if(hovered.length){hovered.sort((a,b)=>a.depth>b.depth?1:a.depth<b.depth?-1:"io-menu-item"===a.localName?1:"io-menu-item"===b.localName?-1:0);const first=hovered[0],second=hovered[1];if("io-menu-item"===first.localName)return first;if("io-menu-options"===first.localName&&second&&"io-menu-item"===second.localName&&second.depth===first.depth)return second}}(event),hovered&&hovered!==prevHovered){const v=Math.abs(event.movementY)-Math.abs(event.movementX),h=hovered.parentElement?.horizontal;prevHovered?.parentElement!==hovered.parentElement||(h?v<-.25:v>.25)?(prevHovered=hovered,hovered.focus()):timeoutOpen=setTimeout(()=>{prevHovered=hovered,hovered&&hovered.focus()},250)}}function onOverlayPointeup(event){hovered&&hovered.onClick()}IoOverlaySingleton.addEventListener("pointermove",onOverlayPointermove);let IoMenuItem=class extends IoField{static get Style(){return"\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n      :host > .label {\n        flex: 1 1 auto;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hint {\n        flex: 0 1 auto;\n        opacity: 0.25;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hasmore {\n        opacity: 0.5;\n      }\n    "}static get Listeners(){return{click:"preventDefault",focus:"onFocus",blur:"onBlur"}}constructor(args={}){super(args)}preventDefault(event){event.stopPropagation(),event.preventDefault()}get hasmore(){return this.option.options.length&&this.depth>0}get inoverlay(){return IoOverlaySingleton.contains(this.parentElement?.parentElement)}connectedCallback(){super.connectedCallback(),this.$options&&IoOverlaySingleton.appendChild(this.$options)}disconnectedCallback(){super.disconnectedCallback(),this.$options&&IoOverlaySingleton.removeChild(this.$options)}onClick(){const o=this.option;this.hasmore?this.expanded||(this.expanded=!0):"toggle"===o.mode?o.selected=!o.selected:(o.action&&(o.action.apply(null,[o.value]),this.collapseRoot()),"select"===o.mode&&(o.options.length&&this.depth<=0?o.selectDefault():o.selected=!0,this.collapseRoot())),getMenuRoot(this).dispatch("io-menu-option-clicked",{option:o},!0)}onPointerdown(event){super.onPointerdown(event),"touch"!==event.pointerType&&(this.setPointerCapture(event.pointerId),event.stopPropagation(),this.hasmore&&(this.expanded=!0),onOverlayPointerdown.call(this,event))}onPointermove(event){event.stopPropagation(),"touch"!==event.pointerType&&onOverlayPointermove.call(this,event)}onPointerup(event){super.onPointerup(event),event.stopPropagation(),this.onPointerupAction(event)}onPointerupAction(event){this.onClick()}onFocus(event){super.onFocus(event),this.hasmore&&this.inoverlay&&(this.expanded=!0);const $allitems=getMenuDescendants(getMenuRoot(this)),$ancestoritems=getMenuAncestors(this);for(let i=$allitems.length;i--;)$allitems[i]!==this&&$allitems[i]!==this.$options&&-1===$ancestoritems.indexOf($allitems[i])&&$allitems[i].expanded&&$allitems[i].collapse()}onBlur(event){super.onBlur(event),this.debounce(this.onBlurDebounced)}onBlurDebounced(){if(this._disposed)return;const descendants=getMenuDescendants(this),siblings=getMenuSiblings(this),ancestors=getMenuAncestors(this),descendantIsFocused=descendants.some(descendant=>descendant===document.activeElement),siblingIsFocused=siblings.some(sibling=>sibling===document.activeElement),ancestorIsFocused=ancestors.some(ancestor=>ancestor===document.activeElement),nothingIsFocused=document.activeElement===document.body,fucusLeftOverlay=!IoOverlaySingleton.contains(document.activeElement);descendantIsFocused||nothingIsFocused||(ancestorIsFocused||siblingIsFocused?this.collapse():fucusLeftOverlay&&this.collapseRoot())}onKeydown(event){const inoverlay=this.inoverlay;let direction=this.direction,optionsAreAbove=!1,optionsAreBelow=!1,optionsAreLeft=!1,optionsAreRight=!1;if(this.expanded&&this.$options){const rect=this.getBoundingClientRect(),optionsRect=this.$options.getBoundingClientRect();optionsAreAbove=rect.top>optionsRect.top,optionsAreBelow=rect.bottom<optionsRect.bottom,optionsAreLeft=rect.left>optionsRect.left,optionsAreRight=rect.right<optionsRect.right}"up"===direction&&optionsAreBelow&&(direction="down"),"down"===direction&&optionsAreAbove&&(direction="up"),"left"===direction&&optionsAreRight&&(direction="right"),"right"===direction&&optionsAreLeft&&(direction="left");let cmd=null;if("Enter"===event.key||" "===event.key){if(!this.hasmore)return event.preventDefault(),void this.onClick();cmd="In"}else"Backspace"===event.key?cmd="Out":"Escape"===event.key?cmd="Collapse":"ArrowLeft"===event.key&&(inoverlay||this.expanded)?this.hasmore&&"left"===direction?cmd="In":"right"===direction&&(cmd="Out"):"ArrowRight"===event.key&&(inoverlay||this.expanded)?this.hasmore&&"right"===direction?cmd="In":"left"===direction&&(cmd="Out"):"ArrowUp"===event.key&&(inoverlay||this.expanded)?this.hasmore&&"up"===direction?cmd="In":"down"===direction&&(cmd="Out"):"ArrowDown"===event.key&&(inoverlay||this.expanded)&&(this.hasmore&&"down"===direction?cmd="In":"up"===direction&&(cmd="Out"));if(cmd)switch(event.preventDefault(),cmd){case"Collapse":this.collapseRoot();break;case"In":if(this.hasmore&&(this.expanded=!0),this.$options&&this.$options.children.length){const option=this.$options.querySelector("[selected]");option?option.focus():this.$options.children[0].focus()}break;case"Out":this.$parent&&this.$parent.$parent&&(this.$parent.$parent.focus(),this.$parent.$parent.collapse())}else super.onKeydown(event)}collapse(){getMenuDescendants(this).forEach(descendant=>{descendant.expanded=!1}),this.expanded=!1}collapseRoot(){getMenuRoot(this).collapse()}optionChanged(){this.setProperties({selected:this.option.selected,disabled:this.option.disabled}),this.initOptions()}optionMutated(){this.setProperties({selected:this.option.selected,disabled:this.option.disabled}),this.changed()}initOptions(){this.option.options&&this.depth>0&&(void 0===this.$options?this.$options=new IoMenuOptions({expanded:this.bind("expanded"),depth:this.depth-1,option:this.option,direction:this.direction,$parent:this}):this.$options.option=this.option)}changed(){const icon=this.icon||this.option.icon,label=this.label||this.option.label;this.render([this.hasmore&&"left"===this.direction?ioIcon({value:"io:triangle_left",class:"hasmore"}):null,this.hasmore&&"up"===this.direction?ioIcon({value:"io:triangle_up",class:"hasmore"}):null,icon?ioIcon({value:icon}):null,label?span({class:"label"},label):null,this.option.hint?span({class:"hint"},this.option.hint):null,this.hasmore&&"right"===this.direction?ioIcon({value:"io:triangle_right",class:"hasmore"}):null,this.hasmore&&"down"===this.direction?ioIcon({value:"io:triangle_down",class:"hasmore"}):null])}dispose(){super.dispose(),delete this.$options}};__decorateClass$5([ReactiveProperty({type:MenuOption})],IoMenuItem.prototype,"option",2),__decorateClass$5([Property("")],IoMenuItem.prototype,"label",2),__decorateClass$5([ReactiveProperty({value:!1,reflect:!0})],IoMenuItem.prototype,"expanded",2),__decorateClass$5([ReactiveProperty({value:"right",reflect:!0})],IoMenuItem.prototype,"direction",2),__decorateClass$5([ReactiveProperty({value:1e3,reflect:!0})],IoMenuItem.prototype,"depth",2),__decorateClass$5([Property("false")],IoMenuItem.prototype,"contentEditable",2),__decorateClass$5([Property()],IoMenuItem.prototype,"$parent",2),IoMenuItem=__decorateClass$5([Register],IoMenuItem);const ioMenuItem=function(arg0){return IoMenuItem.vConstructor(arg0)};var __defProp$4=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$4=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$4(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$4(target,key,result),result};let IoMenuHamburger=class extends IoMenuItem{static get Style(){return"\n      :host {\n        display: flex;\n        flex-shrink: 0;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n    "}changed(){this.render([ioIcon({value:"io:hamburger"})])}};__decorateClass$4([ReactiveProperty({value:"down",reflect:!0})],IoMenuHamburger.prototype,"direction",2),IoMenuHamburger=__decorateClass$4([Register],IoMenuHamburger);const ioMenuHamburger=IoMenuHamburger.vConstructor;var __defProp$3=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$3=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$3(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$3(target,key,result),result};let IoMenuTreeBranch=class extends IoElement{static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n    }\n    :host > io-boolean {\n      overflow: visible;\n      padding-left: var(--io_spacing3);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-boolean:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: "▸"\n    }\n    :host > io-boolean[value]:before {\n      content: "▾"\n    }\n    :host > io-menu-tree {\n      background: transparent;\n      border: none;\n      border-left: var(--io_border);\n      border-color: var(--io_colorLight);\n      margin-left: var(--io_spacing5);\n    }\n    '}optionMutated(){this.option.selected&&(this.expanded=this.option.selected)}changed(){this.render([ioBoolean({icon:this.option.icon,true:this.option.label,false:this.option.label,value:this.bind("expanded")}),this.expanded?ioMenuTree({option:this.option,depth:this.depth+1}):null])}};__decorateClass$3([ReactiveProperty(Number)],IoMenuTreeBranch.prototype,"depth",2),__decorateClass$3([ReactiveProperty({type:MenuOption})],IoMenuTreeBranch.prototype,"option",2),__decorateClass$3([ReactiveProperty({value:!1,type:Boolean,reflect:!0})],IoMenuTreeBranch.prototype,"expanded",2),__decorateClass$3([Property("region")],IoMenuTreeBranch.prototype,"role",2),IoMenuTreeBranch=__decorateClass$3([Register],IoMenuTreeBranch);const ioMenuTreeBranch=function(arg0){return IoMenuTreeBranch.vConstructor(arg0)};var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$2(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$2(target,key,result),result};function genObjectStorageID(object){const string=JSON.stringify(object);let hash=0;for(let i=0;i<string.length;i++)hash=Math.imul(31,hash)+string.charCodeAt(i)|0;return"io-local-state-"+String(hash)}let IoMenuTree=class extends IoElement{static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: var(--io_borderRadius);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: var(--io_spacing);\n      @apply --unselectable;\n    }\n    :host io-menu-tree {\n      padding: 0 !important;\n    }\n    :host > io-menu-item {\n      padding-left: var(--io_spacing);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-menu-item[selected] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: ""\n    }\n    '}constructor(args={}){super(args)}changed(){const vChildren=this.widget?[this.widget]:[];if(this.searchable&&vChildren.push(ioString({id:"search",role:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const filteredItems=searchMenuOption(this.option,this.search,this.depth);if(0===filteredItems.length)vChildren.push(ioField({label:"No matches"}));else for(let i=0;i<filteredItems.length;i++)vChildren.push(ioMenuItem({option:filteredItems[i],depth:0}))}else vChildren.push(...function addMenuOptionsOrTreeBranches(option,depth,d=0){const elements=[];if(d<=depth)for(let i=0;i<option.options.length;i++){const subOption=option.options[i];if(subOption.options.length){const collapsibleState=Storage({value:!1,storage:"local",key:genObjectStorageID(subOption)});!0===subOption.selected&&(collapsibleState.value=!0),elements.push(ioMenuTreeBranch({option:subOption,depth:d,expanded:collapsibleState}))}else elements.push(ioMenuItem({option:subOption,depth:d}))}return elements}(this.option,this.depth));this.render(vChildren)}};__decorateClass$2([ReactiveProperty({type:MenuOption})],IoMenuTree.prototype,"option",2),__decorateClass$2([ReactiveProperty({value:!1,type:Boolean})],IoMenuTree.prototype,"searchable",2),__decorateClass$2([ReactiveProperty({value:"",type:String})],IoMenuTree.prototype,"search",2),__decorateClass$2([ReactiveProperty({value:Infinity,type:Number})],IoMenuTree.prototype,"depth",2),__decorateClass$2([ReactiveProperty(null)],IoMenuTree.prototype,"widget",2),__decorateClass$2([Property()],IoMenuTree.prototype,"$parent",2),__decorateClass$2([Property("listbox")],IoMenuTree.prototype,"role",2),IoMenuTree=__decorateClass$2([Register],IoMenuTree);const ioMenuTree=function(arg0){return IoMenuTree.vConstructor(arg0)};var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$1(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1(target,key,result),result};let IoOptionSelect=class extends IoElement{static get Style(){return"\n    :host {\n      display: inline-block;\n      text-align: center;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      background-image: var(--io_gradientOutset);\n      text-align: left;\n    }\n    :host > io-menu-item {\n      margin: calc(-1 * var(--io_borderWidth));\n      background-color: transparent !important;\n      border-color: transparent !important;\n    }\n    "}constructor(args){super(args)}onOptionSelected(event){this._disposed||("value"===this.selectBy?this.inputValue(event.detail.option.value):"id"===this.selectBy&&this.inputValue(event.detail.option.id))}inputValue(value){if(this.value!==value||"object"==typeof this.value){const oldValue=this.value;this.setProperty("value",value),this.dispatch("value-input",{value:value,oldValue:oldValue},!1)}}optionChanged(change){if(change.oldValue&&change.oldValue.removeEventListener("option-selected",this.onOptionSelected),change.value&&change.value.addEventListener("option-selected",this.onOptionSelected),void 0===this.value){const selectedID=this.option.selectedID,selectedItem=this.option.findItemById(selectedID);"value"===this.selectBy?selectedItem&&(this.value=selectedItem.value):"id"===this.selectBy&&selectedItem&&(this.value=selectedItem.id)}}changed(){let selectedItem,label=this.label;"value"===this.selectBy?(selectedItem=this.option.findItemByValue(this.value),label=selectedItem?selectedItem.label:String(this.value)):"id"===this.selectBy&&(selectedItem=this.option.findItemById(this.value),label=selectedItem?selectedItem.label:String(this.value)),this.render([ioMenuItem({option:this.option,label:label,icon:this.icon,direction:"down"})])}};__decorateClass$1([ReactiveProperty({value:void 0})],IoOptionSelect.prototype,"value",2),__decorateClass$1([ReactiveProperty("")],IoOptionSelect.prototype,"label",2),__decorateClass$1([ReactiveProperty("")],IoOptionSelect.prototype,"icon",2),__decorateClass$1([ReactiveProperty("value")],IoOptionSelect.prototype,"selectBy",2),__decorateClass$1([ReactiveProperty({type:MenuOption})],IoOptionSelect.prototype,"option",2),__decorateClass$1([Property("button")],IoOptionSelect.prototype,"role",2),IoOptionSelect=__decorateClass$1([Register],IoOptionSelect);const ioOptionSelect=function(arg0){return IoOptionSelect.vConstructor(arg0)};var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp(target,key,result),result};let IoContextMenu=class extends IoElement{static get ReactiveProperties(){return{$options:null}}constructor(args){super(args),this.$options=new IoMenuOptions({expanded:this.bind("expanded"),option:this.option,$parent:this})}init(){this.collapse=this.collapse.bind(this)}optionChanged(){this.$options&&(this.$options.option=this.option)}connectedCallback(){super.connectedCallback(),IoOverlaySingleton.appendChild(this.$options),this.parentElement.addEventListener("pointerdown",this.onPointerdown),this.parentElement.addEventListener("click",this.onClick),this.parentElement.addEventListener("contextmenu",this.onContextmenu)}disconnectedCallback(){super.disconnectedCallback(),IoOverlaySingleton.removeChild(this.$options),this.parentElement.removeEventListener("pointerdown",this.onPointerdown),this.parentElement.removeEventListener("click",this.onClick),this.parentElement.removeEventListener("contextmenu",this.onContextmenu)}getBoundingClientRect(){return this.parentElement.getBoundingClientRect()}onContextmenu(event){2===this.button&&event.preventDefault()}onPointerdown(event){event.stopPropagation(),this.$options.style.left=`${event.clientX}px`,this.$options.style.top=`${event.clientY}px`,this.parentElement.addEventListener("pointermove",this.onPointermove),this.parentElement.addEventListener("pointerleave",this.onPointerleave),this.parentElement.addEventListener("pointerup",this.onPointerup),clearTimeout(this._contextTimeout),"touch"!==event.pointerType?event.button===this.button&&(this.setPointerCapture(event.pointerId),this.expanded=!0):(event.preventDefault(),this._contextTimeout=setTimeout(()=>{this.setPointerCapture(event.pointerId),this.expanded=!0},150)),onOverlayPointerdown.call(this,event)}onPointermove(event){event.stopPropagation(),clearTimeout(this._contextTimeout),("touch"!==event.pointerType||this.expanded)&&onOverlayPointermove.call(this,event)}onPointerup(event){clearTimeout(this._contextTimeout),this.releasePointerCapture(event.pointerId),this.parentElement.removeEventListener("pointermove",this.onPointermove),this.parentElement.removeEventListener("pointerleave",this.onPointerleave),this.parentElement.removeEventListener("pointerup",this.onPointerup),onOverlayPointeup.call(this,event)}onPointerleave(event){this.releasePointerCapture(event.pointerId),this.parentElement.removeEventListener("pointermove",this.onPointermove),this.parentElement.removeEventListener("pointerleave",this.onPointerleave),this.parentElement.removeEventListener("pointerup",this.onPointerup)}collapse(){IoOverlaySingleton.collapse()}};__decorateClass([ReactiveProperty({type:MenuOption})],IoContextMenu.prototype,"option",2),__decorateClass([ReactiveProperty({value:!1,reflect:!0})],IoContextMenu.prototype,"expanded",2),__decorateClass([ReactiveProperty(0)],IoContextMenu.prototype,"button",2),IoContextMenu=__decorateClass([Register],IoContextMenu);const ioContextMenu=function(arg0){return IoContextMenu.vConstructor(arg0)};export{IoContextMenu,IoMenuHamburger,IoMenuItem,IoMenuOptions,IoMenuTree,IoMenuTreeBranch,IoOptionSelect,MenuOption,ioContextMenu,ioMenuHamburger,ioMenuItem,ioMenuOptions,ioMenuTree,ioMenuTreeBranch,ioOptionSelect,onOverlayPointerdown,onOverlayPointermove,onOverlayPointeup};
//# sourceMappingURL=index.js.map
