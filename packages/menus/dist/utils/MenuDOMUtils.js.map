{"version":3,"file":"MenuDOMUtils.js","sourceRoot":"","sources":["../../src/utils/MenuDOMUtils.ts"],"names":[],"mappings":"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","sourcesContent":["import { IoOverlaySingleton } from 'io-core'\nimport { IoString } from 'io-inputs'\nimport { IoMenuItem } from '../elements/IoMenuItem.js'\nimport { IoMenuOptions } from '../elements/IoMenuOptions.js'\nimport { IoMenuTree } from '../elements/IoMenuTree.js'\n\n// TODO: Fix type remove any!\n\nexport type IoMenuElementType = IoMenuItem | IoMenuOptions | IoMenuTree | IoString\n\nconst MenuElementTags = ['io-menu-item', 'io-menu-options', 'io-menu-hamburger', 'io-option-select', 'io-string', 'io-menu-tree']\nconst MenuElementTagsSelector = MenuElementTags.join(', ')\n\nexport function getHoveredMenuItem(event: PointerEvent) {\n  const options = Array.from(IoOverlaySingleton.querySelectorAll('io-menu-item, io-menu-options')) as IoMenuItem[]\n  const hovered: IoMenuElementType[] = []\n  if (IoOverlaySingleton.expanded) {\n    for (let i = options.length; i--;) {\n      if (isPointerAboveIoMenuItem(event, options[i])) hovered.push(options[i])\n    }\n  }\n  if (hovered.length) {\n    hovered.sort((a: IoMenuElementType, b: IoMenuElementType) => {\n      if ((a as any).depth > (b as any).depth) return 1\n      if ((a as any).depth < (b as any).depth) return -1\n      if (a.localName === 'io-menu-item') return 1\n      if (b.localName === 'io-menu-item') return -1\n      return 0\n    })\n    const first = hovered[0]\n    const second = hovered[1]\n    if (first.localName === 'io-menu-item') {\n      return first\n    // NOTE: This effectively blocks picking io-menu-item behind io-menu-options.\n    } else if (first.localName === 'io-menu-options' && second) {\n      if (second.localName === 'io-menu-item' && (second as any).depth === (first as any).depth) {\n        return second\n      }\n    }\n  }\n  return undefined\n}\n\nexport function getMenuDescendants(element: IoMenuElementType) {\n  const descendants: IoMenuElementType[] = []\n  if ((element as any).$options) {\n    descendants.push((element as any).$options)\n    const options = (element as any).$options.querySelectorAll(MenuElementTagsSelector)\n    for (let i = options.length; i--;) {\n      descendants.push(options[i])\n      descendants.push(...getMenuDescendants(options[i]))\n    }\n  } else {\n    const options = Array.from(element.querySelectorAll(MenuElementTagsSelector)) as IoMenuElementType[]\n    for (let i = options.length; i--;) {\n      descendants.push(options[i])\n      descendants.push(...getMenuDescendants(options[i]))\n    }\n  }\n  return descendants\n}\n\nexport function getMenuAncestors(element: IoMenuElementType) {\n  const ancestors: IoMenuElementType[] = []\n  let option = element\n  while (option && (option as any).$parent) { // && !option.$parent._disposed\n    option = (option as any).$parent\n    if (option) ancestors.push(option)\n  }\n  return ancestors\n}\n\nexport function getMenuChildren(element: IoMenuElementType) {\n  const children: IoMenuElementType[] = []\n  const options = Array.from(element.querySelectorAll(MenuElementTagsSelector)) as IoMenuElementType[]\n  for (let i = options.length; i--;) {\n    children.push(options[i])\n  }\n  if ((element as any).$options) {\n    children.push((element as any).$options)\n    const options = (element as any).$options.querySelectorAll(MenuElementTagsSelector)\n    for (let i = options.length; i--;) {\n      children.push(options[i])\n    }\n  }\n  return children\n}\n\nexport function getMenuSiblings(element: IoMenuItem) {\n  const siblings: IoMenuItem[] = []\n  const parent = element.parentElement\n  if (parent) {\n    siblings.push(...Array.from(parent.querySelectorAll(MenuElementTagsSelector)) as IoMenuItem[])\n  }\n  return siblings\n}\n\nexport function getMenuRoot(element: IoMenuElementType) {\n  let root: IoMenuElementType = element\n  while (root && (root as any).$parent) {\n    root = (root as any).$parent\n  }\n  return root\n}\n\nexport function isPointerAboveIoMenuItem(event: PointerEvent, element: IoMenuElementType) {\n  if (MenuElementTags.indexOf(element.localName) !== -1) {\n    if (!(element as any).disabled) {\n      if (element.parentElement !== IoOverlaySingleton && (element.parentElement as any)!.expanded) {\n        const r = element.getBoundingClientRect()\n        const x = event.clientX\n        const y = event.clientY\n        const hovered = (r.top <= y && r.bottom >= y && r.left <= x && r.right >= x )\n        return hovered\n      }\n    }\n  }\n  return false\n}"]}