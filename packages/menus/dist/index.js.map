{"version":3,"file":"index.js","sources":["../src/nodes/MenuOption.ts","../src/utils/MenuDOMUtils.ts","../src/utils/MenuNodeUtils.ts","../src/elements/IoMenuOptions.ts","../src/elements/IoMenuItem.ts","../src/elements/IoMenuHamburger.ts","../src/elements/IoMenuTreeBranch.ts","../src/elements/IoMenuTree.ts","../src/elements/IoOptionSelect.ts","../src/elements/IoContextMenu.ts"],"sourcesContent":["import { ReactiveNode, Register, ReactiveProperty, WithBinding, NodeArray } from '@io-gui/core'\n\nexport type MenuOptionMode = 'select' | 'toggle' | 'none'\n\nexport type MenuOptionProps = {\n  id?: string\n  value?: any\n  label?: string\n  icon?: string\n  hint?: string\n  action?: (value?: any) => void\n  mode?: MenuOptionMode\n  disabled?: boolean\n  selected?: WithBinding<boolean>\n  selectedID?: WithBinding<string>\n  selectedIDImmediate?: WithBinding<string>\n  path?: WithBinding<string>\n  options?: Array<string | number | boolean | null | undefined | MenuOptionProps>\n}\n\n@Register\nexport class MenuOption extends ReactiveNode {\n\n  @ReactiveProperty({value: '', type: String})\n  declare id: string\n\n  @ReactiveProperty({value: undefined})\n  declare value: any\n\n  @ReactiveProperty({value: '', type: String})\n  declare label: string\n\n  @ReactiveProperty({value: '', type: String})\n  declare icon: string\n\n  @ReactiveProperty({value: '', type: String})\n  declare hint: string\n\n  @ReactiveProperty({value: false, type: Boolean})\n  declare disabled: boolean\n\n  @ReactiveProperty()\n  declare action?: (value?: any) => void\n\n  @ReactiveProperty({value: 'select', type: String})\n  declare mode: MenuOptionMode\n\n  @ReactiveProperty({value: false, type: Boolean})\n  declare selected: boolean\n\n  @ReactiveProperty({value: '', type: String})\n  declare selectedIDImmediate: string\n\n  @ReactiveProperty({value: '', type: String})\n  declare selectedID: string\n\n  @ReactiveProperty({value: '', type: String})\n  declare path: string\n\n  @ReactiveProperty({type: NodeArray, init: 'this'})\n  declare options: NodeArray<MenuOption>\n\n  static get Listeners() {\n    return {\n      'option-selected-changed': 'onOptionSelectedChanged',\n    }\n  }\n\n  constructor(args: string | number | boolean | null | undefined | MenuOptionProps) {\n\n    if (typeof args === 'string' || typeof args === 'number' || typeof args === 'boolean' || args === null || args === undefined) {\n      args = {\n        id: String(args),\n        value: args,\n      }\n    }\n\n    args = { ...args }\n    args.id = args.id ?? '' // TODO: Reconsider.\n    args.label = args.label ?? args.id\n    args.value = args.value ?? args.id\n    args.options = args.options ?? []\n    args.options = args.options.map(option => {\n      return (option instanceof MenuOption) ? option : new MenuOption(option)\n    })\n\n    const selectedOptions = (args.options as MenuOption[]).filter(option => option.mode === 'select' && option.selected)\n    for (let i = 1; i < selectedOptions.length; i++) {\n      debug: console.warn('Duplicate selected options with mode \"select\" found!', selectedOptions)\n      selectedOptions[i].selected = false\n    }\n\n    super(args as MenuOptionProps)\n  }\n  getAllOptions() {\n    const options: MenuOption[] = [this]\n    for (let i = 0; i < this.options.length; i++) {\n      options.push(...this.options[i].getAllOptions())\n    }\n    debug: {\n      const ids = new Set()\n      for (let i = 0; i < options.length; i++) {\n        if (ids.has(options[i].id)) console.warn(`Duplicate id \"${options[i].id}\"`, this)\n        ids.add(options[i].id)\n      }\n    }\n    return options\n  }\n  findItemByValue(value: any) {\n    const allItems = this.getAllOptions()\n    for (let i = 0; i < allItems.length; i++) {\n      if (allItems[i].value === value) return allItems[i]\n    }\n  }\n  findItemById(id: string) {\n    const allItems = this.getAllOptions()\n    for (let i = 0; i < allItems.length; i++) {\n      if (allItems[i].id === id) return allItems[i]\n    }\n  }\n  selectDefault() {\n    let walker: MenuOption | undefined = this.mode === 'select' ? this : undefined\n    while (walker) {\n      const next = walker.options.find(option => option.mode === 'select')\n      if (walker.mode === 'select' && next) {\n        walker = next\n      } else {\n        break\n      }\n    }\n    if (walker) walker.selected = true\n  }\n  selectedChanged() {\n    if (this.selected === false) {\n      this.unselectSuboptions()\n    }\n    this.dispatch('option-selected-changed', {option: this}, true)\n  }\n  selectedIDChanged() {\n    const option = this.findItemById(this.selectedID)\n    if (option) {\n      option.selected = true\n      this.dispatch('option-selected', {option: option}, false)\n    }\n  }\n  selectedIDImmediateChanged() {\n    if (this.selectedIDImmediate) {\n      this.selected = true\n      const option = this.options.find(option => option.id === this.selectedIDImmediate)\n      if (option) {\n        option.selected = true\n      }\n    }\n    this.updatePaths()\n  }\n  getSelectedIDImmediate() {\n    let selected = ''\n    for (let i = 0; i < this.options.length; i++) {\n      const item = this.options[i]\n      if (item.selected && item.id && item.mode === 'select') {\n        selected = item.id\n        break\n      }\n    }\n    return selected\n  }\n  setSelectedIDImmediate(id: string) {\n    // TODO Test and reconsider withInternalOperation\n    this.options.withInternalOperation(() => {\n      for (let i = 0; i < this.options.length; i++) {\n        const item = this.options[i]\n        if (item.id === id) {\n          item.selected = true\n        } else {\n          item.selected = false\n        }\n      }\n    })\n    this.options.dispatchMutation()\n  }\n  onOptionSelectedChanged(event: CustomEvent) {\n    // TODO: Instead of this check, use event.stopPropagation() once implemented in EventDispatcher.\n    if (this.options.indexOf(event.detail.option) === -1) return\n    if (event.detail.option === this) return\n    const selectedOption = event.detail.option\n    if (selectedOption.selected) {\n      for (let i = 0; i < this.options.length; i++) {\n        const option = this.options[i] as MenuOption\n        if (option !== selectedOption && option.mode === 'select' && selectedOption.mode === 'select') {\n          option.selected = false\n        }\n      }\n    }\n    const hasSelected = this.options.some(option => option.selected && option.mode === 'select')\n    if (hasSelected) {\n      // this.updatePaths();\n    } else {\n      this.setProperties({\n        selectedID: '',\n        selectedIDImmediate: '',\n        path: '',\n      })\n    }\n  }\n  unselectSuboptions() {\n    for (let i = 0; i < this.options.length; i++) {\n      const option = this.options[i]\n      if (option.mode === 'select') {\n        option.selected = false\n        option.unselectSuboptions()\n      }\n    }\n  }\n  updatePaths() {\n    const path: string[] = []\n    if (this.mode !== 'select' || !this.selected) {\n      this.path = ''\n      return\n    }\n\n    let selectedIDImmediate = this.getSelectedIDImmediate()\n    let walker = selectedIDImmediate ? this.options.find(option => option.mode === 'select' && option.selected && option.id === selectedIDImmediate) : undefined\n    if (!walker) return\n\n    while (walker) {\n      path.push(walker.id)\n      selectedIDImmediate = walker.getSelectedIDImmediate()\n      walker = selectedIDImmediate ? walker.options.find(option => option.mode === 'select' && option.selected && option.id === selectedIDImmediate) : undefined\n    }\n    this.path = path.join(',')\n  }\n  pathChanged() {\n    const path = this.path ? [...this.path.split(',')] : []\n    if (path.length) this.selectedID = path[path.length - 1]\n  }\n  optionsMutated(event: CustomEvent) {\n    const selectedIDImmediate = this.getSelectedIDImmediate()\n    if (this.mode === 'select' && selectedIDImmediate && this.options.length) {\n      this.setProperties({\n        selected: true,\n        selectedIDImmediate: selectedIDImmediate,\n      })\n    }\n    this.updatePaths()\n    this.dispatchMutation()\n  }\n  toJSON(): MenuOptionProps {\n    return {\n      id: this.id,\n      value: this.value,\n      label: this.label,\n      icon: this.icon,\n      hint: this.hint,\n      disabled: this.disabled,\n      // action: N/A for serialization\n      mode: this.mode,\n      options: this.options.map(option => option.toJSON()),\n    }\n  }\n  fromJSON(json: MenuOptionProps) {\n    this.setProperties({\n      id: json.id,\n      value: json.value ?? undefined,\n      label: json.label ?? json.id,\n      icon: json.icon ?? '',\n      hint: json.hint ?? '',\n      disabled: json.disabled ?? false,\n      // action: N/A for serialization\n      mode: json.mode ?? 'select',\n      selected: json.selected ?? false,\n      options: json.options?.map(option => new MenuOption(option)) ?? [],\n    })\n    return this\n  }\n  changed() {\n    debug: {\n      if (['select', 'toggle', 'none'].indexOf(this.mode) === -1) {\n        console.warn(`Unknown \"mode\" property \"${this.mode}\"!`, this)\n      }\n      if (this.selected && ['select', 'toggle'].indexOf(this.mode) === -1) {\n        console.warn('\"selected\" property is only valid when mode is \"select\" or \"toggle\"!', this)\n      }\n      // if (!this.id) {\n      //   console.warn('\"id\" property is required!', this)\n      // }\n      if (this.action && typeof this.action !== 'function') {\n        console.warn(`Invalid type \"${typeof this.action}\" of \"action\" property!`, this)\n      }\n    }\n  }\n  dispose() {\n    this.options.length = 0 // TODO: test magic!\n    super.dispose()\n  }\n}","import { IoOverlaySingleton } from '@io-gui/core'\nimport { IoString } from '@io-gui/inputs'\nimport { IoMenuItem } from '../elements/IoMenuItem.js'\nimport { IoMenuOptions } from '../elements/IoMenuOptions.js'\nimport { IoMenuTree } from '../elements/IoMenuTree.js'\n\n// TODO: Fix type remove any!\n\nexport type IoMenuElementType = IoMenuItem | IoMenuOptions | IoMenuTree | IoString\n\nconst MenuElementTags = ['io-menu-item', 'io-menu-options', 'io-menu-hamburger', 'io-option-select', 'io-string', 'io-menu-tree']\nconst MenuElementTagsSelector = MenuElementTags.join(', ')\n\nexport function getHoveredMenuItem(event: PointerEvent) {\n  const options = Array.from(IoOverlaySingleton.querySelectorAll('io-menu-item, io-menu-options')) as IoMenuItem[]\n  const hovered: IoMenuElementType[] = []\n  if (IoOverlaySingleton.expanded) {\n    for (let i = options.length; i--;) {\n      if (isPointerAboveIoMenuItem(event, options[i])) hovered.push(options[i])\n    }\n  }\n  if (hovered.length) {\n    hovered.sort((a: IoMenuElementType, b: IoMenuElementType) => {\n      if ((a as any).depth > (b as any).depth) return 1\n      if ((a as any).depth < (b as any).depth) return -1\n      if (a.localName === 'io-menu-item') return 1\n      if (b.localName === 'io-menu-item') return -1\n      return 0\n    })\n    const first = hovered[0]\n    const second = hovered[1]\n    if (first.localName === 'io-menu-item') {\n      return first\n    // NOTE: This effectively blocks picking io-menu-item behind io-menu-options.\n    } else if (first.localName === 'io-menu-options' && second) {\n      if (second.localName === 'io-menu-item' && (second as any).depth === (first as any).depth) {\n        return second\n      }\n    }\n  }\n  return undefined\n}\n\nexport function getMenuDescendants(element: IoMenuElementType) {\n  const descendants: IoMenuElementType[] = []\n  if ((element as any).$options) {\n    descendants.push((element as any).$options)\n    const options = (element as any).$options.querySelectorAll(MenuElementTagsSelector)\n    for (let i = options.length; i--;) {\n      descendants.push(options[i])\n      descendants.push(...getMenuDescendants(options[i]))\n    }\n  } else {\n    const options = Array.from(element.querySelectorAll(MenuElementTagsSelector)) as IoMenuElementType[]\n    for (let i = options.length; i--;) {\n      descendants.push(options[i])\n      descendants.push(...getMenuDescendants(options[i]))\n    }\n  }\n  return descendants\n}\n\nexport function getMenuAncestors(element: IoMenuElementType) {\n  const ancestors: IoMenuElementType[] = []\n  let option = element\n  while (option && (option as any).$parent) { // && !option.$parent._disposed\n    option = (option as any).$parent\n    if (option) ancestors.push(option)\n  }\n  return ancestors\n}\n\nexport function getMenuChildren(element: IoMenuElementType) {\n  const children: IoMenuElementType[] = []\n  const options = Array.from(element.querySelectorAll(MenuElementTagsSelector)) as IoMenuElementType[]\n  for (let i = options.length; i--;) {\n    children.push(options[i])\n  }\n  if ((element as any).$options) {\n    children.push((element as any).$options)\n    const options = (element as any).$options.querySelectorAll(MenuElementTagsSelector)\n    for (let i = options.length; i--;) {\n      children.push(options[i])\n    }\n  }\n  return children\n}\n\nexport function getMenuSiblings(element: IoMenuItem) {\n  const siblings: IoMenuItem[] = []\n  const parent = element.parentElement\n  if (parent) {\n    siblings.push(...Array.from(parent.querySelectorAll(MenuElementTagsSelector)) as IoMenuItem[])\n  }\n  return siblings\n}\n\nexport function getMenuRoot(element: IoMenuElementType) {\n  let root: IoMenuElementType = element\n  while (root && (root as any).$parent) {\n    root = (root as any).$parent\n  }\n  return root\n}\n\nexport function isPointerAboveIoMenuItem(event: PointerEvent, element: IoMenuElementType) {\n  if (MenuElementTags.indexOf(element.localName) !== -1) {\n    if (!(element as any).disabled) {\n      if (element.parentElement !== IoOverlaySingleton && (element.parentElement as any)!.expanded) {\n        const r = element.getBoundingClientRect()\n        const x = event.clientX\n        const y = event.clientY\n        const hovered = (r.top <= y && r.bottom >= y && r.left <= x && r.right >= x )\n        return hovered\n      }\n    }\n  }\n  return false\n}","import { MenuOption } from '../nodes/MenuOption.js'\n\nfunction matchMenuOption(option: MenuOption, search: string) {\n  if (option.options.length) return false\n  if (option.value !== undefined && String(option.value).toLowerCase().indexOf(search) !== -1) return true\n  if (option.label && option.label.toLowerCase().indexOf(search) !== -1) return true\n  if (option.hint && option.hint.toLowerCase().indexOf(search) !== -1) return true\n  return false\n}\n\nexport function searchMenuOption(option: MenuOption, search: string, depth = 5, d = 0) {\n  search = search.toLowerCase()\n  const subitems: MenuOption[] = []\n  if (d <= depth) for (let i = 0; i < option.options.length; i++) {\n    if (matchMenuOption(option.options[i], search)) {\n      subitems.push(option.options[i])\n    }\n    if (option.options[i].options.length) {\n      subitems.push(...searchMenuOption(option.options[i], search, depth, d + 1))\n    }\n  }\n  return subitems\n}","import { Register, IoElement, ReactiveProperty, VDOMElement, IoOverlaySingleton as Overlay, NudgeDirection, IoElementProps, WithBinding, Property, nudge, ListenerDefinition, span } from '@io-gui/core'\nimport { ioField, ioString } from '@io-gui/inputs'\nimport { MenuOption } from '../nodes/MenuOption.js'\nimport { ioMenuItem, IoMenuItem } from './IoMenuItem.js'\nimport { IoContextMenu } from './IoContextMenu.js'\nimport { getMenuDescendants, getMenuSiblings } from '../utils/MenuDOMUtils.js'\nimport { searchMenuOption } from '../utils/MenuNodeUtils.js'\n\n// const rects = new WeakMap();\n\n// TODO: improve focusto nav and in-layer navigation.\n\nexport type IoMenuOptionsProps = IoElementProps & {\n  option?: MenuOption\n  expanded?: WithBinding<boolean>\n  horizontal?: boolean\n  searchable?: boolean\n  search?: WithBinding<string>\n  direction?: NudgeDirection\n  depth?: number\n  widget?: VDOMElement | null\n  $parent?: IoMenuItem | IoContextMenu\n}\n\n/**\n * It generates a list of `IoMenuItem` elements from `options` property. If `horizontal` property is set, menu options are displayed in horizontal direction.\n **/\n@Register\nexport class IoMenuOptions extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: calc(var(--io_borderRadius) + var(--io_spacing2));\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: calc(var(--io_spacing) + var(--io_borderWidth));\n      transition: opacity 0.3s ease-in-out;\n      @apply --unselectable;\n    }\n    :host[horizontal] {\n      padding: var(--io_spacing) 0;\n      flex-direction: row;\n      align-self: stretch;\n    }\n    :host[inoverlay] {\n      overflow-y: auto;\n      box-shadow: 1px 1px 16px var(--io_shadowColor),\n                  1px 1px 8px var(--io_shadowColor), \n                  1px 1px 4px var(--io_shadowColor);\n    }\n    :host[inoverlay]:not([expanded]) {\n      visibility: hidden;\n      opacity: 0;\n    }\n    :host > io-menu-item[hidden] ~ span.divider {\n      display: none;\n    }\n    :host > span.divider {\n      flex: 0 0 0;\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n      margin: var(--io_spacing) 0;\n      opacity: 0.1;\n    }\n    :host[horizontal] > span.divider {\n      margin: 0 var(--io_spacing);\n    }\n    :host[horizontal] > io-menu-item > .hint {\n      display: none;\n    }\n    :host:not([horizontal]) > #search {\n      margin: var(--io_spacing);\n      margin-top: 0;\n    }\n    :host[horizontal] > #search {\n      margin: 0 var(--io_spacing);\n      flex: 0 0 10em;\n    }\n    `\n  }\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare expanded: boolean\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare horizontal: boolean\n\n  @ReactiveProperty(false)\n  declare searchable: boolean\n\n  @ReactiveProperty('')\n  declare search: string\n\n  @ReactiveProperty({value: 'none', reflect: true})\n  declare direction: NudgeDirection\n\n  @ReactiveProperty(100)\n  declare depth: number\n\n  @ReactiveProperty({value: '', reflect: true})\n  declare overflow: string\n\n  @ReactiveProperty(null)\n  declare widget: VDOMElement | null\n\n  @Property()\n  declare $parent?: IoMenuItem\n\n  @Property('listbox')\n  declare role: string\n\n  static get Listeners() {\n    return {\n      'touchstart': ['stopPropagation'] as ListenerDefinition,\n      'io-focus-to': 'onIoFocusTo',\n    }\n  }\n  get inoverlay() {\n    return Overlay.contains(this.parentElement)\n  }\n  constructor(args: IoMenuOptionsProps = {}) { super(args) }\n\n  stopPropagation(event: TouchEvent) {\n    if (this.inoverlay) {\n      // TODO: Prevent pull-down-to-refresh on scrollable menus.\n      // Stops overlay from capturing touch events\n      event.stopPropagation()\n    }\n  }\n  connectedCallback() {\n    super.connectedCallback()\n    if (this.inoverlay) {\n      this.setAttribute('inoverlay', 'true')\n    }\n  }\n  onIoFocusTo(event: CustomEvent) {\n    const source = event.detail.source\n    const cmd = event.detail.command\n    const siblings = getMenuSiblings(source)\n    const index = siblings.indexOf(source)\n\n    const inoverlay = this.inoverlay\n\n    let parentIsAbove = false\n    let parentIsBelow = false\n    let parentIsLeft = false\n    let parentIsRight = false\n\n    if (this.$parent) {\n      const rect = this.getBoundingClientRect()\n      const parentRect = this.$parent.getBoundingClientRect()\n      parentIsAbove = rect.top > parentRect.top\n      parentIsBelow = rect.bottom < parentRect.bottom\n      parentIsLeft = rect.left > parentRect.left\n      parentIsRight = rect.right < parentRect.right\n    }\n\n    let cmdOverride = ''\n\n    if (this.horizontal) {\n      if (cmd === 'ArrowRight' && inoverlay) cmdOverride = 'Next'\n      if (cmd === 'ArrowLeft' && inoverlay) cmdOverride = 'Prev'\n      if (cmd === 'ArrowUp' && parentIsAbove) cmdOverride = 'Out'\n      if (cmd === 'ArrowDown' && parentIsBelow) cmdOverride = 'Out'\n    } else {\n      if (cmd === 'ArrowDown' && inoverlay) cmdOverride = 'Next'\n      if (cmd === 'ArrowUp' && inoverlay) cmdOverride = 'Prev'\n      if (cmd === 'ArrowLeft' && parentIsLeft) cmdOverride = 'Out'\n      if (cmd === 'ArrowRight' && parentIsRight) cmdOverride = 'Out'\n    }\n    if (cmd === 'Tab' && inoverlay) cmdOverride = 'Next'\n\n    if (cmdOverride) {\n      if (cmdOverride === 'Next') {\n        siblings[(index + 1) % siblings.length].focus()\n      } else if (cmdOverride === 'Prev') {\n        siblings[(index - 1 + siblings.length) % siblings.length].focus()\n      } else if (cmdOverride === 'Out') {\n        if (this.$parent) this.$parent.focus()\n      }\n      event.stopPropagation()\n    }\n  }\n  collapse() {\n    const optionWasFocused = this.contains(document.activeElement)\n    const searchHadInput = this.searchable && !!this.search\n    getMenuDescendants(this).forEach(descendant => {\n      (descendant as any).expanded = false\n    })\n    this.expanded = false\n    if (searchHadInput && optionWasFocused && !this.inoverlay) {\n      this.search = ''\n      this.$.search.focus()\n    }\n  }\n  expandedChanged() {\n    if (this.expanded) {\n      if (this.inoverlay) {\n        this.debounce(this.onExpandInOverlay)\n      }\n    } else {\n      this.style.top = ''\n      this.style.height = ''\n      this.scrollTop = 0\n      this.search = ''\n    }\n  }\n  searchChanged() {\n    // TODO: focus drifts when filtered option is clicked\n    if (this.inoverlay && this.$parent) {\n      this.debounce(this.onExpandInOverlay)\n    }\n  }\n  // TODO: Move functionality to Overlay\n  onExpandInOverlay() {\n    if (this.$parent) {\n      nudge(this, this.$parent, this.direction, true)\n    }\n  }\n  changed() {\n    const vChildren: VDOMElement[] = this.widget ? [this.widget] : []\n    if (this.searchable) {\n      vChildren.push(ioString({\n        id: 'search',\n        role: 'search',\n        value: this.bind('search'),\n        placeholder: 'Search',\n        live: true\n      }))\n    }\n    if (this.search) {\n      const filteredItems = searchMenuOption(this.option, this.search, this.depth)\n      if (filteredItems.length === 0) {\n        vChildren.push(ioField({label: 'No matches'}))\n      } else {\n        for (let i = 0; i < filteredItems.length; i++) {\n          vChildren.push(ioMenuItem({option: filteredItems[i], depth: 0}))\n          if (i < filteredItems.length - 1) {\n            vChildren.push({tag: 'span', props: {class: 'divider'}})\n          }\n        }\n      }\n    } else {\n      let direction: 'left' | 'right' | 'up' | 'down' = this.horizontal ? 'down' : 'right'\n      if (this.horizontal && this.direction === 'up') {\n        direction = 'up'\n      }\n      for (let i = 0; i < this.option.options.length; i++) {\n        vChildren.push(ioMenuItem({\n          option: this.option.options[i],\n          direction: direction,\n          $parent: this,\n          depth: this.depth\n        }))\n        if (i < this.option.options.length - 1) {\n          vChildren.push(span({class: 'divider'}))\n        }\n      }\n    }\n    this.render(vChildren)\n  }\n}\nexport const ioMenuOptions = function(arg0?: IoMenuOptionsProps) {\n  return IoMenuOptions.vConstructor(arg0)\n}","import { Register, ReactiveProperty, Property, IoOverlaySingleton as Overlay, span, WithBinding, NudgeDirection } from '@io-gui/core'\nimport { IoField, IoFieldProps } from '@io-gui/inputs'\nimport { ioIcon } from '@io-gui/icons'\nimport { IoMenuElementType, getMenuRoot, getMenuAncestors, getMenuDescendants, getMenuSiblings, getHoveredMenuItem } from '../utils/MenuDOMUtils.js'\nimport { MenuOption } from '../nodes/MenuOption.js'\nimport { IoMenuOptions } from './IoMenuOptions.js'\nimport { IoMenuTree } from './IoMenuTree.js'\n\nlet timeoutOpen: ReturnType<typeof setTimeout> | undefined = undefined\n\nlet hovered: IoMenuElementType | undefined\nlet prevHovered: IoMenuElementType | undefined\n\nexport function onOverlayPointerdown(event: PointerEvent) {\n  hovered = undefined\n  prevHovered = undefined\n}\n\nexport function onOverlayPointermove(event: PointerEvent) {\n  clearTimeout(timeoutOpen)\n  hovered = getHoveredMenuItem(event)\n  if (hovered && hovered !== prevHovered) {\n    const v = Math.abs(event.movementY) - Math.abs(event.movementX)\n    const h = (hovered.parentElement as IoMenuOptions)?.horizontal\n    if (prevHovered?.parentElement !== hovered.parentElement) {\n      prevHovered = hovered\n      hovered.focus()\n    } else if (h ? v < -0.25 : v > 0.25) {\n      prevHovered = hovered\n      hovered.focus()\n    } else {\n      timeoutOpen = setTimeout(() => {\n        prevHovered = hovered\n        if (hovered) hovered.focus()\n      }, 250)\n    }\n  }\n}\n\nexport function onOverlayPointeup(event: PointerEvent) {\n  if (hovered) (hovered as any).onClick()\n}\n\nOverlay.addEventListener('pointermove', onOverlayPointermove)\n\nexport type IoMenuItemProps = IoFieldProps & {\n  option?: MenuOption\n  label?: string\n  expanded?: WithBinding<boolean>\n  direction?: NudgeDirection\n  depth?: number\n  $parent?: IoMenuOptions | IoMenuTree\n}\n\n/**\n * It displays `option.icon`, `option.label` and `option.hint` property and it creates expandable `IoMenuOptions`\n * from the `option.options` array. Options are expand in the direction specified by `direction` property.\n * If `selectable` property is set, selecting an option sets its `value` to the entire menu tree and `selected`\n * attribute is set on menu options whose `option.value` matches selected value.\n **/\n\n// TODO: fix and improve keyboard navigation in all cases.\n@Register\nexport class IoMenuItem extends IoField {\n  static get Style() {\n    return /* css */`\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n      :host > .label {\n        flex: 1 1 auto;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hint {\n        flex: 0 1 auto;\n        opacity: 0.25;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hasmore {\n        opacity: 0.5;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @Property('')\n  declare label: string\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare expanded: boolean\n\n  @ReactiveProperty({value: 'right', reflect: true})\n  declare direction: NudgeDirection\n\n  @ReactiveProperty({value: 1000, reflect: true})\n  declare depth: number\n\n  @Property('false')\n  declare contentEditable: string\n\n  @Property()\n  declare $parent?: IoMenuOptions | IoMenuTree\n\n  declare $options?: IoMenuOptions\n\n  static get Listeners(): any {\n    return {\n      'click': 'preventDefault',\n      'focus': 'onFocus',\n      'blur': 'onBlur',\n    }\n  }\n\n  constructor(args: IoMenuItemProps = {}) { super(args) }\n\n  preventDefault(event: Event) {\n    event.stopPropagation()\n    event.preventDefault()\n  }\n  get hasmore() {\n    return this.option.options.length && this.depth > 0\n  }\n  get inoverlay() {\n    return Overlay.contains(this.parentElement?.parentElement as HTMLElement)\n  }\n  connectedCallback() {\n    super.connectedCallback()\n    if (this.$options) Overlay.appendChild(this.$options as HTMLElement)\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    if (this.$options) Overlay.removeChild(this.$options as HTMLElement)\n  }\n  onClick() {\n    const o = this.option\n    if (this.hasmore) {\n      if (!this.expanded) this.expanded = true\n      return\n    } else if (o.mode === 'toggle') {\n      o.selected = !o.selected\n    } else {\n      if (o.action) {\n        o.action.apply(null, [o.value])\n        this.collapseRoot()\n      }\n      if (o.mode === 'select') {\n        if (o.options.length && this.depth <= 0) {\n          o.selectDefault()\n        } else {\n          o.selected = true\n          // TODO: figure out OptionSelect value input with NodeArray options\n          // o.dispatch('option-selected', {option: o}, true);\n        }\n        this.collapseRoot()\n      }\n    }\n    getMenuRoot(this).dispatch('io-menu-option-clicked', {option: o}, true)\n  }\n  onPointerdown(event: PointerEvent) {\n    super.onPointerdown(event)\n    if (event.pointerType !== 'touch') {\n      this.setPointerCapture(event.pointerId)\n      event.stopPropagation()\n      if (this.hasmore) this.expanded = true\n      onOverlayPointerdown.call(this, event)\n    }\n  }\n  onPointermove(event: PointerEvent) {\n    event.stopPropagation()\n    if (event.pointerType !== 'touch') {\n      onOverlayPointermove.call(this, event)\n    }\n  }\n  onPointerup(event: PointerEvent) {\n    super.onPointerup(event)\n    event.stopPropagation()\n    this.onPointerupAction(event)\n  }\n  onPointerupAction(event: PointerEvent) {\n    this.onClick()\n  }\n  onFocus(event: FocusEvent) {\n    super.onFocus(event)\n    if (this.hasmore && this.inoverlay) this.expanded = true\n    const $allitems = getMenuDescendants(getMenuRoot(this))\n    const $ancestoritems = getMenuAncestors(this)\n    for (let i = $allitems.length; i--;) {\n      if ($allitems[i] !== this && $allitems[i] !== this.$options && $ancestoritems.indexOf($allitems[i]) === -1 && ($allitems[i] as any).expanded) {\n        ($allitems[i] as any).collapse()\n      }\n    }\n  }\n  onBlur(event: FocusEvent) {\n    super.onBlur(event)\n    this.debounce(this.onBlurDebounced)\n  }\n  onBlurDebounced() {\n    if (this._disposed) return\n    // TODO: rewrite this.\n    const descendants = getMenuDescendants(this)\n    const siblings = getMenuSiblings(this)\n    const ancestors = getMenuAncestors(this)\n    const descendantIsFocused = descendants.some(descendant => descendant === document.activeElement as unknown as IoMenuElementType)\n    const siblingIsFocused = siblings.some(sibling => sibling === document.activeElement as unknown as IoMenuElementType)\n    const ancestorIsFocused = ancestors.some(ancestor => ancestor === document.activeElement as unknown as IoMenuElementType)\n    const nothingIsFocused = document.activeElement === document.body\n\n    const fucusLeftOverlay = !Overlay.contains(document.activeElement)\n\n    if (descendantIsFocused || nothingIsFocused) return\n    if (ancestorIsFocused || siblingIsFocused) {\n      this.collapse()\n    } else if (fucusLeftOverlay) {\n      this.collapseRoot()\n    }\n  }\n  onKeydown(event: KeyboardEvent) {\n    const inoverlay = this.inoverlay\n    let direction = this.direction\n\n    // Determine relative position of expanded options. If they are nudged to the opposite direction, flip direction.\n    let optionsAreAbove = false\n    let optionsAreBelow = false\n    let optionsAreLeft = false\n    let optionsAreRight = false\n    if (this.expanded && this.$options) {\n      const rect = this.getBoundingClientRect()\n      const optionsRect = this.$options.getBoundingClientRect()\n      optionsAreAbove = rect.top > optionsRect.top\n      optionsAreBelow = rect.bottom < optionsRect.bottom\n      optionsAreLeft = rect.left > optionsRect.left\n      optionsAreRight = rect.right < optionsRect.right\n    }\n    // Flip direction if options are nudged to the opposite direction.\n    if (direction === 'up' && optionsAreBelow) direction = 'down'\n    if (direction === 'down' && optionsAreAbove) direction = 'up'\n    if (direction === 'left' && optionsAreRight) direction = 'right'\n    if (direction === 'right' && optionsAreLeft) direction = 'left'\n\n    // TODO: types!\n    let cmd = null\n\n    // TODO: 'Home', 'End', 'PageUp', 'PageDown' keys should be handled.\n    if (event.key === 'Enter' || event.key === ' ') {\n      if (this.hasmore) {\n        cmd = 'In'\n      } else {\n        event.preventDefault()\n        this.onClick()\n        return\n      }\n    } else if (event.key === 'Backspace') {\n      cmd = 'Out'\n    } else if (event.key === 'Escape') {\n      cmd = 'Collapse'\n    } else if (event.key === 'ArrowLeft' && (inoverlay || this.expanded)) {\n      if (this.hasmore && direction === 'left') {\n        cmd = 'In'\n      } else if (direction === 'right') {\n        cmd = 'Out'\n      }\n    } else if (event.key === 'ArrowRight' && (inoverlay || this.expanded)) {\n      if (this.hasmore && direction === 'right') {\n        cmd = 'In'\n      } else if (direction === 'left') {\n        cmd = 'Out'\n      }\n    } else if (event.key === 'ArrowUp' && (inoverlay || this.expanded)) {\n      if (this.hasmore && direction === 'up') {\n        cmd = 'In'\n      } else if (direction === 'down') {\n        cmd = 'Out'\n      }\n    } else if (event.key === 'ArrowDown' && (inoverlay || this.expanded)) {\n      if (this.hasmore && direction === 'down') {\n        cmd = 'In'\n      } else if (direction === 'up') {\n        cmd = 'Out'\n      }\n    }\n\n    if (cmd) {\n      event.preventDefault()\n      switch (cmd) {\n        case 'Collapse':\n          this.collapseRoot()\n          break\n        case 'In':\n          if (this.hasmore) this.expanded = true\n          if (this.$options && this.$options.children.length) {\n            const option = this.$options!.querySelector('[selected]') as IoMenuItem\n            if (option) option.focus()\n            else (this.$options!.children[0] as IoMenuItem).focus()\n          }\n          break\n        case 'Out':\n          if (this.$parent && this.$parent.$parent) {\n            this.$parent.$parent.focus()\n            this.$parent.$parent.collapse()\n          }\n          break\n        default:\n          break\n      }\n    } else {\n      super.onKeydown(event)\n    }\n  }\n  collapse() {\n    getMenuDescendants(this).forEach(descendant => {\n      (descendant as any).expanded = false\n    })\n    this.expanded = false\n  }\n  collapseRoot() {\n    (getMenuRoot(this) as any).collapse()\n  }\n  optionChanged() {\n    this.setProperties({\n      selected: this.option.selected,\n      disabled: this.option.disabled,\n    })\n    this.initOptions()\n  }\n  optionMutated() {\n    this.setProperties({\n      selected: this.option.selected,\n      disabled: this.option.disabled,\n    })\n    this.changed()\n  }\n  initOptions() {\n    if (this.option.options && this.depth > 0) {\n      if (this.$options === undefined) {\n        this.$options = new IoMenuOptions({\n          expanded: this.bind('expanded'),\n          depth: this.depth - 1,\n          option: this.option,\n          direction: this.direction,\n          $parent: this,\n        })\n      } else {\n        this.$options.option = this.option\n      }\n    }\n  }\n  changed() {\n    const icon = this.icon || this.option.icon\n    const label = this.label || this.option.label\n\n    this.render([\n      this.hasmore && this.direction === 'left' ? ioIcon({value: 'io:triangle_left', class: 'hasmore'}) : null,\n      this.hasmore && this.direction === 'up' ? ioIcon({value: 'io:triangle_up', class: 'hasmore'}) : null,\n      icon ? ioIcon({value: icon}) : null,\n      label ? span({class: 'label'}, label) : null,\n      this.option.hint ? span({class: 'hint'}, this.option.hint) : null,\n      this.hasmore && this.direction === 'right' ? ioIcon({value: 'io:triangle_right', class: 'hasmore'}) : null,\n      this.hasmore && this.direction === 'down' ? ioIcon({value: 'io:triangle_down', class: 'hasmore'}) : null,\n    ])\n  }\n  dispose() {\n    super.dispose()\n    delete this.$options\n  }\n}\nexport const ioMenuItem = function(arg0?: IoMenuItemProps) {\n  return IoMenuItem.vConstructor(arg0)\n}\n\n\n\n\n","import { NudgeDirection, ReactiveProperty, Register } from '@io-gui/core'\nimport { ioIcon } from '@io-gui/icons'\nimport { IoMenuItem } from './IoMenuItem.js'\n\n@Register\nexport class IoMenuHamburger extends IoMenuItem {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex-shrink: 0;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n    `\n  }\n\n  @ReactiveProperty({value: 'down', reflect: true})\n  declare direction: NudgeDirection\n\n  changed() {\n    this.render([ioIcon({value: 'io:hamburger'})])\n  }\n}\nexport const ioMenuHamburger = IoMenuHamburger.vConstructor","import { IoElement, Register, ReactiveProperty, IoElementProps, WithBinding, Property, clearFocusBacktrack } from '@io-gui/core'\nimport { ioBoolean } from '@io-gui/inputs'\nimport { MenuOption } from '../nodes/MenuOption.js'\nimport { ioMenuTree } from './IoMenuTree.js'\n\nexport type IoMenuTreeBranchProps = IoElementProps & {\n  depth?: number\n  option?: MenuOption\n  expanded?: WithBinding<boolean>\n}\n/**\n * An element with collapsible content.\n * When clicked or activated by space/enter key, it toggles the visibility of the child elements defined as `elements` property.\n **/\n\n@Register\nexport class IoMenuTreeBranch extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n    }\n    :host > io-boolean {\n      overflow: visible;\n      padding-left: var(--io_spacing3);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-boolean:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: \"▸\"\n    }\n    :host > io-boolean[value]:before {\n      content: \"▾\"\n    }\n    :host > io-menu-tree {\n      background: transparent;\n      border: none;\n      border-left: var(--io_border);\n      border-color: var(--io_colorLight);\n      margin-left: var(--io_spacing5);\n    }\n    `\n  }\n\n  @ReactiveProperty(Number)\n  declare depth: number\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @ReactiveProperty({value: false, type: Boolean, reflect: true})\n  declare expanded: boolean\n\n  @Property('region')\n  declare role: string\n\n  optionMutated() {\n    if (this.option.selected) this.expanded = this.option.selected\n  }\n\n  expandedChanged() {\n    clearFocusBacktrack()\n  }\n\n  changed() {\n    this.render([\n      ioBoolean({icon: this.option.icon, true: this.option.label, false: this.option.label, value: this.bind('expanded')}),\n      this.expanded ? ioMenuTree({option: this.option, depth: this.depth + 1}) : null,\n    ])\n  }\n}\nexport const ioMenuTreeBranch = function(arg0?: IoMenuTreeBranchProps) {\n  return IoMenuTreeBranch.vConstructor(arg0)\n}","import { Register, IoElement, ReactiveProperty, VDOMElement, Storage as $, IoElementProps, WithBinding, Property } from '@io-gui/core'\nimport { ioField, ioString } from '@io-gui/inputs'\nimport { MenuOption } from '../nodes/MenuOption.js'\nimport { ioMenuItem, IoMenuItem } from './IoMenuItem.js'\nimport { ioMenuTreeBranch } from './IoMenuTreeBranch.js'\nimport { searchMenuOption } from '../utils/MenuNodeUtils.js'\n\nfunction genObjectStorageID(object: Record<string, any>) {\n  const string = JSON.stringify(object)\n  let hash = 0\n  for (let i = 0; i < string.length; i++) {\n    hash = Math.imul(31, hash) + string.charCodeAt(i) | 0\n  }\n  return 'io-local-state-' + String(hash)\n}\n\nfunction addMenuOptionsOrTreeBranches(option: MenuOption, depth: number, d = 0) {\n  const elements: VDOMElement[] = []\n  if (d <= depth) for (let i = 0; i < option.options.length; i++) {\n    const subOption = option.options[i] as MenuOption\n    if (subOption.options.length) {\n      const collapsibleState = $({value: false, storage: 'local', key: genObjectStorageID(subOption)})\n      if (subOption.selected === true) collapsibleState.value = true\n      elements.push(ioMenuTreeBranch({option: subOption, depth: d, expanded: collapsibleState}))\n    } else {\n      elements.push(ioMenuItem({option: subOption, depth: d}))\n    }\n  }\n  return elements\n}\n\nexport type IoMenuTreeProps = IoElementProps & {\n  option?: MenuOption\n  searchable?: boolean\n  search?: WithBinding<string>\n  depth?: number\n  widget?: VDOMElement | null\n}\n\n@Register\nexport class IoMenuTree extends IoElement {\n\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: var(--io_borderRadius);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: var(--io_spacing);\n      @apply --unselectable;\n    }\n    :host io-menu-tree {\n      padding: 0 !important;\n    }\n    :host > io-menu-item {\n      padding-left: var(--io_spacing);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-menu-item[selected] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: \"\"\n    }\n    `\n  }\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @ReactiveProperty({value: false, type: Boolean})\n  declare searchable: boolean\n\n  @ReactiveProperty({value: '', type: String})\n  declare search: string\n\n  @ReactiveProperty({value: Infinity, type: Number})\n  declare depth: number\n\n  @ReactiveProperty(null)\n  declare widget: VDOMElement | null\n\n  @Property()\n  declare $parent?: IoMenuItem\n\n  @Property('listbox')\n  declare role: string\n\n  constructor(args: IoMenuTreeProps = {}) { super(args) }\n\n  onResized() {\n    this.dispatch('io-menu-tree-resized', {element: this}, true)\n  }\n\n  changed() {\n    const vChildren: VDOMElement[] = this.widget ? [this.widget] : []\n\n    if (this.searchable) {\n      vChildren.push(ioString({\n        id: 'search',\n        role: 'search',\n        value: this.bind('search'),\n        placeholder: 'Search',\n        live: true\n      }))\n    }\n\n    if (this.search) {\n      const filteredItems = searchMenuOption(this.option, this.search, this.depth)\n      if (filteredItems.length === 0) {\n        vChildren.push(ioField({label: 'No matches'}))\n      } else for (let i = 0; i < filteredItems.length; i++) {\n        vChildren.push(ioMenuItem({option: filteredItems[i], depth: 0}))\n      }\n\n    } else {\n      vChildren.push(...addMenuOptionsOrTreeBranches(this.option, this.depth))\n    }\n\n    this.render(vChildren)\n  }\n}\nexport const ioMenuTree = function(arg0?: IoMenuTreeProps) {\n  return IoMenuTree.vConstructor(arg0)\n}","import { Register, IoElement, Change, ReactiveProperty, IoElementProps, WithBinding, Property } from '@io-gui/core'\nimport { MenuOption } from '../nodes/MenuOption.js'\nimport { ioMenuItem } from './IoMenuItem.js'\n\nexport type SelectBy = 'value' | 'id'\n\nexport type IoOptionSelectProps = IoElementProps & {\n  option: MenuOption\n  value?: WithBinding<any>\n  label?: string\n  icon?: string\n  selectBy?: SelectBy\n}\n\n/**\n * Option select element. Similar to `IoMenuItem`, except it is displayed as a button and uses `options` property instead of ~~`option.options`~~  and it is `selectable` by default. It displays selected `value` or `label` followed by the `â–¾` character.\n * When clicked or activated by space/enter key, it expands a menu with selectable options.\n **/\n@Register\nexport class IoOptionSelect extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: inline-block;\n      text-align: center;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      background-image: var(--io_gradientOutset);\n      text-align: left;\n    }\n    :host > io-menu-item {\n      margin: calc(-1 * var(--io_borderWidth));\n      background-color: transparent !important;\n      border-color: transparent !important;\n    }\n    `\n  }\n\n  @ReactiveProperty({value: undefined})\n  declare value: any\n\n  @ReactiveProperty('')\n  declare label: string\n\n  @ReactiveProperty('')\n  declare icon: string\n\n  // TODO: consider deprecating\n  @ReactiveProperty('value')\n  declare selectBy: SelectBy\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @Property('button')\n  declare role: string\n\n  constructor(args: IoOptionSelectProps) {\n    super(args)\n  }\n\n  // TODO: Consider triggering inputValue() only by user-input!\n  onOptionSelected(event: CustomEvent) {\n    if (this._disposed) return\n    if (this.selectBy === 'value') {\n      this.inputValue(event.detail.option.value)\n    } else if (this.selectBy === 'id') {\n      this.inputValue(event.detail.option.id)\n    }\n  }\n  inputValue(value: any) {\n    if (this.value !== value || typeof this.value === 'object') {\n      const oldValue = this.value\n      this.setProperty('value', value)\n      this.dispatch('value-input', {value: value, oldValue: oldValue}, false)\n    }\n  }\n  optionChanged(change: Change) {\n    if (change.oldValue) {\n      change.oldValue.removeEventListener('option-selected', this.onOptionSelected)\n    }\n    if (change.value) {\n      change.value.addEventListener('option-selected', this.onOptionSelected)\n    }\n\n    //TODO: Cleanup and test\n    if (this.value === undefined) {\n      const selectedID = this.option.selectedID\n      const selectedItem = this.option.findItemById(selectedID)\n      if (this.selectBy === 'value') {\n        if (selectedItem) {\n          this.value = selectedItem.value\n        }\n      } else if (this.selectBy === 'id') {\n        if (selectedItem) {\n          this.value = selectedItem.id\n        }\n      }\n    }\n  }\n  changed() {\n    let selectedItem\n    let label = this.label\n    if (this.selectBy === 'value') {\n      selectedItem = this.option.findItemByValue(this.value)\n      label = selectedItem ? selectedItem.label : String(this.value)\n    } else if (this.selectBy === 'id') {\n      selectedItem = this.option.findItemById(this.value)\n      label = selectedItem ? selectedItem.label : String(this.value)\n    }\n    this.render([ioMenuItem({option: this.option, label: label, icon: this.icon, direction: 'down'})])\n  }\n}\nexport const ioOptionSelect = function(arg0: IoOptionSelectProps) {\n  return IoOptionSelect.vConstructor(arg0)\n}","import { Register, IoElement, ReactiveProperty, IoOverlaySingleton as Overlay, IoElementProps, WithBinding } from '@io-gui/core'\nimport { IoMenuOptions } from './IoMenuOptions.js'\nimport { onOverlayPointerdown, onOverlayPointermove, onOverlayPointeup } from './IoMenuItem.js'\nimport { MenuOption } from '../nodes/MenuOption.js'\n\nexport type IoContextMenuProps = IoElementProps & {\n  option: MenuOption\n  expanded?: WithBinding<boolean>\n  button?: number\n}\n\n/**\n * An invisible element that inserts a floating menu when its `parentElement` is clicked.\n * Menu position is set by the pointer by default but it can be configured to expand to the side of the parent element\n * by setting the `position` property. Default `button` property for menu expansion is `0` (left mouse button),\n * but it can be configured for other buttons. You can have multiple `IoContextMenu` instances under the same\n * `parentElement` as long as the `button` properties are different.\n **/\n@Register\nexport class IoContextMenu extends IoElement {\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare expanded: boolean\n\n  @ReactiveProperty(0)\n  declare button: number\n\n  declare $options: IoMenuOptions\n  declare _contextTimeout: ReturnType<typeof setTimeout>\n\n  static get ReactiveProperties(): any {\n    return {\n      $options: null,\n    }\n  }\n\n  constructor(args: IoContextMenuProps) {\n    super(args)\n    this.$options = new IoMenuOptions({\n      expanded: this.bind('expanded'),\n      option: this.option,\n      $parent: this,\n    })\n  }\n\n  init() {\n    this.collapse = this.collapse.bind(this)\n  }\n\n  optionChanged() {\n    if (this.$options) this.$options.option = this.option\n  }\n  connectedCallback() {\n    super.connectedCallback()\n    Overlay.appendChild(this.$options as HTMLElement)\n    this.parentElement!.addEventListener('pointerdown', this.onPointerdown)\n    this.parentElement!.addEventListener('click', (this as any).onClick)\n    this.parentElement!.addEventListener('contextmenu', this.onContextmenu)\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    Overlay.removeChild(this.$options as HTMLElement)\n    this.parentElement!.removeEventListener('pointerdown', this.onPointerdown)\n    this.parentElement!.removeEventListener('click', (this as any).onClick)\n    this.parentElement!.removeEventListener('contextmenu', this.onContextmenu)\n  }\n  getBoundingClientRect() {\n    return this.parentElement!.getBoundingClientRect()\n  }\n  onContextmenu(event: MouseEvent) {\n    if (this.button === 2) event.preventDefault()\n  }\n  onPointerdown(event: PointerEvent) {\n    event.stopPropagation()\n\n    this.$options.style.left = `${event.clientX}px`\n    this.$options.style.top = `${event.clientY}px`\n\n    this.parentElement!.addEventListener('pointermove', this.onPointermove)\n    this.parentElement!.addEventListener('pointerleave', this.onPointerleave)\n    this.parentElement!.addEventListener('pointerup', this.onPointerup)\n\n    clearTimeout(this._contextTimeout)\n    if (event.pointerType !== 'touch') {\n      if (event.button === this.button) {\n        this.setPointerCapture(event.pointerId)\n        this.expanded = true\n        // TODO: keyboard focus navigation\n      }\n    } else {\n      // iOS Safari contextmenu event emulation.\n      event.preventDefault()\n      this._contextTimeout = setTimeout(() => {\n        this.setPointerCapture(event.pointerId)\n        this.expanded = true\n        // TODO: keyboard focus navigation\n      }, 150)\n    }\n    onOverlayPointerdown.call(this, event)\n  }\n  onPointermove(event: PointerEvent) {\n    event.stopPropagation()\n    clearTimeout(this._contextTimeout)\n    if (event.pointerType === 'touch') {\n      // Let touch scroll the document.\n      if (!this.expanded) return\n    }\n    onOverlayPointermove.call(this, event)\n  }\n  onPointerup(event: PointerEvent) {\n    clearTimeout(this._contextTimeout)\n    this.releasePointerCapture(event.pointerId)\n    this.parentElement!.removeEventListener('pointermove', this.onPointermove)\n    this.parentElement!.removeEventListener('pointerleave', this.onPointerleave)\n    this.parentElement!.removeEventListener('pointerup', this.onPointerup)\n    onOverlayPointeup.call(this, event)\n  }\n  onPointerleave(event: PointerEvent) {\n    this.releasePointerCapture(event.pointerId)\n    this.parentElement!.removeEventListener('pointermove', this.onPointermove)\n    this.parentElement!.removeEventListener('pointerleave', this.onPointerleave)\n    this.parentElement!.removeEventListener('pointerup', this.onPointerup)\n  }\n  collapse() {\n    Overlay.collapse()\n  }\n}\nexport const ioContextMenu = function(arg0?: IoContextMenuProps) {\n  return IoContextMenu.vConstructor(arg0)\n}"],"names":["MenuOption","ReactiveNode","Listeners","constructor","args","id","String","value","label","options","map","option","selectedOptions","filter","mode","selected","i","length","console","warn","super","getAllOptions","this","push","ids","Set","has","add","findItemByValue","allItems","findItemById","selectDefault","walker","next","find","selectedChanged","unselectSuboptions","dispatch","selectedIDChanged","selectedID","selectedIDImmediateChanged","selectedIDImmediate","updatePaths","getSelectedIDImmediate","item","setSelectedIDImmediate","withInternalOperation","dispatchMutation","onOptionSelectedChanged","event","indexOf","detail","selectedOption","some","setProperties","path","join","pathChanged","split","optionsMutated","toJSON","icon","hint","disabled","fromJSON","json","changed","action","dispose","__decorateClass","ReactiveProperty","type","prototype","Boolean","NodeArray","init","Register","MenuElementTags","MenuElementTagsSelector","getMenuDescendants","element","descendants","$options","querySelectorAll","Array","from","getMenuAncestors","ancestors","$parent","getMenuSiblings","siblings","parent","parentElement","getMenuRoot","root","isPointerAboveIoMenuItem","localName","IoOverlaySingleton","expanded","r","getBoundingClientRect","x","clientX","y","clientY","top","bottom","left","right","matchMenuOption","search","toLowerCase","searchMenuOption","depth","d","subitems","IoMenuOptions","IoElement","Style","touchstart","inoverlay","Overlay","contains","stopPropagation","connectedCallback","setAttribute","onIoFocusTo","source","cmd","command","index","parentIsAbove","parentIsBelow","parentIsLeft","parentIsRight","rect","parentRect","cmdOverride","horizontal","focus","collapse","optionWasFocused","document","activeElement","searchHadInput","searchable","forEach","descendant","$","expandedChanged","debounce","onExpandInOverlay","style","height","scrollTop","searchChanged","nudge","direction","vChildren","widget","ioString","role","bind","placeholder","live","filteredItems","ioField","ioMenuItem","tag","props","class","span","render","reflect","Property","ioMenuOptions","arg0","vConstructor","timeoutOpen","hovered","prevHovered","onOverlayPointerdown","onOverlayPointermove","clearTimeout","getHoveredMenuItem","sort","a","b","first","second","v","Math","abs","movementY","movementX","h","setTimeout","onOverlayPointeup","onClick","addEventListener","IoMenuItem","IoField","click","blur","preventDefault","hasmore","appendChild","disconnectedCallback","removeChild","o","apply","collapseRoot","onPointerdown","pointerType","setPointerCapture","pointerId","call","onPointermove","onPointerup","onPointerupAction","onFocus","$allitems","$ancestoritems","onBlur","onBlurDebounced","_disposed","descendantIsFocused","siblingIsFocused","sibling","ancestorIsFocused","ancestor","nothingIsFocused","body","fucusLeftOverlay","onKeydown","optionsAreAbove","optionsAreBelow","optionsAreLeft","optionsAreRight","optionsRect","key","children","querySelector","optionChanged","initOptions","optionMutated","ioIcon","IoMenuHamburger","ioMenuHamburger","IoMenuTreeBranch","clearFocusBacktrack","ioBoolean","true","false","ioMenuTree","Number","ioMenuTreeBranch","genObjectStorageID","object","string","JSON","stringify","hash","imul","charCodeAt","IoMenuTree","onResized","addMenuOptionsOrTreeBranches","elements","subOption","collapsibleState","storage","Infinity","IoOptionSelect","onOptionSelected","selectBy","inputValue","oldValue","setProperty","change","removeEventListener","selectedItem","ioOptionSelect","IoContextMenu","ReactiveProperties","onContextmenu","button","onPointerleave","_contextTimeout","releasePointerCapture","ioContextMenu"],"mappings":"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"}