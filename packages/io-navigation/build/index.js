import{ReactiveProperty as e,Property as t,Register as o,IoElement as i,div as n,disposeChildren as r}from"io-gui";import{ioBoolean as s,ioField as l}from"io-inputs";import{MenuOptions as c,ioMenuItem as d,MenuItem as h,ioMenuOptions as a,ioMenuTree as p}from"io-menus";var __decorate$2=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};let u=class IoCollapsible extends i{static vConstructor;static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n      flex-shrink: 0;\n      align-self: stretch;\n      box-sizing: content-box;\n      align-items: stretch;\n      align-self: stretch;\n      border: var(--io_border);\n      border-radius: calc(var(--io_borderRadius) - var(--io_spacing));\n      border-color: var(--io_borderColorOutset);\n      min-height: var(--io_fieldHeight);\n      background-color: var(--io_bgColorLight);\n    }\n    :host > io-boolean {\n      flex: 0 0 auto;\n      padding-left: 0;\n      margin: var(--io_spacing) var(--io_spacing2);\n      border-radius: 0;\n      background-color: transparent;\n    }\n    :host > io-boolean:before {\n      text-align: center;\n      width: var(--io_lineHeight);\n      margin-right: var(--io_spacing2);\n      content: "▸"\n    }\n    :host > io-boolean[value]:before {\n      content: "▾"\n    }\n    :host > div.io-collapsible-content {\n      position: relative;\n      display: flex;\n      align-items: flex-start;\n      flex-direction: column;\n      overflow: auto;\n      background-color: var(--io_bgColorStrong);\n    }\n    :host[direction=row] > div.io-collapsible-content {\n      flex-direction: row;\n    }\n    :host > div.io-collapsible-content:not(:empty) {\n      margin: var(--io_spacing);\n      margin-top: 0;\n      padding: var(--io_spacing);\n      border-radius: var(--io_borderRadius);\n    }\n    '}changed(){this.render([s({icon:this.icon,true:this.label,false:this.label,value:this.bind("expanded")}),n({class:"io-collapsible-content"},this.expanded?this.elements:[])])}};__decorate$2([e(Array)],u.prototype,"elements",void 0),__decorate$2([e("")],u.prototype,"label",void 0),__decorate$2([e({value:"column",reflect:!0})],u.prototype,"direction",void 0),__decorate$2([e("")],u.prototype,"icon",void 0),__decorate$2([e({value:!1,reflect:!0})],u.prototype,"expanded",void 0),__decorate$2([t("region")],u.prototype,"role",void 0),u=__decorate$2([o],u);const g=u.vConstructor;var __decorate$1=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};const v=document.createElement("div"),f={};function importModule(e){const t=new URL(e,String(window.location)).pathname;return new Promise((o=>{!e||f[t]?o(t):import(t).then((()=>{f[t]=!0,o(t)}))}))}let b=class IoSelector extends i{static vConstructor;static get Style(){return"\n      :host {\n        display: flex;\n        flex-direction: column;\n        position: relative;\n        overflow-y: auto !important;\n        flex: 1 1 auto;\n        justify-content: stretch;\n      }\n      @keyframes io-loading-spinner {\n        to {\n          transform: rotate(360deg);\n        }\n      }\n      :host[loading]:after {\n        content: '';\n        box-sizing: border-box;\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        width: 4em;\n        height: 4em;\n        margin-top: calc(-1 * var(--io_fieldHeight));\n        margin-left: calc(-1 * var(--io_fieldHeight));\n        border-radius: 50%;\n        border: var(--io_border);\n        border-color: var(--io_borderColorStrong);\n        border-top-color: var(--io_colorBlue);\n        animation: io-loading-spinner .6s linear infinite;\n      }\n    "}static get Listeners(){return{scroll:"onScrollChanged"}}constructor(e={}){super(e)}init(){this.preacheNext=this.preacheNext.bind(this),this.startPreache=this.startPreache.bind(this),this.renderSelected=this.renderSelected.bind(this),this.renderDebounced=this.renderDebounced.bind(this),this.scrollChangedDebounced=this.scrollChangedDebounced.bind(this),this.scrollToUnsuspend=this.scrollToUnsuspend.bind(this),this.onScrollUnsuspend=this.onScrollUnsuspend.bind(this)}scrollChanged(){this.scrollToSuspended||(this.onScrollSuspended=!0,this.debounce(this.onScrollUnsuspend,void 0,120)),this.debounce(this.scrollChangedDebounced,void 0,3)}scrollChangedDebounced(){const e=this.scroll.split("#")[1]||this.scroll;if(!e||this.scrollToSuspended)return;const t=this.querySelector(`[data-heading="${e}"]`);if(t){const e=window.getComputedStyle(t),o=t.offsetTop-parseInt(e.marginTop);this.scrollTo({top:o,behavior:"smooth"})}else this.scrollTo(0,0)}scrollToUnsuspend(){this.scrollToSuspended=!1}onScrollUnsuspend(){this.onScrollSuspended=!1}onScrollChanged(){if(this.onScrollSuspended)return;const e=this.scroll.split("#")[1]||this.scroll,t=this.querySelectorAll("[data-heading]"),o=Array.from(t).reduce(((e,t)=>Math.abs(t.offsetTop-this.scrollTop)<Math.abs(e.offsetTop-this.scrollTop)?t:e),t[0]);if(o){const t=o.getAttribute("data-heading");t&&t!==e&&(this.scrollToSuspended=!0,2===this.scroll.split("#").length?this.scroll=this.scroll.split("#")[0]+"#"+t:this.scroll=t,this.debounce(this.scrollToUnsuspend,void 0,120))}}optionsChanged(){this.debounce(this.renderSelected)}optionsMutated(){this.debounce(this.renderSelected)}elementsChanged(){this.startPreache()}renderSelected(){if("shallow"===this.select){for(let e=0;e<this.options.items.length;e++)if(this.options.items[e].selected)return void this.renderSelectedId(this.options.items[e].id)}else"deep"===this.select?this.renderSelectedId(this.options.selected):"none"===this.select&&this.render(this.elements);this.debounce(this.scrollChangedDebounced,void 0,2)}renderSelectedId(e){const t="proactive"===this.caching||"reactive"===this.caching;if(!e)return this.render([],this,t),void this.scrollTo(0,0);if((e=e.split("#")[0])===this.childNodes[0]?.id)return;this.render([],this,t),this.scrollTo(0,0);const o=this.elements.find((t=>t.props?.id===e));if(!o)return console.warn(`IoSelector: Could not find elements with id: ${e}!`,this.elements),void this.render([l({label:`Could not find elements with id: ${e}!`})],this,t);const i=o.props?.import;i?(this.loading=!0,this._preaching=!1,importModule(i).then((()=>{this.loading=!1,this.debounce(this.renderDebounced,o),this.debounce(this.startPreache)}))):this.debounce(this.renderDebounced,o)}renderDebounced(e){const t="proactive"===this.caching||"reactive"===this.caching,o=e.props?.id,i=this._caches[o];t&&i?i.parentElement!==this&&(this.firstChild&&this.removeChild(this.firstChild),this.appendChild(i)):(this.render([e],this,t),t&&(this._caches[o]=this.childNodes[0]))}startPreache(){"proactive"!==this.caching||this._preaching||(this._preaching=!0,this.debounce(this.preacheNext))}preacheNext(){if(this._preaching){for(let e=0;e<this.elements.length;e++){const t=this.elements[e],o=t.props,i=o.id;if(i&&void 0===this._caches[i])return o.import?void importModule(o.import).then((()=>{this._preaching&&(this.render([t],v,!0),this._caches[i]=v.childNodes[0],v.removeChild(v.childNodes[0]),this.debounce(this.preacheNext),delete o.import)})):(this.render([t],v,!0),this._caches[i]=v.childNodes[0],v.removeChild(v.childNodes[0]),void this.debounce(this.preacheNext))}this._preaching=!1}}dispose(){for(const e in this._caches)this._caches[e].parentElement||r(this._caches[e]),delete this._caches[e];super.dispose()}};__decorate$1([e({type:c,init:null})],b.prototype,"options",void 0),__decorate$1([e(Array)],b.prototype,"elements",void 0),__decorate$1([e({value:"shallow",type:String})],b.prototype,"select",void 0),__decorate$1([e({value:"reactive",type:String})],b.prototype,"caching",void 0),__decorate$1([e({value:!1,type:Boolean,reflect:!0})],b.prototype,"loading",void 0),__decorate$1([e({value:"",type:String})],b.prototype,"scroll",void 0),__decorate$1([t(Object)],b.prototype,"_caches",void 0),__decorate$1([t(!1)],b.prototype,"_preaching",void 0),__decorate$1([t(!1)],b.prototype,"scrollToSuspended",void 0),__decorate$1([t(!1)],b.prototype,"onScrollSuspended",void 0),b=__decorate$1([o],b);const m=b.vConstructor;var __decorate=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};let y=class IoNavigator extends i{static vConstructor;static get Style(){return"\n      :host {\n        display: flex;\n        flex-direction: column;\n        flex: 1 1 auto;\n      }\n      :host[menu=left],\n      :host[menu=right] {\n        flex-direction: row;\n      }\n      :host > io-menu-tree {\n        align-self: stretch;\n        flex: 0 0 auto;\n        min-width: 10em;\n        border: var(--io_border);\n        overflow-y: auto;\n        border-radius: 0;\n      }\n      :host[menu=left] > io-menu-tree {\n        border-width: 0 var(--io_borderWidth) 0 0;\n      }\n      :host[menu=left] > io-menu-tree {\n        border-width: 0 var(--io_borderWidth) 0 0;\n      }\n      :host > io-menu-options {\n        border: none;\n        border-bottom: var(--io_border);\n        border-radius: 0;\n      }\n    "}changed(){const e={options:this.options,widget:this.widget,depth:this.depth},t=d({depth:this.depth,role:"navigation",class:"hamburger",direction:"left"===this.menu?"right":"left",item:new h({mode:"none",icon:"menu:hamburger",options:this.options})});"top"===this.menu?this.render([a({horizontal:!0,...e}),m({options:this.options,caching:this.caching,select:this.select,scroll:this.bind("scroll"),elements:this.elements})]):"left"===this.menu?this.render([this.collapsed?t:p({...e}),m({options:this.options,caching:this.caching,select:this.select,scroll:this.bind("scroll"),elements:this.elements})]):"right"===this.menu&&this.render([m({options:this.options,caching:this.caching,select:this.select,scroll:this.bind("scroll"),elements:this.elements}),this.collapsed?t:p({...e})])}};__decorate([e(Array)],y.prototype,"elements",void 0),__decorate([e({type:c,init:null})],y.prototype,"options",void 0),__decorate([e(null)],y.prototype,"widget",void 0),__decorate([e({value:"left",type:String,reflect:!0})],y.prototype,"menu",void 0),__decorate([e({value:Infinity,type:Number})],y.prototype,"depth",void 0),__decorate([e({value:!1,type:Boolean,reflect:!0})],y.prototype,"collapsed",void 0),__decorate([e({value:580,type:Number})],y.prototype,"collapseWidth",void 0),__decorate([e({value:"shallow",type:String})],y.prototype,"select",void 0),__decorate([e({value:"none",type:String})],y.prototype,"caching",void 0),__decorate([e({value:"",type:String})],y.prototype,"scroll",void 0),y=__decorate([o],y);const S=y.vConstructor;export{u as IoCollapsible,y as IoNavigator,b as IoSelector,g as ioCollapsible,S as ioNavigator,m as ioSelector};
