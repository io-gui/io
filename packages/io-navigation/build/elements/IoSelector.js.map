{"version":3,"file":"IoSelector.js","sourceRoot":"","sources":["../../src/elements/IoSelector.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, VDOMElement, IoElementProps, disposeChildren, ReactiveProperty, WithBinding, Property, span } from 'io-core'\n\nconst dummyElement = document.createElement('div')\n/**\n * Element selector. Displays one of the virtual elements assigned in the `elements` property as its child if the name of the element matches the `value` property.\n * If `cache` property is set to `true`, a reference to the element will be kept fo later use.\n **/\n\n// TODO: consider moving io-selectior to core elements\n\nconst IMPORTED_PATHS: Record<string, any> = {}\nfunction importModule(path: string) {\n  const importPath = new URL(path, String(window.location)).pathname\n  return new Promise(resolve => {\n    if (!path || IMPORTED_PATHS[importPath]) {\n      resolve(importPath)\n    } else {\n      void import(importPath)\n      .then(() => {\n        IMPORTED_PATHS[importPath] = true\n        resolve(importPath)\n      })\n    }\n  })\n};\n\nexport type CachingType = 'proactive' | 'reactive' | 'none'\n\nexport type IoSelectorProps = IoElementProps & {\n  elements?: VDOMElement[]\n  selected?: WithBinding<string>\n  anchor?: WithBinding<string>\n  caching?: CachingType\n  loading?: WithBinding<boolean>\n  import?: string // TODO: move to core?\n}\n\n@Register\nexport class IoSelector extends IoElement {\n\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex-direction: column;\n        position: relative;\n        overflow-y: auto !important;\n        flex: 1 1 auto;\n        justify-content: stretch;\n      }\n      @keyframes io-loading-spinner {\n        to {\n          transform: rotate(360deg);\n        }\n      }\n      :host[loading]:after {\n        content: '';\n        box-sizing: border-box;\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        width: 4em;\n        height: 4em;\n        margin-top: calc(-1 * var(--io_fieldHeight));\n        margin-left: calc(-1 * var(--io_fieldHeight));\n        border-radius: 50%;\n        border: var(--io_border);\n        border-color: var(--io_borderColorStrong);\n        border-top-color: var(--io_colorBlue);\n        animation: io-loading-spinner .6s linear infinite;\n      }\n    `\n  }\n\n  @ReactiveProperty(Array)\n  declare elements: VDOMElement[]\n\n  @ReactiveProperty({value: '', type: String})\n  declare selected: string\n\n  // TODO: Setting anchor offscreen will not update once it is in the dom.\n  @ReactiveProperty({value: '', type: String})\n  declare anchor: string\n\n  @ReactiveProperty({value: 'reactive', type: String})\n  declare caching: CachingType\n\n  @ReactiveProperty({value: false, type: Boolean, reflect: true})\n  declare loading: boolean\n\n  @Property(Object)\n  declare private _caches: Record<string, IoElement | HTMLElement>\n\n  @Property(false)\n  declare private _preaching: boolean\n\n  @Property(false)\n  declare private scrollToSuspended: boolean\n\n  @Property(false)\n  declare private onScrollSuspended: boolean\n\n  static get Listeners() {\n    return {\n      scroll: 'onScrollChanged',\n    }\n  }\n  constructor(args: IoSelectorProps = {}) { super(args) }\n  init() {\n    this.preacheNext = this.preacheNext.bind(this)\n    this.startPreache = this.startPreache.bind(this)\n    this.renderDebounced = this.renderDebounced.bind(this)\n    this.anchorChangedDebounced = this.anchorChangedDebounced.bind(this)\n    this.scrollToUnsuspend = this.scrollToUnsuspend.bind(this)\n    this.onScrollUnsuspend = this.onScrollUnsuspend.bind(this)\n  }\n  anchorChanged() {\n    if (!this.scrollToSuspended) {\n      this.onScrollSuspended = true\n      this.debounce(this.onScrollUnsuspend, undefined, 120)\n    }\n    this.debounce(this.anchorChangedDebounced, undefined, 3)\n  }\n  anchorChangedDebounced() {\n    const anchor = this.anchor.split('#')[1] || this.anchor\n    if (!anchor || this.scrollToSuspended) return\n    const heading = this.querySelector(`[data-heading=\"${anchor}\"]`)\n    if (heading) {\n      const style = window.getComputedStyle(heading)\n      const top = (heading as HTMLElement).offsetTop - parseInt(style.marginTop)\n      this.scrollTo({top: top, behavior: 'smooth'})\n    } else {\n      this.scrollTo(0, 0)\n    }\n  }\n  scrollToUnsuspend() {\n    this.scrollToSuspended = false\n  }\n  onScrollUnsuspend() {\n    this.onScrollSuspended = false\n  }\n  onScrollChanged() {\n    if (this.onScrollSuspended) return\n    const anchor = this.anchor.split('#')[1] || this.anchor\n    const headings = this.querySelectorAll('[data-heading]') as NodeListOf<HTMLElement>\n    const closestHeading = Array.from(headings).reduce((prev, curr) => {\n      return (Math.abs(curr.offsetTop - this.scrollTop) < Math.abs(prev.offsetTop - this.scrollTop) ? curr : prev)\n    }, headings[0])\n    if (closestHeading) {\n      const current = closestHeading.getAttribute('data-heading')\n      if (current && current !== anchor) {\n        this.scrollToSuspended = true\n        if (this.anchor.split('#').length === 2) {\n          // TODO: triggers missing id warning if menuoptions dont include id when you scroll dcs to the top\n          this.anchor = this.anchor.split('#')[0] + '#' + current\n        } else {\n          this.anchor = current\n        }\n        this.debounce(this.scrollToUnsuspend, undefined, 120)\n      }\n    }\n  }\n  elementsChanged() {\n    // TODO: make sure all elements have props and id if selectable!\n    // TODO: fix and test edge case where reusing element in templete() might return cache from the previous element if keys collide!\n    this.startPreache()\n  }\n  selectedChanged() {\n    if (!this.selected) {\n      this.render([], this, true)\n    } else if (this.selected === '*') {\n      this.render(this.elements)\n    } else {\n      this.renderSelectedId(this.selected)\n    }\n    this.debounce(this.anchorChangedDebounced, undefined, 2)\n  }\n\n  renderSelectedId(id: string) {\n    const cache = this.caching === 'proactive' || this.caching === 'reactive'\n\n    if (!id) {\n      this.render([], this, cache)\n      this.scrollTo(0, 0)\n      return\n    }\n\n    id = id.split('#')[0]\n    // TODO: what if <io-selector> is reused in template() and ID collides?\n    if (id === (this.childNodes[0] as IoElement)?.id) return\n\n    this.render([], this, cache)\n    this.scrollTo(0, 0)\n\n    const vElement = this.elements.find((element: VDOMElement) => { return element.props?.id === id })\n\n    if (!vElement) {\n      console.warn(`IoSelector: Could not find elements with id: \"${id}\"!`)\n      this.render([span(`Could not find elements with id: \"${id}\"!`)], this, cache)\n      return\n    }\n\n    const importPath = vElement.props?.import\n\n    if (!importPath) {\n      this.debounce(this.renderDebounced, vElement)\n    } else {\n      this.loading = true\n      this._preaching = false\n      void importModule(importPath).then(() => {\n        this.loading = false\n        this.debounce(this.renderDebounced, vElement)\n        this.debounce(this.startPreache)\n      })\n    }\n  }\n  renderDebounced(vElement: VDOMElement) {\n    const cache = this.caching === 'proactive' || this.caching === 'reactive'\n    const id = vElement.props?.id\n    const cachedElement = this._caches[id]\n    if (cache && cachedElement) {\n      if ((cachedElement.parentElement as IoElement) !== this) {\n        if (this.firstChild) this.removeChild(this.firstChild)\n        this.appendChild(cachedElement as Node)\n      }\n    } else {\n      this.render([vElement], this, cache)\n      if (cache) {\n        this._caches[id] = this.childNodes[0] as IoElement\n      }\n    }\n  }\n  startPreache() {\n    if (this.caching === 'proactive' && !this._preaching) {\n      this._preaching = true\n      this.debounce(this.preacheNext)\n    }\n  }\n  preacheNext() {\n    // TODO: Test this!\n    if (!this._preaching) return\n    for (let i = 0; i < this.elements.length; i++) {\n      const vElement = this.elements[i]\n      const props = vElement.props!\n      const id = props.id\n      if (id && this._caches[id] === undefined) {\n        if (!props.import) {\n          this.render([vElement], dummyElement, true)\n          this._caches[id] = dummyElement.childNodes[0] as HTMLElement\n          dummyElement.removeChild(dummyElement.childNodes[0])\n          this.debounce(this.preacheNext)\n          return\n        } else {\n          void importModule(props.import).then(() => {\n            if (!this._preaching) return\n            this.render([vElement], dummyElement, true)\n            this._caches[id] = dummyElement.childNodes[0] as HTMLElement\n            dummyElement.removeChild(dummyElement.childNodes[0])\n            this.debounce(this.preacheNext)\n            delete props.import\n          })\n          return\n        }\n      }\n    }\n    this._preaching = false\n  }\n  dispose() {\n    for (const key in this._caches) {\n      // Dispose cached elements not in the DOM.\n      if (!this._caches[key].parentElement) {\n        disposeChildren(this._caches[key] as IoElement)\n      }\n      delete this._caches[key]\n    }\n    super.dispose()\n  }\n}\nexport const ioSelector = function(arg0?: IoSelectorProps) {\n  return IoSelector.vConstructor(arg0)\n}"]}