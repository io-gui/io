{"version":3,"file":"IoTab.js","sourceRoot":"","sources":["../../src/elements/IoTab.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAE,QAAQ,EAAE,gBAAgB,EAAE,IAAI,EAAE,MAAM,cAAc,CAAA;AAC/D,OAAO,EAAE,OAAO,EAAgB,QAAQ,EAAE,QAAQ,EAAE,MAAM,gBAAgB,CAAA;AAC1E,OAAO,EAAE,wBAAwB,EAAE,MAAM,iBAAiB,CAAA;AAC1D,OAAO,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,eAAe,CAAA;AACjD,OAAO,EAAmB,UAAU,EAAE,cAAc,EAAE,MAAM,eAAe,CAAA;AAG3E,OAAO,EAAE,GAAG,EAAE,MAAM,iBAAiB,CAAA;AACrC,OAAO,EAAE,oBAAoB,EAAE,MAAM,oBAAoB,CAAA;AAEzD,MAAM,KAAK,GAAsB,EAAE,CAAA;AACnC,KAAK,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC;IACzC,KAAK,MAAM,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;QAC/C,MAAM,EAAE,GAAG,GAAG,GAAG,IAAI,IAAI,EAAE,CAAA;QAC3B,KAAK,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC,CAAA;IAC7C,CAAC;AACH,CAAC;AAED,MAAM,WAAW,GAAG,cAAc,CAAC,EAAC,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,UAAU,CAAC,EAAC,OAAO,EAAE,KAAK,EAAC,CAAC,EAAC,CAAC,CAAA;AAMhH,0DAA0D;AAEnD,IAAM,KAAK,GAAX,MAAM,KAAM,SAAQ,OAAO;IAChC,MAAM,KAAK,KAAK;QACd,OAAO,SAAS,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KAqDf,CAAA;IACH,CAAC;IAQD,MAAM,KAAK,SAAS;QAClB,OAAO;YACL,OAAO,EAAE,gBAAgB;YACzB,aAAa,EAAE,eAAe;SAC/B,CAAA;IACH,CAAC;IAED,YAAY,IAAgB,IAAI,KAAK,CAAC,IAAI,CAAC,CAAA,CAAC,CAAC;IAE7C,SAAS;QACP,MAAM,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAE,CAAA;QACxC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAA;IACrD,CAAC;IACD,WAAW,CAAC,KAAiB;QAC3B,KAAK,CAAC,cAAc,EAAE,CAAA;IACxB,CAAC;IACD,cAAc,CAAC,KAAY;QACzB,KAAK,CAAC,eAAe,EAAE,CAAA;QACvB,KAAK,CAAC,cAAc,EAAE,CAAA;IACxB,CAAC;IACD,oBAAoB;IACpB,aAAa,CAAC,KAAiB;QAC7B,KAAK,CAAC,eAAe,EAAE,CAAA;QACvB,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,IAAI,CAAC,mBAAmB,EAAE,CAAA;IAC5B,CAAC;IACD,aAAa,CAAC,KAAmB;QAC/B,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,KAAK,CAAC,eAAe,EAAE,CAAA;QACvB,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,SAAS,CAAC,CAAA;QACvC,oBAAoB,CAAC,gBAAgB,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,CAAA;QACnE,KAAK,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;QAC1B,IAAI,KAAK,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;YACxB,IAAI,CAAC,KAAK,EAAE,CAAA;QACd,CAAC;IACH,CAAC;IACD,aAAa,CAAC,KAAmB;QAC/B,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,IAAI,KAAK,CAAC,OAAO,KAAK,CAAC;YAAE,OAAM;QAC/B,MAAM,KAAK,GAAG,IAAI,CAAC,aAAc,CAAC,aAAwB,CAAA;QAC1D,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAY,CAAA;QACtD,oBAAoB,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,EAAE,KAAK,EAAE,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,CAAA;IACtF,CAAC;IACD,WAAW,CAAC,KAAmB;QAC7B,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,CAAA;QACxB,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,SAAS,CAAC,CAAA;QAC3C,IAAI,oBAAoB,CAAC,QAAQ,EAAE,CAAC;YAClC,oBAAoB,CAAC,OAAO,EAAE,CAAA;QAChC,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,OAAO,EAAE,CAAA;QAChB,CAAC;IACH,CAAC;IACD,eAAe,CAAC,KAAmB;QACjC,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,KAAK,CAAC,eAAe,EAAE,CAAA;QACvB,KAAK,CAAC,eAAe,CAAC,KAAK,CAAC,CAAA;QAC5B,oBAAoB,CAAC,UAAU,EAAE,CAAA;IACnC,CAAC;IACD,cAAc,CAAC,KAAmB;QAChC,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,KAAK,CAAC,eAAe,EAAE,CAAA;IACzB,CAAC;IACD,OAAO;QACL,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,EAAC,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,QAAQ,EAAC,EAAE,IAAI,CAAC,CAAA;IACpE,CAAC;IACD,aAAa;QACX,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,EAAC,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,WAAW,EAAC,EAAE,IAAI,CAAC,CAAA;IACvE,CAAC;IACD,mBAAmB;QACjB,MAAM,YAAY,GAAG,GAAG,EAAE;YACxB,wBAAwB,CAAC,QAAQ,GAAG,KAAK,CAAA;YACzC,IAAI,CAAC,aAAa,EAAE,CAAA;QACtB,CAAC,CAAA;QACD,wBAAwB,CAAC,MAAM,CAAC;YAC9B,MAAM,EAAE,IAAI;YACZ,SAAS,EAAE,MAAM;YACjB,KAAK,EAAE,IAAI,CAAC,GAAG;YACf,UAAU,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC;YAC7B,MAAM,EAAE;gBACN,CAAC,OAAO,EAAE,QAAQ,CAAC,EAAC,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;gBACjC,CAAC,MAAM,EAAE,WAAW,CAAC;aACtB;YACD,MAAM,EAAE,QAAQ,CAAC,EAAC,KAAK,EAAE,YAAY,EAAE,IAAI,EAAE,UAAU,EAAE,MAAM,EAAE,YAAY,EAAC,CAAC;SAChF,CAAC,CAAA;IACJ,CAAC;IACD,SAAS,CAAC,KAAoB;QAC5B,IAAI,KAAK,CAAC,QAAQ,IAAI,CAAC,WAAW,EAAE,WAAW,EAAE,YAAY,EAAE,SAAS,EAAE,WAAW,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC;YAC1H,KAAK,CAAC,cAAc,EAAE,CAAA;YACtB,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,EAAC,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,KAAK,CAAC,GAAG,EAAC,EAAE,IAAI,CAAC,CAAA;QACrE,CAAC;aAAM,IAAI,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,GAAG,KAAK,OAAO,EAAE,CAAC;YACnD,IAAI,CAAC,mBAAmB,EAAE,CAAA;QAC5B,CAAC;aAAM,CAAC;YACN,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,CAAA;QACxB,CAAC;IACH,CAAC;IACD,UAAU;QACR,IAAI,CAAC,OAAO,EAAE,CAAA;IAChB,CAAC;IACD,OAAO;QACL,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;QAChD,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;QAC1C,IAAI,CAAC,MAAM,CAAC;YACV,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,oBAAoB,EAAC,CAAC,CAAC,CAAC,CAAC,IAAI;YAC9D,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,EAAC,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,EAAC,CAAC,CAAC,CAAC,CAAC,IAAI;YACrD,IAAI,CAAC,EAAC,KAAK,EAAE,cAAc,EAAC,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;SAC9C,CAAC,CAAA;IACJ,CAAC;CACF,CAAA;AAjHS;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,GAAG,EAAC,CAAC;kCACd;AAGR;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAC,CAAC;uCACxB;AA9Dd,KAAK;IADjB,QAAQ;GACI,KAAK,CA4KjB;;AAED,MAAM,CAAC,MAAM,KAAK,GAAG,UAAS,IAAgB;IAC5C,OAAO,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;AACjC,CAAC,CAAA","sourcesContent":["import { Register, ReactiveProperty, span } from '@io-gui/core'\nimport { IoField, IoFieldProps, ioString, ioButton } from '@io-gui/inputs'\nimport { IoContextEditorSingleton } from '@io-gui/editors'\nimport { IconsetDB, ioIcon } from '@io-gui/icons'\nimport { MenuOptionProps, MenuOption, ioOptionSelect } from '@io-gui/menus'\nimport { IoPanel } from './IoPanel.js'\nimport { IoSplit } from './IoSplit.js'\nimport { Tab } from '../nodes/Tab.js'\nimport { tabDragIconSingleton } from './IoTabDragIcon.js'\n\nconst icons: MenuOptionProps[] = []\nfor (const set of Object.keys(IconsetDB)) {\n  for (const icon of Object.keys(IconsetDB[set])) {\n    const id = `${set}:${icon}`\n    icons.push({value: id, id: icon, icon: id})\n  }\n}\n\nconst iconOptions = ioOptionSelect({selectBy: 'value', label: 'Icon', option: new MenuOption({options: icons})})\n\nexport type IoTabProps = IoFieldProps & {\n  tab: Tab\n}\n\n// TODO: fix and improve keyboard navigation in all cases.\n@Register\nexport class IoTab extends IoField {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        position: relative;\n        height: inherit;\n        min-height: inherit;\n        /* TODO: use vars for this */\n        min-width: calc(var(--io_fieldHeight) * 1.25);\n        margin: 0;\n        margin-right: var(--io_spacing);\n        background-color: var(--io_bgColor) !important;\n        border-bottom-left-radius: 0;\n        border-bottom-right-radius: 0;\n        border-color: var(--io_borderColorLight);\n        padding-right: calc(var(--io_lineHeight) / 2);\n        padding-left: calc(var(--io_lineHeight) / 2);\n      }\n      :host[pressed] {\n        border-color: unset !important;\n        box-shadow: unset !important;\n      }\n      :host[selected] {\n        color: var(--io_colorStrong);\n        background-color: var(--io_bgColorLight) !important;\n        border-color: var(--io_borderColorStrong);\n        border-bottom-color: var(--io_bgColorLight);\n        z-index: 1;\n      }\n      :host[selected]:focus {\n        color: var(--io_colorWhite);\n        z-index: 2;\n      }\n      :host > .io-icon:not([value=' ']) {\n        margin: 0 var(--io_spacing2) 0 0;\n      }\n      :host > .io-tab-drop-marker {\n        position: absolute;\n        top: 0;\n        left: 0;\n        height: 100%;\n        background-color: var(--io_bgColorBlue);\n        border-bottom-right-radius: var(--io_borderRadius);\n      }\n      :host > span {\n        padding: 0 var(--io_spacing);\n        overflow: hidden; \n        text-overflow: ellipsis !important;\n      }\n      :host > * {\n        pointer-events: none;\n        display: inline-block;\n        white-space: nowrap;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: Tab})\n  declare tab: Tab\n\n  @ReactiveProperty({type: Boolean, reflect: true})\n  declare overflow: boolean\n\n  static get Listeners() {\n    return {\n      'click': 'preventDefault',\n      'contextmenu': 'onContextMenu',\n    }\n  }\n\n  constructor(args: IoTabProps) { super(args) }\n\n  onResized() {\n    const span = this.querySelector('span')!\n    this.overflow = span.scrollWidth > span.clientWidth\n  }\n  onTouchmove(event: TouchEvent) {\n    event.preventDefault()\n  }\n  preventDefault(event: Event) {\n    event.stopPropagation()\n    event.preventDefault()\n  }\n  // TODO: test on iOS\n  onContextMenu(event: MouseEvent) {\n    event.stopPropagation()\n    event.preventDefault()\n    this.expandContextEditor()\n  }\n  onPointerdown(event: PointerEvent) {\n    event.preventDefault()\n    event.stopPropagation()\n    this.setPointerCapture(event.pointerId)\n    tabDragIconSingleton.setStartPosition(event.clientX, event.clientY)\n    super.onPointerdown(event)\n    if (event.buttons === 1) {\n      this.focus()\n    }\n  }\n  onPointermove(event: PointerEvent) {\n    event.preventDefault()\n    if (event.buttons !== 1) return\n    const panel = this.parentElement!.parentElement as IoPanel\n    const root = this.closest('io-split[root]') as IoSplit\n    tabDragIconSingleton.updateDrag(this.tab, panel, event.clientX, event.clientY, root)\n  }\n  onPointerup(event: PointerEvent) {\n    event.preventDefault()\n    super.onPointerup(event)\n    this.releasePointerCapture(event.pointerId)\n    if (tabDragIconSingleton.dragging) {\n      tabDragIconSingleton.endDrag()\n    } else {\n      this.onClick()\n    }\n  }\n  onPointercancel(event: PointerEvent) {\n    event.preventDefault()\n    event.stopPropagation()\n    super.onPointercancel(event)\n    tabDragIconSingleton.cancelDrag()\n  }\n  onPointerleave(event: PointerEvent) {\n    event.preventDefault()\n    event.stopPropagation()\n  }\n  onClick() {\n    this.dispatch('io-edit-tab', {tab: this.tab, key: 'Select'}, true)\n  }\n  onDeleteClick() {\n    this.dispatch('io-edit-tab', {tab: this.tab, key: 'Backspace'}, true)\n  }\n  expandContextEditor() {\n    const deleteAction = () => {\n      IoContextEditorSingleton.expanded = false\n      this.onDeleteClick()\n    }\n    IoContextEditorSingleton.expand({\n      source: this,\n      direction: 'down',\n      value: this.tab,\n      properties: ['label', 'icon'],\n      config: [\n        ['label', ioString({live: true})],\n        ['icon', iconOptions],\n      ],\n      widget: ioButton({label: 'Delete Tab', icon: 'io:close', action: deleteAction}),\n    })\n  }\n  onKeydown(event: KeyboardEvent) {\n    if (event.shiftKey && ['Backspace', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Home', 'End'].includes(event.key)) {\n      event.preventDefault()\n      this.dispatch('io-edit-tab', {tab: this.tab, key: event.key}, true)\n    } else if (event.shiftKey && event.key === 'Enter') {\n      this.expandContextEditor()\n    } else {\n      super.onKeydown(event)\n    }\n  }\n  tabMutated() {\n    this.changed()\n  }\n  changed() {\n    this.setAttribute('selected', this.tab.selected)\n    this.setAttribute('title', this.tab.label)\n    this.render([\n      this.tab.selected ? span({class: 'io-tab-drop-marker'}) : null,\n      this.tab.icon ? ioIcon({value: this.tab.icon}) : null,\n      span({class: 'io-tab-label'}, this.tab.label),\n    ])\n  }\n}\n\nexport const ioTab = function(arg0: IoTabProps) {\n  return IoTab.vConstructor(arg0)\n}\n"]}