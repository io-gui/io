{"version":3,"file":"IoPanel.js","sourceRoot":"","sources":["../../src/elements/IoPanel.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, VDOMElement, IoElementProps, ReactiveProperty, Property } from '@io-gui/core'\nimport { ioSelector } from '@io-gui/navigation'\nimport { IoMenuItem, MenuOption } from '@io-gui/menus'\nimport { ioTabs } from './IoTabs.js'\nimport { IoSplit, SplitDirection } from './IoSplit.js'\nimport { Tab } from '../nodes/Tab.js'\nimport { Panel } from '../nodes/Panel.js'\n\nexport type IoPanelProps = IoElementProps & {\n  panel: Panel\n  elements: VDOMElement[]\n  addMenuOption?: MenuOption\n}\n\n@Register\nexport class IoPanel extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        overflow: hidden;\n        flex-direction: column;\n        flex: 1 1 auto;\n        background-color: var(--io_bgColorLight);\n      }\n      :host > io-selector {\n        margin-top: calc(-1 * var(--io_borderWidth));\n        border-top: var(--io_border);\n        border-top-color: var(--io_borderColorStrong);\n      }\n    `\n  }\n\n  @ReactiveProperty({type: Object})\n  declare panel: Panel\n\n  @ReactiveProperty(Array)\n  declare elements: VDOMElement[]\n\n  @Property({type: MenuOption})\n  declare addMenuOption: MenuOption | undefined\n\n  static get Listeners() {\n    return {\n      'io-edit-tab': 'onEditTab',\n    }\n  }\n\n  onEditTab(event: CustomEvent) {\n    event.stopPropagation()\n    const tab: Tab = event.detail.tab\n    const key = event.detail.key\n    const index = this.panel.tabs.indexOf(tab)\n    if (index === -1) {\n      debug: console.warn('IoTabs:Tab not found in panel', tab)\n      return\n    }\n    switch (key) {\n      case 'Select': {\n        this.selectTab(tab)\n        break\n      }\n      case 'Backspace': {\n        this.removeTab(tab)\n        break\n      }\n      case 'ArrowLeft': {\n        this.moveTab(tab, index - 1)\n        break\n      }\n      case 'ArrowRight': {\n        this.moveTab(tab, index + 1)\n        break\n      }\n    }\n  }\n  onNewTabClicked(event: CustomEvent) {\n    event.stopPropagation()\n    const option: MenuOption = event.detail.option\n    if (option.id && option.options.length === 0) {\n      const tab = new Tab({id: option.id, label: option.label, icon: option.icon})\n      this.addTab(tab)\n      const addMenuOption = this.querySelector('.io-tabs-add-tab') as IoMenuItem\n      if (addMenuOption) addMenuOption.expanded = false\n    }\n  }\n  selectIndex(index: number) {\n    index = Math.min(index, this.panel.tabs.length - 1)\n    this.panel.setSelected(this.panel.tabs[index].id)\n    this.debounce(this.focusTabDebounced, index)\n  }\n  selectTab(tab: Tab) {\n    const index = this.panel.tabs.indexOf(tab)\n    this.panel.setSelected(tab.id)\n    this.debounce(this.focusTabDebounced, index)\n  }\n  moveTabToSplit(sourcePanel: IoPanel, tab: Tab, direction: SplitDirection) {\n    const parentSplit = this.parentElement as IoSplit\n    if (direction === 'center') {\n      sourcePanel.removeTab(tab)\n      this.addTab(tab)\n    } else {\n      parentSplit.moveTabToSplit(sourcePanel, this.panel, tab, direction)\n    }\n  }\n  addTab(tab: Tab, index?: number) {\n    const existingIndex = this.panel.tabs.findIndex(t => t.id === tab.id)\n    if (existingIndex !== -1) {\n      console.warn(`IoPanel.addTab: Duplicate tab id \"${tab.id}\", removing duplicate tab.`)\n      this.panel.tabs.splice(existingIndex, 1)\n    }\n    index = index ?? this.panel.tabs.length\n    index = Math.min(index, this.panel.tabs.length)\n    this.panel.tabs.splice(index, 0, tab)\n    this.selectIndex(index)\n  }\n  removeTab(tab: Tab) {\n    const index = this.panel.tabs.indexOf(tab)\n    this.panel.tabs.splice(index, 1)\n    if (this.panel.tabs.length > 0) {\n      const newIndex = Math.min(index, this.panel.tabs.length - 1)\n      this.selectIndex(newIndex)\n    } else {\n      const parentSplit = this.parentElement as IoSplit\n      const isRootPanel = parentSplit.hasAttribute('root') &&\n      parentSplit.split.children.length === 1\n      // If this is the last panel at root level, don't remove\n      if (!isRootPanel) {\n        this.dispatch('io-panel-remove', {panel: this.panel}, true)\n      }\n    }\n  }\n  moveTab(tab: Tab, index: number) {\n    index = Math.max(Math.min(index, this.panel.tabs.length - 1), 0)\n    const currIndex = this.panel.tabs.findIndex(t => t.id === tab.id)\n    this.panel.tabs.splice(currIndex, 1)\n    index = Math.min(index, this.panel.tabs.length)\n    this.panel.tabs.splice(index, 0, tab)\n    this.selectIndex(index)\n  }\n  focusTabDebounced(index: number) {\n    const tabs = Array.from(this.querySelectorAll('io-tab')) as HTMLElement[]\n    index = Math.min(index, tabs.length - 1)\n    if (tabs[index]) tabs[index].focus()\n  }\n  panelMutated() {\n    this.debounce(this.changed)\n  }\n  getAddMenuOption(): MenuOption | undefined {\n    if (this.addMenuOption && this.addMenuOption.options?.length > 0) {\n      return this.addMenuOption\n    }\n    if (!this.elements || this.elements.length === 0) return undefined\n\n    const existingTabIds = new Set(this.panel.tabs.map(tab => tab.id))\n    const options = this.elements\n      .filter(el => el.props?.id && !existingTabIds.has(el.props.id))\n      .map(el => new MenuOption({\n        id: el.props!.id,\n        label: el.props!.label ?? el.props!.id,\n        icon: el.props!.icon ?? '',\n      }))\n\n    if (options.length === 0) return undefined\n    return new MenuOption({options})\n  }\n  changed() {\n    this.render([\n      ioTabs({\n        tabs: this.panel.tabs,\n        addMenuOption: this.getAddMenuOption(),\n        '@io-menu-option-clicked': this.onNewTabClicked,\n      }),\n      ioSelector({\n        caching: 'none', // TODO: Make caching work with mutable elements\n        selected: this.panel.getSelected(),\n        elements: this.elements,\n        anchor: '',\n      })\n    ])\n  }\n}\nexport const ioPanel = function(arg0: IoPanelProps) {\n  return IoPanel.vConstructor(arg0)\n}"]}