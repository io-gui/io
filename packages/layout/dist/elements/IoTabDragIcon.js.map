{"version":3,"file":"IoTabDragIcon.js","sourceRoot":"","sources":["../../src/elements/IoTabDragIcon.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, ReactiveProperty, span, ThemeSingleton } from '@io-gui/core'\nimport { IoField, IoFieldProps } from '@io-gui/inputs'\nimport { ioIcon } from '@io-gui/icons'\nimport { ioTabDropRectSingleton } from './IoTabDropRect.js'\nimport { Tab } from '../nodes/Tab.js'\nimport { IoSplit, SplitDirection } from './IoSplit.js'\nimport { IoPanel } from './IoPanel.js'\nimport { IoTabs } from './IoTabs.js'\n\nconst DRAG_THRESHOLD = 10\n\n@Register\nclass IoTabDragIcon extends IoField {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: none;\n        position: fixed;\n        top: 0;\n        left: 0;\n        transform: translate(-50%, -50%);\n        z-index: 100000;\n        pointer-events: none;\n        border-color: var(--io_borderColorLight);\n        background-color: var(--io_bgColorLight) !important;\n        opacity: 0.75;\n      }\n      :host[dragging] {\n        display: flex;\n      }\n      :host > * {\n        display: inline-block;\n        white-space: nowrap;\n        padding: 0 var(--io_spacing);\n      }\n    `\n  }\n\n  @ReactiveProperty({type: Boolean, reflect: true})\n  declare dragging: boolean\n\n  @ReactiveProperty()\n  declare tab: Tab | null\n\n  @ReactiveProperty()\n  declare dropSource: IoPanel | null\n\n  @ReactiveProperty()\n  declare dropTarget: IoPanel | null\n\n  @ReactiveProperty({type: String, value: 'none', reflect: true})\n  declare splitDirection: SplitDirection\n\n  @ReactiveProperty({type: Number, value: -1})\n  declare dropIndex: number\n\n  private _startX: number = 0\n  private _startY: number = 0\n\n  constructor(args: IoFieldProps = {}) { super(args) }\n\n  setStartPosition(x: number, y: number) {\n    this._startX = x\n    this._startY = y\n  }\n\n  updateDrag(tab: Tab, sourcePanel: IoPanel, x: number, y: number, root: IoSplit | null) {\n    if (!this.dragging) {\n      const dx = Math.abs(this._startX - x)\n      const dy = Math.abs(this._startY - y)\n      if (dx > DRAG_THRESHOLD || dy > DRAG_THRESHOLD) {\n        this.setProperties({\n          tab: tab,\n          dragging: true,\n          dropSource: sourcePanel,\n          dropTarget: null,\n          dropIndex: -1,\n        })\n        this.style.top = y + 'px'\n        this.style.left = x + 'px'\n      }\n      return\n    }\n\n    this.style.top = y + 'px'\n    this.style.left = x + 'px'\n\n    if (!root) {\n      console.error('IoTabDragIcon: No root io-split found!')\n      return\n    }\n\n    this.detectDropTargets(x, y, root)\n  }\n\n  private detectDropTargets(x: number, y: number, root: IoSplit) {\n    const m = ThemeSingleton.spacing\n\n    // Check tab bars first (higher priority)\n    const tabsContainers = root.querySelectorAll('io-tabs')\n    for (let i = 0; i < tabsContainers.length; i++) {\n      const tabsContainer = tabsContainers[i] as IoTabs\n      const targetPanel = tabsContainer.parentElement as IoPanel\n      const tcr = tabsContainer.getBoundingClientRect()\n\n      if (y >= tcr.top && y <= tcr.bottom && x >= tcr.left && x <= tcr.right) {\n        const tabs = tabsContainer.querySelectorAll('io-tab')\n        if (tabs.length === 0) {\n          this.setProperties({\n            dropTarget: targetPanel,\n            splitDirection: 'none',\n            dropIndex: 0,\n          })\n          return\n        }\n\n        for (let j = 0; j < tabs.length; j++) {\n          const tab = tabs[j]\n          const tr = tab.getBoundingClientRect()\n          const isLast = j === tabs.length - 1\n\n          if (y >= tr.top - m && y <= tr.bottom + m && x >= tr.left - m && (x <= tr.right + m || isLast && x <= tcr.right)) {\n            const side = x < tr.left + tr.width / 2 ? 'left' : 'right'\n            const dropIndex = side === 'left' ? j : j + 1\n            this.setProperties({\n              dropTarget: targetPanel,\n              splitDirection: 'none',\n              dropIndex: dropIndex,\n            })\n            return\n          }\n        }\n      }\n    }\n\n    const panels = root.querySelectorAll('io-panel')\n    for (let i = 0; i < panels.length; i++) {\n      const targetPanel = panels[i] as IoPanel\n      const pr = targetPanel.getBoundingClientRect()\n\n      if (y >= pr.top && y <= pr.bottom && x >= pr.left && x <= pr.right) {\n        const direction = this.calculateSplitDirection(x, y, pr)\n        this.setProperties({\n          dropTarget: targetPanel,\n          splitDirection: direction,\n          dropIndex: -1,\n        })\n        return\n      }\n    }\n  }\n\n  private calculateSplitDirection(x: number, y: number, rect: DOMRect): SplitDirection {\n    const rx = (x - rect.left - rect.width / 2) / rect.width * 2\n    const ry = (y - rect.top - rect.height / 2) / rect.height * 2\n\n    if (Math.abs(rx) < 0.5 && Math.abs(ry) < 0.5) return 'center'\n    if (Math.abs(ry) > Math.abs(rx)) return ry > 0 ? 'bottom' : 'top'\n    return rx > 0 ? 'right' : 'left'\n  }\n\n  endDrag() {\n    const source = this.dropSource\n    const target = this.dropTarget\n    const index = this.dropIndex\n    const direction = this.splitDirection\n    const tab = this.tab\n\n    if (tab && target && index !== -1) {\n      if (source && source !== target) {\n        source.removeTab(tab)\n      }\n      target.addTab(tab, index)\n    } else if (tab && source && target && direction !== 'none') {\n      target.moveTabToSplit(source, tab, direction)\n    }\n\n    this.cancelDrag()\n  }\n\n  cancelDrag() {\n    this.setProperties({\n      dragging: false,\n      tab: null,\n      dropSource: null,\n      dropTarget: null,\n      splitDirection: 'none',\n      dropIndex: -1,\n    })\n  }\n\n  changed() {\n    ioTabDropRectSingleton.setProperties({\n      dropTarget: this.dropTarget,\n      splitDirection: this.splitDirection,\n      dropIndex: this.dropIndex,\n    })\n    this.render([\n      ioIcon({value: this.tab?.icon || ' '}),\n      span({class: 'label'}, this.tab?.label || ''),\n    ])\n  }\n}\n\nexport const tabDragIconSingleton = new IoTabDragIcon()\ndocument.body.appendChild(tabDragIconSingleton as HTMLElement)\n"]}