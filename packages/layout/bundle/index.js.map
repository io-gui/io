{"version":3,"file":"index.js","sources":["../src/elements/IoDivider.ts","../src/nodes/Tab.ts","../src/elements/IoTabDropMarker.ts","../src/elements/IoTabDragIcon.ts","../src/elements/IoTab.ts","../src/elements/IoTabsHamburgerMenuSingleton.ts","../src/elements/IoTabsHamburger.ts","../src/elements/IoTabs.ts","../src/elements/IoPanel.ts","../src/nodes/Panel.ts","../src/nodes/Split.ts","../src/elements/IoSplit.ts","../src/elements/IoLayout.ts"],"sourcesContent":["import { Register, ReactiveProperty, IoElement, IoElementProps, Property, ListenerDefinition } from '@io-gui/core'\n\nexport type IoDividerProps = IoElementProps & {\n  orientation: 'vertical' | 'horizontal'\n  index: number\n}\n\n@Register\nexport class IoDivider extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        position: relative;\n        flex: 0 0 var(--io_spacing3);\n        background-color: var(--io_colorLight);\n        border-style: solid;\n        border-width: 0 var(--io_borderWidth);\n        border-color: var(--io_color);\n        cursor: col-resize;\n        @apply --unselectable;\n      }\n      :host[pressed] {\n        border-color: var(--io_borderColorBlue);\n        background-color: var(--io_bgColorBlue);\n      }\n      :host[pressed]:before,\n      :host[pressed]:after {\n        background-color: var(--io_colorWhite);\n      }\n      :host:before,\n      :host:after {\n        content: '';\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        z-index: 1;\n        opacity: 0;\n      }\n      :host:before {\n        width: var(--io_fieldHeight);\n        height: var(--io_spacing);\n        background-color: var(--io_color);\n        transform: translate(-50%, -50%) rotate(90deg);\n        border-radius: var(--io_spacing);\n        opacity: 0.5;\n      }\n      :host[orientation='vertical']:before {\n        transform: translate(-50%, -50%);\n      }\n      :host:after {\n        width: var(--io_fieldHeight);\n        height: var(--io_fieldHeight);\n        background-color: var(--io_color);\n        transform: translate(-50%, -50%) rotate(45deg);\n        border-radius: 25%;\n      }\n      :host[orientation='vertical'] {\n        cursor: row-resize;\n        border-width: var(--io_borderWidth) 0;\n      }\n      :host:hover {\n        border-style: dashed;\n      }\n      :host:hover:before {\n        opacity: 1;\n      }\n    `\n  }\n\n  @ReactiveProperty({value: false, type: Boolean, reflect: true})\n  declare pressed: boolean\n\n  @ReactiveProperty({value: 'horizontal', type: String, reflect: true})\n  declare orientation: 'horizontal' | 'vertical'\n\n  @Property(Number)\n  declare index: number\n\n  static get Listeners() {\n    return {\n      'pointerdown': 'onPointerdown',\n      'touchstart': ['onTouchstart', {passive: false}] as ListenerDefinition,\n    }\n  }\n\n  constructor(args: IoDividerProps) { super(args) }\n\n  onPointerdown(event: PointerEvent) {\n    event.preventDefault()\n    event.stopPropagation()\n    this.addEventListener('pointermove', this.onPointermove)\n    this.addEventListener('pointerleave', this.onPointerleave)\n    this.addEventListener('pointerup', this.onPointerup)\n    this.setPointerCapture(event.pointerId)\n    this.pressed = true\n  }\n  onPointermove(event: PointerEvent) {\n    event.preventDefault()\n    this.dispatch('io-divider-move', {\n      index: this.index,\n      clientX: event.clientX,\n      clientY: event.clientY,\n    }, true)\n  }\n  onPointerleave(event: PointerEvent) {\n    event.preventDefault()\n    this.removeEventListener('pointermove', this.onPointermove)\n    this.removeEventListener('pointerleave', this.onPointerleave)\n    this.removeEventListener('pointerup', this.onPointerup)\n    this.pressed = false\n  }\n  onPointerup(event: PointerEvent) {\n    event.preventDefault()\n    this.removeEventListener('pointermove', this.onPointermove)\n    this.removeEventListener('pointerleave', this.onPointerleave)\n    this.removeEventListener('pointerup', this.onPointerup)\n    this.releasePointerCapture(event.pointerId)\n    this.pressed = false\n    this.dispatch('io-divider-move-end', {\n      index: this.index,\n      clientX: event.clientX,\n      clientY: event.clientY,\n    }, true)\n  }\n  onTouchstart(event: TouchEvent) {\n    this.addEventListener('touchmove', this.onTouchmove, {passive: false})\n    this.addEventListener('touchend', this.onTouchend)\n  }\n  onTouchmove(event: TouchEvent) {\n    event.preventDefault()\n  }\n  onTouchend() {\n    this.removeEventListener('touchmove', this.onTouchmove)\n    this.removeEventListener('touchend', this.onTouchend)\n  }\n}\nexport const ioDivider = function(arg0: IoDividerProps) {\n  return IoDivider.vConstructor(arg0)\n}\n","import { Node, ReactiveProperty, Register } from '@io-gui/core'\n\nexport type TabProps = {\n  id: string\n  label?: string\n  icon?: string\n  selected?: boolean\n}\n\n@Register\nexport class Tab extends Node {\n\n  @ReactiveProperty({type: String, value: ''})\n  declare id: string\n\n  @ReactiveProperty({type: String, value: ''})\n  declare label: string\n\n  @ReactiveProperty({type: String, value: ''})\n  declare icon: string\n\n  @ReactiveProperty({type: Boolean, value: false})\n  declare selected: boolean\n\n  constructor(args: TabProps) {\n    args.label = args.label ?? args.id\n    super(args)\n  }\n  toJSON(): TabProps {\n    return {\n      id: this.id,\n      label: this.label,\n      icon: this.icon,\n      selected: this.selected,\n    }\n  }\n  fromJSON(json: TabProps) {\n    this.setProperties({\n      id: json.id,\n      label: json.label ?? json.id,\n      icon: json.icon ?? '',\n      selected: json.selected ?? false,\n    })\n    return this\n  }\n}","import { Register, ReactiveProperty, IoElement, IoElementProps, ThemeSingleton } from '@io-gui/core'\nimport { IoTab } from './IoTab.js'\nimport { SplitDirection } from '../nodes/Split.js'\nimport { IoPanel } from './IoPanel.js'\n\n@Register\nclass IoTabDropMarker extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        position: fixed;\n        height: calc(var(--io_fieldHeight) - var(--io_borderWidth) - var(--io_borderRadius));\n        width: var(--io_spacing);\n        background-color: var(--io_bgColorBlue);\n        margin-bottom: var(--io_borderWidth);\n        z-index: 100000;\n        display: none;\n      }\n      :host:not([dropindex=\"-1\"]) {\n        display: block;\n      }\n      :host:not([splitdirection=\"none\"]) {\n        display: block;\n        opacity: 0.25;\n      }\n    `\n  }\n\n  @ReactiveProperty(null)\n  declare dropTarget: IoPanel | null\n\n  @ReactiveProperty({type: String, value: 'none', reflect: true})\n  declare splitDirection: SplitDirection\n\n  @ReactiveProperty({type: Number, value: -1, reflect: true})\n  declare dropIndex: number\n\n  constructor(args: IoElementProps = {}) { super(args) }\n\n  changed() {\n    if (this.dropTarget && this.dropIndex !== -1) {\n      const tabs = this.dropTarget.querySelectorAll('io-tab')\n      this.style.width = ''\n      this.style.height = ''\n      if (tabs.length === 0) {\n        const rect = this.dropTarget.getBoundingClientRect()\n        this.style.top = `${rect.top + ThemeSingleton.borderRadius}px`\n        this.style.left = `${rect.left}px`\n      } else if (this.dropIndex > tabs.length - 1) {\n        const tab = tabs[tabs.length - 1] as IoTab\n        const rect = tab.getBoundingClientRect()\n        this.style.top = `${rect.top + ThemeSingleton.borderRadius}px`\n        this.style.left = `${rect.left + rect.width}px`\n      } else {\n        const tab = tabs[this.dropIndex] as IoTab\n        const rect = tab.getBoundingClientRect()\n        this.style.top = `${rect.top + ThemeSingleton.borderRadius}px`\n        this.style.left = `${rect.left - ThemeSingleton.spacing}px`\n      }\n    } else if (this.dropTarget && this.splitDirection !== 'none') {\n      const rect = this.dropTarget.getBoundingClientRect()\n      if (this.splitDirection === 'top') {\n        this.style.top = `${rect.top}px`\n        this.style.left = `${rect.left}px`\n        this.style.width = `${rect.width}px`\n        this.style.height = `${rect.height / 2}px`\n      } else if (this.splitDirection === 'bottom') {\n        this.style.top = `${rect.top + rect.height / 2}px`\n        this.style.left = `${rect.left}px`\n        this.style.width = `${rect.width}px`\n        this.style.height = `${rect.height / 2}px`\n      } else if (this.splitDirection === 'left') {\n        this.style.top = `${rect.top}px`\n        this.style.left = `${rect.left}px`\n        this.style.width = `${rect.width / 2}px`\n        this.style.height = `${rect.height}px`\n      } else if (this.splitDirection === 'right') {\n        this.style.top = `${rect.top}px`\n        this.style.left = `${rect.left + rect.width / 2}px`\n        this.style.width = `${rect.width / 2}px`\n        this.style.height = `${rect.height}px`\n      } else if (this.splitDirection === 'center') {\n        this.style.top = `${rect.top}px`\n        this.style.left = `${rect.left}px`\n        this.style.width = `${rect.width}px`\n        this.style.height = `${rect.height}px`\n      }\n    }\n  }\n}\n\nexport const tabDropMarkerSingleton = new IoTabDropMarker()\nsetTimeout(() => {\n  document.body.appendChild(tabDropMarkerSingleton as HTMLElement)\n}, 100)\n","import { Register, ReactiveProperty, Property, span } from '@io-gui/core'\nimport { IoField, IoFieldProps } from '@io-gui/inputs'\nimport { ioIcon } from '@io-gui/icons'\nimport { tabDropMarkerSingleton } from './IoTabDropMarker.js'\nimport { Tab } from '../nodes/Tab.js'\nimport { SplitDirection } from '../nodes/Split.js'\nimport { IoPanel } from './IoPanel.js'\n\n@Register\nclass IoTabDragIcon extends IoField {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: none;\n        position: fixed;\n        top: 0;\n        left: 0;\n        transform: translate(-50%, -50%);\n        z-index: 100000;\n        pointer-events: none;\n        border-color: var(--io_borderColorLight);\n        background-color: var(--io_bgColorLight) !important;\n        opacity: 0.75;\n      }\n      :host[dragging] {\n        display: flex;\n      }\n      :host > * {\n        display: inline-block;\n        white-space: nowrap;\n        padding: 0 var(--io_spacing);\n      }\n      :host > .label {}\n    `\n  }\n\n  @ReactiveProperty({type: Boolean, reflect: true})\n  declare dragging: boolean\n\n  @ReactiveProperty(null)\n  declare tab: Tab | null\n\n  @ReactiveProperty(null)\n  declare dropSource: IoPanel | null\n\n  @ReactiveProperty(null)\n  declare dropTarget: IoPanel | null\n\n  @ReactiveProperty({type: String, value: 'none', reflect: true})\n  declare splitDirection: SplitDirection\n\n  @ReactiveProperty({type: Number, value: -1})\n  declare dropIndex: number\n\n  @Property(-1)\n  declare tabIndex: number\n\n  constructor(args: IoFieldProps = {}) { super(args) }\n\n  changed() {\n    tabDropMarkerSingleton.setProperties({\n      dropTarget: this.dropTarget,\n      splitDirection: this.splitDirection,\n      dropIndex: this.dropIndex,\n    })\n    this.render([\n      ioIcon({value: this.tab?.icon || ' '}),\n      span({class: 'label'}, this.tab?.label || ''),\n    ])\n  }\n}\n\nexport const tabDragIconSingleton = new IoTabDragIcon()\ndocument.body.appendChild(tabDragIconSingleton as HTMLElement)\n","import { Register, ReactiveProperty, span, ThemeSingleton } from '@io-gui/core'\nimport { IoField, IoFieldProps, ioField, ioString } from '@io-gui/inputs'\nimport { IoContextEditorSingleton } from '@io-gui/editors'\nimport { IconsetDB, ioIcon } from '@io-gui/icons'\nimport { MenuOptionProps, MenuOption, ioOptionSelect } from '@io-gui/menus'\nimport { IoTabs } from './IoTabs.js'\nimport { IoPanel } from './IoPanel.js'\nimport { Tab } from '../nodes/Tab.js'\nimport { tabDragIconSingleton } from './IoTabDragIcon.js'\n\nconst icons = []\nfor (const set of Object.keys(IconsetDB)) {\n  for (const icon of Object.keys(IconsetDB[set])) {\n    const id = `${set}:${icon}`\n    icons.push({value: id, label: icon, icon: id})\n  }\n}\n\n// TODO: consider initializing icon options when needed.\nconst iconOptions = ioOptionSelect({label: 'Select', option: new MenuOption({id: 'iconselect', options: icons as MenuOptionProps[]})})\n\nexport type IoTabProps = IoFieldProps & {\n  tab: Tab\n}\n\nlet _dragStartX = 0\nlet _dragStartY = 0\n\n// TODO: fix and improve keyboard navigation in all cases.\n@Register\nexport class IoTab extends IoField {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        position: relative;\n        height: inherit;\n        min-height: inherit;\n        /* TODO: use vars for this */\n        min-width: calc(var(--io_fieldHeight) * 1.25);\n        margin: 0;\n        margin-right: var(--io_spacing);\n        background-color: var(--io_bgColor) !important;\n        border-bottom-left-radius: 0;\n        border-bottom-right-radius: 0;\n        border-color: var(--io_borderColorLight);\n        padding-right: var(--io_lineHeight);\n      }\n      :host[pressed] {\n        border-color: unset !important;\n        box-shadow: unset !important;\n      }\n      :host[selected] {\n        color: var(--io_colorStrong);\n        background-color: var(--io_bgColorLight) !important;\n        border-color: var(--io_borderColorStrong);\n        border-bottom-color: var(--io_bgColorLight);\n        z-index: 1;\n      }\n      :host[overflow]:not([selected]) > .io-close-icon {\n        display: none;\n      }\n      :host[selected]:focus {\n        color: var(--io_colorWhite);\n        z-index: 2;\n      }\n      :host > .io-icon:not([value=' ']) {\n        margin: 0 var(--io_spacing2) 0 0;\n      }\n      :host > .marker {\n        position: absolute;\n        top: 0;\n        left: 0;\n        height: 100%;\n        background-color: var(--io_bgColorBlue);\n        border-bottom-right-radius: var(--io_borderRadius);\n      }\n      :host > span {\n        padding: 0 var(--io_spacing);\n        overflow: hidden; \n        text-overflow: ellipsis !important;\n      }\n      :host > * {\n        pointer-events: none;\n        display: inline-block;\n        white-space: nowrap;\n      }\n      :host:not(:hover) > .io-close-icon {\n        opacity: 0;\n        transform: scale(0.2);\n        transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), opacity linear 0.2s;\n      }\n      :host:hover > .io-close-icon {\n        opacity: 1;\n        transform: scale(0.4);\n        transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), opacity linear 0.2s;\n      }\n      :host > .io-close-icon {\n        position: absolute;\n        right: var(--io_spacing);\n        top: var(--io_spacing);\n        pointer-events: inherit;\n        background: linear-gradient(to right, transparent 0%, var(--io_bgColor) 25%);\n      }\n      :host[selected] > .io-close-icon {\n        background: linear-gradient(to right, transparent 0%, var(--io_bgColorLight) 25%);\n      }\n      :host > .io-close-icon:hover {\n        transform: scale(0.5);\n        fill: var(--io_colorStrong);\n        stroke: var(--io_colorStrong);\n      }\n    `\n  }\n\n  @ReactiveProperty({type: Tab})\n  declare tab: Tab\n\n  @ReactiveProperty({type: Boolean, reflect: true})\n  declare overflow: boolean\n\n  static get Listeners() {\n    return {\n      'click': 'preventDefault',\n      'contextmenu': 'preventDefault',\n    }\n  }\n\n  constructor(args: IoTabProps) { super(args) }\n\n  onResized() {\n    const span = this.querySelector('span')!\n    this.overflow = span.scrollWidth > span.clientWidth\n  }\n  onTouchmove(event: TouchEvent) {\n    event.preventDefault()\n  }\n  preventDefault(event: Event) {\n    event.stopPropagation()\n    event.preventDefault()\n  }\n  onPointerdown(event: PointerEvent) {\n    event.preventDefault()\n    event.stopPropagation()\n    this.setPointerCapture(event.pointerId)\n    _dragStartX = event.clientX\n    _dragStartY = event.clientY\n    super.onPointerdown(event)\n    if (event.buttons === 2) {\n      this.expandContextEditor()\n    } else {\n      this.focus()\n    }\n  }\n  onPointermove(event: PointerEvent) {\n    event.preventDefault()\n    if (event.buttons !== 1) return\n    const panel = this.parentElement!.parentElement as IoPanel\n    if (!tabDragIconSingleton.dragging) {\n      const dx = Math.abs(_dragStartX - event.clientX)\n      const dy = Math.abs(_dragStartY - event.clientY)\n      if (dx > 10 || dy > 10) {\n        tabDragIconSingleton.setProperties({\n          tab: this.tab,\n          dragging: true,\n          dropSource: panel,\n          dropTarget: null,\n          dropIndex: -1,\n        })\n        tabDragIconSingleton.style.top = event.clientY + 'px'\n        tabDragIconSingleton.style.left = event.clientX + 'px'\n      }\n      return\n    }\n    tabDragIconSingleton.style.top = event.clientY + 'px'\n    tabDragIconSingleton.style.left = event.clientX + 'px'\n\n    const x = event.clientX\n    const y = event.clientY\n    const m = ThemeSingleton.spacing\n    const tabsContainers = document.querySelectorAll('io-tabs')\n    for (let i = 0; i < tabsContainers.length; i++) {\n      const tabsContainer = tabsContainers[i] as IoTabs\n      const targetPanel = tabsContainer.parentElement as IoPanel\n      const tcr = tabsContainer.getBoundingClientRect()\n      if (y >= tcr.top && y <= tcr.bottom && x >= tcr.left && x <= tcr.right) {\n        const tabs = tabsContainer.querySelectorAll('io-tab')\n        if (tabs.length === 0) {\n          tabDragIconSingleton.setProperties({\n            dropTarget: targetPanel,\n            splitDirection: 'none',\n            dropIndex: 0,\n          })\n          return\n        }\n        for (let j = 0; j < tabs.length; j++) {\n          const tab = tabs[j] as IoTab\n          const tr = tab.getBoundingClientRect()\n          const isLast = j === tabs.length - 1\n          // TODO: consider hovering empty tab space.\n          if (y >= tr.top - m && y <= tr.bottom + m && x >= tr.left - m && (x <= tr.right + m || isLast && x <= tcr.right)) {\n            const side = x < tr.left + tr.width / 2 ? 'left' : 'right'\n            const dropIndex = side === 'left' ? j : j + 1\n            tabDragIconSingleton.setProperties({\n              dropTarget: targetPanel,\n              splitDirection: 'none',\n              dropIndex: dropIndex,\n            })\n            return\n          }\n        }\n      }\n    }\n\n    const panels = document.querySelectorAll('io-panel')\n    for (let i = 0; i < panels.length; i++) {\n      const targetPanel = panels[i] as IoPanel\n      const pr = targetPanel.getBoundingClientRect()\n      if (y >= pr.top && y <= pr.bottom && x >= pr.left && x <= pr.right) {\n        // get xy relative to panel center\n        const rx = (x - pr.left - pr.width / 2) / pr.width * 2\n        const ry = (y - pr.top - pr.height / 2) / pr.height * 2\n        let direction = 'none'\n\n        if (Math.abs(rx) < 0.5 && Math.abs(ry) < 0.5) {\n          direction = 'center'\n        } else if (ry > 0 && Math.abs(ry) > Math.abs(rx)) {\n          direction = 'bottom'\n        } else if (ry < 0 && Math.abs(ry) > Math.abs(rx)) {\n          direction = 'top'\n        } else if (rx > 0 && Math.abs(rx) > Math.abs(ry)) {\n          direction = 'right'\n        } else if (rx < 0 && Math.abs(rx) > Math.abs(ry)) {\n          direction = 'left'\n        }\n\n        tabDragIconSingleton.setProperties({\n          dropTarget: targetPanel,\n          splitDirection: direction,\n          dropIndex: -1,\n        })\n        return\n      }\n    }\n  }\n  onPointerup(event: PointerEvent) {\n    event.preventDefault()\n    super.onPointerup(event)\n    this.releasePointerCapture(event.pointerId)\n    if (tabDragIconSingleton.dragging) {\n      const source = tabDragIconSingleton.dropSource\n      const target = tabDragIconSingleton.dropTarget\n      const index = tabDragIconSingleton.dropIndex\n      const direction = tabDragIconSingleton.splitDirection\n\n      if (target && index !== -1) {\n        if (source && source !== target) {\n          source.removeTab(this.tab)\n        }\n        target.addTab(this.tab, index)\n      } else if (source && target && direction !== 'none') {\n        target.moveTabToSplit(source, this.tab, direction)\n      }\n\n      tabDragIconSingleton.setProperties({\n        dragging: false,\n        dropSource: null,\n        dropTarget: null,\n        splitDirection: 'none',\n        dropIndex: -1,\n      })\n    } else {\n      this.onClick()\n    }\n  }\n  onPointercancel(event: PointerEvent) {\n    event.preventDefault()\n    event.stopPropagation()\n    super.onPointercancel(event)\n    tabDragIconSingleton.setProperties({\n      dragging: false,\n      dropSource: null,\n      dropTarget: null,\n      splitDirection: 'none',\n      dropIndex: -1,\n    })\n  }\n  onPointerleave(event: PointerEvent) {\n    event.preventDefault()\n    event.stopPropagation()\n  }\n  onClick() {\n    this.dispatch('io-edit-tab', {tab: this.tab, key: 'Select'}, true)\n  }\n  onDeleteClick() {\n    this.dispatch('io-edit-tab', {tab: this.tab, key: 'Backspace'}, true)\n  }\n  expandContextEditor() {\n    IoContextEditorSingleton.expand({\n      source: this,\n      direction: 'down',\n      value: this.tab,\n      properties: ['id', 'label', 'icon'],\n      orientation: 'horizontal',\n      config: new Map([\n        [Object, [\n          ['id', ioField({inert: true})],\n          ['label', ioString({live: true})],\n          ['icon', iconOptions],\n        ]],\n      ]),\n    })\n  }\n  onKeydown(event: KeyboardEvent) {\n    if (event.shiftKey && ['Backspace', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Home', 'End'].includes(event.key)) {\n      event.preventDefault()\n      this.dispatch('io-edit-tab', {tab: this.tab, key: event.key}, true)\n    } else if (event.shiftKey && event.key === 'Enter') {\n      this.expandContextEditor()\n    } else {\n      super.onKeydown(event)\n    }\n  }\n  tabMutated() {\n    this.changed()\n  }\n  changed() {\n    this.setAttribute('selected', this.tab.selected)\n    this.render([\n      this.tab.selected ? span({class: 'marker'}) : null,\n      ioIcon({class: 'io-icon', value: this.tab.icon || ' '}),\n      span({class: 'label'}, this.tab.label),\n      ioIcon({value: 'io:close', size: 'small', class: 'io-close-icon', '@click': this.onDeleteClick, '@pointerdown': this.preventDefault}),\n    ])\n  }\n}\n\nexport const ioTab = function(arg0: IoTabProps) {\n  return IoTab.vConstructor(arg0)\n}\n","import { IoOverlaySingleton, NudgeDirection, NodeArray, VDOMElement, IoElement, IoElementProps, Register, ReactiveProperty, nudge, ListenerDefinition } from '@io-gui/core'\nimport { Tab } from '../nodes/Tab.js'\nimport { ioTab, IoTab } from './IoTab.js'\n\nexport interface IoTabsHamburgerMenuExpandProps {\n  source: HTMLElement\n  direction: NudgeDirection\n  tabs: NodeArray<Tab>\n  onEditTab: (event: CustomEvent) => void\n}\n\n@Register\nclass IoTabsHamburgerMenu extends IoElement {\n  static vConstructor: (arg0?: IoElementProps | Array<VDOMElement | null> | string, arg1?: Array<VDOMElement | null> | string) => VDOMElement\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex-direction: column;\n        border: var(--io_border);\n        border-radius: calc(var(--io_borderRadius) + var(--io_spacing2));\n        border-color: var(--io_borderColorOutset);\n        background-color: var(--io_bgColorLight);\n        padding: calc(var(--io_spacing) + var(--io_borderWidth));\n        position: absolute;\n        overflow-y: auto;\n        box-shadow: 1px 1px 16px var(--io_shadowColor),\n                    1px 1px 8px var(--io_shadowColor), \n                    1px 1px 4px var(--io_shadowColor);\n      }\n      :host:not([expanded]) {\n        visibility: hidden;\n        opacity: 0;\n      }\n      :host > io-tab {\n        border-color: transparent !important;\n        background-color: var(--io_bgColorLight) !important;\n        border-radius: var(--io_borderRadius) !important;\n      }\n      :host > io-tab[selected] {\n        background-color: var(--io_bgColor) !important;\n      }\n      :host > io-tab > .marker {\n        border-radius: 0;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: NodeArray, init: 'this'})\n  declare private tabs: NodeArray<Tab>\n\n  @ReactiveProperty({type: Boolean, reflect: true})\n  declare private expanded: boolean\n\n  declare private onEditTab: (event: CustomEvent) => void\n\n  static get Listeners() {\n    return {\n      'touchstart': ['stopPropagation', {passive: false}] as ListenerDefinition, // TODO: why?\n      'io-focus-to': 'onIoFocusTo',\n      'io-edit-tab': 'onEditTabCapture',\n    }\n  }\n\n  constructor(args: IoElementProps = {}) { super(args) }\n\n  stopPropagation(event: TouchEvent) {\n    event.stopPropagation()\n  }\n\n  onIoFocusTo(event: CustomEvent) {\n    const source = event.detail.source\n    const cmd = event.detail.command\n    const siblings = Array.from(this.querySelectorAll('io-tab')) as IoTab[]\n    const index = siblings.indexOf(source)\n\n    let cmdOverride = ''\n\n    if (cmd === 'ArrowDown') cmdOverride = 'Next'\n    if (cmd === 'ArrowUp') cmdOverride = 'Prev'\n    if (cmd === 'ArrowLeft') cmdOverride = 'First'\n    if (cmd === 'ArrowRight') cmdOverride = 'Last'\n\n    if (cmdOverride) {\n      if (cmdOverride === 'Next') {\n        siblings[(index + 1) % siblings.length].focus()\n      } else if (cmdOverride === 'Prev') {\n        siblings[(index - 1 + siblings.length) % siblings.length].focus()\n      } else if (cmdOverride === 'First') {\n        siblings[0].focus()\n      } else if (cmdOverride === 'Last') {\n        siblings[siblings.length - 1].focus()\n      }\n      event.stopPropagation()\n    }\n  }\n\n  onEditTabCapture(event: CustomEvent) {\n    event.stopPropagation()\n    this.onEditTab(event)\n    this.expanded = false\n  }\n\n  expand(props: IoTabsHamburgerMenuExpandProps) {\n    this.setProperties({\n      tabs: props.tabs,\n      expanded: true,\n    })\n    this.onEditTab = props.onEditTab\n    nudge(this, props.source, props.direction)\n    this.debounce(this.onExpand)\n  }\n  onExpand() {\n    (this.querySelector('[selected]') as HTMLElement)?.focus()\n  }\n  changed() {\n    this.render([\n      ...this.tabs.map(tab => ioTab({tab: tab})),\n    ])\n  }\n}\n\nexport const IoTabsHamburgerMenuSingleton = new IoTabsHamburgerMenu()\nsetTimeout(() => {\n  IoOverlaySingleton.appendChild(IoTabsHamburgerMenuSingleton as HTMLElement)\n}, 100)","import { Register, NodeArray, ReactiveProperty } from '@io-gui/core'\nimport { IoField, IoFieldProps } from '@io-gui/inputs'\nimport { ioIcon } from '@io-gui/icons'\nimport { Tab } from '../nodes/Tab.js'\nimport { IoTabsHamburgerMenuSingleton } from './IoTabsHamburgerMenuSingleton.js'\n\nexport type IoTabsHamburgerProps = IoFieldProps & {\n  tabs: NodeArray<Tab>\n}\n\n@Register\nexport class IoTabsHamburger extends IoField {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex-shrink: 0;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: NodeArray, init: 'this'})\n  declare private tabs: NodeArray<Tab>\n\n  constructor(args: IoTabsHamburgerProps) { super(args) }\n\n  onClick() {\n    IoTabsHamburgerMenuSingleton.expand({\n      source: this,\n      direction: 'over',\n      tabs: this.tabs,\n      onEditTab: this.onEditTab,\n    })\n  }\n  onEditTab(event: CustomEvent) {\n    this.dispatch('io-edit-tab', {tab: event.detail.tab, key: event.detail.key}, true)\n  }\n  changed() {\n    this.render([\n      ioIcon({value: 'io:hamburger'})\n    ])\n  }\n}\n\nexport const ioTabsHamburger = function(arg0: IoTabsHamburgerProps) {\n  return IoTabsHamburger.vConstructor(arg0)\n}","import { Register, IoElement, IoElementProps, ReactiveProperty, Property, NodeArray } from '@io-gui/core'\nimport { MenuOption, ioMenuItem } from '@io-gui/menus'\nimport { ioTab } from './IoTab.js'\nimport { ioTabsHamburger } from './IoTabsHamburger.js'\nimport { Tab } from '../nodes/Tab.js'\n\nexport type IoTabsProps = IoElementProps & {\n  tabs: NodeArray<Tab>\n  addMenuOption: MenuOption\n}\n\n@Register\nexport class IoTabs extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        background-color: var(--io_bgColorStrong);\n        padding-top: var(--io_spacing);\n        padding-left: var(--io_spacing);\n        padding-right: var(--io_spacing);\n      }\n      :host io-tab {\n        transition: opacity 2s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n      :host:not([overflow=\"-1\"]) io-tab {\n        /* TODO: make niceer animations */\n        pointer-events: none;\n        opacity: 0;\n      }\n      :host[overflow=\"-1\"] io-tabs-hamburger {\n        /* TODO: make niceer animations */\n        display: none;\n      }\n      :host > io-tabs-hamburger {\n        margin-bottom: var(--io_spacing);\n        /* transition: opacity 1s cubic-bezier(0.4, 0, 0.2, 1); */\n      }\n      :host > io-menu-item {\n        margin-left: auto;\n        flex-shrink: 0;\n        opacity: 0.125;\n        transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), opacity linear 0.2s;\n      }\n      :host > io-menu-item:focus,\n      :host > io-menu-item:hover {\n        opacity: 1;\n      }\n      :host > io-menu-item > .label,\n      :host > io-menu-item > .icon,\n      :host > io-menu-item > .hasmore {\n        display: none;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: NodeArray, init: 'this'})\n  declare tabs: NodeArray<Tab>\n\n  @ReactiveProperty({type: Number, value: -1, reflect: true})\n  declare overflow: number\n\n  @Property({type: MenuOption})\n  declare addMenuOption: MenuOption\n\n  constructor(args: IoTabsProps) { super(args) }\n\n  tabsMutated() {\n    this.changed()\n\n    this.overflow = -1\n    this.onResized()\n  }\n\n  onResized() {\n    const rect = this.getBoundingClientRect()\n    const addMenuRect = this.querySelector('.add-tab')!.getBoundingClientRect()\n\n    if (this.overflow === -1) {\n      if (addMenuRect.right > rect.right) {\n        this.overflow = rect.width\n      }\n    } else if (rect.width > (this.overflow + 32)) {\n      this.overflow = -1\n    }\n  }\n\n  changed() {\n    this.render([\n      ioTabsHamburger({tabs: this.tabs}),\n      ...this.tabs.map(tab => ioTab({tab: tab})),\n      ioMenuItem({\n        class: 'add-tab',\n        icon: 'io:box_fill_plus',\n        direction: 'down',\n        option: this.addMenuOption,\n      }),\n    ])\n  }\n}\n\nexport const ioTabs = function(arg0: IoTabsProps) {\n  return IoTabs.vConstructor(arg0)\n}","import { Register, IoElement, VDOMElement, IoElementProps, ReactiveProperty, Property } from '@io-gui/core'\nimport { ioSelector } from '@io-gui/navigation'\nimport { IoMenuItem, MenuOption } from '@io-gui/menus'\nimport { ioTabs } from './IoTabs.js'\nimport { IoSplit } from './IoSplit.js'\nimport { Tab } from '../nodes/Tab.js'\nimport { Panel } from '../nodes/Panel.js'\nimport { SplitDirection } from '../nodes/Split.js'\nimport { IoLayout } from './IoLayout.js'\n\nexport type IoPanelProps = IoElementProps & {\n  panel: Panel\n  elements: VDOMElement[]\n  addMenuOption: MenuOption\n}\n\n@Register\nexport class IoPanel extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        overflow: hidden;\n        flex-direction: column;\n        flex: 1 1 auto;\n        background-color: var(--io_bgColorLight);\n      }\n      :host > io-selector {\n        margin-top: calc(-1 * var(--io_borderWidth));\n        border-top: var(--io_border);\n        border-top-color: var(--io_borderColorStrong);\n      }\n    `\n  }\n\n  @ReactiveProperty({type: Object})\n  declare panel: Panel\n\n  @ReactiveProperty(Array)\n  declare elements: VDOMElement[]\n\n  @Property(MenuOption)\n  declare private addMenuOption: MenuOption\n\n  static get Listeners() {\n    return {\n      'io-edit-tab': 'onEditTab',\n    }\n  }\n\n  onEditTab(event: CustomEvent) {\n    event.stopPropagation()\n    const tab: Tab = event.detail.tab\n    const key = event.detail.key\n    const index = this.panel.tabs.indexOf(tab)\n    if (index === -1) {\n      debug: console.warn('IoTabs:Tab not found in panel', tab)\n      return\n    }\n    switch (key) {\n      case 'Select': {\n        this.selectTab(tab)\n        break\n      }\n      case 'Backspace': {\n        this.removeTab(tab)\n        break\n      }\n      case 'ArrowLeft': {\n        this.moveTab(tab, index - 1)\n        break\n      }\n      case 'ArrowRight': {\n        this.moveTab(tab, index + 1)\n        break\n      }\n      case 'ArrowUp': {\n        // TODO: move tab to panel above or split the panel\n        break\n      }\n      case 'ArrowDown': {\n        // TODO: move tab to panel below or split the panel\n        break\n      }\n    }\n  }\n  init() {\n    this.focusTabDebounced = this.focusTabDebounced.bind(this)\n  }\n  onNewTabClicked(event: CustomEvent) {\n    event.stopPropagation()\n    const option: MenuOption = event.detail.option\n    if (option.id && option.options.length === 0) {\n      const tab = new Tab({id: option.id, label: option.label, icon: option.icon})\n      this.addTab(tab)\n      const addMenuOption = this.querySelector('.add-tab') as IoMenuItem\n      if (addMenuOption) addMenuOption.expanded = false\n    }\n  }\n  selectIndex(index: number) {\n    index = Math.min(index, this.panel.tabs.length - 1)\n    this.panel.setSelected(this.panel.tabs[index].id)\n    this.debounce(this.focusTabDebounced, index)\n  }\n  selectTab(tab: Tab) {\n    const index = this.panel.tabs.indexOf(tab)\n    this.panel.setSelected(tab.id)\n    this.debounce(this.focusTabDebounced, index)\n  }\n  moveTabToSplit(sourcePanel: IoPanel, tab: Tab, direction: SplitDirection) {\n    const parentSplit = this.parentElement as IoSplit\n    if (direction === 'center') {\n      sourcePanel.removeTab(tab)\n      this.addTab(tab)\n    } else {\n      parentSplit.moveTabToSplit(sourcePanel, this.panel, tab, direction)\n    }\n  }\n  addTab(tab: Tab, index?: number) {\n    const existingIndex = this.panel.tabs.findIndex(t => t.id === tab.id)\n    if (existingIndex !== -1) {\n      this.panel.tabs.splice(existingIndex, 1)\n    }\n    index = index ?? this.panel.tabs.length\n    index = Math.min(index, this.panel.tabs.length)\n    this.panel.tabs.splice(index, 0, tab)\n    this.selectIndex(index)\n  }\n  removeTab(tab: Tab) {\n    // Prevent removing the last tab from a layout with only one split, panel and a tab.\n    const parentSplit = this.parentElement as IoSplit\n    const grandParentLayout = (parentSplit.parentElement instanceof IoLayout) ? parentSplit.parentElement : null\n    if (grandParentLayout && parentSplit.split.children.length === 1 && this.panel.tabs.length === 1) {\n      return\n    }\n\n    const index = this.panel.tabs.indexOf(tab)\n    this.panel.tabs.splice(index, 1)\n    if (this.panel.tabs.length > 0) {\n      const newIndex = Math.min(index, this.panel.tabs.length - 1)\n      this.selectIndex(newIndex)\n    } else {\n      this.dispatch('io-panel-remove', {panel: this.panel}, true)\n    }\n  }\n  moveTab(tab: Tab, index: number) {\n    index = Math.max(Math.min(index, this.panel.tabs.length - 1), 0)\n    const currIndex = this.panel.tabs.findIndex(t => t.id === tab.id)\n    this.panel.tabs.splice(currIndex, 1)\n    index = Math.min(index, this.panel.tabs.length)\n    this.panel.tabs.splice(index, 0, tab)\n    this.selectIndex(index)\n  }\n  focusTabDebounced(index: number) {\n    const tabs = Array.from(this.querySelectorAll('io-tab')) as HTMLElement[]\n    index = Math.min(index, tabs.length - 1)\n    if (tabs[index]) tabs[index].focus()\n  }\n  panelMutated() {\n    this.changed()\n  }\n  changed() {\n    this.render([\n      ioTabs({\n        tabs: this.panel.tabs,\n        addMenuOption: this.addMenuOption,\n        '@io-menu-option-clicked': this.onNewTabClicked,\n      }),\n      ioSelector({\n        selected: this.panel.getSelected(),\n        elements: this.elements,\n        anchor: '',\n      })\n    ])\n  }\n}\nexport const ioPanel = function(arg0: IoPanelProps) {\n  return IoPanel.vConstructor(arg0)\n}","import { Node, NodeArray, ReactiveProperty, Register } from '@io-gui/core'\nimport { Tab, TabProps } from './Tab.js'\n\nexport type PanelProps = {\n  tabs: Array<TabProps>\n  flex?: string\n}\n\n@Register\nexport class Panel extends Node {\n\n  @ReactiveProperty({type: NodeArray, init: 'this'})\n  declare tabs: NodeArray<Tab>\n\n  @ReactiveProperty({type: String, value: '1 1 100%'})\n  declare flex: string\n\n  constructor(args: PanelProps) {\n    args = { ...args }\n    if (args.tabs.length > 0 && !args.tabs.find(tab => tab.selected)) {\n      args.tabs[0].selected = true\n    }\n    args.tabs = args.tabs.map(tab => new Tab({...tab}))\n    super(args)\n  }\n  tabsMutated() {\n    this.debounce(this.onTabsMutatedDebounced)\n  }\n  onTabsMutatedDebounced() {\n    this.dispatchMutation()\n  }\n  getSelected() {\n    let selected = ''\n    for (let i = 0; i < this.tabs.length; i++) {\n      const item = this.tabs[i]\n      if (item.selected && item.id) {\n        selected = item.id\n        break\n      }\n    }\n    return selected\n  }\n  setSelected(id: string) {\n    // TODO Test and reconsider withInternalOperation\n    this.tabs.withInternalOperation(() => {\n      for (let i = 0; i < this.tabs.length; i++) {\n        const item = this.tabs[i]\n        if (item.id === id) {\n          item.selected = true\n        } else {\n          item.selected = false\n        }\n      }\n    })\n    this.tabs.dispatchMutation()\n  }\n  toJSON(): PanelProps {\n    return {\n      tabs: this.tabs.map(tab => tab.toJSON()),\n      flex: this.flex,\n    }\n  }\n  fromJSON(json: PanelProps) {\n    this.setProperties({\n      tabs: json.tabs.map(tab => new Tab(tab)),\n      flex: json.flex ?? '1 1 100%',\n    })\n    return this\n  }\n  dispose() {\n    this.tabs.length = 0 // TODO: test magic!\n    super.dispose()\n  }\n}","import { Node, NodeArray, ReactiveProperty, Register } from '@io-gui/core'\nimport { Panel, PanelProps } from './Panel.js'\n\nexport type SplitOrientation = 'horizontal' | 'vertical'\nexport type SplitDirection = 'none' | 'left' | 'right' | 'top' | 'bottom' | 'center'\n\nexport type SplitProps = {\n  children: Array<SplitProps | PanelProps>\n  orientation?: SplitOrientation\n  flex?: string\n}\n\n@Register\nexport class Split extends Node {\n\n  @ReactiveProperty({type: NodeArray, init: 'this'})\n  declare children: NodeArray<Split | Panel>\n\n  @ReactiveProperty({type: String, value: 'horizontal'})\n  declare orientation: SplitOrientation\n\n  @ReactiveProperty({type: String, value: '1 1 100%'})\n  declare flex: string\n\n  constructor(args: SplitProps) {\n    args = { ...args }\n    for (let i = 0; i < args.children.length; i++) {\n      const panelChild = args.children[i] as PanelProps\n      const splitChild = args.children[i] as SplitProps\n      if (panelChild.tabs) {\n        args.children[i] = new Panel(panelChild)\n      } else if (splitChild.children) {\n        args.children[i] = new Split(splitChild)\n      }\n    }\n    super(args)\n  }\n  childrenMutated() {\n    this.debounce(this.onChildrenMutatedDebounced)\n  }\n  onChildrenMutatedDebounced() {\n    this.dispatchMutation()\n  }\n  toJSON(): SplitProps {\n    return {\n      children: this.children.map((child: Split | Panel): SplitProps | PanelProps => child.toJSON()),\n      orientation: this.orientation,\n      flex: this.flex,\n    }\n  }\n  fromJSON(json: SplitProps) {\n    this.setProperties({\n      children: json.children.map((child: SplitProps | PanelProps) => {\n        const panelChild = child as PanelProps\n        const splitChild = child as SplitProps\n        if (panelChild.tabs) {\n          return new Panel(panelChild)\n        } else if (splitChild.children) {\n          return new Split(splitChild)\n        }\n      }),\n      orientation: json.orientation ?? 'horizontal',\n      flex: json.flex ?? '1 1 100%',\n    })\n    return this\n  }\n  dispose() {\n    this.children.length = 0 // TODO: test magic!\n    super.dispose()\n  }\n}","import { Register, ReactiveProperty, VDOMElement, IoElement, IoElementProps, Property, ThemeSingleton } from '@io-gui/core'\nimport { MenuOption } from '@io-gui/menus'\nimport { IoPanel, ioPanel } from './IoPanel.js'\nimport { ioDivider } from './IoDivider.js'\nimport { Split, SplitDirection, SplitOrientation } from '../nodes/Split.js'\nimport { Panel } from '../nodes/Panel.js'\nimport { Tab } from '../nodes/Tab.js'\n\nexport type IoSplitProps = IoElementProps & {\n  split: Split\n  elements: VDOMElement[]\n  addMenuOption: MenuOption\n}\n\n@Register\nexport class IoSplit extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        overflow: hidden;\n        flex-direction: row;\n      }\n      :host[orientation='vertical'] {\n        flex-direction: column;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: Object})\n  declare split: Split\n\n  @ReactiveProperty(Array)\n  declare elements: VDOMElement[]\n\n  @Property({type: MenuOption})\n  declare private addMenuOption: MenuOption\n\n  static get Listeners() {\n    return {\n      'io-divider-move': 'onDividerMove',\n      'io-divider-move-end': 'onDividerMoveEnd',\n      'io-panel-remove': 'onPanelRemove',\n      'io-split-remove': 'onSplitRemove',\n      'io-split-convert-to-panel': 'onSplitConvertToPanel',\n    }\n  }\n  // TODO: Make sure one panel is available even when all tabs are removed.\n\n  constructor(args: IoSplitProps) {\n    super(args)\n    this.splitMutatedDebounced = this.splitMutatedDebounced.bind(this)\n  }\n\n  onDividerMove(event: CustomEvent) {\n    event.stopPropagation()\n    const index = event.detail.index\n    const rect = this.getBoundingClientRect()\n    const orientation = this.split.orientation\n\n    const dividerSize = ThemeSingleton.spacing3\n    const totalSpace = (orientation === 'horizontal' ? rect.width : rect.height) - dividerSize * (this.children.length - 1) / 2\n    const minSize = orientation === 'horizontal' ? ThemeSingleton.fieldHeight * 4 : ThemeSingleton.fieldHeight\n\n    const splits = []\n    const splitSizes = []\n    const splitResize = []\n\n    for (let i = 0; i < this.children.length; i += 2) {\n      const splitElement = this.children[i] as HTMLElement\n\n      const splitRect = splitElement.getBoundingClientRect()\n      const splitSize = orientation === 'horizontal' ? splitRect.width : splitRect.height\n\n      let x = event.detail.clientX - splitRect.left - dividerSize / 2\n      let y = event.detail.clientY - splitRect.top - dividerSize / 2\n      if (i === this.children.length - 1) {\n        // NOTE: The last panel should be sized from the end.\n        x = rect.width - (event.detail.clientX - rect.left) - dividerSize / 2\n        y = rect.height - (event.detail.clientY - rect.top) - dividerSize / 2\n      }\n      const size = orientation === 'horizontal' ? x : y\n\n      splits.push(splitElement)\n      splitSizes.push(splitSize)\n      splitResize.push(size)\n    }\n\n    let fixedSpaceBefore = 0\n    let fixedSpaceAfter = 0\n    let flexSpace = 0\n    let flexCountBefore = 0\n    let flexCountAfter = 0\n\n    for (let i = 0; i < splits.length; i++) {\n      let idx = index\n      if (idx === splits.length - 2) {\n        // NOTE: The last divider manipulates the panel after the split.\n        idx = splits.length - 1\n      }\n      if (splits[i].style.flex.endsWith('%')) {\n        flexSpace += splitSizes[i]\n        if (i < idx) {\n          flexCountBefore++\n        } else if (i > idx) {\n          flexCountAfter++\n        }\n      } else {\n        if (i < idx) {\n          fixedSpaceBefore += splitSizes[i]\n        } else if (i > idx) {\n          fixedSpaceAfter += splitSizes[i]\n        }\n      }\n    }\n\n    if (index === 0) {\n      const maxSize = totalSpace - minSize * flexCountAfter - fixedSpaceAfter\n      const size = Math.max(minSize, Math.min(maxSize, splitResize[0]))\n      // Set fixed size for the first panel.\n      splits[index].style.flex = `0 0 ${size}px`\n      // Prevent flex splits from compressing below minSize.\n      for (let i = 0; i < splits.length; i++) {\n        if (splits[i].style.flex.endsWith('%')) {\n          if (i !== index) {\n            splits[i].style.flex = `1 1 ${Math.max(minSize, splitSizes[i]) / flexSpace * 100}%`\n          }\n        }\n      }\n\n    } else if (index === splits.length - 2) {\n      const maxSize = totalSpace - minSize * flexCountBefore - fixedSpaceBefore\n      const size = Math.max(minSize, Math.min(maxSize, splitResize[index + 1]))\n      // Set fixed size for the last panel.\n      splits[index + 1].style.flex = `0 0 ${size}px`\n      // Prevent flex splits from compressing below minSize.\n      for (let i = 0; i < splits.length; i++) {\n        if (splits[i].style.flex.endsWith('%')) {\n          if (i !== index + 1) {\n            splits[i].style.flex = `1 1 ${Math.max(minSize, splitSizes[i]) / flexSpace * 100}%`\n          }\n        }\n      }\n    } else {\n      const maxSize = splitSizes[index] + splitSizes[index + 1] - minSize\n      const size = Math.max(minSize, Math.min(maxSize, splitResize[index]))\n      const sizeNext = splitSizes[index + 1] - (size - splitSizes[index])\n      // Apply flex sizes\n      for (let i = 0; i < splits.length; i++) {\n        if (splits[i].style.flex.endsWith('%')) {\n          if (i === index) {\n            splits[i].style.flex = `1 1 ${size / flexSpace * 100}%`\n          } else if (i === index + 1) {\n            splits[i].style.flex = `1 1 ${sizeNext / flexSpace * 100}%`\n          } else {\n            splits[i].style.flex = `1 1 ${Math.max(minSize, splitSizes[i]) / flexSpace * 100}%`\n          }\n        }\n      }\n    }\n  }\n\n  onDividerMoveEnd(event: CustomEvent) {\n    event.stopPropagation()\n    let index = 0\n    for (let i = 0; i < this.children.length; i += 2) {\n      const splitElement = this.children[i] as HTMLElement\n      this.split.children[index].flex = splitElement.style.flex\n      index++\n    }\n  }\n\n  onPanelRemove(event: CustomEvent) {\n    if (event.detail.panel === this.split) return\n    event.stopPropagation()\n    for (let i = this.split.children.length; i--;) {\n      const child = this.split.children[i]\n      if (child instanceof Panel && child.tabs.length === 0) {\n        this.split.children.splice(i, 1)\n      }\n    }\n    if (this.split.children.length === 0) {\n      this.dispatch('io-split-remove', {split: this.split}, true)\n    } else if (this.split.children.length === 1) {\n      this.dispatch('io-split-convert-to-panel', {split: this.split}, true)\n    }\n  }\n\n  onSplitRemove(event: CustomEvent) {\n    if (event.detail.split === this.split) return\n    event.stopPropagation()\n    const index = this.split.children.indexOf(event.detail.split)\n    this.split.children.splice(index, 1)\n    if (this.split.children.length === 2) {\n      this.split.children[1].flex = '1 1 100%'\n    }\n  }\n\n  onSplitConvertToPanel(event: CustomEvent) {\n    if (event.detail.split === this.split) return\n    event.stopPropagation()\n    this.convertToPanel(event.detail.split)\n  }\n\n  convertToSplit(panel: Panel, first: Panel, second: Panel, orientation: SplitOrientation) {\n    const index = this.split.children.indexOf(panel)\n    this.split.children.splice(index, 1, new Split({orientation: orientation, children: [first, second]}))\n  }\n  convertToPanel(split: Split) {\n    const panel = split.children[0] as Panel\n    const index = this.split.children.indexOf(split)\n    panel.flex = '1 1 100%'\n    this.split.children.splice(index, 1, panel)\n  }\n\n  moveTabToSplit(sourcePanel: IoPanel, panel: Panel, tab: Tab, direction: SplitDirection) {\n    const index = this.split.children.indexOf(panel)\n    let orientation: SplitOrientation = 'horizontal'\n    if (direction === 'top' || direction === 'bottom') {\n      orientation = 'vertical'\n    }\n    let newIndex = ['left', 'top'].includes(direction) ? index - 1 : index + 1\n\n    if (this.split.orientation === orientation) {\n      newIndex = Math.max(0, newIndex)\n      this.split.children.splice(newIndex, 0, new Panel({tabs: [tab]}))\n      sourcePanel.removeTab(tab)\n    } else {\n      if (panel.tabs.length > 1 || panel !== sourcePanel.panel) {\n        sourcePanel.removeTab(tab)\n        if (newIndex === -1) {\n          this.convertToSplit(panel, new Panel({tabs: [tab]}), panel, orientation)\n        } else {\n          this.convertToSplit(panel, panel, new Panel({tabs: [tab]}), orientation)\n        }\n      }\n    }\n  }\n  splitMutated() {\n    this.debounce(this.splitMutatedDebounced)\n  }\n  splitMutatedDebounced() {\n    this.changed()\n  }\n  changed() {\n    this.setAttribute('orientation', this.split.orientation)\n    this.style.flex = this.split.flex\n    // TODO: Validate split\n    const vChildren: VDOMElement[] = []\n    for (let i = 0; i < this.split.children.length; i++) {\n      const child = this.split.children[i]\n      if (child instanceof Split) {\n        vChildren.push(ioSplit({\n          split: child,\n          style: {flex: child.flex},\n          elements: this.elements,\n          addMenuOption: this.addMenuOption,\n        }))\n      } else if (child instanceof Panel) {\n        vChildren.push(ioPanel({\n          panel: child,\n          style: {flex: child.flex},\n          elements: this.elements,\n          addMenuOption: this.addMenuOption,\n        }))\n      } else debug: {\n        console.warn('IOSplit: Invalid child type', child)\n      }\n      if (i < this.split.children.length - 1) {\n        vChildren.push(ioDivider({orientation: this.split.orientation, index: i}))\n      }\n    }\n    this.render(vChildren)\n  }\n}\nexport const ioSplit = function(arg0: IoSplitProps) {\n  return IoSplit.vConstructor(arg0)\n}\n","import { Register, IoElement, VDOMElement, IoElementProps, ReactiveProperty, Property, Binding } from '@io-gui/core'\nimport { MenuOption } from '@io-gui/menus'\nimport { ioSplit } from './IoSplit.js'\nimport { Split } from '../nodes/Split.js'\n\nexport type IoLayoutProps = IoElementProps & {\n  split: Split | Binding<Split>\n  elements: VDOMElement[]\n  addMenuOption: MenuOption\n}\n\n@Register\nexport class IoLayout extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        position: relative;\n        display: flex;\n        flex: 1 1 100%;\n        max-width: 100%;\n        max-height: 100%;\n      }\n      :host > io-split {\n        max-width: 100%;\n        max-height: 100%;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: Object})\n  declare split: Split\n\n  @ReactiveProperty(Array)\n  declare elements: VDOMElement[]\n\n  @Property({type: MenuOption})\n  declare private addMenuOption: MenuOption\n\n  changed() {\n    this.render([\n      ioSplit({\n        split: this.split,\n        elements: this.elements,\n        addMenuOption: this.addMenuOption,\n      })\n    ])\n  }\n}\n\nexport const ioLayout = function(arg0: IoLayoutProps) {\n  return IoLayout.vConstructor(arg0)\n}"],"names":["IoDivider","IoElement","Style","Listeners","pointerdown","touchstart","passive","constructor","args","super","onPointerdown","event","preventDefault","stopPropagation","this","addEventListener","onPointermove","onPointerleave","onPointerup","setPointerCapture","pointerId","pressed","dispatch","index","clientX","clientY","removeEventListener","releasePointerCapture","onTouchstart","onTouchmove","onTouchend","__decorateClass","ReactiveProperty","value","type","Boolean","reflect","prototype","String","Property","Number","Register","ioDivider","arg0","vConstructor","Tab","Node","label","id","toJSON","icon","selected","fromJSON","json","setProperties","IoTabDropMarker","changed","dropTarget","dropIndex","tabs","querySelectorAll","style","width","height","length","rect","getBoundingClientRect","top","ThemeSingleton","borderRadius","left","spacing","splitDirection","tabDropMarkerSingleton","setTimeout","document","body","appendChild","IoTabDragIcon","IoField","render","ioIcon","tab","span","class","tabDragIconSingleton","icons","set","Object","keys","IconsetDB","push","iconOptions","ioOptionSelect","option","MenuOption","options","_dragStartX","_dragStartY","IoTab","click","contextmenu","onResized","querySelector","overflow","scrollWidth","clientWidth","buttons","expandContextEditor","focus","panel","parentElement","dragging","dx","Math","abs","dy","dropSource","x","y","m","tabsContainers","i","tabsContainer","targetPanel","tcr","bottom","right","j","tr","isLast","panels","pr","rx","ry","direction","source","target","removeTab","addTab","moveTabToSplit","onClick","onPointercancel","key","onDeleteClick","IoContextEditorSingleton","expand","properties","orientation","config","Map","ioField","inert","ioString","live","onKeydown","shiftKey","includes","tabMutated","setAttribute","size","ioTab","IoTabsHamburgerMenu","onIoFocusTo","detail","cmd","command","siblings","Array","from","indexOf","cmdOverride","onEditTabCapture","onEditTab","expanded","props","nudge","debounce","onExpand","map","NodeArray","init","IoTabsHamburgerMenuSingleton","IoOverlaySingleton","IoTabsHamburger","ioTabsHamburger","IoTabs","tabsMutated","addMenuRect","ioMenuItem","addMenuOption","ioTabs","IoPanel","selectTab","moveTab","console","warn","focusTabDebounced","bind","onNewTabClicked","selectIndex","min","setSelected","sourcePanel","parentSplit","existingIndex","findIndex","t","splice","IoLayout","split","children","newIndex","max","currIndex","panelMutated","ioSelector","getSelected","elements","anchor","ioPanel","Panel","find","onTabsMutatedDebounced","dispatchMutation","item","withInternalOperation","flex","dispose","Split","panelChild","splitChild","childrenMutated","onChildrenMutatedDebounced","child","IoSplit","splitMutatedDebounced","onDividerMove","dividerSize","spacing3","totalSpace","minSize","fieldHeight","splits","splitSizes","splitResize","splitElement","splitRect","splitSize","fixedSpaceBefore","fixedSpaceAfter","flexSpace","flexCountBefore","flexCountAfter","idx","endsWith","maxSize","sizeNext","onDividerMoveEnd","onPanelRemove","onSplitRemove","onSplitConvertToPanel","convertToPanel","convertToSplit","first","second","splitMutated","vChildren","ioSplit","ioLayout"],"mappings":"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"}