{"version":3,"file":"IoContextMenu.js","sourceRoot":"","sources":["../../src/elements/IoContextMenu.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, ReactiveProperty, IoOverlaySingleton as Overlay, IoElementProps, WithBinding } from 'io-core';\nimport { IoMenuOptions } from './IoMenuOptions.js';\nimport { onOverlayPointerdown, onOverlayPointermove, onOverlayPointeup } from './IoMenuItem.js';\nimport { MenuOption } from '../nodes/MenuOption.js';\n\nexport type IoContextMenuProps = IoElementProps & {\n  option: MenuOption,\n  expanded?: WithBinding<boolean>,\n  button?: number,\n};\n\n/**\n * An invisible element that inserts a floating menu when its `parentElement` is clicked. Menu position is set by the pointer by default but it can be configured to expand to the side of the parent element by setting the `position` property. Default `button` property for menu expansion is `0` (left mouse button), but it can be configured for other buttons. You can have multiple `IoContextMenu` instances under the same `parentElement` as long as the `button` properties are different.\n **/\n@Register\nexport class IoContextMenu extends IoElement {\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption;\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare expanded: boolean;\n\n  @ReactiveProperty(0)\n  declare button: number;\n\n  declare $options: IoMenuOptions;\n  declare _contextTimeout: number;\n\n  static get ReactiveProperties(): any {\n    return {\n      $options: null,\n    };\n  }\n\n  constructor(args: IoContextMenuProps) {\n    super(args);\n    this.$options = new IoMenuOptions({\n      expanded: this.bind('expanded'),\n      option: this.option,\n      $parent: this,\n    });\n  }\n\n  init() {\n    this.collapse = this.collapse.bind(this);\n  }\n\n  optionChanged() {\n    if (this.$options) this.$options.option = this.option;\n  }\n  connectedCallback() {\n    super.connectedCallback();\n    Overlay.appendChild(this.$options as HTMLElement);\n    this.parentElement!.addEventListener('pointerdown', this.onPointerdown);\n    this.parentElement!.addEventListener('click', (this as any).onClick);\n    this.parentElement!.addEventListener('contextmenu', this.onContextmenu);\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    Overlay.removeChild(this.$options as HTMLElement);\n    this.parentElement!.removeEventListener('pointerdown', this.onPointerdown);\n    this.parentElement!.removeEventListener('click', (this as any).onClick);\n    this.parentElement!.removeEventListener('contextmenu', this.onContextmenu);\n  }\n  getBoundingClientRect() {\n    return this.parentElement!.getBoundingClientRect();\n  }\n  onContextmenu(event: MouseEvent) {\n    if (this.button === 2) event.preventDefault();\n  }\n  onPointerdown(event: PointerEvent) {\n    event.stopPropagation();\n\n    this.$options.style.left = `${event.clientX}px`;\n    this.$options.style.top = `${event.clientY}px`;\n\n    this.parentElement!.addEventListener('pointermove', this.onPointermove);\n    this.parentElement!.addEventListener('pointerleave', this.onPointerleave);\n    this.parentElement!.addEventListener('pointerup', this.onPointerup);\n\n    clearTimeout(this._contextTimeout);\n    if (event.pointerType !== 'touch') {\n      if (event.button === this.button) {\n        this.setPointerCapture(event.pointerId);\n        this.expanded = true;\n        // TODO: keyboard focus navigation\n      }\n    } else {\n      // iOS Safari contextmenu event emulation.\n      event.preventDefault();\n      this._contextTimeout = setTimeout(() => {\n        this.setPointerCapture(event.pointerId);\n        this.expanded = true;\n        // TODO: keyboard focus navigation\n      }, 150);\n    }\n    onOverlayPointerdown.call(this, event);\n  }\n  onPointermove(event: PointerEvent) {\n    event.stopPropagation();\n    clearTimeout(this._contextTimeout);\n    if (event.pointerType === 'touch') {\n      // Let touch scroll the document.\n      if (!this.expanded) return;\n    }\n    onOverlayPointermove.call(this, event);\n  }\n  onPointerup(event: PointerEvent) {\n    clearTimeout(this._contextTimeout);\n    this.releasePointerCapture(event.pointerId);\n    this.parentElement!.removeEventListener('pointermove', this.onPointermove);\n    this.parentElement!.removeEventListener('pointerleave', this.onPointerleave);\n    this.parentElement!.removeEventListener('pointerup', this.onPointerup);\n    onOverlayPointeup.call(this, event);\n  }\n  onPointerleave(event: PointerEvent) {\n    this.releasePointerCapture(event.pointerId);\n    this.parentElement!.removeEventListener('pointermove', this.onPointermove);\n    this.parentElement!.removeEventListener('pointerleave', this.onPointerleave);\n    this.parentElement!.removeEventListener('pointerup', this.onPointerup);\n  }\n  collapse() {\n    Overlay.collapse();\n  }\n}\nexport const ioContextMenu = function(arg0?: IoContextMenuProps) {\n  return IoContextMenu.vConstructor(arg0);\n};"]}