{"version":3,"file":"IoMenuTree.js","sourceRoot":"","sources":["../../src/elements/IoMenuTree.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, ReactiveProperty, VDOMElement, Storage as $, IoElementProps, WithBinding, Property } from 'io-core';\nimport { ioField, ioString } from 'io-inputs';\nimport { MenuOption } from '../nodes/MenuOption.js';\nimport { ioMenuItem, IoMenuItem } from './IoMenuItem.js';\nimport { ioMenuTreeBranch } from './IoMenuTreeBranch.js';\nimport { searchMenuOption } from '../utils/MenuNodeUtils.js';\n\nfunction genObjectStorageID(object: Record<string, any>) {\n  const string = JSON.stringify(object);\n  let hash = 0;\n  for (let i = 0; i < string.length; i++) {\n    hash = Math.imul(31, hash) + string.charCodeAt(i) | 0;\n  }\n  return 'io-local-state-' + String(hash);\n}\n\nfunction addMenuOptionsOrTreeBranches(option: MenuOption, depth: number, d = 0) {\n  const elements: VDOMElement[] = [];\n  if (d <= depth) for (let i = 0; i < option.options.length; i++) {\n    const subOption = option.options[i] as MenuOption;\n    if (subOption.options.length) {\n      const collapsibleState = $({value: false, storage: 'local', key: genObjectStorageID(subOption)});\n      if (subOption.selected === true) collapsibleState.value = true;\n      elements.push(ioMenuTreeBranch({option: subOption, depth: d, expanded: collapsibleState}));\n    } else {\n      elements.push(ioMenuItem({option: subOption, depth: d}));\n    }\n  }\n  return elements;\n}\n\nexport type IoMenuTreeProps = IoElementProps & {\n  option?: MenuOption,\n  searchable?: boolean,\n  search?: WithBinding<string>,\n  depth?: number,\n  widget?: VDOMElement | null,\n};\n\n@Register\nexport class IoMenuTree extends IoElement {\n\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: var(--io_borderRadius);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: var(--io_spacing);\n      @apply --unselectable;\n    }\n    :host io-menu-tree {\n      padding: 0 !important;\n    }\n    :host > io-menu-item {\n      padding-left: var(--io_spacing);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-menu-item[selected] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: \"\"\n    }\n    `;\n  }\n\n  @ReactiveProperty({type: MenuOption})\n  declare option: MenuOption;\n\n  @ReactiveProperty({value: false, type: Boolean})\n  declare searchable: boolean;\n\n  @ReactiveProperty({value: '', type: String})\n  declare search: string;\n\n  @ReactiveProperty({value: Infinity, type: Number})\n  declare depth: number;\n\n  @ReactiveProperty(null)\n  declare widget: VDOMElement | null;\n\n  @Property()\n  declare $parent?: IoMenuItem;\n\n  @Property('listbox')\n  declare role: string;\n\n  constructor(args: IoMenuTreeProps = {}) { super(args); }\n\n  changed() {\n    const vChildren: VDOMElement[] = this.widget ? [this.widget] : [];\n\n    if (this.searchable) {\n      vChildren.push(ioString({\n        id: 'search',\n        role: 'search',\n        value: this.bind('search'),\n        placeholder: 'Search',\n        live: true\n      }));\n    }\n\n    if (this.search) {\n      const filteredItems = searchMenuOption(this.option, this.search, this.depth);\n      if (filteredItems.length === 0) {\n        vChildren.push(ioField({label: 'No matches'}));\n      } else for (let i = 0; i < filteredItems.length; i++) {\n        vChildren.push(ioMenuItem({option: filteredItems[i], depth: 0}));\n      }\n\n    } else {\n      vChildren.push(...addMenuOptionsOrTreeBranches(this.option, this.depth));\n    }\n\n    this.render(vChildren);\n  }\n}\nexport const ioMenuTree = function(arg0?: IoMenuTreeProps) {\n  return IoMenuTree.vConstructor(arg0);\n};"]}