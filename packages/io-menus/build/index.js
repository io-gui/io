import{IoNodeMixin as e,Property as t,Register as o,IoNode as n,IoElement as i,IoStorage as s,genObjectStorageID as r,div as l,IoThemeSingleton as a,IoOverlaySingleton as h,span as d}from"io-gui";import{ioIcon as p}from"io-icons";import{ioField as c,IoField as u}from"io-inputs";var __decorate$7=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};function _isNaN(e){return"number"==typeof e&&isNaN(e)}function _isSelectable(e){return"select"===e||"scroll"===e}let m=class MenuOptions extends(e(Array)){push(...e){for(let t=0;t<e.length;t++){const o=e[t];o instanceof v&&(o.addEventListener("selected-changed",this._onItemSelectedChanged),o.addEventListener("path-changed",this._onSubOptionsPathChanged),super.push(o))}}getItem(e,t=!1){for(let o=0;o<this.length;o++){if(this[o].value===e)return this[o];if(t&&this[o].options){const n=this[o].options.getItem(e,t);if(n)return n}}return null}constructor(e=[],t={}){const o=[];for(let t=0;t<e.length;t++)e[t]instanceof v?o.push(e[t]):o.push(new v(e[t]));super(t,...o),""!==this.path&&this.pathChanged(),void 0!==this.first&&this.firstChanged();for(let e=0;e<this.length;e++){const t=this[e];t.addEventListener("selected-changed",this._onItemSelectedChanged),t.addEventListener("path-changed",this._onSubOptionsPathChanged),t.selected&&"select"===t.mode&&this.updatePaths(t)}}addItems(e){for(let t=0;t<e.length;t++){let o;o=e[t]instanceof v?e[t]:new v(e[t]),this.push(o),o.addEventListener("selected-changed",this._onItemSelectedChanged),o.addEventListener("path-changed",this._onSubOptionsPathChanged)}}pathChanged(){const e=this.path?[...this.path.split(this.delimiter)]:[];if(this.length&&e.length){const t=e.shift(),o=this.find((e=>e.label===t));if(o)_isSelectable(o.mode)&&(o.options&&(o.options.path=e.join(this.delimiter)),o.selected=!0);else for(let e=0;e<this.length;e++)_isSelectable(this[e].mode)&&(this[e].selected=!1)}else for(let e=0;e<this.length;e++)_isSelectable(this[e].mode)&&(this[e].selected=!1)}firstChanged(){if(void 0!==this.first){const e=this.find((e=>e.value===this.first&&"select"===e.mode||_isNaN(e.value)&&_isNaN(this.first)));e&&(e.selected=!0)}else for(let e=0;e<this.length;e++)"select"===this[e].mode&&(this[e].selected=!1)}lastChanged(){}updatePaths(e){const t=[];let o="select"===e?.mode||"scroll"===e?.mode?e:void 0,n="select"===e?.mode?e:void 0,i="scroll"===e?.mode?e:void 0;const s=this.find((e=>"select"===e.mode&&e.selected)),r=this.find((e=>"scroll"===e.mode&&e.selected));if(o||!s&&!r){for(;o;)t.push(o.label),"select"===o.mode&&(n=o),"scroll"===o.mode&&(i=o),o=o.options?.find((e=>("select"===e.mode||"scroll"===e.mode)&&e.selected));this.setProperties({path:t.join(this.delimiter),first:"select"===e?.mode?e.value:void 0,last:void 0!==n?n.value:void 0,scroll:void 0!==i?i.value:void 0})}}_onItemSelectedChanged(e){const t=e.target;if(_isSelectable(t.mode))if(t.selected){for(let e=0;e<this.length;e++)this[e]!==t&&_isSelectable(this[e].mode)&&(this[e].selected=!1);this.updatePaths(t),this.dispatchEvent("item-selected",{item:t})}else this.updatePaths()}_onSubOptionsPathChanged(e){const t=e.target;t.selected?this.updatePaths(t):this.updatePaths()}selectDefault(){for(let e=0;e<this.length;e++)if(_isSelectable(this[e].mode)){if(!this[e].hasmore)return this[e].selected=!0,!0;if(this[e].options.selectDefault())return!0}return!1}bind(e){return super.bind(e)}dispose(){for(let e=0;e<this.length;e++)this[e].removeEventListener("selected-changed",this._onItemSelectedChanged),this[e].removeEventListener("path-changed",this._onSubOptionsPathChanged);super.dispose()}};__decorate$7([t(void 0)],m.prototype,"first",void 0),__decorate$7([t(void 0)],m.prototype,"last",void 0),__decorate$7([t(void 0)],m.prototype,"scroll",void 0),__decorate$7([t("")],m.prototype,"path",void 0),__decorate$7([t(",")],m.prototype,"delimiter",void 0),m=__decorate$7([o],m);var __decorate$6=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let v=class MenuItem extends n{get hasmore(){return!!this.options?.length}getSubitem(e){return this.options?.getItem(e)}constructor(e){const t={value:"",label:""};"object"!=typeof e||null===e?(t.value=e,t.label=String(e)):(t.value=e.value,void 0===e.label?"object"==typeof t.value?null===t.value?t.label="null":t.label=`${t.value.constructor.name}`+(t.value instanceof Array?`(${t.value.length})`:""):t.label=String(t.value):t.label=e.label,void 0!==e.icon&&(t.icon=e.icon),void 0!==e.hint&&(t.hint=e.hint),void 0!==e.hidden&&(t.hidden=e.hidden),void 0!==e.disabled&&(t.disabled=e.disabled),void 0!==e.action&&(t.action=e.action),void 0!==e.mode&&(t.mode=e.mode),void 0!==e.selected&&(t.selected=e.selected),void 0!==e.options&&(e.options instanceof m?t.options=e.options:t.options=new m(e.options)),void 0!==t.selected||"select"!==e.mode&&void 0!==e.mode||!t.options||(t.selected=!!t.options.find((e=>e.selected&&"select"===e.mode)))),super(t),this.options&&(this.options.addEventListener("item-selected",this._onSubItemSelected),this.options.addEventListener("path-changed",this._onOptionsPathChanged))}toJSON(){const e={value:this.value,label:this.label,icon:this.icon,hint:this.hint,hidden:this.hidden,disabled:this.disabled};return this.options&&(e.options=this.options),e}_onSubItemSelected(){this.selected=!0}_onOptionsPathChanged(e){this.dispatchEvent("path-changed",e.detail)}optionsChanged(){void 0===this.options?.first&&void 0===this.options?.scroll||"select"!==this.mode||(this.selected=!0)}selectedChanged(){if("select"===this.mode&&!1===this.selected&&this.options){for(let e=0;e<this.options.length;e++)"select"!==this.options[e].mode&&"scroll"!==this.options[e].mode||(this.options[e].selected=!1);this.options.updatePaths()}}dispose(){this.options&&(this.options.removeEventListener("item-selected",this._onSubItemSelected),this.options.removeEventListener("path-changed",this._onOptionsPathChanged)),super.dispose()}};__decorate$6([t(void 0)],v.prototype,"value",void 0),__decorate$6([t("")],v.prototype,"label",void 0),__decorate$6([t("")],v.prototype,"icon",void 0),__decorate$6([t("")],v.prototype,"hint",void 0),__decorate$6([t(!1)],v.prototype,"hidden",void 0),__decorate$6([t(!1)],v.prototype,"disabled",void 0),__decorate$6([t(void 0)],v.prototype,"action",void 0),__decorate$6([t("select")],v.prototype,"mode",void 0),__decorate$6([t(!1)],v.prototype,"selected",void 0),__decorate$6([t(void 0)],v.prototype,"options",void 0),v=__decorate$6([o],v);var __decorate$5=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};function addMenuOptions(e,t,o=0){const n=[];if(o<=t)for(let i=0;i<e.length;i++){const a=e[i];if(a.options?.length){const e=s({value:a.selected,storage:"local",key:r(a)});!0===a.selected&&(e.value=!0),n.push(l([...addMenuOptions(a.options,t,o+1)]))}else n.push(w({item:a,depth:o}))}return n}function matchItem(e,t){return void 0!==e.value&&-1!==String(e.value).toLowerCase().indexOf(t)||(!(!e.label||-1===e.label.toLowerCase().indexOf(t))||!(!e.hint||-1===e.hint.toLowerCase().indexOf(t)))}function filterOptions(e,t,o=5,n=[],i=0){if(t=t.toLowerCase(),i<=o)for(let s=0;s<e.length;s++)matchItem(e[s],t)&&n.push(w({item:e[s],depth:0})),e[s].options&&filterOptions(e[s].options,t,o,n,i+1)}let g=class IoMenuTree extends i{static get Style(){return'\n    :host {\n      display: flex;\n      flex: 0 0 auto;\n      flex-direction: column;\n      flex-wrap: nowrap;\n      align-self: stretch;\n      align-items: stretch;\n      justify-self: stretch;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      color: var(--io_colorField);\n      background-color: var(--io_bgColorDimmed);\n      padding: var(--io_spacing) 0;\n      align-self: flex-start;\n      user-select: none;\n      transition: opacity 0.25s;\n      overflow: auto;\n    }\n\n    :host io-collapsible {\n      flex: 0 0 auto;\n      border-color: transparent;\n      border: 0;\n      overflow: visible;\n    }\n    :host io-collapsible > div.io-collapsible-content {\n      background-color: transparent;\n      flex: 0 0 auto;\n      border-radius: 0 !important;\n      margin: 0 !important;\n      padding: 0 !important;\n      background: var(--io_bgColorDimmed);\n    }\n    \n    :host io-menu-item:first-of-type {\n      margin-top: var(--io_borderWidth);\n    }\n    :host io-menu-item {\n      background-color: var(--io_bgColorDimmed);\n      flex: 0 0 auto;\n      align-self: stretch;\n      border-radius: 0;\n      margin-left: var(--io_borderWidth);\n      margin-right: var(--io_borderWidth);\n    }\n    :host io-menu-item[depth="1"] {\n      padding-left: calc(var(--io_lineHeight) * 1);\n    }\n    :host io-menu-item[depth="2"] {\n      padding-left: calc(var(--io_lineHeight) * 2);\n    }\n    :host io-menu-item[depth="3"] {\n      padding-left: calc(var(--io_lineHeight) * 3);\n    }\n    :host io-menu-item[depth="4"] {\n      padding-left: calc(var(--io_lineHeight) * 4);\n    }\n    :host io-menu-item[depth="5"] {\n      padding-left: calc(var(--io_lineHeight) * 5);\n    }\n    :host io-menu-item[depth="6"] {\n      padding-left: calc(var(--io_lineHeight) * 6);\n    }\n    /* Item spacing */\n    :host io-menu-item {\n      margin-bottom: var(--io_borderWidth);\n    }\n    :host io-menu-item:first-of-type {\n      /* margin-top: var(--io_spacing); */\n    }\n\n    /* Search field */\n    :host > .search {\n      border-radius: 0;\n      flex: 0 0 auto;\n    }\n    '}static get Listeners(){return{"item-clicked":"_onItemClicked"}}_onItemClicked(e){const t=e.composedPath()[0],o=e.detail;t!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",o,!0),this.throttle(this._onCollapse))}_onCollapse(){const e=this.searchable&&this.search;this.search="",e&&this.$.search.focus()}changed(){const e=[...this.slotted];if(this.searchable&&e.push(c({$:"search",role:"search",class:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=e.length;filterOptions(this.options,this.search,this.depth,e),t===e.length&&e.push(w({item:new v({label:"No matches",mode:"none"})}))}else e.push(...addMenuOptions(this.options,this.depth));this.template(e)}};__decorate$5([t({type:m,reflect:!0})],g.prototype,"options",void 0),__decorate$5([t(!1)],g.prototype,"searchable",void 0),__decorate$5([t("")],g.prototype,"search",void 0),__decorate$5([t(Infinity)],g.prototype,"depth",void 0),__decorate$5([t({type:Array})],g.prototype,"slotted",void 0),__decorate$5([t("listbox")],g.prototype,"role",void 0),__decorate$5([t(void 0)],g.prototype,"$parent",void 0),g=__decorate$5([o],g);const f=g.vDOM;var __decorate$4=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};const _=new WeakMap;let b=class IoMenuOptions extends i{static get Style(){return'\n    :host {\n      display: flex;\n      border-radius: var(--io_borderRadius);\n      background-color: var(--io_bgColorDimmed);\n      position: relative;\n    }\n    :host[horizontal] {\n      flex-direction: row;\n      align-self: stretch;\n      padding: 0 var(--io_spacing);\n    }\n    :host:not([horizontal]) {\n      flex-direction: column;\n      padding: var(--io_spacing) 0;\n    }\n    :host[inlayer] {\n      min-width: 8em;\n    }\n    :host[inlayer]:not([expanded]) {\n      visibility: hidden;\n      opacity: 0;\n    }\n\n    /* Menu Items */\n    :host > io-menu-item {\n      background-color: transparent;\n      border-radius: 0;\n    }\n    :host[horizontal] > io-menu-item {\n      height: calc(var(--io_fieldHeight) + var(--io_spacing2));\n      border-left: none;\n      border-right: none;\n      border-width: calc(var(--io_spacing) + var(--io_borderWidth)) var(--io_borderWidth);\n    }\n    :host:not([horizontal]) > io-menu-item {\n      border-top: none;\n      border-bottom: none;\n      border-width: var(--io_borderWidth) var(--io_spacing);\n    }\n    :host > io-menu-item[selected][direction="up"] {\n      border-color: var(--io_colorBlue) transparent transparent transparent;\n    }\n    :host > io-menu-item[selected][direction="down"] {\n      border-color: transparent transparent var(--io_colorBlue) transparent;\n    }\n    :host > io-menu-item[selected][direction="right"] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item[selected][direction="left"] {\n      border-color: transparent transparent transparent var(--io_colorBlue);\n    }\n\n    /* Item divider */\n    :host > [hidden] ~ span.divider {\n      border-color: red;\n      display: none;\n    }\n    :host > span.divider {\n      flex: 0 0 0;\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n      margin: var(--io_spacing);\n      opacity: 0.5;\n    }\n\n    /* Remove hints from horizontal menu */\n    :host[horizontal] > io-menu-item > .hint {\n      display: none;\n    }\n\n    /* Search field */\n    :host:not([horizontal]) > .search {\n      margin: var(--io_spacing);\n      margin-top: 0;\n    }\n    :host[horizontal] > .search {\n      margin-right: var(--io_borderWidth);\n      flex: 0 0 10em;\n    }\n\n    /* Hamburger menu for overflow items */\n    :host > io-menu-hamburger {\n      border-color: transparent !important;\n      background-color: transparent !important;\n    }\n    :host[horizontal] > io-menu-hamburger {\n      position: absolute;\n      right: var(--io_spacing);\n      padding: var(--io_spacing);\n    }\n    '}static get Listeners(){return{"item-clicked":"_onItemClicked",touchstart:["_stopPropagation",{passive:!1}]}}_onItemClicked(e){const t=e.composedPath()[0],o=e.detail;"io-string"!==t.localName?t!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",o,!0),this.throttle(this._onCollapse)):e.stopImmediatePropagation()}_stopPropagation(e){e.stopPropagation()}init(){this.throttle(this._onSetOverflow)}onResized(){this.throttle(this._onSetOverflow)}_onSetOverflow(){if(this._disposed)return;const e=this.querySelectorAll(".item");if(this._overflownItems.length=0,this.horizontal){const t=this.querySelector("io-menu-hamburger"),o=t?.getBoundingClientRect().width||0,n=this.getBoundingClientRect().right-(a.borderWidth+a.spacing);let i=Infinity,s=!1;for(let t=e.length;t--;){const r=e[t].getBoundingClientRect(),l=_.get(e[t].item)||{right:0,width:0};0!==r.right&&0!==r.width&&(l.right=r.right,l.width=r.width,_.set(e[t].item,l)),i=Math.min(i,l.right),this.noPartialCollapse&&s?(e[t].hidden=!0,this._overflownItems.unshift(e[t].item)):t===e.length-1&&i<n||i<n-1.5*o?e[t].hidden=!1:(s=!0,e[t].hidden=!0,this._overflownItems.unshift(e[t].item))}this._overflownItems.length?this.overflow=JSON.stringify(this._overflownItems.map((e=>e.label))):this.overflow=""}else this.overflow=""}_onCollapse(){const e=this.selectable&&!!this.search&&!this.inlayer;this.setProperties({search:"",expanded:!1}),e&&this.$.search.focus()}expandedChanged(){this.expanded?this.inlayer&&this.throttle(this._onExpandInOverlay):(this.style.top=null,this.style.height=null,this.style.touchAction=null,this.scrollTop=0,this.search="")}searchChanged(){this.inlayer&&this.$parent&&this.throttle(this._onClipHeight),this.throttle(this._onSetOverflow)}_onExpandInOverlay(){if(this.$parent){const e=this.$parent.getBoundingClientRect();h.setElementPosition(this,this.direction,e),this._onClipHeight()}}_onClipHeight(){if(this.scrollTop=0,!this.firstChild)return;const e=this.firstChild.getBoundingClientRect().top,t=this.lastChild.getBoundingClientRect().bottom,o=t-e;e<0?(this.style.top="0px",this.style.height=o+e+"px",this.style.touchAction="pan-y"):t>window.innerHeight?(this.style.height=window.innerHeight-e+"px",this.style.touchAction="pan-y"):(this.style.height=null,this.style.touchAction=null)}changed(){const e=[...this.slotted];if(this.searchable&&e.push(c({$:"search",role:"search",class:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=e.length;filterOptions(this.options,this.search,this.depth,e),t===e.length&&e.push(w({item:new v({label:"No matches",mode:"none"})}))}else{let t=this.horizontal?"down":"right";this.horizontal&&"up"===this.direction&&(t="up");for(let o=0;o<this.options.length;o++)e.push(w({class:"item",item:this.options[o],direction:t,depth:this.depth})),o<this.options.length-1&&e.push(["span",{class:"divider"}])}this.overflow&&e.push(I({depth:this.depth+1,role:"navigation",direction:"down",item:new v({options:new m(this._overflownItems)})})),this.template(e)}};__decorate$4([t({type:m})],b.prototype,"options",void 0),__decorate$4([t({value:!1,reflect:!0})],b.prototype,"expanded",void 0),__decorate$4([t({value:!1,reflect:!0})],b.prototype,"horizontal",void 0),__decorate$4([t(!1)],b.prototype,"searchable",void 0),__decorate$4([t("")],b.prototype,"search",void 0),__decorate$4([t({value:"none",reflect:!0})],b.prototype,"direction",void 0),__decorate$4([t(100)],b.prototype,"depth",void 0),__decorate$4([t(!1)],b.prototype,"noPartialCollapse",void 0),__decorate$4([t({value:"",reflect:!0})],b.prototype,"overflow",void 0),__decorate$4([t({value:!1,reflect:!0})],b.prototype,"inlayer",void 0),__decorate$4([t({type:Array})],b.prototype,"slotted",void 0),__decorate$4([t("listbox")],b.prototype,"role",void 0),__decorate$4([t(void 0)],b.prototype,"$parent",void 0),__decorate$4([t({type:Array})],b.prototype,"_overflownItems",void 0),b=__decorate$4([o],b);const y=b.vDOM;var __decorate$3=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};const x=["io-menu-item","io-menu-hamburger","io-option-menu"],C=x.join(", ");let P=class IoMenuItem extends u{static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n      :host > .label {\n        flex: 1 1 auto;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hint {\n        flex: 0 1 auto;\n        opacity: 0.25;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hasmore {\n        opacity: 0.5;\n      }\n    "}static get Listeners(){return{click:"preventDefault"}}preventDefault(e){e.stopPropagation(),e.preventDefault()}get hasmore(){return this.item.hasmore&&this.depth>0}get inlayer(){return!!this.$parent&&!!this.$parent.inlayer}get $parent(){return this.parentElement}connectedCallback(){super.connectedCallback(),h.addEventListener("pointermove",this._onOverlayPointermove),h.addEventListener("pointerup",this._onOverlayPointerup),this.$options&&h.appendChild(this.$options)}disconnectedCallback(){super.disconnectedCallback(),h.removeEventListener("pointermove",this._onOverlayPointermove),h.removeEventListener("pointerup",this._onOverlayPointerup),this.$options&&this.$options.inlayer&&h.removeChild(this.$options)}_onOverlayPointermove(e){!this.inlayer&&this.expanded&&this._onPointermove(e)}_onOverlayPointerup(e){!this.inlayer&&this.expanded&&this._onPointerupAction(e)}_onClick(){const e=this.item;this.hasmore?this.expanded||(this.expanded=!0):"toggle"===e.mode?e.selected=!e.selected:(e.action&&e.action.apply(null,[e.value]),"select"===e.mode?e.hasmore&&e.options&&this.depth<=0?e.options.selectDefault():e.selected=!0:"scroll"===e.mode?e.selected=!0:"link"===e.mode&&window.open(e.value,"_blank"),this.dispatchEvent("item-clicked",e,!0),this.throttle(this._onCollapse))}_onItemClicked(e){e.composedPath()[0]!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",e.detail,!0)),this.expanded&&this.throttle(this._onCollapse)}_onPointerdown(e){e.stopPropagation(),e.preventDefault(),this.setPointerCapture(e.pointerId),this.addEventListener("pointermove",this._onPointermove),this.addEventListener("pointerup",this._onPointerup),this._onPointerdownAction(e)}_onPointerdownAction(e){(this.expanded||"mouse"===e.pointerType||this.inlayer)&&(this.focus(),this.item.options&&(this.expanded=!0)),this._x=e.clientX,this._y=e.clientY}_onPointermove(e){e.stopPropagation(),this._onPointermoveAction(e)}_onPointermoveAction(e){if(!this.expanded&&"touch"===e.pointerType&&!this.inlayer)return;const t=!!this.$parent&&!!this.$parent.style.height;if("touch"===e.pointerType&&t)return;const o=e.clientX-this._x,n=e.clientY-this._y;if(this._x=e.clientX,this._y=e.clientY,h.x=e.clientX,h.y=e.clientY,clearTimeout(this._timeoutOpen),O=this._gethovered(e),O){const e=Math.abs(n)-Math.abs(o),t=O.parentElement.horizontal;$?.parentElement!==O.parentElement||(t?e<-.25:e>.25)?this._expandHovered():this._timeoutOpen=setTimeout((()=>{this._expandHovered()}),100),$=O}}_onPointerup(e){e.stopPropagation(),this.removeEventListener("pointermove",this._onPointermove),this.removeEventListener("pointerup",this._onPointerup),this._onPointerupAction(e)}_onPointerupAction(e,t=!1){const o=this._gethovered(e);o?(o.focus(),o._onClick(e)):t||this.throttle(this._onCollapseRoot),O=void 0,$=void 0}_gethovered(e){const t=getMenuDescendants(getMenuRoot(this)),o=[];for(let n=t.length;n--;)isPointerAboveIoMenuItem(e,t[n])&&o.push(t[n]);if(o.length)return o.sort(((e,t)=>e.depth<t.depth?1:e.depth>t.depth?-1:0)),o[o.length-1]}_expandHovered(){if(O){if(O.focus(),O.hasmore){if(O.$options){const e=getMenuDescendants(O.$options);for(let t=e.length;t--;)e[t].expanded=!1}O.expanded=!0}if(O.$parent){const e=O.$parent.querySelectorAll(C);for(let t=e.length;t--;)e[t]!==O&&(e[t].expanded=!1)}}}_onKeydown(e){if("Enter"===e.key||" "===e.key)return e.preventDefault(),void this._onClick();if("Escape"===e.key)return e.preventDefault(),void this.throttle(this._onCollapseRoot);let t="";"left"===this.direction||"right"===this.direction?("ArrowUp"===e.key&&(t="prev"),"ArrowRight"===e.key&&(t="in"),"ArrowDown"===e.key&&(t="next"),"ArrowLeft"===e.key&&(t="out")):("ArrowUp"===e.key&&(t="out"),"ArrowRight"===e.key&&(t="next"),"ArrowDown"===e.key&&(t="in"),"ArrowLeft"===e.key&&(t="prev")),this.inlayer&&"Tab"===e.key&&(t="next");const o=this.$parent?[...this.$parent.children]:[],n=o.indexOf(this);if(t)switch(e.preventDefault(),t){case"prev":{const e=o[(n+o.length-1)%o.length];this.expanded=!1,e&&(e.hasmore&&(e.expanded=!0),e.focus());break}case"next":{const e=o[(n+1)%o.length];this.expanded=!1,e&&(e.hasmore&&(e.expanded=!0),e.focus());break}case"in":this.$options&&this.$options.children.length&&this.$options.children[0].focus();break;case"out":this.expanded=!1,this.$parent&&this.$parent.$parent&&this.$parent.$parent.focus()}else super._onKeydown(e)}_onCollapse(){this.expanded=!1}_onCollapseRoot(){getMenuRoot(this).expanded=!1}expandedChanged(){if(this.expanded&&this.depth>0){this.item.options&&void 0===this.$options&&(this.$options=new b({expanded:this.bind("expanded"),inlayer:!0,depth:this.depth-1,options:this.item.options,direction:this.direction,$parent:this}));const e=getMenuDescendants(getMenuRoot(this)),t=getMenuAncestors(this),o=getMenuDescendants(this);for(let n=e.length;n--;)e[n]!==this&&-1===t.indexOf(e[n])&&-1===o.indexOf(e[n])&&(e[n].expanded=!1)}if(this.$options){this.expanded?(this.$options.parentElement!==h&&h.appendChild(this.$options),this.$options.addEventListener("item-clicked",this._onItemClicked)):this.$options.removeEventListener("item-clicked",this._onItemClicked);const e=getMenuDescendants(this.$options);for(let t=e.length;t--;)e[t].expanded=!1}}itemChanged(){this.setProperties({selected:this.item.bind("selected"),disabled:this.item.bind("disabled")})}itemMutated(){this.changed()}changed(){void 0!==this.$options&&this.item.options&&(this.$options.options=this.item.options);const e=this.icon||this.item.icon;this.setAttribute("hidden",this.item.hidden),this.setAttribute("hasmore",this.hasmore),this.template([this.hasmore&&"left"===this.direction?p({class:"hasmore",icon:"menu:triangle_left"}):null,this.hasmore&&"up"===this.direction?p({class:"hasmore",icon:"menu:triangle_up"}):null,e?p({icon:e}):null,this.item.label?d({class:"label"},this.item.label):null,this.item.hint?d({class:"hint"},this.item.hint):null,this.hasmore&&"right"===this.direction?p({class:"hasmore",icon:"menu:triangle_right"}):null,this.hasmore&&"down"===this.direction?p({class:"hasmore",icon:"menu:triangle_down"}):null])}};__decorate$3([t({type:v})],P.prototype,"item",void 0),__decorate$3([t({value:!1,reflect:!0})],P.prototype,"expanded",void 0),__decorate$3([t({value:"right",reflect:!0})],P.prototype,"direction",void 0),__decorate$3([t({value:1e3,reflect:!0})],P.prototype,"depth",void 0),P=__decorate$3([o],P);const w=P.vDOM;function getMenuDescendants(e){const t=[];if(e.$options){if(e.expanded){t.push(e.$options);const o=e.$options.querySelectorAll(C);for(let e=o.length;e--;)t.push(o[e]),o[e].expanded&&t.push(...getMenuDescendants(o[e]))}}else{const o=e.querySelectorAll(C);for(let e=o.length;e--;)t.push(o[e]),o[e].expanded&&t.push(...getMenuDescendants(o[e]))}return t}function getMenuAncestors(e){const t=[];let o=e;for(;o&&o.$parent;)o=o.$parent,o&&t.push(o);return t}function getMenuRoot(e){let t=e;for(;t&&t.$parent;)t=t.$parent;return t}function isPointerAboveIoMenuItem(e,t){if(-1!==x.indexOf(t.localName)&&!t.disabled&&!t.hidden&&(!t.inlayer||t.parentElement.expanded&&h.expanded)){const o=1,n=t.getBoundingClientRect(),i=e.clientX,s=e.clientY;return n.top<=s+o&&n.bottom>=s-o&&n.left<=i+o&&n.right>=i-o}return null}let O,$;var __decorate$2=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let k=class IoMenuHamburger extends P{static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n    "}changed(){void 0!==this.$options&&this.item.options&&(this.$options.options=this.item.options),this.setAttribute("selected",this.item.selected),this.setAttribute("hidden",this.item.hidden),this.disabled=this.item.disabled,this.template([p({icon:"menu:hamburger"})])}};k=__decorate$2([o],k);const I=k.vDOM;var __decorate$1=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};const E=new m;let S=class IoOptionMenu extends i{static get Style(){return"\n    :host {\n      display: inline-block;\n      text-align: center;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorDimmed);\n      background-image: var(--io_gradientOutset);\n      /* padding-left: calc(2 * var(--io_spacing)); */\n      /* padding-right: calc(2 * var(--io_spacing)); */\n      text-align: left;\n    }\n    :host > io-menu-item {\n      margin: calc(-1 * var(--io_borderWidth));\n      background-color: transparent !important;\n      border-color: transparent !important;\n    }\n    :host > io-menu-item[selected] {\n      color: var(--io_colorStrong);\n    }\n    "}_onLeafChanged(e){this.inputValue(e.detail.value)}optionsChanged(e){e.oldValue&&e.oldValue!==E&&e.oldValue.removeEventListener("last-changed",this._onLeafChanged),e.value&&e.value.addEventListener("last-changed",this._onLeafChanged);const t=this.options.getItem(this.value);t&&(t.selected=!0)}changed(){const e=this.options.getItem(this.value);this.item=this.item||new v({}),this.item.label=e?.label||String(this.value),this.item.options=this.options,this.item.icon=this.icon||"",this.template([w({item:this.item,direction:"down"})])}};__decorate$1([t({value:void 0,reflect:!0})],S.prototype,"value",void 0),__decorate$1([t({value:E,type:m,reflect:!0})],S.prototype,"options",void 0),__decorate$1([t("button")],S.prototype,"role",void 0),__decorate$1([t(v)],S.prototype,"item",void 0),S=__decorate$1([o],S);const L=S.vDOM;var __decorate=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let R=class IoContextMenu extends i{static get Properties(){return{$options:null}}connectedCallback(){super.connectedCallback(),h.addEventListener("pointermove",this._onOverlayPointermove),this._parent=this.parentElement,this._parent.addEventListener("pointerdown",this._onPointerdown),this._parent.addEventListener("click",this._onClick),this._parent.addEventListener("contextmenu",this._onContextmenu)}disconnectedCallback(){super.disconnectedCallback(),this.$options&&this.$options.parentElement&&h.removeChild(this.$options),h.removeEventListener("pointermove",this._onOverlayPointermove),this._parent.removeEventListener("pointerdown",this._onPointerdown),this._parent.removeEventListener("contextmenu",this._onContextmenu),this._parent.removeEventListener("pointermove",this._onPointermove),this._parent.removeEventListener("pointerup",this._onPointerup),this._parent.removeEventListener("click",this._onClick),delete this._parent}getBoundingClientRect(){return this._parent.getBoundingClientRect()}_onItemClicked(e){const t=e.composedPath()[0],o=e.detail;t!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",o,!0),this.throttle(this._onCollapse))}_onContextmenu(e){2===this.button&&e.preventDefault()}_onPointerdown(e){h.x=e.clientX,h.y=e.clientY,this._parent.addEventListener("pointermove",this._onPointermove),this._parent.addEventListener("pointerup",this._onPointerup),clearTimeout(this._contextTimeout),"touch"!==e.pointerType?e.button===this.button&&(this.setPointerCapture(e.pointerId),this.expanded=!0):(e.preventDefault(),this._contextTimeout=setTimeout((()=>{this.setPointerCapture(e.pointerId),this.expanded=!0}),150))}_onPointermove(e){clearTimeout(this._contextTimeout),this.expanded&&this.$options?.querySelector("io-menu-item")?._onPointermoveAction(e)}_onPointerup(e){clearTimeout(this._contextTimeout),this.releasePointerCapture(e.pointerId),this.expanded&&this.$options?.querySelector("io-menu-item")?._onPointerupAction(e,!0),this._parent.removeEventListener("pointermove",this._onPointermove),this._parent.removeEventListener("pointerup",this._onPointerup)}_onOverlayPointermove(e){this.expanded&&this._onPointermove(e)}_onClick(e){e.button===this.button&&2!==e.button&&(this.expanded=!0)}_onCollapse(){this.expanded=!1}optionsChanged(){this.$options&&(h.removeChild(this.$options),this.$options.template([]),this.$options.dispose()),this.$options=new b({expanded:this.bind("expanded"),inlayer:!0,options:this.options,direction:"pointer",$parent:this,"@item-clicked":this._onItemClicked}),h.appendChild(this.$options)}};__decorate([t({type:m})],R.prototype,"options",void 0),__decorate([t({value:!1,reflect:!0})],R.prototype,"expanded",void 0),__decorate([t(0)],R.prototype,"button",void 0),R=__decorate([o],R);const M=R.vDOM;export{R as IoContextMenu,k as IoMenuHamburger,P as IoMenuItem,b as IoMenuOptions,g as IoMenuTree,S as IoOptionMenu,v as MenuItem,m as MenuOptions,addMenuOptions,filterOptions,getMenuAncestors,getMenuDescendants,getMenuRoot,M as ioContextMenu,I as ioMenuHamburger,w as ioMenuItem,y as ioMenuOptions,f as ioMenuTree,L as ioOptionMenu};
