import{ReactiveProperty as e,NodeArray as t,Register as o,Node as n,IoOverlaySingleton as i,Property as s,IoElement as r,nudge as l,span as a,Storage as p}from"io-gui";import{ioIcon as d}from"io-icons";import{ioString as h,ioField as c,IoField as u,ioBoolean as v}from"io-inputs";var f,__decorate$7=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let g=f=class MenuOption extends n{static get Listeners(){return{"option-selected-changed":"onOptionSelectedChanged"}}constructor(e){"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e&&null!=e||(e={id:String(e),value:e}),(e={...e}).id=e.id??"null",e.label=e.label??e.id,e.value=e.value??e.id,e.options=e.options??[],e.options=e.options.map(e=>e instanceof f?e:new f(e));const t=e.options.filter(e=>"select"===e.mode&&e.selected);for(let e=1;e<t.length;e++)t[e].selected=!1;super(e)}getAllOptions(){const e=[this];for(let t=0;t<this.options.length;t++)e.push(...this.options[t].getAllOptions());return e}findItemByValue(e){const t=this.getAllOptions();for(let o=0;o<t.length;o++)if(t[o].value===e)return t[o];return null}findItemById(e){const t=this.getAllOptions();for(let o=0;o<t.length;o++)if(t[o].id===e)return t[o];return null}selectDefault(){let e="select"===this.mode?this:void 0;for(;e;){const t=e.options.find(e=>"select"===e.mode);if("select"!==e.mode||!t)break;e=t}e&&(e.selected=!0)}selectedChanged(){!1===this.selected&&this.unselectSuboptions(),this.dispatch("option-selected-changed",{option:this},!0)}selectedIDChanged(){const e=this.findItemById(this.selectedID);e&&(e.selected=!0,this.dispatch("option-selected",{option:e},!1))}selectedIDImmediateChanged(){if(this.selectedIDImmediate){this.selected=!0;const e=this.options.find(e=>e.id===this.selectedIDImmediate);e&&(e.selected=!0)}this.updatePaths()}getSelectedIDImmediate(){let e="";for(let t=0;t<this.options.length;t++){const o=this.options[t];if(o.selected&&o.id){e=o.id;break}}return e}setSelectedIDImmediate(e){this.options.withInternalOperation(()=>{for(let t=0;t<this.options.length;t++){const o=this.options[t];o.id===e?o.selected=!0:o.selected=!1}}),this.options.dispatchMutation()}onOptionSelectedChanged(e){if(-1===this.options.indexOf(e.detail.option))return;if(e.detail.option===this)return;const t=e.detail.option;if(t.selected)for(let e=0;e<this.options.length;e++){const o=this.options[e];o!==t&&"select"===o.mode&&"select"===t.mode&&(o.selected=!1)}this.options.some(e=>e.selected&&"select"===e.mode)||this.setProperties({selectedID:"",selectedIDImmediate:"",path:""})}unselectSuboptions(){for(let e=0;e<this.options.length;e++){const t=this.options[e];"select"===t.mode&&(t.selected=!1,t.unselectSuboptions())}}updatePaths(){const e=[];if("select"!==this.mode||!this.selected)return void(this.path="");let t=this.getSelectedIDImmediate(),o=t?this.options.find(e=>"select"===e.mode&&e.selected&&e.id===t):void 0;if(o){for(;o;)e.push(o.id),t=o.getSelectedIDImmediate(),o=t?o.options.find(e=>"select"===e.mode&&e.selected&&e.id===t):void 0;this.path=e.join(",")}}pathChanged(){const e=this.path?[...this.path.split(",")]:[];e.length&&(this.selectedID=e[e.length-1])}optionsMutated(e){const t=this.getSelectedIDImmediate();"select"===this.mode&&t&&this.options.length&&this.setProperties({selectedIDImmediate:t}),this.updatePaths(),this.dispatchMutation()}toJSON(){return{id:this.id,value:this.value,label:this.label,icon:this.icon,hint:this.hint,disabled:this.disabled,mode:this.mode,options:this.options.map(e=>e.toJSON())}}fromJSON(e){return this.setProperties({id:e.id,value:e.value??void 0,label:e.label??e.id,icon:e.icon??"",hint:e.hint??"",disabled:e.disabled??!1,mode:e.mode??"select",selected:e.selected??!1,options:e.options?.map(e=>new f(e))??[]}),this}changed(){}dispose(){this.options.length=0,super.dispose()}};__decorate$7([e({value:"",type:String})],g.prototype,"id",void 0),__decorate$7([e({value:void 0})],g.prototype,"value",void 0),__decorate$7([e({value:"",type:String})],g.prototype,"label",void 0),__decorate$7([e({value:"",type:String})],g.prototype,"icon",void 0),__decorate$7([e({value:"",type:String})],g.prototype,"hint",void 0),__decorate$7([e({value:!1,type:Boolean})],g.prototype,"disabled",void 0),__decorate$7([e()],g.prototype,"action",void 0),__decorate$7([e({value:"select",type:String})],g.prototype,"mode",void 0),__decorate$7([e({value:!1,type:Boolean})],g.prototype,"selected",void 0),__decorate$7([e({value:"",type:String})],g.prototype,"selectedIDImmediate",void 0),__decorate$7([e({value:"",type:String})],g.prototype,"selectedID",void 0),__decorate$7([e({value:"",type:String})],g.prototype,"path",void 0),__decorate$7([e({type:t,init:"this"})],g.prototype,"options",void 0),g=f=__decorate$7([o],g);const m=["io-menu-item","io-menu-options","io-menu-hamburger","io-option-select","io-string","io-menu-tree"],y=m.join(", ");function getMenuDescendants(e){const t=[];if(e.$options){t.push(e.$options);const o=e.$options.querySelectorAll(y);for(let e=o.length;e--;)t.push(o[e]),t.push(...getMenuDescendants(o[e]))}else{const o=Array.from(e.querySelectorAll(y));for(let e=o.length;e--;)t.push(o[e]),t.push(...getMenuDescendants(o[e]))}return t}function getMenuAncestors(e){const t=[];let o=e;for(;o&&o.$parent;)o=o.$parent,o&&t.push(o);return t}function getMenuSiblings(e){const t=[],o=e.parentElement;return o&&t.push(...Array.from(o.querySelectorAll(y))),t}function getMenuRoot(e){let t=e;for(;t&&t.$parent;)t=t.$parent;return t}function isPointerAboveIoMenuItem(e,t){if(-1!==m.indexOf(t.localName)&&!t.disabled&&t.parentElement!==i&&t.parentElement.expanded){const o=t.getBoundingClientRect(),n=e.clientX,i=e.clientY;return o.top<=i&&o.bottom>=i&&o.left<=n&&o.right>=n}return!1}function matchMenuOption(e,t){return!e.options.length&&(void 0!==e.value&&-1!==String(e.value).toLowerCase().indexOf(t)||(!(!e.label||-1===e.label.toLowerCase().indexOf(t))||!(!e.hint||-1===e.hint.toLowerCase().indexOf(t))))}function searchMenuOption(e,t,o=5,n=0){t=t.toLowerCase();const i=[];if(n<=o)for(let s=0;s<e.options.length;s++)matchMenuOption(e.options[s],t)&&i.push(e.options[s]),e.options[s].options.length&&i.push(...searchMenuOption(e.options[s],t,o,n+1));return i}var __decorate$6=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let b=class IoMenuOptions extends r{static get Style(){return"\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: calc(var(--io_borderRadius) + var(--io_spacing2));\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: calc(var(--io_spacing) + var(--io_borderWidth));\n      transition: opacity 0.3s ease-in-out;\n      @apply --unselectable;\n    }\n    :host[horizontal] {\n      padding: var(--io_spacing) 0;\n      flex-direction: row;\n      align-self: stretch;\n    }\n    :host[inoverlay] {\n      overflow-y: auto;\n      box-shadow: 1px 1px 16px var(--io_shadowColor),\n                  1px 1px 8px var(--io_shadowColor), \n                  1px 1px 4px var(--io_shadowColor);\n    }\n    :host[inoverlay]:not([expanded]) {\n      visibility: hidden;\n      opacity: 0;\n    }\n    :host > io-menu-item[hidden] ~ span.divider {\n      display: none;\n    }\n    :host > span.divider {\n      flex: 0 0 0;\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n      margin: var(--io_spacing) 0;\n      opacity: 0.1;\n    }\n    :host[horizontal] > span.divider {\n      margin: 0 var(--io_spacing);\n    }\n    :host[horizontal] > io-menu-item > .hint {\n      display: none;\n    }\n    :host:not([horizontal]) > #search {\n      margin: var(--io_spacing);\n      margin-top: 0;\n    }\n    :host[horizontal] > #search {\n      margin: 0 var(--io_spacing);\n      flex: 0 0 10em;\n    }\n    "}static get Listeners(){return{touchstart:["stopPropagation"],"io-focus-to":"onIoFocusTo"}}get inoverlay(){return i.contains(this.parentElement)}constructor(e={}){super(e)}stopPropagation(e){this.inoverlay&&e.stopPropagation()}connectedCallback(){super.connectedCallback(),this.inoverlay&&this.setAttribute("inoverlay","true")}onIoFocusTo(e){const t=e.detail.source,o=e.detail.command,n=getMenuSiblings(t),i=n.indexOf(t),s=this.inoverlay;let r=!1,l=!1,a=!1,p=!1;if(this.$parent){const e=this.getBoundingClientRect(),t=this.$parent.getBoundingClientRect();r=e.top>t.top,l=e.bottom<t.bottom,a=e.left>t.left,p=e.right<t.right}let d="";this.horizontal?("ArrowRight"===o&&s&&(d="Next"),"ArrowLeft"===o&&s&&(d="Prev"),"ArrowUp"===o&&r&&(d="Out"),"ArrowDown"===o&&l&&(d="Out")):("ArrowDown"===o&&s&&(d="Next"),"ArrowUp"===o&&s&&(d="Prev"),"ArrowLeft"===o&&a&&(d="Out"),"ArrowRight"===o&&p&&(d="Out")),"Tab"===o&&s&&(d="Next"),d&&("Next"===d?n[(i+1)%n.length].focus():"Prev"===d?n[(i-1+n.length)%n.length].focus():"Out"===d&&this.$parent&&this.$parent.focus(),e.stopPropagation())}collapse(){const e=this.contains(document.activeElement),t=this.searchable&&!!this.search;getMenuDescendants(this).forEach(e=>{e.expanded=!1}),this.expanded=!1,t&&e&&!this.inoverlay&&(this.search="",this.$.search.focus())}expandedChanged(){this.expanded?this.inoverlay&&this.debounce(this.onExpandInOverlay):(this.style.top="",this.style.height="",this.scrollTop=0,this.search="")}searchChanged(){this.inoverlay&&this.$parent&&this.debounce(this.onExpandInOverlay)}onExpandInOverlay(){this.$parent&&l(this,this.$parent,this.direction,!0)}changed(){const e=this.widget?[this.widget]:[];if(this.searchable&&e.push(h({id:"search",role:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=searchMenuOption(this.option,this.search,this.depth);if(0===t.length)e.push(c({label:"No matches"}));else for(let o=0;o<t.length;o++)e.push(ioMenuItem({option:t[o],depth:0})),o<t.length-1&&e.push({tag:"span",props:{class:"divider"}})}else{let t=this.horizontal?"down":"right";this.horizontal&&"up"===this.direction&&(t="up");for(let o=0;o<this.option.options.length;o++)e.push(ioMenuItem({option:this.option.options[o],direction:t,$parent:this,depth:this.depth})),o<this.option.options.length-1&&e.push(a({class:"divider"}))}this.render(e)}};__decorate$6([e({type:g})],b.prototype,"option",void 0),__decorate$6([e({value:!1,reflect:!0})],b.prototype,"expanded",void 0),__decorate$6([e({value:!1,reflect:!0})],b.prototype,"horizontal",void 0),__decorate$6([e(!1)],b.prototype,"searchable",void 0),__decorate$6([e("")],b.prototype,"search",void 0),__decorate$6([e({value:"none",reflect:!0})],b.prototype,"direction",void 0),__decorate$6([e(100)],b.prototype,"depth",void 0),__decorate$6([e({value:"",reflect:!0})],b.prototype,"overflow",void 0),__decorate$6([e(null)],b.prototype,"widget",void 0),__decorate$6([s()],b.prototype,"$parent",void 0),__decorate$6([s("listbox")],b.prototype,"role",void 0),b=__decorate$6([o],b);const ioMenuOptions=function(e){return b.vConstructor(e)};var __decorate$5=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let x,O,P=-1;function onOverlayPointerdown(e){x=void 0,O=void 0}function onOverlayPointermove(e){if(clearTimeout(P),x=function getHoveredMenuItem(e){const t=Array.from(i.querySelectorAll("io-menu-item, io-menu-options")),o=[];if(i.expanded)for(let n=t.length;n--;)isPointerAboveIoMenuItem(e,t[n])&&o.push(t[n]);if(o.length){o.sort((e,t)=>e.depth>t.depth?1:e.depth<t.depth?-1:"io-menu-item"===e.localName?1:"io-menu-item"===t.localName?-1:0);const e=o[0],t=o[1];if("io-menu-item"===e.localName)return e;if("io-menu-options"===e.localName&&t&&"io-menu-item"===t.localName&&t.depth===e.depth)return t}}(e),x&&x!==O){const t=Math.abs(e.movementY)-Math.abs(e.movementX),o=x.parentElement?.horizontal;O?.parentElement!==x.parentElement||(o?t<-.25:t>.25)?(O=x,x.focus()):P=setTimeout(()=>{O=x,x&&x.focus()},250)}}function onOverlayPointeup(e){x&&x.onClick()}i.addEventListener("pointermove",onOverlayPointermove);let w=class IoMenuItem extends u{static get Style(){return"\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n      :host > .label {\n        flex: 1 1 auto;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hint {\n        flex: 0 1 auto;\n        opacity: 0.25;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hasmore {\n        opacity: 0.5;\n      }\n    "}static get Listeners(){return{click:"preventDefault",focus:"onFocus",blur:"onBlur"}}constructor(e={}){super(e)}preventDefault(e){e.stopPropagation(),e.preventDefault()}get hasmore(){return this.option.options.length&&this.depth>0}get inoverlay(){return i.contains(this.parentElement?.parentElement)}connectedCallback(){super.connectedCallback(),this.$options&&i.appendChild(this.$options)}disconnectedCallback(){super.disconnectedCallback(),this.$options&&i.removeChild(this.$options)}onClick(){const e=this.option;this.hasmore?this.expanded||(this.expanded=!0):"toggle"===e.mode?e.selected=!e.selected:(e.action&&(e.action.apply(null,[e.value]),this.collapseRoot()),"select"===e.mode&&(e.options.length&&this.depth<=0?e.selectDefault():e.selected=!0,this.collapseRoot())),getMenuRoot(this).dispatch("io-menu-option-clicked",{option:e},!0)}onPointerdown(e){super.onPointerdown(e),"touch"!==e.pointerType&&(this.setPointerCapture(e.pointerId),e.stopPropagation(),this.hasmore&&(this.expanded=!0),onOverlayPointerdown.call(this,e))}onPointermove(e){e.stopPropagation(),"touch"!==e.pointerType&&onOverlayPointermove.call(this,e)}onPointerup(e){super.onPointerup(e),e.stopPropagation(),this.onPointerupAction(e)}onPointerupAction(e){this.onClick()}onFocus(e){super.onFocus(e),this.hasmore&&this.inoverlay&&(this.expanded=!0);const t=getMenuDescendants(getMenuRoot(this)),o=getMenuAncestors(this);for(let e=t.length;e--;)t[e]!==this&&t[e]!==this.$options&&-1===o.indexOf(t[e])&&t[e].expanded&&t[e].collapse()}onBlur(e){super.onBlur(e),this.debounce(this.onBlurDebounced)}onBlurDebounced(){if(this._disposed)return;const e=getMenuDescendants(this),t=getMenuSiblings(this),o=getMenuAncestors(this),n=e.some(e=>e===document.activeElement),s=t.some(e=>e===document.activeElement),r=o.some(e=>e===document.activeElement),l=document.activeElement===document.body,a=!i.contains(document.activeElement);n||l||(r||s?this.collapse():a&&this.collapseRoot())}onKeydown(e){const t=this.inoverlay;let o=this.direction,n=!1,i=!1,s=!1,r=!1;if(this.expanded&&this.$options){const e=this.getBoundingClientRect(),t=this.$options.getBoundingClientRect();n=e.top>t.top,i=e.bottom<t.bottom,s=e.left>t.left,r=e.right<t.right}"up"===o&&i&&(o="down"),"down"===o&&n&&(o="up"),"left"===o&&r&&(o="right"),"right"===o&&s&&(o="left");let l=null;if("Enter"===e.key||" "===e.key){if(!this.hasmore)return e.preventDefault(),void this.onClick();l="In"}else"Backspace"===e.key?l="Out":"Escape"===e.key?l="Collapse":"ArrowLeft"===e.key&&(t||this.expanded)?this.hasmore&&"left"===o?l="In":"right"===o&&(l="Out"):"ArrowRight"===e.key&&(t||this.expanded)?this.hasmore&&"right"===o?l="In":"left"===o&&(l="Out"):"ArrowUp"===e.key&&(t||this.expanded)?this.hasmore&&"up"===o?l="In":"down"===o&&(l="Out"):"ArrowDown"===e.key&&(t||this.expanded)&&(this.hasmore&&"down"===o?l="In":"up"===o&&(l="Out"));if(l)switch(e.preventDefault(),l){case"Collapse":this.collapseRoot();break;case"In":if(this.hasmore&&(this.expanded=!0),this.$options&&this.$options.children.length){const e=this.$options.querySelector("[selected]");e?e.focus():this.$options.children[0].focus()}break;case"Out":this.$parent&&this.$parent.$parent&&(this.$parent.$parent.focus(),this.$parent.$parent.collapse())}else super.onKeydown(e)}collapse(){getMenuDescendants(this).forEach(e=>{e.expanded=!1}),this.expanded=!1}collapseRoot(){getMenuRoot(this).collapse()}optionChanged(){this.setProperties({selected:this.option.selected,disabled:this.option.disabled}),this.initOptions()}optionMutated(){this.setProperties({selected:this.option.selected,disabled:this.option.disabled}),this.changed()}initOptions(){this.option.options&&this.depth>0&&(void 0===this.$options?this.$options=new b({expanded:this.bind("expanded"),depth:this.depth-1,option:this.option,direction:this.direction,$parent:this}):this.$options.option=this.option)}changed(){const e=this.icon||this.option.icon,t=this.label||this.option.label;this.render([this.hasmore&&"left"===this.direction?d({value:"io:triangle_left",class:"hasmore"}):null,this.hasmore&&"up"===this.direction?d({value:"io:triangle_up",class:"hasmore"}):null,e?d({value:e}):null,t?a({class:"label"},t):null,this.option.hint?a({class:"hint"},this.option.hint):null,this.hasmore&&"right"===this.direction?d({value:"io:triangle_right",class:"hasmore"}):null,this.hasmore&&"down"===this.direction?d({value:"io:triangle_down",class:"hasmore"}):null])}dispose(){super.dispose(),delete this.$options}};__decorate$5([e({type:g})],w.prototype,"option",void 0),__decorate$5([s("")],w.prototype,"label",void 0),__decorate$5([e({value:!1,reflect:!0})],w.prototype,"expanded",void 0),__decorate$5([e({value:"right",reflect:!0})],w.prototype,"direction",void 0),__decorate$5([e({value:1e3,reflect:!0})],w.prototype,"depth",void 0),__decorate$5([s("false")],w.prototype,"contentEditable",void 0),__decorate$5([s()],w.prototype,"$parent",void 0),w=__decorate$5([o],w);const ioMenuItem=function(e){return w.vConstructor(e)};var __decorate$4=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let C=class IoMenuHamburger extends w{static get Style(){return"\n      :host {\n        display: flex;\n        flex-shrink: 0;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n    "}changed(){this.render([d({value:"io:hamburger"})])}};__decorate$4([e({value:"down",reflect:!0})],C.prototype,"direction",void 0),C=__decorate$4([o],C);const I=C.vConstructor;var __decorate$3=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let E=class IoMenuTreeBranch extends r{static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n    }\n    :host > io-boolean {\n      overflow: visible;\n      padding-left: var(--io_spacing3);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-boolean:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: "▸"\n    }\n    :host > io-boolean[value]:before {\n      content: "▾"\n    }\n    :host > io-menu-tree {\n      background: transparent;\n      border: none;\n      border-left: var(--io_border);\n      border-color: var(--io_colorLight);\n      margin-left: var(--io_spacing5);\n    }\n    '}optionMutated(){this.option.selected&&(this.expanded=this.option.selected)}changed(){this.render([v({icon:this.option.icon,true:this.option.label,false:this.option.label,value:this.bind("expanded")}),this.expanded?ioMenuTree({option:this.option,depth:this.depth+1}):null])}};__decorate$3([e(Number)],E.prototype,"depth",void 0),__decorate$3([e({type:g})],E.prototype,"option",void 0),__decorate$3([e({value:!1,type:Boolean,reflect:!0})],E.prototype,"expanded",void 0),__decorate$3([s("region")],E.prototype,"role",void 0),E=__decorate$3([o],E);const ioMenuTreeBranch=function(e){return E.vConstructor(e)};var __decorate$2=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};function genObjectStorageID(e){const t=JSON.stringify(e);let o=0;for(let e=0;e<t.length;e++)o=Math.imul(31,o)+t.charCodeAt(e)|0;return"io-local-state-"+String(o)}let $=class IoMenuTree extends r{static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: var(--io_borderRadius);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: var(--io_spacing);\n      @apply --unselectable;\n    }\n    :host io-menu-tree {\n      padding: 0 !important;\n    }\n    :host > io-menu-item {\n      padding-left: var(--io_spacing);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-menu-item[selected] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: ""\n    }\n    '}constructor(e={}){super(e)}changed(){const e=this.widget?[this.widget]:[];if(this.searchable&&e.push(h({id:"search",role:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=searchMenuOption(this.option,this.search,this.depth);if(0===t.length)e.push(c({label:"No matches"}));else for(let o=0;o<t.length;o++)e.push(ioMenuItem({option:t[o],depth:0}))}else e.push(...function addMenuOptionsOrTreeBranches(e,t,o=0){const n=[];if(o<=t)for(let t=0;t<e.options.length;t++){const i=e.options[t];if(i.options.length){const e=p({value:!1,storage:"local",key:genObjectStorageID(i)});!0===i.selected&&(e.value=!0),n.push(ioMenuTreeBranch({option:i,depth:o,expanded:e}))}else n.push(ioMenuItem({option:i,depth:o}))}return n}(this.option,this.depth));this.render(e)}};__decorate$2([e({type:g})],$.prototype,"option",void 0),__decorate$2([e({value:!1,type:Boolean})],$.prototype,"searchable",void 0),__decorate$2([e({value:"",type:String})],$.prototype,"search",void 0),__decorate$2([e({value:Infinity,type:Number})],$.prototype,"depth",void 0),__decorate$2([e(null)],$.prototype,"widget",void 0),__decorate$2([s()],$.prototype,"$parent",void 0),__decorate$2([s("listbox")],$.prototype,"role",void 0),$=__decorate$2([o],$);const ioMenuTree=function(e){return $.vConstructor(e)};var __decorate$1=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let S=class IoOptionSelect extends r{static get Style(){return"\n    :host {\n      display: inline-block;\n      text-align: center;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      background-image: var(--io_gradientOutset);\n      text-align: left;\n    }\n    :host > io-menu-item {\n      margin: calc(-1 * var(--io_borderWidth));\n      background-color: transparent !important;\n      border-color: transparent !important;\n    }\n    "}constructor(e){super(e)}onOptionSelected(e){this._disposed||("value"===this.selectBy?this.inputValue(e.detail.option.value):"id"===this.selectBy&&this.inputValue(e.detail.option.id))}inputValue(e){if(this.value!==e||"object"==typeof this.value){const t=this.value;this.setProperty("value",e),this.dispatch("value-input",{value:e,oldValue:t},!1)}}optionChanged(e){e.oldValue&&e.oldValue.removeEventListener("option-selected",this.onOptionSelected),e.value&&e.value.addEventListener("option-selected",this.onOptionSelected)}changed(){let e;"value"===this.selectBy?e=this.option.findItemByValue(this.value):"id"===this.selectBy&&(e=this.option.findItemById(this.value));const t=e?e.label:this.label||String(this.value);this.render([ioMenuItem({option:this.option,label:t,icon:this.icon,direction:"down"})])}};__decorate$1([e({value:void 0})],S.prototype,"value",void 0),__decorate$1([e("")],S.prototype,"label",void 0),__decorate$1([e("")],S.prototype,"icon",void 0),__decorate$1([e("value")],S.prototype,"selectBy",void 0),__decorate$1([e({type:g})],S.prototype,"option",void 0),__decorate$1([s("button")],S.prototype,"role",void 0),S=__decorate$1([o],S);const ioOptionSelect=function(e){return S.vConstructor(e)};var __decorate=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let _=class IoContextMenu extends r{static get ReactiveProperties(){return{$options:null}}constructor(e){super(e),this.$options=new b({expanded:this.bind("expanded"),option:this.option,$parent:this})}init(){this.collapse=this.collapse.bind(this)}optionChanged(){this.$options&&(this.$options.option=this.option)}connectedCallback(){super.connectedCallback(),i.appendChild(this.$options),this.parentElement.addEventListener("pointerdown",this.onPointerdown),this.parentElement.addEventListener("click",this.onClick),this.parentElement.addEventListener("contextmenu",this.onContextmenu)}disconnectedCallback(){super.disconnectedCallback(),i.removeChild(this.$options),this.parentElement.removeEventListener("pointerdown",this.onPointerdown),this.parentElement.removeEventListener("click",this.onClick),this.parentElement.removeEventListener("contextmenu",this.onContextmenu)}getBoundingClientRect(){return this.parentElement.getBoundingClientRect()}onContextmenu(e){2===this.button&&e.preventDefault()}onPointerdown(e){e.stopPropagation(),this.$options.style.left=`${e.clientX}px`,this.$options.style.top=`${e.clientY}px`,this.parentElement.addEventListener("pointermove",this.onPointermove),this.parentElement.addEventListener("pointerleave",this.onPointerleave),this.parentElement.addEventListener("pointerup",this.onPointerup),clearTimeout(this._contextTimeout),"touch"!==e.pointerType?e.button===this.button&&(this.setPointerCapture(e.pointerId),this.expanded=!0):(e.preventDefault(),this._contextTimeout=setTimeout(()=>{this.setPointerCapture(e.pointerId),this.expanded=!0},150)),onOverlayPointerdown.call(this,e)}onPointermove(e){e.stopPropagation(),clearTimeout(this._contextTimeout),("touch"!==e.pointerType||this.expanded)&&onOverlayPointermove.call(this,e)}onPointerup(e){clearTimeout(this._contextTimeout),this.releasePointerCapture(e.pointerId),this.parentElement.removeEventListener("pointermove",this.onPointermove),this.parentElement.removeEventListener("pointerleave",this.onPointerleave),this.parentElement.removeEventListener("pointerup",this.onPointerup),onOverlayPointeup.call(this,e)}onPointerleave(e){this.releasePointerCapture(e.pointerId),this.parentElement.removeEventListener("pointermove",this.onPointermove),this.parentElement.removeEventListener("pointerleave",this.onPointerleave),this.parentElement.removeEventListener("pointerup",this.onPointerup)}collapse(){i.collapse()}};__decorate([e({type:g})],_.prototype,"option",void 0),__decorate([e({value:!1,reflect:!0})],_.prototype,"expanded",void 0),__decorate([e(0)],_.prototype,"button",void 0),_=__decorate([o],_);const ioContextMenu=function(e){return _.vConstructor(e)};export{_ as IoContextMenu,C as IoMenuHamburger,w as IoMenuItem,b as IoMenuOptions,$ as IoMenuTree,E as IoMenuTreeBranch,S as IoOptionSelect,g as MenuOption,ioContextMenu,I as ioMenuHamburger,ioMenuItem,ioMenuOptions,ioMenuTree,ioMenuTreeBranch,ioOptionSelect,onOverlayPointerdown,onOverlayPointermove,onOverlayPointeup};
