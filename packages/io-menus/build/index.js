import{ReactiveProperty as e,Register as t,Node as n,IoOverlaySingleton as o,Property as i,IoElement as s,nudge as r,span as l,Storage as a}from"io-gui";import{ioIcon as h}from"io-icons";import{ioString as d,IoField as p,ioBoolean as c}from"io-inputs";var __decorate$8=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let u=class MenuOptions extends n{constructor(e={}){const t={...e};t.items&&(t.items=function hardenMenuItems(e){const t=[];for(let n=0;n<e.length;n++)e[n]instanceof m?t.push(e[n]):t.push((new m).fromJSON(e[n]));return t}(t.items)),super(t),""!==this.path&&this.pathChanged(),this.initItems()}init(){this.updatePathsDebounced=this.updatePathsDebounced.bind(this)}getAllItems(){const e=[];for(let t=0;t<this.items.length;t++)e.push(this.items[t]),this.items[t].options&&e.push(...this.items[t].options.getAllItems());return e}findItemByValue(e){const t=this.getAllItems();for(let n=0;n<t.length;n++)if(t[n].value===e)return t[n];return null}findItemById(e){const t=this.getAllItems();for(let n=0;n<t.length;n++)if(t[n].id===e)return t[n];return null}fromJSON(e){this.items.length=0;const t=[];for(let n=0;n<e.length;n++)t.push((new m).fromJSON(e[n]));return this.items=t,""!==this.path&&this.pathChanged(),this.initItems(),this}moveItem(e,t){e>=0&&e<this.items.length&&t>=0&&t<this.items.length&&this.items.splice(t,0,this.items.splice(e,1)[0]),this.dispatchMutation()}addItem(e,t){let n=e;e instanceof m||(n=(new m).fromJSON(e));const o=this.items.findIndex((e=>e===n));this.items.splice(t??this.items.length,0,n),-1!==o?this.items.splice(o,1):(n.addEventListener("selected-changed",this.onItemSelectedChanged),n.addEventListener("path-changed",this.onSubOptionsPathChanged));const i=this.items.find((e=>e!==n&&e.id===n.id));i&&this.removeItem(i),n.selected&&"select"===n.mode&&this.updatePaths(n),this.dispatchMutation()}removeItemById(e){const t=this.findItemById(e);t&&this.removeItem(t)}removeItemByIndex(e){e>=0&&e<this.items.length&&this.removeItem(this.items[e])}removeItem(e){const t=this.items.indexOf(e);-1!==t&&(e.removeEventListener("selected-changed",this.onItemSelectedChanged),e.removeEventListener("path-changed",this.onSubOptionsPathChanged),this.items.splice(t,1),this.updatePaths()),this.dispatchMutation()}initItems(){const e=this.items;for(let t=0;t<e.length;t++){let n=e[t];n instanceof m||(n=(new m).fromJSON(n)),n.addEventListener("selected-changed",this.onItemSelectedChanged),n.addEventListener("path-changed",this.onSubOptionsPathChanged),n.selected&&"select"===n.mode&&this.updatePaths(n)}}unselectAll(){for(let e=0;e<this.items.length;e++)"select"===this.items[e].mode&&(this.items[e].selected=!1);this.updatePaths()}pathChanged(){const e=this.path?[...this.path.split(this.delimiter)]:[];if(this.items.length&&e.length){const t=e.shift(),n=this.items.find((e=>e.id===t));if(n)"select"===n.mode&&(n.options&&(n.options.path=e.join(this.delimiter)),n.selected=!0);else for(let e=0;e<this.items.length;e++)"select"===this.items[e].mode&&(this.items[e].selected=!1)}else for(let e=0;e<this.items.length;e++)"select"===this.items[e].mode&&(this.items[e].selected=!1)}selectedChanged(){if(!this.selected)return;const e=this.findItemById(this.selected);e?e.selected=!0:console.warn(`MenuOptions.selectedChanged: cannot find item for specified selected id "${this.selected}"!`,this),this.updatePaths()}updatePaths(e){this.debounce(this.updatePathsDebounced,e)}updatePathsDebounced(e){const t=[];let n="select"===e?.mode?e:void 0,o="select"===e?.mode?e:void 0;const i=this.items.find((e=>"select"===e.mode&&e.selected));if(n||!i){for(;n;)t.push(n.id),"select"===n.mode&&(o=n),n=n.options?.items.find((e=>"select"===e.mode&&e.selected));this.setProperties({path:t.join(this.delimiter),selected:void 0!==o?o.id:"",selectedShallow:void 0!==t[0]?t[0]:""})}}onItemSelectedChanged(e){const t=e.target;if("select"===t.mode)if(t.selected){for(let e=0;e<this.items.length;e++)this.items[e]!==t&&"select"===this.items[e].mode&&(this.items[e].selected=!1);this.updatePaths(t),this.dispatch("item-selected",{item:t})}else this.updatePaths()}onSubOptionsPathChanged(e){const t=e.target;t.selected?this.updatePaths(t):this.updatePaths()}selectDefault(){for(let e=0;e<this.items.length;e++)if("select"===this.items[e].mode){if(!this.items[e].hasmore)return this.items[e].selected=!0,!0;if(this.items[e].options.selectDefault())return!0}return!1}dispose(){for(let e=0;e<this.items.length;e++)this.items[e].removeEventListener("selected-changed",this.onItemSelectedChanged),this.items[e].removeEventListener("path-changed",this.onSubOptionsPathChanged);super.dispose()}};__decorate$8([e("")],u.prototype,"selected",void 0),__decorate$8([e("")],u.prototype,"selectedShallow",void 0),__decorate$8([e("")],u.prototype,"path",void 0),__decorate$8([e(",")],u.prototype,"delimiter",void 0),__decorate$8([e([])],u.prototype,"items",void 0),u=__decorate$8([t],u);var __decorate$7=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};function defaultId(e){return"string"==typeof e.value?e.value:"number"==typeof e.value?String(e.value):""}function defaultLabel(e){return e.id?e.id:"object"==typeof e.value?null===e.value?"null":`${e.value.constructor.name}`+(e.value instanceof Array?`(${e.value.length})`:""):void 0!==e.value?String(e.value):""}let m=class MenuItem extends n{get hasmore(){return!!this.options?.items.length}constructor(e){const t={...e};void 0===t.id&&(t.id=defaultId(t)),void 0===t.label&&(t.label=defaultLabel(t)),super(t)}findItemByValue(e){return this.options?.findItemByValue(e)||null}findItemById(e){return this.options?.findItemById(e)||null}fromJSON(e){const t={};return"object"==typeof e&&null!==e?(Object.hasOwn(e,"value")&&(t.value=e.value),Object.hasOwn(e,"id")&&(t.id=e.id),Object.hasOwn(e,"label")&&(t.label=e.label),Object.hasOwn(e,"icon")&&(t.icon=e.icon),Object.hasOwn(e,"hint")&&(t.hint=e.hint),Object.hasOwn(e,"hidden")&&(t.hidden=e.hidden),Object.hasOwn(e,"disabled")&&(t.disabled=e.disabled),Object.hasOwn(e,"action")&&(t.action=e.action),Object.hasOwn(e,"mode")&&(t.mode=e.mode),Object.hasOwn(e,"selected")&&(t.selected=e.selected),Object.hasOwn(e,"options")&&(e.options instanceof u?t.options=e.options:t.options=(new u).fromJSON(e.options))):t.value=e,void 0===t.id&&(t.id=defaultId(t)),void 0===t.label&&(t.label=defaultLabel(t)),this.applyProperties(t),this}toJSON(){const e={value:this.value,label:this.label,icon:this.icon,hint:this.hint,hidden:this.hidden,disabled:this.disabled};return this.options&&(e.options=this.options),e}onOptionsItemSelected(){"select"===this.mode&&(this.selected=!0)}onOptionsPathChanged(e){this.dispatch("path-changed",e.detail),"select"===this.mode&&(this.selected=!!this.options?.path)}optionsChanged(e){e.oldValue&&(e.oldValue.removeEventListener("item-selected",this.onOptionsItemSelected),e.oldValue.removeEventListener("path-changed",this.onOptionsPathChanged)),e.value&&(e.value.addEventListener("item-selected",this.onOptionsItemSelected),e.value.addEventListener("path-changed",this.onOptionsPathChanged)),"select"===this.mode&&(this.selected=!!this.options?.selected)}selectedChanged(){!1===this.selected&&this.options?.unselectAll()}changed(){}dispose(){this.options&&(this.options.removeEventListener("item-selected",this.onOptionsItemSelected),this.options.removeEventListener("path-changed",this.onOptionsPathChanged)),super.dispose()}};__decorate$7([e({value:void 0})],m.prototype,"value",void 0),__decorate$7([e({value:"",type:String})],m.prototype,"id",void 0),__decorate$7([e({value:"",type:String})],m.prototype,"label",void 0),__decorate$7([e({value:"",type:String})],m.prototype,"icon",void 0),__decorate$7([e({value:"",type:String})],m.prototype,"hint",void 0),__decorate$7([e({value:!1,type:Boolean})],m.prototype,"hidden",void 0),__decorate$7([e({value:!1,type:Boolean})],m.prototype,"disabled",void 0),__decorate$7([e({value:void 0,type:Function,init:null})],m.prototype,"action",void 0),__decorate$7([e({value:"select",type:String})],m.prototype,"mode",void 0),__decorate$7([e({value:!1,type:Boolean})],m.prototype,"selected",void 0),__decorate$7([e({value:void 0,type:u,init:null})],m.prototype,"options",void 0),m=__decorate$7([t],m);const v=["io-menu-item","io-menu-options","io-menu-hamburger","io-option-select","io-string","io-menu-tree"],f=v.join(", ");function getMenuDescendants(e){const t=[];if(e.$options){t.push(e.$options);const n=e.$options.querySelectorAll(f);for(let e=n.length;e--;)t.push(n[e]),t.push(...getMenuDescendants(n[e]))}else{const n=Array.from(e.querySelectorAll(f));for(let e=n.length;e--;)t.push(n[e]),t.push(...getMenuDescendants(n[e]))}return t}function getMenuAncestors(e){const t=[];let n=e;for(;n&&n.$parent;)n=n.$parent,n&&t.push(n);return t}function getMenuSiblings(e){const t=[],n=e.parentElement;return n&&t.push(...Array.from(n.querySelectorAll(f))),t}function getMenuRoot(e){let t=e;for(;t&&t.$parent;)t=t.$parent;return t}function isPointerAboveIoMenuItem(e,t){if(-1!==v.indexOf(t.localName)&&!t.disabled&&!t.hidden&&t.parentElement!==o&&t.parentElement.expanded){const n=t.getBoundingClientRect(),o=e.clientX,i=e.clientY;return n.top<=i&&n.bottom>=i&&n.left<=o&&n.right>=o}return!1}function matchMenuItem(e,t){return!e.options&&(void 0!==e.value&&-1!==String(e.value).toLowerCase().indexOf(t)||(!(!e.label||-1===e.label.toLowerCase().indexOf(t))||!(!e.hint||-1===e.hint.toLowerCase().indexOf(t))))}function searchMenuOptions(e,t,n=5,o=0){t=t.toLowerCase();const i=[];if(o<=n)for(let s=0;s<e.items.length;s++)matchMenuItem(e.items[s],t)&&i.push(e.items[s]),e.items[s].options&&i.push(...searchMenuOptions(e.items[s].options,t,n,o+1));return i}var __decorate$6=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let g=class IoMenuOptions extends s{static get Style(){return"\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: calc(var(--io_borderRadius) + var(--io_spacing2));\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: calc(var(--io_spacing) + var(--io_borderWidth));\n      user-select: none;\n      transition: opacity 0.3s ease-in-out;\n    }\n    :host[horizontal] {\n      padding: var(--io_spacing) 0;\n      flex-direction: row;\n      align-self: stretch;\n    }\n    :host[inoverlay] {\n      overflow-y: auto;\n      box-shadow: 1px 1px 16px var(--io_shadowColor),\n                  1px 1px 8px var(--io_shadowColor), \n                  1px 1px 4px var(--io_shadowColor);\n    }\n    :host[inoverlay]:not([expanded]) {\n      visibility: hidden;\n      opacity: 0;\n    }\n    :host > io-menu-item[hidden] ~ span.divider {\n      display: none;\n    }\n    :host > span.divider {\n      flex: 0 0 0;\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n      margin: var(--io_spacing) 0;\n      opacity: 0.1;\n    }\n    :host[horizontal] > span.divider {\n      margin: 0 var(--io_spacing);\n    }\n    :host[horizontal] > io-menu-item > .hint {\n      display: none;\n    }\n    :host:not([horizontal]) > #search {\n      margin: var(--io_spacing);\n      margin-top: 0;\n    }\n    :host[horizontal] > #search {\n      margin: 0 var(--io_spacing);\n      flex: 0 0 10em;\n    }\n    "}static get Listeners(){return{touchstart:["stopPropagation",{passive:!1}],"io-focus-to":"onIoFocusTo"}}get inoverlay(){return o.contains(this.parentElement)}constructor(e={}){super(e)}stopPropagation(e){e.stopPropagation()}connectedCallback(){super.connectedCallback(),this.inoverlay&&this.setAttribute("inoverlay","true")}onIoFocusTo(e){const t=e.detail.source,n=e.detail.command,o=getMenuSiblings(t),i=o.indexOf(t),s=this.inoverlay;let r=!1,l=!1,a=!1,h=!1;if(this.$parent){const e=this.getBoundingClientRect(),t=this.$parent.getBoundingClientRect();r=e.top>t.top,l=e.bottom<t.bottom,a=e.left>t.left,h=e.right<t.right}let d="";this.horizontal?("ArrowRight"===n&&s&&(d="Next"),"ArrowLeft"===n&&s&&(d="Prev"),"ArrowUp"===n&&r&&(d="Out"),"ArrowDown"===n&&l&&(d="Out")):("ArrowDown"===n&&s&&(d="Next"),"ArrowUp"===n&&s&&(d="Prev"),"ArrowLeft"===n&&a&&(d="Out"),"ArrowRight"===n&&h&&(d="Out")),"Tab"===n&&s&&(d="Next"),d&&("Next"===d?o[(i+1)%o.length].focus():"Prev"===d?o[(i-1+o.length)%o.length].focus():"Out"===d&&this.$parent&&this.$parent.focus(),e.stopPropagation())}collapse(){const e=this.contains(document.activeElement),t=this.searchable&&!!this.search;getMenuDescendants(this).forEach((e=>{e.expanded=!1})),this.expanded=!1,t&&e&&!this.inoverlay&&(this.search="",this.$.search.focus())}expandedChanged(){this.expanded?this.inoverlay&&this.debounce(this.onExpandInOverlay):(this.style.top="",this.style.height="",this.style.touchAction="",this.scrollTop=0,this.search="")}searchChanged(){this.inoverlay&&this.$parent&&this.debounce(this.onExpandInOverlay)}onExpandInOverlay(){this.$parent&&r(this,this.$parent,this.direction,!0)}changed(){const e=this.widget?[this.widget]:[];if(this.searchable&&e.push(d({id:"search",role:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=searchMenuOptions(this.options,this.search,this.depth);if(0===t.length)e.push(ioMenuItem({item:new m({label:"No matches",mode:"none"})}));else for(let n=0;n<t.length;n++)e.push(ioMenuItem({item:t[n],depth:0})),n<t.length-1&&e.push({tag:"span",props:{class:"divider"}})}else{let t=this.horizontal?"down":"right";this.horizontal&&"up"===this.direction&&(t="up");for(let n=0;n<this.options.items.length;n++)e.push(ioMenuItem({item:this.options.items[n],direction:t,$parent:this,depth:this.depth})),n<this.options.items.length-1&&e.push({tag:"span",props:{class:"divider"}})}this.render(e)}};__decorate$6([e({type:u})],g.prototype,"options",void 0),__decorate$6([e({value:!1,reflect:!0})],g.prototype,"expanded",void 0),__decorate$6([e({value:!1,reflect:!0})],g.prototype,"horizontal",void 0),__decorate$6([e(!1)],g.prototype,"searchable",void 0),__decorate$6([e("")],g.prototype,"search",void 0),__decorate$6([e({value:"none",reflect:!0})],g.prototype,"direction",void 0),__decorate$6([e(100)],g.prototype,"depth",void 0),__decorate$6([e(!1)],g.prototype,"noPartialCollapse",void 0),__decorate$6([e({value:"",reflect:!0})],g.prototype,"overflow",void 0),__decorate$6([e(null)],g.prototype,"widget",void 0),__decorate$6([i()],g.prototype,"$parent",void 0),__decorate$6([i("listbox")],g.prototype,"role",void 0),__decorate$6([i(Array)],g.prototype,"_overflownItems",void 0),g=__decorate$6([t],g);const ioMenuOptions=function(e){return g.vConstructor(e)};var __decorate$5=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let y,b,O=-1;function onOverlayPointerdown(e){y=void 0,b=void 0}function onOverlayPointermove(e){if(clearTimeout(O),y=function getHoveredMenuItem(e){const t=Array.from(o.querySelectorAll("io-menu-item, io-menu-options")),n=[];if(o.expanded)for(let o=t.length;o--;)isPointerAboveIoMenuItem(e,t[o])&&n.push(t[o]);if(n.length){n.sort(((e,t)=>e.depth>t.depth?1:e.depth<t.depth?-1:"io-menu-item"===e.localName?1:"io-menu-item"===t.localName?-1:0));const e=n[0],t=n[1];if("io-menu-item"===e.localName)return e;if("io-menu-options"===e.localName&&t&&"io-menu-item"===t.localName&&t.depth===e.depth)return t}}(e),y&&y!==b){const t=Math.abs(e.movementY)-Math.abs(e.movementX),n=y.parentElement?.horizontal;b?.parentElement!==y.parentElement||(n?t<-.25:t>.25)?(b=y,y.focus()):O=setTimeout((()=>{b=y,y&&y.focus()}),250)}}function onOverlayPointeup(e){y&&y.onClick()}o.addEventListener("pointermove",onOverlayPointermove);let x=class IoMenuItem extends p{static get Style(){return"\n      :host {\n        user-select: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n      :host > .label {\n        flex: 1 1 auto;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hint {\n        flex: 0 1 auto;\n        opacity: 0.25;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hasmore {\n        opacity: 0.5;\n      }\n    "}static get Listeners(){return{click:"preventDefault",focus:"onFocus",blur:"onBlur"}}constructor(e={}){super(e)}preventDefault(e){e.stopPropagation(),e.preventDefault()}get hasmore(){return this.item.hasmore&&this.depth>0}get inoverlay(){return o.contains(this.parentElement?.parentElement)}connectedCallback(){super.connectedCallback(),this.$options&&o.appendChild(this.$options)}disconnectedCallback(){super.disconnectedCallback(),this.$options&&o.removeChild(this.$options)}onClick(){const e=this.item;this.hasmore?this.expanded||(this.expanded=!0):"toggle"===e.mode?e.selected=!e.selected:(e.action&&(e.action.apply(null,[e.value]),this.collapseRoot()),"select"===e.mode?(e.hasmore&&e.options&&this.depth<=0?e.options.selectDefault():e.selected=!0,this.collapseRoot()):"link"===e.mode&&(window.open(e.value,"_blank"),this.collapseRoot())),getMenuRoot(this).dispatch("io-menu-item-clicked",{item:this.item},!0)}onPointerdown(e){super.onPointerdown(e),e.stopPropagation(),this.setPointerCapture(e.pointerId),this.expanded=!0,onOverlayPointerdown.call(this,e)}onPointermove(e){if(e.stopPropagation(),"touch"===e.pointerType){if(!this.expanded&&!this.inoverlay)return;if(this.$parent&&this.$parent.style.height)return}onOverlayPointermove.call(this,e)}onPointerup(e){super.onPointerup(e),e.stopPropagation(),this.onPointerupAction(e)}onPointerupAction(e){this.onClick()}onFocus(e){super.onFocus(e),this.hasmore&&this.inoverlay&&(this.expanded=!0);const t=getMenuDescendants(getMenuRoot(this)),n=getMenuAncestors(this);for(let e=t.length;e--;)t[e]!==this&&t[e]!==this.$options&&-1===n.indexOf(t[e])&&t[e].expanded&&t[e].collapse()}onBlur(e){super.onBlur(e),this.debounce(this.onBlurDebounced)}onBlurDebounced(){if(this._disposed)return;const e=getMenuDescendants(this),t=getMenuSiblings(this),n=getMenuAncestors(this),i=e.some((e=>e===document.activeElement)),s=t.some((e=>e===document.activeElement)),r=n.some((e=>e===document.activeElement)),l=document.activeElement===document.body,a=!o.contains(document.activeElement);i||l||(r||s?this.collapse():a&&this.collapseRoot())}onKeydown(e){const t=this.inoverlay;let n=this.direction,o=!1,i=!1,s=!1,r=!1;if(this.expanded&&this.$options){const e=this.getBoundingClientRect(),t=this.$options.getBoundingClientRect();o=e.top>t.top,i=e.bottom<t.bottom,s=e.left>t.left,r=e.right<t.right}"up"===n&&i&&(n="down"),"down"===n&&o&&(n="up"),"left"===n&&r&&(n="right"),"right"===n&&s&&(n="left");let l=null;if("Enter"===e.key||" "===e.key){if(!this.hasmore)return e.preventDefault(),void this.onClick();l="In"}else"Backspace"===e.key?l="Out":"Escape"===e.key?l="Collapse":"ArrowLeft"===e.key&&(t||this.expanded)?this.hasmore&&"left"===n?l="In":"right"===n&&(l="Out"):"ArrowRight"===e.key&&(t||this.expanded)?this.hasmore&&"right"===n?l="In":"left"===n&&(l="Out"):"ArrowUp"===e.key&&(t||this.expanded)?this.hasmore&&"up"===n?l="In":"down"===n&&(l="Out"):"ArrowDown"===e.key&&(t||this.expanded)&&(this.hasmore&&"down"===n?l="In":"up"===n&&(l="Out"));if(l)switch(e.preventDefault(),l){case"Collapse":this.collapseRoot();break;case"In":if(this.hasmore&&(this.expanded=!0),this.$options&&this.$options.children.length){const e=this.$options.querySelector("[selected]");e?e.focus():this.$options.children[0].focus()}break;case"Out":this.$parent&&this.$parent.$parent&&(this.$parent.$parent.focus(),this.$parent.$parent.collapse())}else super.onKeydown(e)}collapse(){getMenuDescendants(this).forEach((e=>{e.expanded=!1})),this.expanded=!1}collapseRoot(){getMenuRoot(this).collapse()}itemChanged(){this.setProperties({selected:this.item.bind("selected"),disabled:this.item.bind("disabled")}),this.initOptions()}itemMutated(){this.changed()}initOptions(){this.item.options&&this.depth>0&&(void 0===this.$options?this.$options=new g({expanded:this.bind("expanded"),depth:this.depth-1,options:this.item.options,direction:this.direction,$parent:this}):this.$options.options=this.item.options)}changed(){const e=this.icon||this.item.icon,t=this.label||this.item.label;this.hidden=this.item.hidden,this.render([this.hasmore&&"left"===this.direction?h({value:"io:triangle_left",class:"hasmore"}):null,this.hasmore&&"up"===this.direction?h({value:"io:triangle_up",class:"hasmore"}):null,e?h({value:e}):null,t?l({class:"label"},t):null,this.item.hint?l({class:"hint"},this.item.hint):null,this.hasmore&&"right"===this.direction?h({value:"io:triangle_right",class:"hasmore"}):null,this.hasmore&&"down"===this.direction?h({value:"io:triangle_down",class:"hasmore"}):null])}dispose(){super.dispose(),delete this.$options}};__decorate$5([e({type:m})],x.prototype,"item",void 0),__decorate$5([i("")],x.prototype,"label",void 0),__decorate$5([e({value:!1,reflect:!0})],x.prototype,"expanded",void 0),__decorate$5([e({value:"right",reflect:!0})],x.prototype,"direction",void 0),__decorate$5([e({value:1e3,reflect:!0})],x.prototype,"depth",void 0),__decorate$5([i("false")],x.prototype,"contentEditable",void 0),__decorate$5([i()],x.prototype,"$parent",void 0),x=__decorate$5([t],x);const ioMenuItem=function(e){return x.vConstructor(e)};var __decorate$4=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let P=class IoMenuHamburger extends x{static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n        flex-shrink: 0;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n    "}changed(){this.setAttribute("hidden",this.item.hidden),this.render([h({value:"io:hamburger"})])}};__decorate$4([e({value:"down",reflect:!0})],P.prototype,"direction",void 0),P=__decorate$4([t],P);const w=P.vConstructor;var __decorate$3=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let C=class IoMenuTreeBranch extends s{static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n    }\n    :host > io-boolean {\n      overflow: visible;\n      padding-left: var(--io_spacing3);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-boolean:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: "▸"\n    }\n    :host > io-boolean[value]:before {\n      content: "▾"\n    }\n    :host > io-menu-tree {\n      background: transparent;\n      border: none;\n      border-left: var(--io_border);\n      border-color: var(--io_colorLight);\n      margin-left: var(--io_spacing5);\n    }\n    '}itemMutated(){this.item.selected&&(this.expanded=this.item.selected)}changed(){this.render([c({icon:this.item.icon,true:this.item.label,false:this.item.label,value:this.bind("expanded")}),this.expanded?ioMenuTree({options:this.item.options,depth:this.depth+1}):null])}};__decorate$3([e(Number)],C.prototype,"depth",void 0),__decorate$3([e({type:m,init:null})],C.prototype,"item",void 0),__decorate$3([e({value:!1,type:Boolean,reflect:!0})],C.prototype,"expanded",void 0),__decorate$3([i("region")],C.prototype,"role",void 0),C=__decorate$3([t],C);const ioMenuTreeBranch=function(e){return C.vConstructor(e)};var __decorate$2=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};function genObjectStorageID(e){const t=JSON.stringify(e);let n=0;for(let e=0;e<t.length;e++)n=Math.imul(31,n)+t.charCodeAt(e)|0;return"io-local-state-"+String(n)}let I=class IoMenuTree extends s{static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: var(--io_borderRadius);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      padding: var(--io_spacing);\n      user-select: none;\n    }\n    :host io-menu-tree {\n      padding: 0 !important;\n    }\n    :host > io-menu-item {\n      padding-left: var(--io_spacing);\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-menu-item[selected] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: ""\n    }\n    '}constructor(e={}){super(e)}changed(){const e=this.widget?[this.widget]:[];if(this.searchable&&e.push(d({id:"search",role:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=searchMenuOptions(this.options,this.search,this.depth);if(0===t.length)e.push(ioMenuItem({item:new m({label:"No matches",mode:"none"})}));else for(let n=0;n<t.length;n++)e.push(ioMenuItem({item:t[n],depth:0}))}else e.push(...function addMenuItemsOrTreeBranches(e,t,n=0){const o=[];if(n<=t)for(let t=0;t<e.items.length;t++){const i=e.items[t];if(i.options?.items.length){const e=a({value:!1,storage:"local",key:genObjectStorageID(i)});!0===i.selected&&(e.value=!0),o.push(ioMenuTreeBranch({item:i,depth:n,expanded:e}))}else o.push(ioMenuItem({item:i,depth:n}))}return o}(this.options,this.depth));this.render(e)}};__decorate$2([e({type:u,init:null})],I.prototype,"options",void 0),__decorate$2([e({value:!1,type:Boolean})],I.prototype,"searchable",void 0),__decorate$2([e({value:"",type:String})],I.prototype,"search",void 0),__decorate$2([e({value:Infinity,type:Number})],I.prototype,"depth",void 0),__decorate$2([e(null)],I.prototype,"widget",void 0),__decorate$2([i()],I.prototype,"$parent",void 0),__decorate$2([i("listbox")],I.prototype,"role",void 0),I=__decorate$2([t],I);const ioMenuTree=function(e){return I.vConstructor(e)};var __decorate$1=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let E=class IoOptionSelect extends s{static get Style(){return"\n    :host {\n      display: inline-block;\n      text-align: center;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorLight);\n      background-image: var(--io_gradientOutset);\n      text-align: left;\n    }\n    :host > io-menu-item {\n      margin: calc(-1 * var(--io_borderWidth));\n      background-color: transparent !important;\n      border-color: transparent !important;\n    }\n    "}constructor(e={}){super(e)}ready(){this.$item=new m({value:this.value,mode:"none",options:this.options})}_onItemSelected(e){this._disposed||this.inputValue(e.detail.item.value)}inputValue(e){if(this.value!==e||"object"==typeof this.value){const t=this.value;this.setProperty("value",e),this.dispatch("value-input",{value:e,oldValue:t},!1)}}optionsChanged(e){e.oldValue&&e.oldValue.removeEventListener("item-selected",this._onItemSelected),e.value&&e.value.addEventListener("item-selected",this._onItemSelected),this.$item.options=this.options}optionsMutated(){this.changed()}changed(){this.debounce(this.onChange)}onChange(){let e;"value"===this.selectBy?e=this.options.findItemByValue(this.value):"id"===this.selectBy&&(e=this.options.findItemById(this.value)),e&&(e.selected=!0);const t=e?e.label:this.label||String(this.value);this.render([ioMenuItem({item:this.$item,label:t,icon:this.icon,direction:"down"})])}};__decorate$1([e({value:void 0})],E.prototype,"value",void 0),__decorate$1([e("")],E.prototype,"label",void 0),__decorate$1([e("")],E.prototype,"icon",void 0),__decorate$1([e("value")],E.prototype,"selectBy",void 0),__decorate$1([e({type:u,init:null})],E.prototype,"options",void 0),__decorate$1([i("button")],E.prototype,"role",void 0),E=__decorate$1([t],E);const ioOptionSelect=function(e){return E.vConstructor(e)};var __decorate=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let S=class IoContextMenu extends s{static get ReactiveProperties(){return{$options:null}}constructor(e={}){super(e),this.$options=new g({expanded:this.bind("expanded"),options:this.bind("options"),$parent:this})}init(){this.collapse=this.collapse.bind(this)}connectedCallback(){super.connectedCallback(),o.appendChild(this.$options),this.parentElement.addEventListener("pointerdown",this.onPointerdown),this.parentElement.addEventListener("click",this.onClick),this.parentElement.addEventListener("contextmenu",this.onContextmenu)}disconnectedCallback(){super.disconnectedCallback(),o.removeChild(this.$options),this.parentElement.removeEventListener("pointerdown",this.onPointerdown),this.parentElement.removeEventListener("click",this.onClick),this.parentElement.removeEventListener("contextmenu",this.onContextmenu)}getBoundingClientRect(){return this.parentElement.getBoundingClientRect()}onContextmenu(e){2===this.button&&e.preventDefault()}onPointerdown(e){e.stopPropagation(),this.$options.style.left=`${e.clientX}px`,this.$options.style.top=`${e.clientY}px`,this.parentElement.addEventListener("pointermove",this.onPointermove),this.parentElement.addEventListener("pointerleave",this.onPointerleave),this.parentElement.addEventListener("pointerup",this.onPointerup),clearTimeout(this._contextTimeout),"touch"!==e.pointerType?e.button===this.button&&(this.setPointerCapture(e.pointerId),this.expanded=!0):(e.preventDefault(),this._contextTimeout=setTimeout((()=>{this.setPointerCapture(e.pointerId),this.expanded=!0}),150)),onOverlayPointerdown.call(this,e)}onPointermove(e){e.stopPropagation(),clearTimeout(this._contextTimeout),("touch"!==e.pointerType||this.expanded)&&onOverlayPointermove.call(this,e)}onPointerup(e){clearTimeout(this._contextTimeout),this.releasePointerCapture(e.pointerId),this.parentElement.removeEventListener("pointermove",this.onPointermove),this.parentElement.removeEventListener("pointerleave",this.onPointerleave),this.parentElement.removeEventListener("pointerup",this.onPointerup),onOverlayPointeup.call(this,e)}onPointerleave(e){this.releasePointerCapture(e.pointerId),this.parentElement.removeEventListener("pointermove",this.onPointermove),this.parentElement.removeEventListener("pointerleave",this.onPointerleave),this.parentElement.removeEventListener("pointerup",this.onPointerup)}collapse(){o.collapse()}};__decorate([e({type:u})],S.prototype,"options",void 0),__decorate([e({value:!1,reflect:!0})],S.prototype,"expanded",void 0),__decorate([e(0)],S.prototype,"button",void 0),S=__decorate([t],S);const ioContextMenu=function(e){return S.vConstructor(e)};export{S as IoContextMenu,P as IoMenuHamburger,x as IoMenuItem,g as IoMenuOptions,I as IoMenuTree,C as IoMenuTreeBranch,E as IoOptionSelect,m as MenuItem,u as MenuOptions,ioContextMenu,w as ioMenuHamburger,ioMenuItem,ioMenuOptions,ioMenuTree,ioMenuTreeBranch,ioOptionSelect,onOverlayPointerdown,onOverlayPointermove,onOverlayPointeup};
