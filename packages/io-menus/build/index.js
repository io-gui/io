import{NodeMixin as e,ReactiveProperty as t,Register as n,Node as o,IoOverlaySingleton as i,Property as s,IoElement as r,Storage as l,genObjectStorageID as a,div as h,ThemeSingleton as d,nudge as c,span as p}from"io-gui";import{ioIcon as u}from"io-icons";import{ioString as v,IoField as m}from"io-inputs";var __decorate$7=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let f=class MenuOptions extends(e(Array)){constructor(e={}){super(e),this.push(...this.items),""!==this.path&&this.pathChanged(),this.initItems(this.items)}getAllItems(){const e=[];for(let t=0;t<this.length;t++)e.push(this[t]),this[t].options&&e.push(...this[t].options.getAllItems());return e}findItemByValue(e){const t=this.getAllItems();for(let n=0;n<t.length;n++)if(t[n].value===e)return t[n];return null}findItemById(e){const t=this.getAllItems();for(let n=0;n<t.length;n++)if(t[n].id===e)return t[n];return null}fromJSON(e){this.length=0;const t=[];for(let n=0;n<e.length;n++)t.push((new g).fromJSON(e[n]));return this.items=t,this.push(...t),""!==this.path&&this.pathChanged(),this.initItems(t),this}initItems(e){for(let t=0;t<e.length;t++){let n=e[t];n instanceof g||(n=(new g).fromJSON(n)),n.addEventListener("selected-changed",this._onItemSelectedChanged),n.addEventListener("path-changed",this._onSubOptionsPathChanged),n.selected&&"select"===n.mode&&this.updatePaths(n)}}unselectAll(){for(let e=0;e<this.length;e++)"select"===this[e].mode&&(this[e].selected=!1);this.updatePaths()}pathChanged(){const e=this.path?[...this.path.split(this.delimiter)]:[];if(this.length&&e.length){const t=e.shift(),n=this.find((e=>e.id===t));if(n)"select"===n.mode&&(n.options&&(n.options.path=e.join(this.delimiter)),n.selected=!0);else for(let e=0;e<this.length;e++)"select"===this[e].mode&&(this[e].selected=!1)}else for(let e=0;e<this.length;e++)"select"===this[e].mode&&(this[e].selected=!1)}selectedChanged(){if(!this.selected)return;const e=this.findItemById(this.selected);e?e.selected=!0:console.warn(`MenuOptions.selectedChanged: cannot find item for specified selected id "${this.selected}"!`,this)}updatePaths(e){const t=[];let n="select"===e?.mode?e:void 0,o="select"===e?.mode?e:void 0;const i=this.find((e=>"select"===e.mode&&e.selected));if(n||!i){for(;n;)t.push(n.id),"select"===n.mode&&(o=n),n=n.options?.find((e=>"select"===e.mode&&e.selected));this.setProperties({path:t.join(this.delimiter),selected:void 0!==o?o.id:this.selected})}}_onItemSelectedChanged(e){const t=e.target;if("select"===t.mode)if(t.selected){for(let e=0;e<this.length;e++)this[e]!==t&&"select"===this[e].mode&&(this[e].selected=!1);this.updatePaths(t),this.dispatchEvent("item-selected",{item:t})}else this.updatePaths()}_onSubOptionsPathChanged(e){const t=e.target;t.selected?this.updatePaths(t):this.updatePaths()}selectDefault(){for(let e=0;e<this.length;e++)if("select"===this[e].mode){if(!this[e].hasmore)return this[e].selected=!0,!0;if(this[e].options.selectDefault())return!0}return!1}dispose(){for(let e=0;e<this.length;e++)this[e].removeEventListener("selected-changed",this._onItemSelectedChanged),this[e].removeEventListener("path-changed",this._onSubOptionsPathChanged);super.dispose()}};__decorate$7([t("")],f.prototype,"selected",void 0),__decorate$7([t("")],f.prototype,"path",void 0),__decorate$7([t(",")],f.prototype,"delimiter",void 0),__decorate$7([t([])],f.prototype,"items",void 0),__decorate$7([t("debounced")],f.prototype,"reactivity",void 0),f=__decorate$7([n],f);var __decorate$6=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};function defaultId(e){return"string"==typeof e.value?e.value:"number"==typeof e.value?String(e.value):""}function defaultLabel(e){return e.id?e.id:"object"==typeof e.value?null===e.value?"null":`${e.value.constructor.name}`+(e.value instanceof Array?`(${e.value.length})`:""):void 0!==e.value?String(e.value):""}let g=class MenuItem extends o{get hasmore(){return!!this.options?.length}constructor(e){const t={...e};void 0===t.id&&(t.id=defaultId(t)),void 0===t.label&&(t.label=defaultLabel(t)),super(t)}findItemByValue(e){return this.options?.findItemByValue(e)||null}findItemById(e){return this.options?.findItemById(e)||null}fromJSON(e){const t={};return"object"==typeof e&&null!==e?(Object.hasOwn(e,"value")&&(t.value=e.value),Object.hasOwn(e,"id")&&(t.id=e.id),Object.hasOwn(e,"label")&&(t.label=e.label),Object.hasOwn(e,"icon")&&(t.icon=e.icon),Object.hasOwn(e,"hint")&&(t.hint=e.hint),Object.hasOwn(e,"hidden")&&(t.hidden=e.hidden),Object.hasOwn(e,"disabled")&&(t.disabled=e.disabled),Object.hasOwn(e,"action")&&(t.action=e.action),Object.hasOwn(e,"mode")&&(t.mode=e.mode),Object.hasOwn(e,"selected")&&(t.selected=e.selected),Object.hasOwn(e,"options")&&(e.options instanceof f?t.options=e.options:t.options=(new f).fromJSON(e.options))):t.value=e,void 0===t.id&&(t.id=defaultId(t)),void 0===t.label&&(t.label=defaultLabel(t)),this.applyProperties(t),this}toJSON(){const e={value:this.value,label:this.label,icon:this.icon,hint:this.hint,hidden:this.hidden,disabled:this.disabled};return this.options&&(e.options=this.options),e}onOptionsItemSelected(){"select"===this.mode&&this.options&&(this.selected=!0)}onOptionsPathChanged(e){this.dispatchEvent("path-changed",e.detail)}optionsChanged(e){e.oldValue&&(e.oldValue.removeEventListener("item-selected",this.onOptionsItemSelected),e.oldValue.removeEventListener("path-changed",this.onOptionsPathChanged)),e.value&&(e.value.addEventListener("item-selected",this.onOptionsItemSelected),e.value.addEventListener("path-changed",this.onOptionsPathChanged)),"select"===this.mode&&this.options&&(this.selected=!!this.options.selected)}selectedChanged(){!1===this.selected&&this.options?.unselectAll()}changed(){}dispose(){this.options&&(this.options.removeEventListener("item-selected",this.onOptionsItemSelected),this.options.removeEventListener("path-changed",this.onOptionsPathChanged)),super.dispose()}};__decorate$6([t({value:void 0})],g.prototype,"value",void 0),__decorate$6([t({value:"",type:String})],g.prototype,"id",void 0),__decorate$6([t({value:"",type:String})],g.prototype,"label",void 0),__decorate$6([t({value:"",type:String})],g.prototype,"icon",void 0),__decorate$6([t({value:"",type:String})],g.prototype,"hint",void 0),__decorate$6([t({value:!1,type:Boolean})],g.prototype,"hidden",void 0),__decorate$6([t({value:!1,type:Boolean})],g.prototype,"disabled",void 0),__decorate$6([t({value:void 0,type:Function,init:null})],g.prototype,"action",void 0),__decorate$6([t({value:"select",type:String})],g.prototype,"mode",void 0),__decorate$6([t({value:!1,type:Boolean})],g.prototype,"selected",void 0),__decorate$6([t({value:void 0,type:f,init:null})],g.prototype,"options",void 0),g=__decorate$6([n],g);const b=["io-menu-item","io-menu-options","io-menu-hamburger","io-option-select","io-string","io-menu-tree"],y=b.join(", ");function getMenuDescendants(e){const t=[];if(e.$options){t.push(e.$options);const n=e.$options.querySelectorAll(y);for(let e=n.length;e--;)t.push(n[e]),t.push(...getMenuDescendants(n[e]))}else{const n=e.querySelectorAll(y);for(let e=n.length;e--;)t.push(n[e]),t.push(...getMenuDescendants(n[e]))}return t}function getMenuAncestors(e){const t=[];let n=e;for(;n&&n.$parent;)n=n.$parent,n&&t.push(n);return t}function getMenuSiblings(e){const t=[],n=e.parentElement;return n&&t.push(...n.querySelectorAll(y)),t}function getMenuRoot(e){let t=e;for(;t&&t.$parent;)t=t.$parent;return t}function isPointerAboveIoMenuItem(e,t){if(-1!==b.indexOf(t.localName)&&!t.disabled&&!t.hidden&&t.parentElement.expanded&&i.expanded){const n=1,o=t.getBoundingClientRect(),i=e.clientX,s=e.clientY;return o.top<=s+n&&o.bottom>=s-n&&o.left<=i+n&&o.right>=i-n}return!1}var __decorate$5=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};function addMenuOptions(e,t,n=0){const o=[];if(n<=t)for(let i=0;i<e.length;i++){const s=e[i];if(s.options?.length){const e=l({value:s.selected,storage:"local",key:a(s)});!0===s.selected&&(e.value=!0),o.push(h([...addMenuOptions(s.options,t,n+1)]))}else o.push(R({item:s,depth:n}))}return o}function matchItem(e,t){return void 0!==e.value&&-1!==String(e.value).toLowerCase().indexOf(t)||(!(!e.label||-1===e.label.toLowerCase().indexOf(t))||!(!e.hint||-1===e.hint.toLowerCase().indexOf(t)))}function filterOptions(e,t,n=5,o=[],i=0){if(t=t.toLowerCase(),i<=n)for(let s=0;s<e.length;s++)matchItem(e[s],t)&&o.push(R({item:e[s],depth:0})),e[s].options&&filterOptions(e[s].options,t,n,o,i+1)}let O=class IoMenuTree extends r{static vConstructor;static get Style(){return'\n    :host {\n      display: flex;\n      flex: 0 0 auto;\n      flex-direction: column;\n      flex-wrap: nowrap;\n      align-self: stretch;\n      align-items: stretch;\n      justify-self: stretch;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      color: var(--io_colorInput);\n      background-color: var(--io_bgColorDimmed);\n      padding: var(--io_spacing) 0;\n      align-self: flex-start;\n      user-select: none;\n      transition: opacity 0.25s;\n      overflow: auto;\n    }\n\n    :host io-collapsible {\n      flex: 0 0 auto;\n      border-color: transparent;\n      border: 0;\n      overflow: visible;\n    }\n    :host io-collapsible > div.io-collapsible-content {\n      background-color: transparent;\n      flex: 0 0 auto;\n      border-radius: 0 !important;\n      margin: 0 !important;\n      padding: 0 !important;\n      background: var(--io_bgColorDimmed);\n    }\n    \n    :host io-menu-item:first-of-type {\n      margin-top: var(--io_borderWidth);\n    }\n    :host io-menu-item {\n      background-color: var(--io_bgColorDimmed);\n      flex: 0 0 auto;\n      align-self: stretch;\n      border-radius: 0;\n      margin-left: var(--io_borderWidth);\n      margin-right: var(--io_borderWidth);\n    }\n    :host io-menu-item[depth="1"] {\n      padding-left: calc(var(--io_lineHeight) * 1);\n    }\n    :host io-menu-item[depth="2"] {\n      padding-left: calc(var(--io_lineHeight) * 2);\n    }\n    :host io-menu-item[depth="3"] {\n      padding-left: calc(var(--io_lineHeight) * 3);\n    }\n    :host io-menu-item[depth="4"] {\n      padding-left: calc(var(--io_lineHeight) * 4);\n    }\n    :host io-menu-item[depth="5"] {\n      padding-left: calc(var(--io_lineHeight) * 5);\n    }\n    :host io-menu-item[depth="6"] {\n      padding-left: calc(var(--io_lineHeight) * 6);\n    }\n    /* Item spacing */\n    :host io-menu-item {\n      margin-bottom: var(--io_borderWidth);\n    }\n    :host io-menu-item:first-of-type {\n      /* margin-top: var(--io_spacing); */\n    }\n\n    /* Search field */\n    :host > .search {\n      border-radius: 0;\n      flex: 0 0 auto;\n    }\n    '}constructor(e={}){super(e)}collapse(){const e=this.contains(document.activeElement),t=this.searchable&&!!this.search;getMenuDescendants(this).forEach((e=>{e.expanded=!1})),this.expanded=!1,t&&e&&!this.inoverlay&&(this.search="",this.$.search.focus())}changed(){const e=[...this.slotted];if(this.searchable&&e.push(v({id:"search",role:"search",class:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=e.length;filterOptions(this.options,this.search,this.depth,e),t===e.length&&e.push(R({item:new g({label:"No matches",mode:"none"}),$parent:this}))}else e.push(...addMenuOptions(this.options,this.depth));this.template(e)}};__decorate$5([t({type:f,reflect:!0})],O.prototype,"options",void 0),__decorate$5([t(!1)],O.prototype,"searchable",void 0),__decorate$5([t("")],O.prototype,"search",void 0),__decorate$5([t(Infinity)],O.prototype,"depth",void 0),__decorate$5([t({type:Array})],O.prototype,"slotted",void 0),__decorate$5([t(void 0)],O.prototype,"$parent",void 0),__decorate$5([s("listbox")],O.prototype,"role",void 0),O=__decorate$5([n],O);const w=O.vConstructor;var __decorate$4=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};const C=new WeakMap;let x=class IoMenuOptions extends r{static vConstructor;static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: stretch;\n      border-radius: var(--io_borderRadius);\n      background-color: var(--io_bgColorDimmed);\n      position: relative;\n    }\n    :host[horizontal] {\n      flex-direction: row;\n      align-self: stretch;\n      padding: 0 var(--io_spacing);\n    }\n    :host:not([horizontal]) {\n      flex-direction: column;\n      padding: var(--io_spacing) 0;\n    }\n    :host[inoverlay] {\n      overflow-y: auto;\n    }\n    :host[inoverlay]:not([expanded]) {\n      visibility: hidden;\n      opacity: 0;\n    }\n    /* Menu Items */\n    :host > io-menu-item {\n      background-color: transparent;\n      border-radius: 0;\n    }\n    :host[horizontal] > io-menu-item {\n      height: calc(var(--io_fieldHeight) + var(--io_spacing2));\n      border-left: none;\n      border-right: none;\n      border-width: calc(var(--io_spacing) + var(--io_borderWidth)) var(--io_borderWidth);\n    }\n    :host:not([horizontal]) > io-menu-item {\n      border-top: none;\n      border-bottom: none;\n      border-width: var(--io_borderWidth) var(--io_spacing);\n    }\n    :host > io-menu-item[selected][direction="up"] {\n      border-color: var(--io_colorBlue) transparent transparent transparent;\n    }\n    :host > io-menu-item[selected][direction="down"] {\n      border-color: transparent transparent var(--io_colorBlue) transparent;\n    }\n    :host > io-menu-item[selected][direction="right"] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item[selected][direction="left"] {\n      border-color: transparent transparent transparent var(--io_colorBlue);\n    }\n\n    /* Item divider */\n    :host > io-menu-item[hidden] ~ span.divider {\n      display: none;\n    }\n    :host > span.divider {\n      flex: 0 0 0;\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n      margin: var(--io_spacing);\n      opacity: 0.5;\n    }\n\n    /* Remove hints from horizontal menu */\n    :host[horizontal] > io-menu-item > .hint {\n      display: none;\n    }\n\n    /* Search field */\n    :host:not([horizontal]) > #search {\n      margin: var(--io_spacing);\n      margin-top: 0;\n    }\n    :host[horizontal] > #search {\n      margin: var(--io_spacing);\n      margin-left: 0;\n      flex: 0 0 10em;\n    }\n\n    /* Hamburger menu for overflow items */\n    :host > io-menu-hamburger {\n      border-color: transparent !important;\n      background-color: transparent !important;\n    }\n    :host[horizontal] > io-menu-hamburger {\n      position: absolute;\n      right: var(--io_spacing);\n      padding: var(--io_spacing);\n    }\n    '}static get Listeners(){return{touchstart:["stopPropagation",{passive:!1}],"io-focus-to":"onIoFocusTo"}}get inoverlay(){return i.contains(this.parentElement)}constructor(e={}){super(e),this.setOverflow=this.setOverflow.bind(this),this.debounce(this.setOverflow)}stopPropagation(e){e.stopPropagation()}connectedCallback(){super.connectedCallback(),this.inoverlay&&this.setAttribute("inoverlay","true")}disconnectedCallback(){super.disconnectedCallback()}onIoFocusTo(e){const t=e.detail.source,n=e.detail.direction,o=getMenuSiblings(t),i=o.indexOf(t),s=this.inoverlay;let r=!1,l=!1,a=!1,h=!1;if(this.$parent){const e=this.getBoundingClientRect(),t=this.$parent.getBoundingClientRect();r=e.top>t.top,l=e.bottom<t.bottom,a=e.left>t.left,h=e.right<t.right}let d="";this.horizontal?("right"===n&&s&&(d="next"),"left"===n&&s&&(d="prev"),"left"===n&&0===i&&a&&(d="out"),"right"===n&&i===o.length-1&&h&&(d="out"),"up"===n&&r&&(d="out"),"down"===n&&l&&(d="out")):("down"===n&&s&&(d="next"),"up"===n&&s&&(d="prev"),"up"===n&&0===i&&r&&(d="out"),"down"===n&&i===o.length-1&&l&&(d="out"),"left"===n&&a&&(d="out"),"right"===n&&h&&(d="out")),d&&("next"===d?o[(i+1)%o.length].focus():"prev"===d?o[(i-1+o.length)%o.length].focus():"out"===d&&this.$parent&&this.$parent.focus(),e.stopPropagation())}onResized(){this.debounce(this.setOverflow)}setOverflow(){if(this._disposed)return;const e=this.querySelectorAll(".item");if(this._overflownItems.length=0,this.horizontal){const t=this.querySelector("io-menu-hamburger"),n=t?.getBoundingClientRect().width||0,o=this.getBoundingClientRect().right-(d.borderWidth+d.spacing);let i=Infinity,s=!1;for(let t=e.length;t--;){const r=e[t].getBoundingClientRect(),l=C.get(e[t].item)||{right:0,width:0};0!==r.right&&0!==r.width&&(l.right=r.right,l.width=r.width,C.set(e[t].item,l)),i=Math.min(i,l.right),this.noPartialCollapse&&s?(e[t].hidden=!0,this._overflownItems.unshift(e[t].item)):t===e.length-1&&i<o||i<o-1.5*n?e[t].hidden=!1:(s=!0,e[t].hidden=!0,this._overflownItems.unshift(e[t].item))}this._overflownItems.length?this.overflow=JSON.stringify(this._overflownItems.map((e=>e.label))):this.overflow=""}else this.overflow=""}collapse(){const e=this.contains(document.activeElement),t=this.searchable&&!!this.search;getMenuDescendants(this).forEach((e=>{e.expanded=!1})),this.expanded=!1,t&&e&&!this.inoverlay&&(this.search="",this.$.search.focus())}expandedChanged(){this.expanded?this.inoverlay&&this.debounce(this.onExpandInOverlay):(this.style.top=null,this.style.height=null,this.style.touchAction=null,this.scrollTop=0,this.search="")}searchChanged(){this.inoverlay&&this.$parent&&this.debounce(this.onExpandInOverlay),this.debounce(this.setOverflow)}onExpandInOverlay(){this.$parent&&c(this,this.$parent,this.direction,!0)}changed(){const e=[...this.slotted];if(this.searchable&&e.push(v({id:"search",role:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=e.length;filterOptions(this.options,this.search,this.depth,e),t===e.length&&e.push(R({item:new g({label:"No matches",mode:"none"})}))}else{let t=this.horizontal?"down":"right";this.horizontal&&"up"===this.direction&&(t="up");for(let n=0;n<this.options.length;n++)e.push(R({item:this.options[n],direction:t,$parent:this,depth:this.depth})),n<this.options.length-1&&e.push({tag:"span",props:{class:"divider"}})}this.overflow&&e.push(k({depth:this.depth+1,role:"navigation",direction:"down",item:new g({options:new f({items:this._overflownItems})})})),this.template(e)}};__decorate$4([t({type:f})],x.prototype,"options",void 0),__decorate$4([t({value:!1,reflect:!0})],x.prototype,"expanded",void 0),__decorate$4([t({value:!1,reflect:!0})],x.prototype,"horizontal",void 0),__decorate$4([t(!1)],x.prototype,"searchable",void 0),__decorate$4([t("")],x.prototype,"search",void 0),__decorate$4([t({value:"none",reflect:!0})],x.prototype,"direction",void 0),__decorate$4([t(100)],x.prototype,"depth",void 0),__decorate$4([t(!1)],x.prototype,"noPartialCollapse",void 0),__decorate$4([t({value:"",reflect:!0})],x.prototype,"overflow",void 0),__decorate$4([t({type:Array})],x.prototype,"slotted",void 0),__decorate$4([t(void 0)],x.prototype,"$parent",void 0),__decorate$4([s("listbox")],x.prototype,"role",void 0),__decorate$4([t({type:Array})],x.prototype,"_overflownItems",void 0),x=__decorate$4([n],x);const P=x.vConstructor;var __decorate$3=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let _,E,I=-1;function onOverlayPointerdown(e){_=void 0,E=void 0}function onOverlayPointermove(e){if(clearTimeout(I),_=function getHoveredMenuItem(e){const t=i.querySelectorAll("io-menu-item, io-menu-options"),n=[];for(let o=t.length;o--;)isPointerAboveIoMenuItem(e,t[o])&&n.push(t[o]);if(n.length){n.sort(((e,t)=>e.depth>t.depth?1:e.depth<t.depth?-1:0));const e=n[0],t=n[1];if("io-menu-item"===e.localName)return e;if("io-menu-options"===e.localName&&t&&"io-menu-item"===t.localName&&t.depth===e.depth)return t}}(e),_&&_!==E){const t=Math.abs(e.movementY)-Math.abs(e.movementX),n=_.parentElement.horizontal;E?.parentElement!==_.parentElement||(n?t<-.25:t>.25)?(E=_,_&&_.focus()):I=setTimeout((()=>{E=_,_&&_.focus()}),250)}}function onOverlayPointeup(e){_&&_.onClick()}i.addEventListener("pointermove",onOverlayPointermove);let $=class IoMenuItem extends m{static vConstructor;static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n      }\n      :host[hidden] {\n        display: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n      :host > .label {\n        flex: 1 1 auto;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hint {\n        flex: 0 1 auto;\n        opacity: 0.25;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hasmore {\n        opacity: 0.5;\n      }\n    "}static get Listeners(){return{click:"preventDefault",focus:"onFocus",blur:"onBlur"}}constructor(e={}){super(e)}preventDefault(e){e.stopPropagation(),e.preventDefault()}get hasmore(){return this.item.hasmore&&this.depth>0}get inoverlay(){return i.contains(this.parentElement.parentElement)}connectedCallback(){super.connectedCallback(),this.$options&&i.appendChild(this.$options)}disconnectedCallback(){super.disconnectedCallback(),this.$options&&i.removeChild(this.$options)}onClick(){const e=this.item;this.hasmore?this.expanded||(this.expanded=!0):"toggle"===e.mode?e.selected=!e.selected:(e.action&&(e.action.apply(null,[e.value]),this.collapseRoot()),"select"===e.mode?(e.hasmore&&e.options&&this.depth<=0?e.options.selectDefault():e.selected=!0,this.collapseRoot()):"link"===e.mode&&(window.open(e.value,"_blank"),this.collapseRoot()))}onPointerdown(e){super.onPointerdown(e),e.stopPropagation(),this.setPointerCapture(e.pointerId),this.expanded=!0,onOverlayPointerdown.call(this,e)}onPointermove(e){if(e.stopPropagation(),"touch"===e.pointerType){if(!this.expanded&&!this.inoverlay)return;if(this.$parent&&this.$parent.style.height)return}onOverlayPointermove.call(this,e)}onPointerup(e){super.onPointerup(e),e.stopPropagation(),this.onPointerupAction(e)}onPointerupAction(e){this.onClick()}onFocus(e){super.onFocus(e),this.hasmore&&this.inoverlay&&(this.expanded=!0);const t=getMenuDescendants(getMenuRoot(this)),n=getMenuAncestors(this);for(let e=t.length;e--;)t[e]!==this&&t[e]!==this.$options&&-1===n.indexOf(t[e])&&t[e].expanded&&t[e].collapse()}onBlur(e){super.onBlur(e),this.debounce(this.onBlurDebounced)}onBlurDebounced(){const e=getMenuDescendants(this),t=getMenuSiblings(this),n=getMenuAncestors(this),o=e.some((e=>e===document.activeElement)),s=t.some((e=>e===document.activeElement)),r=n.some((e=>e===document.activeElement)),l=document.activeElement===document.body,a=!i.contains(document.activeElement);o||l||(r||s?this.collapse():a&&this.collapseRoot())}onKeydown(e){const t=this.inoverlay;let n=this.direction,o=!1,i=!1,s=!1,r=!1;if(this.expanded&&this.$options){const e=this.getBoundingClientRect(),t=this.$options.getBoundingClientRect();o=e.top>t.top,i=e.bottom<t.bottom,s=e.left>t.left,r=e.right<t.right}"up"===n&&i&&(n="down"),"down"===n&&o&&(n="up"),"left"===n&&r&&(n="right"),"right"===n&&s&&(n="left");let l="";if("Enter"===e.key||" "===e.key){if(!this.hasmore)return e.preventDefault(),void this.onClick();l="in"}else"Escape"===e.key?l="out":"Tab"===e.key?(e.preventDefault(),"left"===n||"right"===n?this.dispatchEvent("io-focus-to",{source:this,direction:"down"},!0):this.dispatchEvent("io-focus-to",{source:this,direction:"right"},!0)):"ArrowLeft"===e.key&&(t||this.expanded)?this.hasmore&&"left"===n?l="in":"right"===n&&(l="out"):"ArrowRight"===e.key&&(t||this.expanded)?this.hasmore&&"right"===n?l="in":"left"===n&&(l="out"):"ArrowUp"===e.key&&(t||this.expanded)?this.hasmore&&"up"===n?l="in":"down"===n&&(l="out"):"ArrowDown"===e.key&&(t||this.expanded)&&(this.hasmore&&"down"===n?l="in":"up"===n&&(l="out"));if(l)switch(e.preventDefault(),l){case"collapse":this.collapse();break;case"in":this.hasmore&&(this.expanded=!0),this.$options&&this.$options.children.length&&this.$options.children[0].focus();break;case"out":this.collapse(),this.$parent&&this.$parent.$parent&&(this.$parent.$parent.focus(),this.$parent.$parent.collapse())}else super.onKeydown(e)}collapse(){getMenuDescendants(this).forEach((e=>{e.expanded=!1})),this.expanded=!1}collapseRoot(){getMenuRoot(this).collapse()}itemChanged(){this.setProperties({selected:this.item.bind("selected"),disabled:this.item.bind("disabled")})}itemMutated(){this.changed()}changed(){this.item.options&&this.depth>0&&(void 0===this.$options?this.$options=new x({expanded:this.bind("expanded"),depth:this.depth-1,options:this.item.options,direction:this.direction,$parent:this}):this.$options.options=this.item.options);const e=this.icon||this.item.icon,t=this.label||this.item.label;this.setAttribute("hidden",this.item.hidden),this.template([this.hasmore&&"left"===this.direction?u({value:"io:triangle_left",class:"hasmore"}):null,this.hasmore&&"up"===this.direction?u({value:"io:triangle_up",class:"hasmore"}):null,e?u({value:e}):null,t?p({class:"label"},t):null,this.item.hint?p({class:"hint"},this.item.hint):null,this.hasmore&&"right"===this.direction?u({value:"io:triangle_right",class:"hasmore"}):null,this.hasmore&&"down"===this.direction?u({value:"io:triangle_down",class:"hasmore"}):null])}};__decorate$3([t({type:g})],$.prototype,"item",void 0),__decorate$3([s("")],$.prototype,"label",void 0),__decorate$3([t({value:!1,reflect:!0})],$.prototype,"expanded",void 0),__decorate$3([t({value:"right",reflect:!0})],$.prototype,"direction",void 0),__decorate$3([t({value:1e3,reflect:!0})],$.prototype,"depth",void 0),__decorate$3([s("false")],$.prototype,"contentEditable",void 0),__decorate$3([t(void 0)],$.prototype,"$parent",void 0),$=__decorate$3([n],$);const R=$.vConstructor;var __decorate$2=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let S=class IoMenuHamburger extends ${static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n    "}changed(){void 0!==this.$options&&this.item.options&&(this.$options.options=this.item.options),this.setAttribute("selected",this.item.selected),this.setAttribute("hidden",this.item.hidden),this.disabled=this.item.disabled,this.template([u({value:"io:hamburger"})])}};S=__decorate$2([n],S);const k=S.vConstructor;var __decorate$1=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let j=class IoOptionSelect extends r{static vConstructor;static get Style(){return"\n    :host {\n      display: inline-block;\n      text-align: center;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorDimmed);\n      background-image: var(--io_gradientOutset);\n      text-align: left;\n    }\n    :host > io-menu-item {\n      margin: calc(-1 * var(--io_borderWidth));\n      background-color: transparent !important;\n      border-color: transparent !important;\n    }\n    :host > io-menu-item[selected] {\n      color: var(--io_colorStrong);\n    }\n    "}constructor(e={}){super(e)}init(){this.$item=new g({value:this.value,mode:"none",options:this.options})}_onSelectedChanged(e){this._disposed||this.inputValue(e.detail.value)}optionsChanged(e){e.oldValue&&e.oldValue.removeEventListener("selected-changed",this._onSelectedChanged),e.value&&e.value.addEventListener("selected-changed",this._onSelectedChanged),this.$item.options=this.options}optionsMutated(){this.changed()}changed(){this.debounce(this.onChange)}onChange(){let e;"value"===this.selectBy?e=this.options.findItemByValue(this.value):"id"===this.selectBy&&(e=this.options.findItemById(this.value)),e&&(e.selected=!0);const t=e?e.label:this.label||String(this.value);this.template([R({item:this.$item,label:t,direction:"down"})])}};__decorate$1([t({value:void 0})],j.prototype,"value",void 0),__decorate$1([t("")],j.prototype,"label",void 0),__decorate$1([t("value")],j.prototype,"selectBy",void 0),__decorate$1([t({type:f,init:null})],j.prototype,"options",void 0),__decorate$1([s("button")],j.prototype,"role",void 0),j=__decorate$1([n],j);const M=j.vConstructor;var __decorate=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let L=class IoContextMenu extends r{static vConstructor;static get ReactiveProperties(){return{$options:null}}constructor(e={}){super(e),this.collapse=this.collapse.bind(this),this.$options=new x({expanded:this.bind("expanded"),options:this.bind("options"),$parent:this})}connectedCallback(){super.connectedCallback(),i.appendChild(this.$options),this.parentElement.addEventListener("pointerdown",this.onPointerdown),this.parentElement.addEventListener("click",this.onClick),this.parentElement.addEventListener("contextmenu",this.onContextmenu)}disconnectedCallback(){super.disconnectedCallback(),i.removeChild(this.$options),this.parentElement.removeEventListener("pointerdown",this.onPointerdown),this.parentElement.removeEventListener("click",this.onClick),this.parentElement.removeEventListener("contextmenu",this.onContextmenu)}getBoundingClientRect(){return this.parentElement.getBoundingClientRect()}onContextmenu(e){2===this.button&&e.preventDefault()}onPointerdown(e){e.stopPropagation(),this.$options.style.left=`${e.clientX}px`,this.$options.style.top=`${e.clientY}px`,this.parentElement.addEventListener("pointermove",this.onPointermove),this.parentElement.addEventListener("pointerleave",this.onPointerleave),this.parentElement.addEventListener("pointerup",this.onPointerup),clearTimeout(this._contextTimeout),"touch"!==e.pointerType?e.button===this.button&&(this.setPointerCapture(e.pointerId),this.expanded=!0):(e.preventDefault(),this._contextTimeout=setTimeout((()=>{this.setPointerCapture(e.pointerId),this.expanded=!0}),150)),onOverlayPointerdown.call(this,e)}onPointermove(e){e.stopPropagation(),clearTimeout(this._contextTimeout),("touch"!==e.pointerType||this.expanded)&&onOverlayPointermove.call(this,e)}onPointerup(e){clearTimeout(this._contextTimeout),this.releasePointerCapture(e.pointerId),this.parentElement.removeEventListener("pointermove",this.onPointermove),this.parentElement.removeEventListener("pointerleave",this.onPointerleave),this.parentElement.removeEventListener("pointerup",this.onPointerup),onOverlayPointeup.call(this,e)}onPointerleave(e){this.releasePointerCapture(e.pointerId),this.parentElement.removeEventListener("pointermove",this.onPointermove),this.parentElement.removeEventListener("pointerleave",this.onPointerleave),this.parentElement.removeEventListener("pointerup",this.onPointerup)}collapse(){i.collapse()}};__decorate([t({type:f})],L.prototype,"options",void 0),__decorate([t({value:!1,reflect:!0})],L.prototype,"expanded",void 0),__decorate([t(0)],L.prototype,"button",void 0),L=__decorate([n],L);const D=L.vConstructor;export{L as IoContextMenu,S as IoMenuHamburger,$ as IoMenuItem,x as IoMenuOptions,O as IoMenuTree,j as IoOptionSelect,g as MenuItem,f as MenuOptions,addMenuOptions,filterOptions,D as ioContextMenu,k as ioMenuHamburger,R as ioMenuItem,P as ioMenuOptions,w as ioMenuTree,M as ioOptionSelect,onOverlayPointerdown,onOverlayPointermove,onOverlayPointeup};
