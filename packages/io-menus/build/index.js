import{NodeMixin as e,ReactiveProperty as t,Register as o,Node as n,Property as i,IoElement as s,Storage as r,genObjectStorageID as l,div as a,ThemeSingleton as h,IoOverlaySingleton as d,span as p}from"io-gui";import{ioIcon as c}from"io-icons";import{ioString as u,IoField as v}from"io-inputs";var __decorate$7=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};function _isNaN(e){return"number"==typeof e&&isNaN(e)}function _isSelectable(e){return"select"===e||"scroll"===e}let m=class MenuOptions extends(e(Array)){getItem(e,t=!1){for(let o=0;o<this.length;o++){if(this[o].value===e)return this[o];if(t&&this[o].options){const n=this[o].options.getItem(e,t);if(n)return n}}return null}constructor(e={}){super(e),this.push(...this.items),""!==this.path&&this.pathChanged(),void 0!==this.first&&this.firstChanged(),this.initItems(this.items)}fromJSON(e){this.length=0;const t=[];for(let o=0;o<e.length;o++)t.push((new g).fromJSON(e[o]));return this.items=t,this.push(...t),""!==this.path&&this.pathChanged(),void 0!==this.first&&this.firstChanged(),this.initItems(t),this}initItems(e){for(let t=0;t<e.length;t++){let o=e[t];o instanceof g||(o=(new g).fromJSON(o)),o.addEventListener("selected-changed",this._onItemSelectedChanged),o.addEventListener("path-changed",this._onSubOptionsPathChanged),o.selected&&"select"===o.mode&&this.updatePaths(o)}}pathChanged(){const e=this.path?[...this.path.split(this.delimiter)]:[];if(this.length&&e.length){const t=e.shift(),o=this.find((e=>e.label===t));if(o)_isSelectable(o.mode)&&(o.options&&(o.options.path=e.join(this.delimiter)),o.selected=!0);else for(let e=0;e<this.length;e++)_isSelectable(this[e].mode)&&(this[e].selected=!1)}else for(let e=0;e<this.length;e++)_isSelectable(this[e].mode)&&(this[e].selected=!1)}firstChanged(){if(void 0!==this.first){const e=this.find((e=>e.value===this.first&&"select"===e.mode||_isNaN(e.value)&&_isNaN(this.first)));e&&(e.selected=!0)}else for(let e=0;e<this.length;e++)"select"===this[e].mode&&(this[e].selected=!1)}lastChanged(){}updatePaths(e){const t=[];let o="select"===e?.mode||"scroll"===e?.mode?e:void 0,n="select"===e?.mode?e:void 0,i="scroll"===e?.mode?e:void 0;const s=this.find((e=>"select"===e.mode&&e.selected)),r=this.find((e=>"scroll"===e.mode&&e.selected));if(o||!s&&!r){for(;o;)t.push(o.label),"select"===o.mode&&(n=o),"scroll"===o.mode&&(i=o),o=o.options?.find((e=>("select"===e.mode||"scroll"===e.mode)&&e.selected));this.setProperties({path:t.join(this.delimiter),first:"select"===e?.mode?e.value:void 0,last:void 0!==n?n.value:void 0,scroll:void 0!==i?i.value:void 0})}}_onItemSelectedChanged(e){const t=e.target;if(_isSelectable(t.mode))if(t.selected){for(let e=0;e<this.length;e++)this[e]!==t&&_isSelectable(this[e].mode)&&(this[e].selected=!1);this.updatePaths(t),this.dispatchEvent("item-selected",{item:t})}else this.updatePaths()}_onSubOptionsPathChanged(e){const t=e.target;t.selected?this.updatePaths(t):this.updatePaths()}selectDefault(){for(let e=0;e<this.length;e++)if(_isSelectable(this[e].mode)){if(!this[e].hasmore)return this[e].selected=!0,!0;if(this[e].options.selectDefault())return!0}return!1}dispose(){for(let e=0;e<this.length;e++)this[e].removeEventListener("selected-changed",this._onItemSelectedChanged),this[e].removeEventListener("path-changed",this._onSubOptionsPathChanged);super.dispose()}};__decorate$7([t(void 0)],m.prototype,"first",void 0),__decorate$7([t(void 0)],m.prototype,"last",void 0),__decorate$7([t(void 0)],m.prototype,"scroll",void 0),__decorate$7([t("")],m.prototype,"path",void 0),__decorate$7([t(",")],m.prototype,"delimiter",void 0),__decorate$7([t([])],m.prototype,"items",void 0),m=__decorate$7([o],m);var __decorate$6=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let g=class MenuItem extends n{get hasmore(){return!!this.options?.length}getSubitem(e){return this.options?.getItem(e)}constructor(e){const t={...e};void 0===t.label&&("object"==typeof t.value?null===t.value?t.label="null":t.label=`${t.value.constructor.name}`+(t.value instanceof Array?`(${t.value.length})`:""):t.label=String(t.value)),void 0!==t.selected||"select"!==t.mode&&void 0!==t.mode||!t.options||(t.selected=!!t.options.find((e=>e.selected&&"select"===e.mode))),super(t),this.options&&(this.options.addEventListener("item-selected",this._onSubItemSelected),this.options.addEventListener("path-changed",this._onOptionsPathChanged))}fromJSON(e){const t={};return"object"==typeof e&&null!==e?(Object.hasOwn(e,"value")&&(t.value=e.value),Object.hasOwn(e,"label")&&(t.label=e.label),Object.hasOwn(e,"icon")&&(t.icon=e.icon),Object.hasOwn(e,"hint")&&(t.hint=e.hint),Object.hasOwn(e,"hidden")&&(t.hidden=e.hidden),Object.hasOwn(e,"disabled")&&(t.disabled=e.disabled),Object.hasOwn(e,"action")&&(t.action=e.action),Object.hasOwn(e,"mode")&&(t.mode=e.mode),Object.hasOwn(e,"selected")&&(t.selected=e.selected),Object.hasOwn(e,"options")&&(t.options=(new m).fromJSON(e.options))):t.value=e,void 0===t.label&&("object"==typeof t.value?null===t.value?t.label="null":t.label=`${t.value.constructor.name}`+(t.value instanceof Array?`(${t.value.length})`:""):t.label=String(t.value)),void 0!==t.selected||"select"!==t.mode&&void 0!==t.mode||!t.options||(t.selected=!!t.options.find((e=>e.selected&&"select"===e.mode))),this.applyProperties(t),this.options&&(this.options.addEventListener("item-selected",this._onSubItemSelected),this.options.addEventListener("path-changed",this._onOptionsPathChanged)),this}toJSON(){const e={value:this.value,label:this.label,icon:this.icon,hint:this.hint,hidden:this.hidden,disabled:this.disabled};return this.options&&(e.options=this.options),e}_onSubItemSelected(){this.selected=!0}_onOptionsPathChanged(e){this.dispatchEvent("path-changed",e.detail)}optionsChanged(){void 0===this.options?.first&&void 0===this.options?.scroll||"select"!==this.mode||(this.selected=!0)}selectedChanged(){if("select"===this.mode&&!1===this.selected&&this.options){for(let e=0;e<this.options.length;e++)"select"!==this.options[e].mode&&"scroll"!==this.options[e].mode||(this.options[e].selected=!1);this.options.updatePaths()}}dispose(){this.options&&(this.options.removeEventListener("item-selected",this._onSubItemSelected),this.options.removeEventListener("path-changed",this._onOptionsPathChanged)),super.dispose()}};__decorate$6([t(void 0)],g.prototype,"value",void 0),__decorate$6([t({value:"",type:String})],g.prototype,"label",void 0),__decorate$6([t({value:"",type:String})],g.prototype,"icon",void 0),__decorate$6([t({value:"",type:String})],g.prototype,"hint",void 0),__decorate$6([t({value:!1,type:Boolean})],g.prototype,"hidden",void 0),__decorate$6([t({value:!1,type:Boolean})],g.prototype,"disabled",void 0),__decorate$6([t({value:void 0,type:Function,init:null})],g.prototype,"action",void 0),__decorate$6([t({value:"select",type:String})],g.prototype,"mode",void 0),__decorate$6([t({value:!1,type:Boolean})],g.prototype,"selected",void 0),__decorate$6([t({value:void 0,type:m,init:null})],g.prototype,"options",void 0),g=__decorate$6([o],g);var __decorate$5=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};function addMenuOptions(e,t,o=0){const n=[];if(o<=t)for(let i=0;i<e.length;i++){const s=e[i];if(s.options?.length){const e=r({value:s.selected,storage:"local",key:l(s)});!0===s.selected&&(e.value=!0),n.push(a([...addMenuOptions(s.options,t,o+1)]))}else n.push(O({item:s,depth:o}))}return n}function matchItem(e,t){return void 0!==e.value&&-1!==String(e.value).toLowerCase().indexOf(t)||(!(!e.label||-1===e.label.toLowerCase().indexOf(t))||!(!e.hint||-1===e.hint.toLowerCase().indexOf(t)))}function filterOptions(e,t,o=5,n=[],i=0){if(t=t.toLowerCase(),i<=o)for(let s=0;s<e.length;s++)matchItem(e[s],t)&&n.push(O({item:e[s],depth:0})),e[s].options&&filterOptions(e[s].options,t,o,n,i+1)}let f=class IoMenuTree extends s{static vConstructor;static get Style(){return'\n    :host {\n      display: flex;\n      flex: 0 0 auto;\n      flex-direction: column;\n      flex-wrap: nowrap;\n      align-self: stretch;\n      align-items: stretch;\n      justify-self: stretch;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      color: var(--io_colorInput);\n      background-color: var(--io_bgColorDimmed);\n      padding: var(--io_spacing) 0;\n      align-self: flex-start;\n      user-select: none;\n      transition: opacity 0.25s;\n      overflow: auto;\n    }\n\n    :host io-collapsible {\n      flex: 0 0 auto;\n      border-color: transparent;\n      border: 0;\n      overflow: visible;\n    }\n    :host io-collapsible > div.io-collapsible-content {\n      background-color: transparent;\n      flex: 0 0 auto;\n      border-radius: 0 !important;\n      margin: 0 !important;\n      padding: 0 !important;\n      background: var(--io_bgColorDimmed);\n    }\n    \n    :host io-menu-item:first-of-type {\n      margin-top: var(--io_borderWidth);\n    }\n    :host io-menu-item {\n      background-color: var(--io_bgColorDimmed);\n      flex: 0 0 auto;\n      align-self: stretch;\n      border-radius: 0;\n      margin-left: var(--io_borderWidth);\n      margin-right: var(--io_borderWidth);\n    }\n    :host io-menu-item[depth="1"] {\n      padding-left: calc(var(--io_lineHeight) * 1);\n    }\n    :host io-menu-item[depth="2"] {\n      padding-left: calc(var(--io_lineHeight) * 2);\n    }\n    :host io-menu-item[depth="3"] {\n      padding-left: calc(var(--io_lineHeight) * 3);\n    }\n    :host io-menu-item[depth="4"] {\n      padding-left: calc(var(--io_lineHeight) * 4);\n    }\n    :host io-menu-item[depth="5"] {\n      padding-left: calc(var(--io_lineHeight) * 5);\n    }\n    :host io-menu-item[depth="6"] {\n      padding-left: calc(var(--io_lineHeight) * 6);\n    }\n    /* Item spacing */\n    :host io-menu-item {\n      margin-bottom: var(--io_borderWidth);\n    }\n    :host io-menu-item:first-of-type {\n      /* margin-top: var(--io_spacing); */\n    }\n\n    /* Search field */\n    :host > .search {\n      border-radius: 0;\n      flex: 0 0 auto;\n    }\n    '}static get Listeners(){return{"item-clicked":"_onItemClicked"}}constructor(e={}){super(e)}_onItemClicked(e){const t=e.composedPath()[0],o=e.detail;t!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",o,!0),this.throttle(this._onCollapse))}_onCollapse(){const e=this.searchable&&this.search;this.search="",e&&this.$.search.focus()}changed(){const e=[...this.slotted];if(this.searchable&&e.push(u({id:"search",role:"search",class:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=e.length;filterOptions(this.options,this.search,this.depth,e),t===e.length&&e.push(O({item:new g({label:"No matches",mode:"none"})}))}else e.push(...addMenuOptions(this.options,this.depth));this.template(e)}};__decorate$5([t({type:m,reflect:!0})],f.prototype,"options",void 0),__decorate$5([t(!1)],f.prototype,"searchable",void 0),__decorate$5([t("")],f.prototype,"search",void 0),__decorate$5([t(Infinity)],f.prototype,"depth",void 0),__decorate$5([t({type:Array})],f.prototype,"slotted",void 0),__decorate$5([t(void 0)],f.prototype,"$parent",void 0),__decorate$5([i("listbox")],f.prototype,"role",void 0),f=__decorate$5([o],f);const b=f.vConstructor;var __decorate$4=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};const y=new WeakMap;let _=class IoMenuOptions extends s{static vConstructor;static get Style(){return'\n    :host {\n      display: flex;\n      border-radius: var(--io_borderRadius);\n      background-color: var(--io_bgColorDimmed);\n      position: relative;\n    }\n    :host[horizontal] {\n      flex-direction: row;\n      align-self: stretch;\n      padding: 0 var(--io_spacing);\n    }\n    :host:not([horizontal]) {\n      flex-direction: column;\n      padding: var(--io_spacing) 0;\n    }\n    :host[inlayer] {\n      min-width: 8em;\n    }\n    :host[inlayer]:not([expanded]) {\n      visibility: hidden;\n      opacity: 0;\n    }\n\n    /* Menu Items */\n    :host > io-menu-item {\n      background-color: transparent;\n      border-radius: 0;\n    }\n    :host[horizontal] > io-menu-item {\n      height: calc(var(--io_fieldHeight) + var(--io_spacing2));\n      border-left: none;\n      border-right: none;\n      border-width: calc(var(--io_spacing) + var(--io_borderWidth)) var(--io_borderWidth);\n    }\n    :host:not([horizontal]) > io-menu-item {\n      border-top: none;\n      border-bottom: none;\n      border-width: var(--io_borderWidth) var(--io_spacing);\n    }\n    :host > io-menu-item[selected][direction="up"] {\n      border-color: var(--io_colorBlue) transparent transparent transparent;\n    }\n    :host > io-menu-item[selected][direction="down"] {\n      border-color: transparent transparent var(--io_colorBlue) transparent;\n    }\n    :host > io-menu-item[selected][direction="right"] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item[selected][direction="left"] {\n      border-color: transparent transparent transparent var(--io_colorBlue);\n    }\n\n    /* Item divider */\n    :host > io-menu-item[hidden] ~ span.divider {\n      display: none;\n    }\n    :host > span.divider {\n      flex: 0 0 0;\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n      margin: var(--io_spacing);\n      opacity: 0.5;\n    }\n\n    /* Remove hints from horizontal menu */\n    :host[horizontal] > io-menu-item > .hint {\n      display: none;\n    }\n\n    /* Search field */\n    :host:not([horizontal]) > .search {\n      margin: var(--io_spacing);\n      margin-top: 0;\n    }\n    :host[horizontal] > .search {\n      margin-right: var(--io_borderWidth);\n      flex: 0 0 10em;\n    }\n\n    /* Hamburger menu for overflow items */\n    :host > io-menu-hamburger {\n      border-color: transparent !important;\n      background-color: transparent !important;\n    }\n    :host[horizontal] > io-menu-hamburger {\n      position: absolute;\n      right: var(--io_spacing);\n      padding: var(--io_spacing);\n    }\n    '}static get Listeners(){return{"item-clicked":"_onItemClicked",touchstart:["_stopPropagation",{passive:!1}]}}constructor(e={}){super(e)}_onItemClicked(e){const t=e.composedPath()[0],o=e.detail;"io-string"!==t.localName?t!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",o,!0),this.throttle(this._onCollapse)):e.stopImmediatePropagation()}_stopPropagation(e){e.stopPropagation()}init(){this.throttle(this._onSetOverflow)}onResized(){this.throttle(this._onSetOverflow)}_onSetOverflow(){if(this._disposed)return;const e=this.querySelectorAll(".item");if(this._overflownItems.length=0,this.horizontal){const t=this.querySelector("io-menu-hamburger"),o=t?.getBoundingClientRect().width||0,n=this.getBoundingClientRect().right-(h.borderWidth+h.spacing);let i=Infinity,s=!1;for(let t=e.length;t--;){const r=e[t].getBoundingClientRect(),l=y.get(e[t].item)||{right:0,width:0};0!==r.right&&0!==r.width&&(l.right=r.right,l.width=r.width,y.set(e[t].item,l)),i=Math.min(i,l.right),this.noPartialCollapse&&s?(e[t].hidden=!0,this._overflownItems.unshift(e[t].item)):t===e.length-1&&i<n||i<n-1.5*o?e[t].hidden=!1:(s=!0,e[t].hidden=!0,this._overflownItems.unshift(e[t].item))}this._overflownItems.length?this.overflow=JSON.stringify(this._overflownItems.map((e=>e.label))):this.overflow=""}else this.overflow=""}_onCollapse(){const e=this.selectable&&!!this.search&&!this.inlayer;this.setProperties({search:"",expanded:!1}),e&&this.$.search.focus()}expandedChanged(){this.expanded?this.inlayer&&this.throttle(this._onExpandInOverlay):(this.style.top=null,this.style.height=null,this.style.touchAction=null,this.scrollTop=0,this.search="")}searchChanged(){this.inlayer&&this.$parent&&this.throttle(this._onClipHeight),this.throttle(this._onSetOverflow)}_onExpandInOverlay(){if(this.$parent){const e=this.$parent.getBoundingClientRect();d.setElementPosition(this,this.direction,e),this._onClipHeight()}}_onClipHeight(){if(this.scrollTop=0,!this.firstChild)return;const e=this.firstChild.getBoundingClientRect().top,t=this.lastChild.getBoundingClientRect().bottom,o=t-e;e<0?(this.style.top="0px",this.style.height=o+e+"px",this.style.touchAction="pan-y"):t>window.innerHeight?(this.style.height=window.innerHeight-e+"px",this.style.touchAction="pan-y"):(this.style.height=null,this.style.touchAction=null)}changed(){const e=[...this.slotted];if(this.searchable&&e.push(u({id:"search",role:"search",class:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=e.length;filterOptions(this.options,this.search,this.depth,e),t===e.length&&e.push(O({item:new g({label:"No matches",mode:"none"})}))}else{let t=this.horizontal?"down":"right";this.horizontal&&"up"===this.direction&&(t="up");for(let o=0;o<this.options.length;o++)e.push(O({class:"item",item:this.options[o],direction:t,depth:this.depth})),o<this.options.length-1&&e.push({tag:"span",props:{class:"divider"}})}this.overflow&&e.push(S({depth:this.depth+1,role:"navigation",direction:"down",item:new g({options:new m({items:this._overflownItems})})})),this.template(e)}};__decorate$4([t({type:m})],_.prototype,"options",void 0),__decorate$4([t({value:!1,reflect:!0})],_.prototype,"expanded",void 0),__decorate$4([t({value:!1,reflect:!0})],_.prototype,"horizontal",void 0),__decorate$4([t(!1)],_.prototype,"searchable",void 0),__decorate$4([t("")],_.prototype,"search",void 0),__decorate$4([t({value:"none",reflect:!0})],_.prototype,"direction",void 0),__decorate$4([t(100)],_.prototype,"depth",void 0),__decorate$4([t(!1)],_.prototype,"noPartialCollapse",void 0),__decorate$4([t({value:"",reflect:!0})],_.prototype,"overflow",void 0),__decorate$4([t({value:!1,reflect:!0})],_.prototype,"inlayer",void 0),__decorate$4([t({type:Array})],_.prototype,"slotted",void 0),__decorate$4([t(void 0)],_.prototype,"$parent",void 0),__decorate$4([i("listbox")],_.prototype,"role",void 0),__decorate$4([t({type:Array})],_.prototype,"_overflownItems",void 0),_=__decorate$4([o],_);const C=_.vConstructor;var __decorate$3=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};const x=["io-menu-item","io-menu-hamburger","io-option-menu"],w=x.join(", ");let P=class IoMenuItem extends v{static vConstructor;static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n      }\n      :host[hidden] {\n        display: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n      :host > .label {\n        flex: 1 1 auto;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hint {\n        flex: 0 1 auto;\n        opacity: 0.25;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hasmore {\n        opacity: 0.5;\n      }\n    "}static get Listeners(){return{click:"preventDefault"}}constructor(e={}){super(e)}preventDefault(e){e.stopPropagation(),e.preventDefault()}get hasmore(){return this.item.hasmore&&this.depth>0}get inlayer(){return!!this.$parent&&!!this.$parent.inlayer}get $parent(){return this.parentElement}connectedCallback(){super.connectedCallback(),d.addEventListener("pointermove",this._onOverlayPointermove),d.addEventListener("pointerup",this._onOverlayPointerup),this.$options&&d.appendChild(this.$options)}disconnectedCallback(){super.disconnectedCallback(),d.removeEventListener("pointermove",this._onOverlayPointermove),d.removeEventListener("pointerup",this._onOverlayPointerup),this.$options&&this.$options.inlayer&&d.removeChild(this.$options)}_onOverlayPointermove(e){!this.inlayer&&this.expanded&&this.onPointermove(e)}_onOverlayPointerup(e){!this.inlayer&&this.expanded&&this.onPointerupAction(e)}_onClick(){const e=this.item;this.hasmore?this.expanded||(this.expanded=!0):"toggle"===e.mode?e.selected=!e.selected:(e.action&&e.action.apply(null,[e.value]),"select"===e.mode?e.hasmore&&e.options&&this.depth<=0?e.options.selectDefault():e.selected=!0:"scroll"===e.mode?e.selected=!0:"link"===e.mode&&window.open(e.value,"_blank"),this.dispatchEvent("item-clicked",e,!0),this.throttle(this._onCollapse))}_onItemClicked(e){e.composedPath()[0]!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",e.detail,!0)),this.expanded&&this.throttle(this._onCollapse)}onPointerdown(e){e.stopPropagation(),e.preventDefault(),this.setPointerCapture(e.pointerId),this.addEventListener("pointermove",this.onPointermove),this.addEventListener("pointerup",this.onPointerup),this.onPointerdownAction(e)}onPointerdownAction(e){(this.expanded||"mouse"===e.pointerType||this.inlayer)&&(this.focus(),this.item.options&&(this.expanded=!0)),this._x=e.clientX,this._y=e.clientY}onPointermove(e){e.stopPropagation(),this.onPointermoveAction(e)}onPointermoveAction(e){if(!this.expanded&&"touch"===e.pointerType&&!this.inlayer)return;const t=!!this.$parent&&!!this.$parent.style.height;if("touch"===e.pointerType&&t)return;const o=e.clientX-this._x,n=e.clientY-this._y;if(this._x=e.clientX,this._y=e.clientY,d.x=e.clientX,d.y=e.clientY,clearTimeout(this._timeoutOpen),$=this._gethovered(e),$){const e=Math.abs(n)-Math.abs(o),t=$.parentElement.horizontal;k?.parentElement!==$.parentElement||(t?e<-.25:e>.25)?this._expandHovered():this._timeoutOpen=setTimeout((()=>{this._expandHovered()}),100),k=$}}onPointerup(e){e.stopPropagation(),this.removeEventListener("pointermove",this.onPointermove),this.removeEventListener("pointerup",this.onPointerup),this.onPointerupAction(e)}onPointerupAction(e,t=!1){const o=this._gethovered(e);o?(o.focus(),o._onClick(e)):t||this.throttle(this._onCollapseRoot),$=void 0,k=void 0}_gethovered(e){const t=getMenuDescendants(getMenuRoot(this)),o=[];for(let n=t.length;n--;)isPointerAboveIoMenuItem(e,t[n])&&o.push(t[n]);if(o.length)return o.sort(((e,t)=>e.depth<t.depth?1:e.depth>t.depth?-1:0)),o[o.length-1]}_expandHovered(){if($){if($.focus(),$.hasmore){if($.$options){const e=getMenuDescendants($.$options);for(let t=e.length;t--;)e[t].expanded=!1}$.expanded=!0}if($.$parent){const e=$.$parent.querySelectorAll(w);for(let t=e.length;t--;)e[t]!==$&&(e[t].expanded=!1)}}}onKeydown(e){if("Enter"===e.key||" "===e.key)return e.preventDefault(),void this._onClick();if("Escape"===e.key)return e.preventDefault(),void this.throttle(this._onCollapseRoot);let t="";"left"===this.direction||"right"===this.direction?("ArrowUp"===e.key&&(t="prev"),"ArrowRight"===e.key&&(t="in"),"ArrowDown"===e.key&&(t="next"),"ArrowLeft"===e.key&&(t="out")):("ArrowUp"===e.key&&(t="out"),"ArrowRight"===e.key&&(t="next"),"ArrowDown"===e.key&&(t="in"),"ArrowLeft"===e.key&&(t="prev")),this.inlayer&&"Tab"===e.key&&(t="next");const o=this.$parent?[...this.$parent.children]:[],n=o.indexOf(this);if(t)switch(e.preventDefault(),t){case"prev":{const e=o[(n+o.length-1)%o.length];this.expanded=!1,e&&(e.hasmore&&(e.expanded=!0),e.focus());break}case"next":{const e=o[(n+1)%o.length];this.expanded=!1,e&&(e.hasmore&&(e.expanded=!0),e.focus());break}case"in":this.$options&&this.$options.children.length&&this.$options.children[0].focus();break;case"out":this.expanded=!1,this.$parent&&this.$parent.$parent&&this.$parent.$parent.focus()}else super.onKeydown(e)}_onCollapse(){this.expanded=!1}_onCollapseRoot(){getMenuRoot(this).expanded=!1}expandedChanged(){if(this.expanded&&this.depth>0){this.item.options&&void 0===this.$options&&(this.$options=new _({expanded:this.bind("expanded"),inlayer:!0,depth:this.depth-1,options:this.item.options,direction:this.direction,$parent:this}));const e=getMenuDescendants(getMenuRoot(this)),t=getMenuAncestors(this),o=getMenuDescendants(this);for(let n=e.length;n--;)e[n]!==this&&-1===t.indexOf(e[n])&&-1===o.indexOf(e[n])&&(e[n].expanded=!1)}if(this.$options){this.expanded?(this.$options.parentElement!==d&&d.appendChild(this.$options),this.$options.addEventListener("item-clicked",this._onItemClicked)):this.$options.removeEventListener("item-clicked",this._onItemClicked);const e=getMenuDescendants(this.$options);for(let t=e.length;t--;)e[t].expanded=!1}}itemChanged(){this.setProperties({selected:this.item.bind("selected"),disabled:this.item.bind("disabled")})}itemMutated(){this.changed()}changed(){void 0!==this.$options&&this.item.options&&(this.$options.options=this.item.options);const e=this.icon||this.item.icon;this.setAttribute("hidden",this.item.hidden),this.template([this.hasmore&&"left"===this.direction?c({value:"io:triangle_left",class:"hasmore"}):null,this.hasmore&&"up"===this.direction?c({value:"io:triangle_up",class:"hasmore"}):null,e?c({value:e}):null,this.item.label?p({class:"label"},this.item.label):null,this.item.hint?p({class:"hint"},this.item.hint):null,this.hasmore&&"right"===this.direction?c({value:"io:triangle_right",class:"hasmore"}):null,this.hasmore&&"down"===this.direction?c({value:"io:triangle_down",class:"hasmore"}):null])}};__decorate$3([t({type:g})],P.prototype,"item",void 0),__decorate$3([t({value:!1,reflect:!0})],P.prototype,"expanded",void 0),__decorate$3([t({value:"right",reflect:!0})],P.prototype,"direction",void 0),__decorate$3([t({value:1e3,reflect:!0})],P.prototype,"depth",void 0),__decorate$3([i("false")],P.prototype,"contentEditable",void 0),P=__decorate$3([o],P);const O=P.vConstructor;function getMenuDescendants(e){const t=[];if(e.$options){if(e.expanded){t.push(e.$options);const o=e.$options.querySelectorAll(w);for(let e=o.length;e--;)t.push(o[e]),o[e].expanded&&t.push(...getMenuDescendants(o[e]))}}else{const o=e.querySelectorAll(w);for(let e=o.length;e--;)t.push(o[e]),o[e].expanded&&t.push(...getMenuDescendants(o[e]))}return t}function getMenuAncestors(e){const t=[];let o=e;for(;o&&o.$parent;)o=o.$parent,o&&t.push(o);return t}function getMenuRoot(e){let t=e;for(;t&&t.$parent;)t=t.$parent;return t}function isPointerAboveIoMenuItem(e,t){if(-1!==x.indexOf(t.localName)&&!t.disabled&&!t.hidden&&(!t.inlayer||t.parentElement.expanded&&d.expanded)){const o=1,n=t.getBoundingClientRect(),i=e.clientX,s=e.clientY;return n.top<=s+o&&n.bottom>=s-o&&n.left<=i+o&&n.right>=i-o}return null}let $,k;var __decorate$2=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let I=class IoMenuHamburger extends P{static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n    "}changed(){void 0!==this.$options&&this.item.options&&(this.$options.options=this.item.options),this.setAttribute("selected",this.item.selected),this.setAttribute("hidden",this.item.hidden),this.disabled=this.item.disabled,this.template([c({value:"io:hamburger"})])}};I=__decorate$2([o],I);const S=I.vConstructor;var __decorate$1=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};const E=new m;let R=class IoOptionMenu extends s{static vConstructor;static get Style(){return"\n    :host {\n      display: inline-block;\n      text-align: center;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorDimmed);\n      background-image: var(--io_gradientOutset);\n      text-align: left;\n    }\n    :host > io-menu-item {\n      margin: calc(-1 * var(--io_borderWidth));\n      background-color: transparent !important;\n      border-color: transparent !important;\n    }\n    :host > io-menu-item[selected] {\n      color: var(--io_colorStrong);\n    }\n    "}constructor(e={}){super(e)}_onLastChanged(e){this._disposed||this.inputValue(e.detail.value)}optionsChanged(e){e.oldValue&&e.oldValue!==E&&e.oldValue.removeEventListener("last-changed",this._onLastChanged),e.value&&e.value.addEventListener("last-changed",this._onLastChanged);const t=this.options.getItem(this.value);t&&(t.selected=!0)}changed(){const e=this.options.getItem(this.value);this.item=this.item||new g({value:this.value}),this.item.label=e?.label||String(this.value),this.item.options=this.options,this.template([O({item:this.item,direction:"down"})])}};__decorate$1([t({value:void 0,reflect:!0})],R.prototype,"value",void 0),__decorate$1([t({value:E,type:m,reflect:!0})],R.prototype,"options",void 0),__decorate$1([t(g)],R.prototype,"item",void 0),__decorate$1([i("button")],R.prototype,"role",void 0),R=__decorate$1([o],R);const L=R.vConstructor;var __decorate=function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};let j=class IoContextMenu extends s{static vConstructor;static get ReactiveProperties(){return{$options:null}}constructor(e={}){super(e)}connectedCallback(){super.connectedCallback(),d.addEventListener("pointermove",this._onOverlayPointermove),this._parent=this.parentElement,this._parent.addEventListener("pointerdown",this.onPointerdown),this._parent.addEventListener("click",this._onClick),this._parent.addEventListener("contextmenu",this.onContextmenu)}disconnectedCallback(){super.disconnectedCallback(),this.$options&&this.$options.parentElement&&d.removeChild(this.$options),d.removeEventListener("pointermove",this._onOverlayPointermove),this._parent.removeEventListener("pointerdown",this.onPointerdown),this._parent.removeEventListener("contextmenu",this.onContextmenu),this._parent.removeEventListener("pointermove",this.onPointermove),this._parent.removeEventListener("pointerup",this.onPointerup),this._parent.removeEventListener("click",this._onClick),delete this._parent}getBoundingClientRect(){return this._parent.getBoundingClientRect()}_onItemClicked(e){const t=e.composedPath()[0],o=e.detail;t!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",o,!0),this.throttle(this._onCollapse))}onContextmenu(e){2===this.button&&e.preventDefault()}onPointerdown(e){d.x=e.clientX,d.y=e.clientY,this._parent.addEventListener("pointermove",this.onPointermove),this._parent.addEventListener("pointerup",this.onPointerup),clearTimeout(this._contextTimeout),"touch"!==e.pointerType?e.button===this.button&&(this.setPointerCapture(e.pointerId),this.expanded=!0):(e.preventDefault(),this._contextTimeout=setTimeout((()=>{this.setPointerCapture(e.pointerId),this.expanded=!0}),150))}onPointermove(e){clearTimeout(this._contextTimeout),this.expanded&&this.$options?.querySelector("io-menu-item")?.onPointermoveAction(e)}onPointerup(e){clearTimeout(this._contextTimeout),this.releasePointerCapture(e.pointerId),this.expanded&&this.$options?.querySelector("io-menu-item")?.onPointerupAction(e,!0),this._parent.removeEventListener("pointermove",this.onPointermove),this._parent.removeEventListener("pointerup",this.onPointerup)}_onOverlayPointermove(e){this.expanded&&this.onPointermove(e)}_onClick(e){e.button===this.button&&2!==e.button&&(this.expanded=!0)}_onCollapse(){this.expanded=!1}optionsChanged(){this.$options&&(d.removeChild(this.$options),this.$options.template([]),this.$options.dispose()),this.$options=new _({expanded:this.bind("expanded"),inlayer:!0,options:this.options,direction:"pointer",$parent:this,"@item-clicked":this._onItemClicked}),d.appendChild(this.$options)}};__decorate([t({type:m})],j.prototype,"options",void 0),__decorate([t({value:!1,reflect:!0})],j.prototype,"expanded",void 0),__decorate([t(0)],j.prototype,"button",void 0),j=__decorate([o],j);const A=j.vConstructor;export{j as IoContextMenu,I as IoMenuHamburger,P as IoMenuItem,_ as IoMenuOptions,f as IoMenuTree,R as IoOptionMenu,g as MenuItem,m as MenuOptions,addMenuOptions,filterOptions,getMenuAncestors,getMenuDescendants,getMenuRoot,A as ioContextMenu,S as ioMenuHamburger,O as ioMenuItem,C as ioMenuOptions,b as ioMenuTree,L as ioOptionMenu};
