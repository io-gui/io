import{IoNodeMixin as e,Property as t,Register as n,IoNode as o,IoElement as i,IoStorage as s,genObjectStorageID as r,IoThemeSingleton as l,IoOverlaySingleton as a,IoField as h,IoIconsetSingleton as d}from"io-gui";var __decorate$7=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};function _isNaN(e){return"number"==typeof e&&isNaN(e)}function _isSelectable(e){return"select"===e||"scroll"===e}let p=class MenuOptions extends(e(Array)){push(...e){for(let t=0;t<e.length;t++){const n=e[t];n instanceof c&&(n.addEventListener("selected-changed",this._onItemSelectedChanged),n.addEventListener("path-changed",this._onSubOptionsPathChanged),super.push(n))}}getItem(e,t=!1){for(let n=0;n<this.length;n++){if(this[n].value===e)return this[n];if(t&&this[n].options){const o=this[n].options.getItem(e,t);if(o)return o}}return null}constructor(e=[],t={}){const n=[];for(let t=0;t<e.length;t++)e[t]instanceof c?n.push(e[t]):n.push(new c(e[t]));super(t,...n),""!==this.path&&this.pathChanged(),void 0!==this.first&&this.firstChanged();for(let e=0;e<this.length;e++){const t=this[e];t.addEventListener("selected-changed",this._onItemSelectedChanged),t.addEventListener("path-changed",this._onSubOptionsPathChanged),t.selected&&"select"===t.mode&&this.updatePaths(t)}}addItems(e){for(let t=0;t<e.length;t++){let n;n=e[t]instanceof c?e[t]:new c(e[t]),this.push(n),n.addEventListener("selected-changed",this._onItemSelectedChanged),n.addEventListener("path-changed",this._onSubOptionsPathChanged)}}pathChanged(){const e=this.path?[...this.path.split(this.delimiter)]:[];if(this.length&&e.length){const t=e.shift(),n=this.find((e=>e.label===t));if(n)_isSelectable(n.mode)&&(n.options&&(n.options.path=e.join(this.delimiter)),n.selected=!0);else for(let e=0;e<this.length;e++)_isSelectable(this[e].mode)&&(this[e].selected=!1)}else for(let e=0;e<this.length;e++)_isSelectable(this[e].mode)&&(this[e].selected=!1)}firstChanged(){if(void 0!==this.first){const e=this.find((e=>e.value===this.first&&"select"===e.mode||_isNaN(e.value)&&_isNaN(this.first)));e&&(e.selected=!0)}else for(let e=0;e<this.length;e++)"select"===this[e].mode&&(this[e].selected=!1)}lastChanged(){}updatePaths(e){const t=[];let n="select"===e?.mode||"scroll"===e?.mode?e:void 0,o="select"===e?.mode?e:void 0,i="scroll"===e?.mode?e:void 0;const s=this.find((e=>"select"===e.mode&&e.selected)),r=this.find((e=>"scroll"===e.mode&&e.selected));if(n||!s&&!r){for(;n;)t.push(n.label),"select"===n.mode&&(o=n),"scroll"===n.mode&&(i=n),n=n.options?.find((e=>("select"===e.mode||"scroll"===e.mode)&&e.selected));this.setProperties({path:t.join(this.delimiter),first:"select"===e?.mode?e.value:void 0,last:void 0!==o?o.value:void 0,scroll:void 0!==i?i.value:void 0})}}_onItemSelectedChanged(e){const t=e.target;if(_isSelectable(t.mode))if(t.selected){for(let e=0;e<this.length;e++)this[e]!==t&&_isSelectable(this[e].mode)&&(this[e].selected=!1);this.updatePaths(t),this.dispatchEvent("item-selected",{item:t})}else this.updatePaths()}_onSubOptionsPathChanged(e){const t=e.target;t.selected?this.updatePaths(t):this.updatePaths()}selectDefault(){for(let e=0;e<this.length;e++)if(_isSelectable(this[e].mode)){if(!this[e].hasmore)return this[e].selected=!0,!0;if(this[e].options.selectDefault())return!0}return!1}bind(e){return super.bind(e)}dispose(){for(let e=0;e<this.length;e++)this[e].removeEventListener("selected-changed",this._onItemSelectedChanged),this[e].removeEventListener("path-changed",this._onSubOptionsPathChanged);super.dispose()}};__decorate$7([t(void 0)],p.prototype,"first",void 0),__decorate$7([t(void 0)],p.prototype,"last",void 0),__decorate$7([t(void 0)],p.prototype,"scroll",void 0),__decorate$7([t("")],p.prototype,"path",void 0),__decorate$7([t(",")],p.prototype,"delimiter",void 0),p=__decorate$7([n],p);var __decorate$6=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let c=class MenuItem extends o{get hasmore(){return!!this.options?.length}getSubitem(e){return this.options?.getItem(e)}constructor(e){const t={value:"",label:""};"object"!=typeof e||null===e?(t.value=e,t.label=String(e)):(t.value=e.value,void 0===e.label?"object"==typeof t.value?null===t.value?t.label="null":t.label=`${t.value.constructor.name}`+(t.value instanceof Array?`(${t.value.length})`:""):t.label=String(t.value):t.label=e.label,void 0!==e.icon&&(t.icon=e.icon),void 0!==e.hint&&(t.hint=e.hint),void 0!==e.hidden&&(t.hidden=e.hidden),void 0!==e.disabled&&(t.disabled=e.disabled),void 0!==e.action&&(t.action=e.action),void 0!==e.mode&&(t.mode=e.mode),void 0!==e.selected&&(t.selected=e.selected),void 0!==e.options&&(e.options instanceof p?t.options=e.options:t.options=new p(e.options)),void 0!==t.selected||"select"!==e.mode&&void 0!==e.mode||!t.options||(t.selected=!!t.options.find((e=>e.selected&&"select"===e.mode)))),super(t),this.options&&(this.options.addEventListener("item-selected",this._onSubItemSelected),this.options.addEventListener("path-changed",this._onOptionsPathChanged))}toJSON(){const e={value:this.value,label:this.label,icon:this.icon,hint:this.hint,hidden:this.hidden,disabled:this.disabled};return this.options&&(e.options=this.options),e}_onSubItemSelected(){this.selected=!0}_onOptionsPathChanged(e){this.dispatchEvent("path-changed",e.detail)}optionsChanged(){void 0===this.options?.first&&void 0===this.options?.scroll||"select"!==this.mode||(this.selected=!0)}selectedChanged(){if("select"===this.mode&&!1===this.selected&&this.options){for(let e=0;e<this.options.length;e++)"select"!==this.options[e].mode&&"scroll"!==this.options[e].mode||(this.options[e].selected=!1);this.options.updatePaths()}}dispose(){this.options&&(this.options.removeEventListener("item-selected",this._onSubItemSelected),this.options.removeEventListener("path-changed",this._onOptionsPathChanged)),super.dispose()}};__decorate$6([t(void 0)],c.prototype,"value",void 0),__decorate$6([t("")],c.prototype,"label",void 0),__decorate$6([t("")],c.prototype,"icon",void 0),__decorate$6([t("")],c.prototype,"hint",void 0),__decorate$6([t(!1)],c.prototype,"hidden",void 0),__decorate$6([t(!1)],c.prototype,"disabled",void 0),__decorate$6([t(void 0)],c.prototype,"action",void 0),__decorate$6([t("select")],c.prototype,"mode",void 0),__decorate$6([t(!1)],c.prototype,"selected",void 0),__decorate$6([t(void 0)],c.prototype,"options",void 0),c=__decorate$6([n],c);var __decorate$5=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};function addMenuOptions(e,t,n=0){const o=[];if(n<=t)for(let i=0;i<e.length;i++){const l=e[i];if(l.options?.length){const e=s({value:l.selected,storage:"local",key:r(l)});!0===l.selected&&(e.value=!0),o.push(["io-collapsable",{label:l.label,icon:l.icon,expanded:e,elements:[...addMenuOptions(l.options,t,n+1)]}])}else o.push(["io-menu-item",{item:l,depth:n}])}return o}function matchItem(e,t){return void 0!==e.value&&-1!==String(e.value).toLowerCase().indexOf(t)||(!(!e.label||-1===e.label.toLowerCase().indexOf(t))||!(!e.hint||-1===e.hint.toLowerCase().indexOf(t)))}function filterOptions(e,t,n=5,o=[],i=0){if(t=t.toLowerCase(),i<=n)for(let s=0;s<e.length;s++)matchItem(e[s],t)&&o.push(["io-menu-item",{item:e[s],depth:0}]),e[s].options&&filterOptions(e[s].options,t,n,o,i+1)}let u=class IoMenuTree extends i{static get Style(){return'\n    :host {\n      display: flex;\n      flex: 0 0 auto;\n      flex-direction: column;\n      flex-wrap: nowrap;\n      align-self: stretch;\n      align-items: stretch;\n      justify-self: stretch;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      color: var(--io_colorField);\n      background-color: var(--io_bgColorDimmed);\n      padding: var(--io_spacing) 0;\n      align-self: flex-start;\n      user-select: none;\n      transition: opacity 0.25s;\n      overflow: auto;\n    }\n\n    :host io-collapsable {\n      flex: 0 0 auto;\n      border-color: transparent;\n      border: 0;\n      overflow: visible;\n    }\n    :host io-collapsable > div.io-collapsable-content {\n      background-color: transparent;\n      flex: 0 0 auto;\n      border-radius: 0 !important;\n      margin: 0 !important;\n      padding: 0 !important;\n      background: var(--io_bgColorDimmed);\n    }\n    \n    :host io-menu-item:first-of-type {\n      margin-top: var(--io_borderWidth);\n    }\n    :host io-menu-item {\n      background-color: var(--io_bgColorDimmed);\n      flex: 0 0 auto;\n      align-self: stretch;\n      border-radius: 0;\n      margin-left: var(--io_borderWidth);\n      margin-right: var(--io_borderWidth);\n    }\n    :host io-menu-item[depth="1"] {\n      padding-left: calc(var(--io_lineHeight) * 1);\n    }\n    :host io-menu-item[depth="2"] {\n      padding-left: calc(var(--io_lineHeight) * 2);\n    }\n    :host io-menu-item[depth="3"] {\n      padding-left: calc(var(--io_lineHeight) * 3);\n    }\n    :host io-menu-item[depth="4"] {\n      padding-left: calc(var(--io_lineHeight) * 4);\n    }\n    :host io-menu-item[depth="5"] {\n      padding-left: calc(var(--io_lineHeight) * 5);\n    }\n    :host io-menu-item[depth="6"] {\n      padding-left: calc(var(--io_lineHeight) * 6);\n    }\n    /* Item spacing */\n    :host io-menu-item {\n      margin-bottom: var(--io_borderWidth);\n    }\n    :host io-menu-item:first-of-type {\n      /* margin-top: var(--io_spacing); */\n    }\n\n    /* Item dividers */\n    :host io-collapsable > io-boolean {\n      margin: 0;\n      margin-left: var(--io_borderWidth);\n      margin-right: var(--io_borderWidth);\n      z-index: 1;\n      overflow: visible;\n    }\n\n    /* Search field */\n    :host > .search {\n      border-radius: 0;\n      flex: 0 0 auto;\n    }\n    '}static get Listeners(){return{"item-clicked":"_onItemClicked"}}_onItemClicked(e){const t=e.composedPath()[0],n=e.detail;t!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",n,!0),this.throttle(this._onCollapse))}_onCollapse(){const e=this.searchable&&this.search;this.search="",e&&this.$.search.focus()}changed(){const e=[...this.slotted];if(this.searchable&&e.push(["io-string",{$:"search",role:"search",class:"search",value:this.bind("search"),placeholder:"Search",live:!0}]),this.search){const t=e.length;filterOptions(this.options,this.search,this.depth,e),t===e.length&&e.push(["io-menu-item",{item:new c({label:"No matches",mode:"none"})}])}else e.push(...addMenuOptions(this.options,this.depth));this.template(e)}};__decorate$5([t({type:p,reflect:!0})],u.prototype,"options",void 0),__decorate$5([t(!1)],u.prototype,"searchable",void 0),__decorate$5([t("")],u.prototype,"search",void 0),__decorate$5([t(Infinity)],u.prototype,"depth",void 0),__decorate$5([t({type:Array})],u.prototype,"slotted",void 0),__decorate$5([t("listbox")],u.prototype,"role",void 0),__decorate$5([t(void 0)],u.prototype,"$parent",void 0),u=__decorate$5([n],u);var __decorate$4=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};const m=new WeakMap;let v=class IoMenuOptions extends i{static get Style(){return'\n    :host {\n      display: flex;\n      border-radius: var(--io_borderRadius);\n      background-color: var(--io_bgColorDimmed);\n      position: relative;\n    }\n    :host[horizontal] {\n      flex-direction: row;\n      align-self: stretch;\n      padding: 0 var(--io_spacing);\n    }\n    :host:not([horizontal]) {\n      flex-direction: column;\n      padding: var(--io_spacing) 0;\n    }\n    :host[inlayer] {\n      min-width: 8em;\n    }\n    :host[inlayer]:not([expanded]) {\n      visibility: hidden;\n      opacity: 0;\n    }\n\n    /* Menu Items */\n    :host > io-menu-item {\n      background-color: transparent;\n      border-radius: 0;\n    }\n    :host[horizontal] > io-menu-item {\n      height: calc(var(--io_fieldHeight) + var(--io_spacing2));\n      border-left: none;\n      border-right: none;\n      border-width: calc(var(--io_spacing) + var(--io_borderWidth)) var(--io_borderWidth);\n    }\n    :host:not([horizontal]) > io-menu-item {\n      border-top: none;\n      border-bottom: none;\n      border-width: var(--io_borderWidth) var(--io_spacing);\n    }\n    :host > io-menu-item[selected][direction="up"] {\n      border-color: var(--io_colorBlue) transparent transparent transparent;\n    }\n    :host > io-menu-item[selected][direction="down"] {\n      border-color: transparent transparent var(--io_colorBlue) transparent;\n    }\n    :host > io-menu-item[selected][direction="right"] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item[selected][direction="left"] {\n      border-color: transparent transparent transparent var(--io_colorBlue);\n    }\n\n    /* Item divider */\n    :host > [hidden] ~ span.divider {\n      border-color: red;\n      display: none;\n    }\n    :host > span.divider {\n      flex: 0 0 0;\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n      margin: var(--io_spacing);\n      opacity: 0.5;\n    }\n\n    /* Remove hints from horizontal menu */\n    :host[horizontal] > io-menu-item > .hint {\n      display: none;\n    }\n\n    /* Search field */\n    :host:not([horizontal]) > .search {\n      margin: var(--io_spacing);\n      margin-top: 0;\n    }\n    :host[horizontal] > .search {\n      margin-right: var(--io_borderWidth);\n      flex: 0 0 10em;\n    }\n\n    /* Hamburger menu for overflow items */\n    :host > io-menu-hamburger {\n      border-color: transparent !important;\n      background-color: transparent !important;\n    }\n    :host[horizontal] > io-menu-hamburger {\n      position: absolute;\n      right: var(--io_spacing);\n      padding: var(--io_spacing);\n    }\n    '}static get Listeners(){return{"item-clicked":"_onItemClicked",touchstart:["_stopPropagation",{passive:!1}]}}_onItemClicked(e){const t=e.composedPath()[0],n=e.detail;"io-string"!==t.localName?t!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",n,!0),this.throttle(this._onCollapse)):e.stopImmediatePropagation()}_stopPropagation(e){e.stopPropagation()}init(){this.throttle(this._onSetOverflow)}onResized(){this.throttle(this._onSetOverflow)}_onSetOverflow(){if(this._disposed)return;const e=this.querySelectorAll(".item");if(this._overflownItems.length=0,this.horizontal){const t=this.querySelector("io-menu-hamburger"),n=t?.getBoundingClientRect().width||0,o=this.getBoundingClientRect().right-(l.borderWidth+l.spacing);let i=Infinity,s=!1;for(let t=e.length;t--;){const r=e[t].getBoundingClientRect(),l=m.get(e[t].item)||{right:0,width:0};0!==r.right&&0!==r.width&&(l.right=r.right,l.width=r.width,m.set(e[t].item,l)),i=Math.min(i,l.right),this.noPartialCollapse&&s?(e[t].hidden=!0,this._overflownItems.unshift(e[t].item)):t===e.length-1&&i<o||i<o-1.5*n?e[t].hidden=!1:(s=!0,e[t].hidden=!0,this._overflownItems.unshift(e[t].item))}this._overflownItems.length?this.overflow=JSON.stringify(this._overflownItems.map((e=>e.label))):this.overflow=""}else this.overflow=""}_onCollapse(){const e=this.selectable&&!!this.search&&!this.inlayer;this.setProperties({search:"",expanded:!1}),e&&this.$.search.focus()}expandedChanged(){this.expanded?this.inlayer&&this.throttle(this._onExpandInOverlay):(this.style.top=null,this.style.height=null,this.style.touchAction=null,this.scrollTop=0,this.search="")}searchChanged(){this.inlayer&&this.$parent&&this.throttle(this._onClipHeight),this.throttle(this._onSetOverflow)}_onExpandInOverlay(){if(this.$parent){const e=this.$parent.getBoundingClientRect();a.setElementPosition(this,this.direction,e),this._onClipHeight()}}_onClipHeight(){if(this.scrollTop=0,!this.firstChild)return;const e=this.firstChild.getBoundingClientRect().top,t=this.lastChild.getBoundingClientRect().bottom,n=t-e;e<0?(this.style.top="0px",this.style.height=n+e+"px",this.style.touchAction="pan-y"):t>window.innerHeight?(this.style.height=window.innerHeight-e+"px",this.style.touchAction="pan-y"):(this.style.height=null,this.style.touchAction=null)}changed(){const e=[...this.slotted];if(this.searchable&&e.push(["io-string",{$:"search",role:"search",class:"search",value:this.bind("search"),placeholder:"Search",live:!0}]),this.search){const t=e.length;filterOptions(this.options,this.search,this.depth,e),t===e.length&&e.push(["io-menu-item",{item:new c({label:"No matches",mode:"none"})}])}else{let t=this.horizontal?"down":"right";this.horizontal&&"up"===this.direction&&(t="up");for(let n=0;n<this.options.length;n++)e.push(["io-menu-item",{class:"item",item:this.options[n],direction:t,depth:this.depth}]),n<this.options.length-1&&e.push(["span",{class:"divider"}])}this.overflow&&e.push(["io-menu-hamburger",{depth:this.depth+1,role:"navigation",direction:"down",item:new c({options:new p(this._overflownItems)})}]),this.template(e)}};__decorate$4([t({type:p})],v.prototype,"options",void 0),__decorate$4([t({value:!1,reflect:!0})],v.prototype,"expanded",void 0),__decorate$4([t({value:!1,reflect:!0})],v.prototype,"horizontal",void 0),__decorate$4([t(!1)],v.prototype,"searchable",void 0),__decorate$4([t("")],v.prototype,"search",void 0),__decorate$4([t({value:"none",reflect:!0})],v.prototype,"direction",void 0),__decorate$4([t(100)],v.prototype,"depth",void 0),__decorate$4([t(!1)],v.prototype,"noPartialCollapse",void 0),__decorate$4([t({value:"",reflect:!0})],v.prototype,"overflow",void 0),__decorate$4([t({value:!1,reflect:!0})],v.prototype,"inlayer",void 0),__decorate$4([t({type:Array})],v.prototype,"slotted",void 0),__decorate$4([t("listbox")],v.prototype,"role",void 0),__decorate$4([t(void 0)],v.prototype,"$parent",void 0),__decorate$4([t({type:Array})],v.prototype,"_overflownItems",void 0),v=__decorate$4([n],v);var __decorate$3=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};const g=["io-menu-item","io-menu-hamburger","io-option-menu"],f=g.join(", ");let _,b,y=class IoMenuItem extends h{static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n      :host > .label {\n        flex: 1 1 auto;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hint {\n        flex: 0 1 auto;\n        opacity: 0.25;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hasmore {\n        opacity: 0.5;\n      }\n    "}static get Listeners(){return{click:"preventDefault"}}preventDefault(e){e.stopPropagation(),e.preventDefault()}get hasmore(){return this.item.hasmore&&this.depth>0}get inlayer(){return!!this.$parent&&!!this.$parent.inlayer}get $parent(){return this.parentElement}connectedCallback(){super.connectedCallback(),a.addEventListener("pointermove",this._onOverlayPointermove),a.addEventListener("pointerup",this._onOverlayPointerup),this.$options&&a.appendChild(this.$options)}disconnectedCallback(){super.disconnectedCallback(),a.removeEventListener("pointermove",this._onOverlayPointermove),a.removeEventListener("pointerup",this._onOverlayPointerup),this.$options&&this.$options.inlayer&&a.removeChild(this.$options)}_onOverlayPointermove(e){!this.inlayer&&this.expanded&&this._onPointermove(e)}_onOverlayPointerup(e){!this.inlayer&&this.expanded&&this._onPointerupAction(e)}_onClick(){const e=this.item;this.hasmore?this.expanded||(this.expanded=!0):"toggle"===e.mode?e.selected=!e.selected:(e.action&&e.action.apply(null,[e.value]),"select"===e.mode?e.hasmore&&e.options&&this.depth<=0?e.options.selectDefault():e.selected=!0:"scroll"===e.mode?e.selected=!0:"link"===e.mode&&window.open(e.value,"_blank"),this.dispatchEvent("item-clicked",e,!0),this.throttle(this._onCollapse))}_onItemClicked(e){e.composedPath()[0]!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",e.detail,!0)),this.expanded&&this.throttle(this._onCollapse)}_onPointerdown(e){e.stopPropagation(),e.preventDefault(),this.setPointerCapture(e.pointerId),this.addEventListener("pointermove",this._onPointermove),this.addEventListener("pointerup",this._onPointerup),this._onPointerdownAction(e)}_onPointerdownAction(e){(this.expanded||"mouse"===e.pointerType||this.inlayer)&&(this.focus(),this.item.options&&(this.expanded=!0)),this._x=e.clientX,this._y=e.clientY}_onPointermove(e){e.stopPropagation(),this._onPointermoveAction(e)}_onPointermoveAction(e){if(!this.expanded&&"touch"===e.pointerType&&!this.inlayer)return;const t=!!this.$parent&&!!this.$parent.style.height;if("touch"===e.pointerType&&t)return;const n=e.clientX-this._x,o=e.clientY-this._y;if(this._x=e.clientX,this._y=e.clientY,a.x=e.clientX,a.y=e.clientY,clearTimeout(this._timeoutOpen),_=this._gethovered(e),_){const e=Math.abs(o)-Math.abs(n),t=_.parentElement.horizontal;b?.parentElement!==_.parentElement||(t?e<-.25:e>.25)?this._expandHovered():this._timeoutOpen=setTimeout((()=>{this._expandHovered()}),100),b=_}}_onPointerup(e){e.stopPropagation(),this.removeEventListener("pointermove",this._onPointermove),this.removeEventListener("pointerup",this._onPointerup),this._onPointerupAction(e)}_onPointerupAction(e,t=!1){const n=this._gethovered(e);n?(n.focus(),n._onClick(e)):t||this.throttle(this._onCollapseRoot),_=void 0,b=void 0}_gethovered(e){const t=getMenuDescendants(getMenuRoot(this)),n=[];for(let o=t.length;o--;)isPointerAboveIoMenuItem(e,t[o])&&n.push(t[o]);if(n.length)return n.sort(((e,t)=>e.depth<t.depth?1:e.depth>t.depth?-1:0)),n[n.length-1]}_expandHovered(){if(_){if(_.focus(),_.hasmore){if(_.$options){const e=getMenuDescendants(_.$options);for(let t=e.length;t--;)e[t].expanded=!1}_.expanded=!0}if(_.$parent){const e=_.$parent.querySelectorAll(f);for(let t=e.length;t--;)e[t]!==_&&(e[t].expanded=!1)}}}_onKeydown(e){if("Enter"===e.key||" "===e.key)return e.preventDefault(),void this._onClick();if("Escape"===e.key)return e.preventDefault(),void this.throttle(this._onCollapseRoot);let t="";"left"===this.direction||"right"===this.direction?("ArrowUp"===e.key&&(t="prev"),"ArrowRight"===e.key&&(t="in"),"ArrowDown"===e.key&&(t="next"),"ArrowLeft"===e.key&&(t="out")):("ArrowUp"===e.key&&(t="out"),"ArrowRight"===e.key&&(t="next"),"ArrowDown"===e.key&&(t="in"),"ArrowLeft"===e.key&&(t="prev")),this.inlayer&&"Tab"===e.key&&(t="next");const n=this.$parent?[...this.$parent.children]:[],o=n.indexOf(this);if(t)switch(e.preventDefault(),t){case"prev":{const e=n[(o+n.length-1)%n.length];this.expanded=!1,e&&(e.hasmore&&(e.expanded=!0),e.focus());break}case"next":{const e=n[(o+1)%n.length];this.expanded=!1,e&&(e.hasmore&&(e.expanded=!0),e.focus());break}case"in":this.$options&&this.$options.children.length&&this.$options.children[0].focus();break;case"out":this.expanded=!1,this.$parent&&this.$parent.$parent&&this.$parent.$parent.focus()}else super._onKeydown(e)}_onCollapse(){this.expanded=!1}_onCollapseRoot(){getMenuRoot(this).expanded=!1}expandedChanged(){if(this.expanded&&this.depth>0){this.item.options&&void 0===this.$options&&(this.$options=new v({expanded:this.bind("expanded"),inlayer:!0,depth:this.depth-1,options:this.item.options,direction:this.direction,$parent:this}));const e=getMenuDescendants(getMenuRoot(this)),t=getMenuAncestors(this),n=getMenuDescendants(this);for(let o=e.length;o--;)e[o]!==this&&-1===t.indexOf(e[o])&&-1===n.indexOf(e[o])&&(e[o].expanded=!1)}if(this.$options){this.expanded?(this.$options.parentElement!==a&&a.appendChild(this.$options),this.$options.addEventListener("item-clicked",this._onItemClicked)):this.$options.removeEventListener("item-clicked",this._onItemClicked);const e=getMenuDescendants(this.$options);for(let t=e.length;t--;)e[t].expanded=!1}}itemChanged(){this.setProperties({selected:this.item.bind("selected"),disabled:this.item.bind("disabled")})}itemMutated(){this.changed()}changed(){void 0!==this.$options&&this.item.options&&(this.$options.options=this.item.options);const e=this.icon||this.item.icon;this.setAttribute("hidden",this.item.hidden),this.setAttribute("hasmore",this.hasmore),this.template([this.hasmore&&"left"===this.direction?["io-icon",{class:"hasmore",icon:"menu:triangle_left"}]:null,this.hasmore&&"up"===this.direction?["io-icon",{class:"hasmore",icon:"menu:triangle_up"}]:null,e?["io-icon",{icon:e}]:null,this.item.label?["span",{class:"label"},this.item.label]:null,this.item.hint?["span",{class:"hint"},this.item.hint]:null,this.hasmore&&"right"===this.direction?["io-icon",{class:"hasmore",icon:"menu:triangle_right"}]:null,this.hasmore&&"down"===this.direction?["io-icon",{class:"hasmore",icon:"menu:triangle_down"}]:null])}};function getMenuDescendants(e){const t=[];if(e.$options){if(e.expanded){t.push(e.$options);const n=e.$options.querySelectorAll(f);for(let e=n.length;e--;)t.push(n[e]),n[e].expanded&&t.push(...getMenuDescendants(n[e]))}}else{const n=e.querySelectorAll(f);for(let e=n.length;e--;)t.push(n[e]),n[e].expanded&&t.push(...getMenuDescendants(n[e]))}return t}function getMenuAncestors(e){const t=[];let n=e;for(;n&&n.$parent;)n=n.$parent,n&&t.push(n);return t}function getMenuRoot(e){let t=e;for(;t&&t.$parent;)t=t.$parent;return t}function isPointerAboveIoMenuItem(e,t){if(-1!==g.indexOf(t.localName)&&!t.disabled&&!t.hidden&&(!t.inlayer||t.parentElement.expanded&&a.expanded)){const n=1,o=t.getBoundingClientRect(),i=e.clientX,s=e.clientY;return o.top<=s+n&&o.bottom>=s-n&&o.left<=i+n&&o.right>=i-n}return null}__decorate$3([t({type:c})],y.prototype,"item",void 0),__decorate$3([t({value:!1,reflect:!0})],y.prototype,"expanded",void 0),__decorate$3([t({value:"right",reflect:!0})],y.prototype,"direction",void 0),__decorate$3([t({value:1e3,reflect:!0})],y.prototype,"depth",void 0),y=__decorate$3([n],y);var __decorate$2=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let x=class IoMenuHamburger extends y{static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n    "}changed(){void 0!==this.$options&&this.item.options&&(this.$options.options=this.item.options),this.setAttribute("selected",this.item.selected),this.setAttribute("hidden",this.item.hidden),this.disabled=this.item.disabled,this.template([["io-icon",{icon:"menu:hamburger"}]])}};x=__decorate$2([n],x);var __decorate$1=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};const C=new p;let P=class IoOptionMenu extends i{static get Style(){return"\n    :host {\n      display: inline-block;\n      text-align: center;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorDimmed);\n      background-image: var(--io_gradientOutset);\n      /* padding-left: calc(2 * var(--io_spacing)); */\n      /* padding-right: calc(2 * var(--io_spacing)); */\n      text-align: left;\n    }\n    :host > io-menu-item {\n      margin: calc(-1 * var(--io_borderWidth));\n      background-color: transparent !important;\n      border-color: transparent !important;\n    }\n    :host > io-menu-item[selected] {\n      color: var(--io_colorStrong);\n    }\n    "}_onLeafChanged(e){this.inputValue(e.detail.value)}optionsChanged(e){e.oldValue&&e.oldValue!==C&&e.oldValue.removeEventListener("last-changed",this._onLeafChanged),e.value&&e.value.addEventListener("last-changed",this._onLeafChanged);const t=this.options.getItem(this.value);t&&(t.selected=!0)}changed(){const e=this.options.getItem(this.value);this.item=this.item||new c({}),this.item.label=e?.label||String(this.value),this.item.options=this.options,this.item.icon=this.icon||"",this.template([["io-menu-item",{item:this.item,direction:"down"}]])}};__decorate$1([t({value:void 0,reflect:!0})],P.prototype,"value",void 0),__decorate$1([t({value:C,type:p,reflect:!0})],P.prototype,"options",void 0),__decorate$1([t("button")],P.prototype,"role",void 0),__decorate$1([t(c)],P.prototype,"item",void 0),P=__decorate$1([n],P);var __decorate=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let w=class IoContextMenu extends i{static get Properties(){return{$options:null}}connectedCallback(){super.connectedCallback(),a.addEventListener("pointermove",this._onOverlayPointermove),this._parent=this.parentElement,this._parent.addEventListener("pointerdown",this._onPointerdown),this._parent.addEventListener("click",this._onClick),this._parent.addEventListener("contextmenu",this._onContextmenu)}disconnectedCallback(){super.disconnectedCallback(),this.$options&&this.$options.parentElement&&a.removeChild(this.$options),a.removeEventListener("pointermove",this._onOverlayPointermove),this._parent.removeEventListener("pointerdown",this._onPointerdown),this._parent.removeEventListener("contextmenu",this._onContextmenu),this._parent.removeEventListener("pointermove",this._onPointermove),this._parent.removeEventListener("pointerup",this._onPointerup),this._parent.removeEventListener("click",this._onClick),delete this._parent}getBoundingClientRect(){return this._parent.getBoundingClientRect()}_onItemClicked(e){const t=e.composedPath()[0],n=e.detail;t!==this&&(e.stopImmediatePropagation(),this.dispatchEvent("item-clicked",n,!0),this.throttle(this._onCollapse))}_onContextmenu(e){2===this.button&&e.preventDefault()}_onPointerdown(e){a.x=e.clientX,a.y=e.clientY,this._parent.addEventListener("pointermove",this._onPointermove),this._parent.addEventListener("pointerup",this._onPointerup),clearTimeout(this._contextTimeout),"touch"!==e.pointerType?e.button===this.button&&(this.setPointerCapture(e.pointerId),this.expanded=!0):(e.preventDefault(),this._contextTimeout=setTimeout((()=>{this.setPointerCapture(e.pointerId),this.expanded=!0}),150))}_onPointermove(e){clearTimeout(this._contextTimeout),this.expanded&&this.$options?.querySelector("io-menu-item")?._onPointermoveAction(e)}_onPointerup(e){clearTimeout(this._contextTimeout),this.releasePointerCapture(e.pointerId),this.expanded&&this.$options?.querySelector("io-menu-item")?._onPointerupAction(e,!0),this._parent.removeEventListener("pointermove",this._onPointermove),this._parent.removeEventListener("pointerup",this._onPointerup)}_onOverlayPointermove(e){this.expanded&&this._onPointermove(e)}_onClick(e){e.button===this.button&&2!==e.button&&(this.expanded=!0)}_onCollapse(){this.expanded=!1}optionsChanged(){this.$options&&(a.removeChild(this.$options),this.$options.template([]),this.$options.dispose()),this.$options=new v({expanded:this.bind("expanded"),inlayer:!0,options:this.options,direction:"pointer",$parent:this,"@item-clicked":this._onItemClicked}),a.appendChild(this.$options)}};__decorate([t({type:p})],w.prototype,"options",void 0),__decorate([t({value:!1,reflect:!0})],w.prototype,"expanded",void 0),__decorate([t(0)],w.prototype,"button",void 0),w=__decorate([n],w);d.registerIcons("menu",'\n<svg>\n  <g id="hamburger">\n    <path d="M20.9,9.1H3.2c-0.6,0-1.1,0.3-1.1,0.7V14c0,0.4,0.5,0.8,1.1,0.8h17.9c0.6,0,1.1-0.3,1.1-0.7V9.9C22,9.4,21.5,9.1,20.9,9.1z\n      M20.9,2.1H3.2c-0.6,0-1.1,0.3-1.1,0.7V7c0,0.4,0.5,0.7,1.1,0.7h17.9c0.6,0,1.1-0.3,1.1-0.7V2.8C22,2.4,21.5,2.1,20.9,2.1z\n      M20.9,16.5H3.2c-0.6,0-1.1,0.3-1.1,0.7v4.2c0,0.4,0.5,0.7,1.1,0.7h17.9c0.6,0,1.1-0.3,1.1-0.7v-4.2C22,16.8,21.5,16.5,20.9,16.5z"\n      />\n  </g>\n  <g id="triangle_right">\n    <polygon points="9.1,16.5 14.9,12 9.1,7.5   "/>\n  </g>\n  <g id="triangle_down">\n    <polygon points="7.6,9 11.9,15 16.5,9   "/>\n  </g>\n  <g id="triangle_left">\n    <polygon points="14.9,7.5 9.1,12 14.9,16.5   "/>\n  </g>\n  <g id="triangle_up">\n    <polygon points="16.5,15 11.9,9 7.6,15   "/>\n  </g>\n</svg>');export{w as IoContextMenu,x as IoMenuHamburger,y as IoMenuItem,v as IoMenuOptions,u as IoMenuTree,P as IoOptionMenu,c as MenuItem,p as MenuOptions,addMenuOptions,filterOptions,getMenuAncestors,getMenuDescendants,getMenuRoot};
