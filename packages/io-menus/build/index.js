import{ReactiveProperty as e,Register as t,Node as n,IoOverlaySingleton as o,Property as i,IoElement as s,ThemeSingleton as r,nudge as l,span as a,Storage as h,genObjectStorageID as d}from"io-gui";import{ioIcon as p}from"io-icons";import{ioString as c,IoField as u,ioBoolean as m}from"io-inputs";var __decorate$8=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let v=class MenuOptions extends n{constructor(e={}){super(e),this.updatePathsDebounced=this.updatePathsDebounced.bind(this),""!==this.path&&this.pathChanged(),this.initItems()}getAllItems(){const e=[];for(let t=0;t<this.items.length;t++)e.push(this.items[t]),this.items[t].options&&e.push(...this.items[t].options.getAllItems());return e}findItemByValue(e){const t=this.getAllItems();for(let n=0;n<t.length;n++)if(t[n].value===e)return t[n];return null}findItemById(e){const t=this.getAllItems();for(let n=0;n<t.length;n++)if(t[n].id===e)return t[n];return null}fromJSON(e){this.items.length=0;const t=[];for(let n=0;n<e.length;n++)t.push((new f).fromJSON(e[n]));return this.items=t,""!==this.path&&this.pathChanged(),this.initItems(),this}initItems(){const e=this.items;for(let t=0;t<e.length;t++){let n=e[t];n instanceof f||(n=(new f).fromJSON(n)),n.addEventListener("selected-changed",this.onItemSelectedChanged),n.addEventListener("path-changed",this.onSubOptionsPathChanged),n.selected&&"select"===n.mode&&this.updatePaths(n)}}unselectAll(){for(let e=0;e<this.items.length;e++)"select"===this.items[e].mode&&(this.items[e].selected=!1);this.updatePaths()}pathChanged(){const e=this.path?[...this.path.split(this.delimiter)]:[];if(this.items.length&&e.length){const t=e.shift(),n=this.items.find((e=>e.id===t));if(n)"select"===n.mode&&(n.options&&(n.options.path=e.join(this.delimiter)),n.selected=!0);else for(let e=0;e<this.items.length;e++)"select"===this.items[e].mode&&(this.items[e].selected=!1)}else for(let e=0;e<this.items.length;e++)"select"===this.items[e].mode&&(this.items[e].selected=!1)}selectedChanged(){if(!this.selected)return;const e=this.findItemById(this.selected);e?e.selected=!0:console.warn(`MenuOptions.selectedChanged: cannot find item for specified selected id "${this.selected}"!`,this),this.updatePaths()}updatePaths(e){this.debounce(this.updatePathsDebounced,e)}updatePathsDebounced(e){const t=[];let n="select"===e?.mode?e:void 0,o="select"===e?.mode?e:void 0;const i=this.items.find((e=>"select"===e.mode&&e.selected));if(n||!i){for(;n;)t.push(n.id),"select"===n.mode&&(o=n),n=n.options?.items.find((e=>"select"===e.mode&&e.selected));this.setProperties({path:t.join(this.delimiter),selected:void 0!==o?o.id:""})}}onItemSelectedChanged(e){const t=e.target;if("select"===t.mode)if(t.selected){for(let e=0;e<this.items.length;e++)this.items[e]!==t&&"select"===this.items[e].mode&&(this.items[e].selected=!1);this.updatePaths(t),this.dispatchEvent("item-selected",{item:t})}else this.updatePaths()}onSubOptionsPathChanged(e){const t=e.target;t.selected?this.updatePaths(t):this.updatePaths()}selectDefault(){for(let e=0;e<this.items.length;e++)if("select"===this.items[e].mode){if(!this.items[e].hasmore)return this.items[e].selected=!0,!0;if(this.items[e].options.selectDefault())return!0}return!1}dispose(){for(let e=0;e<this.items.length;e++)this.items[e].removeEventListener("selected-changed",this.onItemSelectedChanged),this.items[e].removeEventListener("path-changed",this.onSubOptionsPathChanged);super.dispose()}};__decorate$8([e("")],v.prototype,"selected",void 0),__decorate$8([e("")],v.prototype,"path",void 0),__decorate$8([e(",")],v.prototype,"delimiter",void 0),__decorate$8([e([])],v.prototype,"items",void 0),__decorate$8([e("debounced")],v.prototype,"reactivity",void 0),v=__decorate$8([t],v);var __decorate$7=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};function defaultId(e){return"string"==typeof e.value?e.value:"number"==typeof e.value?String(e.value):""}function defaultLabel(e){return e.id?e.id:"object"==typeof e.value?null===e.value?"null":`${e.value.constructor.name}`+(e.value instanceof Array?`(${e.value.length})`:""):void 0!==e.value?String(e.value):""}let f=class MenuItem extends n{get hasmore(){return!!this.options?.items.length}constructor(e){const t={...e};void 0===t.id&&(t.id=defaultId(t)),void 0===t.label&&(t.label=defaultLabel(t)),super(t)}findItemByValue(e){return this.options?.findItemByValue(e)||null}findItemById(e){return this.options?.findItemById(e)||null}fromJSON(e){const t={};return"object"==typeof e&&null!==e?(Object.hasOwn(e,"value")&&(t.value=e.value),Object.hasOwn(e,"id")&&(t.id=e.id),Object.hasOwn(e,"label")&&(t.label=e.label),Object.hasOwn(e,"icon")&&(t.icon=e.icon),Object.hasOwn(e,"hint")&&(t.hint=e.hint),Object.hasOwn(e,"hidden")&&(t.hidden=e.hidden),Object.hasOwn(e,"disabled")&&(t.disabled=e.disabled),Object.hasOwn(e,"action")&&(t.action=e.action),Object.hasOwn(e,"mode")&&(t.mode=e.mode),Object.hasOwn(e,"selected")&&(t.selected=e.selected),Object.hasOwn(e,"options")&&(e.options instanceof v?t.options=e.options:t.options=(new v).fromJSON(e.options))):t.value=e,void 0===t.id&&(t.id=defaultId(t)),void 0===t.label&&(t.label=defaultLabel(t)),this.applyProperties(t),this}toJSON(){const e={value:this.value,label:this.label,icon:this.icon,hint:this.hint,hidden:this.hidden,disabled:this.disabled};return this.options&&(e.options=this.options),e}onOptionsItemSelected(){"select"===this.mode&&(this.selected=!0)}onOptionsPathChanged(e){this.dispatchEvent("path-changed",e.detail),"select"===this.mode&&(this.selected=!!this.options?.path)}optionsChanged(e){e.oldValue&&(e.oldValue.removeEventListener("item-selected",this.onOptionsItemSelected),e.oldValue.removeEventListener("path-changed",this.onOptionsPathChanged)),e.value&&(e.value.addEventListener("item-selected",this.onOptionsItemSelected),e.value.addEventListener("path-changed",this.onOptionsPathChanged)),"select"===this.mode&&(this.selected=!!this.options?.selected)}selectedChanged(){!1===this.selected&&this.options?.unselectAll()}changed(){}dispose(){this.options&&(this.options.removeEventListener("item-selected",this.onOptionsItemSelected),this.options.removeEventListener("path-changed",this.onOptionsPathChanged)),super.dispose()}};__decorate$7([e({value:void 0})],f.prototype,"value",void 0),__decorate$7([e({value:"",type:String})],f.prototype,"id",void 0),__decorate$7([e({value:"",type:String})],f.prototype,"label",void 0),__decorate$7([e({value:"",type:String})],f.prototype,"icon",void 0),__decorate$7([e({value:"",type:String})],f.prototype,"hint",void 0),__decorate$7([e({value:!1,type:Boolean})],f.prototype,"hidden",void 0),__decorate$7([e({value:!1,type:Boolean})],f.prototype,"disabled",void 0),__decorate$7([e({value:void 0,type:Function,init:null})],f.prototype,"action",void 0),__decorate$7([e({value:"select",type:String})],f.prototype,"mode",void 0),__decorate$7([e({value:!1,type:Boolean})],f.prototype,"selected",void 0),__decorate$7([e({value:void 0,type:v,init:null})],f.prototype,"options",void 0),f=__decorate$7([t],f);const g=["io-menu-item","io-menu-options","io-menu-hamburger","io-option-select","io-string","io-menu-tree"],b=g.join(", ");function getMenuDescendants(e){const t=[];if(e.$options){t.push(e.$options);const n=e.$options.querySelectorAll(b);for(let e=n.length;e--;)t.push(n[e]),t.push(...getMenuDescendants(n[e]))}else{const n=e.querySelectorAll(b);for(let e=n.length;e--;)t.push(n[e]),t.push(...getMenuDescendants(n[e]))}return t}function getMenuAncestors(e){const t=[];let n=e;for(;n&&n.$parent;)n=n.$parent,n&&t.push(n);return t}function getMenuSiblings(e){const t=[],n=e.parentElement;return n&&t.push(...n.querySelectorAll(b)),t}function getMenuRoot(e){let t=e;for(;t&&t.$parent;)t=t.$parent;return t}function isPointerAboveIoMenuItem(e,t){if(-1!==g.indexOf(t.localName)&&!t.disabled&&!t.hidden&&t.parentElement!==o&&t.parentElement.expanded){const n=t.getBoundingClientRect(),o=e.clientX,i=e.clientY;return n.top<=i&&n.bottom>=i&&n.left<=o&&n.right>=o}return!1}function matchMenuItem(e,t){return!e.options&&(void 0!==e.value&&-1!==String(e.value).toLowerCase().indexOf(t)||(!(!e.label||-1===e.label.toLowerCase().indexOf(t))||!(!e.hint||-1===e.hint.toLowerCase().indexOf(t))))}function searchMenuOptions(e,t,n=5,o=0){t=t.toLowerCase();const i=[];if(o<=n)for(let s=0;s<e.items.length;s++)matchMenuItem(e.items[s],t)&&i.push(e.items[s]),e.items[s].options&&i.push(...searchMenuOptions(e.items[s].options,t,n,o+1));return i}var __decorate$6=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};const y=new WeakMap;let w=class IoMenuOptions extends s{static vConstructor;static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: var(--io_borderRadius);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorDimmed);\n      padding: var(--io_spacing) 0;\n      user-select: none;\n      transition: opacity 0.3s ease-in-out;\n    }\n    :host[horizontal] {\n      flex-direction: row;\n      align-self: stretch;\n      padding: 0 var(--io_spacing);\n    }\n    :host[inoverlay] {\n      overflow-y: auto;\n      box-shadow: 1px 1px 16px var(--io_shadowColor),\n                  1px 1px 8px var(--io_shadowColor), \n                  1px 1px 4px var(--io_shadowColor);\n    }\n    :host[inoverlay]:not([expanded]) {\n      visibility: hidden;\n      opacity: 0;\n    }\n    :host > io-menu-item {\n      border-radius: 0;\n    }\n    :host > io-menu-item[selected][direction="up"] {\n      border-color: var(--io_colorBlue) transparent transparent transparent;\n    }\n    :host > io-menu-item[selected][direction="down"] {\n      border-color: transparent transparent var(--io_colorBlue) transparent;\n    }\n    :host > io-menu-item[selected][direction="right"] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item[selected][direction="left"] {\n      border-color: transparent transparent transparent var(--io_colorBlue);\n    }\n\n    /* Item divider */\n    :host > io-menu-item[hidden] ~ span.divider {\n      display: none;\n    }\n    :host > span.divider {\n      flex: 0 0 0;\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n      margin: var(--io_spacing);\n      opacity: 0.5;\n    }\n\n    /* Remove hints from horizontal menu */\n    :host[horizontal] > io-menu-item > .hint {\n      display: none;\n    }\n\n    /* Search field */\n    :host:not([horizontal]) > #search {\n      margin: var(--io_spacing);\n      margin-top: 0;\n    }\n    :host[horizontal] > #search {\n      margin: var(--io_spacing);\n      margin-left: 0;\n      flex: 0 0 10em;\n    }\n\n    /* Hamburger menu for overflow items */\n    :host > io-menu-hamburger {\n      border-color: transparent !important;\n      background-color: transparent !important;\n    }\n    :host[horizontal] > io-menu-hamburger {\n      position: absolute;\n      right: var(--io_spacing);\n      padding: var(--io_spacing);\n    }\n    '}static get Listeners(){return{touchstart:["stopPropagation",{passive:!1}],"io-focus-to":"onIoFocusTo"}}get inoverlay(){return o.contains(this.parentElement)}constructor(e={}){super(e),this.setOverflow=this.setOverflow.bind(this),this.debounce(this.setOverflow)}stopPropagation(e){e.stopPropagation()}connectedCallback(){super.connectedCallback(),this.inoverlay&&this.setAttribute("inoverlay","true")}disconnectedCallback(){super.disconnectedCallback()}onIoFocusTo(e){const t=e.detail.source,n=e.detail.direction,o=getMenuSiblings(t),i=o.indexOf(t),s=this.inoverlay;let r=!1,l=!1,a=!1,h=!1;if(this.$parent){const e=this.getBoundingClientRect(),t=this.$parent.getBoundingClientRect();r=e.top>t.top,l=e.bottom<t.bottom,a=e.left>t.left,h=e.right<t.right}let d="";this.horizontal?("right"===n&&s&&(d="next"),"left"===n&&s&&(d="prev"),"left"===n&&0===i&&a&&(d="out"),"right"===n&&i===o.length-1&&h&&(d="out"),"up"===n&&r&&(d="out"),"down"===n&&l&&(d="out")):("down"===n&&s&&(d="next"),"up"===n&&s&&(d="prev"),"up"===n&&0===i&&r&&(d="out"),"down"===n&&i===o.length-1&&l&&(d="out"),"left"===n&&a&&(d="out"),"right"===n&&h&&(d="out")),d&&("next"===d?o[(i+1)%o.length].focus():"prev"===d?o[(i-1+o.length)%o.length].focus():"out"===d&&this.$parent&&this.$parent.focus(),e.stopPropagation())}onResized(){this.debounce(this.setOverflow)}setOverflow(){if(this._disposed)return;const e=this.querySelectorAll(".item");if(this._overflownItems.length=0,this.horizontal){const t=this.querySelector("io-menu-hamburger"),n=t?.getBoundingClientRect().width||0,o=this.getBoundingClientRect().right-(r.borderWidth+r.spacing);let i=Infinity,s=!1;for(let t=e.length;t--;){const r=e[t].getBoundingClientRect(),l=y.get(e[t].item)||{right:0,width:0};0!==r.right&&0!==r.width&&(l.right=r.right,l.width=r.width,y.set(e[t].item,l)),i=Math.min(i,l.right),this.noPartialCollapse&&s?(e[t].hidden=!0,this._overflownItems.unshift(e[t].item)):t===e.length-1&&i<o||i<o-1.5*n?e[t].hidden=!1:(s=!0,e[t].hidden=!0,this._overflownItems.unshift(e[t].item))}this._overflownItems.length?this.overflow=JSON.stringify(this._overflownItems.map((e=>e.label))):this.overflow=""}else this.overflow=""}collapse(){const e=this.contains(document.activeElement),t=this.searchable&&!!this.search;getMenuDescendants(this).forEach((e=>{e.expanded=!1})),this.expanded=!1,t&&e&&!this.inoverlay&&(this.search="",this.$.search.focus())}expandedChanged(){this.expanded?this.inoverlay&&this.debounce(this.onExpandInOverlay):(this.style.top=null,this.style.height=null,this.style.touchAction=null,this.scrollTop=0,this.search="")}searchChanged(){this.inoverlay&&this.$parent&&this.debounce(this.onExpandInOverlay),this.debounce(this.setOverflow)}onExpandInOverlay(){this.$parent&&l(this,this.$parent,this.direction,!0)}changed(){const e=this.widget?[this.widget]:[];if(this.searchable&&e.push(c({id:"search",role:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=searchMenuOptions(this.options,this.search,this.depth);if(0===t.length)e.push(I({item:new f({label:"No matches",mode:"none"})}));else for(let n=0;n<t.length;n++)e.push(I({item:t[n],depth:0}))}else{let t=this.horizontal?"down":"right";this.horizontal&&"up"===this.direction&&(t="up");for(let n=0;n<this.options.items.length;n++)e.push(I({item:this.options.items[n],direction:t,$parent:this,depth:this.depth})),n<this.options.items.length-1&&e.push({tag:"span",props:{class:"divider"}})}this.overflow&&e.push($({depth:this.depth+1,role:"navigation",direction:"down",item:new f({options:new v({items:this._overflownItems})})})),this.render(e)}};__decorate$6([e({type:v})],w.prototype,"options",void 0),__decorate$6([e({value:!1,reflect:!0})],w.prototype,"expanded",void 0),__decorate$6([e({value:!1,reflect:!0})],w.prototype,"horizontal",void 0),__decorate$6([e(!1)],w.prototype,"searchable",void 0),__decorate$6([e("")],w.prototype,"search",void 0),__decorate$6([e({value:"none",reflect:!0})],w.prototype,"direction",void 0),__decorate$6([e(100)],w.prototype,"depth",void 0),__decorate$6([e(!1)],w.prototype,"noPartialCollapse",void 0),__decorate$6([e({value:"",reflect:!0})],w.prototype,"overflow",void 0),__decorate$6([e(null)],w.prototype,"widget",void 0),__decorate$6([e(void 0)],w.prototype,"$parent",void 0),__decorate$6([i("listbox")],w.prototype,"role",void 0),__decorate$6([e({type:Array})],w.prototype,"_overflownItems",void 0),w=__decorate$6([t],w);const O=w.vConstructor;var __decorate$5=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let x,C,P=-1;function onOverlayPointerdown(e){x=void 0,C=void 0}function onOverlayPointermove(e){if(clearTimeout(P),x=function getHoveredMenuItem(e){const t=o.querySelectorAll("io-menu-item, io-menu-options"),n=[];if(o.expanded)for(let o=t.length;o--;)isPointerAboveIoMenuItem(e,t[o])&&n.push(t[o]);if(n.length){n.sort(((e,t)=>e.depth>t.depth?1:e.depth<t.depth?-1:"io-menu-item"===e.localName?1:"io-menu-item"===t.localName?-1:0));const e=n[0],t=n[1];if("io-menu-item"===e.localName)return e;if("io-menu-options"===e.localName&&t&&"io-menu-item"===t.localName&&t.depth===e.depth)return t}}(e),x&&x!==C){const t=Math.abs(e.movementY)-Math.abs(e.movementX),n=x.parentElement.horizontal;C?.parentElement!==x.parentElement||(n?t<-.25:t>.25)?(C=x,x.focus()):P=setTimeout((()=>{C=x,x&&x.focus()}),250)}}function onOverlayPointeup(e){x&&x.onClick()}o.addEventListener("pointermove",onOverlayPointermove);let E=class IoMenuItem extends u{static vConstructor;static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n      }\n      :host[hidden] {\n        display: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n      :host > .label {\n        flex: 1 1 auto;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hint {\n        flex: 0 1 auto;\n        opacity: 0.25;\n        padding: 0 var(--io_spacing2);\n      }\n      :host > .hasmore {\n        opacity: 0.5;\n      }\n    "}static get Listeners(){return{click:"preventDefault",focus:"onFocus",blur:"onBlur"}}constructor(e={}){super(e)}preventDefault(e){e.stopPropagation(),e.preventDefault()}get hasmore(){return this.item.hasmore&&this.depth>0}get inoverlay(){return o.contains(this.parentElement.parentElement)}connectedCallback(){super.connectedCallback(),this.$options&&o.appendChild(this.$options)}disconnectedCallback(){super.disconnectedCallback(),this.$options&&o.removeChild(this.$options)}onClick(){const e=this.item;this.hasmore?this.expanded||(this.expanded=!0):"toggle"===e.mode?e.selected=!e.selected:(e.action&&(e.action.apply(null,[e.value]),this.collapseRoot()),"select"===e.mode?(e.hasmore&&e.options&&this.depth<=0?e.options.selectDefault():e.selected=!0,this.collapseRoot()):"link"===e.mode&&(window.open(e.value,"_blank"),this.collapseRoot()))}onPointerdown(e){super.onPointerdown(e),e.stopPropagation(),this.setPointerCapture(e.pointerId),this.expanded=!0,onOverlayPointerdown.call(this,e)}onPointermove(e){if(e.stopPropagation(),"touch"===e.pointerType){if(!this.expanded&&!this.inoverlay)return;if(this.$parent&&this.$parent.style.height)return}onOverlayPointermove.call(this,e)}onPointerup(e){super.onPointerup(e),e.stopPropagation(),this.onPointerupAction(e)}onPointerupAction(e){this.onClick()}onFocus(e){super.onFocus(e),this.hasmore&&this.inoverlay&&(this.expanded=!0);const t=getMenuDescendants(getMenuRoot(this)),n=getMenuAncestors(this);for(let e=t.length;e--;)t[e]!==this&&t[e]!==this.$options&&-1===n.indexOf(t[e])&&t[e].expanded&&t[e].collapse()}onBlur(e){super.onBlur(e),this.debounce(this.onBlurDebounced)}onBlurDebounced(){const e=getMenuDescendants(this),t=getMenuSiblings(this),n=getMenuAncestors(this),i=e.some((e=>e===document.activeElement)),s=t.some((e=>e===document.activeElement)),r=n.some((e=>e===document.activeElement)),l=document.activeElement===document.body,a=!o.contains(document.activeElement);i||l||(r||s?this.collapse():a&&this.collapseRoot())}onKeydown(e){const t=this.inoverlay;let n=this.direction,o=!1,i=!1,s=!1,r=!1;if(this.expanded&&this.$options){const e=this.getBoundingClientRect(),t=this.$options.getBoundingClientRect();o=e.top>t.top,i=e.bottom<t.bottom,s=e.left>t.left,r=e.right<t.right}"up"===n&&i&&(n="down"),"down"===n&&o&&(n="up"),"left"===n&&r&&(n="right"),"right"===n&&s&&(n="left");let l="";if("Enter"===e.key||" "===e.key){if(!this.hasmore)return e.preventDefault(),void this.onClick();l="in"}else"Escape"===e.key?l="out":"Tab"===e.key?(e.preventDefault(),"left"===n||"right"===n?this.dispatchEvent("io-focus-to",{source:this,direction:"down"},!0):this.dispatchEvent("io-focus-to",{source:this,direction:"right"},!0)):"ArrowLeft"===e.key&&(t||this.expanded)?this.hasmore&&"left"===n?l="in":"right"===n&&(l="out"):"ArrowRight"===e.key&&(t||this.expanded)?this.hasmore&&"right"===n?l="in":"left"===n&&(l="out"):"ArrowUp"===e.key&&(t||this.expanded)?this.hasmore&&"up"===n?l="in":"down"===n&&(l="out"):"ArrowDown"===e.key&&(t||this.expanded)&&(this.hasmore&&"down"===n?l="in":"up"===n&&(l="out"));if(l)switch(e.preventDefault(),l){case"collapse":this.collapse();break;case"in":this.hasmore&&(this.expanded=!0),this.$options&&this.$options.children.length&&this.$options.children[0].focus();break;case"out":this.collapse(),this.$parent&&this.$parent.$parent&&(this.$parent.$parent.focus(),this.$parent.$parent.collapse())}else super.onKeydown(e)}collapse(){getMenuDescendants(this).forEach((e=>{e.expanded=!1})),this.expanded=!1}collapseRoot(){getMenuRoot(this).collapse()}itemChanged(){this.setProperties({selected:this.item.bind("selected"),disabled:this.item.bind("disabled")})}itemMutated(){this.changed()}changed(){this.item.options&&this.depth>0&&(void 0===this.$options?this.$options=new w({expanded:this.bind("expanded"),depth:this.depth-1,options:this.item.options,direction:this.direction,$parent:this}):this.$options.options=this.item.options);const e=this.icon||this.item.icon,t=this.label||this.item.label;this.setAttribute("hidden",this.item.hidden),this.render([this.hasmore&&"left"===this.direction?p({value:"io:triangle_left",class:"hasmore"}):null,this.hasmore&&"up"===this.direction?p({value:"io:triangle_up",class:"hasmore"}):null,e?p({value:e}):null,t?a({class:"label"},t):null,this.item.hint?a({class:"hint"},this.item.hint):null,this.hasmore&&"right"===this.direction?p({value:"io:triangle_right",class:"hasmore"}):null,this.hasmore&&"down"===this.direction?p({value:"io:triangle_down",class:"hasmore"}):null])}};__decorate$5([e({type:f})],E.prototype,"item",void 0),__decorate$5([i("")],E.prototype,"label",void 0),__decorate$5([e({value:!1,reflect:!0})],E.prototype,"expanded",void 0),__decorate$5([e({value:"right",reflect:!0})],E.prototype,"direction",void 0),__decorate$5([e({value:1e3,reflect:!0})],E.prototype,"depth",void 0),__decorate$5([i("false")],E.prototype,"contentEditable",void 0),__decorate$5([e(void 0)],E.prototype,"$parent",void 0),E=__decorate$5([t],E);const I=E.vConstructor;var __decorate$4=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let _=class IoMenuHamburger extends E{static get Style(){return"\n      :host {\n        display: flex;\n        user-select: none;\n      }\n      :host > * {\n        pointer-events: none;\n        text-overflow: ellipsis;\n      }\n    "}changed(){void 0!==this.$options&&this.item.options&&(this.$options.options=this.item.options),this.setAttribute("selected",this.item.selected),this.setAttribute("hidden",this.item.hidden),this.disabled=this.item.disabled,this.render([p({value:"io:hamburger"})])}};_=__decorate$4([t],_);const $=_.vConstructor;var __decorate$3=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let R=class IoMenuTreeBranch extends s{static vConstructor;static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n    }\n    :host > io-boolean {\n      overflow: visible;\n      padding-right: var(--io_spacing3);\n    }\n    :host > io-boolean:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: "▸"\n    }\n    :host > io-boolean[value]:before {\n      content: "▾"\n    }\n    :host > io-menu-tree {\n      margin-top: 0;\n      margin-left: var(--io_spacing3);\n      border: none;\n    }\n    '}itemMutated(){this.item.selected&&(this.expanded=this.item.selected)}changed(){this.render([m({icon:this.item.icon,true:this.item.label,false:this.item.label,value:this.bind("expanded")}),this.expanded?j({options:this.item.options,depth:this.depth+1}):null])}};__decorate$3([e(Number)],R.prototype,"depth",void 0),__decorate$3([e({type:f,init:null})],R.prototype,"item",void 0),__decorate$3([e({value:!1,type:Boolean,reflect:!0})],R.prototype,"expanded",void 0),__decorate$3([i("region")],R.prototype,"role",void 0),R=__decorate$3([t],R);const S=R.vConstructor;var __decorate$2=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let k=class IoMenuTree extends s{static vConstructor;static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-self: flex-start;\n      border: var(--io_border);\n      border-radius: var(--io_borderRadius);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorDimmed);\n      user-select: none;\n    }\n    \n    :host > io-menu-item {\n      padding-left: var(--io_spacing);\n      padding-right: var(--io_spacing3);\n      border-radius: 0;\n    }\n    :host > io-menu-item[selected] {\n      border-color: transparent var(--io_colorBlue) transparent transparent;\n    }\n    :host > io-menu-item:before {\n      display: inline-block;\n      width: var(--io_fontSize);\n      content: ""\n    }\n    :host io-menu-tree-branch {\n      margin-left: var(--io_spacing2);\n    }\n\n    :host > #search {\n      margin: var(--io_spacing);\n      margin-bottom: 0;\n    }\n    '}constructor(e={}){super(e)}changed(){const e=this.widget?[this.widget]:[];if(this.searchable&&e.push(c({id:"search",role:"search",value:this.bind("search"),placeholder:"Search",live:!0})),this.search){const t=searchMenuOptions(this.options,this.search,this.depth);if(0===t.length)e.push(I({item:new f({label:"No matches",mode:"none"})}));else for(let n=0;n<t.length;n++)e.push(I({item:t[n],depth:0}))}else e.push(...function addMenuItemsOrTreeBranches(e,t,n=0){const o=[];if(n<=t)for(let t=0;t<e.items.length;t++){const i=e.items[t];if(i.options?.items.length){const e=h({value:!1,storage:"local",key:d(i)});!0===i.selected&&(e.value=!0),o.push(S({item:i,depth:n,expanded:e}))}else o.push(I({item:i,depth:n}))}return o}(this.options,this.depth));this.render(e)}};__decorate$2([e({type:v,init:null})],k.prototype,"options",void 0),__decorate$2([e({value:!1,type:Boolean})],k.prototype,"searchable",void 0),__decorate$2([e({value:"",type:String})],k.prototype,"search",void 0),__decorate$2([e({value:Infinity,type:Number})],k.prototype,"depth",void 0),__decorate$2([e(null)],k.prototype,"widget",void 0),__decorate$2([e(void 0)],k.prototype,"$parent",void 0),__decorate$2([i("listbox")],k.prototype,"role",void 0),k=__decorate$2([t],k);const j=k.vConstructor;var __decorate$1=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let M=class IoOptionSelect extends s{static vConstructor;static get Style(){return"\n    :host {\n      display: inline-block;\n      text-align: center;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      background-color: var(--io_bgColorDimmed);\n      background-image: var(--io_gradientOutset);\n      text-align: left;\n    }\n    :host > io-menu-item {\n      margin: calc(-1 * var(--io_borderWidth));\n      background-color: transparent !important;\n      border-color: transparent !important;\n    }\n    :host > io-menu-item[selected] {\n      color: var(--io_colorStrong);\n    }\n    "}constructor(e={}){super(e)}init(){this.$item=new f({value:this.value,mode:"none",options:this.options})}_onSelectedChanged(e){this._disposed||this.inputValue(e.detail.value)}optionsChanged(e){e.oldValue&&e.oldValue.removeEventListener("selected-changed",this._onSelectedChanged),e.value&&e.value.addEventListener("selected-changed",this._onSelectedChanged),this.$item.options=this.options}optionsMutated(){this.changed()}changed(){this.debounce(this.onChange)}onChange(){let e;"value"===this.selectBy?e=this.options.findItemByValue(this.value):"id"===this.selectBy&&(e=this.options.findItemById(this.value)),e&&(e.selected=!0);const t=e?e.label:this.label||String(this.value);this.render([I({item:this.$item,label:t,direction:"down"})])}};__decorate$1([e({value:void 0})],M.prototype,"value",void 0),__decorate$1([e("")],M.prototype,"label",void 0),__decorate$1([e("value")],M.prototype,"selectBy",void 0),__decorate$1([e({type:v,init:null})],M.prototype,"options",void 0),__decorate$1([i("button")],M.prototype,"role",void 0),M=__decorate$1([t],M);const B=M.vConstructor;var __decorate=function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};let L=class IoContextMenu extends s{static vConstructor;static get ReactiveProperties(){return{$options:null}}constructor(e={}){super(e),this.collapse=this.collapse.bind(this),this.$options=new w({expanded:this.bind("expanded"),options:this.bind("options"),$parent:this})}connectedCallback(){super.connectedCallback(),o.appendChild(this.$options),this.parentElement.addEventListener("pointerdown",this.onPointerdown),this.parentElement.addEventListener("click",this.onClick),this.parentElement.addEventListener("contextmenu",this.onContextmenu)}disconnectedCallback(){super.disconnectedCallback(),o.removeChild(this.$options),this.parentElement.removeEventListener("pointerdown",this.onPointerdown),this.parentElement.removeEventListener("click",this.onClick),this.parentElement.removeEventListener("contextmenu",this.onContextmenu)}getBoundingClientRect(){return this.parentElement.getBoundingClientRect()}onContextmenu(e){2===this.button&&e.preventDefault()}onPointerdown(e){e.stopPropagation(),this.$options.style.left=`${e.clientX}px`,this.$options.style.top=`${e.clientY}px`,this.parentElement.addEventListener("pointermove",this.onPointermove),this.parentElement.addEventListener("pointerleave",this.onPointerleave),this.parentElement.addEventListener("pointerup",this.onPointerup),clearTimeout(this._contextTimeout),"touch"!==e.pointerType?e.button===this.button&&(this.setPointerCapture(e.pointerId),this.expanded=!0):(e.preventDefault(),this._contextTimeout=setTimeout((()=>{this.setPointerCapture(e.pointerId),this.expanded=!0}),150)),onOverlayPointerdown.call(this,e)}onPointermove(e){e.stopPropagation(),clearTimeout(this._contextTimeout),("touch"!==e.pointerType||this.expanded)&&onOverlayPointermove.call(this,e)}onPointerup(e){clearTimeout(this._contextTimeout),this.releasePointerCapture(e.pointerId),this.parentElement.removeEventListener("pointermove",this.onPointermove),this.parentElement.removeEventListener("pointerleave",this.onPointerleave),this.parentElement.removeEventListener("pointerup",this.onPointerup),onOverlayPointeup.call(this,e)}onPointerleave(e){this.releasePointerCapture(e.pointerId),this.parentElement.removeEventListener("pointermove",this.onPointermove),this.parentElement.removeEventListener("pointerleave",this.onPointerleave),this.parentElement.removeEventListener("pointerup",this.onPointerup)}collapse(){o.collapse()}};__decorate([e({type:v})],L.prototype,"options",void 0),__decorate([e({value:!1,reflect:!0})],L.prototype,"expanded",void 0),__decorate([e(0)],L.prototype,"button",void 0),L=__decorate([t],L);const D=L.vConstructor;export{L as IoContextMenu,_ as IoMenuHamburger,E as IoMenuItem,w as IoMenuOptions,k as IoMenuTree,R as IoMenuTreeBranch,M as IoOptionSelect,f as MenuItem,v as MenuOptions,D as ioContextMenu,$ as ioMenuHamburger,I as ioMenuItem,O as ioMenuOptions,j as ioMenuTree,S as ioMenuTreeBranch,B as ioOptionSelect,onOverlayPointerdown,onOverlayPointermove,onOverlayPointeup};
