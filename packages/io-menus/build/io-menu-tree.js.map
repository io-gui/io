{"version":3,"file":"io-menu-tree.js","sourceRoot":"","sources":["../src/io-menu-tree.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, Property, VDOMArray, IoStorage as $, genObjectStorageID } from 'io-gui';\nimport { MenuItem } from './models/menu-item.js';\nimport { MenuOptions } from './models/menu-options.js';\nimport { IoMenuItem } from './io-menu-item.js';\n\nexport function addMenuOptions(options: MenuOptions, depth: number, d = 0) {\n  const elements: VDOMArray[] = [];\n  if (d <= depth) for (let i = 0; i < options.length; i++) {\n    const item = options[i];\n    if (item.options?.length) {\n      const collapsableState = $({value: item.selected, storage: 'local', key: genObjectStorageID(item)});\n      if (item.selected === true) collapsableState.value = true;\n      elements.push(['io-collapsable', {\n        label: item.label,\n        icon: item.icon,\n        expanded: collapsableState,\n        elements: [...addMenuOptions(item.options, depth, d + 1)]\n      }]);\n    } else {\n      elements.push(['io-menu-item', {\n        item: item,\n        depth: d\n      }]);\n    }\n  }\n  return elements;\n}\n\nfunction matchItem(item: MenuItem, search: string) {\n  if (item.value !== undefined && String(item.value).toLowerCase().indexOf(search) !== -1) return true;\n  if (item.label && item.label.toLowerCase().indexOf(search) !== -1) return true;\n  if (item.hint && item.hint.toLowerCase().indexOf(search) !== -1) return true;\n  return false;\n}\n\nexport function filterOptions(options: MenuOptions, search: string, depth = 5, elements: VDOMArray[] = [], d = 0): any {\n  search = search.toLowerCase();\n  if (d <= depth) for (let i = 0; i < options.length; i++) {\n    if (matchItem(options[i], search)) {\n      elements.push(['io-menu-item', {\n        item: options[i],\n        depth: 0\n      }]);\n    }\n    if (options[i].options) {\n      filterOptions(options[i].options, search, depth, elements, d + 1);\n    }\n  }\n}\n\n@Register\nexport class IoMenuTree extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex: 0 0 auto;\n      flex-direction: column;\n      flex-wrap: nowrap;\n      align-self: stretch;\n      align-items: stretch;\n      justify-self: stretch;\n      border-radius: var(--io_borderRadius);\n      border: var(--io_border);\n      border-color: var(--io_borderColorOutset);\n      color: var(--io_colorField);\n      background-color: var(--io_bgColorDimmed);\n      padding: var(--io_spacing) 0;\n      align-self: flex-start;\n      user-select: none;\n      transition: opacity 0.25s;\n      overflow: auto;\n    }\n\n    :host io-collapsable {\n      flex: 0 0 auto;\n      border-color: transparent;\n      border: 0;\n      overflow: visible;\n    }\n    :host io-collapsable > div.io-collapsable-content {\n      background-color: transparent;\n      flex: 0 0 auto;\n      border-radius: 0 !important;\n      margin: 0 !important;\n      padding: 0 !important;\n      background: var(--io_bgColorDimmed);\n    }\n    \n    :host io-menu-item:first-of-type {\n      margin-top: var(--io_borderWidth);\n    }\n    :host io-menu-item {\n      background-color: var(--io_bgColorDimmed);\n      flex: 0 0 auto;\n      align-self: stretch;\n      border-radius: 0;\n      margin-left: var(--io_borderWidth);\n      margin-right: var(--io_borderWidth);\n    }\n    :host io-menu-item[depth=\"1\"] {\n      padding-left: calc(var(--io_lineHeight) * 1);\n    }\n    :host io-menu-item[depth=\"2\"] {\n      padding-left: calc(var(--io_lineHeight) * 2);\n    }\n    :host io-menu-item[depth=\"3\"] {\n      padding-left: calc(var(--io_lineHeight) * 3);\n    }\n    :host io-menu-item[depth=\"4\"] {\n      padding-left: calc(var(--io_lineHeight) * 4);\n    }\n    :host io-menu-item[depth=\"5\"] {\n      padding-left: calc(var(--io_lineHeight) * 5);\n    }\n    :host io-menu-item[depth=\"6\"] {\n      padding-left: calc(var(--io_lineHeight) * 6);\n    }\n    /* Item spacing */\n    :host io-menu-item {\n      margin-bottom: var(--io_borderWidth);\n    }\n    :host io-menu-item:first-of-type {\n      /* margin-top: var(--io_spacing); */\n    }\n\n    /* Item dividers */\n    :host io-collapsable > io-boolean {\n      margin: 0;\n      margin-left: var(--io_borderWidth);\n      margin-right: var(--io_borderWidth);\n      z-index: 1;\n      overflow: visible;\n    }\n\n    /* Search field */\n    :host > .search {\n      border-radius: 0;\n      flex: 0 0 auto;\n    }\n    `;\n  }\n\n  @Property({type: MenuOptions, reflect: true})\n  declare options: MenuOptions;\n\n  @Property(false)\n  declare searchable: boolean;\n\n  @Property('')\n  declare search: string;\n\n  @Property(Infinity)\n  declare depth: number;\n\n  @Property({type: Array})\n  declare slotted: VDOMArray[];\n\n  @Property('listbox')\n  declare role: string;\n\n  @Property(undefined)\n  declare $parent?: IoMenuItem;\n\n  static get Listeners() {\n    return {\n      'item-clicked': '_onItemClicked',\n    };\n  }\n\n  _onItemClicked(event: CustomEvent) {\n    const item = event.composedPath()[0] as unknown as IoMenuItem;\n    const d = event.detail as MenuItem;\n   if (item !== this as any) {\n      event.stopImmediatePropagation();\n      this.dispatchEvent('item-clicked', d, true);\n      this.throttle(this._onCollapse);\n    }\n  }\n\n  // TODO: fix UX. This shouldselect search field on collapse by click.\n  _onCollapse() {\n    const focusSearch = this.searchable && this.search;\n    this.search = '';\n    if (focusSearch) this.$.search.focus();\n  }\n\n  changed() {\n    const elements: VDOMArray[] = [...this.slotted];\n\n    // TODO: fix depth.\n\n    if (this.searchable) {\n      elements.push(['io-string', {\n        $: 'search',\n        role: 'search',\n        class: 'search',\n        value: this.bind('search'),\n        placeholder: 'Search',\n        live: true\n      }]);\n    }\n\n    if (this.search) {\n      const len = elements.length;\n      filterOptions(this.options, this.search, this.depth, elements);\n      if (len === elements.length) {\n        elements.push(['io-menu-item', {item: new MenuItem({label: 'No matches', mode: 'none'})}]);\n      }\n    } else {\n      elements.push(...addMenuOptions(this.options, this.depth));\n    }\n\n    this.template(elements);\n  }\n}\n"]}