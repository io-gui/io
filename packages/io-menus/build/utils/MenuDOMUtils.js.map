{"version":3,"file":"MenuDOMUtils.js","sourceRoot":"","sources":["../../src/utils/MenuDOMUtils.ts"],"names":[],"mappings":"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","sourcesContent":["import { IoOverlaySingleton } from 'io-core';\nimport { IoString } from 'io-inputs';\nimport { IoMenuItem } from '../elements/IoMenuItem.js';\nimport { IoMenuOptions } from '../elements/IoMenuOptions.js';\nimport { IoMenuTree } from '../elements/IoMenuTree.js';\n\n// TODO: Fix type remove any!\n\nexport type IoMenuElementType = IoMenuItem | IoMenuOptions | IoMenuTree | IoString;\n\nconst MenuElementTags = ['io-menu-item', 'io-menu-options', 'io-menu-hamburger', 'io-option-select', 'io-string', 'io-menu-tree'];\nconst MenuElementTagsSelector = MenuElementTags.join(', ');\n\nexport function getHoveredMenuItem(event: PointerEvent) {\n  const options = Array.from(IoOverlaySingleton.querySelectorAll('io-menu-item, io-menu-options')) as IoMenuItem[];\n  const hovered: IoMenuElementType[] = [];\n  if (IoOverlaySingleton.expanded) {\n    for (let i = options.length; i--;) {\n      if (isPointerAboveIoMenuItem(event, options[i])) hovered.push(options[i]);\n    }\n  }\n  if (hovered.length) {\n    hovered.sort((a: IoMenuElementType, b: IoMenuElementType) => {\n      if ((a as any).depth > (b as any).depth) return 1;\n      if ((a as any).depth < (b as any).depth) return -1;\n      if (a.localName === 'io-menu-item') return 1;\n      if (b.localName === 'io-menu-item') return -1;\n      return 0;\n    });\n    const first = hovered[0];\n    const second = hovered[1];\n    if (first.localName === 'io-menu-item') {\n      return first;\n    // NOTE: This effectively blocks picking io-menu-item behind io-menu-options.\n    } else if (first.localName === 'io-menu-options' && second) {\n      if (second.localName === 'io-menu-item' && (second as any).depth === (first as any).depth) {\n        return second;\n      }\n    }\n  }\n  return undefined;\n}\n\nexport function getMenuDescendants(element: IoMenuElementType) {\n  const descendants: IoMenuElementType[] = [];\n  if ((element as any).$options) {\n    descendants.push((element as any).$options);\n    const options = (element as any).$options.querySelectorAll(MenuElementTagsSelector);\n    for (let i = options.length; i--;) {\n      descendants.push(options[i]);\n      descendants.push(...getMenuDescendants(options[i]));\n    }\n  } else {\n    const options = Array.from(element.querySelectorAll(MenuElementTagsSelector)) as IoMenuElementType[];\n    for (let i = options.length; i--;) {\n      descendants.push(options[i]);\n      descendants.push(...getMenuDescendants(options[i]));\n    }\n  }\n  return descendants;\n}\n\nexport function getMenuAncestors(element: IoMenuElementType) {\n  const ancestors: IoMenuElementType[] = [];\n  let option = element;\n  while (option && (option as any).$parent) { // && !option.$parent._disposed\n    option = (option as any).$parent;\n    if (option) ancestors.push(option);\n  }\n  return ancestors;\n}\n\nexport function getMenuChildren(element: IoMenuElementType) {\n  const children: IoMenuElementType[] = [];\n  const options = Array.from(element.querySelectorAll(MenuElementTagsSelector)) as IoMenuElementType[];\n  for (let i = options.length; i--;) {\n    children.push(options[i]);\n  }\n  if ((element as any).$options) {\n    children.push((element as any).$options);\n    const options = (element as any).$options.querySelectorAll(MenuElementTagsSelector);\n    for (let i = options.length; i--;) {\n      children.push(options[i]);\n    }\n  }\n  return children;\n}\n\nexport function getMenuSiblings(element: IoMenuItem) {\n  const siblings: IoMenuItem[] = [];\n  const parent = element.parentElement;\n  if (parent) {\n    siblings.push(...Array.from(parent.querySelectorAll(MenuElementTagsSelector)) as IoMenuItem[]);\n  }\n  return siblings;\n}\n\nexport function getMenuRoot(element: IoMenuElementType) {\n  let root: IoMenuElementType = element;\n  while (root && (root as any).$parent) {\n    root = (root as any).$parent;\n  }\n  return root;\n}\n\nexport function isPointerAboveIoMenuItem(event: PointerEvent, element: IoMenuElementType) {\n  if (MenuElementTags.indexOf(element.localName) !== -1) {\n    if (!(element as any).disabled) {\n      if (element.parentElement !== IoOverlaySingleton && (element.parentElement as any)!.expanded) {\n        const r = element.getBoundingClientRect();\n        const x = event.clientX;\n        const y = event.clientY;\n        const hovered = (r.top <= y && r.bottom >= y && r.left <= x && r.right >= x );\n        return hovered;\n      }\n    }\n  }\n  return false;\n}"]}