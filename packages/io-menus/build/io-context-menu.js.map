{"version":3,"file":"io-context-menu.js","sourceRoot":"","sources":["../src/io-context-menu.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, Property, IoOverlaySingleton as Overlay } from 'io-gui';\nimport { MenuOptions } from './models/menu-options.js';\nimport { IoMenuOptions } from './io-menu-options.js';\n\n/**\n * An invisible element that inserts a floating menu when its `parentElement` is clicked. Menu position is set by the pointer by default but it can be configured to expand to the side of the parent element by setting the `position` property. Default `button` property for menu expansion is `0` (left mouse button), but it can be configured for other buttons. You can have multiple `IoContextMenu` instances under the same `parentElement` as long as the `button` properties are different.\n **/\n@Register\nexport class IoContextMenu extends IoElement {\n\n  @Property({type: MenuOptions})\n  declare options: MenuOptions;\n\n  @Property({value: false, reflect: true})\n  declare expanded: boolean;\n\n  @Property(0)\n  declare button: number;\n\n  static get Properties(): any {\n    return {\n      $options: null,\n    };\n  }\n  connectedCallback() {\n    super.connectedCallback();\n    Overlay.addEventListener('pointermove', this._onOverlayPointermove);\n    this._parent = this.parentElement;\n    this._parent.addEventListener('pointerdown', this._onPointerdown);\n    this._parent.addEventListener('click', this._onClick);\n    this._parent.addEventListener('contextmenu', this._onContextmenu);\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this.$options && this.$options.parentElement) Overlay.removeChild(this.$options);\n    Overlay.removeEventListener('pointermove', this._onOverlayPointermove);\n    this._parent.removeEventListener('pointerdown', this._onPointerdown);\n    this._parent.removeEventListener('contextmenu', this._onContextmenu);\n    this._parent.removeEventListener('pointermove', this._onPointermove);\n    this._parent.removeEventListener('pointerup', this._onPointerup);\n    this._parent.removeEventListener('click', this._onClick);\n    delete this._parent;\n  }\n  getBoundingClientRect() {\n    return this._parent.getBoundingClientRect();\n  }\n  _onItemClicked(event: CustomEvent) {\n    const item = event.composedPath()[0] as HTMLElement;\n    const d = event.detail;\n    if (item !== (this as any)) {\n      event.stopImmediatePropagation();\n      this.dispatchEvent('item-clicked', d, true);\n      this.throttle(this._onCollapse);\n    }\n  }\n  _onContextmenu(event: MouseEvent) {\n    if (this.button === 2) event.preventDefault();\n  }\n  _onPointerdown(event: PointerEvent) {\n    Overlay.x = event.clientX;\n    Overlay.y = event.clientY;\n    this._parent.addEventListener('pointermove', this._onPointermove);\n    this._parent.addEventListener('pointerup', this._onPointerup);\n\n    clearTimeout(this._contextTimeout);\n    if (event.pointerType !== 'touch') {\n      if (event.button === this.button) {\n        this.setPointerCapture(event.pointerId);\n        this.expanded = true;\n      }\n    } else {\n      // iOS Safari contextmenu event emulation.\n      event.preventDefault();\n      this._contextTimeout = setTimeout(() => {\n        this.setPointerCapture(event.pointerId);\n        this.expanded = true;\n      }, 150);\n    }\n  }\n  _onPointermove(event: PointerEvent) {\n    clearTimeout(this._contextTimeout);\n    if (this.expanded) {\n      this.$options?.querySelector('io-menu-item')?._onPointermoveAction(event);\n    }\n  }\n  _onPointerup(event: PointerEvent) {\n    clearTimeout(this._contextTimeout);\n    this.releasePointerCapture(event.pointerId);\n    if (this.expanded) {\n      this.$options?.querySelector('io-menu-item')?._onPointerupAction(event, true);\n    }\n    this._parent.removeEventListener('pointermove', this._onPointermove);\n    this._parent.removeEventListener('pointerup', this._onPointerup);\n  }\n  _onOverlayPointermove(event: PointerEvent) {\n    if (this.expanded) this._onPointermove(event);\n  }\n  _onClick(event: MouseEvent) {\n    if (event.button === this.button && event.button !== 2) this.expanded = true;\n  }\n  _onCollapse() {\n    this.expanded = false;\n  }\n  optionsChanged() {\n    if (this.$options) {\n      Overlay.removeChild(this.$options);\n      this.$options.template([]);\n      this.$options.dispose();\n    }\n    this.$options = new IoMenuOptions({\n      expanded: this.bind('expanded'),\n      inlayer: true,\n      options: this.options,\n      direction: 'pointer',\n      $parent: this,\n      '@item-clicked': this._onItemClicked,\n    });\n    Overlay.appendChild(this.$options);\n  }\n  // expandedChanged() {\n  //   if (this.$options && !this.expanded) {\n  //     const descendants = getMenuDescendants(this.$options as unknown as IoMenuItem); // TODO fix\n  //     for (let i = descendants.length; i--;) {\n  //       descendants[i].expanded = false;\n  //     }\n  //   }\n  // }\n}\n"]}