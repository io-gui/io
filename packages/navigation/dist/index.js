import{ReactiveProperty,Property,IoElement,div,Register,span,disposeChildren}from"@io-gui/core";import{ioBoolean}from"@io-gui/inputs";import{MenuOption,ioMenuOptions,ioMenuTree}from"@io-gui/menus";var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$2(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$2(target,key,result),result};let IoCollapsible=class extends IoElement{static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n      flex-shrink: 0;\n      align-self: stretch;\n      box-sizing: content-box;\n      align-items: stretch;\n      align-self: stretch;\n      border: var(--io_border);\n      border-radius: calc(var(--io_borderRadius) - var(--io_spacing));\n      border-color: var(--io_borderColorOutset);\n      min-height: var(--io_fieldHeight);\n      background-color: var(--io_bgColorLight);\n    }\n    :host > io-boolean {\n      flex: 0 0 auto;\n      padding-left: 0;\n      margin: var(--io_spacing) var(--io_spacing2);\n      border-radius: 0;\n      background-color: transparent;\n    }\n    :host > io-boolean:before {\n      text-align: center;\n      width: var(--io_lineHeight);\n      margin-right: var(--io_spacing2);\n      content: "▸"\n    }\n    :host > io-boolean[value]:before {\n      content: "▾"\n    }\n    :host > div.io-collapsible-content {\n      position: relative;\n      display: flex;\n      align-items: flex-start;\n      flex-direction: column;\n      overflow: auto;\n      background-color: var(--io_bgColorStrong);\n    }\n    :host[direction=row] > div.io-collapsible-content {\n      flex-direction: row;\n    }\n    :host > div.io-collapsible-content:not(:empty) {\n      margin: var(--io_spacing);\n      margin-top: 0;\n      padding: var(--io_spacing);\n      border-radius: var(--io_borderRadius);\n    }\n    '}changed(){this.render([ioBoolean({icon:this.icon,true:this.label,false:this.label,value:this.bind("expanded")}),div({class:"io-collapsible-content"},this.expanded?this.elements:[])])}};__decorateClass$2([ReactiveProperty(Array)],IoCollapsible.prototype,"elements",2),__decorateClass$2([ReactiveProperty("")],IoCollapsible.prototype,"label",2),__decorateClass$2([ReactiveProperty({value:"column",reflect:!0})],IoCollapsible.prototype,"direction",2),__decorateClass$2([ReactiveProperty("")],IoCollapsible.prototype,"icon",2),__decorateClass$2([ReactiveProperty({value:!1,reflect:!0})],IoCollapsible.prototype,"expanded",2),__decorateClass$2([Property("region")],IoCollapsible.prototype,"role",2),IoCollapsible=__decorateClass$2([Register],IoCollapsible);const ioCollapsible=function(arg0){return IoCollapsible.vConstructor(arg0)};var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$1(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1(target,key,result),result};const dummyElement=document.createElement("div"),IMPORTED_PATHS={};function importModule(path){const importPath=new URL(path,String(window.location)).pathname;return new Promise(resolve=>{!path||IMPORTED_PATHS[importPath]?resolve(importPath):import(importPath).then(()=>{IMPORTED_PATHS[importPath]=!0,resolve(importPath)})})}let IoSelector=class extends IoElement{static get Style(){return"\n      :host {\n        display: flex;\n        flex-direction: column;\n        position: relative;\n        overflow-y: auto !important;\n        flex: 1 1 auto;\n        justify-content: stretch;\n      }\n      @keyframes io-loading-spinner {\n        to {\n          transform: rotate(360deg);\n        }\n      }\n      :host[loading]:after {\n        content: '';\n        box-sizing: border-box;\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        width: 4em;\n        height: 4em;\n        margin-top: calc(-1 * var(--io_fieldHeight));\n        margin-left: calc(-1 * var(--io_fieldHeight));\n        border-radius: 50%;\n        border: var(--io_border);\n        border-color: var(--io_borderColorStrong);\n        border-top-color: var(--io_colorBlue);\n        animation: io-loading-spinner .6s linear infinite;\n      }\n    "}static get Listeners(){return{scroll:"onScrollChanged"}}constructor(args={}){super(args)}init(){this.preacheNext=this.preacheNext.bind(this),this.startPreache=this.startPreache.bind(this),this.renderDebounced=this.renderDebounced.bind(this),this.anchorChangedDebounced=this.anchorChangedDebounced.bind(this),this.scrollToUnsuspend=this.scrollToUnsuspend.bind(this),this.onScrollUnsuspend=this.onScrollUnsuspend.bind(this)}anchorChanged(){this.scrollToSuspended||(this.onScrollSuspended=!0,this.debounce(this.onScrollUnsuspend,void 0,120)),this.debounce(this.anchorChangedDebounced,void 0,3)}anchorChangedDebounced(){const anchor=this.anchor.split("#")[1]||this.anchor;if(!anchor||this.scrollToSuspended)return;const heading=this.querySelector(`[data-heading="${anchor}"]`);if(heading){const style=window.getComputedStyle(heading),top=heading.offsetTop-parseInt(style.marginTop);this.scrollTo({top:top,behavior:"smooth"})}else this.scrollTo(0,0)}scrollToUnsuspend(){this.scrollToSuspended=!1}onScrollUnsuspend(){this.onScrollSuspended=!1}onScrollChanged(){if(this.onScrollSuspended)return;const anchor=this.anchor.split("#")[1]||this.anchor,headings=this.querySelectorAll("[data-heading]"),closestHeading=Array.from(headings).reduce((prev,curr)=>Math.abs(curr.offsetTop-this.scrollTop)<Math.abs(prev.offsetTop-this.scrollTop)?curr:prev,headings[0]);if(closestHeading){const current=closestHeading.getAttribute("data-heading");current&&current!==anchor&&(this.scrollToSuspended=!0,2===this.anchor.split("#").length?this.anchor=this.anchor.split("#")[0]+"#"+current:this.anchor=current,this.debounce(this.scrollToUnsuspend,void 0,120))}}elementsChanged(){this.startPreache()}selectedChanged(){this.selected?"*"===this.selected?this.render(this.elements):this.renderSelectedId(this.selected):this.render([],this,!0),this.debounce(this.anchorChangedDebounced,void 0,2)}renderSelectedId(id){const cache="proactive"===this.caching||"reactive"===this.caching;if(!id)return this.render([],this,cache),void this.scrollTo(0,0);if((id=id.split("#")[0])===this.childNodes[0]?.id)return;this.render([],this,cache),this.scrollTo(0,0);const vElement=this.elements.find(element=>element.props?.id===id);if(!vElement)return console.warn(`IoSelector: Could not find elements with id: "${id}"!`),void this.render([span(`Could not find elements with id: "${id}"!`)],this,cache);const importPath=vElement.props?.import;importPath?(this.loading=!0,this._preaching=!1,importModule(importPath).then(()=>{this.loading=!1,this.debounce(this.renderDebounced,vElement),this.debounce(this.startPreache)})):this.debounce(this.renderDebounced,vElement)}renderDebounced(vElement){const cache="proactive"===this.caching||"reactive"===this.caching,id=vElement.props?.id,cachedElement=this._caches[id];cache&&cachedElement?cachedElement.parentElement!==this&&(this.firstChild&&this.removeChild(this.firstChild),this.appendChild(cachedElement)):(this.render([vElement],this,cache),cache&&(this._caches[id]=this.childNodes[0]))}startPreache(){"proactive"!==this.caching||this._preaching||(this._preaching=!0,this.debounce(this.preacheNext))}preacheNext(){if(this._preaching){for(let i=0;i<this.elements.length;i++){const vElement=this.elements[i],props=vElement.props,id=props.id;if(id&&void 0===this._caches[id])return props.import?void importModule(props.import).then(()=>{this._preaching&&(this.render([vElement],dummyElement,!0),this._caches[id]=dummyElement.childNodes[0],dummyElement.removeChild(dummyElement.childNodes[0]),this.debounce(this.preacheNext),delete props.import)}):(this.render([vElement],dummyElement,!0),this._caches[id]=dummyElement.childNodes[0],dummyElement.removeChild(dummyElement.childNodes[0]),void this.debounce(this.preacheNext))}this._preaching=!1}}dispose(){for(const key in this._caches)this._caches[key].parentElement||disposeChildren(this._caches[key]),delete this._caches[key];super.dispose()}};__decorateClass$1([ReactiveProperty(Array)],IoSelector.prototype,"elements",2),__decorateClass$1([ReactiveProperty({value:"",type:String})],IoSelector.prototype,"selected",2),__decorateClass$1([ReactiveProperty({value:"",type:String})],IoSelector.prototype,"anchor",2),__decorateClass$1([ReactiveProperty({value:"reactive",type:String})],IoSelector.prototype,"caching",2),__decorateClass$1([ReactiveProperty({value:!1,type:Boolean,reflect:!0})],IoSelector.prototype,"loading",2),__decorateClass$1([Property(Object)],IoSelector.prototype,"_caches",2),__decorateClass$1([Property(!1)],IoSelector.prototype,"_preaching",2),__decorateClass$1([Property(!1)],IoSelector.prototype,"scrollToSuspended",2),__decorateClass$1([Property(!1)],IoSelector.prototype,"onScrollSuspended",2),IoSelector=__decorateClass$1([Register],IoSelector);const ioSelector=function(arg0){return IoSelector.vConstructor(arg0)};var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp(target,key,result),result};let IoNavigator=class extends IoElement{static get Style(){return"\n      :host {\n        display: flex;\n        flex-direction: column;\n        flex: 1 1 auto;\n      }\n      :host[menu=left],\n      :host[menu=right] {\n        flex-direction: row;\n      }\n      :host > io-menu-tree {\n        align-self: stretch;\n        flex: 0 0 auto;\n        min-width: 10em;\n        border: var(--io_border);\n        overflow-y: auto;\n        border-radius: 0;\n      }\n      :host[menu=left] > io-menu-tree {\n        border-width: 0 var(--io_borderWidth) 0 0;\n      }\n      :host[menu=left] > io-menu-tree {\n        border-width: 0 var(--io_borderWidth) 0 0;\n      }\n      :host > io-menu-options {\n        border: none;\n        border-bottom: var(--io_border);\n        border-radius: 0;\n      }\n    "}optionMutated(){this.changed()}changed(){const sharedMenuConfig={option:this.option,widget:this.widget,depth:this.depth};let selected="";"shallow"===this.select&&(selected=this.option.selectedIDImmediate),"deep"===this.select&&(selected=this.option.selectedID),"all"===this.select&&(selected="*"),"none"===this.select&&(selected=""),"top"===this.menu?this.render([ioMenuOptions({horizontal:!0,...sharedMenuConfig}),ioSelector({selected:selected,anchor:this.bind("anchor"),caching:this.caching,elements:this.elements})]):"left"===this.menu?this.render([ioMenuTree({...sharedMenuConfig}),ioSelector({selected:selected,anchor:this.bind("anchor"),caching:this.caching,elements:this.elements})]):"right"===this.menu&&this.render([ioSelector({selected:selected,anchor:this.bind("anchor"),caching:this.caching,elements:this.elements}),ioMenuTree({...sharedMenuConfig})])}};__decorateClass([ReactiveProperty(Array)],IoNavigator.prototype,"elements",2),__decorateClass([ReactiveProperty({type:MenuOption})],IoNavigator.prototype,"option",2),__decorateClass([ReactiveProperty(null)],IoNavigator.prototype,"widget",2),__decorateClass([ReactiveProperty({value:"left",type:String,reflect:!0})],IoNavigator.prototype,"menu",2),__decorateClass([ReactiveProperty({value:Infinity,type:Number})],IoNavigator.prototype,"depth",2),__decorateClass([ReactiveProperty({value:"shallow",type:String})],IoNavigator.prototype,"select",2),__decorateClass([ReactiveProperty({value:"none",type:String})],IoNavigator.prototype,"caching",2),__decorateClass([ReactiveProperty({value:"",type:String})],IoNavigator.prototype,"anchor",2),IoNavigator=__decorateClass([Register],IoNavigator);const ioNavigator=function(arg0){return IoNavigator.vConstructor(arg0)};export{IoCollapsible,IoNavigator,IoSelector,ioCollapsible,ioNavigator,ioSelector};
//# sourceMappingURL=index.js.map
