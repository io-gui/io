import{ReactiveProperty as e,Property as t,IoElement as n,div as o,Register as i,span as r,disposeChildren as s}from"@io-gui/core";import{ioBoolean as h}from"@io-gui/inputs";import{MenuOption as c,ioMenuOptions as l,ioMenuTree as d}from"@io-gui/menus";var a=Object.defineProperty,p=Object.getOwnPropertyDescriptor,u=(e,t,n,o)=>{for(var i,r=o>1?void 0:o?p(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(r=(o?i(t,n,r):i(r))||r);return o&&r&&a(t,n,r),r};let g=class extends n{static get Style(){return'\n    :host {\n      display: flex;\n      flex-direction: column;\n      flex-shrink: 0;\n      align-self: stretch;\n      box-sizing: content-box;\n      align-items: stretch;\n      align-self: stretch;\n      border: var(--io_border);\n      border-radius: calc(var(--io_borderRadius) - var(--io_spacing));\n      border-color: var(--io_borderColorOutset);\n      min-height: var(--io_fieldHeight);\n      background-color: var(--io_bgColorLight);\n    }\n    :host > io-boolean {\n      flex: 0 0 auto;\n      padding-left: 0;\n      margin: var(--io_spacing) var(--io_spacing2);\n      border-radius: 0;\n      background-color: transparent;\n    }\n    :host > io-boolean:before {\n      text-align: center;\n      width: var(--io_lineHeight);\n      margin-right: var(--io_spacing2);\n      content: "▸"\n    }\n    :host > io-boolean[value]:before {\n      content: "▾"\n    }\n    :host > div.io-collapsible-content {\n      position: relative;\n      display: flex;\n      align-items: flex-start;\n      flex-direction: column;\n      overflow: auto;\n      background-color: var(--io_bgColorStrong);\n    }\n    :host[direction=row] > div.io-collapsible-content {\n      flex-direction: row;\n    }\n    :host > div.io-collapsible-content:not(:empty) {\n      margin: var(--io_spacing);\n      margin-top: 0;\n      padding: var(--io_spacing);\n      border-radius: var(--io_borderRadius);\n    }\n    '}changed(){this.render([h({icon:this.icon,true:this.label,false:this.label,value:this.bind("expanded")}),o({class:"io-collapsible-content"},this.expanded?this.elements:[])])}};u([e(Array)],g.prototype,"elements",2),u([e("")],g.prototype,"label",2),u([e({value:"column",reflect:!0})],g.prototype,"direction",2),u([e("")],g.prototype,"icon",2),u([e({value:!1,reflect:!0})],g.prototype,"expanded",2),u([t("region")],g.prototype,"role",2),g=u([i],g);const b=function(e){return g.vConstructor(e)};var f=Object.defineProperty,m=Object.getOwnPropertyDescriptor,v=(e,t,n,o)=>{for(var i,r=o>1?void 0:o?m(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(r=(o?i(t,n,r):i(r))||r);return o&&r&&f(t,n,r),r};const y=document.createElement("div"),_={};function S(e){const t=new URL(e,String(window.location)).pathname;return new Promise(n=>{!e||_[t]?n(t):import(t).then(()=>{_[t]=!0,n(t)})})}let x=class extends n{static get Style(){return"\n      :host {\n        display: flex;\n        flex-direction: column;\n        position: relative;\n        overflow-y: auto !important;\n        flex: 1 1 auto;\n        justify-content: stretch;\n      }\n      @keyframes io-loading-spinner {\n        to {\n          transform: rotate(360deg);\n        }\n      }\n      :host[loading]:after {\n        content: '';\n        box-sizing: border-box;\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        width: 4em;\n        height: 4em;\n        margin-top: calc(-1 * var(--io_fieldHeight));\n        margin-left: calc(-1 * var(--io_fieldHeight));\n        border-radius: 50%;\n        border: var(--io_border);\n        border-color: var(--io_borderColorStrong);\n        border-top-color: var(--io_colorBlue);\n        animation: io-loading-spinner .6s linear infinite;\n      }\n    "}static get Listeners(){return{scroll:"onScrollChanged"}}constructor(e={}){super(e)}init(){this.preacheNext=this.preacheNext.bind(this),this.startPreache=this.startPreache.bind(this),this.renderDebounced=this.renderDebounced.bind(this),this.anchorChangedDebounced=this.anchorChangedDebounced.bind(this),this.scrollToUnsuspend=this.scrollToUnsuspend.bind(this),this.onScrollUnsuspend=this.onScrollUnsuspend.bind(this)}anchorChanged(){this.scrollToSuspended||(this.onScrollSuspended=!0,this.debounce(this.onScrollUnsuspend,void 0,120)),this.debounce(this.anchorChangedDebounced,void 0,3)}anchorChangedDebounced(){const e=this.anchor.split("#")[1]||this.anchor;if(!e||this.scrollToSuspended)return;const t=this.querySelector(`[data-heading="${e}"]`);if(t){const e=window.getComputedStyle(t),n=t.offsetTop-parseInt(e.marginTop);this.scrollTo({top:n,behavior:"smooth"})}else this.scrollTo(0,0)}scrollToUnsuspend(){this.scrollToSuspended=!1}onScrollUnsuspend(){this.onScrollSuspended=!1}onScrollChanged(){if(this.onScrollSuspended)return;const e=this.anchor.split("#")[1]||this.anchor,t=this.querySelectorAll("[data-heading]"),n=Array.from(t).reduce((e,t)=>Math.abs(t.offsetTop-this.scrollTop)<Math.abs(e.offsetTop-this.scrollTop)?t:e,t[0]);if(n){const t=n.getAttribute("data-heading");t&&t!==e&&(this.scrollToSuspended=!0,2===this.anchor.split("#").length?this.anchor=this.anchor.split("#")[0]+"#"+t:this.anchor=t,this.debounce(this.scrollToUnsuspend,void 0,120))}}elementsChanged(){this.startPreache()}selectedChanged(){this.selected?"*"===this.selected?this.render(this.elements):this.renderSelectedId(this.selected):this.render([],this,!0),this.debounce(this.anchorChangedDebounced,void 0,2)}renderSelectedId(e){const t="proactive"===this.caching||"reactive"===this.caching;if(!e)return this.render([],this,t),void this.scrollTo(0,0);if((e=e.split("#")[0])===this.childNodes[0]?.id)return;this.render([],this,t),this.scrollTo(0,0);const n=this.elements.find(t=>t.props?.id===e);if(!n)return console.warn(`IoSelector: Could not find elements with id: "${e}"!`),void this.render([r(`Could not find elements with id: "${e}"!`)],this,t);const o=n.props?.import;o?(this.loading=!0,this._preaching=!1,S(o).then(()=>{this.loading=!1,this.debounce(this.renderDebounced,n),this.debounce(this.startPreache)})):this.debounce(this.renderDebounced,n)}renderDebounced(e){const t="proactive"===this.caching||"reactive"===this.caching,n=e.props?.id,o=this._caches[n];t&&o?o.parentElement!==this&&(this.firstChild&&this.removeChild(this.firstChild),this.appendChild(o)):(this.render([e],this,t),t&&(this._caches[n]=this.childNodes[0]))}startPreache(){"proactive"!==this.caching||this._preaching||(this._preaching=!0,this.debounce(this.preacheNext))}preacheNext(){if(this._preaching){for(let e=0;e<this.elements.length;e++){const t=this.elements[e],n=t.props,o=n.id;if(o&&void 0===this._caches[o])return n.import?void S(n.import).then(()=>{this._preaching&&(this.render([t],y,!0),this._caches[o]=y.childNodes[0],y.removeChild(y.childNodes[0]),this.debounce(this.preacheNext),delete n.import)}):(this.render([t],y,!0),this._caches[o]=y.childNodes[0],y.removeChild(y.childNodes[0]),void this.debounce(this.preacheNext))}this._preaching=!1}}dispose(){for(const e in this._caches)this._caches[e].parentElement||s(this._caches[e]),delete this._caches[e];super.dispose()}};v([e(Array)],x.prototype,"elements",2),v([e({value:"",type:String})],x.prototype,"selected",2),v([e({value:"",type:String})],x.prototype,"anchor",2),v([e({value:"reactive",type:String})],x.prototype,"caching",2),v([e({value:!1,type:Boolean,reflect:!0})],x.prototype,"loading",2),v([t(Object)],x.prototype,"_caches",2),v([t(!1)],x.prototype,"_preaching",2),v([t(!1)],x.prototype,"scrollToSuspended",2),v([t(!1)],x.prototype,"onScrollSuspended",2),x=v([i],x);const w=function(e){return x.vConstructor(e)};var C=Object.defineProperty,T=Object.getOwnPropertyDescriptor,D=(e,t,n,o)=>{for(var i,r=o>1?void 0:o?T(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(r=(o?i(t,n,r):i(r))||r);return o&&r&&C(t,n,r),r};let N=class extends n{static get Style(){return"\n      :host {\n        display: flex;\n        flex-direction: column;\n        flex: 1 1 auto;\n      }\n      :host[menu=left],\n      :host[menu=right] {\n        flex-direction: row;\n      }\n      :host > io-menu-tree {\n        align-self: stretch;\n        flex: 0 0 auto;\n        min-width: 10em;\n        border: var(--io_border);\n        overflow-y: auto;\n        border-radius: 0;\n      }\n      :host[menu=left] > io-menu-tree {\n        border-width: 0 var(--io_borderWidth) 0 0;\n      }\n      :host[menu=left] > io-menu-tree {\n        border-width: 0 var(--io_borderWidth) 0 0;\n      }\n      :host > io-menu-options {\n        border: none;\n        border-bottom: var(--io_border);\n        border-radius: 0;\n      }\n    "}optionMutated(){this.changed()}changed(){const e={option:this.option,widget:this.widget,depth:this.depth};let t="";"shallow"===this.select&&(t=this.option.selectedIDImmediate),"deep"===this.select&&(t=this.option.selectedID),"all"===this.select&&(t="*"),"none"===this.select&&(t=""),"top"===this.menu?this.render([l({horizontal:!0,...e}),w({selected:t,anchor:this.bind("anchor"),caching:this.caching,elements:this.elements})]):"left"===this.menu?this.render([d({...e}),w({selected:t,anchor:this.bind("anchor"),caching:this.caching,elements:this.elements})]):"right"===this.menu&&this.render([w({selected:t,anchor:this.bind("anchor"),caching:this.caching,elements:this.elements}),d({...e})])}};D([e(Array)],N.prototype,"elements",2),D([e({type:c})],N.prototype,"option",2),D([e(null)],N.prototype,"widget",2),D([e({value:"left",type:String,reflect:!0})],N.prototype,"menu",2),D([e({value:1/0,type:Number})],N.prototype,"depth",2),D([e({value:"shallow",type:String})],N.prototype,"select",2),D([e({value:"none",type:String})],N.prototype,"caching",2),D([e({value:"",type:String})],N.prototype,"anchor",2),N=D([i],N);const P=function(e){return N.vConstructor(e)};export{g as IoCollapsible,N as IoNavigator,x as IoSelector,b as ioCollapsible,P as ioNavigator,w as ioSelector};
//# sourceMappingURL=index.js.map
