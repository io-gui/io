{"version":3,"file":"Node.js","sourceRoot":"","sources":["../../src/nodes/Node.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register } from '../decorators/Register.js';\nimport { ProtoChain } from '../core/ProtoChain.js';\nimport { Binding } from '../core/Binding.js';\nimport { ChangeQueue } from '../core/ChangeQueue.js';\nimport { ReactivePropertyInstance, ReactivePropertyDefinitionLoose } from '../core/ReactiveProperty.js';\nimport { EventDispatcher, ListenerDefinitionLoose, AnyEventListener } from '../core/EventDispatcher.js';\nimport { NodeArray } from '../core/NodeArray.js';\nimport { throttle, debounce, CallbackFunction } from '../core/Queue.js';\nimport { ReactiveProperty } from '../decorators/Property.js';\nimport { IoElement } from '../elements/IoElement.js';\n\nexport type AnyConstructor = new (...args: any[]) => unknown;\nexport type ReactivePropertyDefinitions = Record<string, ReactivePropertyDefinitionLoose>;\n\nexport type ListenerDefinitions = {\n  [key: string]: ListenerDefinitionLoose;\n}\nexport interface NodeConstructor {\n  ReactiveProperties?: ReactivePropertyDefinitions;\n  Properties?: Record<string, any>;\n  Listeners?: ListenerDefinitions;\n  Style?: string;\n  name?: string;\n  prototype: NodeConstructor | Object | HTMLElement;\n}\n\nexport const NODES = {\n  active: new Set<Node>(),\n  disposed: new Set<Node>(),\n};\n\nexport type ReactivityType = 'immediate' | 'throttled' | 'debounced';\n\n// Utility type to add Binding to all properties of a type\nexport type WithBinding<T> = T | Binding<T>;\n\ntype prefix<TKey, TPrefix extends string> = TKey extends string ? `${TPrefix}${TKey}` : never;\ntype AnyEventHandler = ((event: CustomEvent<any>) => void) | ((event: PointerEvent) => void) | ((event: KeyboardEvent) => void) | ((event: MouseEvent) => void) | ((event: TouchEvent) => void) | ((event: WheelEvent) => void) | ((event: InputEvent) => void) | ((event: ClipboardEvent) => void) | ((event: DragEvent) => void) | ((event: FocusEvent) => void) | ((event: TransitionEvent) => void) | ((event: AnimationEvent) => void) | ((event: ErrorEvent) => void) | ((event: Event) => void);\n\nexport type NodeProps = {\n  reactivity?: ReactivityType;\n  [key: prefix<string, '@'>]: string | AnyEventHandler;\n};\n\nfunction isNonNodeObject(value: any) {\n  return (typeof value === 'object' && value !== null && !value._isNode);\n}\n\n@Register\nexport class Node extends Object {\n\n  @ReactiveProperty({type: String, value: 'immediate'})\n  declare reactivity: ReactivityType;\n\n  static get ReactiveProperties(): ReactivePropertyDefinitions {\n    return {};\n  }\n\n  static get Properties(): Record<string, any> {\n    return {};\n  }\n\n  static get Listeners(): ListenerDefinitions {\n    return {};\n  }\n\n  declare readonly _protochain: ProtoChain;\n  declare readonly _reactiveProperties: Map<string, ReactivePropertyInstance>;\n  declare readonly _bindings: Map<string, Binding<any>>;\n  declare readonly _changeQueue: ChangeQueue;\n  declare readonly _eventDispatcher: EventDispatcher;\n  declare readonly _observedObjectProperties: string[];\n  declare readonly _observedNodeProperties: string[];\n  declare readonly _parents: Array<Node>;\n  declare readonly _isNode: boolean;\n  declare readonly _isIoElement: boolean;\n  declare _disposed: boolean;\n\n  constructor(args?: any) {\n    super();\n    this._protochain.init(this);\n\n    Object.defineProperty(this, '_changeQueue', {enumerable: false, configurable: true, value: new ChangeQueue(this)});\n    Object.defineProperty(this, '_reactiveProperties', {enumerable: false, configurable: true, value: new Map()});\n    Object.defineProperty(this, '_bindings', {enumerable: false, configurable: true, value: new Map()});\n    Object.defineProperty(this, '_eventDispatcher', {enumerable: false, configurable: true, value: new EventDispatcher(this)});\n    Object.defineProperty(this, '_observedObjectProperties', {enumerable: false, configurable: true, value: []});\n    Object.defineProperty(this, '_observedNodeProperties', {enumerable: false, configurable: true, value: []});\n    Object.defineProperty(this, '_parents', {enumerable: false, configurable: true, value: []});\n\n    this.init();\n\n    initReactiveProperties(this);\n    initProperties(this);\n\n    this.applyProperties(typeof args === 'object' ? args : {}, true);\n\n    NODES.active.add(this);\n\n    this.ready();\n    this.dispatchQueue();\n  }\n  // TODO: add types\n  applyProperties(props: any, skipDispatch = false) {\n    for (const name in props) {\n      if (this._reactiveProperties.has(name)) {\n        this.setProperty(name, props[name], true);\n      } else {\n        if (!name.startsWith('@')) {\n          this[name as keyof this] = props[name];\n          debug: if (props[name] instanceof Binding) {\n            console.warn(`IoElement: Not a ReactiveProperty! Cannot set binding to \"${name}\" property on \"${this.constructor.name}\"`);\n          }\n        }\n      }\n    }\n    this._eventDispatcher.applyPropListeners(props);\n    if (!skipDispatch) this.dispatchQueue();\n  }\n  // TODO: add types\n  setProperties(props: any) {\n    setProperties(this, props);\n  }\n  setProperty(name: string, value: any, debounce = false) {\n    if (this._disposed) return;\n    setProperty(this, name, value, debounce);\n  }\n  init() {}\n  ready() {}\n  changed() {}\n  queue(name: string, value: any, oldValue: any) {\n    this._changeQueue.queue(name, value, oldValue);\n  }\n  dispatchQueue(debounce = false) {\n    dispatchQueue(this, debounce);\n  }\n  throttle(func: CallbackFunction, arg?: any, timeout = 1) {\n    throttle(func, arg, this, timeout);\n  }\n  debounce(func: CallbackFunction, arg?: any, timeout = 1) {\n    debounce(func, arg, this, timeout);\n  }\n  onPropertyMutated(event: CustomEvent) {\n    return onPropertyMutated(this, event);\n  };\n  dispatchMutation(object: Object | Node = this, properties: string[] = []) {\n    if ((object as Node)._isNode || (object as IoElement)._isIoElement) {\n      this.dispatch('io-object-mutation', {object, properties});\n    } else {\n      this.dispatch('io-object-mutation', {object, properties}, false, window);\n    }\n  }\n  bind<T>(name: string): Binding<T> {\n    return bind<T>(this, name);\n  }\n  unbind(name: string): void {\n    unbind(this, name);\n  }\n  addEventListener(type: string, listener: AnyEventListener, options?: AddEventListenerOptions) {\n    this._eventDispatcher.addEventListener(type, listener as EventListener, options);\n  }\n  removeEventListener(type: string, listener?: AnyEventListener, options?: AddEventListenerOptions) {\n    this._eventDispatcher.removeEventListener(type, listener as EventListener, options);\n  }\n  dispatch(type: string, detail: any = undefined, bubbles = false, src?: Node | HTMLElement | Document | Window) {\n    this._eventDispatcher.dispatchEvent(type, detail, bubbles, src);\n  }\n  // TODO: test!\n  addParent(parent: Node) {\n    if (parent._isNode) {\n      this._parents.push(parent);\n    }\n  }\n  removeParent(parent: Node) {\n    if (parent._isNode) {\n      debug: if (!this._parents.includes(parent)) {\n        console.error('Node.removeParent(): Parent not found!', parent);\n      }\n      this._parents.splice(this._parents.indexOf(parent), 1);\n    }\n  }\n  dispose() {\n    dispose(this);\n    NODES.active.delete(this);\n    NODES.disposed.add(this);\n  }\n  Register(ioNodeConstructor: typeof Node) {\n    Object.defineProperty(ioNodeConstructor, '_isNode', {enumerable: false, value: true, writable: false});\n    Object.defineProperty(ioNodeConstructor.prototype, '_isNode', {enumerable: false, value: true, writable: false});\n    Object.defineProperty(ioNodeConstructor, '_isIoElement', {enumerable: false, value: false, writable: false});\n    Object.defineProperty(ioNodeConstructor.prototype, '_isIoElement', {enumerable: false, value: false, writable: false});\n    Object.defineProperty(ioNodeConstructor.prototype, '_protochain', {value: new ProtoChain(ioNodeConstructor)});\n  }\n}\n\nexport function initReactiveProperties(node: Node | IoElement) {\n  for (const name in node._protochain.reactiveProperties) {\n    Object.defineProperty(node, name, {\n      get: function() {\n        return node._reactiveProperties.get(name)!.value;\n      },\n      set: function(value) {\n        node.setProperty(name, value);\n      },\n      configurable: true,\n      enumerable: true,\n    });\n    const property = new ReactivePropertyInstance(node, node._protochain.reactiveProperties[name]);\n    node._reactiveProperties.set(name, property);\n    if (property.binding) property.binding.addTarget(node, name);\n\n    observeObjectProperty(node, name, property);\n    observeNodeProperty(node, name, property);\n\n    if (node instanceof IoElement) {\n      if (property.reflect && property.value !== undefined && property.value !== null) {\n        node.setAttribute(name, property.value);\n      }\n    }\n  }\n}\nexport function initProperties(node: Node | IoElement) {\n  for (const name in node._protochain.properties) {\n    let initialValue = node._protochain.properties[name];\n    if (typeof initialValue === 'function') {\n      initialValue = new initialValue();\n    } else if (initialValue instanceof Array) {\n      initialValue = initialValue.slice();\n    } else if (typeof initialValue === 'object') {\n      initialValue = Object.assign({}, initialValue);\n    }\n    (node as any)[name] = initialValue;\n  }\n}\nexport function setProperties(node: Node | IoElement, props: any) {\n  for (const name in props) {\n    if (!node._reactiveProperties.has(name)) {\n      debug: console.warn(`Property \"${name}\" is not defined`, node);\n      continue;\n    }\n    node.setProperty(name, props[name], true);\n  }\n  node.dispatchQueue();\n}\nexport function setProperty(node: Node | IoElement, name: string, value: any, debounce = false) {\n  const prop = node._reactiveProperties.get(name)!;\n  const oldValue = prop.value;\n\n  if (value !== oldValue) {\n    const binding = (value instanceof Binding) ? value : null;\n    if (binding) {\n      const oldBinding = prop.binding;\n      if (binding !== oldBinding) {\n        if (oldBinding) {\n          oldBinding.removeTarget(node, name);\n        }\n        binding.addTarget(node, name);\n        // NOTE: We return here because binding.setTarget() will trigger execution of setProperty() again.\n        return;\n      } else {\n        // NOTE: This was a remedy for an old bug that might not be relevant anymore.\n        // Whenusing change() > template() > setProperties() to batch-set multiple properties with bindings,\n        // it used to cause all but one of those properties to be reset to original value once parent changed.\n        // This ugly hack fixed the bug by setting binding value from target when binding already exists.\n        // TODO: keep an eye on this and remove if not needed.\n        // binding.value = value = prop.value;\n        return;\n      }\n    }\n\n    observeObjectProperty(node, name, prop);\n\n    // TODO: test!\n    // TODO: Document magic!\n    if (prop.type === NodeArray && value.constructor === Array) {\n      const nodeArray = prop.value as NodeArray<Node>;\n\n      debug: if ((value as Array<any>).some(item => !item._isNode)) {\n        console.error(`Node: Property \"${name}\" should be assigned as an Array of nodes!`, value);\n      }\n      debug: if (nodeArray.constructor !== NodeArray) {\n        console.error(`Node: Property \"${name}\" should be initialized as a NodeArray!`, nodeArray);\n      }\n\n      // TODO: test, benchmark!\n      nodeArray.withInternalOperation(() => {\n        nodeArray.length = 0;\n        nodeArray.push(...value as Array<Node>);\n      });\n      return;\n    }\n\n    prop.value = value;\n\n    // TODO: test!\n    if (value !== oldValue) {\n      let hasNewValueAtOtherProperty = false;\n      let hasOldValueAtOtherProperty = false;\n      node._reactiveProperties.forEach((property, n) => {\n        if (property.value === value && n !== name) hasNewValueAtOtherProperty = true;\n        if (property.value === oldValue && n !== name) hasOldValueAtOtherProperty = true;\n      });\n      if (value?._isNode && !hasNewValueAtOtherProperty) {\n        node._observedNodeProperties.push(name);\n        value.addEventListener('io-object-mutation', node.onPropertyMutated);\n        value.addParent(node);\n      }\n      if (oldValue?._isNode && !hasOldValueAtOtherProperty && !oldValue._disposed) {\n        node._observedNodeProperties.splice(node._observedNodeProperties.indexOf(name), 1);\n        oldValue.removeEventListener('io-object-mutation', node.onPropertyMutated);\n        oldValue.removeParent(node);\n      }\n    }\n\n    debug: {\n      if (prop.type === String) {\n        if (typeof value !== 'string') {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node);\n        }\n      } else if (prop.type === Number) {\n        if (typeof value !== 'number') {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node);\n        }\n      } else if (prop.type === Boolean) {\n        if (typeof value !== 'boolean') {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node);\n        }\n      } else if (prop.type === Array) {\n        if (!(value instanceof Array)) {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node);\n        }\n      } else if (prop.type === Object) {\n        if (value instanceof Array) {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${JSON.stringify(value)}\". Expected type: ${prop.type.name}`, node);\n        }\n      } else if (prop.type === NodeArray) {\n        if (!(value instanceof NodeArray)) {\n          console.error(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node);\n        }\n        if ((value as Array<any>).some(item => !item._isNode)) {\n          console.error(`Wrong type of property \"${name}\". NodeArray items should be nodes!`, value);\n        }\n      } else if (typeof prop.type === 'function') {\n        if (!(value instanceof prop.type)) {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node);\n        }\n      }\n    }\n    if (oldValue !== value) {\n      node.queue(name, value, oldValue);\n      node.dispatchQueue(debounce);\n    }\n  }\n}\nexport function dispatchQueue(node: Node | IoElement, debounce = false) {\n  if (node.reactivity === 'debounced' || debounce || node._changeQueue.dispatching) {\n    node.debounce(node._changeQueue.dispatch);\n  } else if (node.reactivity === 'throttled') {\n    node.throttle(node._changeQueue.dispatch);\n  } else if (node.reactivity === 'immediate') {\n    node._changeQueue.dispatch();\n  }\n  debug: if (['immediate', 'throttled', 'debounced'].indexOf(node.reactivity) === -1) {\n    console.warn(`Node.dispatchQueue(): Invalid reactivity property value: \"${node.reactivity}\". Expected one of: \"immediate\", \"throttled\", \"debounced\".`);\n  }\n}\nexport function onPropertyMutated(node: Node | IoElement, event: CustomEvent) {\n  const object = event.detail.object;\n\n  let hasMutated = false;\n  // TODO: consider situations where node is listening to io-object-mutation events from multiple sources (window and property).\n  // This might cause multiple executions of the same handler.\n  // TODO: consider optimizing. This handler might be called a lot.\n  const properties = [...new Set([...node._observedObjectProperties, ...node._observedNodeProperties])];\n  for (let i = 0; i < properties.length; i++) {\n    const name = properties[i];\n    const value = node._reactiveProperties.get(name)!.value;\n\n    if (value === object) {\n      const handlerName = name + 'Mutated' as keyof Node;\n      if (typeof (node as Node)[handlerName] === 'function') {\n        // node.throttle(node[handlerName] as CallbackFunction, event);\n        (node as any)[handlerName](event); //TODO: Check for regressions.\n      }\n      hasMutated = true;\n    }\n  }\n  return hasMutated;\n}\nexport function observeObjectProperty(node: Node | IoElement, name: string, property: ReactivePropertyInstance) {\n  if (!node._observedObjectProperties.includes(name)) {\n    if(isNonNodeObject(property.value)) {\n      node._observedObjectProperties.push(name);\n      if (node._observedObjectProperties.length === 1) {\n        window.addEventListener('io-object-mutation', node.onPropertyMutated as unknown as EventListener);\n      }\n    }\n  }\n}\n\nexport function observeNodeProperty(node: Node | IoElement, name: string, property: ReactivePropertyInstance) {\n  if (property.value?._isNode) {\n    let hasSameValueAtOtherProperty = false;\n    node._reactiveProperties.forEach((p, n) => {\n      if (p.value === property.value && n !== name) hasSameValueAtOtherProperty = true;\n    });\n    if (!hasSameValueAtOtherProperty) {\n      node._observedNodeProperties.push(name);\n      property.value.addEventListener('io-object-mutation', node.onPropertyMutated);\n    }\n  }\n}\n\nexport function bind<T>(node: Node | IoElement, name: string) {\n  debug: if (!node._reactiveProperties.has(name)) {\n    console.warn(`IoGUI Node: cannot bind to ${name} property. Does not exist!`);\n  }\n  if (!node._bindings.has(name)) {\n    node._bindings.set(name, new Binding<T>(node, name));\n  }\n  return node._bindings.get(name)! as Binding<T>;\n}\nexport function unbind(node: Node | IoElement, name: string) {\n  const binding = node._bindings.get(name);\n  if (binding) {\n    binding.dispose();\n    node._bindings.delete(name);\n  }\n  const property = node._reactiveProperties.get(name);\n  property?.binding?.removeTarget(node, name);\n}\nexport function dispose(node: Node | IoElement) {\n  debug: if (node._disposed) {\n    console.warn('Node.dispose(): Already disposed!', node.constructor.name);\n  }\n\n  if (node._disposed) return;\n\n  node._bindings.forEach((binding, name) => {\n    binding.dispose();\n    node._bindings.delete(name);\n  });\n  delete (node as any)._bindings;\n\n  if (node._observedObjectProperties.length) {\n    window.removeEventListener('io-object-mutation', node.onPropertyMutated as unknown as EventListener);\n    node._observedObjectProperties.length = 0;\n    delete (node as any)._observedObjectProperties;\n  }\n  delete (node as any)._protochain;\n\n  node._changeQueue.dispose();\n  delete (node as any)._changeQueue;\n\n  let removed: Node[] = [];\n  node._reactiveProperties.forEach((property, name) => {\n    property.binding?.removeTarget(node, name);\n    if (property.value?._isNode && !removed.includes(property.value) && !property.value._disposed) {\n      property.value.removeEventListener('io-object-mutation', node.onPropertyMutated);\n      removed.push(property.value);\n    }\n  });\n\n  for (const name in node._protochain.properties) {\n    delete (node as Node)[name as keyof Node];\n  }\n\n  // NOTE: _eventDispatcher.dispose must happen AFTER disposal of bindings!\n  node._eventDispatcher.dispose();\n  delete (node as any)._eventDispatcher;\n  delete (node as any)._reactiveProperties;\n\n  if ((node as any)._parents) {\n    (node as any)._parents.length = 0;\n    delete (node as any)._parents;\n  }\n\n  Object.defineProperty(node, '_disposed', {value: true});\n};"]}