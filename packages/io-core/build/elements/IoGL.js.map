{"version":3,"file":"IoGL.js","sourceRoot":"","sources":["../../src/elements/IoGL.ts"],"names":[],"mappings":";;;;;;;AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,2BAA2B,CAAC;AACrD,OAAO,EAAE,gBAAgB,EAAE,MAAM,2BAA2B,CAAC;AAE7D,OAAO,EAAE,IAAI,EAAkB,MAAM,kBAAkB,CAAC;AACxD,OAAO,EAAE,cAAc,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAC1D,OAAO,EAAE,SAAS,EAAkB,MAAM,gBAAgB,CAAC;AAC3D,OAAO,EAAE,IAAI,EAAE,MAAM,gBAAgB,CAAC;AAEtC,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AAChD,MAAM,EAAE,GAAG,MAAM,CAAC,UAAU,CAAC,OAAO,EAAE,EAAC,SAAS,EAAE,KAAK,EAAE,kBAAkB,EAAE,KAAK,EAAC,CAA0B,CAAC;AAE9G,EAAE,CAAC,YAAY,CAAC,0BAA0B,CAAC,CAAC;AAE5C,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC;AACpB,EAAE,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,EAAE,EAAE,CAAC,mBAAmB,CAAC,CAAC;AACnD,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC;AAE1B,MAAM,YAAY,GAAG,EAAE,CAAC,YAAY,EAAE,CAAC;AACvC,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,YAAY,EAAE,YAAY,CAAC,CAAC;AAC7C,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,YAAY,CAAC,CAAC,CAAC,CAAC,EAAC,CAAC,EAAC,GAAG,EAAC,CAAC,CAAC,EAAC,CAAC,CAAC,EAAC,GAAG,EAAC,CAAC,EAAC,CAAC,CAAC,EAAC,GAAG,EAAC,CAAC,EAAC,CAAC,EAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,WAAW,CAAC,CAAC;AACxG,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;AAErC,MAAM,MAAM,GAAG,EAAE,CAAC,YAAY,EAAE,CAAC;AACjC,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;AACvC,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,YAAY,CAAC,CAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,WAAW,CAAC,CAAC;AACpF,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;AAErC,MAAM,SAAS,GAAG,EAAE,CAAC,YAAY,EAAE,CAAC;AACpC,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,oBAAoB,EAAE,SAAS,CAAC,CAAC;AAClD,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,oBAAoB,EAAE,IAAI,WAAW,CAAC,CAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,WAAW,CAAC,CAAC;AACvF,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,oBAAoB,EAAE,IAAI,CAAC,CAAC;AAE7C,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,oBAAoB,EAAE,SAAS,CAAC,CAAC;AAElD,MAAM,YAAY,GAAG,IAAI,OAAO,EAAE,CAAC;AACnC,IAAI,cAAmC,CAAC;AAGjC,IAAM,IAAI,YAAV,MAAM,IAAK,SAAQ,SAAS;IACjC,MAAM,KAAK,KAAK;QACd,OAAO,SAAS,CAAA;;;;;;;;;;;;;;;;;;KAkBf,CAAC;IACJ,CAAC;IAcD,YAAY,GAAG,KAAK,CAAC;IACrB,OAAO,CAAoB;IAC3B,6BAA6B;IAC7B,IAAI,CAA2B;IAC/B,WAAW,CAAyB;IACpC,OAAO,CAAe;IAEtB,MAAM,KAAK,IAAI;QACb,OAAO,UAAU,CAAA;;;;;;;;YAQT,CAAC;IACX,CAAC;IACD,MAAM,KAAK,OAAO;QAChB,OAAO,UAAU,CAAA;QACb,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,SAAS;QACd,IAAI,CAAC,MAAM;QACX,IAAI,CAAC,SAAS;QACd,IAAI,CAAC,qBAAqB;QAC1B,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,OAAO;QACZ,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,OAAO;KACf,CAAC;IACJ,CAAC;IACD,MAAM,KAAK,IAAI;QACb,OAAO,UAAU,CAAA;;;YAGT,CAAC;IACX,CAAC;IACD,mBAAmB,CAAC,IAAY,EAAE,QAAoC;QACpE,MAAM,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,WAAW,CAAC;QACxC,QAAQ,IAAI,EAAE,CAAC;YACb,KAAK,OAAO;gBACV,OAAO,cAAc,GAAG,IAAI,GAAG,KAAK,CAAC;YACvC,KAAK,MAAM;gBACT,OAAO,gBAAgB,GAAG,IAAI,GAAG,KAAK,CAAC;YACzC,KAAK,KAAK;gBACR,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC;gBAC/C,OAAO,aAAa,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG,GAAG,IAAI,GAAG,KAAK,CAAC;YACpE,KAAK,KAAK;gBACR,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBAC3B,OAAO,eAAe,GAAG,IAAI,GAAG,KAAK,CAAC;YACxC,QAAQ;QACV,CAAC;QACD,OAAO,EAAE,CAAC;IACZ,CAAC;IACD,UAAU;QACR,IAAI,IAAI,GAAG,UAAU,CAAA;;6BAEI,CAAC;QAE1B,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,IAAI,EAAE,EAAE;YACxD,IAAI,IAAI,IAAI,CAAC,mBAAmB,CAAC,KAAK,GAAG,IAAI,EAAE,QAAQ,CAAC,CAAC;QAC3D,CAAC,CAAC,CAAC;QAEH,IAAI,IAAI,IAAI,CAAC;QAEb,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,IAAI,EAAE,EAAE;YAClD,MAAM,IAAI,GAAG,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAChE,IAAI,IAAI,IAAI,CAAC,mBAAmB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QAEH,IAAI,IAAI,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,CAAC;QAE5C,MAAM,UAAU,GAAG,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,aAAa,CAAgB,CAAC;QACpE,EAAE,CAAC,YAAY,CAAC,UAAU,EAAG,IAAI,CAAC,WAA2B,CAAC,IAAI,CAAC,CAAC;QACpE,EAAE,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;QAE7B,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,UAAU,EAAE,EAAE,CAAC,cAAc,CAAC,EAAE,CAAC;YAC1D,MAAM,cAAc,GAAG,EAAE,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC;YACvD,OAAO,CAAC,KAAK,CAAC,uBAAuB,GAAG,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC,CAAC;YACpE,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC/B,CAAC;QAED,MAAM,UAAU,GAAG,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,eAAe,CAAgB,CAAC;QACtE,EAAE,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,GAAI,IAAI,CAAC,WAA2B,CAAC,IAAI,CAAC,CAAC;QAC3E,EAAE,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;QAE7B,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,UAAU,EAAE,EAAE,CAAC,cAAc,CAAC,EAAE,CAAC;YAC1D,MAAM,cAAc,GAAG,EAAE,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC;YACvD,OAAO,CAAC,KAAK,CAAC,wBAAwB,GAAG,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC,CAAC;YACrE,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC/B,CAAC;QAED,MAAM,OAAO,GAAG,EAAE,CAAC,aAAa,EAAkB,CAAC;QACnD,EAAE,CAAC,YAAY,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC;QACrC,EAAE,CAAC,YAAY,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC;QAErC,OAAO,OAAO,CAAC;IACjB,CAAC;IACD,YAAY,OAAuB,EAAE;QACnC,KAAK,CAAC,IAAI,CAAC,CAAC;QAEZ,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAChD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC/B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,EAAE,EAAC,KAAK,EAAE,IAAI,EAAC,CAA6B,CAAC;QAErF,kDAAkD;QAClD,iCAAiC;QACjC,mCAAmC;QAEnC,6BAA6B;QAC7B,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,IAAI,EAAE,EAAE;YACxD,2CAA2C;YAC3C,IAAI,QAAQ,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC;gBAC5B,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;YACrC,CAAC;QACH,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,IAAI,EAAE,EAAE;YAClD,MAAM,KAAK,GAAG,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACjE,IAAI,QAAQ,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC;gBAC5B,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC;YAClD,CAAC;QACH,CAAC,CAAC,CAAC;QAEH,IAAI,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;YACvC,IAAI,CAAC,OAAO,GAAG,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACpD,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;YACjC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QACnD,CAAC;QAED,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAE7B,MAAM,QAAQ,GAAG,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC;QAChE,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,YAAY,EAAE,YAAY,CAAC,CAAC;QAC7C,EAAE,CAAC,mBAAmB,CAAC,QAAQ,EAAE,CAAC,EAAE,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAC3D,EAAE,CAAC,uBAAuB,CAAC,QAAQ,CAAC,CAAC;QAErC,MAAM,EAAE,GAAG,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;QACpD,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;QACvC,EAAE,CAAC,mBAAmB,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACrD,EAAE,CAAC,uBAAuB,CAAC,EAAE,CAAC,CAAC;QAE/B,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IACD,SAAS;QACP,4BAA4B;QAC5B,MAAM,OAAO,GAAG,MAAM,CAAC,gBAAgB,CAAC;QACxC,MAAM,IAAI,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;QAC1C,MAAM,KAAK,GAAG,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;QAC5C,MAAM,EAAE,GAAG,QAAQ,CAAC,KAAK,CAAC,gBAAgB,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC;QAC9E,MAAM,EAAE,GAAG,QAAQ,CAAC,KAAK,CAAC,cAAc,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;QAE9E,yBAAyB;QACzB,MAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC,CAAC,CAAC;QACvD,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC,CAAC,CAAC;QAEzD,MAAM,UAAU,GAAG,CAAC,KAAK,KAAK,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,MAAM,KAAK,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,OAAO,KAAK,IAAI,CAAC,OAAO,CAAC,CAAC;QAEnG,IAAI,UAAU,EAAE,CAAC;YACf,kFAAkF;YAClF,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;YACpD,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;YACtD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;YAEzB,IAAI,CAAC,aAAa,CAAC;gBACjB,IAAI,EAAE,CAAC,KAAK,EAAE,MAAM,CAAC;gBACrB,OAAO,EAAE,OAAO;aACjB,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IACD,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,IAAI,CAAC;IACnB,CAAC;IACD,YAAY;QACV,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC/B,CAAC;IACD,OAAO;QACL,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC/B,CAAC;IACD,QAAQ;QACN,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC;QACtD,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC;QAEvD,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM;YAAE,OAAO;QAE9B,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAExB,yCAAyC;QACzC,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,IAAI,EAAE,EAAE;YAClD,MAAM,KAAK,GAAG,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACjE,IAAI,CAAC,qBAAqB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;QAEH,IAAI,IAAI,CAAC,YAAY,EAAE,CAAC;YACtB,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,KAAK,CAAC;YAC3B,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC;YAC7B,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;QAC5B,CAAC;QAED,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;QACrB,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC;QACvB,EAAE,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;QAEjC,EAAE,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAC1B,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,CAAC,CAAC;QAC9B,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;QAEzC,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;QAEvD,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAElC,yEAAyE;IAC3E,CAAC;IACD,gBAAgB;QACd,IAAI,cAAc,KAAK,IAAI,CAAC,OAAO,EAAE,CAAC;YACpC,cAAc,GAAG,IAAI,CAAC,OAAO,CAAC;YAC9B,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC9B,CAAC;IACH,CAAC;IACD,qBAAqB,CAAC,IAAY,EAAE,QAAkC;QACpE,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,QAAQ,CAAC,KAAK,CAAC,CAAC;IACxC,CAAC;IACD,mBAAmB;QACjB,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,IAAI,EAAE,EAAE;YACxD,IAAI,CAAC,qBAAqB,CAAC,KAAK,GAAG,IAAI,EAAE,QAAQ,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACL,CAAC;IACD,UAAU,CAAC,IAAY,EAAE,KAAU;QACjC,MAAM,OAAO,GAAG,EAAE,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;QAC1D,IAAI,OAAO,KAAK,IAAI;YAAE,OAAO;QAC7B,IAAI,IAAI,GAAW,OAAO,KAAK,CAAC;QAChC,IAAI,KAAK,YAAY,KAAK;YAAE,IAAI,GAAG,OAAO,CAAC;QAC3C,IAAI,EAAE,CAAC;QACP,QAAQ,IAAI,EAAE,CAAC;YACb,KAAK,SAAS;gBACZ,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACrC,MAAM;YACR,KAAK,QAAQ;gBACX,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,IAAI,CAAC,CAAC,CAAC;gBAClC,MAAM;YACR,KAAK,QAAQ,CAAC;YACd,KAAK,OAAO;gBACV,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAClB,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,CAAC;oBAC9B,IAAI,KAAK,CAAC,CAAC,KAAK,SAAS;wBAAE,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;yBAChD,IAAI,KAAK,CAAC,CAAC,KAAK,SAAS;wBAAE,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;yBACrD,IAAI,KAAK,CAAC,CAAC,KAAK,SAAS;wBAAE,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;yBACrD,IAAI,KAAK,CAAC,CAAC,KAAK,SAAS;wBAAE,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;gBAC5D,CAAC;gBACD,QAAQ,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC;oBAC/B,KAAK,CAAC;wBACJ,IAAI,KAAK,KAAK,SAAS,EAAE,CAAC;4BACxB,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;4BAC5B,MAAM;wBACR,CAAC;wBACD,EAAE,CAAC,SAAS,CAAC,OAAO,EAChB,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EACjB,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;wBACvB,MAAM;oBACR,KAAK,CAAC;wBACJ,IAAI,KAAK,KAAK,SAAS,EAAE,CAAC;4BACxB,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;4BAC/B,MAAM;wBACR,CAAC;wBACD,EAAE,CAAC,SAAS,CAAC,OAAO,EAChB,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EACjB,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EACjB,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;wBACvB,MAAM;oBACR,KAAK,CAAC;wBACJ,IAAI,KAAK,KAAK,SAAS,EAAE,CAAC;4BACxB,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;4BAClC,MAAM;wBACR,CAAC;wBACD,EAAE,CAAC,SAAS,CAAC,OAAO,EAChB,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EACjB,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EACjB,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EACjB,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;wBACnB,MAAM;oBACZ,QAAQ;gBACV,CAAC;gBACD,MAAM;YACR,QAAQ;QACV,CAAC;IACH,CAAC;IACD,QAAQ,CAAC,iBAAmC;QAC1C,KAAK,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC;QAClC,IAAI,QAAQ,GAAG,EAAE,CAAC;QAClB,MAAM,YAAY,GAAG,iBAAiB,CAAC,SAAS,CAAC,WAAW,CAAC,YAAY,CAAC;QAC1E,KAAK,IAAI,CAAC,GAAG,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,GAAG,CAAC;YACvC,MAAM,WAAW,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;YACpC,MAAM,WAAW,GAAG,MAAM,CAAC,wBAAwB,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;YAC5E,IAAI,WAAW,IAAI,WAAW,CAAC,GAAG,EAAE,CAAC;gBACnC,QAAQ,IAAK,WAA2B,CAAC,OAAO,CAAC;YACnD,CAAC;QACH,CAAC;QACD,MAAM,CAAC,cAAc,CAAC,iBAAiB,CAAC,SAAS,EAAE,UAAU,EAAE,EAAC,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAC,CAAC,CAAC;IACvG,CAAC;CACF,CAAA;AA7TS;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,cAAc,EAAC,CAAC;mCACjB;AAG7B;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAC,CAAC;kCACf;AAGvB;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAC,CAAC;qCACnB;AAGhB;IADP,gBAAgB,CAAC,WAAW,CAAC;wCACK;AAjCxB,IAAI;IADhB,QAAQ;GACI,IAAI,CAqVhB","sourcesContent":["import { Register } from '../decorators/Register.js';\nimport { ReactiveProperty } from '../decorators/Property.js';\nimport { ReactivePropertyInstance, ReactivePropertyDefinition } from '../core/ReactiveProperty.js';\nimport { Node, ReactivityType } from '../nodes/Node.js';\nimport { ThemeSingleton, Color } from '../nodes/Theme.js';\nimport { IoElement, IoElementProps } from './IoElement.js';\nimport { glsl } from './IoGL.glsl.js';\n\nconst canvas = document.createElement('canvas');\nconst gl = canvas.getContext('webgl', {antialias: false, premultipliedAlpha: false}) as WebGLRenderingContext;\n\ngl.getExtension('OES_standard_derivatives');\n\ngl.enable(gl.BLEND);\ngl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\ngl.disable(gl.DEPTH_TEST);\n\nconst positionBuff = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, positionBuff);\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,1,0.0,-1,-1,0.0,1,-1,0.0,1,1,0.0]), gl.STATIC_DRAW);\ngl.bindBuffer(gl.ARRAY_BUFFER, null);\n\nconst uvBuff = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, uvBuff);\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0,1,0,0,1,0,1,1]), gl.STATIC_DRAW);\ngl.bindBuffer(gl.ARRAY_BUFFER, null);\n\nconst indexBuff = gl.createBuffer();\ngl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuff);\ngl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array([3,2,1,3,1,0]), gl.STATIC_DRAW);\ngl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\ngl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuff);\n\nconst shadersCache = new WeakMap();\nlet currentProgram: WebGLProgram | null;\n\n@Register\nexport class IoGl extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        position: relative;\n        overflow: hidden !important;\n        @apply --unselectable;\n      }\n      :host > canvas {\n        position: absolute;\n        pointer-events: none;\n        image-rendering: pixelated;\n      }\n      :host > span {\n        position: absolute;\n        text-shadow: 0 0 3px var(--io_bgColorStrong), 0 0 3px var(--io_bgColorStrong), 0 0 3px var(--io_bgColorStrong);\n        left: 3px;\n        pointer-events: none;\n        color: var(--io_colorStrong);\n      }\n    `;\n  }\n\n  @ReactiveProperty({type: Node, value: ThemeSingleton})\n  declare theme: typeof ThemeSingleton;\n\n  @ReactiveProperty({type: Array, init: [0, 0]})\n  declare size: [number, number];\n\n  @ReactiveProperty({type: Number, value: 1})\n  declare pxRatio: number;\n\n  @ReactiveProperty('throttled')\n  declare reactivity: ReactivityType;\n\n  #needsResize = false;\n  #canvas: HTMLCanvasElement;\n  // #counter: HTMLSpanElement;\n  #ctx: CanvasRenderingContext2D;\n  #vecLengths: Record<string, number>;\n  #shader: WebGLProgram;\n\n  static get Vert() {\n    return /* glsl */`\n      attribute vec3 position;\n      attribute vec2 uv;\n      varying vec2 vUv;\n\n      void main(void) {\n        vUv = uv;\n        gl_Position = vec4(position, 1.0);\n      }\\n\\n`;\n  }\n  static get GlUtils() {\n    return /* glsl */`\n      ${glsl.saturate}\n      ${glsl.translate}\n      ${glsl.circle}\n      ${glsl.rectangle}\n      ${glsl.paintDerivativeGrid2D}\n      ${glsl.lineVertical}\n      ${glsl.lineHorizontal}\n      ${glsl.lineCross2d}\n      ${glsl.checker}\n      ${glsl.checkerX}\n      ${glsl.checkerY}\n      ${glsl.compose}\n    `;\n  }\n  static get Frag() {\n    return /* glsl */`\n      void main(void) {\n        gl_FragColor = io_color;\n      }\\n\\n`;\n  }\n  initPropertyUniform(name: string, property: ReactivePropertyDefinition) {\n    const type = property.value.constructor;\n    switch (type) {\n      case Boolean:\n        return 'uniform int ' + name + ';\\n';\n      case Number:\n        return 'uniform float ' + name + ';\\n';\n      case Array:\n        this.#vecLengths[name] = property.value.length;\n        return 'uniform vec' + property.value.length + ' ' + name + ';\\n';\n      case Color:\n        this.#vecLengths[name] = 4;\n        return 'uniform vec4 ' + name + ';\\n';\n      default:\n    }\n    return '';\n  }\n  initShader() {\n    let frag = /* glsl */`\n    #extension GL_OES_standard_derivatives : enable\n    precision highp float;\\n`;\n\n    this.theme._reactiveProperties.forEach((property, name) => {\n      frag += this.initPropertyUniform('io_' + name, property);\n    });\n\n    frag += '\\n';\n\n    this._reactiveProperties.forEach((property, prop) => {\n      const name = 'u' + prop.charAt(0).toUpperCase() + prop.slice(1);\n      frag += this.initPropertyUniform(name, property);\n    });\n\n    frag += this.constructor.prototype._glUtils;\n\n    const vertShader = gl.createShader(gl.VERTEX_SHADER) as WebGLShader;\n    gl.shaderSource(vertShader, (this.constructor as typeof IoGl).Vert);\n    gl.compileShader(vertShader);\n\n    if (!gl.getShaderParameter(vertShader, gl.COMPILE_STATUS)) {\n      const compilationLog = gl.getShaderInfoLog(vertShader);\n      console.error('IoGl [Vertex Shader] ' + this.localName + ' error:');\n      console.warn(compilationLog);\n    }\n\n    const fragShader = gl.createShader(gl.FRAGMENT_SHADER) as WebGLShader;\n    gl.shaderSource(fragShader, frag + (this.constructor as typeof IoGl).Frag);\n    gl.compileShader(fragShader);\n\n    if (!gl.getShaderParameter(fragShader, gl.COMPILE_STATUS)) {\n      const compilationLog = gl.getShaderInfoLog(fragShader);\n      console.error('IoGl [Frament Shader] ' + this.localName + ' error:');\n      console.warn(compilationLog);\n    }\n\n    const program = gl.createProgram() as WebGLProgram;\n    gl.attachShader(program, vertShader);\n    gl.attachShader(program, fragShader);\n\n    return program;\n  }\n  constructor(args: IoElementProps = {}) {\n    super(args);\n\n    this.#canvas = document.createElement('canvas');\n    this.appendChild(this.#canvas);\n    this.#ctx = this.#canvas.getContext('2d', {alpha: true}) as CanvasRenderingContext2D;\n\n    // this.#counter = document.createElement('span');\n    // this.#counter.innerText = '0';\n    // this.appendChild(this.#counter);\n\n    // TODO: improve code clarity\n    this.#vecLengths = {};\n    this.theme._reactiveProperties.forEach((property, name) => {\n      // TODO: consider making more type agnostic\n      if (property.type === Color) {\n        this.#vecLengths['io_' + name] = 4;\n      }\n    });\n\n    this._reactiveProperties.forEach((property, name) => {\n      const uname = 'u' + name.charAt(0).toUpperCase() + name.slice(1);\n      if (property.type === Array) {\n        this.#vecLengths[uname] = property.value.length;\n      }\n    });\n\n    if (shadersCache.has(this.constructor)) {\n      this.#shader = shadersCache.get(this.constructor);\n    } else {\n      this.#shader = this.initShader();\n      shadersCache.set(this.constructor, this.#shader);\n    }\n\n    gl.linkProgram(this.#shader);\n\n    const position = gl.getAttribLocation(this.#shader, 'position');\n    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuff);\n    gl.vertexAttribPointer(position, 3, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(position);\n\n    const uv = gl.getAttribLocation(this.#shader, 'uv');\n    gl.bindBuffer(gl.ARRAY_BUFFER, uvBuff);\n    gl.vertexAttribPointer(uv, 2, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(uv);\n\n    this.updateThemeUniforms();\n  }\n  onResized() {\n    // TODO: consider optimizing\n    const pxRatio = window.devicePixelRatio;\n    const rect = this.getBoundingClientRect();\n    const style = window.getComputedStyle(this);\n    const bw = parseInt(style.borderRightWidth) + parseInt(style.borderLeftWidth);\n    const bh = parseInt(style.borderTopWidth) + parseInt(style.borderBottomWidth);\n\n    // TODO: confirm and test\n    const width = Math.max(0, Math.floor(rect.width - bw));\n    const height = Math.max(0, Math.floor(rect.height - bh));\n\n    const hasResized = (width !== this.size[0] || height !== this.size[1] || pxRatio !== this.pxRatio);\n\n    if (hasResized) {\n      // NOTE: Resizing only in inline CSS. Buffer resize postponed until `onRender()`.`\n      this.#canvas.style.width = Math.floor(width) + 'px';\n      this.#canvas.style.height = Math.floor(height) + 'px';\n      this.#needsResize = true;\n\n      this.setProperties({\n        size: [width, height],\n        pxRatio: pxRatio,\n      });\n    }\n  }\n  get ctx() {\n    return this.#ctx;\n  }\n  themeMutated() {\n    this.updateThemeUniforms();\n    this.throttle(this.onRender);\n  }\n  changed() {\n    this.throttle(this.onRender);\n  }\n  onRender() {\n    const width = Math.floor(this.size[0] * this.pxRatio);\n    const height = Math.floor(this.size[1] * this.pxRatio);\n\n    if (!width || !height) return;\n\n    this.setShaderProgram();\n\n    // TODO: dont brute-force uniform update.\n    this._reactiveProperties.forEach((property, name) => {\n      const uname = 'u' + name.charAt(0).toUpperCase() + name.slice(1);\n      this.updatePropertyUniform(uname, property);\n    });\n\n    if (this.#needsResize) {\n      this.#canvas.width = width;\n      this.#canvas.height = height;\n      this.#needsResize = false;\n    }\n\n    canvas.width = width;\n    canvas.height = height;\n    gl.viewport(0, 0, width, height);\n\n    gl.clearColor(0, 0, 0, 0);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    this.#ctx.clearRect(0, 0, width, height);\n\n    gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\n\n    this.#ctx.drawImage(canvas, 0, 0);\n\n    // this.#counter.innerText = String(Number(this.#counter.innerText) + 1);\n  }\n  setShaderProgram() {\n    if (currentProgram !== this.#shader) {\n      currentProgram = this.#shader;\n      gl.useProgram(this.#shader);\n    }\n  }\n  updatePropertyUniform(name: string, property: ReactivePropertyInstance) {\n    this.setShaderProgram();\n    this.setUniform(name, property.value);\n  }\n  updateThemeUniforms() {\n    this.theme._reactiveProperties.forEach((property, name) => {\n      this.updatePropertyUniform('io_' + name, property);\n    });\n  }\n  setUniform(name: string, value: any) {\n    const uniform = gl.getUniformLocation(this.#shader, name);\n    if (uniform === null) return;\n    let type: string = typeof value;\n    if (value instanceof Array) type = 'array';\n    let _c;\n    switch (type) {\n      case 'boolean':\n        gl.uniform1i(uniform, value ? 1 : 0);\n        break;\n      case 'number':\n        gl.uniform1f(uniform, value ?? 1);\n        break;\n      case 'object':\n      case 'array':\n        _c = [0, 1, 2, 3];\n        if (typeof value === 'object') {\n          if (value.x !== undefined) _c = ['x', 'y', 'z', 'w'];\n          else if (value.r !== undefined) _c = ['r', 'g', 'b', 'a'];\n          else if (value.h !== undefined) _c = ['h', 's', 'v', 'a'];\n          else if (value.c !== undefined) _c = ['c', 'm', 'y', 'k'];\n        }\n        switch (this.#vecLengths[name]) {\n          case 2:\n            if (value === undefined) {\n              gl.uniform2f(uniform, 0, 0);\n              break;\n            }\n            gl.uniform2f(uniform,\n                value[_c[0]] ?? 1,\n                value[_c[1]] ?? 1);\n            break;\n          case 3:\n            if (value === undefined) {\n              gl.uniform3f(uniform, 0, 0, 0);\n              break;\n            }\n            gl.uniform3f(uniform,\n                value[_c[0]] ?? 1,\n                value[_c[1]] ?? 1,\n                value[_c[2]] ?? 1);\n            break;\n          case 4:\n            if (value === undefined) {\n              gl.uniform4f(uniform, 0, 0, 0, 0);\n              break;\n            }\n            gl.uniform4f(uniform,\n                value[_c[0]] ?? 1,\n                value[_c[1]] ?? 1,\n                value[_c[2]] ?? 1,\n                value[_c[3]] ?? 1);\n                break;\n          default:\n        }\n        break;\n      default:\n    }\n  }\n  Register(ioNodeConstructor: typeof IoElement) {\n    super.Register(ioNodeConstructor);\n    let _glUtils = '';\n    const constructors = ioNodeConstructor.prototype._protochain.constructors;\n    for (let i = constructors.length; i--;) {\n      const constructor = constructors[i];\n      const glUtilsProp = Object.getOwnPropertyDescriptor(constructor, 'GlUtils');\n      if (glUtilsProp && glUtilsProp.get) {\n        _glUtils += (constructor as typeof IoGl).GlUtils;\n      }\n    }\n    Object.defineProperty(ioNodeConstructor.prototype, '_glUtils', {enumerable: false, value: _glUtils});\n  }\n}"]}