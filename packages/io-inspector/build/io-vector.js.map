{"version":3,"file":"io-vector.js","sourceRoot":"","sources":["../src/io-vector.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, Property } from 'io-gui';\n\n/**\n * Input element for vector arrays and objects.\n *\n * <io-element-demo element=\"io-vector\" properties='{\"value\": {\"x\": 1, \"y\": 0.5}, \"linkable\": false}'></io-element-demo>\n *\n * <io-element-demo element=\"io-vector\" properties='{\"value\": [0, 0.5, 1], \"linkable\": true}'></io-element-demo>\n **/\n@Register\nexport class IoVector extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex: 0 1 auto;\n        min-width: var(--io_fieldHeight5);\n        width: var(--io_fieldHeight8);\n      }\n      :host > io-number {\n        flex: 1 1 100%;\n      }\n      :host > *:not(:last-child) {\n        margin-right: var(--io_spacing);\n      }\n      :host > io-boolicon {\n        flex-shrink: 0;\n        padding: var(--io_spacing);\n      }\n    `;\n  }\n\n  @Property({})\n  declare value: {x: number, y: number, z?: number, w?: number} | number[];\n\n  @Property(1)\n  declare conversion: number;\n\n  @Property(0.001)\n  declare step: number;\n\n  @Property(-Infinity)\n  declare min: number;\n\n  @Property(Infinity)\n  declare max: number;\n\n  @Property(false)\n  declare linkable: boolean;\n\n  @Property(false)\n  declare linked: boolean;\n\n  @Property(true)\n  declare ladder: boolean;\n\n  // TODO: make non-reactive\n  @Property({})\n  declare keys: string[];\n\n  private _ratios: Record<string, number> = {};\n\n  _onNumberPointerDown(event: PointerEvent) {\n    const item = event.composedPath()[0] as HTMLElement;\n    const id = item.id as keyof typeof this.value;\n    this._ratios = {};\n    if (this.linked && this.value[id] !== 0) {\n      for (const k of this.keys as [keyof typeof this.value]) this._ratios[k] = this.value[k] / this.value[id];\n    }\n  }\n\n  _onNumberValueInput(event: CustomEvent) {\n    const item = event.composedPath()[0] as HTMLElement;\n    const id = item.id as keyof typeof this.value;\n    const newValue = event.detail.value;\n    const oldValue = event.detail.oldValue;\n    const value = this.value as any;\n    value[id] = newValue;\n\n    if (this.linked) {\n      for (const k of this.keys) {\n        if (k !== id && this._ratios[k]) value[k] = value[id] * this._ratios[k];\n      }\n    }\n    const detail = this.linked ? {object: this.value} : {object: this.value, property: id, value: value, oldValue: oldValue};\n    this.dispatchEvent('object-mutated', detail, false, window);\n  }\n\n  valueChanged() {\n    this.keys = Object.keys(this.value).filter(key => typeof (this.value as any)[key] === 'number') as Array<keyof typeof this.value>;\n    debug: if (this.keys.find(k => ['0', '1', '2', '3', 'x', 'y', 'z', 'w', 'r', 'g', 'b', 'a', 'u', 'v'].indexOf(k) === -1)) {\n      console.warn('IoVector: Unrecognized vector type!');\n    }\n  }\n  changed() {\n    const elements = [];\n    for (const k of this.keys as [keyof typeof this.value]) {\n      if (this.value[k] !== undefined) {\n        elements.push(['io-number', {\n          id: k, // Consider removing global id collisions\n          value: this.value[k],\n          conversion: this.conversion,\n          step: this.step,\n          min: this.min,\n          max: this.max,\n          ladder: this.ladder,\n          '@pointerdown': this._onNumberPointerDown,\n          '@value-input': this._onNumberValueInput,\n        }]);\n      }\n    }\n    elements.push(this.getSlotted());\n    this.template(elements);\n  }\n  getSlotted(): Array<any> | null {\n    return this.linkable ? ['io-boolicon', {value: this.bind('linked'), true: 'vectors:link', false: 'vectors:unlink'}] : null;\n  }\n}\n"]}