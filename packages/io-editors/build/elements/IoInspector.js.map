{"version":3,"file":"IoInspector.js","sourceRoot":"","sources":["../../src/elements/IoInspector.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, ReactiveProperty, IoElementProps, WithBinding, span } from 'io-core';\nimport { ioBreadcrumbs } from './IoBreadcrumbs.js';\nimport { ioPropertyEditor } from './IoPropertyEditor.js';\nimport { EditorConfig } from '../utils/EditorConfig.js';\nimport { EditorGroups, getAllPropertyNames } from '../utils/EditorGroups.js';\nimport { EditorWidgets } from '../utils/EditorWidgets.js';\nimport { ioPropertyLink } from './IoPropertyLink.js';\n\nexport type IoInspectorProps = IoElementProps & {\n  value?: Record<string, any> | any[],\n  selected?: WithBinding<Record<string, any> | any[]>,\n  search?: WithBinding<string>,\n  config?: EditorConfig,\n  groups?: EditorGroups,\n  widgets?: EditorWidgets,\n};\n\nfunction isNestedObject(value: Object, selected: Object): boolean {\n  if (value === selected) return true;\n  if (value instanceof Array) {\n    return value.some(v => isNestedObject(v, selected));\n  }\n  if (value instanceof Object) {\n    return Object.keys(value).some(k => isNestedObject(value[k as keyof typeof value], selected));\n  }\n  return false;\n}\n\n/**\n * Object property editor. It displays a set of labeled property editors for the `value` object inside multiple `io-collapsible` elements. It can be configured to use custom property editors and display only specified properties. Properties of type `Object` are displayed as clickable links which can also be navigated in the `io-breadcrumbs` element.\n **/\n@Register\nexport class IoInspector extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-items: stretch;\n      flex: 0 1 calc(var(--io_lineHeight) * 17.5);\n      padding: var(--io_spacing);\n      background-color: var(--io_bgColor);\n      border-radius: calc(var(--io_borderRadius) + var(--io_spacing));\n    }\n    :host > io-breadcrumbs {\n      margin: 0 var(--io_spacing);\n      z-index: 1;\n    }\n    :host > span {\n      padding: var(--io_spacing) var(--io_spacing3);\n      color: var(--io_colorStrong);\n    }\n    :host io-property-editor > .row > span {\n      min-width: 6em;\n      text-align: right;\n    }\n    `;\n  }\n  @ReactiveProperty()\n  declare value: Object | Array<any>;\n\n  @ReactiveProperty()\n  declare selected: Object | Array<any>;\n\n  @ReactiveProperty({type: String})\n  declare search: string;\n\n  @ReactiveProperty({type: Map, init: null})\n  declare config: EditorConfig;\n\n  @ReactiveProperty({type: Map, init: null})\n  declare groups: EditorGroups;\n\n  @ReactiveProperty({type: Map, init: null})\n  declare widgets: EditorWidgets;\n\n  static get Listeners() {\n    return {\n      'io-button-clicked': 'onLinkClicked',\n    };\n  }\n  init() {\n    this.changeThrottled = this.changeThrottled.bind(this);\n    this._observedObjectProperties.push('value', 'selected');\n    window.addEventListener('io-object-mutation', this.onPropertyMutated as unknown as EventListener);\n  }\n  onLinkClicked(event: CustomEvent) {\n    event.stopPropagation();\n    const value = event.detail.value;\n    const item = event.composedPath()[0] as any;\n    if (value && typeof value === 'object') {\n      if (item.localName === 'io-property-link' || item.className === 'back-button') {\n        this.setProperty('selected', value);\n      }\n    }\n  }\n  valueChanged() {\n    this.selected = this.value;\n  }\n  valueMutated() {\n    // TODO: Improve this check to update selected to new object if it replaced the previously selected.\n    if (!isNestedObject(this.value, this.selected)) {\n      this.selected = this.value;\n    }\n    this.changed();\n  }\n  selectedMutated() {\n    this.changed();\n  }\n  selectedChanged() {\n    this.search = '';\n  }\n  changed() {\n    this.throttle(this.changeThrottled, undefined, 1);\n  }\n  changeThrottled() {\n    const vChildren = [\n      ioBreadcrumbs({value: this.value, selected: this.bind('selected'), search: this.bind('search')}),\n    ];\n\n    const config = new Map(this.config);\n\n    if (!config.has(Object)) config.set(Object, []);\n    config.get(Object)!.push([Object, ioPropertyLink({showName: true})]);\n\n    const properties = [];\n    if (this.search) {\n      for (const key of getAllPropertyNames(this.selected)) {\n        if (key.toLowerCase().includes(this.search.toLowerCase())) {\n          properties.push(key);\n        }\n      }\n    }\n\n    if (this.search && properties.length === 0) {\n      vChildren.push(\n        span(`No results found for \"${this.search}\"`),\n      );\n    } else {\n      vChildren.push(\n        ioPropertyEditor({\n          value: this.selected,\n          config: config,\n          groups: this.groups,\n          widgets: this.widgets,\n          properties: properties,\n        }),\n      );\n    }\n\n    this.render(vChildren);\n  }\n  dispose() {\n    super.dispose();\n    window.removeEventListener('io-object-mutation', this.onPropertyMutated as unknown as EventListener);\n  }\n}\nexport const ioInspector = function(arg0?: IoInspectorProps) {\n  return IoInspector.vConstructor(arg0);\n};\n\n\n"]}