{"version":3,"file":"IoPropertyEditor.js","sourceRoot":"","sources":["../../src/elements/IoPropertyEditor.ts"],"names":[],"mappings":"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","sourcesContent":["import { IoElement, ReactiveProperty, Register, IoElementProps, Node, span, div, HTML_ELEMENTS, VDOMElement } from '@io-gui/core'\nimport { PropertyConfig, PropertyConfigRecord, getEditorConfig } from '../utils/EditorConfig.js'\nimport { PropertyGroups, getEditorGroups, PropertyGroupsRecord, getAllPropertyNames } from '../utils/EditorGroups.js'\nimport { getEditorWidget } from '../utils/EditorWidgets.js'\nimport { ioObject } from './IoObject.js'\n\nexport type IoPropertyEditorProps = IoElementProps & {\n  value?: Record<string, any> | any[]\n  properties?: string[] | null\n  label?: string\n  labeled?: boolean\n  labelWidth?: string\n  orientation?: 'vertical' | 'horizontal'\n  config?: PropertyConfig[]\n  groups?: PropertyGroups\n  widget?: VDOMElement\n}\n\n/**\n * Object editor. It displays a set of labeled property editors for the `value` object. Labels can be omitted by setting `labeled` property to false.\n **/\n@Register\nexport class IoPropertyEditor extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n      color: var(--io_colorInput);\n      background-color: var(--io_bgColor);\n      border-radius: calc(var(--io_borderRadius) + var(--io_spacing));\n      font-size: var(--io_fontSize);\n    }\n    :host[orientation=\"horizontal\"] {\n      flex-direction: row;\n    }\n    :host > .row {\n      display: flex;\n      flex-direction: row;\n      flex: 1 1 auto;\n      margin: var(--io_spacing);\n      padding: var(--io_spacing) 0;\n      border-radius: var(--io_borderRadius);\n      margin-bottom: 0;\n      background-color: var(--io_bgColorLight);\n    }\n    :host[orientation=\"horizontal\"] > .row {\n      flex-direction: column;\n    }\n    :host io-property-editor {\n      margin-top: calc(var(--io_spacing) * -1) !important;\n    }\n    :host io-property-editor > .row {\n      /* margin: 0 !important; */\n      padding: 0 !important;\n    }\n    :host > .row:last-of-type {\n      margin-bottom: var(--io_spacing);\n    }\n    :host > .row > span {\n      flex: 0 0 auto;\n      padding: var(--io_borderWidth); /* TODO: verify correctness */\n      margin: var(--io_spacing);\n      margin-left: var(--io_spacing2);\n      line-height: var(--io_lineHeight);\n      height: var(--io_lineHeight);\n      text-wrap: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n    :host > .row > span:after {\n      display: inline-block;\n      margin-left: var(--io_spacing);\n      opacity: 0.5;\n      content: ':';\n    }\n\n    :host > .row > :not(span) {\n      flex-grow: 1;\n    }\n    :host io-object {\n      margin-right: var(--io_spacing);\n    }\n    `\n  }\n\n  // @ReactiveProperty('debounced')\n  // declare reactivity: ReactivityType\n\n  @ReactiveProperty({type: Object, init: null})\n  declare value: object | Array<any>\n\n  @ReactiveProperty({type: Array, init: null})\n  declare properties: string[]\n\n  @ReactiveProperty({type: String, value: ''})\n  declare label: string\n\n  @ReactiveProperty(true)\n  declare labeled: boolean\n\n  @ReactiveProperty('80px')\n  declare labelWidth: string\n\n  @ReactiveProperty({type: String, value: 'vertical', reflect: true})\n  declare orientation: 'vertical' | 'horizontal'\n\n  @ReactiveProperty({type: Array, init: null})\n  declare config: PropertyConfig[]\n\n  @ReactiveProperty({type: Object, init: null})\n  declare groups: PropertyGroups\n\n  @ReactiveProperty({type: Object})\n  declare widget: VDOMElement | undefined\n\n  private _config: PropertyConfigRecord | null = null\n  private _groups: PropertyGroupsRecord | null = null\n  private _widget: VDOMElement | null = null\n\n  _onValueInput(event: CustomEvent) {\n    event.stopImmediatePropagation()\n    const id = (event.target as HTMLElement).id\n    if (id !== undefined) {\n      (this.value as Record<string, any>)[id] = event.detail.value\n      if (!(this.value as Node)._isNode) {\n        this.dispatchMutation(this.value)\n      }\n    } else {\n      debug: console.warn('IoPropertyEditor: \"value-input\" recieved from an input without a property id')\n    }\n  }\n\n  valueMutated(event: CustomEvent) {\n    this.debounce(this.changed)\n  }\n  configChanged() {\n    this.debounce(this.configureDebounced)\n  }\n  groupsChanged() {\n    this.debounce(this.configureDebounced)\n  }\n  widgetChanged() {\n    this.debounce(this.configureDebounced)\n  }\n  valueChanged() {\n    this.debounce(this.configureDebounced)\n  }\n  configureDebounced() {\n    this._config = getEditorConfig(this.value, this.config)\n    this._groups = getEditorGroups(this.value, this.groups)\n    this._widget = this.widget || getEditorWidget(this.value)\n    this.debounce(this.changed)\n  }\n  changed() {\n    this.debounce(this.changedDebounced)\n  }\n  changedDebounced() {\n    if (!this.value) {\n      this._config = null\n      this._groups = null\n      this._widget = null\n      this.render([])\n      return\n    }\n\n    const config = this._config\n    const groups = this._groups\n    const widget = this._widget\n\n    if (!config || !groups) return\n\n    const properties = []\n    const vChildren = []\n\n    if (this.properties.length) {\n      properties.push(...this.properties)\n    } else {\n      if (widget) {\n        const widgetWithValue = {\n          tag: widget.tag,\n          props: Object.assign({value: this.value}, widget.props),\n          children: widget.children\n        }\n        vChildren.push(widgetWithValue)\n      }\n      properties.push(...groups.Main)\n    }\n\n    const allProps = getAllPropertyNames(this.value)\n\n    for (let i = 0; i < properties.length; i++) {\n      if (allProps.includes(properties[i])) {\n        const id = properties[i] as keyof typeof this.value\n        const value = this.value[id]\n        const tag = config[id]!.tag\n        const props = config[id]!.props as (IoElementProps | undefined) || {}\n\n        const finalProps: any = {id: id, value: value, '@value-input': this._onValueInput}\n\n        Object.assign(finalProps, props)\n\n        let children: string | undefined = undefined\n        if (HTML_ELEMENTS.includes(tag) && typeof value === 'string') {\n          children = value\n        }\n\n        if (tag === 'io-object' || tag === 'io-property-editor') {\n          finalProps.config = finalProps.config || this.config\n          finalProps.groups = finalProps.groups || this.groups\n        }\n        if (tag === 'io-object') {\n          finalProps.persistentExpand = true\n        }\n        // NOTE: Functions dont have labels. They are displayed as labeled buttons.\n        const isFunction = typeof value === 'function'\n        if (isFunction) {\n          finalProps.action = (value as any).bind(this.value)\n          finalProps.label = finalProps.label || id\n        }\n\n        const isIoObject = tag === 'io-object'\n        if (isIoObject) {\n          finalProps.label = id + ': ' + (finalProps.label || (value as object)?.constructor?.name || String(value))\n        }\n\n        // TODO: Document and reconsider this\n        const label = finalProps.label || id\n        const tooltip = label\n        const hideLabel = finalProps.label === '_hidden_'\n\n        vChildren.push(div({class: 'row'}, [\n          (this.labeled && !hideLabel && !isFunction && !isIoObject) ? span({style: {width: this.labelWidth}, title: tooltip}, label) : null,\n          {tag: tag, props: finalProps, children: children},\n        ]))\n      } else {\n        debug: console.warn(`IoPropertyEditor: property \"${properties[i]}\" not found in value`)\n      }\n    }\n\n    if (!this.properties.length) {\n      for (const group in groups) {\n\n        if (group !== 'Main' && group !== 'Hidden' && groups[group].length) {\n          vChildren.push(\n            ioObject({\n              label: group,\n              labelWidth: this.labelWidth,\n              persistentExpand: true,\n              value: this.value,\n              properties: groups[group],\n              config: this.config,\n            }),\n          )\n        }\n      }\n    }\n\n    this.render(vChildren)\n  }\n  dispose() {\n    super.dispose()\n    window.removeEventListener('io-object-mutation', this.onPropertyMutated as unknown as EventListener)\n  }\n}\nexport const ioPropertyEditor = function(arg0?: IoPropertyEditorProps) {\n  return IoPropertyEditor.vConstructor(arg0)\n}"]}