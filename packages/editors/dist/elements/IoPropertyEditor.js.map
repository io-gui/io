{"version":3,"file":"IoPropertyEditor.js","sourceRoot":"","sources":["../../src/elements/IoPropertyEditor.ts"],"names":[],"mappings":"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","sourcesContent":["import { IoElement, ReactiveProperty, Register, IoElementProps, Node, span, div, Storage as $, HTML_ELEMENTS } from '@io-gui/core'\nimport { EditorConfig, getEditorConfig } from '../utils/EditorConfig.js'\nimport { EditorGroups, getEditorGroups, getAllPropertyNames } from '../utils/EditorGroups.js'\nimport { EditorWidgets, getEditorWidget } from '../utils/EditorWidgets.js'\nimport { ioObject } from './IoObject.js'\n\nexport type IoPropertyEditorProps = IoElementProps & {\n  value?: Record<string, any> | any[]\n  properties?: string[] | null\n  labeled?: boolean\n  orientation?: 'vertical' | 'horizontal'\n  config?: EditorConfig\n  groups?: EditorGroups\n  widgets?: EditorWidgets\n}\n\n/**\n * Object editor. It displays a set of labeled property editors for the `value` object. Labels can be omitted by setting `labeled` property to false.\n **/\n@Register\nexport class IoPropertyEditor extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n      color: var(--io_colorInput);\n      background-color: var(--io_bgColor);\n      border-radius: calc(var(--io_borderRadius) + var(--io_spacing));\n      font-size: var(--io_fontSize);\n    }\n    :host[orientation=\"horizontal\"] {\n      flex-direction: row;\n    }\n    :host > .row {\n      display: flex;\n      flex-direction: row;\n      margin: var(--io_spacing);\n      padding: var(--io_spacing) 0;\n      border-radius: var(--io_borderRadius);\n      margin-bottom: 0;\n      background-color: var(--io_bgColorLight);\n    }\n    :host[orientation=\"horizontal\"] > .row {\n      flex-direction: column;\n    }\n    :host > .row:last-of-type {\n      margin-bottom: var(--io_spacing);\n    }\n    :host > .row > span {\n      padding: var(--io_borderWidth); /* TODO: verify correctness */\n      margin: var(--io_spacing);\n      margin-left: var(--io_spacing2);\n      line-height: var(--io_lineHeight);\n      height: var(--io_lineHeight);\n      text-wrap: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n    :host > .row > span:after {\n      display: inline-block;\n      margin-left: var(--io_spacing);\n      opacity: 0.5;\n      content: ':';\n    }\n    :host io-object {\n      margin-right: var(--io_spacing);\n    }\n    `\n  }\n\n  // @ReactiveProperty('debounced')\n  // declare reactivity: ReactivityType\n\n  @ReactiveProperty()\n  declare value: Object | Array<any>\n\n  @ReactiveProperty({type: Array, init: null})\n  declare properties: string[]\n\n  @ReactiveProperty(true)\n  declare labeled: boolean\n\n  @ReactiveProperty({type: String, value: 'vertical', reflect: true})\n  declare orientation: 'vertical' | 'horizontal'\n\n  @ReactiveProperty({type: Map, init: null})\n  declare config: EditorConfig\n\n  @ReactiveProperty({type: Map, init: null})\n  declare groups: EditorGroups\n\n  @ReactiveProperty({type: Map, init: null})\n  declare widgets: EditorWidgets\n\n  init() {\n    this.changeThrottled = this.changeThrottled.bind(this)\n    this._observedObjectProperties.push('value')\n    window.addEventListener('io-object-mutation', this.onPropertyMutated as unknown as EventListener)\n  }\n\n  _onValueInput(event: CustomEvent) {\n    event.stopImmediatePropagation()\n    const id = (event.target as HTMLElement).id as keyof typeof this.value\n    if (id !== undefined) {\n      this.value[id] = event.detail.value\n      if (!(this.value as Node)._isNode) {\n        this.dispatchMutation(this.value)\n      }\n    } else {\n      debug: console.warn('IoPropertyEditor: \"value-input\" recieved from an input without a property id')\n    }\n  }\n  valueMutated() {\n    this.changeThrottled()\n  }\n  changeThrottled() {\n    this.throttle(this.changeThrottled)\n  }\n  changed() {\n    const config = getEditorConfig(this.value, this.config)\n    const groups = getEditorGroups(this.value, this.groups)\n    const widget = getEditorWidget(this.value, this.widgets)\n\n    const properties = []\n    const vChildren = []\n\n    if (this.properties.length) {\n      properties.push(...this.properties)\n    } else {\n      if (widget) {\n        const widgetWithValue = {\n          tag: widget.tag,\n          props: Object.assign({value: this.value}, widget.props),\n          children: widget.children\n        }\n        vChildren.push(widgetWithValue)\n      }\n      properties.push(...groups.Main)\n    }\n\n    const allProps = getAllPropertyNames(this.value)\n\n    for (let i = 0; i < properties.length; i++) {\n      if (allProps.includes(properties[i])) {\n        const id = properties[i] as keyof typeof this.value\n        const value = this.value[id]\n        const tag = config[id]!.tag\n        const props = config[id]!.props as (IoElementProps | undefined) || {}\n        const finalProps: any = {id: id, value: value, '@value-input': this._onValueInput}\n        Object.assign(finalProps, props)\n\n        let children: string | undefined = undefined\n        if (HTML_ELEMENTS.includes(tag) && typeof value === 'string') {\n          children = value\n        }\n\n        if (tag === 'io-object' || tag === 'io-property-editor') {\n          finalProps.config = finalProps.config || this.config\n          finalProps.groups = finalProps.groups || this.groups\n        }\n        vChildren.push(div({class: 'row'}, [\n          this.labeled ? span(id) : null,\n          {tag: tag, props: finalProps, children: children},\n        ]))\n      } else {\n        debug: console.warn(`IoPropertyEditor: property \"${properties[i]}\" not found in value`)\n      }\n    }\n\n    const uuid = genIdentifier(this.value)\n\n    if (!this.properties.length) {\n      for (const group in groups) {\n        if (group !== 'Main' && group !== 'Hidden' && groups[group].length) {\n          vChildren.push(\n            ioObject({\n              label: group,\n              expanded: $({value: false, storage: 'local', key: uuid + '-' + group}),\n              value: this.value,\n              properties: groups[group],\n              config: this.config,\n            }),\n          )\n        }\n      }\n    }\n\n    this.render(vChildren)\n  }\n  dispose() {\n    super.dispose()\n    window.removeEventListener('io-object-mutation', this.onPropertyMutated as unknown as EventListener)\n  }\n}\nexport const ioPropertyEditor = function(arg0?: IoPropertyEditorProps) {\n  return IoPropertyEditor.vConstructor(arg0)\n}\n\n// TODO: consider using WeakMap instead of UUID.\nfunction genIdentifier(object: any) {\n  let UUID = 'io-object-collapse-state-' + object.constructor.name\n  UUID += '-' + (object.guid || object.uuid || object.id || '')\n  const props = JSON.stringify(Object.keys(object))\n  let hash: any = 0\n  for (let i = 0; i < props.length; i++) {\n    hash = ((hash << 5) - hash) + props.charCodeAt(i)\n    hash |= 0\n  }\n  hash = (-hash).toString(16)\n  UUID += '-' + hash\n  return UUID\n}"]}