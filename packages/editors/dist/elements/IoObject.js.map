{"version":3,"file":"IoObject.js","sourceRoot":"","sources":["../../src/elements/IoObject.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, ReactiveProperty, IoElementProps, WithBinding, VDOMElement, Property, Storage as $ } from '@io-gui/core'\nimport { ioBoolean } from '@io-gui/inputs'\nimport { ioPropertyEditor } from './IoPropertyEditor.js'\nimport { PropertyConfig } from '../utils/EditorConfig.js'\nimport { PropertyGroups } from '../utils/EditorGroups.js'\n\nexport type IoObjectProps = IoElementProps & {\n  value?: Record<string, any> | any[]\n  properties?: string[]\n  labeled?: boolean\n  label?: string\n  labelWidth?: string\n  expanded?: WithBinding<boolean>\n  persistentExpand?: boolean\n  config?: PropertyConfig[]\n  groups?: PropertyGroups\n  widget?: VDOMElement\n}\n\n/**\n * Object property editor. It displays a set of labeled property editors for the `value` object inside io-collapsible element. It can be configured to use custom property editors and display only specified properties.\n **/\n@Register\nexport class IoObject extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      max-width: 100%;\n      flex-direction: column;\n      color: var(--io_colorInput);\n      background-color: var(--io_bgColor);\n      border-radius: calc(var(--io_borderRadius) + var(--io_spacing));\n    }\n    :host > io-boolean {\n      padding: var(--io_spacing) var(--io_spacing2);\n      align-self: stretch;\n    }\n    :host > io-boolean:before {\n      display: inline-block;\n      width: 0.75em;\n      content: \"▸\"\n    }\n    :host > io-boolean[value]:before {\n      content: \"▾\";\n    }\n    :host > io-property-editor {\n      margin: var(--io_spacing);\n      border: var(--io_border);\n      border-color: var(--io_borderColorInset);\n    }\n    `\n  }\n\n  @ReactiveProperty({type: Object})\n  declare value: Record<string, any> | any[]\n\n  @ReactiveProperty({type: Array, init: null})\n  declare properties: string[] | null\n\n  @ReactiveProperty({type: String, value: ''})\n  declare label: string\n\n  @ReactiveProperty(true)\n  declare labeled: boolean\n\n  @ReactiveProperty('80px')\n  declare labelWidth: string\n\n  @ReactiveProperty({value: false, reflect: true})\n  declare expanded: boolean\n\n  @ReactiveProperty({value: false})\n  declare persistentExpand: boolean\n\n  @ReactiveProperty({type: Array, init: null})\n  declare config: PropertyConfig[]\n\n  @ReactiveProperty({type: Object, init: null})\n  declare groups: PropertyGroups\n\n  @ReactiveProperty({type: Object})\n  declare widget: VDOMElement | undefined\n\n  @Property('region')\n  declare role: string\n\n  valueChanged() {\n    if (!this.value) return\n\n    let uuid = genIdentifier(this.value)\n    let storage: 'local' | 'none' = 'local'\n    if (!uuid) {\n      uuid = getTempIdentifier(this.value)\n      storage = 'none'\n    }\n\n    // TODO: Test\n    const expandedBinding = $({value: false, storage: storage, key: uuid + '-' + this.label})\n    const bindingTargets = expandedBinding.targets\n    const targetIsThis = bindingTargets.has(this)\n\n    if (bindingTargets.size < 1) {\n      if (!targetIsThis) {\n        const targetP = this._reactiveProperties.get('expanded')!\n        if (targetP.binding && targetP.binding !== expandedBinding) {\n          targetP.binding.removeTarget(this, 'expanded')\n        }\n        expandedBinding.addTarget(this, 'expanded')\n      }\n    }\n  }\n\n  changed() {\n    const label = this.label || this.value.constructor.name\n\n    const vChildren: VDOMElement[] = []\n    vChildren.push(ioBoolean({\n      appearance: 'neutral',\n      true: label,\n      false: label,\n      value: this.bind('expanded')}\n    ))\n    if (this.expanded) {\n      vChildren.push(ioPropertyEditor({\n        value: this.value,\n        properties: this.properties,\n        config: this.config,\n        groups: this.groups,\n        widget: this.widget,\n        labeled: this.labeled,\n        labelWidth: this.labelWidth,\n      }))\n    }\n    this.render(vChildren)\n    this.setAttribute('aria-expanded', String(this.expanded))\n  }\n}\nexport const ioObject = function(arg0?: IoObjectProps) {\n  return IoObject.vConstructor(arg0)\n}\n\nfunction genIdentifier(object: any) {\n  const id = object.guid || object.uuid || object.id || object.name || object.label\n  if (id) {\n    return 'io-object-collapse-state-' + object.constructor.name + '-' + id\n  }\n}\n\nconst tempIdentifiers = new WeakMap<object, string>()\n\nfunction getTempIdentifier(object: any) {\n  if (!tempIdentifiers.has(object)) {\n    const randomuuid = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15)\n    tempIdentifiers.set(object, randomuuid)\n  }\n  return tempIdentifiers.get(object)!\n}"]}