{"version":3,"file":"IoVectorArray.js","sourceRoot":"","sources":["../../src/elements/IoVectorArray.ts"],"names":[],"mappings":"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","sourcesContent":["import { Register, IoElement, ReactiveProperty, IoElementProps, WithBinding, VDOMElement, Node } from '@io-gui/core'\nimport { ioNumber, ioBoolean } from '@io-gui/inputs'\n\nexport type IoVectorArrayProps = IoElementProps & {\n  value?: number[]\n  conversion?: number\n  step?: number\n  min?: number\n  max?: number\n  linkable?: boolean\n  linked?: WithBinding<boolean>\n  ladder?: boolean\n  disabled?: boolean\n}\n/**\n * Input element for vector arrays and objects.\n **/\n@Register\nexport class IoVectorArray extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex: 1 1 auto;\n      }\n      :host > io-number {\n        flex: 1 1 auto;\n      }\n      :host > *:not(:last-child) {\n        margin-right: var(--io_spacing);\n      }\n      :host > io-boolicon {\n        flex-shrink: 0;\n        padding: var(--io_spacing);\n      }\n    `\n  }\n\n  @ReactiveProperty({type: Array})\n  declare value: number[]\n\n  @ReactiveProperty(1)\n  declare conversion: number\n\n  @ReactiveProperty(0.001)\n  declare step: number\n\n  @ReactiveProperty(-Infinity)\n  declare min: number\n\n  @ReactiveProperty(Infinity)\n  declare max: number\n\n  @ReactiveProperty(false)\n  declare linkable: boolean\n\n  @ReactiveProperty(false)\n  declare linked: boolean\n\n  @ReactiveProperty(true)\n  declare ladder: boolean\n\n  @ReactiveProperty(false)\n  declare disabled: boolean\n\n  @ReactiveProperty({type: Array, init: null})\n  declare keys: number[]\n\n  private _ratios: any = {}\n\n  _onNumberPointerDown(event: PointerEvent) {\n    const item = event.composedPath()[0] as HTMLElement\n    const id = item.id as keyof typeof this.value\n    this._ratios = {}\n    if (this.linked && this.value[id] !== 0) {\n      const value = this.value as any\n      for (const k of this.keys as [keyof typeof value]) this._ratios[k] = value[k] / value[id]\n    }\n  }\n\n  _onNumberValueInput(event: CustomEvent) {\n    const item = event.composedPath()[0] as HTMLElement\n    const index = Number(item.id);\n    (this.value as any)[index] = event.detail.value\n    if (this.linked) {\n      for (const k of this.keys) {\n        const value = this.value as any\n        if (k !== index && this._ratios[k]) (value as any)[k] = value[index] * this._ratios[k]\n      }\n    }\n    // TODO: this was replaced in earlier commit but not sure why. Nodes should dispatch mutations on their own.\n    if (!(this.value as unknown as Node)._isNode) {\n      this.dispatchMutation(this.value)\n    }\n    // Remove this later if no regressions are spotted and no tests are broken.\n    // this.dispatchMutation(this.value)\n    this.dispatch('value-input', {property: 'value', value: this.value}, false)\n  }\n\n  valueChanged() {\n    this.keys.length = 0\n    this.keys = Array.from(Array(this.value.length).keys())\n    debug: if (this.keys.find(k => [0, 1, 2, 3].indexOf(k) === -1)) {\n      console.warn('IoVectorArray: Unrecognized vector type!')\n    }\n  }\n  valueMutated() {\n    this.debounce(this.changed)\n  }\n  changed() {\n    const vChildren: Array<VDOMElement | null> = []\n    for (const k of this.keys) {\n      if (this.value[k] !== undefined) {\n        vChildren.push(ioNumber({\n          id: String(k), // Consider removing global id collisions\n          value: this.value[k],\n          conversion: this.conversion,\n          step: this.step,\n          min: this.min,\n          max: this.max,\n          ladder: this.ladder,\n          disabled: this.disabled,\n          '@pointerdown': this._onNumberPointerDown,\n          '@value-input': this._onNumberValueInput,\n        }))\n      }\n    }\n    vChildren.push(this.linkable ? ioBoolean({value: this.bind('linked') as any, true: 'io:link', false: 'io:unlink'}) : null)\n    this.render(vChildren)\n  }\n}\nexport const ioVectorArray = function(arg0?: IoVectorArrayProps) {\n  return IoVectorArray.vConstructor(arg0)\n}"]}