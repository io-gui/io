{"version":3,"file":"IoInspector.js","sourceRoot":"","sources":["../../src/elements/IoInspector.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,gBAAgB,EAA+B,IAAI,EAAE,MAAM,cAAc,CAAA;AACvG,OAAO,EAAE,aAAa,EAAE,MAAM,oBAAoB,CAAA;AAClD,OAAO,EAAE,gBAAgB,EAAE,MAAM,uBAAuB,CAAA;AAExD,OAAO,EAAgB,mBAAmB,EAAE,MAAM,0BAA0B,CAAA;AAE5E,OAAO,EAAE,cAAc,EAAE,MAAM,qBAAqB,CAAA;AAWpD,SAAS,cAAc,CAAC,KAAa,EAAE,QAAgB;IACrD,IAAI,KAAK,KAAK,QAAQ;QAAE,OAAO,IAAI,CAAA;IACnC,IAAI,KAAK,YAAY,KAAK,EAAE,CAAC;QAC3B,OAAO,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,cAAc,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAA;IACrD,CAAC;IACD,IAAI,KAAK,YAAY,MAAM,EAAE,CAAC;QAC5B,OAAO,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,cAAc,CAAC,KAAK,CAAC,CAAuB,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAA;IAC/F,CAAC;IACD,OAAO,KAAK,CAAA;AACd,CAAC;AAED;;IAEI;AAEG,IAAM,WAAW,GAAjB,MAAM,WAAY,SAAQ,SAAS;IACxC,MAAM,KAAK,KAAK;QACd,OAAO,SAAS,CAAA;;;;;;;;;;;;;;;;;;;;;;KAsBf,CAAA;IACH,CAAC;IAmBD,MAAM,KAAK,SAAS;QAClB,OAAO;YACL,mBAAmB,EAAE,eAAe;SACrC,CAAA;IACH,CAAC;IACD,IAAI;QACF,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QACtD,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,OAAO,EAAE,UAAU,CAAC,CAAA;QACxD,MAAM,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,IAAI,CAAC,iBAA6C,CAAC,CAAA;IACnG,CAAC;IACD,aAAa,CAAC,KAAkB;QAC9B,KAAK,CAAC,eAAe,EAAE,CAAA;QACvB,MAAM,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAA;QAChC,MAAM,IAAI,GAAG,KAAK,CAAC,YAAY,EAAE,CAAC,CAAC,CAAQ,CAAA;QAC3C,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,CAAC;YACvC,IAAI,IAAI,CAAC,SAAS,KAAK,kBAAkB,IAAI,IAAI,CAAC,SAAS,KAAK,aAAa,EAAE,CAAC;gBAC9E,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,KAAK,CAAC,CAAA;YACrC,CAAC;QACH,CAAC;IACH,CAAC;IACD,YAAY;QACV,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAA;IAC5B,CAAC;IACD,YAAY;QACV,oGAAoG;QACpG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC/C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAA;QAC5B,CAAC;QACD,IAAI,CAAC,OAAO,EAAE,CAAA;IAChB,CAAC;IACD,eAAe;QACb,IAAI,CAAC,OAAO,EAAE,CAAA;IAChB,CAAC;IACD,eAAe;QACb,IAAI,CAAC,MAAM,GAAG,EAAE,CAAA;IAClB,CAAC;IACD,OAAO;QACL,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,eAAe,EAAE,SAAS,EAAE,CAAC,CAAC,CAAA;IACnD,CAAC;IACD,eAAe;QACb,MAAM,SAAS,GAAG;YAChB,aAAa,CAAC,EAAC,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAC,CAAC;SACjG,CAAA;QAED,MAAM,MAAM,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;QAEnC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC;YAAE,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;QAC/C,MAAM,CAAC,GAAG,CAAC,MAAM,CAAE,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,cAAc,CAAC,EAAC,QAAQ,EAAE,IAAI,EAAC,CAAC,CAAC,CAAC,CAAA;QAEpE,MAAM,UAAU,GAAG,EAAE,CAAA;QACrB,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YAChB,KAAK,MAAM,GAAG,IAAI,mBAAmB,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;gBACrD,IAAI,GAAG,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC;oBAC1D,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;gBACtB,CAAC;YACH,CAAC;QACH,CAAC;QAED,IAAI,IAAI,CAAC,MAAM,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAC3C,SAAS,CAAC,IAAI,CACZ,IAAI,CAAC,yBAAyB,IAAI,CAAC,MAAM,GAAG,CAAC,CAC9C,CAAA;QACH,CAAC;aAAM,CAAC;YACN,SAAS,CAAC,IAAI,CACZ,gBAAgB,CAAC;gBACf,KAAK,EAAE,IAAI,CAAC,QAAQ;gBACpB,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,IAAI,CAAC,MAAM;gBACnB,OAAO,EAAE,IAAI,CAAC,OAAO;gBACrB,UAAU,EAAE,UAAU;aACvB,CAAC,CACH,CAAA;QACH,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAA;IACxB,CAAC;IACD,OAAO;QACL,KAAK,CAAC,OAAO,EAAE,CAAA;QACf,MAAM,CAAC,mBAAmB,CAAC,oBAAoB,EAAE,IAAI,CAAC,iBAA6C,CAAC,CAAA;IACtG,CAAC;CACF,CAAA;AAjGS;IADP,gBAAgB,EAAE;0CACe;AAG1B;IADP,gBAAgB,EAAE;6CACkB;AAG7B;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,MAAM,EAAC,CAAC;2CACX;AAGd;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC;2CACd;AAGpB;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC;2CACd;AAGpB;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC;4CACZ;AA1CnB,WAAW;IADvB,QAAQ;GACI,WAAW,CA4HvB;;AACD,MAAM,CAAC,MAAM,WAAW,GAAG,UAAS,IAAuB;IACzD,OAAO,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;AACvC,CAAC,CAAA","sourcesContent":["import { Register, IoElement, ReactiveProperty, IoElementProps, WithBinding, span } from '@io-gui/core'\nimport { ioBreadcrumbs } from './IoBreadcrumbs.js'\nimport { ioPropertyEditor } from './IoPropertyEditor.js'\nimport { EditorConfig } from '../utils/EditorConfig.js'\nimport { EditorGroups, getAllPropertyNames } from '../utils/EditorGroups.js'\nimport { EditorWidgets } from '../utils/EditorWidgets.js'\nimport { ioPropertyLink } from './IoPropertyLink.js'\n\nexport type IoInspectorProps = IoElementProps & {\n  value?: Record<string, any> | any[]\n  selected?: WithBinding<Record<string, any> | any[]>\n  search?: WithBinding<string>\n  config?: EditorConfig\n  groups?: EditorGroups\n  widgets?: EditorWidgets\n}\n\nfunction isNestedObject(value: object, selected: object): boolean {\n  if (value === selected) return true\n  if (value instanceof Array) {\n    return value.some(v => isNestedObject(v, selected))\n  }\n  if (value instanceof Object) {\n    return Object.keys(value).some(k => isNestedObject(value[k as keyof typeof value], selected))\n  }\n  return false\n}\n\n/**\n * Object property editor. It displays a set of labeled property editors for the `value` object inside multiple `io-collapsible` elements. It can be configured to use custom property editors and display only specified properties. Properties of type `Object` are displayed as clickable links which can also be navigated in the `io-breadcrumbs` element.\n **/\n@Register\nexport class IoInspector extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: flex;\n      flex-direction: column;\n      align-items: stretch;\n      flex: 0 1 calc(var(--io_lineHeight) * 17.5);\n      padding: var(--io_spacing);\n      background-color: var(--io_bgColor);\n      border-radius: calc(var(--io_borderRadius) + var(--io_spacing));\n    }\n    :host > io-breadcrumbs {\n      margin: 0 var(--io_spacing);\n      z-index: 1;\n    }\n    :host > span {\n      padding: var(--io_spacing) var(--io_spacing3);\n      color: var(--io_colorStrong);\n    }\n    :host io-property-editor > .row > span {\n      min-width: 6em;\n      text-align: right;\n    }\n    `\n  }\n  @ReactiveProperty()\n  declare value: object | Array<any>\n\n  @ReactiveProperty()\n  declare selected: object | Array<any>\n\n  @ReactiveProperty({type: String})\n  declare search: string\n\n  @ReactiveProperty({type: Map, init: null})\n  declare config: EditorConfig\n\n  @ReactiveProperty({type: Map, init: null})\n  declare groups: EditorGroups\n\n  @ReactiveProperty({type: Map, init: null})\n  declare widgets: EditorWidgets\n\n  static get Listeners() {\n    return {\n      'io-button-clicked': 'onLinkClicked',\n    }\n  }\n  init() {\n    this.changeThrottled = this.changeThrottled.bind(this)\n    this._observedObjectProperties.push('value', 'selected')\n    window.addEventListener('io-object-mutation', this.onPropertyMutated as unknown as EventListener)\n  }\n  onLinkClicked(event: CustomEvent) {\n    event.stopPropagation()\n    const value = event.detail.value\n    const item = event.composedPath()[0] as any\n    if (value && typeof value === 'object') {\n      if (item.localName === 'io-property-link' || item.className === 'back-button') {\n        this.setProperty('selected', value)\n      }\n    }\n  }\n  valueChanged() {\n    this.selected = this.value\n  }\n  valueMutated() {\n    // TODO: Improve this check to update selected to new object if it replaced the previously selected.\n    if (!isNestedObject(this.value, this.selected)) {\n      this.selected = this.value\n    }\n    this.changed()\n  }\n  selectedMutated() {\n    this.changed()\n  }\n  selectedChanged() {\n    this.search = ''\n  }\n  changed() {\n    this.throttle(this.changeThrottled, undefined, 1)\n  }\n  changeThrottled() {\n    const vChildren = [\n      ioBreadcrumbs({value: this.value, selected: this.bind('selected'), search: this.bind('search')}),\n    ]\n\n    const config = new Map(this.config)\n\n    if (!config.has(Object)) config.set(Object, [])\n    config.get(Object)!.push([Object, ioPropertyLink({showName: true})])\n\n    const properties = []\n    if (this.search) {\n      for (const key of getAllPropertyNames(this.selected)) {\n        if (key.toLowerCase().includes(this.search.toLowerCase())) {\n          properties.push(key)\n        }\n      }\n    }\n\n    if (this.search && properties.length === 0) {\n      vChildren.push(\n        span(`No results found for \"${this.search}\"`),\n      )\n    } else {\n      vChildren.push(\n        ioPropertyEditor({\n          value: this.selected,\n          config: config,\n          groups: this.groups,\n          widgets: this.widgets,\n          properties: properties,\n        }),\n      )\n    }\n\n    this.render(vChildren)\n  }\n  dispose() {\n    super.dispose()\n    window.removeEventListener('io-object-mutation', this.onPropertyMutated as unknown as EventListener)\n  }\n}\nexport const ioInspector = function(arg0?: IoInspectorProps) {\n  return IoInspector.vConstructor(arg0)\n}\n\n\n"]}