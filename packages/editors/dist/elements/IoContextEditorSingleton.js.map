{"version":3,"file":"IoContextEditorSingleton.js","sourceRoot":"","sources":["../../src/elements/IoContextEditorSingleton.ts"],"names":[],"mappings":"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","sourcesContent":["import { IoOverlaySingleton, NudgeDirection, nudge, ReactiveProperty, Register } from '@io-gui/core'\nimport { IoPropertyEditor } from './IoPropertyEditor.js'\nimport { PropertyConfig } from '../utils/EditorConfig.js'\nimport { EditorGroups } from '../utils/EditorGroups.js'\nimport { EditorWidgets } from '../utils/EditorWidgets.js'\n\ninterface IoContextEditorExpandProps {\n  source: HTMLElement\n  direction: NudgeDirection\n  value: any\n  properties?: string[]\n  labeled?: boolean\n  orientation?: 'vertical' | 'horizontal'\n  config?: PropertyConfig[]\n  groups?: EditorGroups\n  widgets?: EditorWidgets\n  onClose?: () => void\n}\n\n@Register\nclass IoContextEditor extends IoPropertyEditor {\n  static get Style() {\n    return /* css */`\n      :host {\n        z-index: 2;\n      }\n      :host:not([expanded]) {\n      visibility: hidden;\n    }\n    `\n  }\n\n  @ReactiveProperty({type: Boolean, value: false, reflect: true})\n  declare expanded: boolean\n\n  declare onClose: null | (() => void)\n\n  static get Listeners() {\n    return {\n      'keydown': 'onKeydown',\n      'io-focus-to': 'onIoFocusTo',\n    }\n  }\n  onKeydown(event: KeyboardEvent) {\n    if (event.key === 'Escape' || event.key === 'Enter') {\n      event.preventDefault()\n      this.expanded = false\n    }\n  }\n  onIoFocusTo(event: CustomEvent) {\n    const source = event.detail.source\n    const cmd = event.detail.command\n    const siblings = Array.from(this.querySelectorAll('[tabindex=\"0\"]')) as HTMLElement[]\n    const index = [...siblings].indexOf(source)\n\n    let cmdOverride = ''\n    if ((this as any).horizontal) {\n      if (cmd === 'ArrowRight') cmdOverride = 'next'\n      if (cmd === 'ArrowLeft') cmdOverride = 'prev'\n    } else {\n      if (cmd === 'ArrowDown') cmdOverride = 'next'\n      if (cmd === 'ArrowUp') cmdOverride = 'prev'\n    }\n\n    if (cmdOverride) {\n      if (cmdOverride === 'next') {\n        siblings[(index + 1) % siblings.length].focus()\n      } else if (cmdOverride === 'prev') {\n        siblings[(index - 1 + siblings.length) % siblings.length].focus()\n      } else if (cmdOverride === 'out') {\n        if ((this as any).$parent) (this as any).$parent.focus()\n      }\n      event.stopPropagation()\n    }\n  }\n  expand(props: IoContextEditorExpandProps) {\n    this.setProperties({\n      value: props.value,\n      properties: props.properties || [],\n      labeled: props.labeled || true,\n      orientation: props.orientation || 'vertical',\n      config: props.config || [],\n      groups: props.groups || {},\n      widgets: props.widgets || new Map(),\n      expanded: true,\n    })\n    this.onClose = props.onClose || null\n    // TODO: nudge: 'none' should open at cursor position like context menu\n    nudge(this, props.source, props.direction)\n    this.debounce(this.onExpand)\n  }\n  onExpand() {\n    (this.querySelector('[tabindex=\"0\"]:not([inert])') as HTMLElement)?.focus()\n    // TODO: keyboard focus navigation\n  }\n  expandedChanged() {\n    if (!this.expanded) {\n      this.setProperties({\n        value: {},\n        properties: [],\n        labeled: true,\n        orientation: 'vertical',\n        config: [],\n        groups: {},\n        widgets: new Map(),\n      })\n      if (this.onClose) {\n        this.onClose()\n        this.onClose = null\n      }\n    }\n  }\n}\n\nexport const IoContextEditorSingleton = new IoContextEditor()\n\nsetTimeout(() => {\n  IoOverlaySingleton.appendChild(IoContextEditorSingleton as HTMLElement)\n}, 100)\n"]}