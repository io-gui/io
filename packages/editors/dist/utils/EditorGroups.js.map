{"version":3,"file":"EditorGroups.js","sourceRoot":"","sources":["../../src/utils/EditorGroups.ts"],"names":[],"mappings":"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","sourcesContent":["import { AnyConstructor } from '@io-gui/core'\n\nexport const SKIPPED_PROPERTIES = [\n  '$',\n  'ELEMENT_NODE','ATTRIBUTE_NODE','TEXT_NODE','CDATA_SECTION_NODE','ENTITY_REFERENCE_NODE','ENTITY_NODE',\n  'PROCESSING_INSTRUCTION_NODE','COMMENT_NODE','DOCUMENT_NODE','DOCUMENT_TYPE_NODE','DOCUMENT_FRAGMENT_NODE',\n  'NOTATION_NODE','DOCUMENT_POSITION_DISCONNECTED','DOCUMENT_POSITION_PRECEDING','DOCUMENT_POSITION_FOLLOWING',\n  'DOCUMENT_POSITION_CONTAINS','DOCUMENT_POSITION_CONTAINED_BY','DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC',  // Event Handlers\n  'onbeforecopy','onbeforecut','onbeforepaste','onsearch','onfullscreenchange',\n  'onfullscreenerror','onwebkitfullscreenchange','onwebkitfullscreenerror','namespaceURI',\n  'onbeforexrselect','onabort','onbeforeinput','onbeforematch','onbeforetoggle','onblur','oncancel','oncanplay',\n  'oncanplaythrough','onchange','onclick','onclose','oncontentvisibilityautostatechange','oncontextlost','oncontextmenu',\n  'oncontextrestored','oncuechange','ondblclick','ondrag','ondragend','ondragenter','ondragleave','ondragover','ondragstart',\n  'ondrop','ondurationchange','onemptied','onended','onerror','onfocus','onformdata','oninput','oninvalid','onkeydown',\n  'onkeypress','onkeyup','onload','onloadeddata','onloadedmetadata','onloadstart','onmousedown','onmouseenter','onmouseleave',\n  'onmousemove','onmouseout','onmouseover','onmouseup','onmousewheel','onpause','onplay','onplaying','onprogress',\n  'onratechange','onreset','onresize','onscroll','onsecuritypolicyviolation','onseeked','onseeking','onselect','onslotchange',\n  'onstalled','onsubmit','onsuspend','ontimeupdate','ontoggle','onvolumechange','onwaiting','onwebkitanimationend',\n  'onwebkitanimationiteration','onwebkitanimationstart','onwebkittransitionend','onwheel','onauxclick','ongotpointercapture',\n  'onlostpointercapture','onpointerdown','onpointermove','onpointerrawupdate','onpointerup','onpointercancel','onpointerover',\n  'onpointerout','onpointerenter','onpointerleave','onselectstart','onselectionchange','onanimationend','onanimationiteration',\n  'onanimationstart','ontransitionrun','ontransitionstart','ontransitionend','ontransitioncancel','oncopy','oncut','onpaste',\n  'oncommand','onscrollend','onscrollsnapchange','onscrollsnapchangin','onscrollsnapchanging','onafterprint','onbeforeprint',\n  'onbeforeunload','onhashchange','onlanguagechange','onmessage','onmessageerror','onoffline','ononline','onpagehide','onpageshow',\n  'onpopstate','onrejectionhandled','onstorage','onunhandledrejection','onunload','onenterpictureinpicture','onreadystatechange',\n  'onpointerlockchange','onpointerlockerror','onfreeze','onprerenderingchange','onresume','onvisibilitychange',\n  'onleavepictureinpicture',\n]\n\nexport function getAllPropertyNames(obj: object): string[] {\n  const allProps: string[] = []\n  let curr = obj\n  do {\n    const props = Object.getOwnPropertyNames(curr)\n    props.forEach((prop) => {\n      if (allProps.indexOf(prop) === -1 && typeof (obj as any)[prop] !== 'function' && !SKIPPED_PROPERTIES.includes(prop)) {\n        allProps.push(prop)\n      }\n    })\n    if (curr.constructor === Node) break\n    //@ts-ignore no-cond-assign\n  } while ((curr = Object.getPrototypeOf(curr)))\n  return allProps\n}\n\ntype PropertyIdentifier = string | RegExp\nexport type PropertyGroups = Record<string, Array<PropertyIdentifier>>\nexport type PropertyGroupsRecord = Record<string, Array<string>>\nexport type EditorGroups = Map<AnyConstructor, PropertyGroups>\n\nconst editorGroupsSingleton: EditorGroups = new Map<AnyConstructor, PropertyGroups>([\n  [Object, {\n    Hidden: [new RegExp(/^_/)],\n  }],\n  [Node, {\n    Main: [\n      'textContent',\n    ],\n    Input: [\n      'lang','translate','dir','inert','accessKey','draggable','writingSuggestions','spellcheck','autocapitalize','editContext',\n      'contentEditable','enterKeyHint','inputMode','virtualKeyboardPolicy',\n    ],\n    Hierarchy: [\n      'isConnected','ownerDocument','parentNode','parentElement','childNodes','firstChild','lastChild','previousSibling',\n      'nextSibling',\n      'children','firstElementChild','lastElementChild','childElementCount','previousElementSibling',\n      'nextElementSibling','elementTiming',\n    ],\n    Layout: [\n      'scrollTop','scrollLeft','scrollWidth','scrollHeight','clientTop','clientLeft','clientWidth','clientHeight','currentCSSZoom',\n      'offsetParent','offsetTop','offsetLeft','offsetWidth','offsetHeight'\n    ],\n    Aria: [\n      'role','ariaAtomic','ariaAutoComplete','ariaBusy','ariaBrailleLabel','ariaBrailleRoleDescription','ariaChecked','ariaColCount',\n      'ariaColIndex','ariaColSpan','ariaCurrent','ariaDescription','ariaDisabled','ariaExpanded','ariaHasPopup','ariaHidden',\n      'ariaInvalid','ariaKeyShortcuts','ariaLabel','ariaLevel','ariaLive','ariaModal','ariaMultiLine','ariaMultiSelectable',\n      'ariaOrientation','ariaPlaceholder','ariaPosInSet','ariaPressed','ariaReadOnly','ariaRelevant','ariaRequired',\n      'ariaRoleDescription','ariaRowCount','ariaRowIndex','ariaRowSpan','ariaSelected','ariaSetSize','ariaSort','ariaValueMax',\n      'ariaValueMin','ariaValueNow','ariaValueText','ariaColIndexText','ariaRowIndexText','ariaActiveDescendantElement',\n      'ariaControlsElements','ariaDescribedByElements','ariaDetailsElements','ariaErrorMessageElements','ariaFlowToElements',\n      'ariaLabelledByElements',\n    ],\n\n    Hidden: [],\n  }],\n])\n\nexport function getEditorGroups(object: object, editorGroups: EditorGroups = new Map()): PropertyGroupsRecord {\n  debug: if (!object || !(object instanceof Object)) {\n    console.warn('`getEditorGroups` should be used with an Object instance')\n    return {}\n  }\n\n  const aggregatedGroups: PropertyGroups = {\n    Main: [],\n  }\n\n  function aggregateGroups(editorGroups: EditorGroups) {\n    for (const [constructorKey, groups] of editorGroups) {\n      if (object instanceof constructorKey) {\n        for (const g in groups) {\n          aggregatedGroups[g] = aggregatedGroups[g] || []\n          aggregatedGroups[g].push(...groups[g])\n          // Remove duplicate identifiers that exist in other groups.\n          for (const ag in aggregatedGroups) {\n            if (ag !== g) {\n              for (const identifier of groups[g]) {\n                if (aggregatedGroups[ag].includes(identifier)) {\n                  aggregatedGroups[ag].splice(aggregatedGroups[ag].indexOf(identifier), 1)\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  aggregateGroups(editorGroupsSingleton)\n  aggregateGroups(editorGroups)\n\n  const groupsRecord: PropertyGroupsRecord = {\n    Main: [],\n  }\n\n\n  for (const key of getAllPropertyNames(object)) {\n    let included = false\n    for (const g of Object.keys(aggregatedGroups)) {\n      groupsRecord[g] = groupsRecord[g] || []\n      for (const identifier of aggregatedGroups[g]) {\n        if (identifier === key) {\n          groupsRecord[g].push(key)\n          included = true\n          continue\n        } else if (identifier instanceof RegExp && identifier.test(key)) {\n          groupsRecord[g].push(key)\n          included = true\n        }\n      }\n    }\n    if (!included) {\n      groupsRecord.Main.push(key)\n    }\n  }\n  // TODO: make sure no property belongs to multiple groups.\n  return groupsRecord\n}\n\nexport function registerEditorGroups(constructor: AnyConstructor, groups: PropertyGroups) {\n  const existingGroups = editorGroupsSingleton.get(constructor) || {}\n  for (const group in groups) {\n    existingGroups[group] = existingGroups[group] || []\n    existingGroups[group].push(...groups[group])\n    // Remove duplicate identifiers that exist in other groups.\n    for (const g in existingGroups) {\n      if (g !== group) {\n        for (const identifier of groups[group]) {\n          if (existingGroups[g].includes(identifier)) {\n            existingGroups[g].splice(existingGroups[g].indexOf(identifier), 1)\n          }\n        }\n      }\n    }\n  }\n  editorGroupsSingleton.set(constructor, existingGroups)\n}\n"]}