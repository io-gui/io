import"mocha";import"chai";import{ProtoChain as e,IoNode as t,IoElement as o,IoNodeMixin as n,ProtoProperty as a,Property as i,Binding as p,assignProtoProperty as c,RegisterIoNode as r,EventDispatcher as l,ChangeQueue as s,RegisterIoElement as h}from"./iogui.js";class Array1 extends Array{}class Array2 extends Array1{}class Array3 extends Array2{}class Object1$1{}class Object2 extends Object1$1{}class Object3 extends Object2{}class HTMLElement1 extends HTMLElement{}class HTMLElement2 extends HTMLElement1{}class HTMLElement3 extends HTMLElement2{}class IoNode1$1 extends t{}class IoElement1 extends o{}class IoNode2$1 extends(n(Object3)){}class FakeIoNode1{static get Properties(){return{prop1:{notify:!1}}}static get Listeners(){return{listener1:"function1",listener2:"",listener3:["_onFunction1",{capture:!0}],listener4:()=>{}}}static get Style(){return"a"}function1(){}onFunction1(){}_onFunction1(){}}class FakeIoNode2 extends FakeIoNode1{function2(){}onFunction2(){}_onFunction2(){}static get Properties(){return{prop1:{observe:!0},prop2:{}}}static get Listeners(){return{listener1:"_onFunction2",listener2:["function2",{capture:!0,passive:!0}],listener3:["_onFunction1",{passive:!0}]}}static get Style(){return"b"}}class FakeIoNode3 extends FakeIoNode2{}class ProtoChain{run(){describe("ProtoChain",(()=>{it("Should include an array of inherited class constructors",(()=>{let n=new e(Array3).constructors;chai.expect(n).to.be.eql([Array3,Array2,Array1]),n=new e(Object3).constructors,chai.expect(n).to.be.eql([Object3,Object2,Object1$1]),n=new e(HTMLElement3).constructors,chai.expect(n).to.be.eql([HTMLElement3,HTMLElement2,HTMLElement1]),n=new e(t).constructors,chai.expect(n).to.be.eql([t,Object.getPrototypeOf(t)]),n=new e(IoNode1$1).constructors,chai.expect(n).to.be.eql([IoNode1$1,t,Object.getPrototypeOf(t)]),n=new e(IoElement1).constructors,chai.expect(n).to.be.eql([IoElement1,o,Object.getPrototypeOf(o)]),n=new e(IoNode2$1).constructors,chai.expect(n).to.be.eql([IoNode2$1,Object.getPrototypeOf(IoNode2$1),Object3,Object2,Object1$1])})),it('Should include an array of function names that start with "on" or "_on" for auto-binding',(()=>{let t=new e(IoNode1$1);chai.expect(t.functions).to.be.eql([]),t=new e(FakeIoNode1),chai.expect(t.functions).to.be.eql(["onFunction1","_onFunction1"]),t=new e(FakeIoNode2),chai.expect(t.functions).to.be.eql(["onFunction2","_onFunction2","onFunction1","_onFunction1"])})),it("Should bind all auto-binding functions from the `.functions` array with `.autobindFunctions(node)` function",(()=>{const t=new e(FakeIoNode2),o=new FakeIoNode2;t.autobindFunctions(o),chai.expect(o.function1.name).to.be.equal("function1"),chai.expect(o.onFunction1.name).to.be.equal("bound onFunction1"),chai.expect(o._onFunction1.name).to.be.equal("bound _onFunction1"),chai.expect(o.function2.name).to.be.equal("function2"),chai.expect(o.onFunction2.name).to.be.equal("bound onFunction2"),chai.expect(o._onFunction2.name).to.be.equal("bound _onFunction2")})),it("Should include all property definitions declared in `static get Properties()` return oject",(()=>{let t=new e(FakeIoNode1);chai.expect(Object.keys(t.properties)).to.be.eql(["prop1"]),chai.expect(t.properties).to.be.eql({prop1:{value:void 0,type:void 0,binding:void 0,notify:!1,reflect:0,observe:!1}}),t=new e(FakeIoNode2),chai.expect(Object.keys(t.properties)).to.be.eql(["prop1","prop2"]),chai.expect(t.properties).to.be.eql({prop1:{value:void 0,type:void 0,binding:void 0,notify:!1,reflect:0,observe:!0},prop2:{value:void 0,type:void 0,binding:void 0,notify:!0,reflect:0,observe:!1}})})),it("Should include all listner definitions declared in `static get Listeners()` return oject",(()=>{let t=new e(FakeIoNode1);chai.expect(Object.keys(t.listeners)).to.be.eql(["listener1","listener3","listener4"]),chai.expect(t.listeners.listener1).to.be.eql([["function1"]]),chai.expect(t.listeners.listener3).to.be.eql([["_onFunction1",{capture:!0}]]),chai.expect(String(t.listeners.listener4)).to.be.eql(String([[()=>{}]])),t=new e(FakeIoNode2),chai.expect(Object.keys(t.listeners)).to.be.eql(["listener1","listener3","listener4","listener2"]),chai.expect(t.listeners.listener1).to.be.eql([["function1"],["_onFunction2"]]),chai.expect(t.listeners.listener2).to.be.eql([["function2",{capture:!0,passive:!0}]]),chai.expect(t.listeners.listener3).to.be.eql([["_onFunction1",{capture:!0,passive:!0}]]),chai.expect(String(t.listeners.listener4)).to.be.eql(String([[()=>{}]]))})),it("Should include all style strings declared in `static get Style()` return string",(()=>{let t=new e(FakeIoNode1);chai.expect(t.style).to.be.equal("a\n"),t=new e(FakeIoNode2),chai.expect(t.style).to.be.equal("a\nb\n"),t=new e(FakeIoNode3),chai.expect(t.style).to.be.equal("a\nb\n")})),it("Should include all property names of observed object properties",(()=>{let t=new e(FakeIoNode1);chai.expect(t.observedObjectProperties).to.be.eql([]),t=new e(FakeIoNode2),chai.expect(t.observedObjectProperties).to.be.eql(["prop1"])}))}))}}var __decorate$5=function(e,t,o,n){var a,i=arguments.length,p=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(p=(i<3?a(p):i>3?a(t,o,p):a(t,o))||p);return i>3&&p&&Object.defineProperty(t,o,p),p};class Object1{prop=!0}let d=class TestIoNode extends t{static get Properties(){return{label:""}}};d=__decorate$5([r],d);class Property{run(){describe("Property",(()=>{it("Should initialize correct property definitions and values from weakly typed property definitions",(()=>{let e,t;e=new a({}),t=new i(e),chai.expect(e).to.be.eql(t).to.be.eql({value:void 0,type:void 0,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a(null),t=new i(e),chai.expect(e).to.be.eql(t).to.be.eql({value:null,type:void 0,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a(void 0),t=new i(e),chai.expect(e).to.be.eql(t).to.be.eql({value:void 0,type:void 0,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a(Number),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:Number,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:0,type:Number,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a({type:Number}),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:Number,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:0,type:Number,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a(1),t=new i(e),chai.expect(t).to.be.eql(e).to.be.eql({value:1,type:Number,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a({value:2}),t=new i(e),chai.expect(t).to.be.eql(e).to.be.eql({value:2,type:Number,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a(String),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:String,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:"",type:String,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a({type:String}),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:String,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:"",type:String,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a("test"),t=new i(e),chai.expect(t).to.be.eql(e).to.be.eql({value:"test",type:String,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a({value:"test"}),t=new i(e),chai.expect(t).to.be.eql(e).to.be.eql({value:"test",type:String,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a(Boolean),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:Boolean,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:!1,type:Boolean,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a({type:Boolean}),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:Boolean,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:!1,type:Boolean,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a(!0),t=new i(e),chai.expect(t).to.be.eql(e).to.be.eql({value:!0,type:Boolean,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a({value:!0}),t=new i(e),chai.expect(t).to.be.eql(e).to.be.eql({value:!0,type:Boolean,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a(Object),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:Object,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:{},type:Object,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a({type:Object}),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:Object,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:{},type:Object,binding:void 0,reflect:0,notify:!0,observe:!1});const o={prop:!0};e=new a({value:o}),t=new i(e),chai.expect(t).to.be.eql(e).to.be.eql({value:{prop:!0},type:Object,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(e.value).to.equal(o),chai.expect(t.value).to.equal(o),e=new a(Array),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:Array,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:[],type:Array,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a({type:Array}),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:Array,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:[],type:Array,binding:void 0,reflect:0,notify:!0,observe:!1});const n=[1,2,3];e=new a({value:n}),t=new i(e),chai.expect(t).to.be.eql(e).to.be.eql({value:[1,2,3],type:Array,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(e.value).to.equal(n),chai.expect(t.value).to.equal(n),e=new a(Object1),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:Object1,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:new Object1,type:Object1,binding:void 0,reflect:0,notify:!0,observe:!1});const p=new Object1;e=new a({value:p}),t=new i(e),chai.expect(e).to.be.eql({value:p,type:Object1,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:new Object1,type:Object1,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(e.value).to.equal(p),chai.expect(t.value).to.equal(p),e=new a({type:Object1}),t=new i(e),chai.expect(e).to.be.eql({value:void 0,type:Object1,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(t).to.be.eql({value:new Object1,type:Object1,binding:void 0,reflect:0,notify:!0,observe:!1}),e=new a({reflect:-1,notify:!1,observe:!0}),t=new i(e),chai.expect(e).to.be.eql(t).to.be.eql({value:void 0,type:void 0,binding:void 0,reflect:-1,notify:!1,observe:!0})})),it("Should initialize properties with binding correctly",(()=>{let e,t,o=new p(new d({label:"lorem"}),"label");e=new a(o),t=new i(e),chai.expect(e).to.be.eql(t).to.be.eql({value:"lorem",type:String,binding:o,reflect:0,notify:!0,observe:!1}),o=new p(new d({label:"lorem"}),"label"),e=new a({binding:o,value:"ipsum"}),t=new i(e),chai.expect(e).to.be.eql(t).to.be.eql({value:"lorem",type:String,binding:o,reflect:0,notify:!0,observe:!1})})),it("Should assign property definitions correctly",(()=>{const e=new p(new d({label:"lorem"}),"label");let t=new a({}),o=new a({value:"lorem",type:String,binding:e,reflect:2,notify:!1,observe:!0});c(t,o),chai.expect(t).to.be.eql(o),t=new a({}),o=new a({value:"lorem",type:String,binding:e,reflect:2,notify:!1,observe:!0}),c(o,t),chai.expect(t).to.be.eql({value:void 0,type:void 0,binding:void 0,reflect:0,notify:!0,observe:!1}),chai.expect(o).to.be.eql({value:"lorem",type:String,binding:e,reflect:2,notify:!1,observe:!0}),t=new a({reflect:2,notify:!0}),o=new a({value:"lorem",type:String,reflect:1}),c(o,t),chai.expect(o).to.be.eql({value:"lorem",binding:void 0,type:String,reflect:2,notify:!0,observe:!1})}))}))}}var __decorate$4=function(e,t,o,n){var a,i=arguments.length,p=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(p=(i<3?a(p):i>3?a(t,o,p):a(t,o))||p);return i>3&&p&&Object.defineProperty(t,o,p),p};let u=class TestIoNode extends t{static get Properties(){return{prop1:0,prop2:0}}};u=__decorate$4([r],u);class Binding{run(){describe("Binding",(()=>{it("Should initialize with correct default values",(()=>{const e=new u,t=new p(e,"prop1");chai.expect(t.node).to.be.equal(e),chai.expect(t.property).to.be.equal("prop1"),chai.expect(t.targets instanceof Array).to.be.equal(!0),chai.expect(t.targets.length).to.be.equal(0),chai.expect(t.targetProperties instanceof WeakMap).to.be.equal(!0)})),it("Should get and set property value on source node with `value` getter/setter",(()=>{const e=new u,t=new p(e,"prop1");e.prop1=1,chai.expect(t.value).to.be.equal(1),e.prop1=2,chai.expect(t.value).to.be.equal(2),t.value=3,chai.expect(e.prop1).to.be.equal(3)})),it("Should add/remove target nodes and properties with `.addTarget()` and `removeTarget()`",(()=>{const e=new u,t=new p(e,"prop1"),o=new p(e,"prop2"),n=new u,a=new u;t.addTarget(n,"prop1"),o.addTarget(n,"prop2"),o.addTarget(a,"prop1"),o.addTarget(a,"prop2"),chai.expect(e._eventDispatcher.addedListeners).to.be.eql({"prop1-changed":[[t.onSourceChanged]],"prop2-changed":[[o.onSourceChanged]]}),chai.expect(n._eventDispatcher.addedListeners).to.be.eql({"prop1-changed":[[t.onTargetChanged]],"prop2-changed":[[o.onTargetChanged]]}),chai.expect(a._eventDispatcher.addedListeners).to.be.eql({"prop1-changed":[[o.onTargetChanged]],"prop2-changed":[[o.onTargetChanged]]}),chai.expect(t.targets[0]).to.be.equal(n),chai.expect(t.targets[1]).to.be.equal(void 0),chai.expect(o.targets[0]).to.be.equal(n),chai.expect(o.targets[1]).to.be.equal(a),chai.expect(o.targets[2]).to.be.equal(void 0),chai.expect(n._properties.prop1.binding).to.be.equal(t),chai.expect(n._properties.prop2.binding).to.be.equal(o),chai.expect(a._properties.prop1.binding).to.be.equal(o),chai.expect(a._properties.prop2.binding).to.be.equal(o);const i=t.getTargetProperties(n),c=t.getTargetProperties(a);chai.expect(i[0]).to.be.equal("prop1"),chai.expect(i.length).to.be.equal(1),chai.expect(c.length).to.be.equal(0);const r=o.getTargetProperties(n),l=o.getTargetProperties(a);chai.expect(r[0]).to.be.equal("prop2"),chai.expect(r.length).to.be.equal(1),chai.expect(l[0]).to.be.equal("prop1"),chai.expect(l[1]).to.be.equal("prop2"),chai.expect(l.length).to.be.equal(2),o.removeTarget(a,"prop1"),chai.expect(l[0]).to.be.equal("prop2"),chai.expect(l.length).to.be.equal(1),chai.expect(a._properties.prop1.binding).to.be.equal(void 0),chai.expect(a._eventDispatcher.addedListeners).to.be.eql({"prop2-changed":[[o.onTargetChanged]]}),o.addTarget(a,"prop1"),chai.expect(l.length).to.be.equal(2),chai.expect(a._properties.prop1.binding).to.be.equal(o),o.removeTarget(a),chai.expect(l.length).to.be.equal(0),chai.expect(a._properties.prop1.binding).to.be.equal(void 0),chai.expect(a._properties.prop2.binding).to.be.equal(void 0),chai.expect(a._eventDispatcher.addedListeners).to.be.eql({})})),it("Should dispose correctly",(()=>{const e=new u,t=new u,o=new p(e,"prop1");o.addTarget(t,"prop1"),chai.expect(e._eventDispatcher.addedListeners).to.be.eql({"prop1-changed":[[o.onSourceChanged]]}),chai.expect(t._eventDispatcher.addedListeners).to.be.eql({"prop1-changed":[[o.onTargetChanged]]}),o.dispose(),chai.expect(o.node).to.be.equal(void 0),chai.expect(o.property).to.be.equal(void 0),chai.expect(o.targets).to.be.equal(void 0),chai.expect(o.targetProperties).to.be.equal(void 0),chai.expect(t._properties.prop1.binding).to.be.equal(void 0),chai.expect(e._eventDispatcher.addedListeners).to.be.eql({}),chai.expect(t._eventDispatcher.addedListeners).to.be.eql({})}))}))}}var __decorate$3=function(e,t,o,n){var a,i=arguments.length,p=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(p=(i<3?a(p):i>3?a(t,o,p):a(t,o))||p);return i>3&&p&&Object.defineProperty(t,o,p),p};const handlerFunction=()=>{};let b=class IoNode1 extends t{handler1Count=0;handler1Detail;static get Listeners(){return{event1:"handler1"}}handler1(e){this.handler1Count++,this.handler1Detail=e.detail}};b=__decorate$3([r],b);let v=class IoNode2 extends b{handler2Count=0;handler3Count=0;handler2Detail;handler3Detail;static get Listeners(){return{event2:["handler2",{capture:!0}]}}handler2(e){this.handler2Count++,this.handler2Detail=e.detail}handler3(e){this.handler3Count++,this.handler3Detail=e.detail}};v=__decorate$3([r],v);let g=class IoNode3 extends v{static get Listeners(){return{event1:"handler3",event2:[handlerFunction,{passive:!0}],event3:handlerFunction}}};g=__decorate$3([r],g);class TestDivEventDispatchElement extends HTMLElement{handler3Count=0;handler3Detail;handler3(e){this.handler3Count++,this.handler3Detail=e.detail}}window.customElements.define("test-div-event-dispatch",TestDivEventDispatchElement);class EventDispatcher{run(){describe("EventDispatcher",(()=>{it("Should initialize with correct values",(()=>{const e={};let t=new l(e);chai.expect(t.node).to.be.equal(e),chai.expect(t.protoListeners).to.be.eql({}),chai.expect(t.propListeners).to.be.eql({}),chai.expect(t.addedListeners).to.be.eql({}),chai.expect(t.isEventTarget).to.be.eql(!1);const o=document.createElement("div");t=new l(o),chai.expect(t.node).to.be.equal(o),chai.expect(t.protoListeners).to.be.eql({}),chai.expect(t.propListeners).to.be.eql({}),chai.expect(t.addedListeners).to.be.eql({}),chai.expect(t.isEventTarget).to.be.equal(!0)})),it("Should initialize listeners from ProtoChain",(()=>{let e=new b,t=new l(e);chai.expect(t.protoListeners).to.be.eql({event1:[[e.handler1]]}),e=new v,t=new l(e),chai.expect(t.protoListeners).to.be.eql({event1:[[e.handler1]],event2:[[e.handler2,{capture:!0}]]}),e=new g,t=new l(e),chai.expect(t.protoListeners).to.be.eql({event1:[[e.handler3]],event2:[[handlerFunction,{passive:!0}]],event3:[[handlerFunction]]})})),it("Should set property listeners correctly",(()=>{const e=new v,t=new l(e),handler4=()=>{},handler5=()=>{};t.applyPropListeners({"on-event3":"handler3","on-event4":handler4}),chai.expect(t.propListeners).to.be.eql({event3:[[e.handler3]],event4:[[handler4]]}),t.applyPropListeners({"on-event5":["handler3"],"on-event6":[handler4]}),chai.expect(t.propListeners).to.be.eql({event5:[[e.handler3]],event6:[[handler4]]}),t.applyPropListeners({"on-event7":[e.handler3,{capture:!0}],"on-event8":[handler5,{capture:!0}]}),chai.expect(t.propListeners).to.be.eql({event7:[[e.handler3,{capture:!0}]],event8:[[handler5,{capture:!0}]]}),t.applyPropListeners({}),chai.expect(t.propListeners).to.be.eql({})})),it("Should add/remove listeners correctly",(()=>{const e=new v,t=new l(e),listener1=()=>{},listener2=()=>{};t.addEventListener("event1",listener1),t.addEventListener("event1",listener2,{capture:!0}),chai.expect(t.addedListeners).to.be.eql({event1:[[listener1],[listener2,{capture:!0}]]}),t.removeEventListener("event1",listener1),chai.expect(t.addedListeners).to.be.eql({event1:[[listener2,{capture:!0}]]}),t.removeEventListener("event1"),chai.expect(t.addedListeners).to.be.eql({})})),it("Should dispatch added events",(()=>{const e=new v,t=new l(e);let o=0;const handler4=()=>{o++};let n=0;const handler5=()=>{n++};t.applyPropListeners({"on-event3":"handler3","on-event4":handler4}),t.addEventListener("event5",handler5),t.dispatchEvent("event1"),t.dispatchEvent("event2"),t.dispatchEvent("event3"),t.dispatchEvent("event4"),t.dispatchEvent("event5"),chai.expect(e.handler1Count).to.be.equal(1),chai.expect(e.handler2Count).to.be.equal(1),chai.expect(e.handler3Count).to.be.equal(1),chai.expect(o).to.be.equal(1),chai.expect(n).to.be.equal(1),t.applyPropListeners({"on-event4":handler4}),t.removeEventListener("event5",handler5),t.dispatchEvent("event1"),t.dispatchEvent("event2"),t.dispatchEvent("event3"),t.dispatchEvent("event4"),t.dispatchEvent("event5"),chai.expect(e.handler1Count).to.be.equal(2),chai.expect(e.handler2Count).to.be.equal(2),chai.expect(e.handler3Count).to.be.equal(1),chai.expect(o).to.be.equal(2),chai.expect(n).to.be.equal(1)})),it("Should dispatch events with correct event detail",(()=>{const e=new v,t=new l(e);let o;let n;t.applyPropListeners({"on-event3":"handler3","on-event4":e=>{o=e.detail}}),t.addEventListener("event5",(e=>{n=e.detail})),t.dispatchEvent("event1","detail1"),t.dispatchEvent("event2","detail2"),t.dispatchEvent("event3","detail3"),t.dispatchEvent("event4","detail4"),t.dispatchEvent("event5","detail5"),chai.expect(e.handler1Detail).to.be.equal("detail1"),chai.expect(e.handler2Detail).to.be.equal("detail2"),chai.expect(e.handler3Detail).to.be.equal("detail3"),chai.expect(o).to.be.equal("detail4"),chai.expect(n).to.be.equal("detail5")})),it("Should add/remove/dispatch events on HTML elements",(()=>{const e=document.createElement("test-div-event-dispatch"),t=new l(e);let o,n=0;let a,i=0;const handler5=e=>{i++,a=e.detail};t.applyPropListeners({"on-event3":"handler3","on-event4":e=>{n++,o=e.detail}}),t.addEventListener("event5",handler5),e.dispatchEvent(new CustomEvent("event3",{detail:"detail3"})),e.dispatchEvent(new CustomEvent("event4",{detail:"detail4"})),e.dispatchEvent(new CustomEvent("event5",{detail:"detail5"})),chai.expect(e.handler3Count).to.be.equal(1),chai.expect(n).to.be.equal(1),chai.expect(i).to.be.equal(1),chai.expect(e.handler3Detail).to.be.equal("detail3"),chai.expect(o).to.be.equal("detail4"),chai.expect(a).to.be.equal("detail5"),t.applyPropListeners({}),t.removeEventListener("event5",handler5),e.dispatchEvent(new CustomEvent("event3",{detail:"detail3i"})),e.dispatchEvent(new CustomEvent("event4",{detail:"detail4i"})),e.dispatchEvent(new CustomEvent("event5",{detail:"detail5i"})),chai.expect(e.handler3Count).to.be.equal(1),chai.expect(n).to.be.equal(1),chai.expect(i).to.be.equal(1),chai.expect(e.handler3Detail).to.be.equal("detail3"),chai.expect(o).to.be.equal("detail4"),chai.expect(a).to.be.equal("detail5")})),it("Should bubble events if specified",(()=>{const e=document.createElement("test-div-event-dispatch"),t=document.createElement("test-div-event-dispatch");t.appendChild(e);const o=new l(e);let n=0;t.addEventListener("event",(()=>{n++})),o.dispatchEvent("event",null,!1),chai.expect(n).to.be.equal(0),o.dispatchEvent("event",null,!0),chai.expect(n).to.be.equal(1),o.dispatchEvent("event"),chai.expect(n).to.be.equal(2)})),it("Should emit event from specified target",(()=>{const e=document.createElement("div"),t=new l(e),o=document.createElement("test-div-event-dispatch"),n=new l(o);n.applyPropListeners({"on-event3":"handler3"});let a=null,i=null;n.addEventListener("event3",(e=>{a=e.path,i=e.target})),t.dispatchEvent("event3","detail",!1,o),chai.expect(o.handler3Detail).to.be.equal("detail"),chai.expect(a).to.be.eql([o]),chai.expect(i).to.be.eql(i)})),it("Should dispose correctly",(()=>{const e=new v,t=new l(e);t.dispose(),chai.expect(t.node).to.be.equal(void 0),chai.expect(t.protoListeners).to.be.equal(void 0),chai.expect(t.propListeners).to.be.equal(void 0),chai.expect(t.addedListeners).to.be.equal(void 0)}))}))}}class FakeIoNode{connected=!0;prop1ChangeCounter=0;prop1Change;prop2ChangeCounter=0;prop2Change;changeCounter=0;eventDispatchCounter=0;eventName;eventChange;eventRegister=[];changeRegister=[];prop1Changed(e){this.prop1Change=e,this.prop1ChangeCounter++,this.changeRegister.push("prop1Changed")}prop2Changed(e){this.prop2Change=e,this.prop2ChangeCounter++,this.changeRegister.push("prop2Changed")}dispatchEvent(e,t){this.eventDispatchCounter++,this.eventName=e,this.eventChange=t,this.eventRegister.push(e)}changed(){this.changeCounter++}}class ChangeQueue{run(){describe("ChangeQueue",(()=>{it("Should initialize with correct default values",(()=>{const e=new FakeIoNode,t=new s(e);chai.expect(t.node).to.be.equal(e),chai.expect(JSON.stringify(t.changes)).to.be.equal("[]"),chai.expect(t.changes.length).to.be.equal(0),chai.expect(t.dispatching).to.be.equal(!1)})),it("Should dispatch change events with correct payloads",(()=>{const e=new FakeIoNode,t=new s(e);t.queue("test",1,0),t.queue("test",2,1),chai.expect(t.changes.length).to.be.equal(1),t.dispatch(),chai.expect(t.changes.length).to.be.equal(0),chai.expect(e.eventName).to.be.equal("test-changed"),chai.expect(e.eventChange?.property).to.be.equal("test"),chai.expect(e.eventChange?.value).to.be.equal(2),chai.expect(e.eventChange?.oldValue).to.be.equal(0),chai.expect(e.eventDispatchCounter).to.be.equal(1),chai.expect(e.changeCounter).to.be.equal(1),t.queue("test2",0,-1),t.queue("test3",2,1),chai.expect(t.changes.length).to.be.equal(2),t.dispatch(),chai.expect(t.changes.length).to.be.equal(0),chai.expect(e.eventName).to.be.equal("test3-changed"),chai.expect(e.eventChange?.property).to.be.equal("test3"),chai.expect(e.eventChange?.value).to.be.equal(2),chai.expect(e.eventChange?.oldValue).to.be.equal(1),chai.expect(e.eventDispatchCounter).to.be.equal(3),chai.expect(e.prop1ChangeCounter).to.be.equal(0),chai.expect(e.changeCounter).to.be.equal(2)})),it("Should invoke handler functions with correct payloads",(()=>{const e=new FakeIoNode,t=new s(e);t.queue("prop1",1,0),t.queue("prop1",2,1),t.dispatch(),chai.expect(e.prop1ChangeCounter).to.be.equal(1),chai.expect(e.changeCounter).to.be.equal(1),chai.expect(e.prop1Change?.property).to.be.equal("prop1"),chai.expect(e.prop1Change?.value).to.be.equal(2),chai.expect(e.prop1Change?.oldValue).to.be.equal(0)})),it("Should handle changes in first-in, first-out (FIFO) order",(()=>{const e=new FakeIoNode,t=new s(e);t.queue("prop1",1,0),t.queue("prop1",3,0),t.queue("prop2",2,0),t.dispatch(),chai.expect(JSON.stringify(e.changeRegister)).to.be.equal('["prop1Changed","prop2Changed"]'),chai.expect(JSON.stringify(e.eventRegister)).to.be.equal('["prop1-changed","prop2-changed"]')})),it("Should skip dispatch if value is same as oldValue",(()=>{const e=new FakeIoNode,t=new s(e);t.queue("prop1",0,0),t.dispatch(),chai.expect(e.prop1ChangeCounter).to.be.equal(0)})),it("Should dispose correctly",(()=>{const e=new FakeIoNode,t=new s(e);t.dispose(),chai.expect(t.node).to.be.equal(void 0),chai.expect(t.changes).to.be.equal(void 0)}))}))}}var __decorate$2=function(e,t,o,n){var a,i=arguments.length,p=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(p=(i<3?a(p):i>3?a(t,o,p):a(t,o))||p);return i>3&&p&&Object.defineProperty(t,o,p),p};class Node{run(){describe("IoNode",(()=>{describe("Registration",(()=>{it("Should have core API functions defined",(()=>{const e=new t;chai.expect(e.setProperty).to.be.a("function"),chai.expect(e.applyProperties).to.be.a("function"),chai.expect(e.setProperties).to.be.a("function"),chai.expect(e.setValue).to.be.a("function"),chai.expect(e.changed).to.be.a("function"),chai.expect(e.queue).to.be.a("function"),chai.expect(e.dispatchQueue).to.be.a("function"),chai.expect(e.dispatchQueueSync).to.be.a("function"),chai.expect(e.throttle).to.be.a("function"),chai.expect(e.onObjectMutated).to.be.a("function"),chai.expect(e.objectMutated).to.be.a("function"),chai.expect(e.bind).to.be.a("function"),chai.expect(e.unbind).to.be.a("function"),chai.expect(e.addEventListener).to.be.a("function"),chai.expect(e.removeEventListener).to.be.a("function"),chai.expect(e.dispatchEvent).to.be.a("function"),chai.expect(e.dispose).to.be.a("function"),e.dispose()})),it("Should register property definitions correctly",(()=>{let e=class TestNode extends t{static get Properties(){return{prop0:{type:String},prop1:{value:!1},prop2:-1,prop3:Number,prop4:Object,prop5:[0,1,2]}}};e=__decorate$2([r],e);const o=new e;chai.expect(o.prop0).to.be.equal(""),chai.expect(o.prop1).to.be.equal(!1),chai.expect(o.prop2).to.be.equal(-1),chai.expect(o.prop3).to.be.equal(0),chai.expect(o.prop4).to.be.deep.equal({}),chai.expect(o.prop5).to.be.deep.equal([0,1,2]),o.dispose()})),it("Should aggregate property definitions from protochain",(()=>{let e=class Object1 extends t{static get Properties(){return{prop1:{value:0},prop2:null}}};e=__decorate$2([r],e);let o=class Object2 extends e{static get Properties(){return{prop1:{value:{},notify:!1,observe:!0},prop2:{notify:!0},prop3:""}}};o=__decorate$2([r],o);const n=new e,a=new o,i=n._protochain.properties,p=a._protochain.properties,c=n._properties,l=a._properties;chai.expect(Object.keys(c)).to.be.eql(["lazy","prop1","prop2"]),chai.expect(Object.keys(l)).to.be.eql(["lazy","prop1","prop2","prop3"]),chai.expect(i.prop1.value).to.be.equal(0),chai.expect(c.prop1.value).to.be.equal(0),chai.expect(c.prop1.type).to.be.equal(Number),chai.expect(c.prop1.notify).to.be.equal(!0),chai.expect(c.prop1.reflect).to.be.equal(0),chai.expect(c.prop1.observe).to.be.equal(!1),chai.expect(p.prop1.value).to.be.eql({}),chai.expect(l.prop1.value).to.be.eql({}),chai.expect(l.prop1.type).to.be.equal(Object),chai.expect(l.prop1.notify).to.be.equal(!1),chai.expect(l.prop1.reflect).to.be.equal(0),chai.expect(l.prop1.observe).to.be.equal(!0),chai.expect(l.prop2.value).to.be.equal(null),chai.expect(l.prop2.type).to.be.equal(void 0),chai.expect(l.prop2.notify).to.be.equal(!0),chai.expect(l.prop2.observe).to.be.equal(!1)})),it("Should favor explicit property definitions over implicit",(()=>{const t=new e(class Object2 extends class Object1{static get Properties(){return{prop1:{value:{},notify:!1,reflect:2,observe:!0}}}}{static get Properties(){return{prop1:[1,2,3]}}}).properties;chai.expect(t.prop1.value).to.be.eql([1,2,3]),chai.expect(t.prop1.type).to.be.equal(Array),chai.expect(t.prop1.notify).to.be.equal(!1),chai.expect(t.prop1.reflect).to.be.equal(2),chai.expect(t.prop1.observe).to.be.equal(!0)})),it("Should correctly register properties with bindigs",(()=>{let e=class TestNode extends t{static get Properties(){return{label:""}}};e=__decorate$2([r],e);const o=new p(new e({label:"binding1"}),"label"),n=new p(new e({label:"binding2"}),"label"),a=new p(new e({label:"binding3"}),"label");let i=class Object1 extends t{static get Properties(){return{prop1:o}}};i=__decorate$2([r],i);let c=class Object2 extends i{static get Properties(){return{prop1:{binding:n},prop3:a}}};c=__decorate$2([r],c);const l=new i,s=new c,h=l._properties,d=s._properties;chai.expect(h.prop1.binding).to.be.equal(o),chai.expect(d.prop1.binding).to.be.equal(n),chai.expect(d.prop3.binding).to.be.equal(a),chai.expect(o.targets[0]).to.be.equal(l),chai.expect(n.targets[0]).to.be.equal(s),chai.expect(a.targets[0]).to.be.equal(s),chai.expect(h.prop1.value).to.be.equal("binding1"),chai.expect(d.prop1.value).to.be.equal("binding2"),chai.expect(d.prop3.value).to.be.equal("binding3")}))})),describe("Construction",(()=>{})),describe("Properties",(()=>{it("Should correctly get/set properties",(()=>{let e=class TestNode extends t{static get Properties(){return{prop1:{value:1}}}};e=__decorate$2([r],e);const o=new e,n=o._properties;chai.expect(n.prop1.value).to.be.equal(1),chai.expect(o.prop1).to.be.equal(1),o.setProperty("prop1",0),chai.expect(n.prop1.value).to.be.equal(0),chai.expect(o.prop1).to.be.equal(0)})),it("Should correctly get/set bound properties",(()=>{let e=class TestNode extends t{static get Properties(){return{label:""}}};e=__decorate$2([r],e);const o=new p(new e({label:"binding1"}),"label"),n=new p(new e({label:"binding2"}),"label");let a=class TestNode2 extends t{static get Properties(){return{prop1:o}}};a=__decorate$2([r],a);const i=new a,c=i._properties;chai.expect(c.prop1.value).to.be.equal("binding1"),chai.expect(i.prop1).to.be.equal("binding1"),chai.expect(c.prop1.binding).to.be.equal(o),chai.expect(o.targets[0]).to.be.equal(i),o.removeTarget(i,"prop1"),i._properties.prop1.binding=void 0,i.setProperty("prop1",n),chai.expect(c.prop1.value).to.be.equal("binding2"),chai.expect(i.prop1).to.be.equal("binding2"),chai.expect(o.targets[0]).to.be.equal(void 0),chai.expect(n.targets[0]).to.be.equal(i)})),it("Should execute attribute reflection on IoElement",(()=>{let e=class TestElementReflection extends o{static get Properties(){return{label:{value:"label1",reflect:1}}}};e=__decorate$2([h],e);const t=new e;chai.expect(t.getAttribute("label")).to.be.equal("label1"),t.label="label2",chai.expect(t.getAttribute("label")).to.be.equal("label2"),t.setProperty("label","label3"),chai.expect(t.getAttribute("label")).to.be.equal("label3")})),it("Should dipatch queue on object value initialization and value set",(()=>{let e=class TestNode extends t{static get Properties(){return{prop:Object}}};e=__decorate$2([r],e);const o=new e;o.addEventListener("prop-changed",(e=>{const t=e.detail.value,o=e.detail.oldValue;chai.expect(t).to.be.eql({}),chai.expect(o).to.be.equal(void 0)})),o.removeEventListener("prop-changed"),o.addEventListener("prop-changed",(e=>{const t=e.detail.value,o=e.detail.oldValue;chai.expect(t).to.be.eql({}),chai.expect(o).to.be.eql({})})),o.prop={},o.removeEventListener("prop-changed"),o.addEventListener("prop-changed",(()=>{chai.expect("This should never happen!").to.be.equal(!0)})),o.setProperty("prop",{},!0)})),it("Should connect/disconnect IoNode-property-values on construction and value set",(()=>{let e=class TestNodeValue extends t{static get Properties(){return{prop:Object,propChangeCounter:0}}propChanged(){this.propChangeCounter++}};e=__decorate$2([r],e);let o=class TestNode extends t{static get Properties(){return{prop:e}}};o=__decorate$2([r],o);const n=new o,a=n.prop;chai.expect(a.propChangeCounter).to.be.equal(1),a.prop={},a.prop={},chai.expect(a.propChangeCounter).to.be.equal(3),a.prop={},chai.expect(a.propChangeCounter).to.be.equal(4),n.prop=new e;const i=n.prop;a.prop={},chai.expect(a.propChangeCounter).to.be.equal(5),chai.expect(i.propChangeCounter).to.be.equal(1)}))})),describe("Reactivity",(()=>{it("Should corectly invoke handler functions on change",(()=>{let e=class TestNode extends t{_changedCounter=0;_prop1ChangedCounter=0;_prop1Change=null;_prop2ChangedCounter=0;_prop2Change=null;static get Properties(){return{prop1:String,prop2:String}}changed(){this._changedCounter++}prop1Changed(e){this._prop1ChangedCounter++,this._prop1Change=e}prop2Changed(e){this._prop2ChangedCounter++,this._prop2Change=e}};e=__decorate$2([r],e);const o=new e;chai.expect(o._changedCounter).to.equal(0),chai.expect(o._prop1ChangedCounter).to.equal(0),chai.expect(o._prop2ChangedCounter).to.equal(0),chai.expect(o._prop1Change?.property).to.equal(void 0),chai.expect(o._prop1Change?.oldValue).to.equal(void 0),chai.expect(o._prop1Change?.value).to.equal(void 0),chai.expect(o._prop2ChangedCounter).to.equal(0),chai.expect(o._prop2Change?.property).to.equal(void 0),chai.expect(o._prop2Change?.oldValue).to.equal(void 0),chai.expect(o._prop2Change?.value).to.equal(void 0),o.prop1="one",chai.expect(o._changedCounter).to.equal(1),chai.expect(o._prop1ChangedCounter).to.equal(1),chai.expect(o._prop2ChangedCounter).to.equal(0),chai.expect(o._prop1Change?.property).to.equal("prop1"),chai.expect(o._prop1Change?.oldValue).to.equal(""),chai.expect(o._prop1Change?.value).to.equal("one"),o.prop1="two",o.prop2="test",chai.expect(o._changedCounter).to.equal(3),chai.expect(o._prop1ChangedCounter).to.equal(2),chai.expect(o._prop1Change?.property).to.equal("prop1"),chai.expect(o._prop1Change?.oldValue).to.equal("one"),chai.expect(o._prop1Change?.value).to.equal("two"),chai.expect(o._prop2ChangedCounter).to.equal(1),chai.expect(o._prop2Change?.property).to.equal("prop2"),chai.expect(o._prop2Change?.oldValue).to.equal(""),chai.expect(o._prop2Change?.value).to.equal("test"),o.setProperties({prop1:"three",prop2:""}),chai.expect(o._changedCounter).to.equal(4),chai.expect(o._prop1ChangedCounter).to.equal(3),chai.expect(o._prop1Change?.property).to.equal("prop1"),chai.expect(o._prop1Change?.oldValue).to.equal("two"),chai.expect(o._prop1Change?.value).to.equal("three"),chai.expect(o._prop2ChangedCounter).to.equal(2),chai.expect(o._prop2Change?.property).to.equal("prop2"),chai.expect(o._prop2Change?.oldValue).to.equal("test"),chai.expect(o._prop2Change?.value).to.equal(""),o.dispose()})),it("should invoke property mutation handler functions on mutation event",(async()=>{let e=class TestNode extends t{_changedCounter=0;_obj1MutatedCounter=0;_obj2MutatedCounter=0;static get Properties(){return{obj1:{type:Object,observe:!0},obj2:{type:Object,observe:!0}}}changed(){this._changedCounter++}obj1Mutated(){this._obj1MutatedCounter++}obj2Mutated(){this._obj2MutatedCounter++}};e=__decorate$2([r],e);const o=new e;chai.expect(o._changedCounter).to.equal(0),chai.expect(o._obj1MutatedCounter).to.equal(0),o.dispatchEvent("object-mutated",{object:o.obj1},!1,window),await nextTick(),chai.expect(o._changedCounter).to.equal(1),chai.expect(o._obj1MutatedCounter).to.equal(1),chai.expect(o._obj2MutatedCounter).to.equal(0),o.dispatchEvent("object-mutated",{object:o.obj2},!1,window),await nextTick(),o.dispose()})),it("should fire change events when connected",(()=>{let e=class TestNode extends t{static get Properties(){return{prop1:String,_onProp1ChangedCounter:0,_onProp1Change:null,_onCustomEventCounter:0,_onCustomEven:null}}static get Listeners(){return{"prop1-changed":"onProp1Changed","custom-event":"onCustomEvent"}}onProp1Changed(e){this._onProp1ChangedCounter++,this._onProp1Change=e}onCustomEvent(e){this._onCustomEventCounter++,this._onCustomEven=e}};e=__decorate$2([r],e);const o=new e;o.prop1="one",chai.expect(o._onProp1ChangedCounter).to.equal(1),chai.expect(o._onProp1Change.detail.property).to.equal("prop1"),chai.expect(o._onProp1Change.detail.oldValue).to.equal(""),chai.expect(o._onProp1Change.detail.value).to.equal("one"),o.dispatchEvent("custom-event",{value:"hello"}),chai.expect(o._onCustomEventCounter).to.equal(1),chai.expect(o._onCustomEven.path[0]).to.equal(o),chai.expect(o._onCustomEven.detail.value).to.equal("hello")}))})),describe("Binding",(()=>{it("should correctly bind properties",(()=>{let e=class TestNode extends t{static get Properties(){return{prop1:String,prop2:String}}};e=__decorate$2([r],e);const o=new e,n=o.bind("prop1");chai.expect(n).to.be.instanceof(p),chai.expect(n.node).to.be.equal(o),chai.expect(n.property).to.be.equal("prop1");const a=new e({prop1:n}),i=new e({prop1:n});i.prop2=n,chai.expect(n.targets[0]).to.be.equal(a),chai.expect(n.targets[1]).to.be.equal(i),chai.expect(n.targetProperties.get(a)[0]).to.be.equal("prop1"),chai.expect(n.targetProperties.get(a)[1]).to.be.equal(void 0),chai.expect(n.targetProperties.get(i)[0]).to.be.equal("prop1"),chai.expect(n.targetProperties.get(i)[1]).to.be.equal("prop2"),o.prop1="one",chai.expect(a.prop1).to.be.equal("one"),chai.expect(a.prop2).to.be.equal(""),chai.expect(i.prop1).to.be.equal("one"),chai.expect(i.prop2).to.be.equal("one"),a.prop1="two",chai.expect(o.prop1).to.be.equal("two"),chai.expect(i.prop1).to.be.equal("two"),chai.expect(n.targets.length).to.be.equal(2),a.dispose(),chai.expect(n.targets.length).to.be.equal(1),i.dispose(),chai.expect(n.targets.length).to.be.equal(0),o.dispose()})),it("Should add/remove targets and targetProperties when assigned to values",(()=>{let e=class TestNode extends t{static get Properties(){return{prop1:String,prop2:String}}};e=__decorate$2([r],e);const o=new e,n=new p(o,"prop1"),a=new p(o,"prop2"),i=new e;i.prop1=n,i.prop2=a;const c=new e({prop1:n}),l=new e({prop1:n,prop2:n});chai.expect(n.targets[0]).to.be.equal(i),chai.expect(n.targets[1]).to.be.equal(c),chai.expect(n.targets[2]).to.be.equal(l),chai.expect(n.targetProperties.get(i)).to.be.eql(["prop1"]),chai.expect(n.targetProperties.get(c)).to.be.eql(["prop1"]),chai.expect(n.targetProperties.get(l)).to.be.eql(["prop1","prop2"]),i.dispose(),c.unbind("prop1"),l.unbind("prop1"),chai.expect(n.targetProperties.get(i)).to.be.eql([]),chai.expect(n.targetProperties.get(c)).to.be.eql([]),chai.expect(n.targetProperties.get(l)).to.be.eql(["prop2"]),c.prop2=n,c.prop1=n,l.prop1=n,chai.expect(n.targetProperties.get(c)).to.be.eql(["prop2","prop1"]),chai.expect(n.targetProperties.get(l)).to.be.eql(["prop2","prop1"])})),it('Should return existing binding or create a new on "bind()"',(()=>{let e=class TestNode extends t{static get Properties(){return{prop1:String,prop2:String}}};e=__decorate$2([r],e);const o=new e,n=o.bind("prop1");chai.expect(n).to.be.equal(o._bindings.prop1),chai.expect(n).to.be.equal(o.bind("prop1"))})),it("Should dispose bindings correctly",(()=>{let e=class TestNode extends t{static get Properties(){return{prop1:String,prop2:String}}};e=__decorate$2([r],e);const o=new e,n=o.bind("prop1");o.unbind("prop1"),chai.expect(o._bindings.prop1).to.be.equal(void 0),chai.expect(n.prop1).to.be.equal(void 0);const a=new e,i=a.bind("prop1");a.dispose(),chai.expect(a._bindings).to.be.eql({}),chai.expect(i.prop1).to.be.equal(void 0)}))}))}))}}var __decorate$1=function(e,t,o,n){var a,i=arguments.length,p=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(p=(i<3?a(p):i>3?a(t,o,p):a(t,o))||p);return i>3&&p&&Object.defineProperty(t,o,p),p};let x=class TestNode extends t{static get Properties(){return{prop0:String,prop2:1/0}}};x=__decorate$1([r],x);let q=class TestElement extends o{static get Properties(){return{prop0:-1,prop1:{value:"default"},_changedCounter:0,_prop1ChangedCounter:0,_prop1AltCounter:0,_prop1ChangeEvent:null,debug:!0}}static get Listeners(){return{"prop0-changed":"onProp1Change","custom-event":"onCustomEvent"}}reset(){this.prop0=-1,this.prop1="default",this._changedCounter=0,this._prop1ChangedCounter=0,this._prop1AltCounter=0,this._prop1Counter=0,this._customHandlerCounter=0,this._prop1AltChangeEvent=null,this._prop1ChangeEvent=null,this._customHandlerChangeEvent=null}constructor(e){super(e),this.template([["test-subelement",{id:"subelement",prop0:this.bind("prop0")}]]),this.subnode=new x({prop2:this.bind("prop0")})}changed(){this._changedCounter++}prop1Changed(e){this._prop1ChangedCounter++,this._prop1ChangedChange=e}onProp1ChangeAlt(e){this._prop1AltCounter++,this._prop1AltChangeEvent=e}onProp1Change(e){this._prop1Counter++,this._prop1ChangeEvent=e}onCustomEvent(e){this._customHandlerCounter++,this._customHandlerChangeEvent=e}};q=__decorate$1([h],q);let y=class TestSubelement extends o{static get Properties(){return{prop0:0}}};y=__decorate$1([h],y);class Element{_changedCounter;element;constructor(){this._changedCounter=0,this.element=new q({"on-prop0-changed":this.changed.bind(this),"on-prop1-changed":"onProp1ChangeAlt",debug:!0}),document.body.appendChild(this.element)}changed(e){e.target===this.element&&this._changedCounter++}reset(){this.element.reset(),this._changedCounter=0}run(){describe("IoElement",(()=>{describe("Registration",(()=>{it("Should have core API functions defined",(()=>{chai.expect(this.element.id).to.be.equal(""),chai.expect(this.element.tabindex).to.be.equal(""),chai.expect(this.element.contenteditable).to.be.equal(!1),chai.expect(this.element.title).to.be.equal(""),chai.expect(this.element.$).to.be.a("object"),chai.expect(this.element.template).to.be.a("function"),chai.expect(this.element.traverse).to.be.a("function")})),it("Should initialize property definitions correctly",(()=>{chai.expect(this.element.prop0).to.equal(-1),chai.expect(this.element.prop1).to.equal("default")}))})),describe("Construction",(()=>{})),describe("Reactivity",(()=>{it("Should corectly invoke handler functions on change",(()=>{this.reset(),this.element.prop0=1,this.element.prop1="test",chai.expect(this.element._prop1AltCounter).to.equal(1),chai.expect(this.element._changedCounter).to.equal(2),chai.expect(this._changedCounter).to.equal(1)})),it("Should dispatch correct event payloads to handlers",(()=>{this.reset(),this.element.prop0=1,this.element.prop0=0,chai.expect(this.element._prop1ChangeEvent.srcElement).to.equal(this.element),chai.expect(this.element._prop1ChangeEvent.detail.value).to.equal(0),this.element.$.subelement.prop0=2,chai.expect(this.element._prop1ChangeEvent.detail.oldValue).to.equal(0),chai.expect(this.element._prop1ChangeEvent.detail.value).to.equal(2),this.element.dispatchEvent("custom-event",{data:"io"}),chai.expect(this.element._customHandlerChangeEvent.detail.data).to.equal("io")}))})),describe("Binding",(()=>{it("Should update bound values correctly",(()=>{this.element.prop0=1/0,chai.expect(this.element.$.subelement.prop0).to.equal(1/0),this.element.$.subelement.prop0=0,chai.expect(this.element.prop0).to.equal(0)})),it("Should bind to Node node",(()=>{this.element.prop0=1/0,chai.expect(this.element.subnode.prop2).to.equal(1/0),this.element.subnode.prop2=0,chai.expect(this.element.prop0).to.equal(0)})),it("Should disconnect binding when Node node is disconnected",(()=>{this.element.prop0=1/0,chai.expect(this.element.subnode.prop2).to.equal(1/0),this.element.subnode.prop2=2,chai.expect(this.element.prop0).to.equal(2)}))}))}))}}var __decorate=function(e,t,o,n){var a,i=arguments.length,p=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(p=(i<3?a(p):i>3?a(t,o,p):a(t,o))||p);return i>3&&p&&Object.defineProperty(t,o,p),p};mocha.setup("bdd");const f=document.createElement("div");f.setAttribute("id","mocha"),document.body.appendChild(f),f.style.display="none";let C=!1;async function nextTick(){return new Promise((e=>{setTimeout((()=>{e()}))}))}let w=class IoTest extends o{static get Style(){return"\n      :host #mocha {\n        margin: 0;\n        position: relative;\n      }\n      :host #mocha-report {\n        margin: 2em 1em;\n      }\n      :host #mocha-stats {\n        position: absolute;\n        top: -2em;\n        right: 2em;\n        font-size: 12px;\n        margin: 0;\n      }\n      :host #mocha-stats em {\n        color: var(--io-color);\n      }\n      :host #mocha-stats li {\n        padding: 0;\n      }\n      :host #mocha-stats .progress {\n        display: none;\n      }\n      :host #mocha-stats .passes {\n        color: #0c0;\n      }\n      :host #mocha-stats .failures {\n        color: #f00;\n        font-weight: bold;\n      }\n      :host h2 {\n        padding-right: 2em;\n      }\n      :host .replay {\n        display: none !important;\n      }\n    "}connectedCallback(){super.connectedCallback(),this.appendChild(f),f.style.display="block",function runTests(){C||((new ProtoChain).run(),(new Property).run(),(new Binding).run(),(new EventDispatcher).run(),(new ChangeQueue).run(),(new Node).run(),(new Element).run(),mocha.checkLeaks(),mocha.run(),C=!0)}(),setTimeout((()=>{this.parentElement.scrollTop=this.parentElement.scrollHeight}),100)}disconnectedCallback(){super.disconnectedCallback(),document.body.appendChild(f),f.style.display="none"}};w=__decorate([h],w);export{w as IoTest,nextTick};
