{"version":3,"file":"line.js","sourceRoot":"","sources":["../../src/game/line.ts"],"names":[],"mappings":"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","sourcesContent":["export interface LineData {\n  ID: number\n  pos: [number, number][]\n  layer: number\n  readonly?: boolean\n}\n\nexport class Line {\n  ID: number\n  pos: [number, number][]\n  layer: number\n  readonly: boolean\n  constructor(ID: number, pos: [number, number], layer: number) {\n    this.ID = ID\n    this.pos = [pos]\n    this.layer = layer\n    this.readonly = false\n  }\n\n  /**\n   * Add a grid segment.\n   * Returns false if the segment was rejected.\n   */\n  addSegment(x: number, y: number): boolean {\n    if (!this._checkErase(x, y)) return false\n    if (!this._checkDirection(x, y)) return false\n\n    this.pos.push([x, y])\n    return true\n  }\n\n  removeLast(): void {\n    this.pos.pop()\n  }\n\n  toJSON(): LineData {\n    return { ID: this.ID, pos: this.pos, layer: this.layer }\n  }\n\n  static fromJSON(data: LineData & { color?: string }): Line {\n    const layer =\n      'layer' in data && typeof data.layer === 'number'\n        ? data.layer\n        : data.color === 'grey'\n          ? -1\n          : 0\n    const line = new Line(data.ID, data.pos[0], layer)\n    for (let j = 1; j < data.pos.length; j++) {\n      line.addSegment(data.pos[j][0], data.pos[j][1])\n    }\n    if (data.readonly) line.readonly = true\n    return line\n  }\n\n  /** Prevent backtracking over more than one step. */\n  private _checkDirection(x: number, y: number): boolean {\n    const ln = this.pos.length\n    if (ln > 1) {\n      if (y === this.pos[ln - 2][1] && Math.abs(x - this.pos[ln - 2][0]) === 1)\n        return false\n      if (x === this.pos[ln - 2][0] && Math.abs(y - this.pos[ln - 2][1]) === 1)\n        return false\n    }\n    const last = this.pos[ln - 1]\n    if (Math.abs(last[0] - x) > 1) return false\n    if (Math.abs(last[1] - y) > 1) return false\n    return true\n  }\n\n  /** Erase last segment if user drags back to prev node. */\n  private _checkErase(x: number, y: number): boolean {\n    const ln = this.pos.length\n    if (ln < 2) return true\n    if (x === this.pos[ln - 2][0] && y === this.pos[ln - 2][1]) {\n      this.removeLast()\n      return false\n    }\n    return true\n  }\n\n}\n\n"]}