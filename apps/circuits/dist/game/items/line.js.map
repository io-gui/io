{"version":3,"file":"line.js","sourceRoot":"","sources":["../../../src/game/items/line.ts"],"names":[],"mappings":"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","sourcesContent":["import { TerminalColor } from './terminal.js'\n\nexport interface LineData {\n  id: number\n  pos: [number, number][]\n  layer: number\n}\n\nexport class Line {\n  public id: number\n  public pos: [number, number][]\n  public layer: number\n  private _color: TerminalColor = 'white'\n\n  get color(): TerminalColor {\n    return this._color\n  }\n\n  set color(color: TerminalColor) {\n    this._color = color\n  }\n\n  constructor(id: number, pos: [number, number][], layer: number) {\n    this.id = id\n    this.pos = pos\n    this.layer = layer\n  }\n\n  toJSON(): LineData {\n    return {\n      id: this.id,\n      pos: this.pos,\n      layer: this.layer,\n    }\n  }\n\n  static fromJSON(data: LineData): Line {\n    return new Line(data.id, data.pos, data.layer)\n  }\n\n  hasDiagonalSegmentAt(mx: number, my: number): boolean {\n    const pos = this.pos\n    for (let i = 1; i < pos.length; i++) {\n      const ax = pos[i - 1][0]\n      const ay = pos[i - 1][1]\n      const bx = pos[i][0]\n      const by = pos[i][1]\n      if (\n        Math.abs(bx - ax) === 1 && Math.abs(by - ay) === 1 &&\n        (ax + bx) / 2 === mx && (ay + by) / 2 === my\n      ) {\n        return true\n      }\n    }\n    return false\n  }\n\n  /**\n   * Plot a new segment on the line if direction is valid.\n   * Erase last segment if user drags back to prev node.\n   * Return true if segment was added, false otherwise.\n   */\n  plotSegment(x: number, y: number): boolean {\n    if (this._tryEraseLastSegment(x, y)) return true\n    if (this._tryAddNewSegment(x, y)) return true\n    return false\n  }\n\n  /**\n   * Add segment or, if user went 45° backwards, remove one segment and add a 90° turn.\n   * Returns true if nothing was done, false if path was updated.\n   */\n  private _tryAddNewSegment(x: number, y: number): boolean {\n    const ln = this.pos.length\n    if (ln > 1) {\n      if (y === this.pos[ln - 2][1] && Math.abs(x - this.pos[ln - 2][0]) === 1) {\n        this.pos.pop()\n        this.pos.push([x, y])\n        return false\n      }\n      if (x === this.pos[ln - 2][0] && Math.abs(y - this.pos[ln - 2][1]) === 1) {\n        this.pos.pop()\n        this.pos.push([x, y])\n        return false\n      }\n    }\n    const last = this.pos[ln - 1]\n    if (Math.abs(last[0] - x) > 1) return true\n    if (Math.abs(last[1] - y) > 1) return true\n\n    this.pos.push([x, y])\n    return false\n  }\n\n  /** Erase last segment if user drags back to prev node. */\n  private _tryEraseLastSegment(x: number, y: number): boolean {\n    const ln = this.pos.length\n    if (ln < 2) return false\n    if (x === this.pos[ln - 2][0] && y === this.pos[ln - 2][1]) {\n      this.pos.pop()\n      return true\n    }\n    return false\n  }\n}\n"]}