{"version":3,"file":"line.js","sourceRoot":"","sources":["../../../src/game/items/line.ts"],"names":[],"mappings":"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","sourcesContent":["import { Color, Vector2 } from 'three/webgpu'\nimport { COLORS } from './colors.js'\n\nconst SQRT_2 = Math.sqrt(2)\nconst _vec2_1 = new Vector2()\nconst _vec2_2 = new Vector2()\n\nexport type LineData = [number, number][]\n\nexport class Line {\n  public pos: Vector2[]\n  public renderColor: Color\n  public isFinalized: boolean\n\n  constructor(pos: Vector2[], isFinalized: boolean = false, renderColor: Color = COLORS.white) {\n    this.pos = pos\n    this.renderColor = renderColor\n    this.isFinalized = isFinalized\n  }\n\n  toJSON(): LineData {\n    return this.pos.map((point) => [point.x, point.y])\n  }\n\n  static fromJSON(data: LineData): Line {\n    return new Line(\n      data.map((point) => new Vector2(point[0], point[1])),\n      true\n    )\n  }\n\n  get length(): number {\n    return this.pos.length\n  }\n\n  get firstPt(): Vector2 {\n    return this.pos[0]\n  }\n\n  get lastPt(): Vector2 {\n    return this.pos[this.length - 1]\n  }\n\n  get secondLastPt(): Vector2 {\n    return this.pos[this.length - 2]\n  }\n\n  /**\n   * Plot a new segment on the line if direction is valid.\n   * Erase last segment if user drags back to prev node.\n   * Return true if segment was added, false otherwise.\n   */\n  addSegment(point: Vector2): boolean {\n    if (this.tryEraseLastSegment(point)) return true\n    if (this.tryAddNewSegment(point)) return true\n    return false\n  }\n\n  /**\n   * Add segment or, if user went 45° backwards, remove one segment and add a 90° turn.\n   * Returns false if nothing was done, true if segment was added.\n   */\n  tryAddNewSegment(point: Vector2): boolean {\n    // Reject if segment is too long\n    if (this.lastPt.distanceTo(point) > SQRT_2) return false\n\n    // Reroute if user went 45° backwards\n    if (this.secondLastPt) {\n      _vec2_1.copy(this.lastPt).sub(this.secondLastPt)\n      _vec2_2.copy(point).sub(this.lastPt)\n      if (_vec2_1.dot(_vec2_2) === -1) {\n        this.pos.pop()\n        this.pos.push(point.clone())\n        return true\n      }\n    }\n\n    if (point.equals(this.lastPt)) {\n      return false\n    }\n\n    // Add new segment\n    this.pos.push(point.clone())\n    return true\n  }\n\n  /**\n   * Erase last segment if user drags back to prev node.\n   * Returns true if segment was erased, false otherwise.\n   */\n  tryEraseLastSegment(point: Vector2): boolean {\n    if (!this.secondLastPt) return false\n    if (this.secondLastPt.distanceTo(point) === 0) {\n      this.pos.pop()\n      return true\n    }\n    return false\n  }\n\n  hasSegmentAt(point1: Vector2, point2: Vector2): boolean {\n    for (let i = 0; i < this.pos.length - 2; i++) {\n      if (this.pos[i].equals(point1) && this.pos[i + 1].equals(point2)) {\n        return true\n      } else if (this.pos[i].equals(point2) && this.pos[i + 1].equals(point1)) {\n        return true\n      }\n    }\n    return false\n  }\n\n  resetColor() {\n    this.renderColor = COLORS.white\n  }\n\n  finalize() {\n    this.isFinalized = true\n  }\n}\n"]}