{"version":3,"file":"game.js","sourceRoot":"","sources":["../../src/game/game.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAE,QAAQ,EAAE,YAAY,EAAE,gBAAgB,EAAE,QAAQ,EAAE,OAAO,IAAI,CAAC,EAAW,MAAM,cAAc,CAAA;AACxG,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAA;AACtC,OAAO,EAAE,MAAM,EAAE,MAAM,mBAAmB,CAAA;AAC1C,OAAO,EAAE,IAAI,EAAiB,MAAM,WAAW,CAAA;AAC/C,OAAO,EAAE,KAAK,EAAkB,MAAM,YAAY,CAAA;AAYlD;;;;GAIG;AAEI,IAAM,IAAI,GAAV,MAAM,IAAK,SAAQ,YAAY;IA8BpC,SAAS,GAAa,EAAE,CAAA;IAExB,MAAM,KAAK,SAAS;QAClB,OAAO;YACL,WAAW,EAAE,YAAY;YACzB,aAAa,EAAE,cAAc;SAC9B,CAAA;IACH,CAAC;IAED,KAAK,CAAC,IAAI,CAAC,KAAa;QACtB,IAAI,CAAC;YACH,MAAM,IAAI,GAAG,MAAM,KAAK,CAAC,kBAAkB,GAAG,KAAK,GAAG,OAAO,CAAC,CAAA;YAC9D,IAAI,CAAC,IAAI,CAAC,EAAE;gBAAE,OAAO,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAA;YAC9C,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,IAAI,EAAE,CAAA;YAC9B,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;QAC3C,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,CAAC,IAAI,CAAC,uBAAuB,EAAE,KAAK,EAAE,CAAC,CAAC,CAAA;QACjD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,UAAU;QACd,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,EAAC,GAAG,EAAE,GAAG,IAAI,CAAC,KAAK,cAAc,EAAE,KAAK,EAAE,EAAE,EAAE,OAAO,EAAE,OAAO,EAAC,CAAC,CAAA;QAErF,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACrD,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;QAC7B,CAAC;QAED,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAA;QACrD,IAAI,CAAC,eAAe,EAAE,CAAA;QAEtB,IAAI,CAAC,SAAS,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAA;QAChC,IAAI,CAAC,SAAS,GAAG,EAAE,CAAA;QAEnB,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,SAAS,EAAE,IAAI,CAAC,CAAA;IAC7C,CAAC;IAED,UAAU;QACR,IAAI,CAAC,YAAY,EAAE,CAAA;IACrB,CAAC;IAAA,CAAC;IACF,YAAY;QACV,IAAI,CAAC,cAAc,EAAE,CAAA;IACvB,CAAC;IAAA,CAAC;IAEF,YAAY;QACV,KAAK,IAAI,CAAC,UAAU,EAAE,CAAA;IACxB,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,EAAE,CAAA;QAC3B,KAAK,IAAI,CAAC,UAAU,EAAE,CAAA;IACxB,CAAC;IAED,IAAI;QACF,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG;YACvB,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YACxB,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;YAC5B,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;SAC7B,CAAA;IACH,CAAC;IAED,QAAQ,CAAC,QAAgB;QACvB,MAAM,KAAK,GAAc,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAA;QAC7C,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAA;QACxB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAA;QAC1B,IAAI,CAAC,IAAI,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,IAAI,CAAC,CAAA;QACzD,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,CAAC,CAAA;QAC9D,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,CAAC,CAAA;QAC9D,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;IAC3D,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAC,SAAS,CAAC;YACpB,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YACxB,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;YAC5B,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;SAC7B,CAAC,CAAA;IACJ,CAAC;IAED,eAAe;QACb,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,EAAE,CAAA;QAC3B,IAAI,KAAK,KAAK,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,EAAE,CAAC;YACxD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;YAC1B,IAAI,CAAC,SAAS,GAAG,EAAE,CAAA;QACrB,CAAC;IACH,CAAC;IAED,IAAI;QACF,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,CAAC,EAAE,CAAC;YAC/B,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,EAAG,CAAA;YAC1C,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAA;YACxD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;YACjC,IAAI,CAAC,eAAe,EAAE,CAAA;YACtB,IAAI,CAAC,IAAI,EAAE,CAAA;YACX,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,SAAS,EAAE,IAAI,CAAC,CAAA;QAC/C,CAAC;IACH,CAAC;IAED,IAAI;QACF,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC9B,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,EAAG,CAAA;YACnC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAA;YACpB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;YAC1B,IAAI,CAAC,eAAe,EAAE,CAAA;YACtB,IAAI,CAAC,IAAI,EAAE,CAAA;YACX,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,SAAS,EAAE,IAAI,CAAC,CAAA;QAC/C,CAAC;IACH,CAAC;IAED,WAAW;QACT,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAA;QAChD,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAA;QAChD,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC,CAAA;IAC9C,CAAC;IAED,eAAe;QACb,IAAI,CAAC,WAAW,EAAE,CAAA;QAElB,MAAM,KAAK,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;QAE1D,KAAK,IAAI,IAAI,GAAG,CAAC,EAAE,IAAI,GAAG,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC;YACrC,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;gBACzB,MAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAA;gBACzB,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;gBAE1C,MAAM,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAA;gBAC5C,MAAM,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAA;gBAC1C,IAAI,CAAC,EAAE,IAAI,CAAC,EAAE;oBAAE,SAAQ;gBAExB,MAAM,EAAE,GAAG,EAAE,CAAC,WAAW,CAAA;gBACzB,MAAM,EAAE,GAAG,EAAE,CAAC,WAAW,CAAA;gBACzB,MAAM,CAAC,GAAG,MAAM,CAAC,KAAK,CAAA;gBAEtB,IAAI,EAAE,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,CAAC;oBACzB,IAAI,EAAE,KAAK,EAAE;wBAAE,IAAI,CAAC,WAAW,GAAG,EAAE,CAAA;gBACtC,CAAC;qBAAM,IAAI,EAAE,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,CAAC;oBAChC,IAAI,CAAC,WAAW,GAAG,CAAC,CAAA;gBACtB,CAAC;qBAAM,CAAC;oBACN,IAAI,EAAE,KAAK,CAAC,EAAE,CAAC;wBACb,IAAI,CAAC,WAAW,GAAG,EAAE,CAAA;wBACrB,EAAE,CAAC,WAAW,GAAG,EAAE,CAAA;oBACrB,CAAC;yBAAM,IAAI,EAAE,KAAK,CAAC,EAAE,CAAC;wBACpB,IAAI,CAAC,WAAW,GAAG,EAAE,CAAA;wBACrB,EAAE,CAAC,WAAW,GAAG,EAAE,CAAA;oBACrB,CAAC;gBACH,CAAC;YACH,CAAC;QACH,CAAC;QAED,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,SAAS,EAAE,IAAI,CAAC,CAAA;QAE7C,IAAI,SAAS,GAAG,IAAI,CAAA;QAEpB,yCAAyC;QAEzC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;YAC9B,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;YAC1C,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;YAC1C,MAAM,KAAK,GAAG,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAA;YACzC,IAAI,GAAG,CAAC,UAAU,EAAE,CAAC;gBACnB,IAAI,KAAK,KAAK,CAAC;oBAAE,SAAS,GAAG,KAAK,CAAA;YACpC,CAAC;iBAAM,IAAI,KAAK,KAAK,CAAC,IAAI,GAAG,CAAC,WAAW,KAAK,MAAM,CAAC,KAAK,EAAE,CAAC;gBAC3D,SAAS,GAAG,KAAK,CAAA;YACnB,CAAC;QACH,CAAC,CAAC,CAAA;QAEF,IAAI,SAAS;YAAE,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,KAAK,EAAE,SAAS,CAAC,CAAA;QAClE,IAAI,CAAC,QAAQ,CAAC,eAAe,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,SAAS,EAAE,EAAE,IAAI,CAAC,CAAA;IACxE,CAAC;IAED,cAAc;QACZ,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;QAChD,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;QAClD,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;IACpD,CAAC;IAED,YAAY;QACV,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC;YAChC,IAAI,CAAC,eAAe,EAAE,CAAA;YACtB,IAAI,CAAC,eAAe,EAAE,CAAA;YACtB,IAAI,CAAC,IAAI,EAAE,CAAA;QACb,CAAC;QACD,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,SAAS,EAAE,IAAI,CAAC,CAAA;IAC/C,CAAC;CACF,CAAA;AAtNS;IADP,gBAAgB,CAAC,EAAC,KAAK,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,EAAC,CAAC;mCACvB;AAGb;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,MAAM,EAAC,CAAC;mCACZ;AAGb;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,MAAM,EAAC,CAAC;oCACX;AAGd;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC;kCACzB;AAGV;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC;oCACvB;AAGb;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC;oCACvB;AAGb;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC;qCACtB;AAGhB;IADP,QAAQ,CAAC,CAAC,CAAC,EAAC,GAAG,EAAE,kBAAkB,EAAE,KAAK,EAAE,EAAE,EAAE,OAAO,EAAE,OAAO,EAAC,CAAC,CAAC;yCACxC;AAGpB;IADP,QAAQ,CAAC,KAAK,CAAC;uCACW;AAG3B;IADC,QAAQ,CAAC,KAAK,CAAC;uCACQ;AA9Bb,IAAI;IADhB,QAAQ;GACI,IAAI,CAyNhB","sourcesContent":["import { Register, ReactiveNode, ReactiveProperty, Property, Storage as $, Binding } from '@io-gui/core'\nimport { Plotter } from './plotter.js'\nimport { COLORS } from './items/colors.js'\nimport { Pads, type PadsData } from './pads.js'\nimport { Layer, type LayerData } from './layer.js'\n\nexport type DrawMode = 'pad' | 'terminal' | 'line' | 'delete'\n\ninterface LevelData {\n  width: number\n  height: number\n  pads: PadsData\n  layer0: LayerData\n  layer1: LayerData\n}\n\n/**\n * Game â€” central state machine.\n * Manages pads, lines, load/save, undo/redo, colour propagation,\n * and completion checking.\n */\n@Register\nexport class Game extends ReactiveNode {\n\n  @ReactiveProperty({value: '', type: String})\n  declare level: string\n\n  @ReactiveProperty({type: Number})\n  declare width: number\n\n  @ReactiveProperty({type: Number})\n  declare height: number\n\n  @ReactiveProperty({type: Pads, init: null})\n  declare pads: Pads\n\n  @ReactiveProperty({type: Layer, init: null})\n  declare layer0: Layer\n\n  @ReactiveProperty({type: Layer, init: null})\n  declare layer1: Layer\n\n  @ReactiveProperty({type: Plotter, init: null})\n  declare plotter: Plotter\n\n  @Property($({key: 'null-level-state', value: {}, storage: 'local'}))\n  declare storedState: Binding\n\n  @Property(Array)\n  declare undoStack: string[]\n\n  @Property(Array)\n  redoStack: string[] = []\n\n  static get Listeners() {\n    return {\n      'game-init': 'onGameInit',\n      'game-update': 'onGameUpdate',\n    }\n  }\n\n  async load(level: string): Promise<void> {\n    try {\n      const resp = await fetch('./public/levels/' + level + '.json')\n      if (!resp.ok) console.error('Level not found')\n      const text = await resp.text()\n      this.storedState.value = JSON.parse(text)\n    } catch (e) {\n      console.warn('Could not load level:', level, e)\n    }\n  }\n\n  async initialize() {\n    this.storedState = $({key: `${this.level}-level-state`, value: {}, storage: 'local'})\n\n    if (Object.keys(this.storedState.value).length === 0) {\n      await this.load(this.level)\n    }\n\n    this.fromJSON(JSON.stringify(this.storedState.value))\n    this.propagateColors()\n\n    this.undoStack = [this.toJSON()]\n    this.redoStack = []\n\n    this.dispatch('game-init', undefined, true)\n  }\n\n  onGameInit() {\n    this.onGameUpdate()\n  };\n  onGameUpdate() {\n    this.updateTextures()\n  };\n\n  levelChanged() {\n    void this.initialize()\n  }\n\n  reload() {\n    this.storedState.value = {}\n    void this.initialize()\n  }\n\n  save(): void {\n    this.storedState.value = {\n      width: this.width,\n      height: this.height,\n      pads: this.pads.toJSON(),\n      layer0: this.layer0.toJSON(),\n      layer1: this.layer1.toJSON(),\n    }\n  }\n\n  fromJSON(jsonText: string): void {\n    const state: LevelData = JSON.parse(jsonText)\n    this.width = state.width\n    this.height = state.height\n    this.pads = new Pads(this.width, this.height, state.pads)\n    this.layer0 = new Layer(this.width, this.height, state.layer0)\n    this.layer1 = new Layer(this.width, this.height, state.layer1)\n    this.plotter.connect(this.pads, this.layer0, this.layer1)\n  }\n\n  toJSON(): string {\n    return JSON.stringify({\n      width: this.width,\n      height: this.height,\n      pads: this.pads.toJSON(),\n      layer0: this.layer0.toJSON(),\n      layer1: this.layer1.toJSON(),\n    })\n  }\n\n  updateUndoStack(): void {\n    const state = this.toJSON()\n    if (state !== this.undoStack[this.undoStack.length - 1]) {\n      this.undoStack.push(state)\n      this.redoStack = []\n    }\n  }\n\n  undo(): void {\n    if (this.undoStack.length >= 2) {\n      const currentState = this.undoStack.pop()!\n      this.fromJSON(this.undoStack[this.undoStack.length - 1])\n      this.redoStack.push(currentState)\n      this.propagateColors()\n      this.save()\n      this.dispatch('game-update', undefined, true)\n    }\n  }\n\n  redo(): void {\n    if (this.redoStack.length > 0) {\n      const state = this.redoStack.pop()!\n      this.fromJSON(state)\n      this.undoStack.push(state)\n      this.propagateColors()\n      this.save()\n      this.dispatch('game-update', undefined, true)\n    }\n  }\n\n  resetColors(): void {\n    this.layer0.forEach((line) => line.resetColor())\n    this.layer1.forEach((line) => line.resetColor())\n    this.pads.forEach((pad) => pad.resetColor())\n  }\n\n  propagateColors(): void {\n    this.resetColors()\n\n    const lines = [...this.layer0.lines, ...this.layer1.lines]\n\n    for (let iter = 0; iter < 16; iter++) {\n      for (const line of lines) {\n        const first = line.pos[0]\n        const last = line.pos[line.pos.length - 1]\n\n        const p1 = this.pads.getAt(first.x, first.y)\n        const p2 = this.pads.getAt(last.x, last.y)\n        if (!p1 || !p2) continue\n\n        const c1 = p1.renderColor\n        const c2 = p2.renderColor\n        const w = COLORS.white\n\n        if (c1 !== w && c2 !== w) {\n          if (c1 === c2) line.renderColor = c1\n        } else if (c1 === w && c2 === w) {\n          line.renderColor = w\n        } else {\n          if (c1 !== w) {\n            line.renderColor = c1\n            p2.renderColor = c1\n          } else if (c2 !== w) {\n            line.renderColor = c2\n            p1.renderColor = c2\n          }\n        }\n      }\n    }\n\n    this.dispatch('game-update', undefined, true)\n\n    let completed = true\n\n    // TODO: Check for completeness correctly\n\n    this.pads.forEach((pad, x, y) => {\n      const line0 = this.layer0.getLinesAt(x, y)\n      const line1 = this.layer1.getLinesAt(x, y)\n      const nConn = line0.length + line1.length\n      if (pad.isTerminal) {\n        if (nConn !== 1) completed = false\n      } else if (nConn !== 2 && pad.renderColor !== COLORS.white) {\n        completed = false\n      }\n    })\n\n    if (completed) console.log('game-complete', this.level, completed)\n    this.dispatch('game-complete', { level: this.level, completed }, true)\n  }\n\n  updateTextures() {\n    this.pads.updateTexture(this.width, this.height)\n    this.layer0.updateTexture(this.width, this.height)\n    this.layer1.updateTexture(this.width, this.height)\n  }\n\n  finalizeMove(): void {\n    if (this.plotter.finalizeLine()) {\n      this.updateUndoStack()\n      this.propagateColors()\n      this.save()\n    }\n    this.dispatch('game-update', undefined, true)\n  }\n}\n"]}