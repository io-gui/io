{"version":3,"file":"debugPlanes.js","sourceRoot":"","sources":["../../src/scene/debugPlanes.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,KAAK,EACL,IAAI,EACJ,aAAa,EACb,OAAO,GACR,MAAM,cAAc,CAAA;AACrB,OAAO,EAAE,kBAAkB,EAA+B,MAAM,mCAAmC,CAAA;AAEnG,MAAM,aAAa,GAAG,CAAC,CAAA;AACvB,MAAM,uBAAuB,GAAG,GAAG,CAAA;AAEnC,MAAM,OAAO,WAAY,SAAQ,KAAK;IAEnB,OAAO,CAAgD;IACvD,cAAc,CAAe;IAE9C,YAAY,cAAuB,IAAI,OAAO,EAAE,EAAE,gBAAyB,IAAI,OAAO,EAAE,EAAE,gBAAyB,IAAI,OAAO,EAAE;QAC9H,KAAK,EAAE,CAAA;QACP,IAAI,CAAC,cAAc,GAAG,IAAI,aAAa,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;QAC7C,IAAI,CAAC,OAAO,GAAG;YACb,IAAI,CAAC,YAAY,CAAC,CAAC,EAAE,WAAW,EAAE,aAAa,EAAE,aAAa,CAAC;YAC/D,IAAI,CAAC,YAAY,CAAC,CAAC,EAAE,WAAW,EAAE,aAAa,EAAE,aAAa,CAAC;YAC/D,IAAI,CAAC,YAAY,CAAC,CAAC,EAAE,WAAW,EAAE,aAAa,EAAE,aAAa,CAAC;SAChE,CAAA;QACD,IAAI,CAAC,OAAO,GAAG,KAAK,CAAA;IACtB,CAAC;IAED,MAAM,CAAC,UAAkB,EAAE,WAAmB,EAAE,WAAoB,EAAE,aAAsB,EAAE,aAAsB;QAClH,IAAI,UAAU,GAAG,CAAC,IAAI,WAAW,GAAG,CAAC,EAAE,CAAC;YACtC,IAAI,CAAC,OAAO,GAAG,KAAK,CAAA;YACpB,OAAM;QACR,CAAC;QAED,MAAM,YAAY,GAAG,UAAU,GAAG,CAAC,CAAA;QACnC,MAAM,aAAa,GAAG,WAAW,GAAG,CAAC,CAAA;QACrC,MAAM,WAAW,GAAG,UAAU,GAAG,WAAW,CAAA;QAE5C,IAAI,WAAW,GAAG,aAAa,GAAG,uBAAuB,CAAA;QACzD,IAAI,UAAU,GAAG,WAAW,GAAG,WAAW,CAAA;QAC1C,MAAM,eAAe,GAAG,YAAY,GAAG,IAAI,CAAA;QAE3C,IAAI,UAAU,GAAG,eAAe,EAAE,CAAC;YACjC,UAAU,GAAG,eAAe,CAAA;YAC5B,WAAW,GAAG,UAAU,GAAG,WAAW,CAAA;QACxC,CAAC;QAED,MAAM,WAAW,GAAG,UAAU,GAAG,CAAC,CAAA;QAClC,MAAM,UAAU,GAAG,aAAa,GAAG,WAAW,GAAG,CAAC,CAAA;QAElD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YAC7C,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;YAC7B,KAAK,CAAC,QAAQ,CAAC,WAAW,CAAC,WAAW,EAAE,aAAa,EAAE,aAAa,CAAC,CAAA;YACrE,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,WAAW,EAAE,UAAU,GAAG,CAAC,GAAG,CAAC,WAAW,CAAC,EAAE,aAAa,CAAC,CAAA;YAC/E,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,UAAU,EAAE,WAAW,EAAE,CAAC,CAAC,CAAA;QAC7C,CAAC;QAED,IAAI,CAAC,OAAO,GAAG,IAAI,CAAA;IACrB,CAAC;IAED,OAAO;QACL,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACjC,KAAK,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAA;QAC1B,CAAC;QACD,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAA;IAC/B,CAAC;IAEO,YAAY,CAAC,YAAoC,EAAE,WAAoB,EAAE,aAAsB,EAAE,aAAsB;QAC7H,MAAM,QAAQ,GAAG,IAAI,kBAAkB,CAAC,WAAW,EAAE,aAAa,EAAE,aAAa,CAAC,CAAA;QAClF,QAAQ,CAAC,eAAe,CAAC,YAAY,CAAC,CAAA;QACtC,MAAM,KAAK,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAA;QACrD,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;QACf,OAAO,KAAK,CAAA;IACd,CAAC;CACF","sourcesContent":["import {\n  Group,\n  Mesh,\n  PlaneGeometry,\n  Texture,\n} from 'three/webgpu'\nimport { DebugStateMaterial, type DebugStateTextureIndex } from './materials/DebugStateMaterial.js'\n\nconst DEBUG_PLANE_Z = 2\nconst PREVIEW_HEIGHT_FRACTION = 0.1\n\nexport class DebugPlanes extends Group {\n\n  private readonly _planes: Array<Mesh<PlaneGeometry, DebugStateMaterial>>\n  private readonly _planeGeometry: PlaneGeometry\n\n  constructor(padsTexture: Texture = new Texture(), layer0Texture: Texture = new Texture(), layer1Texture: Texture = new Texture()) {\n    super()\n    this._planeGeometry = new PlaneGeometry(1, 1)\n    this._planes = [\n      this._createPlane(0, padsTexture, layer0Texture, layer1Texture),\n      this._createPlane(1, padsTexture, layer0Texture, layer1Texture),\n      this._createPlane(2, padsTexture, layer0Texture, layer1Texture),\n    ]\n    this.visible = false\n  }\n\n  update(boardWidth: number, boardHeight: number, padsTexture: Texture, layer0Texture: Texture, layer1Texture: Texture) {\n    if (boardWidth < 2 || boardHeight < 2) {\n      this.visible = false\n      return\n    }\n\n    const segmentWidth = boardWidth - 1\n    const segmentHeight = boardHeight - 1\n    const boardAspect = boardWidth / boardHeight\n\n    let planeHeight = segmentHeight * PREVIEW_HEIGHT_FRACTION\n    let planeWidth = planeHeight * boardAspect\n    const maxPreviewWidth = segmentWidth * 0.35\n\n    if (planeWidth > maxPreviewWidth) {\n      planeWidth = maxPreviewWidth\n      planeHeight = planeWidth / boardAspect\n    }\n\n    const leftCenterX = planeWidth / 2\n    const topCenterY = segmentHeight - planeHeight / 2\n\n    for (let i = 0; i < this._planes.length; i++) {\n      const plane = this._planes[i]\n      plane.material.setTextures(padsTexture, layer0Texture, layer1Texture)\n      plane.position.set(-leftCenterX, topCenterY - i * (planeHeight), DEBUG_PLANE_Z)\n      plane.scale.set(planeWidth, planeHeight, 1)\n    }\n\n    this.visible = true\n  }\n\n  dispose() {\n    for (const plane of this._planes) {\n      plane.material.dispose()\n    }\n    this._planeGeometry.dispose()\n  }\n\n  private _createPlane(textureIndex: DebugStateTextureIndex, padsTexture: Texture, layer0Texture: Texture, layer1Texture: Texture) {\n    const material = new DebugStateMaterial(padsTexture, layer0Texture, layer1Texture)\n    material.setTextureIndex(textureIndex)\n    const plane = new Mesh(this._planeGeometry, material)\n    this.add(plane)\n    return plane\n  }\n}\n"]}