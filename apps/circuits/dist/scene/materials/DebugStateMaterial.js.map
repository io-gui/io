{"version":3,"file":"DebugStateMaterial.js","sourceRoot":"","sources":["../../../src/scene/materials/DebugStateMaterial.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,qBAAqB,EAAgB,MAAM,cAAc,CAAA;AAClE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,MAAM,WAAW,CAAA;AAIlD,MAAM,OAAO,kBAAmB,SAAQ,qBAAqB;IACnD,YAAY,CAAS;IACrB,cAAc,CAAS;IACvB,cAAc,CAAS;IAEf,YAAY,GAAG,OAAO,CAAC,CAAC,CAAC,CAAA;IAEzC,YAAY,WAAoB,EAAE,aAAsB,EAAE,aAAsB;QAC9E,KAAK,CAAC;YACJ,WAAW,EAAE,IAAI;YACjB,UAAU,EAAE,KAAK;SAClB,CAAC,CAAA;QAEF,IAAI,CAAC,YAAY,GAAG,WAAW,CAAA;QAC/B,IAAI,CAAC,cAAc,GAAG,aAAa,CAAA;QACnC,IAAI,CAAC,cAAc,GAAG,aAAa,CAAA;QACnC,IAAI,CAAC,iBAAiB,EAAE,CAAA;IAC1B,CAAC;IAED,WAAW,CAAC,WAAoB,EAAE,aAAsB,EAAE,aAAsB;QAC9E,MAAM,OAAO,GAAG,IAAI,CAAC,YAAY,KAAK,WAAW;eAC5C,IAAI,CAAC,cAAc,KAAK,aAAa;eACrC,IAAI,CAAC,cAAc,KAAK,aAAa,CAAA;QAC1C,IAAI,CAAC,OAAO;YAAE,OAAM;QAEpB,IAAI,CAAC,YAAY,GAAG,WAAW,CAAA;QAC/B,IAAI,CAAC,cAAc,GAAG,aAAa,CAAA;QACnC,IAAI,CAAC,cAAc,GAAG,aAAa,CAAA;QACnC,IAAI,CAAC,iBAAiB,EAAE,CAAA;IAC1B,CAAC;IAED,eAAe,CAAC,KAA6B;QAC3C,IAAI,CAAC,YAAY,CAAC,KAAK,GAAG,KAAK,CAAA;IACjC,CAAC;IAEO,iBAAiB;QACvB,MAAM,QAAQ,GAAG,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;QAC3C,MAAM,UAAU,GAAG,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,CAAA;QAC/C,MAAM,UAAU,GAAG,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,CAAA;QAC/C,MAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;QAE9C,MAAM,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC,KAAK,EAAE,CAAA;QAC3D,MAAM,YAAY,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC,KAAK,EAAE,CAAA;QAC7D,MAAM,YAAY,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC,KAAK,EAAE,CAAA;QAE7D,MAAM,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAU,CAAC;aACxC,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;aACjC,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAA;QAEpC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC,CAAA;QACzC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAA;IAEzB,CAAC;CACF","sourcesContent":["import { MeshBasicNodeMaterial, type Texture } from 'three/webgpu'\nimport { texture, uniform, vec4 } from 'three/tsl'\n\nexport type DebugStateTextureIndex = 0 | 1 | 2\n\nexport class DebugStateMaterial extends MeshBasicNodeMaterial {\n  private _padsTexture: Texture\n  private _layer0Texture: Texture\n  private _layer1Texture: Texture\n\n  public readonly textureIndex = uniform(0)\n\n  constructor(padsTexture: Texture, layer0Texture: Texture, layer1Texture: Texture) {\n    super({\n      transparent: true,\n      toneMapped: false,\n    })\n\n    this._padsTexture = padsTexture\n    this._layer0Texture = layer0Texture\n    this._layer1Texture = layer1Texture\n    this._rebuildColorNode()\n  }\n\n  setTextures(padsTexture: Texture, layer0Texture: Texture, layer1Texture: Texture) {\n    const changed = this._padsTexture !== padsTexture\n      || this._layer0Texture !== layer0Texture\n      || this._layer1Texture !== layer1Texture\n    if (!changed) return\n\n    this._padsTexture = padsTexture\n    this._layer0Texture = layer0Texture\n    this._layer1Texture = layer1Texture\n    this._rebuildColorNode()\n  }\n\n  setTextureIndex(index: DebugStateTextureIndex) {\n    this.textureIndex.value = index\n  }\n\n  private _rebuildColorNode() {\n    const padsNode = texture(this._padsTexture)\n    const layer0Node = texture(this._layer0Texture)\n    const layer1Node = texture(this._layer1Texture)\n    const selector = this.textureIndex.clamp(0, 2)\n\n    const padsWeight = selector.sub(0).abs().oneMinus().clamp()\n    const layer0Weight = selector.sub(1).abs().oneMinus().clamp()\n    const layer1Weight = selector.sub(2).abs().oneMinus().clamp()\n\n    const stateColor = padsNode.mul(padsWeight)\n      .add(layer0Node.mul(layer0Weight))\n      .add(layer1Node.mul(layer1Weight))\n\n    this.outputNode = vec4(stateColor.rgb, 1)\n    this.needsUpdate = true\n\n  }\n}\n"]}