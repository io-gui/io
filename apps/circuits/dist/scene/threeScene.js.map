{"version":3,"file":"threeScene.js","sourceRoot":"","sources":["../../src/scene/threeScene.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  AmbientLight,\n  BoxGeometry,\n  CapsuleGeometry,\n  Color,\n  Group,\n  InstancedMesh,\n  Matrix4,\n  Mesh,\n  MeshPhongMaterial,\n  Object3D,\n  PerspectiveCamera,\n  PointLight,\n  Quaternion,\n  SphereGeometry,\n  Vector2,\n  Vector3,\n  Texture,\n} from 'three/webgpu'\nimport { ReactiveProperty, Register } from '@io-gui/core'\nimport { ThreeApplet, ThreeAppletProps } from '@io-gui/three'\nimport { Pad } from '../game/items/pad'\nimport { Line } from '../game/items/line'\nimport { Pads } from '../game/pads'\nimport { Grid } from './grid'\nimport { DebugPlanes } from './debugPlanes.js'\nimport { PadsStateMaterial } from './materials/PadsStateMaterial.js'\nimport { TerminalsStateMaterial } from './materials/TerminalsStateMaterial.js'\nimport { Layer0LinesStateMaterial } from './materials/Layer0LinesStateMaterial.js'\nimport { Layer1LinesStateMaterial } from './materials/Layer1LinesStateMaterial.js'\nimport { Game } from '../game/game'\n\nconst PAD_SPHERE_RADIUS = 0.25\nconst TERMINAL_BOX_SIZE = 0.5\nconst LINE_CAPSULE_RADIUS = 0.12\nconst LINE_CAPSULE_AXIS_LENGTH = 1\nconst LINE_DIAGONAL_INSET = 0.035\nconst LINE_LAYER_BEHIND_Z = -0.25\nconst LINE_LAYER_MINUS_ONE_WIDTH_FACTOR = 1.5\n\nconst _yAxis = new Vector3(0, 1, 0)\nconst _targetVector = new Vector3()\nconst _segmentDir = new Vector3()\nconst _segmentQuat = new Quaternion()\nconst _segmentScale = new Vector3()\nconst _segmentPosition = new Vector3()\nconst _instanceUVColor = new Color()\n\nconst tempTexture = new Texture()\n\ntype ThreeSceneProps = ThreeAppletProps & {\n  game: Game\n}\n\n@Register\nexport class ThreeScene extends ThreeApplet {\n\n  @ReactiveProperty({ type: Game, init: null })\n  declare game: Game\n\n  public camera: PerspectiveCamera = new PerspectiveCamera( 25, 1, 0.1, 1000 )\n  public cameraRig: Group = new Group()\n  public cameraTarget: Object3D = new Object3D()\n\n  public grid: Grid = new Grid()\n  public debugPlanes: DebugPlanes = new DebugPlanes()\n  public pads: InstancedMesh\n  public terminals: InstancedMesh\n  public layer0Lines: InstancedMesh\n  public layer1Lines: InstancedMesh\n  public padsMaterial: PadsStateMaterial\n  public terminalsMaterial: TerminalsStateMaterial\n  public layer0LinesMaterial: Layer0LinesStateMaterial\n  public layer1LinesMaterial: Layer1LinesStateMaterial\n\n  public hitMarker: Mesh = new Mesh(new SphereGeometry(0.1, 16, 12), new MeshPhongMaterial({ color: 0xff0000, transparent: true, opacity: 0.5 }))\n  public oldHitMarker: Mesh = new Mesh(new SphereGeometry(0.12, 16, 12), new MeshPhongMaterial({ color: 0x0000ff, transparent: true, opacity: 0.5 }))\n  public rawHitMarker: Mesh = new Mesh(new SphereGeometry(0.13, 16, 12), new MeshPhongMaterial({ color: 0xffffff, transparent: true, opacity: 0.5 }))\n\n  static padGeometry: SphereGeometry = new SphereGeometry(PAD_SPHERE_RADIUS, 16, 12)\n  static terminalGeometry: BoxGeometry = new BoxGeometry(TERMINAL_BOX_SIZE, TERMINAL_BOX_SIZE, TERMINAL_BOX_SIZE * 0.6)\n  static lineGeometry: CapsuleGeometry = new CapsuleGeometry(LINE_CAPSULE_RADIUS, LINE_CAPSULE_AXIS_LENGTH, 4, 8)\n\n  public _drag: Vector3 = new Vector3()\n\n  static get Listeners() {\n    return {\n      'game-update': 'onGameUpdate',\n      'game-init': 'onGameInit',\n    }\n  }\n\n  constructor(args: ThreeSceneProps) {\n    super(args)\n\n    this.scene.add(this.cameraRig)\n    this.cameraRig.add(this.camera)\n    this.cameraRig.add(this.cameraTarget)\n\n    this.scene.add(this.grid)\n    this.scene.add(this.debugPlanes)\n\n    this.padsMaterial = new PadsStateMaterial(tempTexture, tempTexture, tempTexture)\n    this.terminalsMaterial = new TerminalsStateMaterial(tempTexture, tempTexture, tempTexture)\n    this.layer0LinesMaterial = new Layer0LinesStateMaterial(tempTexture, tempTexture, tempTexture)\n    this.layer1LinesMaterial = new Layer1LinesStateMaterial(tempTexture, tempTexture, tempTexture)\n\n    this.pads = new InstancedMesh(ThreeScene.padGeometry.clone(), this.padsMaterial, 1)\n    this.terminals = new InstancedMesh(ThreeScene.terminalGeometry.clone(), this.terminalsMaterial, 1)\n    this.layer0Lines = new InstancedMesh(ThreeScene.lineGeometry.clone(), this.layer0LinesMaterial, 1)\n    this.layer1Lines = new InstancedMesh(ThreeScene.lineGeometry.clone(), this.layer1LinesMaterial, 1)\n    this.pads.count = 0\n    this.terminals.count = 0\n    this.layer0Lines.count = 0\n    this.layer1Lines.count = 0\n    this.scene.add(this.pads)\n    this.scene.add(this.terminals)\n    this.scene.add(this.layer0Lines)\n    this.scene.add(this.layer1Lines)\n\n    this.scene.add(this.hitMarker)\n    this.scene.add(this.oldHitMarker)\n    this.scene.add(this.rawHitMarker)\n\n    const ambientLight = new AmbientLight( 0xcccccc, 1.5 )\n    this.scene.add( ambientLight )\n\n    const pointLight = new PointLight( 0xffffff, 2.5, 0, 0 )\n    pointLight.position.set( 0, 0, 500 )\n    this.scene.add( pointLight )\n  }\n\n  ready() {\n    this.debounce(() => {\n      this.onGameInit()\n    })\n  }\n\n  onGameInit() {\n    this.initGrid(this.game)\n    this.onGameUpdate()\n  };\n  onGameUpdate() {\n    this.updateGrid(this.game)\n    this.updatePads(this.game.pads)\n    this.updateTerminals(this.game.pads)\n    this.updateLines(this.game.layer0.lines, this.game.layer1.lines)\n  };\n\n  updateMarkers(hit: Vector2, oldHit: Vector2, rawHit: Vector2) {\n    this.hitMarker.position.set(hit.x, hit.y, 0)\n    this.oldHitMarker.position.set(oldHit.x, oldHit.y, 0)\n    this.rawHitMarker.position.set(rawHit.x, rawHit.y, 0)\n  }\n\n  updateDrag(screen: Vector2, screenStart: Vector2) {\n    this._drag.set(screen.x - screenStart.x, screen.y - screenStart.y, 0)\n  }\n\n  initGrid(game: Game) {\n    const segmentWidth = Math.max(game.width - 1, 1)\n    const segmentHeight = Math.max(game.height - 1, 1)\n    this.camera.aspect = segmentWidth / segmentHeight\n    // calculate distance to contain grid in view\n    const halfFovRad = this.camera.fov * Math.PI / 360\n    const gridDistance = segmentHeight / (2 * Math.tan(halfFovRad))\n    this.cameraRig.position.set(segmentWidth / 2, segmentHeight / 2, 0)\n    this.camera.position.set(0, 0, gridDistance)\n  }\n  updateGrid(game: Game) {\n    this.grid.update(game.width, game.height, game.layer0.lines, game.layer1.lines, game.pads)\n    this.debugPlanes.update(game.width, game.height, game.pads.texture, game.layer0.texture, game.layer1.texture)\n    this.padsMaterial.setTextures(game.pads.texture, game.layer0.texture, game.layer1.texture)\n    this.terminalsMaterial.setTextures(game.pads.texture, game.layer0.texture, game.layer1.texture)\n    this.layer0LinesMaterial.setTextures(game.pads.texture, game.layer0.texture, game.layer1.texture)\n    this.layer1LinesMaterial.setTextures(game.pads.texture, game.layer0.texture, game.layer1.texture)\n  }\n\n  // TODO: Fix empty instanced arrays\n  updatePads(pads: Pads) {\n    const nonTerminalPads: [Pad, number, number][] = []\n    pads.forEach((pad, x, y) => {\n      if (!pad.isTerminal) nonTerminalPads.push([pad, x, y])\n    })\n    const count = nonTerminalPads.length\n    this.pads = this._ensureMeshCapacity(this.pads, this.padsMaterial, () => ThreeScene.padGeometry.clone(), count)\n    const width = this.grid.width\n    const height = this.grid.height\n    const matrix = new Matrix4()\n    for (let i = 0; i < count; i++) {\n      matrix.makeTranslation(nonTerminalPads[i][1], nonTerminalPads[i][2], 0)\n      this.pads.setMatrixAt(i, matrix)\n      _instanceUVColor.setRGB(\n        this._coordToTextureU(nonTerminalPads[i][1], width),\n        this._coordToTextureV(nonTerminalPads[i][2], height),\n        0\n      )\n      this.pads.setColorAt(i, _instanceUVColor)\n    }\n    this.pads.count = count\n    this.pads.instanceMatrix.needsUpdate = true\n    if (this.pads.instanceColor) {\n      this.pads.instanceColor.needsUpdate = true\n      this.padsMaterial.setInstanceUVAttribute(this.pads.instanceColor)\n    }\n  }\n\n  updateTerminals(pads: Pads) {\n    const terminalPads: [Pad, number, number][] = []\n    pads.forEach((pad, x, y) => {\n      if (pad.isTerminal) terminalPads.push([pad, x, y])\n    })\n    const count = terminalPads.length\n    this.terminals = this._ensureMeshCapacity(this.terminals, this.terminalsMaterial, () => ThreeScene.terminalGeometry.clone(), count)\n    const width = this.grid.width\n    const height = this.grid.height\n    const matrix = new Matrix4()\n    for (let i = 0; i < count; i++) {\n      matrix.makeTranslation(terminalPads[i][1], terminalPads[i][2], 0)\n      this.terminals.setMatrixAt(i, matrix)\n      _instanceUVColor.setRGB(\n        this._coordToTextureU(terminalPads[i][1], width),\n        this._coordToTextureV(terminalPads[i][2], height),\n        0\n      )\n      this.terminals.setColorAt(i, _instanceUVColor)\n    }\n    this.terminals.count = count\n    this.terminals.instanceMatrix.needsUpdate = true\n    if (this.terminals.instanceColor) {\n      this.terminals.instanceColor.needsUpdate = true\n      this.terminalsMaterial.setInstanceUVAttribute(this.terminals.instanceColor)\n    }\n  }\n  updateLines(layer0Lines: Line[], layer1Lines: Line[]) {\n    this._updateLayerLines(layer0Lines, true)\n    this._updateLayerLines(layer1Lines, false)\n  }\n\n  private _updateLayerLines(lines: Line[], isLayer0: boolean) {\n    const segmentCount = lines.reduce((n, line) => n + Math.max(0, line.pos.length - 1), 0)\n    const mesh = isLayer0\n      ? this.layer0Lines = this._ensureMeshCapacity(this.layer0Lines, this.layer0LinesMaterial, () => ThreeScene.lineGeometry.clone(), segmentCount)\n      : this.layer1Lines = this._ensureMeshCapacity(this.layer1Lines, this.layer1LinesMaterial, () => ThreeScene.lineGeometry.clone(), segmentCount)\n    const material = isLayer0 ? this.layer0LinesMaterial : this.layer1LinesMaterial\n    const width = this.grid.width\n    const height = this.grid.height\n    const matrix = new Matrix4()\n    let idx = 0\n    for (const line of lines) {\n      const pos = line.pos\n      const isBehind = isLayer0\n      const widthScale = isBehind ? LINE_LAYER_MINUS_ONE_WIDTH_FACTOR : 1\n      const segmentZ = isBehind ? LINE_LAYER_BEHIND_Z : 0\n      for (let j = 0; j < pos.length - 1; j++) {\n        const ax = pos[j].x\n        const ay = pos[j].y\n        const bx = pos[j + 1].x\n        const by = pos[j + 1].y\n        _segmentPosition.set((ax + bx) / 2, (ay + by) / 2, segmentZ)\n        const dx = bx - ax\n        const dy = by - ay\n        const segmentLength = Math.sqrt(dx * dx + dy * dy) || 1\n        const isDiagonal = segmentLength > 1.01\n        const effectiveLength = isDiagonal ? segmentLength - 2 * LINE_DIAGONAL_INSET : segmentLength\n        _segmentDir.set(dx / segmentLength, dy / segmentLength, 0)\n        _segmentQuat.setFromUnitVectors(_yAxis, _segmentDir)\n        _segmentScale.set(widthScale, effectiveLength / LINE_CAPSULE_AXIS_LENGTH, widthScale)\n        matrix.compose(\n          _segmentPosition,\n          _segmentQuat,\n          _segmentScale\n        )\n        mesh.setMatrixAt(idx, matrix)\n        _instanceUVColor.setRGB(\n          this._coordToTextureU(ax, width),\n          this._coordToTextureV(ay, height),\n          0\n        )\n        mesh.setColorAt(idx, _instanceUVColor)\n        idx++\n      }\n    }\n    mesh.count = segmentCount\n    mesh.instanceMatrix.needsUpdate = true\n    if (mesh.instanceColor) {\n      mesh.instanceColor.needsUpdate = true\n      material.setInstanceUVAttribute(mesh.instanceColor)\n    }\n  }\n\n  private _coordToTextureU(x: number, width: number) {\n    return (x + 0.5) / Math.max(width, 1)\n  }\n\n  private _coordToTextureV(y: number, height: number) {\n    return (y + 0.5) / Math.max(height, 1)\n  }\n\n  private _ensureMeshCapacity(\n    mesh: InstancedMesh,\n    material: PadsStateMaterial | TerminalsStateMaterial | Layer0LinesStateMaterial | Layer1LinesStateMaterial,\n    createGeometry: () => SphereGeometry | BoxGeometry | CapsuleGeometry,\n    count: number,\n  ) {\n    const required = Math.max(count, 1)\n    if (mesh.instanceMatrix.count >= required) return mesh\n    this.scene.remove(mesh)\n    mesh.geometry.dispose()\n    const nextMesh = new InstancedMesh(createGeometry(), material, required)\n    nextMesh.count = 0\n    this.scene.add(nextMesh)\n    return nextMesh\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  onAnimate(delta: number, time: number) {\n    const segmentWidth = Math.max(this.grid.width - 1, 0)\n    const segmentHeight = Math.max(this.grid.height - 1, 0)\n    this.camera.position.x = ((this.camera.position.x * 9) - this._drag.x * 0.25 * segmentWidth) / 10\n    this.camera.position.y = ((this.camera.position.y * 9) - this._drag.y * 0.25 * segmentHeight) / 10\n\n    this.cameraTarget.position.x = ((this.cameraTarget.position.x * 9) - this._drag.x * 0.02 * segmentWidth) / 10\n    this.cameraTarget.position.y = ((this.cameraTarget.position.y * 9) - this._drag.y * 0.02 * segmentHeight) / 10\n\n    this.camera.lookAt(_targetVector.setFromMatrixPosition(this.cameraTarget.matrixWorld))\n  }\n\n  dispose() {\n    this.debugPlanes.dispose()\n    this.grid.dispose()\n    super.dispose()\n  }\n\n}\n"]}