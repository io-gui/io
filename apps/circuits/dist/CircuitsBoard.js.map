{"version":3,"file":"CircuitsBoard.js","sourceRoot":"","sources":["../src/CircuitsBoard.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EACL,QAAQ,EACR,SAAS,EAET,gBAAgB,GACjB,MAAM,cAAc,CAAA;AACrB,OAAO,EAAE,OAAO,EAAE,MAAM,OAAO,CAAA;AAC/B,OAAO,EAAE,IAAI,EAAE,MAAM,gBAAgB,CAAA;AACrC,OAAO,EAAE,UAAU,EAAE,MAAM,uBAAuB,CAAA;AAClD,OAAO,EAAE,eAAe,EAAa,MAAM,eAAe,CAAA;AAC1D,OAAO,EAAE,WAAW,EAAE,MAAM,wBAAwB,CAAA;AAEpD,MAAM,IAAI,GAAG,IAAI,OAAO,EAAE,CAAA;AAC1B,MAAM,OAAO,GAAG,IAAI,OAAO,EAAE,CAAA;AAM7B;;;;GAIG;AAEI,IAAM,aAAa,GAAnB,MAAM,aAAc,SAAQ,SAAS;IAE1C,MAAM,KAAK,KAAK;QACd,OAAO,SAAS,CAAA;;;;;;;;KAQf,CAAA;IACH,CAAC;IAED,MAAM,KAAK,SAAS;QAClB,OAAO;YACL,gBAAgB,EAAE,iBAAiB;YACnC,gBAAgB,EAAE,iBAAiB;YACnC,cAAc,EAAE,eAAe;YAE/B,iBAAiB,EAAE,YAAY;YAC/B,aAAa,EAAE,cAAc;YAC7B,eAAe,EAAE,WAAW;SAC7B,CAAA;IACH,CAAC;IAQO,UAAU,GAAW,CAAC,CAAA;IAE9B,YAAY,IAAwB;QAClC,KAAK,CAAC,IAAI,CAAC,CAAA;IACb,CAAC;IAED,UAAU;QACR,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;QACzD,IAAI,CAAC,YAAY,EAAE,CAAA;IACrB,CAAC;IAAA,CAAC;IACF,YAAY;QACV,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QACtC,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;QAChD,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;QACxC,aAAa;QACb,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,2BAA2B,EAAE,SAAS,EAAE,IAAI,CAAC,CAAA;IACpE,CAAC;IAAA,CAAC;IAEF,KAAK;QACH,IAAI,CAAC,MAAM,CAAC;YACV,eAAe,CAAC,EAAC,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,WAAW,CAAC,EAAE,CAAC,EAAE,YAAY,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,EAAC,CAAC;SACxG,CAAC,CAAA;IACJ,CAAC;IAED,eAAe,CAAC,KAA+B;QAC7C,IAAI,KAAK,CAAC,MAAM,CAAC,MAAM,KAAK,CAAC;YAAE,OAAM;QACrC,IAAI,CAAC,GAAG,CACN,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EACpC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CACrC,CAAA;QACD,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QAElB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,MAAM,CAAC,CAAA;QAEpD,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,KAAK,EAAE,CAAC;YACjC,OAAO,CAAC,GAAG,CAAE,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAA;YAC5B,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAA;QAC3D,CAAC;QACD,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,UAAU,EAAE,CAAC;YACtC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;QACrF,CAAC;QACD,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,MAAM,EAAE,CAAC;YAClC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;QACxF,CAAC;QACD,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,QAAQ,EAAE,CAAC;YACpC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAA;QAC1C,CAAC;IACH,CAAC;IAED,eAAe,CAAC,KAA+B;QAC7C,IAAI,KAAK,CAAC,MAAM,CAAC,MAAM,KAAK,CAAC;YAAE,OAAM;QACrC,IAAI,CAAC,GAAG,CACN,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EACpC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CACrC,CAAA;QACD,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,MAAM,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC;YAClE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;QACxF,CAAC;IACH,CAAC;IAED,aAAa,CAAC,KAAmB;QAC/B,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,IAAI,CAAC,SAAS,EAAE,CAAA;IAClB,CAAC;IAED,SAAS;QACP,IAAI,IAAI,CAAC,IAAI;YAAE,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;IACxD,CAAC;IAED,OAAO;QACL,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAA;QACrB,KAAK,CAAC,OAAO,EAAE,CAAA;IACjB,CAAC;CAEF,CAAA;AA/ES;IADP,gBAAgB,CAAC,EAAC,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC;6CACvB;AAGlB;IADP,gBAAgB,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC;2CACf;AA9BP,aAAa;IADzB,QAAQ;GACI,aAAa,CA0GzB;;AAED,MAAM,CAAC,MAAM,aAAa,GAAG,UAAS,IAAwB;IAC5D,OAAO,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;AACzC,CAAC,CAAA","sourcesContent":["import {\n  Register,\n  IoElement,\n  IoElementProps,\n  ReactiveProperty,\n} from '@io-gui/core'\nimport { Vector2 } from 'three'\nimport { Game } from './game/game.js'\nimport { ThreeScene } from './scene/threeScene.js'\nimport { ioThreeViewport, Pointer3D } from '@io-gui/three'\nimport { PointerTool } from './tools/pointerTool.js'\n\nconst _pos = new Vector2()\nconst _posOld = new Vector2()\n\ntype CircuitsBoardProps = IoElementProps & {\n  game: Game\n}\n\n/**\n * CircuitsBoard â€” 3D game board IoElement.\n * Owns the ThreeScene, hosts io-three-viewport, handles pointer events,\n * and maps viewport coordinates to grid via camera unproject (plotter logic).\n */\n@Register\nexport class CircuitsBoard extends IoElement {\n\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex: 1 1 auto;\n        flex-direction: column;\n        max-width: 100%;\n        max-height: 100%;\n      }\n    `\n  }\n\n  static get Listeners(): Record<string, string> {\n    return {\n      '3dpointer-down': 'on3DPointerDown',\n      '3dpointer-move': 'on3DPointerMove',\n      '3dpointer-up': 'on3DPointerUp',\n\n      'game-init-scene': 'onGameInit',\n      'game-update': 'onGameUpdate',\n      'line-end-drag': 'onEndDrag',\n    }\n  }\n\n  @ReactiveProperty({type: ThreeScene, init: null})\n  declare applet: ThreeScene\n\n  @ReactiveProperty({ type: Game })\n  declare game: Game\n\n  private _currentID: number = 0\n\n  constructor(args: CircuitsBoardProps) {\n    super(args)\n  }\n\n  onGameInit() {\n    this.applet.updateGrid(this.game.width, this.game.height)\n    this.onGameUpdate()\n  };\n  onGameUpdate() {\n    this.applet.updatePads(this.game.pads)\n    this.applet.updateTerminals(this.game.terminals)\n    this.applet.updateLines(this.game.lines)\n    // TODO: hmm?\n    this.applet.dispatch('three-applet-needs-render', undefined, true)\n  };\n\n  ready() {\n    this.render([\n      ioThreeViewport({applet: this.applet, tool: new PointerTool({}), cameraSelect: 'scene', overscan: 1.2}),\n    ])\n  }\n\n  on3DPointerDown(event: CustomEvent<Pointer3D[]>) {\n    if (event.detail.length !== 1) return\n    _pos.set(\n      Math.round(event.detail[0].origin.x),\n      Math.round(event.detail[0].origin.y),\n    )\n    _posOld.copy(_pos)\n\n    this._currentID = Math.floor(Math.random() * 100000)\n\n    if (this.game.drawMode === 'pad') {\n      console.log( _pos.x, _pos.y)\n      this.game.plotter.addPad(this._currentID, _pos.x, _pos.y)\n    }\n    if (this.game.drawMode === 'terminal') {\n      this.game.plotter.addTerminal(this._currentID, _pos.x, _pos.y, this.game.drawColor)\n    }\n    if (this.game.drawMode === 'line') {\n      this.game.plotter.addLineSegment(this._currentID, _pos.x, _pos.y, this.game.drawLayer)\n    }\n    if (this.game.drawMode === 'delete') {\n      this.game.plotter.delete(_pos.x, _pos.y)\n    }\n  }\n\n  on3DPointerMove(event: CustomEvent<Pointer3D[]>) {\n    if (event.detail.length !== 1) return\n    _pos.set(\n      Math.round(event.detail[0].origin.x),\n      Math.round(event.detail[0].origin.y),\n    )\n    if (this.game.drawMode === 'line' && _pos.distanceTo(_posOld) > 0) {\n      this.game.plotter.addLineSegment(this._currentID, _pos.x, _pos.y, this.game.drawLayer)\n    }\n  }\n\n  on3DPointerUp(event: PointerEvent) {\n    event.preventDefault()\n    this.onEndDrag()\n  }\n\n  onEndDrag() {\n    if (this.game) this.game.finalizeMove(this._currentID)\n  }\n\n  dispose() {\n    this.applet.dispose()\n    super.dispose()\n  }\n\n}\n\nexport const circuitsBoard = function(arg0: CircuitsBoardProps) {\n  return CircuitsBoard.vConstructor(arg0)\n}"]}