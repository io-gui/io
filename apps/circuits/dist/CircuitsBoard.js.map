{"version":3,"file":"CircuitsBoard.js","sourceRoot":"","sources":["../src/CircuitsBoard.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EACL,SAAS,EACT,QAAQ,EACR,gBAAgB,EAEhB,MAAM,GACP,MAAM,cAAc,CAAA;AACrB,OAAO,EAAE,IAAI,EAAE,MAAM,gBAAgB,CAAA;AAErC,OAAO,EAGL,eAAe,IAAI,MAAM,GAC1B,MAAM,0BAA0B,CAAA;AAkBjC,MAAM,OAAO,KAAK;IAChB,MAAM,GAAgC,EAAE,CAAA;IACxC,WAAW,GAAG,CAAC,CAAA;IACf,YAAY,GAAG,CAAC,CAAA;IAChB,SAAS,GAAG,CAAC,CAAA;IACb,UAAU,GAAG,CAAC,CAAA;IACd,QAAQ,GAAG,CAAC,CAAA;IACZ,WAAW,GAAG,CAAC,CAAA;IACf,WAAW,GAAG,CAAC,CAAA;IACf,YAAY,GAAG,CAAC,CAAA;IAEhB,uDAAuD;IACvD,IAAI,CAAC,QAA2C;QAC9C,IAAI,CAAC,MAAM,GAAG,EAAE,CAAA;QAChB,KAAK,MAAM,IAAI,IAAI,QAAQ,EAAE,CAAC;YAC5B,MAAM,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAA;YAC7B,MAAM,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAE,CAAA;YACpC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE,CAAA;QACrC,CAAC;IACH,CAAC;IAED,0DAA0D;IAC1D,QAAQ,CACN,SAAiB,EACjB,UAAkB,EAClB,cAAsB,EACtB,eAAuB;QAEvB,IAAI,CAAC,WAAW,GAAG,cAAc,CAAA;QACjC,IAAI,CAAC,YAAY,GAAG,eAAe,CAAA;QACnC,MAAM,GAAG,GAAG,MAAM,CAAC,gBAAgB,IAAI,CAAC,CAAA;QAExC,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YAC/B,MAAM,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;YACpC,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC,WAAW,GAAG,GAAG,CAAA;YACrC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,GAAG,GAAG,CAAA;YACvC,MAAM,CAAC,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,WAAW,GAAG,IAAI,CAAA;YAC5C,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,GAAG,IAAI,CAAA;YAC9C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAA;QAC1D,CAAC;QAED,IAAI,CAAC,SAAS,GAAG,SAAS,CAAA;QAC1B,IAAI,CAAC,UAAU,GAAG,UAAU,CAAA;QAE5B,+DAA+D;QAC/D,IACE,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,UAAU;YACnC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,EACjC,CAAC;YACD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,GAAG,CAAC,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,CAAA;QACzD,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,YAAY,GAAG,CAAC,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAA;QAC3D,CAAC;QAED,IAAI,CAAC,WAAW,GAAG,CAAC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAA;QAC1E,IAAI,CAAC,WAAW;YACd,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAA;QAE3D,2BAA2B;QAC3B,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAA;QAChC,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,YAAY,CAAC,CAAA;QAExD,GAAG,CAAC,SAAS,GAAG,uBAAuB,CAAA;QACvC,GAAG,CAAC,QAAQ,CACV,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,EAC9B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,CAChC,CAAA;QAED,GAAG,CAAC,WAAW,GAAG,uBAAuB,CAAA;QACzC,GAAG,CAAC,SAAS,GAAG,CAAC,CAAA;QAEjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,SAAS,EAAE,CAAC,EAAE,EAAE,CAAC;YACpC,MAAM,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;YAC9C,GAAG,CAAC,SAAS,EAAE,CAAA;YACf,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,WAAW,CAAC,CAAA;YAC/B,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,CAAA;YACjE,GAAG,CAAC,MAAM,EAAE,CAAA;QACd,CAAC;QAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,UAAU,EAAE,CAAC,EAAE,EAAE,CAAC;YACrC,MAAM,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;YAC9C,GAAG,CAAC,SAAS,EAAE,CAAA;YACf,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAA;YAC/B,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAA;YAChE,GAAG,CAAC,MAAM,EAAE,CAAA;QACd,CAAC;QAED,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,WAAW,GAAG,GAAG,CAAA;IAC5C,CAAC;IAED,kBAAkB;IAElB,yEAAyE;IACzE,MAAM,CAAC,IAAW,EAAE,SAAqB,EAAE,KAAa;QACtD,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAA;QACpC,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAA;QACpC,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI;YAAE,OAAM;QAE1B,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,YAAY,CAAC,CAAA;QACzD,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,YAAY,CAAC,CAAA;QAEzD,KAAK,MAAM,IAAI,IAAI,KAAK;YAAE,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;QACpD,KAAK,MAAM,GAAG,IAAI,IAAI;YAAE,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAA;QAChD,KAAK,MAAM,IAAI,IAAI,SAAS;YAAE,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAA;QAE5D,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;YACzB,IAAI,CAAC,aAAa,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;QACvC,CAAC;QACD,KAAK,MAAM,GAAG,IAAI,IAAI;YACpB,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC,CAAA;QACpC,KAAK,MAAM,IAAI,IAAI,SAAS;YAC1B,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAA;IAC5C,CAAC;IAED,6BAA6B;IAErB,MAAM,CAAU,cAAc,GACpC;QACE,CAAC,CAAC,CAAC,CAAC,EAAE,QAAQ;QACd,CAAC,EAAE,QAAQ;KACZ,CAAA;IAEK,WAAW,CAAC,IAAU;QAC5B,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,KAAK,CAAC,CAAC,CAAA;QAClC,MAAM,SAAS,GAAG,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,QAAQ,CAAA;QAC9D,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAA;QACjE,IAAI,MAAM,GAAG,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAA;QAC9B,IAAI,OAAO,GAAG,CAAC,CAAA;QACf,IAAI,WAAW,GAAG,eAAe,CAAA;QACjC,IAAI,OAAO,GAAG,CAAC,CAAA;QAEf,IAAI,QAAQ,EAAE,CAAC;YACb,MAAM,IAAI,GAAG,CAAA;YACb,OAAO,IAAI,CAAC,CAAA;YACZ,WAAW,GAAG,wBAAwB,CAAA;YACtC,OAAO,GAAG,IAAI,CAAA;QAChB,CAAC;QAED,OAAO;YACL,GAAG;YACH,MAAM;YACN,OAAO;YACP,WAAW;YACX,OAAO;SACR,CAAA;IACH,CAAC;IAEO,cAAc,CACpB,GAA6B,EAC7B,SAA6B;QAE7B,GAAG,CAAC,SAAS,EAAE,CAAA;QACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YAC1C,MAAM,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;YAC5D,MAAM,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;YAC5D,IAAI,CAAC,KAAK,CAAC;gBAAE,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;;gBACxB,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;QACvB,CAAC;IACH,CAAC;IAEO,eAAe,CAAC,IAAU;QAChC,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC;YAAE,OAAM;QAC/B,MAAM,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAA;QAChC,CAAC,CAAC,GAAG,CAAC,IAAI,EAAE,CAAA;QACZ,CAAC,CAAC,GAAG,CAAC,WAAW,GAAG,CAAC,CAAC,OAAO,CAAA;QAC7B,CAAC,CAAC,GAAG,CAAC,OAAO,GAAG,OAAO,CAAA;QACvB,CAAC,CAAC,GAAG,CAAC,QAAQ,GAAG,OAAO,CAAA;QACxB,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,CAAA;QACpC,CAAC,CAAC,GAAG,CAAC,WAAW,GAAG,CAAC,CAAC,WAAW,CAAA;QACjC,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,OAAO,GAAG,CAAC,CAAA;QAC1C,CAAC,CAAC,GAAG,CAAC,MAAM,EAAE,CAAA;QACd,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAA;IACjB,CAAC;IAEO,aAAa,CAAC,IAAU,EAAE,KAAoB;QACpD,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC;YAAE,OAAM;QAC/B,MAAM,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAA;QAChC,CAAC,CAAC,GAAG,CAAC,IAAI,EAAE,CAAA;QACZ,CAAC,CAAC,GAAG,CAAC,WAAW,GAAG,CAAC,CAAC,OAAO,CAAA;QAC7B,CAAC,CAAC,GAAG,CAAC,OAAO,GAAG,OAAO,CAAA;QACvB,CAAC,CAAC,GAAG,CAAC,QAAQ,GAAG,OAAO,CAAA;QACxB,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,CAAA;QACpC,CAAC,CAAC,GAAG,CAAC,WAAW,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,MAAM,CAAA;QAC3C,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,MAAM,CAAA;QAC1B,CAAC,CAAC,GAAG,CAAC,MAAM,EAAE,CAAA;QACd,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAA;IACjB,CAAC;IAED,4DAA4D;IAEpD,cAAc,CAAC,GAAQ;QAC7B,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAA;QAClC,MAAM,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;QACxD,MAAM,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;QACxD,MAAM,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAA;QAC3B,MAAM,EAAE,GAAG,CAAC,CAAA;QACZ,GAAG,CAAC,SAAS,EAAE,CAAA;QACf,GAAG,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,CAAA;QACvC,GAAG,CAAC,SAAS,GAAG,eAAe,CAAA;QAC/B,GAAG,CAAC,IAAI,EAAE,CAAA;IACZ,CAAC;IAEO,YAAY,CAAC,GAAQ,EAAE,KAAoB;QACjD,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAA;QAClC,MAAM,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;QACxD,MAAM,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;QACxD,MAAM,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAA;QAC3B,GAAG,CAAC,SAAS,EAAE,CAAA;QACf,GAAG,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,CAAA;QAClC,GAAG,CAAC,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,MAAM,CAAA;QACvC,GAAG,CAAC,IAAI,EAAE,CAAA;IACZ,CAAC;IAED,iEAAiE;IAEzD,mBAAmB,CAAC,QAAkB;QAC5C,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAA;QAClC,MAAM,EAAE,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;QAC7D,MAAM,EAAE,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;QAC7D,MAAM,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAA;QAC3B,MAAM,EAAE,GAAG,CAAC,CAAA;QACZ,GAAG,CAAC,SAAS,GAAG,eAAe,CAAA;QAC/B,GAAG,CAAC,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC,CAAA;IACpE,CAAC;IAEO,iBAAiB,CAAC,QAAkB,EAAE,KAAoB;QAChE,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAA;QAClC,MAAM,EAAE,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;QAC7D,MAAM,EAAE,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;QAC7D,MAAM,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAA;QAC3B,GAAG,CAAC,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,MAAM,CAAA;QACvC,GAAG,CAAC,QAAQ,CAAC,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAA;IAC5C,CAAC;IAED,qBAAqB;IAErB,UAAU,CAAC,MAAc,EAAE,MAAc;QACvC,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAA;QAChC,IAAI,CAAC,GAAG;YAAE,OAAM;QAChB,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,YAAY,CAAC,CAAA;QACxD,MAAM,EAAE,GAAG,MAAM,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;QACpD,MAAM,EAAE,GAAG,MAAM,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAA;QACpD,GAAG,CAAC,SAAS,EAAE,CAAA;QACf,GAAG,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,YAAY,EAAE,CAAC,EAAE,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,CAAA;QAClD,GAAG,CAAC,SAAS,GAAG,wBAAwB,CAAA;QACxC,GAAG,CAAC,IAAI,EAAE,CAAA;IACZ,CAAC;IAED,UAAU;QACR,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAA;QAChC,IAAI,CAAC,GAAG;YAAE,OAAM;QAChB,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,YAAY,CAAC,CAAA;IAC1D,CAAC;;AAOH;;;;GAIG;AACH,MAAM,OAAO,aAAc,SAAQ,SAAS;IAC1C,MAAM,KAAK,KAAK;QACd,OAAO,SAAS,CAAC;;;;;;;;;;;;;;;;KAgBhB,CAAA;IACH,CAAC;IAED,MAAM,KAAK,SAAS;QAClB,OAAO;YACL,WAAW,EAAE,eAAe;YAC5B,iBAAiB,EAAE,iBAAiB;YACpC,aAAa,EAAE,cAAc;SAC9B,CAAA;IACH,CAAC;IAQD,gBAAgB;IACR,OAAO,GAAG,CAAC,CAAA;IACX,OAAO,GAAG,CAAC,CAAA;IACX,MAAM,GAAG,CAAC,CAAA;IACV,MAAM,GAAG,CAAC,CAAA;IACV,SAAS,GAAG,CAAC,CAAA;IACb,SAAS,GAAG,CAAC,CAAA;IACb,KAAK,GAAG,KAAK,CAAA;IACb,SAAS,GAAG,CAAC,CAAA;IAErB,YAAY,OAA2B,EAAE;QACvC,KAAK,CAAC,IAAI,CAAC,CAAA;IACb,CAAC;IAED,KAAK;QACH,IAAI,CAAC,OAAO,EAAE,CAAA;IAChB,CAAC;IAED,OAAO;QACL,IAAI,CAAC,MAAM,CAAC;YACV,MAAM,CAAC,EAAE,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,CAAC;YAChD,MAAM,CAAC,EAAE,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,CAAC;YAClD,MAAM,CAAC,EAAE,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,CAAC;YAClD,MAAM,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,CAAC;SAChD,CAAC,CAAA;QACF,IAAI,CAAC,UAAU,EAAE,CAAA;IACnB,CAAC;IAED,SAAS;QACP,IAAI,CAAC,UAAU,EAAE,CAAA;IACnB,CAAC;IAEO,UAAU;QAChB,MAAM,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,OAAO,CAAsB,CAAA;QAC7D,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,SAAS,CAAsB,CAAA;QACjE,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,SAAS,CAAsB,CAAA;QACjE,MAAM,GAAG,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAsB,CAAA;QAC3D,IAAI,CAAC,IAAI,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,IAAI,CAAC,GAAG;YAAE,OAAM;QAE/C,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,CAAA;QAE9C,MAAM,IAAI,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAA;QACzC,IAAI,IAAI,CAAC,KAAK,KAAK,CAAC,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC;YAAE,OAAM;QAEjD,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;YACd,IAAI,CAAC,KAAK,CAAC,QAAQ,CACjB,IAAI,CAAC,IAAI,CAAC,KAAK,EACf,IAAI,CAAC,IAAI,CAAC,MAAM,EAChB,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,MAAM,CACZ,CAAA;YACD,IAAI,CAAC,KAAK,CAAC,MAAM,CACf,IAAI,CAAC,IAAI,CAAC,IAAI,EACd,IAAI,CAAC,IAAI,CAAC,SAAS,EACnB,IAAI,CAAC,IAAI,CAAC,KAAK,CAChB,CAAA;QACH,CAAC;IACH,CAAC;IAED,WAAW;QACT,IAAI,CAAC,UAAU,EAAE,CAAA;IACnB,CAAC;IAED,eAAe;QACb,MAAM,IAAI,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAA;QACzC,IAAI,IAAI,CAAC,KAAK,KAAK,CAAC,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC;YAAE,OAAM;QACjD,IAAI,CAAC,KAAK,CAAC,QAAQ,CACjB,IAAI,CAAC,IAAI,CAAC,KAAK,EACf,IAAI,CAAC,IAAI,CAAC,MAAM,EAChB,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,MAAM,CACZ,CAAA;QACD,IAAI,CAAC,KAAK,CAAC,MAAM,CACf,IAAI,CAAC,IAAI,CAAC,IAAI,EACd,IAAI,CAAC,IAAI,CAAC,SAAS,EACnB,IAAI,CAAC,IAAI,CAAC,KAAK,CAChB,CAAA;IACH,CAAC;IAAA,CAAC;IACF,YAAY;QACV,IAAI,CAAC,KAAK,CAAC,MAAM,CACf,IAAI,CAAC,IAAI,CAAC,IAAI,EACd,IAAI,CAAC,IAAI,CAAC,SAAS,EACnB,IAAI,CAAC,IAAI,CAAC,KAAK,CAChB,CAAA;IACH,CAAC;IAAA,CAAC;IAEF,aAAa,CAAC,KAAmB;QAC/B,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,SAAS,CAAC,CAAA;QACvC,IAAI,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,aAAa,CAAC,CAAA;QACxD,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,WAAW,CAAC,CAAA;QAEpD,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,MAAM,CAAC,CAAA;QACnD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAA;QACjB,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;QACzB,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,CAAA;QAEjD,IAAI,CAAC,IAAI,CAAC,IAAI;YAAE,OAAM;QAEtB,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,KAAK,EAAE,CAAC;YACjC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;QACpE,CAAC;QACD,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,UAAU,EAAE,CAAC;YACtC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAC3B,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,IAAI,CAAC,SAAS,CACpB,CAAA;QACH,CAAC;QACD,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,MAAM,EAAE,CAAC;YAClC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,CAC9B,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,IAAI,CAAC,SAAS,CACpB,CAAA;QACH,CAAC;QACD,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,QAAQ,EAAE,CAAC;YACpC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;QACpD,CAAC;IACH,CAAC;IAED,aAAa,CAAC,KAAmB;QAC/B,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAA;QAC3B,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;QAE/C,IAAI,CAAC,IAAI,CAAC,IAAI;YAAE,OAAM;QAEtB,IACE,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,MAAM;YAC7B,IAAI,CAAC,KAAK;YACV,CAAC,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC,SAAS,CAAC,EAClE,CAAC;YACD,MAAM,EAAE,OAAO,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,CAClD,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,IAAI,CAAC,SAAS,CACpB,CAAA;YACD,IAAI,OAAO;gBAAE,IAAI,CAAC,KAAK,GAAG,KAAK,CAAA;QACjC,CAAC;IACH,CAAC;IAED,WAAW,CAAC,KAAmB;QAC7B,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,SAAS,CAAC,CAAA;QAC3C,IAAI,CAAC,mBAAmB,CAAC,aAAa,EAAE,IAAI,CAAC,aAAa,CAAC,CAAA;QAC3D,IAAI,CAAC,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAAC,WAAW,CAAC,CAAA;QAEvD,IAAI,CAAC,KAAK,GAAG,KAAK,CAAA;QAClB,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,CAAA;QAEvB,IAAI,CAAC,IAAI,CAAC,IAAI;YAAE,OAAM;QAEtB,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;IACxC,CAAC;IAEO,aAAa,CAAC,KAAmB;QACvC,MAAM,IAAI,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAA;QAEzC,IAAI,CAAC,OAAO;YACV,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACpD,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAA;QACrB,IAAI,CAAC,OAAO;YACV,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAA;QAE3E,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QACtC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QACtC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,MAAM,CAAA;QAC5B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,MAAM,CAAA;IAC9B,CAAC;IAEO,eAAe,CAAC,KAAmB;QACzC,MAAM,IAAI,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAA;QAEzC,IAAI,CAAC,OAAO;YACV,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACpD,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAA;QACrB,IAAI,CAAC,OAAO;YACV,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAA;QAE3E,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CACxB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;YAClD,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CACvD,CAAA;QAED,IAAI,CAAC,IAAI,CAAC,IAAI;YAAE,OAAM;QAEtB,IACE,QAAQ,GAAG,GAAG;YACd,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,GAAG;YACrC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG;YACtC,IAAI,CAAC,OAAO,IAAI,CAAC,GAAG;YACpB,IAAI,CAAC,OAAO,IAAI,CAAC,GAAG,EACpB,CAAC;YACD,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,MAAM,CAAA;YAC5B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,MAAM,CAAA;YAE5B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;YACtC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;YAEtC,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS;gBAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,GAAG,CAAC,CAAA;YAClE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS;gBAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,GAAG,CAAC,CAAA;YAClE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS;gBAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,GAAG,CAAC,CAAA;YAClE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS;gBAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,GAAG,CAAC,CAAA;QACpE,CAAC;IACH,CAAC;CACF;AAtNS;IADP,gBAAgB,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC;2CACf;AAGV;IADP,gBAAgB,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC;4CAC1B;AAoNtB,QAAQ,CAAC,aAAa,CAAC,CAAA;AACvB,MAAM,CAAC,MAAM,aAAa,GAAG,UAAU,IAAwB;IAC7D,OAAO,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;AACzC,CAAC,CAAA","sourcesContent":["import {\n  IoElement,\n  Register,\n  ReactiveProperty,\n  IoElementProps,\n  canvas,\n} from '@io-gui/core'\nimport { Game } from './game/game.js'\nimport { Pad } from './game/items/pad.js'\nimport {\n  Terminal,\n  type TerminalColor,\n  TERMINAL_COLORS as COLORS,\n} from './game/items/terminal.js'\nimport { Line } from './game/items/line.js'\n\n/**\n * Scene — manages layered HTML5 canvases and renders the game state.\n *\n * Layer stack (bottom -> top):\n *   grid   – static grid lines (redrawn on initGrid)\n *   layer0 – line.layer -1 (bottom, underlines)\n *   layer1 – line.layer 0 (top) + pads + terminals\n *   top    – touch marker overlay\n */\n\ninterface CanvasLayer {\n  canvas: HTMLCanvasElement\n  ctx: CanvasRenderingContext2D\n}\n\nexport class Scene {\n  layers: Record<string, CanvasLayer> = {}\n  canvasWidth = 0\n  canvasHeight = 0\n  gridWidth = 0\n  gridHeight = 0\n  gridUnit = 0\n  gridOffsetX = 0\n  gridOffsetY = 0\n  markerRadius = 0\n\n  /** Set up layers from externally provided canvases. */\n  init(canvases: Record<string, HTMLCanvasElement>): void {\n    this.layers = {}\n    for (const name in canvases) {\n      const canvas = canvases[name]\n      const ctx = canvas.getContext('2d')!\n      this.layers[name] = { canvas, ctx }\n    }\n  }\n\n  /** Recalculate grid geometry and draw the static grid. */\n  initGrid(\n    gameWidth: number,\n    gameHeight: number,\n    containerWidth: number,\n    containerHeight: number,\n  ): void {\n    this.canvasWidth = containerWidth\n    this.canvasHeight = containerHeight\n    const dpr = window.devicePixelRatio || 1\n\n    for (const name in this.layers) {\n      const { canvas } = this.layers[name]\n      canvas.width = this.canvasWidth * dpr\n      canvas.height = this.canvasHeight * dpr\n      canvas.style.width = this.canvasWidth + 'px'\n      canvas.style.height = this.canvasHeight + 'px'\n      this.layers[name].ctx.setTransform(dpr, 0, 0, dpr, 0, 0)\n    }\n\n    this.gridWidth = gameWidth\n    this.gridHeight = gameHeight\n\n    // Calculate unit size so the grid fits with a half-unit margin\n    if (\n      this.canvasHeight / this.gridHeight >\n      this.canvasWidth / this.gridWidth\n    ) {\n      this.gridUnit = this.canvasWidth / (this.gridWidth + 1)\n    } else {\n      this.gridUnit = this.canvasHeight / (this.gridHeight + 1)\n    }\n\n    this.gridOffsetX = (this.canvasWidth - this.gridUnit * this.gridWidth) / 2\n    this.gridOffsetY =\n      (this.canvasHeight - this.gridUnit * this.gridHeight) / 2\n\n    // --- Draw static grid ---\n    const ctx = this.layers.grid.ctx\n    ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n\n    ctx.fillStyle = 'rgba(255,255,255,0.2)'\n    ctx.fillRect(\n      this.gridOffsetX,\n      this.gridOffsetY,\n      this.gridWidth * this.gridUnit,\n      this.gridHeight * this.gridUnit,\n    )\n\n    ctx.strokeStyle = 'rgba(255,255,255,0.5)'\n    ctx.lineWidth = 1\n\n    for (let i = 0; i <= gameWidth; i++) {\n      const x = i * this.gridUnit + this.gridOffsetX\n      ctx.beginPath()\n      ctx.moveTo(x, this.gridOffsetY)\n      ctx.lineTo(x, this.gridHeight * this.gridUnit + this.gridOffsetY)\n      ctx.stroke()\n    }\n\n    for (let j = 0; j <= gameHeight; j++) {\n      const y = j * this.gridUnit + this.gridOffsetY\n      ctx.beginPath()\n      ctx.moveTo(this.gridOffsetX, y)\n      ctx.lineTo(this.gridWidth * this.gridUnit + this.gridOffsetX, y)\n      ctx.stroke()\n    }\n\n    this.markerRadius = this.canvasWidth * 0.1\n  }\n\n  // -- Rendering --\n\n  /** Full re-render of lines, pads and terminals on the dynamic layers. */\n  render(pads: Pad[], terminals: Terminal[], lines: Line[]): void {\n    const ctx0 = this.layers.layer0?.ctx\n    const ctx1 = this.layers.layer1?.ctx\n    if (!ctx0 || !ctx1) return\n\n    ctx0.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n    ctx1.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n\n    for (const line of lines) this._drawLineStroke(line)\n    for (const pad of pads) this._drawPadStroke(pad)\n    for (const term of terminals) this._drawTerminalStroke(term)\n\n    for (const line of lines) {\n      this._drawLineFill(line, line._color)\n    }\n    for (const pad of pads)\n      this._drawPadFill(pad, pad._color)\n    for (const term of terminals)\n      this._drawTerminalFill(term, term.color)\n  }\n\n  // -- Line drawing helpers --\n\n  private static readonly _layerToCanvas: Record<number, 'layer0' | 'layer1'> =\n    {\n      [-1]: 'layer0',\n      0: 'layer1',\n    }\n\n  private _lineParams(line: Line) {\n    const isBottom = line.layer === -1\n    const layerName = Scene._layerToCanvas[line.layer] ?? 'layer1'\n    const ctx = this.layers[layerName]?.ctx ?? this.layers.layer1.ctx\n    let radius = this.gridUnit / 4\n    let strokeW = 3\n    let strokeColor = 'rgba(0,0,0,1)'\n    let opacity = 1\n\n    if (isBottom) {\n      radius *= 1.4\n      strokeW *= 4\n      strokeColor = 'rgba(128,128,128,0.25)'\n      opacity = 0.25\n    }\n\n    return {\n      ctx,\n      radius,\n      strokeW,\n      strokeColor,\n      opacity,\n    }\n  }\n\n  private _buildLinePath(\n    ctx: CanvasRenderingContext2D,\n    positions: [number, number][],\n  ): void {\n    ctx.beginPath()\n    for (let i = 0; i < positions.length; i++) {\n      const x = positions[i][0] * this.gridUnit + this.gridOffsetX\n      const y = positions[i][1] * this.gridUnit + this.gridOffsetY\n      if (i === 0) ctx.moveTo(x, y)\n      else ctx.lineTo(x, y)\n    }\n  }\n\n  private _drawLineStroke(line: Line): void {\n    if (line.pos.length < 2) return\n    const p = this._lineParams(line)\n    p.ctx.save()\n    p.ctx.globalAlpha = p.opacity\n    p.ctx.lineCap = 'round'\n    p.ctx.lineJoin = 'round'\n    this._buildLinePath(p.ctx, line.pos)\n    p.ctx.strokeStyle = p.strokeColor\n    p.ctx.lineWidth = p.radius + p.strokeW * 2\n    p.ctx.stroke()\n    p.ctx.restore()\n  }\n\n  private _drawLineFill(line: Line, color: TerminalColor): void {\n    if (line.pos.length < 2) return\n    const p = this._lineParams(line)\n    p.ctx.save()\n    p.ctx.globalAlpha = p.opacity\n    p.ctx.lineCap = 'round'\n    p.ctx.lineJoin = 'round'\n    this._buildLinePath(p.ctx, line.pos)\n    p.ctx.strokeStyle = COLORS[color] ?? '#fff'\n    p.ctx.lineWidth = p.radius\n    p.ctx.stroke()\n    p.ctx.restore()\n  }\n\n  // -- Pad drawing helpers (pads are always white circles) --\n\n  private _drawPadStroke(pad: Pad): void {\n    const ctx = this.layers.layer1.ctx\n    const xx = pad.pos[0] * this.gridUnit + this.gridOffsetX\n    const yy = pad.pos[1] * this.gridUnit + this.gridOffsetY\n    const r = this.gridUnit / 3\n    const sw = 3\n    ctx.beginPath()\n    ctx.arc(xx, yy, r + sw, 0, Math.PI * 2)\n    ctx.fillStyle = 'rgba(0,0,0,1)'\n    ctx.fill()\n  }\n\n  private _drawPadFill(pad: Pad, color: TerminalColor): void {\n    const ctx = this.layers.layer1.ctx\n    const xx = pad.pos[0] * this.gridUnit + this.gridOffsetX\n    const yy = pad.pos[1] * this.gridUnit + this.gridOffsetY\n    const r = this.gridUnit / 3\n    ctx.beginPath()\n    ctx.arc(xx, yy, r, 0, Math.PI * 2)\n    ctx.fillStyle = COLORS[color] ?? '#fff'\n    ctx.fill()\n  }\n\n  // -- Terminal drawing helpers (terminals are colored squares) --\n\n  private _drawTerminalStroke(terminal: Terminal): void {\n    const ctx = this.layers.layer1.ctx\n    const xx = terminal.pos[0] * this.gridUnit + this.gridOffsetX\n    const yy = terminal.pos[1] * this.gridUnit + this.gridOffsetY\n    const r = this.gridUnit / 3\n    const sw = 3\n    ctx.fillStyle = 'rgba(0,0,0,1)'\n    ctx.fillRect(xx - r - sw, yy - r - sw, (r + sw) * 2, (r + sw) * 2)\n  }\n\n  private _drawTerminalFill(terminal: Terminal, color: TerminalColor): void {\n    const ctx = this.layers.layer1.ctx\n    const xx = terminal.pos[0] * this.gridUnit + this.gridOffsetX\n    const yy = terminal.pos[1] * this.gridUnit + this.gridOffsetY\n    const r = this.gridUnit / 3\n    ctx.fillStyle = COLORS[color] ?? '#fff'\n    ctx.fillRect(xx - r, yy - r, r * 2, r * 2)\n  }\n\n  // -- Touch marker --\n\n  drawMarker(touchX: number, touchY: number): void {\n    const ctx = this.layers.top?.ctx\n    if (!ctx) return\n    ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n    const xx = touchX * this.gridUnit + this.gridOffsetX\n    const yy = touchY * this.gridUnit + this.gridOffsetY\n    ctx.beginPath()\n    ctx.arc(xx, yy, this.markerRadius, 0, Math.PI * 2)\n    ctx.fillStyle = 'rgba(255,255,255,0.05)'\n    ctx.fill()\n  }\n\n  hideMarker(): void {\n    const ctx = this.layers.top?.ctx\n    if (!ctx) return\n    ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n  }\n}\n\ntype CircuitsBoardProps = IoElementProps & {\n  game?: Game\n}\n\n/**\n * CircuitsBoard — canvas-based game board IoElement.\n * Owns the Scene, creates 4 layered canvases, handles pointer events,\n * and translates screen coordinates to grid positions (plotter logic).\n */\nexport class CircuitsBoard extends IoElement {\n  static get Style() {\n    return /* css */ `\n      :host {\n        flex: 1;\n        position: relative;\n        background: rgba(0, 0, 0, 0.8);\n        border: 1px solid #99f;\n        border-radius: 12px;\n        margin: 2px;\n        overflow: hidden;\n        touch-action: none;\n      }\n      :host > canvas {\n        position: absolute;\n        top: 0;\n        left: 0;\n      }\n    `\n  }\n\n  static get Listeners(): Record<string, string> {\n    return {\n      pointerdown: 'onPointerdown',\n      'game-init-scene': 'onGameInitScene',\n      'game-render': 'onGameRender',\n    }\n  }\n\n  @ReactiveProperty({ type: Game })\n  declare game: Game\n\n  @ReactiveProperty({ type: Scene, init: null })\n  declare scene: Scene\n\n  // Plotter state\n  private _touchX = 0\n  private _touchY = 0\n  private _gridX = 0\n  private _gridY = 0\n  private _gridXOld = 0\n  private _gridYOld = 0\n  private _drag = false\n  private _randomID = 0\n\n  constructor(args: CircuitsBoardProps = {}) {\n    super(args)\n  }\n\n  ready() {\n    this.changed()\n  }\n\n  changed() {\n    this.render([\n      canvas({ id: 'grid', style: { zIndex: '100' } }),\n      canvas({ id: 'layer0', style: { zIndex: '101' } }),\n      canvas({ id: 'layer1', style: { zIndex: '102' } }),\n      canvas({ id: 'top', style: { zIndex: '105' } }),\n    ])\n    this._initScene()\n  }\n\n  onResized() {\n    this._initScene()\n  }\n\n  private _initScene(): void {\n    const grid = this.querySelector('#grid') as HTMLCanvasElement\n    const layer0 = this.querySelector('#layer0') as HTMLCanvasElement\n    const layer1 = this.querySelector('#layer1') as HTMLCanvasElement\n    const top = this.querySelector('#top') as HTMLCanvasElement\n    if (!grid || !layer0 || !layer1 || !top) return\n\n    this.scene.init({ grid, layer0, layer1, top })\n\n    const rect = this.getBoundingClientRect()\n    if (rect.width === 0 || rect.height === 0) return\n\n    if (this.game) {\n      this.scene.initGrid(\n        this.game.width,\n        this.game.height,\n        rect.width,\n        rect.height,\n      )\n      this.scene.render(\n        this.game.pads,\n        this.game.terminals,\n        this.game.lines,\n      )\n    }\n  }\n\n  gameChanged() {\n    this._initScene()\n  }\n\n  onGameInitScene() {\n    const rect = this.getBoundingClientRect()\n    if (rect.width === 0 || rect.height === 0) return\n    this.scene.initGrid(\n      this.game.width,\n      this.game.height,\n      rect.width,\n      rect.height,\n    )\n    this.scene.render(\n      this.game.pads,\n      this.game.terminals,\n      this.game.lines,\n    )\n  };\n  onGameRender() {\n    this.scene.render(\n      this.game.pads,\n      this.game.terminals,\n      this.game.lines,\n    )\n  };\n\n  onPointerdown(event: PointerEvent) {\n    event.preventDefault()\n    this.setPointerCapture(event.pointerId)\n    this.addEventListener('pointermove', this.onPointermove)\n    this.addEventListener('pointerup', this.onPointerup)\n\n    this._randomID = Math.floor(Math.random() * 100000)\n    this._drag = true\n    this._initPosition(event)\n    this.scene.drawMarker(this._touchX, this._touchY)\n\n    if (!this.game) return\n\n    if (this.game.drawMode === 'pad') {\n      this.game.plotter.addPad(this._randomID, this._gridX, this._gridY)\n    }\n    if (this.game.drawMode === 'terminal') {\n      this.game.plotter.addTerminal(\n        this._randomID,\n        this._gridX,\n        this._gridY,\n        this.game.drawColor,\n      )\n    }\n    if (this.game.drawMode === 'line') {\n      this.game.plotter.addLineSegment(\n        this._randomID,\n        this._gridX,\n        this._gridY,\n        this.game.drawLayer,\n      )\n    }\n    if (this.game.drawMode === 'delete') {\n      this.game.plotter.delete(this._gridX, this._gridY)\n    }\n  }\n\n  onPointermove(event: PointerEvent) {\n    event.preventDefault()\n    this._updatePosition(event)\n    this.scene.drawMarker(this._gridX, this._gridY)\n\n    if (!this.game) return\n\n    if (\n      this.game.drawMode === 'line' &&\n      this._drag &&\n      (this._gridX !== this._gridXOld || this._gridY !== this._gridYOld)\n    ) {\n      const { endDrag } = this.game.plotter.addLineSegment(\n        this._randomID,\n        this._gridX,\n        this._gridY,\n        this.game.drawLayer,\n      )\n      if (endDrag) this._drag = false\n    }\n  }\n\n  onPointerup(event: PointerEvent) {\n    event.preventDefault()\n    this.releasePointerCapture(event.pointerId)\n    this.removeEventListener('pointermove', this.onPointermove)\n    this.removeEventListener('pointerup', this.onPointerup)\n\n    this._drag = false\n    this.scene.hideMarker()\n\n    if (!this.game) return\n\n    this.game.finalizeMove(this._randomID)\n  }\n\n  private _initPosition(event: PointerEvent): void {\n    const rect = this.getBoundingClientRect()\n\n    this._touchX =\n      (event.clientX - rect.left - this.scene.gridOffsetX) /\n      this.scene.gridUnit\n    this._touchY =\n      (event.clientY - rect.top - this.scene.gridOffsetY) / this.scene.gridUnit\n\n    this._gridX = Math.round(this._touchX)\n    this._gridY = Math.round(this._touchY)\n    this._gridXOld = this._gridX\n    this._gridYOld = this._gridY\n  }\n\n  private _updatePosition(event: PointerEvent): void {\n    const rect = this.getBoundingClientRect()\n\n    this._touchX =\n      (event.clientX - rect.left - this.scene.gridOffsetX) /\n      this.scene.gridUnit\n    this._touchY =\n      (event.clientY - rect.top - this.scene.gridOffsetY) / this.scene.gridUnit\n\n    const distance = Math.sqrt(\n      Math.pow(this._touchX - Math.round(this._touchX), 2) +\n        Math.pow(this._touchY - Math.round(this._touchY), 2),\n    )\n\n    if (!this.game) return\n\n    if (\n      distance < 0.5 &&\n      this._touchX <= this.game.width + 0.5 &&\n      this._touchY <= this.game.height + 0.5 &&\n      this._touchX >= -0.5 &&\n      this._touchY >= -0.5\n    ) {\n      this._gridXOld = this._gridX\n      this._gridYOld = this._gridY\n\n      this._gridX = Math.round(this._touchX)\n      this._gridY = Math.round(this._touchY)\n\n      if (this._gridX > this._gridXOld) this._gridX = this._gridXOld + 1\n      if (this._gridX < this._gridXOld) this._gridX = this._gridXOld - 1\n      if (this._gridY > this._gridYOld) this._gridY = this._gridYOld + 1\n      if (this._gridY < this._gridYOld) this._gridY = this._gridYOld - 1\n    }\n  }\n}\nRegister(CircuitsBoard)\nexport const circuitsBoard = function (arg0: CircuitsBoardProps) {\n  return CircuitsBoard.vConstructor(arg0)\n}\n"]}