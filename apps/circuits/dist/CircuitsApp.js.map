{"version":3,"file":"CircuitsApp.js","sourceRoot":"","sources":["../src/CircuitsApp.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Register,\n  IoElement,\n  ReactiveProperty,\n  Storage as $,\n  ListenerDefinitions,\n  div\n} from '@io-gui/core'\nimport { ioSplit, Split } from '@io-gui/layout'\nimport { ioButton } from '@io-gui/inputs'\nimport { TERMINAL_COLORS } from './game/items/terminal.js'\nimport { circuitsLevels, CircuitsLevels } from './CircuitsLevels.js'\nimport { circuitsGame } from './CircuitsGame.js'\nimport { DrawMode, Game } from './game/game.js'\n\n$.permit()\nconst $level = $({ key: 'level', storage: 'hash', value: '' })\nconst $completed = $({\n  key: 'circuits-completed',\n  storage: 'local',\n  value: '[]',\n})\n\n@Register\nexport class CircuitsApp extends IoElement {\n  static get Style() {\n    return /* css */ `\n      :host {\n        display: flex;\n        position: fixed;\n        inset: 0;\n        background-color: var(--io_bgColor);\n        color: var(--io_color);\n        user-select: none;\n        -webkit-user-select: none;\n        -webkit-text-size-adjust: none;\n        -webkit-touch-callout: none;\n      }\n    `\n  }\n\n  @ReactiveProperty({ type: Game, init: null })\n  declare game: Game\n\n  static get Listeners(): ListenerDefinitions {\n    return {\n      'level-select': 'onLevelSelect',\n      'editor-select': 'onEditorSelect',\n    }\n  }\n\n  ready() {\n    const completedIds = this._getCompletedIds()\n    this.render([\n      ioSplit({\n        split: new Split({\n          type: 'split',\n          children: [\n            { type: 'panel', flex: '0 0 110px', tabs: [{ id: 'levels' }] },\n            { type: 'panel', flex: '1 1 auto', tabs: [{ id: 'game' }] },\n            { type: 'panel', flex: '0 0 120px', tabs: [{ id: 'editor' }] },\n          ],\n        }),\n        elements: [\n          circuitsLevels({ id: 'levels', completedLevels: completedIds } as {\n            id: string\n            completedLevels: string[]\n          }),\n          circuitsGame({ id: 'game', level: $level, game: this.game }),\n          div({id: 'editor'}, [\n            ioButton({ label: 'Pad', action: () => this._select('pad', '') }),\n            ...Object.keys(TERMINAL_COLORS).map((c) =>\n              ioButton({ label: c, action: () => this._select('terminal', c) }),\n            ),\n            ioButton({\n              label: 'Line (top)',\n              action: () => this.dispatch('editor-select', { mode: 'line', layer: 0 }, true),\n            }),\n            ioButton({\n              label: 'Line (bottom)',\n              action: () => this.dispatch('editor-select', { mode: 'line', layer: -1 }, true),\n            }),\n            ioButton({ label: 'Delete', action: () => this._select('delete', 'red') }),\n          ])\n        ],\n      }),\n    ])\n    const gameEl = this.querySelector('#game') as {\n      completeFn?: (level: string, completed: boolean) => void\n    } | null\n    if (gameEl) {\n      gameEl.completeFn = (level: string, completed: boolean) =>\n        this.onLevelComplete(level, completed)\n    }\n  }\n\n  private _getCompletedIds(): string[] {\n    try {\n      return JSON.parse($completed.value || '[]') as string[]\n    } catch {\n      return []\n    }\n  }\n\n  private _select(mode: DrawMode, color: string) {\n    this.dispatch('editor-select', { mode, color }, true)\n  }\n\n  private _setCompletedIds(ids: string[]) {\n    $completed.value = JSON.stringify(ids)\n  }\n\n  onLevelComplete(level: string, completed: boolean) {\n    if (!completed) return\n    const ids = this._getCompletedIds()\n    if (ids.includes(level)) return\n    this._setCompletedIds([...ids, level])\n    const levelsEl = this.querySelector('#levels') as CircuitsLevels | null\n    if (levelsEl?.refreshCompleted)\n      levelsEl.refreshCompleted(this._getCompletedIds())\n  }\n\n  onEditorSelect(event: CustomEvent) {\n    event.stopPropagation()\n    const { mode, color, layer } = event.detail\n    this.game.drawMode = mode\n    console.log(mode)\n    if (mode === 'line' && layer !== undefined) {\n      this.game.drawLayer = layer\n    } else if (color !== undefined) {\n      this.game.drawColor = color\n    }\n    this.changed()\n  }\n\n  onLevelSelect(event: CustomEvent) {\n    event.stopPropagation()\n    const { level } = event.detail\n    $level.value = level\n  }\n}\n"]}