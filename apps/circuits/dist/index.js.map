{"version":3,"file":"index.js","sources":["../src/CircuitsLevels.ts","../src/game/items/pad.ts","../src/game/items/terminal.ts","../src/game/items/line.ts","../src/game/plotter.ts","../src/game/game.ts","../src/CircuitsBoard.ts","../src/CircuitsGame.ts","../src/CircuitsEditor.ts","../src/CircuitsApp.ts"],"sourcesContent":["import { IoElement, Register, ReactiveProperty } from '@io-gui/core'\nimport { MenuOption, ioMenuTree } from '@io-gui/menus'\n\n@Register\nexport class CircuitsLevels extends IoElement {\n  static get Style() {\n    return /* css */ `\n      :host > .app-title {\n        margin-left: 1rem;\n        font-size: 2rem;\n        font-weight: bold;\n        letter-spacing: 2px;\n        text-transform: uppercase;\n      }\n    `\n  }\n\n  @ReactiveProperty({ type: Array, value: [] })\n  declare completedLevels: string[]\n\n  private _option = new MenuOption({ id: 'levels', options: [] })\n  private _levelIds: string[] = []\n\n  async ready() {\n    await this._loadLevels()\n    this.changed()\n  }\n\n  private _buildLevelOptions(levelIds: string[], completedIds: string[]) {\n    return levelIds.map(\n      (id) =>\n        new MenuOption({\n          id,\n          label: id,\n          disabled: completedIds.includes(id),\n          action: () => this.dispatch('level-select', { level: id }, true),\n        }),\n    )\n  }\n\n  private async _loadLevels() {\n    const response = await fetch('./public/levels/index.json')\n    this._levelIds = await response.json()\n    const completed = this.completedLevels ?? []\n    this._option = new MenuOption({\n      id: 'levels',\n      options: this._buildLevelOptions(this._levelIds, completed),\n    })\n  }\n\n  refreshCompleted(completedIds: string[]) {\n    this.completedLevels = completedIds\n    this._option = new MenuOption({\n      id: 'levels',\n      options: this._buildLevelOptions(this._levelIds, completedIds),\n    })\n    this.changed()\n  }\n\n  changed() {\n    this.render([ioMenuTree({ option: this._option })])\n  }\n}\n\nexport const circuitsLevels = CircuitsLevels.vConstructor\n","import { TerminalColor } from './terminal.js'\n\nexport interface PadData {\n  id: number\n  pos: [number, number]\n}\n\nexport class Pad {\n  id: number\n  pos: [number, number]\n  _color: TerminalColor = 'white'\n\n  get color(): TerminalColor {\n    return this._color\n  }\n\n  set color(color: TerminalColor) {\n    this._color = color\n  }\n\n  constructor(id: number, pos: [number, number]) {\n    this.id = id\n    this.pos = pos\n  }\n\n  toJSON(): PadData {\n    return { pos: this.pos, id: this.id }\n  }\n\n  static fromJSON(data: PadData): Pad {\n    return new Pad(data.id, data.pos)\n  }\n}\n","export const TERMINAL_COLORS = {\n  white: '#ffffff',\n  red: '#e52800',\n  green: '#005923',\n  blue: '#06afff',\n  pink: '#ef47cc',\n  yellow: '#fec41a',\n  orange: '#ff6910',\n  purple: '#760281',\n  brown: '#820419',\n  grey: '#555555',\n  black: '#222222',\n}\n\nexport type TerminalColor = keyof typeof TERMINAL_COLORS\n\nexport interface TerminalData {\n  id: number\n  pos: [number, number]\n  color: TerminalColor\n}\n\nexport class Terminal {\n  id: number\n  pos: [number, number]\n  color: TerminalColor\n\n  constructor(id: number, pos: [number, number], color: TerminalColor) {\n    this.id = id\n    this.pos = pos\n    this.color = color\n  }\n\n  toJSON(): TerminalData {\n    return { id: this.id, pos: this.pos, color: this.color }\n  }\n\n  static fromJSON(data: TerminalData): Terminal {\n    return new Terminal(data.id, data.pos, data.color)\n  }\n}\n","import { TerminalColor } from './terminal.js'\n\nexport interface LineData {\n  id: number\n  pos: [number, number][]\n  layer: number\n}\n\nexport class Line {\n  id: number\n  pos: [number, number][]\n  layer: number\n  _color: TerminalColor = 'white'\n\n  get color(): TerminalColor {\n    return this._color\n  }\n\n  set color(color: TerminalColor) {\n    this._color = color\n  }\n\n  constructor(id: number, pos: [number, number], layer: number) {\n    this.id = id\n    this.pos = [pos]\n    this.layer = layer\n  }\n\n  hasDiagonalSegmentAt(mx: number, my: number): boolean {\n    const pos = this.pos\n    for (let i = 1; i < pos.length; i++) {\n      const ax = pos[i - 1][0]\n      const ay = pos[i - 1][1]\n      const bx = pos[i][0]\n      const by = pos[i][1]\n      if (\n        Math.abs(bx - ax) === 1 &&\n        Math.abs(by - ay) === 1 &&\n        (ax + bx) / 2 === mx &&\n        (ay + by) / 2 === my\n      ) {\n        return true\n      }\n    }\n    return false\n  }\n\n  /**\n   * Plot a new segment on the line if direction is valid.\n   * Erase last segment if user drags back to prev node.\n   * Return true if segment was added, false otherwise.\n   */\n  plotSegment(x: number, y: number): boolean {\n    if (this._tryEraseLastSegment(x, y)) return true\n    if (this._tryAddNewSegment(x, y)) return true\n    return false\n  }\n\n  toJSON(): LineData {\n    return {\n      id: this.id,\n      pos: this.pos,\n      layer: this.layer,\n    }\n  }\n\n  static fromJSON(data: LineData): Line {\n    const line = new Line(data.id, data.pos[0], data.layer)\n    for (let j = 1; j < data.pos.length; j++) {\n      line.plotSegment(data.pos[j][0], data.pos[j][1])\n    }\n    return line\n  }\n\n  /**\n   * Add segment or, if user went 45° backwards, remove one segment and add a 90° turn.\n   * Returns true if nothing was done, false if path was updated.\n   */\n  private _tryAddNewSegment(x: number, y: number): boolean {\n    const ln = this.pos.length\n    if (ln > 1) {\n      if (y === this.pos[ln - 2][1] && Math.abs(x - this.pos[ln - 2][0]) === 1) {\n        this.pos.pop()\n        this.pos.push([x, y])\n        return false\n      }\n      if (x === this.pos[ln - 2][0] && Math.abs(y - this.pos[ln - 2][1]) === 1) {\n        this.pos.pop()\n        this.pos.push([x, y])\n        return false\n      }\n    }\n    const last = this.pos[ln - 1]\n    if (Math.abs(last[0] - x) > 1) return true\n    if (Math.abs(last[1] - y) > 1) return true\n\n    this.pos.push([x, y])\n    return false\n  }\n\n  /** Erase last segment if user drags back to prev node. */\n  private _tryEraseLastSegment(x: number, y: number): boolean {\n    const ln = this.pos.length\n    if (ln < 2) return false\n    if (x === this.pos[ln - 2][0] && y === this.pos[ln - 2][1]) {\n      this.pos.pop()\n      return true\n    }\n    return false\n  }\n}\n","import { ReactiveNode, Register } from '@io-gui/core'\nimport { Pad } from './items/pad.js'\nimport { Terminal, type TerminalColor } from './items/terminal.js'\nimport { Line } from './items/line.js'\n\nexport interface PointAt {\n  id: number\n  isTerminal: boolean\n}\n\n/**\n * Plotter — position and geometry only.\n * Intersection checks, adding/removing pads, terminals, and lines.\n * No color, propagation, or completion.\n */\n@Register\nexport class Plotter extends ReactiveNode {\n  pads: Pad[] = []\n  terminals: Terminal[] = []\n  lines: Line[] = []\n\n  connect(pads: Pad[], terminals: Terminal[], lines: Line[]) {\n    this.pads = pads\n    this.terminals = terminals\n    this.lines = lines\n  }\n\n  getPointAt(x: number, y: number): Pad | Terminal | undefined {\n    for (const pad of this.pads) {\n      if (pad.pos[0] === x && pad.pos[1] === y)\n        return pad\n    }\n    for (const term of this.terminals) {\n      if (term.pos[0] === x && term.pos[1] === y)\n        return term\n    }\n  }\n\n  getLinesAtPoint(x: number, y: number, filter?: (line: Line) => boolean): Line[] {\n    const lines = []\n    for (const line of this.lines) {\n      if (line.pos.some(([px, py]) => px === x && py === y) && (filter?.(line) ?? true)) {\n        lines.push(line)\n      }\n    }\n    return lines\n  }\n\n  getLineById(id: number): Line | undefined {\n    return this.lines.find((l) => l.id === id)\n  }\n\n  checkDiagonalCrossing(line: Line, x: number, y: number): boolean {\n    const last = line.pos[line.pos.length - 1]\n    const mx = (x + last[0]) / 2\n    const my = (y + last[1]) / 2\n    for (const other of this.lines) {\n      if (other.layer !== line.layer) continue\n      if (other.hasDiagonalSegmentAt(mx, my)) return false\n    }\n    return true\n  }\n\n  addPad(id: number, x: number, y: number): boolean {\n    if (this.getPointAt(x, y)) return false\n    this.pads.push(new Pad(id, [x, y]))\n    this.dispatch('game-render', undefined, true)\n    return true\n  }\n\n  addTerminal(id: number, x: number, y: number, color: TerminalColor): boolean {\n    if (this.getPointAt(x, y)) return false\n    this.terminals.push(new Terminal(id, [x, y], color))\n    this.dispatch('game-render', undefined, true)\n    return true\n  }\n\n  delete(x: number, y: number) {\n    const padIdx = this.pads.findIndex((p) => p.pos[0] === x && p.pos[1] === y)\n    if (padIdx !== -1) {\n      this.pads.splice(padIdx, 1)\n    }\n    const termIdx = this.terminals.findIndex(\n      (t) => t.pos[0] === x && t.pos[1] === y,\n    )\n    if (termIdx !== -1) {\n      this.terminals.splice(termIdx, 1)\n    }\n    const lineIdx = this.lines.findIndex((l) =>\n      l.pos.some(([px, py]) => px === x && py === y),\n    )\n    if (lineIdx !== -1) {\n      this.lines.splice(lineIdx, 1)\n    }\n    this.dispatch('game-render', undefined, true)\n  }\n\n  verifyLineLegality(id: number): boolean {\n    const line = this.getLineById(id)\n    if (line) {\n      const first = line.pos[0]\n      const last = line.pos[line.pos.length - 1]\n      const p1 = this.getPointAt(first[0], first[1])\n      const p2 = this.getPointAt(last[0], last[1])\n      if (!p1 || !p2 || (first[0] === last[0] && first[1] === last[1])) {\n        const idx = this.lines.findIndex((l) => l.id === id)\n        if (idx !== -1) this.lines.splice(idx, 1)\n        return false\n      }\n      return true\n    }\n    return false\n  }\n\n  addLineSegment(id: number, x: number, y: number, layer: number): { added: boolean; endDrag: boolean } {\n    const point = this.getPointAt(x, y)\n    const linesAtPoint = this.getLinesAtPoint(x, y, (line) => (line.layer === 0))\n    const underlineLinesAtPoint = this.getLinesAtPoint(x, y, (line) => line.layer === -1)\n    const connectionLimit = point ? (point instanceof Terminal ? 1 : 2) : 0\n\n    let added = false\n    let endDrag = false\n\n    if (point && (linesAtPoint.length + underlineLinesAtPoint.length) >= connectionLimit) {\n      return { added, endDrag }\n    }\n\n    const line = this.getLineById(id)\n\n    if (line) {\n\n      if (!this.checkDiagonalCrossing(line, x, y)) {\n        return { added, endDrag }\n      }\n\n      const sameLineAtPoint = this.getLinesAtPoint(x, y, (line) => (line.id === id && line.layer === 0))?.[0] || null\n\n      if (!point && ((!linesAtPoint.length || sameLineAtPoint) || layer === -1)) {\n        added = line.plotSegment(x, y)\n      }\n\n      if (point) {\n        if (point.color !== 'white' && point.color !== line.color) {\n          return { added: false, endDrag: false }\n        }\n        added = line.plotSegment(x, y)\n        endDrag = added\n      }\n\n    } else {\n\n      if (!point) return { added: false, endDrag: false }\n      const newLine = new Line(id, [x, y], layer)\n      newLine.color = point.color\n      this.lines.push(newLine)\n      added = true\n\n    }\n\n    this.dispatch('game-render', undefined, true)\n    return { added, endDrag }\n  }\n}\n","import { Register, ReactiveNode, ReactiveProperty, Property, Storage as $, Binding } from '@io-gui/core'\nimport { Pad, type PadData } from './items/pad.js'\nimport {\n  Terminal,\n  type TerminalData,\n  type TerminalColor,\n} from './items/terminal.js'\nimport { Line, type LineData } from './items/line.js'\nimport { Plotter } from './plotter.js'\n\nexport type DrawMode = 'pad' | 'terminal' | 'line' | 'delete'\n\ninterface LevelData {\n  width: number\n  height: number\n  pads: PadData[]\n  terminals: TerminalData[]\n  lines: LineData[]\n}\n\n/**\n * Game — central state machine.\n * Manages pads, lines, load/save, undo/redo, colour propagation,\n * and completion checking.\n */\n@Register\nexport class Game extends ReactiveNode {\n  width = 4\n  height = 5\n  pads: Pad[] = []\n  terminals: Terminal[] = []\n  lines: Line[] = []\n\n  drawMode: DrawMode = 'line'\n  drawColor: TerminalColor = 'white'\n  drawLayer = 0\n\n  undoStack: string[] = []\n  redoStack: string[] = []\n\n  @ReactiveProperty({value: '', type: String})\n  declare currentLevel: string\n\n  @ReactiveProperty({type: Plotter, init: null})\n  declare plotter: Plotter\n\n  @Property($({key: 'null-level-state', value: {}, storage: 'local'}))\n  declare storedState: Binding\n\n  clear() {\n    this.width = 4\n    this.height = 5\n    this.pads = []\n    this.terminals = []\n    this.lines = []\n    this.plotter.connect(this.pads, this.terminals, this.lines)\n    this.drawMode = 'line'\n    this.drawColor = 'white'\n    this.drawLayer = 0\n    this.redoStack = []\n    this.undoStack = []\n  }\n\n  async initialize() {\n    this.clear()\n    this.storedState = $({key: `${this.currentLevel}-level-state`, value: {}, storage: 'local'})\n\n    if (this.currentLevel) {\n      if (Object.keys(this.storedState.value).length === 0) {\n        await this.load(this.currentLevel)\n      } else {\n        this.clear()\n        this.fromJSON(JSON.stringify(this.storedState.value))\n        this.propagateColors()\n      }\n    }\n\n    this.undoStack = [this.toJSON()]\n    this.redoStack = []\n    this.dispatch('game-render', undefined, true)\n  }\n\n  currentLevelChanged() {\n    void this.initialize().then(() => {\n      this.dispatch('game-init-scene', undefined, true)\n    })\n  }\n\n  reload() {\n    this.storedState.value = {}\n    void this.initialize()\n  }\n\n  async load(level: string): Promise<void> {\n    try {\n      const resp = await fetch('./public/levels/' + level + '.json')\n      if (!resp.ok) console.error('Level not found')\n      const text = await resp.text()\n      this.clear()\n      this.fromJSON(text)\n      this.propagateColors()\n      this.save()\n    } catch (e) {\n      console.warn('Could not load level:', level, e)\n    }\n  }\n\n  save(): void {\n    this.storedState.value = {\n      width: this.width,\n      height: this.height,\n      pads: this.pads.map((p) => p.toJSON()),\n      terminals: this.terminals.map((t) => t.toJSON()),\n      lines: this.lines.map((l) => l.toJSON()),\n    }\n  }\n\n  fromJSON(jsonText: string): void {\n    const state: LevelData = JSON.parse(jsonText)\n    this.width = state.width\n    this.height = state.height\n    this.pads = state.pads.map((p) => Pad.fromJSON(p))\n    this.terminals = state.terminals.map((t) => Terminal.fromJSON(t))\n    this.lines = state.lines.map((l) => Line.fromJSON(l as LineData))\n    this.plotter.connect(this.pads, this.terminals, this.lines)\n  }\n\n  toJSON(): string {\n    return JSON.stringify({\n      width: this.width,\n      height: this.height,\n      pads: this.pads.map((p) => p.toJSON()),\n      terminals: this.terminals.map((t) => t.toJSON()),\n      lines: this.lines.map((l) => l.toJSON()),\n    })\n  }\n\n  updateUndoStack(): void {\n    const state = this.toJSON()\n    if (state !== this.undoStack[this.undoStack.length - 1]) {\n      this.undoStack.push(state)\n    }\n  }\n\n  undo(): void {\n    if (this.undoStack.length >= 2) {\n      const currentState = this.undoStack.pop()!\n      this.fromJSON(this.undoStack[this.undoStack.length - 1])\n      this.redoStack.push(currentState)\n      this.propagateColors()\n      this.save()\n      this.dispatch('game-render', undefined, true)\n    }\n  }\n\n  redo(): void {\n    if (this.redoStack.length > 0) {\n      const state = this.redoStack.pop()!\n      this.fromJSON(state)\n      this.undoStack.push(state)\n      this.propagateColors()\n      this.save()\n      this.dispatch('game-render', undefined, true)\n    }\n  }\n\n  resetColors(): void {\n    for (const line of this.lines) line._color = 'white'\n    for (const pad of this.pads) pad._color = 'white'\n  }\n\n  propagateColors(): void {\n    this.resetColors()\n\n    for (let iter = 0; iter < 16; iter++) {\n      for (const line of this.lines) {\n        const first = line.pos[0]\n        const last = line.pos[line.pos.length - 1]\n\n        const p1 = this.plotter.getPointAt(first[0], first[1])\n        const p2 = this.plotter.getPointAt(last[0], last[1])\n        if (!p1 || !p2) continue\n\n        const c1 = p1.color\n        const c2 = p2.color\n\n        if (c1 !== 'white' && c2 !== 'white') {\n          if (c1 === c2) line._color = c1\n        } else if (c1 === 'white' && c2 === 'white') {\n          line._color = 'white'\n        } else {\n          if (c1 !== 'white') {\n            line._color = c1\n            if (p2 instanceof Pad) p2.color = c1\n          } else if (c2 !== 'white') {\n            line._color = c2\n            if (p1 instanceof Pad) p1.color = c2\n          }\n        }\n      }\n    }\n\n    this.dispatch('game-render', undefined, true)\n\n    let completed = true\n\n    // TODO: Check for completeness correctly\n\n    for (const term of this.terminals) {\n      const nConn = this.plotter.getLinesAtPoint(term.pos[0], term.pos[1]).length\n      if (nConn !== 1) completed = false\n    }\n\n    for (const pad of this.pads) {\n      const nConn = this.plotter.getLinesAtPoint(pad.pos[0], pad.pos[1]).length\n      if (nConn !== 2 && pad._color !== 'white') completed = false\n    }\n\n    this.dispatch('game-complete', { level: this.currentLevel, completed }, true)\n  }\n\n  finalizeMove(lineID: number): void {\n    if (this.plotter.verifyLineLegality(lineID)) {\n      this.updateUndoStack()\n      this.propagateColors()\n      this.save()\n    }\n    this.dispatch('game-render', undefined, true)\n  }\n}\n","import {\n  IoElement,\n  Register,\n  ReactiveProperty,\n  IoElementProps,\n  canvas,\n} from '@io-gui/core'\nimport { Game } from './game/game.js'\nimport { Pad } from './game/items/pad.js'\nimport {\n  Terminal,\n  type TerminalColor,\n  TERMINAL_COLORS as COLORS,\n} from './game/items/terminal.js'\nimport { Line } from './game/items/line.js'\n\n/**\n * Scene — manages layered HTML5 canvases and renders the game state.\n *\n * Layer stack (bottom -> top):\n *   grid   – static grid lines (redrawn on initGrid)\n *   layer0 – line.layer -1 (bottom, underlines)\n *   layer1 – line.layer 0 (top) + pads + terminals\n *   top    – touch marker overlay\n */\n\ninterface CanvasLayer {\n  canvas: HTMLCanvasElement\n  ctx: CanvasRenderingContext2D\n}\n\nexport class Scene {\n  layers: Record<string, CanvasLayer> = {}\n  canvasWidth = 0\n  canvasHeight = 0\n  gridWidth = 0\n  gridHeight = 0\n  gridUnit = 0\n  gridOffsetX = 0\n  gridOffsetY = 0\n  markerRadius = 0\n\n  /** Set up layers from externally provided canvases. */\n  init(canvases: Record<string, HTMLCanvasElement>): void {\n    this.layers = {}\n    for (const name in canvases) {\n      const canvas = canvases[name]\n      const ctx = canvas.getContext('2d')!\n      this.layers[name] = { canvas, ctx }\n    }\n  }\n\n  /** Recalculate grid geometry and draw the static grid. */\n  initGrid(\n    gameWidth: number,\n    gameHeight: number,\n    containerWidth: number,\n    containerHeight: number,\n  ): void {\n    this.canvasWidth = containerWidth\n    this.canvasHeight = containerHeight\n    const dpr = window.devicePixelRatio || 1\n\n    for (const name in this.layers) {\n      const { canvas } = this.layers[name]\n      canvas.width = this.canvasWidth * dpr\n      canvas.height = this.canvasHeight * dpr\n      canvas.style.width = this.canvasWidth + 'px'\n      canvas.style.height = this.canvasHeight + 'px'\n      this.layers[name].ctx.setTransform(dpr, 0, 0, dpr, 0, 0)\n    }\n\n    this.gridWidth = gameWidth\n    this.gridHeight = gameHeight\n\n    // Calculate unit size so the grid fits with a half-unit margin\n    if (\n      this.canvasHeight / this.gridHeight >\n      this.canvasWidth / this.gridWidth\n    ) {\n      this.gridUnit = this.canvasWidth / (this.gridWidth + 1)\n    } else {\n      this.gridUnit = this.canvasHeight / (this.gridHeight + 1)\n    }\n\n    this.gridOffsetX = (this.canvasWidth - this.gridUnit * this.gridWidth) / 2\n    this.gridOffsetY =\n      (this.canvasHeight - this.gridUnit * this.gridHeight) / 2\n\n    // --- Draw static grid ---\n    const ctx = this.layers.grid.ctx\n    ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n\n    ctx.fillStyle = 'rgba(255,255,255,0.2)'\n    ctx.fillRect(\n      this.gridOffsetX,\n      this.gridOffsetY,\n      this.gridWidth * this.gridUnit,\n      this.gridHeight * this.gridUnit,\n    )\n\n    ctx.strokeStyle = 'rgba(255,255,255,0.5)'\n    ctx.lineWidth = 1\n\n    for (let i = 0; i <= gameWidth; i++) {\n      const x = i * this.gridUnit + this.gridOffsetX\n      ctx.beginPath()\n      ctx.moveTo(x, this.gridOffsetY)\n      ctx.lineTo(x, this.gridHeight * this.gridUnit + this.gridOffsetY)\n      ctx.stroke()\n    }\n\n    for (let j = 0; j <= gameHeight; j++) {\n      const y = j * this.gridUnit + this.gridOffsetY\n      ctx.beginPath()\n      ctx.moveTo(this.gridOffsetX, y)\n      ctx.lineTo(this.gridWidth * this.gridUnit + this.gridOffsetX, y)\n      ctx.stroke()\n    }\n\n    this.markerRadius = this.canvasWidth * 0.1\n  }\n\n  // -- Rendering --\n\n  /** Full re-render of lines, pads and terminals on the dynamic layers. */\n  render(pads: Pad[], terminals: Terminal[], lines: Line[]): void {\n    const ctx0 = this.layers.layer0?.ctx\n    const ctx1 = this.layers.layer1?.ctx\n    if (!ctx0 || !ctx1) return\n\n    ctx0.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n    ctx1.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n\n    for (const line of lines) this._drawLineStroke(line)\n    for (const pad of pads) this._drawPadStroke(pad)\n    for (const term of terminals) this._drawTerminalStroke(term)\n\n    for (const line of lines) {\n      this._drawLineFill(line, line._color)\n    }\n    for (const pad of pads)\n      this._drawPadFill(pad, pad._color)\n    for (const term of terminals)\n      this._drawTerminalFill(term, term.color)\n  }\n\n  // -- Line drawing helpers --\n\n  private static readonly _layerToCanvas: Record<number, 'layer0' | 'layer1'> =\n    {\n      [-1]: 'layer0',\n      0: 'layer1',\n    }\n\n  private _lineParams(line: Line) {\n    const isBottom = line.layer === -1\n    const layerName = Scene._layerToCanvas[line.layer] ?? 'layer1'\n    const ctx = this.layers[layerName]?.ctx ?? this.layers.layer1.ctx\n    let radius = this.gridUnit / 4\n    let strokeW = 3\n    let strokeColor = 'rgba(0,0,0,1)'\n    let opacity = 1\n\n    if (isBottom) {\n      radius *= 1.4\n      strokeW *= 4\n      strokeColor = 'rgba(128,128,128,0.25)'\n      opacity = 0.25\n    }\n\n    return {\n      ctx,\n      radius,\n      strokeW,\n      strokeColor,\n      opacity,\n    }\n  }\n\n  private _buildLinePath(\n    ctx: CanvasRenderingContext2D,\n    positions: [number, number][],\n  ): void {\n    ctx.beginPath()\n    for (let i = 0; i < positions.length; i++) {\n      const x = positions[i][0] * this.gridUnit + this.gridOffsetX\n      const y = positions[i][1] * this.gridUnit + this.gridOffsetY\n      if (i === 0) ctx.moveTo(x, y)\n      else ctx.lineTo(x, y)\n    }\n  }\n\n  private _drawLineStroke(line: Line): void {\n    if (line.pos.length < 2) return\n    const p = this._lineParams(line)\n    p.ctx.save()\n    p.ctx.globalAlpha = p.opacity\n    p.ctx.lineCap = 'round'\n    p.ctx.lineJoin = 'round'\n    this._buildLinePath(p.ctx, line.pos)\n    p.ctx.strokeStyle = p.strokeColor\n    p.ctx.lineWidth = p.radius + p.strokeW * 2\n    p.ctx.stroke()\n    p.ctx.restore()\n  }\n\n  private _drawLineFill(line: Line, color: TerminalColor): void {\n    if (line.pos.length < 2) return\n    const p = this._lineParams(line)\n    p.ctx.save()\n    p.ctx.globalAlpha = p.opacity\n    p.ctx.lineCap = 'round'\n    p.ctx.lineJoin = 'round'\n    this._buildLinePath(p.ctx, line.pos)\n    p.ctx.strokeStyle = COLORS[color] ?? '#fff'\n    p.ctx.lineWidth = p.radius\n    p.ctx.stroke()\n    p.ctx.restore()\n  }\n\n  // -- Pad drawing helpers (pads are always white circles) --\n\n  private _drawPadStroke(pad: Pad): void {\n    const ctx = this.layers.layer1.ctx\n    const xx = pad.pos[0] * this.gridUnit + this.gridOffsetX\n    const yy = pad.pos[1] * this.gridUnit + this.gridOffsetY\n    const r = this.gridUnit / 3\n    const sw = 3\n    ctx.beginPath()\n    ctx.arc(xx, yy, r + sw, 0, Math.PI * 2)\n    ctx.fillStyle = 'rgba(0,0,0,1)'\n    ctx.fill()\n  }\n\n  private _drawPadFill(pad: Pad, color: TerminalColor): void {\n    const ctx = this.layers.layer1.ctx\n    const xx = pad.pos[0] * this.gridUnit + this.gridOffsetX\n    const yy = pad.pos[1] * this.gridUnit + this.gridOffsetY\n    const r = this.gridUnit / 3\n    ctx.beginPath()\n    ctx.arc(xx, yy, r, 0, Math.PI * 2)\n    ctx.fillStyle = COLORS[color] ?? '#fff'\n    ctx.fill()\n  }\n\n  // -- Terminal drawing helpers (terminals are colored squares) --\n\n  private _drawTerminalStroke(terminal: Terminal): void {\n    const ctx = this.layers.layer1.ctx\n    const xx = terminal.pos[0] * this.gridUnit + this.gridOffsetX\n    const yy = terminal.pos[1] * this.gridUnit + this.gridOffsetY\n    const r = this.gridUnit / 3\n    const sw = 3\n    ctx.fillStyle = 'rgba(0,0,0,1)'\n    ctx.fillRect(xx - r - sw, yy - r - sw, (r + sw) * 2, (r + sw) * 2)\n  }\n\n  private _drawTerminalFill(terminal: Terminal, color: TerminalColor): void {\n    const ctx = this.layers.layer1.ctx\n    const xx = terminal.pos[0] * this.gridUnit + this.gridOffsetX\n    const yy = terminal.pos[1] * this.gridUnit + this.gridOffsetY\n    const r = this.gridUnit / 3\n    ctx.fillStyle = COLORS[color] ?? '#fff'\n    ctx.fillRect(xx - r, yy - r, r * 2, r * 2)\n  }\n\n  // -- Touch marker --\n\n  drawMarker(touchX: number, touchY: number): void {\n    const ctx = this.layers.top?.ctx\n    if (!ctx) return\n    ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n    const xx = touchX * this.gridUnit + this.gridOffsetX\n    const yy = touchY * this.gridUnit + this.gridOffsetY\n    ctx.beginPath()\n    ctx.arc(xx, yy, this.markerRadius, 0, Math.PI * 2)\n    ctx.fillStyle = 'rgba(255,255,255,0.05)'\n    ctx.fill()\n  }\n\n  hideMarker(): void {\n    const ctx = this.layers.top?.ctx\n    if (!ctx) return\n    ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n  }\n}\n\ntype CircuitsBoardProps = IoElementProps & {\n  game?: Game\n}\n\n/**\n * CircuitsBoard — canvas-based game board IoElement.\n * Owns the Scene, creates 4 layered canvases, handles pointer events,\n * and translates screen coordinates to grid positions (plotter logic).\n */\nexport class CircuitsBoard extends IoElement {\n  static get Style() {\n    return /* css */ `\n      :host {\n        flex: 1;\n        position: relative;\n        background: rgba(0, 0, 0, 0.8);\n        border: 1px solid #99f;\n        border-radius: 12px;\n        margin: 2px;\n        overflow: hidden;\n        touch-action: none;\n      }\n      :host > canvas {\n        position: absolute;\n        top: 0;\n        left: 0;\n      }\n    `\n  }\n\n  static get Listeners(): Record<string, string> {\n    return {\n      pointerdown: 'onPointerdown',\n      'game-init-scene': 'onGameInitScene',\n      'game-render': 'onGameRender',\n    }\n  }\n\n  @ReactiveProperty({ type: Game })\n  declare game: Game\n\n  @ReactiveProperty({ type: Scene, init: null })\n  declare scene: Scene\n\n  // Plotter state\n  private _touchX = 0\n  private _touchY = 0\n  private _gridX = 0\n  private _gridY = 0\n  private _gridXOld = 0\n  private _gridYOld = 0\n  private _drag = false\n  private _randomID = 0\n\n  constructor(args: CircuitsBoardProps = {}) {\n    super(args)\n  }\n\n  ready() {\n    this.changed()\n  }\n\n  changed() {\n    this.render([\n      canvas({ id: 'grid', style: { zIndex: '100' } }),\n      canvas({ id: 'layer0', style: { zIndex: '101' } }),\n      canvas({ id: 'layer1', style: { zIndex: '102' } }),\n      canvas({ id: 'top', style: { zIndex: '105' } }),\n    ])\n    this._initScene()\n  }\n\n  onResized() {\n    this._initScene()\n  }\n\n  private _initScene(): void {\n    const grid = this.querySelector('#grid') as HTMLCanvasElement\n    const layer0 = this.querySelector('#layer0') as HTMLCanvasElement\n    const layer1 = this.querySelector('#layer1') as HTMLCanvasElement\n    const top = this.querySelector('#top') as HTMLCanvasElement\n    if (!grid || !layer0 || !layer1 || !top) return\n\n    this.scene.init({ grid, layer0, layer1, top })\n\n    const rect = this.getBoundingClientRect()\n    if (rect.width === 0 || rect.height === 0) return\n\n    if (this.game) {\n      this.scene.initGrid(\n        this.game.width,\n        this.game.height,\n        rect.width,\n        rect.height,\n      )\n      this.scene.render(\n        this.game.pads,\n        this.game.terminals,\n        this.game.lines,\n      )\n    }\n  }\n\n  gameChanged() {\n    this._initScene()\n  }\n\n  onGameInitScene() {\n    const rect = this.getBoundingClientRect()\n    if (rect.width === 0 || rect.height === 0) return\n    this.scene.initGrid(\n      this.game.width,\n      this.game.height,\n      rect.width,\n      rect.height,\n    )\n    this.scene.render(\n      this.game.pads,\n      this.game.terminals,\n      this.game.lines,\n    )\n  };\n  onGameRender() {\n    this.scene.render(\n      this.game.pads,\n      this.game.terminals,\n      this.game.lines,\n    )\n  };\n\n  onPointerdown(event: PointerEvent) {\n    event.preventDefault()\n    this.setPointerCapture(event.pointerId)\n    this.addEventListener('pointermove', this.onPointermove)\n    this.addEventListener('pointerup', this.onPointerup)\n\n    this._randomID = Math.floor(Math.random() * 100000)\n    this._drag = true\n    this._initPosition(event)\n    this.scene.drawMarker(this._touchX, this._touchY)\n\n    if (!this.game) return\n\n    if (this.game.drawMode === 'pad') {\n      this.game.plotter.addPad(this._randomID, this._gridX, this._gridY)\n    }\n    if (this.game.drawMode === 'terminal') {\n      this.game.plotter.addTerminal(\n        this._randomID,\n        this._gridX,\n        this._gridY,\n        this.game.drawColor,\n      )\n    }\n    if (this.game.drawMode === 'line') {\n      this.game.plotter.addLineSegment(\n        this._randomID,\n        this._gridX,\n        this._gridY,\n        this.game.drawLayer,\n      )\n    }\n    if (this.game.drawMode === 'delete') {\n      this.game.plotter.delete(this._gridX, this._gridY)\n    }\n  }\n\n  onPointermove(event: PointerEvent) {\n    event.preventDefault()\n    this._updatePosition(event)\n    this.scene.drawMarker(this._gridX, this._gridY)\n\n    if (!this.game) return\n\n    if (\n      this.game.drawMode === 'line' &&\n      this._drag &&\n      (this._gridX !== this._gridXOld || this._gridY !== this._gridYOld)\n    ) {\n      const { endDrag } = this.game.plotter.addLineSegment(\n        this._randomID,\n        this._gridX,\n        this._gridY,\n        this.game.drawLayer,\n      )\n      if (endDrag) this._drag = false\n    }\n  }\n\n  onPointerup(event: PointerEvent) {\n    event.preventDefault()\n    this.releasePointerCapture(event.pointerId)\n    this.removeEventListener('pointermove', this.onPointermove)\n    this.removeEventListener('pointerup', this.onPointerup)\n\n    this._drag = false\n    this.scene.hideMarker()\n\n    if (!this.game) return\n\n    this.game.finalizeMove(this._randomID)\n  }\n\n  private _initPosition(event: PointerEvent): void {\n    const rect = this.getBoundingClientRect()\n\n    this._touchX =\n      (event.clientX - rect.left - this.scene.gridOffsetX) /\n      this.scene.gridUnit\n    this._touchY =\n      (event.clientY - rect.top - this.scene.gridOffsetY) / this.scene.gridUnit\n\n    this._gridX = Math.round(this._touchX)\n    this._gridY = Math.round(this._touchY)\n    this._gridXOld = this._gridX\n    this._gridYOld = this._gridY\n  }\n\n  private _updatePosition(event: PointerEvent): void {\n    const rect = this.getBoundingClientRect()\n\n    this._touchX =\n      (event.clientX - rect.left - this.scene.gridOffsetX) /\n      this.scene.gridUnit\n    this._touchY =\n      (event.clientY - rect.top - this.scene.gridOffsetY) / this.scene.gridUnit\n\n    const distance = Math.sqrt(\n      Math.pow(this._touchX - Math.round(this._touchX), 2) +\n        Math.pow(this._touchY - Math.round(this._touchY), 2),\n    )\n\n    if (!this.game) return\n\n    if (\n      distance < 0.5 &&\n      this._touchX <= this.game.width + 0.5 &&\n      this._touchY <= this.game.height + 0.5 &&\n      this._touchX >= -0.5 &&\n      this._touchY >= -0.5\n    ) {\n      this._gridXOld = this._gridX\n      this._gridYOld = this._gridY\n\n      this._gridX = Math.round(this._touchX)\n      this._gridY = Math.round(this._touchY)\n\n      if (this._gridX > this._gridXOld) this._gridX = this._gridXOld + 1\n      if (this._gridX < this._gridXOld) this._gridX = this._gridXOld - 1\n      if (this._gridY > this._gridYOld) this._gridY = this._gridYOld + 1\n      if (this._gridY < this._gridYOld) this._gridY = this._gridYOld - 1\n    }\n  }\n}\nRegister(CircuitsBoard)\nexport const circuitsBoard = function (arg0: CircuitsBoardProps) {\n  return CircuitsBoard.vConstructor(arg0)\n}\n","import { IoElement, Register, ReactiveProperty, IoElementProps, div, WithBinding, ListenerDefinitions } from '@io-gui/core'\nimport { ioButton } from '@io-gui/inputs'\nimport { Game } from './game/game.js'\nimport { circuitsBoard } from './CircuitsBoard.js'\n\ntype CircuitsGameProps = IoElementProps & {\n  level: WithBinding<string>\n  game: Game\n}\n\nexport class CircuitsGame extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n      }\n      :host > .game-toolbar {\n        display: flex;\n        gap: 2px;\n        padding: 2px;\n        flex-shrink: 0;\n      }\n    `\n  }\n\n  static get Listeners(): ListenerDefinitions {\n    return {\n      'game-complete': 'onGameComplete',\n    }\n  }\n\n  @ReactiveProperty({value: '', type: String})\n  declare level: string\n\n  @ReactiveProperty({type: Game, init: null})\n  declare game: Game\n\n  completeFn: ((level: string, completed: boolean) => void) | null = null\n\n  constructor(args: CircuitsGameProps) { super(args) }\n\n  ready() {\n    this.changed()\n  }\n\n  onGameComplete(event: CustomEvent<{ level: string; completed: boolean }>) {\n    if (this.completeFn) this.completeFn(event.detail.level, event.detail.completed)\n  }\n\n  changed() {\n    this.render([\n      div({class: 'game-toolbar'}, [\n        ioButton({label: 'Undo', action: this.onUndo}),\n        ioButton({label: 'Edit', action: this.onEdit}),\n        ioButton({label: 'Reset', action: this.onReset}),\n        ioButton({label: 'Redo', action: this.onRedo}),\n        ioButton({label: 'Back', action: this.onBack}),\n      ]),\n      circuitsBoard({id: 'board', game: this.game}),\n    ])\n  }\n\n  levelChanged() {\n    this.game.currentLevel = this.level\n    const board = this.querySelector('circuits-board') as IoElement | null\n    if (board) (board as any).gameChanged()\n  }\n\n  onUndo() {\n    this.game.undo()\n  }\n\n  onRedo() {\n    this.game.redo()\n  }\n\n  onReset() {\n    this.game.reload()\n  }\n\n  onEdit() {\n    this.changed()\n  }\n\n  onBack() {\n    this.dispatch('back-to-levels', undefined, true)\n  }\n}\n\nRegister(CircuitsGame)\n\nexport const circuitsGame = function(arg0: CircuitsGameProps) {\n  return CircuitsGame.vConstructor(arg0)\n}\n","import { IoElement, Register } from '@io-gui/core'\nimport { ioButton } from '@io-gui/inputs'\nimport type { DrawMode } from './game/game.js'\nimport { TERMINAL_COLORS } from './game/items/terminal.js'\n\n@Register\nexport class CircuitsEditor extends IoElement {\n  static get Style() {\n    return /* css */ `\n      :host {\n        display: flex;\n        flex-direction: column;\n        background: rgba(0, 0, 0, 0.85);\n        align-items: center;\n        justify-content: center;\n        flex: 1 1 auto;\n        gap: 4px;\n        padding: 8px;\n      }\n      :host > io-button {\n        display: flex;\n        flex-wrap: wrap;\n        justify-content: center;\n        width: 100%;\n      }\n    `\n  }\n\n  ready() {\n    this.changed()\n  }\n\n  changed() {\n    this.render([\n      ioButton({ label: 'Pad', action: () => this._select('pad', 'white') }),\n      ...Object.keys(TERMINAL_COLORS).map((c) =>\n        ioButton({ label: c, action: () => this._select('terminal', c) }),\n      ),\n      ioButton({\n        label: 'Line (top)',\n        action: () => this.dispatch('editor-select', { mode: 'line', layer: 0 }, true),\n      }),\n      ioButton({\n        label: 'Line (bottom)',\n        action: () => this.dispatch('editor-select', { mode: 'line', layer: -1 }, true),\n      }),\n      ioButton({ label: 'Delete', action: () => this._select('delete', 'red') }),\n    ])\n  }\n\n  private _select(mode: DrawMode, color: string) {\n    this.dispatch('editor-select', { mode, color }, true)\n  }\n}\n\nexport const circuitsEditor = CircuitsEditor.vConstructor\n","import {\n  Register,\n  IoElement,\n  ReactiveProperty,\n  Storage as $,\n  ListenerDefinitions,\n} from '@io-gui/core'\nimport { ioSplit, Split } from '@io-gui/layout'\n\nimport { circuitsLevels, CircuitsLevels } from './CircuitsLevels.js'\nimport { circuitsGame } from './CircuitsGame.js'\nimport { circuitsEditor } from './CircuitsEditor.js'\nimport { Game } from './game/game.js'\n\n$.permit()\nconst $level = $({ key: 'level', storage: 'hash', value: '' })\nconst $completed = $({\n  key: 'circuits-completed',\n  storage: 'local',\n  value: '[]',\n})\n\n@Register\nexport class CircuitsApp extends IoElement {\n  static get Style() {\n    return /* css */ `\n      :host {\n        display: flex;\n        position: fixed;\n        inset: 0;\n        background-color: var(--io_bgColor);\n        color: var(--io_color);\n        user-select: none;\n        -webkit-user-select: none;\n        -webkit-text-size-adjust: none;\n        -webkit-touch-callout: none;\n      }\n    `\n  }\n\n  @ReactiveProperty({ type: Game, init: null })\n  declare game: Game\n\n  static get Listeners(): ListenerDefinitions {\n    return {\n      'level-select': 'onLevelSelect',\n      'editor-select': 'onEditorSelect',\n    }\n  }\n\n  ready() {\n    const completedIds = this._getCompletedIds()\n    this.render([\n      ioSplit({\n        split: new Split({\n          type: 'split',\n          children: [\n            { type: 'panel', flex: '0 0 110px', tabs: [{ id: 'levels' }] },\n            { type: 'panel', flex: '1 1 auto', tabs: [{ id: 'game' }] },\n            { type: 'panel', flex: '0 0 120px', tabs: [{ id: 'editor' }] },\n          ],\n        }),\n        elements: [\n          circuitsLevels({ id: 'levels', completedLevels: completedIds } as {\n            id: string\n            completedLevels: string[]\n          }),\n          circuitsGame({ id: 'game', level: $level, game: this.game }),\n          circuitsEditor({ id: 'editor' }),\n        ],\n      }),\n    ])\n    const gameEl = this.querySelector('#game') as {\n      completeFn?: (level: string, completed: boolean) => void\n    } | null\n    if (gameEl) {\n      gameEl.completeFn = (level: string, completed: boolean) =>\n        this.onLevelComplete(level, completed)\n    }\n  }\n\n  private _getCompletedIds(): string[] {\n    try {\n      return JSON.parse($completed.value || '[]') as string[]\n    } catch {\n      return []\n    }\n  }\n\n  private _setCompletedIds(ids: string[]) {\n    $completed.value = JSON.stringify(ids)\n  }\n\n  onLevelComplete(level: string, completed: boolean) {\n    if (!completed) return\n    const ids = this._getCompletedIds()\n    if (ids.includes(level)) return\n    this._setCompletedIds([...ids, level])\n    const levelsEl = this.querySelector('#levels') as CircuitsLevels | null\n    if (levelsEl?.refreshCompleted)\n      levelsEl.refreshCompleted(this._getCompletedIds())\n  }\n\n  onEditorSelect(event: CustomEvent) {\n    event.stopPropagation()\n    const { mode, color, layer } = event.detail\n    this.game.drawMode = mode\n    if (mode === 'line' && layer !== undefined) {\n      this.game.drawLayer = layer\n    } else if (color !== undefined) {\n      this.game.drawColor = color\n    }\n    this.changed()\n  }\n\n  onLevelSelect(event: CustomEvent) {\n    event.stopPropagation()\n    const { level } = event.detail\n    $level.value = level\n  }\n}\n"],"names":["CircuitsLevels","IoElement","Style","_option","MenuOption","id","options","_levelIds","ready","this","_loadLevels","changed","_buildLevelOptions","levelIds","completedIds","map","label","disabled","includes","action","dispatch","level","response","fetch","json","completed","completedLevels","refreshCompleted","render","ioMenuTree","option","__decorateClass","ReactiveProperty","type","Array","value","prototype","Register","circuitsLevels","vConstructor","Pad","pos","_color","color","constructor","toJSON","fromJSON","data","TERMINAL_COLORS","white","red","green","blue","pink","yellow","orange","purple","brown","grey","black","Terminal","Line","layer","hasDiagonalSegmentAt","mx","my","i","length","ax","ay","bx","by","Math","abs","plotSegment","x","y","_tryEraseLastSegment","_tryAddNewSegment","line","j","ln","pop","push","last","Plotter","ReactiveNode","pads","terminals","lines","connect","getPointAt","pad","term","getLinesAtPoint","filter","some","px","py","getLineById","find","l","checkDiagonalCrossing","other","addPad","addTerminal","padIdx","findIndex","p","splice","termIdx","t","lineIdx","verifyLineLegality","first","p1","p2","idx","addLineSegment","point","linesAtPoint","underlineLinesAtPoint","connectionLimit","added","endDrag","sameLineAtPoint","newLine","Game","width","height","drawMode","drawColor","drawLayer","undoStack","redoStack","clear","plotter","initialize","storedState","$","key","currentLevel","storage","Object","keys","load","JSON","stringify","propagateColors","currentLevelChanged","then","reload","resp","ok","console","error","text","save","e","warn","jsonText","state","parse","updateUndoStack","undo","currentState","redo","resetColors","iter","c1","c2","finalizeMove","lineID","String","init","Property","Scene","layers","canvasWidth","canvasHeight","gridWidth","gridHeight","gridUnit","gridOffsetX","gridOffsetY","markerRadius","canvases","name","canvas","ctx","getContext","initGrid","gameWidth","gameHeight","containerWidth","containerHeight","dpr","window","devicePixelRatio","style","setTransform","grid","clearRect","fillStyle","fillRect","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","ctx0","layer0","ctx1","layer1","_drawLineStroke","_drawPadStroke","_drawTerminalStroke","_drawLineFill","_drawPadFill","_drawTerminalFill","static","_lineParams","isBottom","layerName","_layerToCanvas","radius","strokeW","strokeColor","opacity","_buildLinePath","positions","globalAlpha","lineCap","lineJoin","restore","COLORS","xx","yy","r","arc","PI","fill","terminal","drawMarker","touchX","touchY","top","hideMarker","CircuitsBoard","Listeners","pointerdown","_touchX","_touchY","_gridX","_gridY","_gridXOld","_gridYOld","_drag","_randomID","args","super","zIndex","_initScene","onResized","querySelector","scene","rect","getBoundingClientRect","game","gameChanged","onGameInitScene","onGameRender","onPointerdown","event","preventDefault","setPointerCapture","pointerId","addEventListener","onPointermove","onPointerup","floor","random","_initPosition","delete","_updatePosition","releasePointerCapture","removeEventListener","clientX","left","clientY","round","distance","sqrt","pow","CircuitsGame","completeFn","onGameComplete","detail","arg0","div","class","ioButton","onUndo","onEdit","onReset","onRedo","onBack","levelChanged","board","CircuitsEditor","_select","c","mode","circuitsEditor","permit","$level","$completed","CircuitsApp","_getCompletedIds","ioSplit","split","Split","children","flex","tabs","elements","gameEl","onLevelComplete","_setCompletedIds","ids","levelsEl","onEditorSelect","stopPropagation","onLevelSelect"],"mappings":"goBAIO,IAAMA,eAAN,cAA6BC,UAClC,gBAAWC,GACT,MAAiB,iMASnB,CAKQC,QAAU,IAAIC,WAAW,CAAEC,GAAI,SAAUC,QAAS,KAClDC,UAAsB,GAE9B,WAAMC,SACEC,KAAKC,cACXD,KAAKE,SACP,CAEQ,kBAAAC,CAAmBC,SAAoBC,cAC7C,OAAOD,SAASE,IACbV,IACC,IAAID,WAAW,CACbC,MACAW,MAAOX,GACPY,SAAUH,aAAaI,SAASb,IAChCc,OAAQ,IAAMV,KAAKW,SAAS,eAAgB,CAAEC,MAAOhB,KAAM,KAGnE,CAEA,iBAAcK,GACZ,MAAMY,eAAiBC,MAAM,8BAC7Bd,KAAKF,gBAAkBe,SAASE,OAChC,MAAMC,UAAYhB,KAAKiB,iBAAmB,GAC1CjB,KAAKN,QAAU,IAAIC,WAAW,CAC5BC,GAAI,SACJC,QAASG,KAAKG,mBAAmBH,KAAKF,UAAWkB,YAErD,CAEA,gBAAAE,CAAiBb,cACfL,KAAKiB,gBAAkBZ,aACvBL,KAAKN,QAAU,IAAIC,WAAW,CAC5BC,GAAI,SACJC,QAASG,KAAKG,mBAAmBH,KAAKF,UAAWO,gBAEnDL,KAAKE,SACP,CAEA,OAAAA,GACEF,KAAKmB,OAAO,CAACC,WAAW,CAAEC,OAAQrB,KAAKN,WACzC,GA3CQ4B,kBAAA,CADPC,iBAAiB,CAAEC,KAAMC,MAAOC,MAAO,MAb7BnC,eAcHoC,UAAA,kBAAA,GAdGpC,eAAN+B,kBAAA,CADNM,UACYrC,gBA4DN,MAAMsC,eAAiBtC,eAAeuC,aCzDtC,MAAMC,IACXnC,GACAoC,IACAC,OAAwB,QAExB,SAAIC,GACF,OAAOlC,KAAKiC,MACd,CAEA,SAAIC,CAAMA,OACRlC,KAAKiC,OAASC,KAChB,CAEA,WAAAC,CAAYvC,GAAYoC,KACtBhC,KAAKJ,GAAKA,GACVI,KAAKgC,IAAMA,GACb,CAEA,MAAAI,GACE,MAAO,CAAEJ,IAAKhC,KAAKgC,IAAKpC,GAAII,KAAKJ,GACnC,CAEA,eAAOyC,CAASC,MACd,OAAO,IAAIP,IAAIO,KAAK1C,GAAI0C,KAAKN,IAC/B,EC/BK,MAAMO,gBAAkB,CAC7BC,MAAO,UACPC,IAAK,UACLC,MAAO,UACPC,KAAM,UACNC,KAAM,UACNC,OAAQ,UACRC,OAAQ,UACRC,OAAQ,UACRC,MAAO,UACPC,KAAM,UACNC,MAAO,WAWF,MAAMC,SACXvD,GACAoC,IACAE,MAEA,WAAAC,CAAYvC,GAAYoC,IAAuBE,OAC7ClC,KAAKJ,GAAKA,GACVI,KAAKgC,IAAMA,IACXhC,KAAKkC,MAAQA,KACf,CAEA,MAAAE,GACE,MAAO,CAAExC,GAAII,KAAKJ,GAAIoC,IAAKhC,KAAKgC,IAAKE,MAAOlC,KAAKkC,MACnD,CAEA,eAAOG,CAASC,MACd,OAAO,IAAIa,SAASb,KAAK1C,GAAI0C,KAAKN,IAAKM,KAAKJ,MAC9C,EC/BK,MAAMkB,KACXxD,GACAoC,IACAqB,MACApB,OAAwB,QAExB,SAAIC,GACF,OAAOlC,KAAKiC,MACd,CAEA,SAAIC,CAAMA,OACRlC,KAAKiC,OAASC,KAChB,CAEA,WAAAC,CAAYvC,GAAYoC,IAAuBqB,OAC7CrD,KAAKJ,GAAKA,GACVI,KAAKgC,IAAM,CAACA,KACZhC,KAAKqD,MAAQA,KACf,CAEA,oBAAAC,CAAqBC,GAAYC,IAC/B,MAAMxB,IAAMhC,KAAKgC,IACjB,IAAA,IAASyB,EAAI,EAAGA,EAAIzB,IAAI0B,OAAQD,IAAK,CACnC,MAAME,GAAK3B,IAAIyB,EAAI,GAAG,GAChBG,GAAK5B,IAAIyB,EAAI,GAAG,GAChBI,GAAK7B,IAAIyB,GAAG,GACZK,GAAK9B,IAAIyB,GAAG,GAClB,GACwB,IAAtBM,KAAKC,IAAIH,GAAKF,KACQ,IAAtBI,KAAKC,IAAIF,GAAKF,MACbD,GAAKE,IAAM,IAAMN,KACjBK,GAAKE,IAAM,IAAMN,GAElB,OAAO,CAEX,CACA,OAAO,CACT,CAOA,WAAAS,CAAYC,EAAWC,GACrB,QAAInE,KAAKoE,qBAAqBF,EAAGC,MAC7BnE,KAAKqE,kBAAkBH,EAAGC,EAEhC,CAEA,MAAA/B,GACE,MAAO,CACLxC,GAAII,KAAKJ,GACToC,IAAKhC,KAAKgC,IACVqB,MAAOrD,KAAKqD,MAEhB,CAEA,eAAOhB,CAASC,MACd,MAAMgC,KAAO,IAAIlB,KAAKd,KAAK1C,GAAI0C,KAAKN,IAAI,GAAIM,KAAKe,OACjD,IAAA,IAASkB,EAAI,EAAGA,EAAIjC,KAAKN,IAAI0B,OAAQa,IACnCD,KAAKL,YAAY3B,KAAKN,IAAIuC,GAAG,GAAIjC,KAAKN,IAAIuC,GAAG,IAE/C,OAAOD,IACT,CAMQ,iBAAAD,CAAkBH,EAAWC,GACnC,MAAMK,GAAKxE,KAAKgC,IAAI0B,OACpB,GAAIc,GAAK,EAAG,CACV,GAAIL,IAAMnE,KAAKgC,IAAIwC,GAAK,GAAG,IAA4C,IAAtCT,KAAKC,IAAIE,EAAIlE,KAAKgC,IAAIwC,GAAK,GAAG,IAG7D,OAFAxE,KAAKgC,IAAIyC,MACTzE,KAAKgC,IAAI0C,KAAK,CAACR,EAAGC,KACX,EAET,GAAID,IAAMlE,KAAKgC,IAAIwC,GAAK,GAAG,IAA4C,IAAtCT,KAAKC,IAAIG,EAAInE,KAAKgC,IAAIwC,GAAK,GAAG,IAG7D,OAFAxE,KAAKgC,IAAIyC,MACTzE,KAAKgC,IAAI0C,KAAK,CAACR,EAAGC,KACX,CAEX,CACA,MAAMQ,KAAO3E,KAAKgC,IAAIwC,GAAK,GAC3B,OAAIT,KAAKC,IAAIW,KAAK,GAAKT,GAAK,IACxBH,KAAKC,IAAIW,KAAK,GAAKR,GAAK,IAE5BnE,KAAKgC,IAAI0C,KAAK,CAACR,EAAGC,KACX,GACT,CAGQ,oBAAAC,CAAqBF,EAAWC,GACtC,MAAMK,GAAKxE,KAAKgC,IAAI0B,OACpB,QAAIc,GAAK,KACLN,IAAMlE,KAAKgC,IAAIwC,GAAK,GAAG,IAAML,IAAMnE,KAAKgC,IAAIwC,GAAK,GAAG,KACtDxE,KAAKgC,IAAIyC,OACF,GAGX,yDC7FK,IAAMG,QAAN,cAAsBC,aAC3BC,KAAc,GACdC,UAAwB,GACxBC,MAAgB,GAEhB,OAAAC,CAAQH,KAAaC,UAAuBC,OAC1ChF,KAAK8E,KAAOA,KACZ9E,KAAK+E,UAAYA,UACjB/E,KAAKgF,MAAQA,KACf,CAEA,UAAAE,CAAWhB,EAAWC,GACpB,IAAA,MAAWgB,OAAOnF,KAAK8E,KACrB,GAAIK,IAAInD,IAAI,KAAOkC,GAAKiB,IAAInD,IAAI,KAAOmC,EACrC,OAAOgB,IAEX,IAAA,MAAWC,QAAQpF,KAAK+E,UACtB,GAAIK,KAAKpD,IAAI,KAAOkC,GAAKkB,KAAKpD,IAAI,KAAOmC,EACvC,OAAOiB,IAEb,CAEA,eAAAC,CAAgBnB,EAAWC,EAAWmB,QACpC,MAAMN,MAAQ,GACd,IAAA,MAAWV,QAAQtE,KAAKgF,MAClBV,KAAKtC,IAAIuD,KAAK,EAAEC,GAAIC,MAAQD,KAAOtB,GAAKuB,KAAOtB,KAAOmB,SAAShB,OAAS,IAC1EU,MAAMN,KAAKJ,MAGf,OAAOU,KACT,CAEA,WAAAU,CAAY9F,IACV,OAAOI,KAAKgF,MAAMW,KAAMC,GAAMA,EAAEhG,KAAOA,GACzC,CAEA,qBAAAiG,CAAsBvB,KAAYJ,EAAWC,GAC3C,MAAMQ,KAAOL,KAAKtC,IAAIsC,KAAKtC,IAAI0B,OAAS,GAClCH,IAAMW,EAAIS,KAAK,IAAM,EACrBnB,IAAMW,EAAIQ,KAAK,IAAM,EAC3B,IAAA,MAAWmB,SAAS9F,KAAKgF,MACvB,GAAIc,MAAMzC,QAAUiB,KAAKjB,OACrByC,MAAMxC,qBAAqBC,GAAIC,IAAK,OAAO,EAEjD,OAAO,CACT,CAEA,MAAAuC,CAAOnG,GAAYsE,EAAWC,GAC5B,OAAInE,KAAKkF,WAAWhB,EAAGC,KACvBnE,KAAK8E,KAAKJ,KAAK,IAAI3C,IAAInC,GAAI,CAACsE,EAAGC,KAC/BnE,KAAKW,SAAS,mBAAe,GAAW,IACjC,EACT,CAEA,WAAAqF,CAAYpG,GAAYsE,EAAWC,EAAWjC,OAC5C,OAAIlC,KAAKkF,WAAWhB,EAAGC,KACvBnE,KAAK+E,UAAUL,KAAK,IAAIvB,SAASvD,GAAI,CAACsE,EAAGC,GAAIjC,QAC7ClC,KAAKW,SAAS,mBAAe,GAAW,IACjC,EACT,CAEA,OAAOuD,EAAWC,GAChB,MAAM8B,OAASjG,KAAK8E,KAAKoB,UAAWC,GAAMA,EAAEnE,IAAI,KAAOkC,GAAKiC,EAAEnE,IAAI,KAAOmC,IAC1D,IAAX8B,QACFjG,KAAK8E,KAAKsB,OAAOH,OAAQ,GAE3B,MAAMI,QAAUrG,KAAK+E,UAAUmB,UAC5BI,GAAMA,EAAEtE,IAAI,KAAOkC,GAAKoC,EAAEtE,IAAI,KAAOmC,IAExB,IAAZkC,SACFrG,KAAK+E,UAAUqB,OAAOC,QAAS,GAEjC,MAAME,QAAUvG,KAAKgF,MAAMkB,UAAWN,GACpCA,EAAE5D,IAAIuD,KAAK,EAAEC,GAAIC,MAAQD,KAAOtB,GAAKuB,KAAOtB,KAE9B,IAAZoC,SACFvG,KAAKgF,MAAMoB,OAAOG,QAAS,GAE7BvG,KAAKW,SAAS,mBAAe,GAAW,EAC1C,CAEA,kBAAA6F,CAAmB5G,IACjB,MAAM0E,KAAOtE,KAAK0F,YAAY9F,IAC9B,GAAI0E,KAAM,CACR,MAAMmC,MAAQnC,KAAKtC,IAAI,GACjB2C,KAAOL,KAAKtC,IAAIsC,KAAKtC,IAAI0B,OAAS,GAClCgD,GAAK1G,KAAKkF,WAAWuB,MAAM,GAAIA,MAAM,IACrCE,GAAK3G,KAAKkF,WAAWP,KAAK,GAAIA,KAAK,IACzC,IAAK+B,KAAOC,IAAOF,MAAM,KAAO9B,KAAK,IAAM8B,MAAM,KAAO9B,KAAK,GAAK,CAChE,MAAMiC,IAAM5G,KAAKgF,MAAMkB,UAAWN,GAAMA,EAAEhG,KAAOA,IAEjD,OADY,IAARgH,KAAY5G,KAAKgF,MAAMoB,OAAOQ,IAAK,IAChC,CACT,CACA,OAAO,CACT,CACA,OAAO,CACT,CAEA,cAAAC,CAAejH,GAAYsE,EAAWC,EAAWd,OAC/C,MAAMyD,MAAQ9G,KAAKkF,WAAWhB,EAAGC,GAC3B4C,aAAe/G,KAAKqF,gBAAgBnB,EAAGC,EAAIG,OAAyB,IAAfA,MAAKjB,OAC1D2D,sBAAwBhH,KAAKqF,gBAAgBnB,EAAGC,EAAIG,YAASA,MAAKjB,OAClE4D,gBAAkBH,MAASA,iBAAiB3D,SAAW,EAAI,EAAK,EAEtE,IAAI+D,OAAQ,EACRC,SAAU,EAEd,GAAIL,OAAUC,aAAarD,OAASsD,sBAAsBtD,QAAWuD,gBACnE,MAAO,CAAEC,YAAOC,iBAGlB,MAAM7C,KAAOtE,KAAK0F,YAAY9F,IAE9B,GAAI0E,KAAM,CAER,IAAKtE,KAAK6F,sBAAsBvB,KAAMJ,EAAGC,GACvC,MAAO,CAAE+C,YAAOC,iBAGlB,MAAMC,gBAAkBpH,KAAKqF,gBAAgBnB,EAAGC,EAAIG,OAAUA,MAAK1E,KAAOA,IAAqB,IAAf0E,MAAKjB,SAAgB,IAAM,KAM3G,GAJKyD,OAAYC,aAAarD,SAAU0D,kBAA8B,IAAV/D,QAC1D6D,MAAQ5C,KAAKL,YAAYC,EAAGC,IAG1B2C,MAAO,CACT,GAAoB,UAAhBA,MAAM5E,OAAqB4E,MAAM5E,QAAUoC,KAAKpC,MAClD,MAAO,CAAEgF,OAAO,EAAOC,SAAS,GAElCD,MAAQ5C,KAAKL,YAAYC,EAAGC,GAC5BgD,QAAUD,KACZ,CAEF,KAAO,CAEL,IAAKJ,MAAO,MAAO,CAAEI,OAAO,EAAOC,SAAS,GAC5C,MAAME,QAAU,IAAIjE,KAAKxD,GAAI,CAACsE,EAAGC,GAAId,OACrCgE,QAAQnF,MAAQ4E,MAAM5E,MACtBlC,KAAKgF,MAAMN,KAAK2C,SAChBH,OAAQ,CAEV,CAGA,OADAlH,KAAKW,SAAS,mBAAe,GAAW,GACjC,CAAEuG,YAAOC,gBAClB,GAjJWvC,sOAANtD,CAAA,CADNM,UACYgD,kaCUN,IAAM0C,KAAN,cAAmBzC,aACxB0C,MAAQ,EACRC,OAAS,EACT1C,KAAc,GACdC,UAAwB,GACxBC,MAAgB,GAEhByC,SAAqB,OACrBC,UAA2B,QAC3BC,UAAY,EAEZC,UAAsB,GACtBC,UAAsB,GAWtB,KAAAC,GACE9H,KAAKuH,MAAQ,EACbvH,KAAKwH,OAAS,EACdxH,KAAK8E,KAAO,GACZ9E,KAAK+E,UAAY,GACjB/E,KAAKgF,MAAQ,GACbhF,KAAK+H,QAAQ9C,QAAQjF,KAAK8E,KAAM9E,KAAK+E,UAAW/E,KAAKgF,OACrDhF,KAAKyH,SAAW,OAChBzH,KAAK0H,UAAY,QACjB1H,KAAK2H,UAAY,EACjB3H,KAAK6H,UAAY,GACjB7H,KAAK4H,UAAY,EACnB,CAEA,gBAAMI,GACJhI,KAAK8H,QACL9H,KAAKiI,YAAcC,QAAE,CAACC,IAAK,GAAGnI,KAAKoI,2BAA4B1G,MAAO,CAAA,EAAI2G,QAAS,UAE/ErI,KAAKoI,eAC4C,IAA/CE,OAAOC,KAAKvI,KAAKiI,YAAYvG,OAAOgC,aAChC1D,KAAKwI,KAAKxI,KAAKoI,eAErBpI,KAAK8H,QACL9H,KAAKqC,SAASoG,KAAKC,UAAU1I,KAAKiI,YAAYvG,QAC9C1B,KAAK2I,oBAIT3I,KAAK4H,UAAY,CAAC5H,KAAKoC,UACvBpC,KAAK6H,UAAY,GACjB7H,KAAKW,SAAS,mBAAe,GAAW,EAC1C,CAEA,mBAAAiI,GACO5I,KAAKgI,aAAaa,KAAK,KAC1B7I,KAAKW,SAAS,uBAAmB,GAAW,IAEhD,CAEA,MAAAmI,GACE9I,KAAKiI,YAAYvG,MAAQ,CAAA,EACpB1B,KAAKgI,YACZ,CAEA,UAAMQ,CAAK5H,OACT,IACE,MAAMmI,WAAajI,MAAM,mBAAqBF,MAAQ,SACjDmI,KAAKC,IAAIC,QAAQC,MAAM,mBAC5B,MAAMC,WAAaJ,KAAKI,OACxBnJ,KAAK8H,QACL9H,KAAKqC,SAAS8G,MACdnJ,KAAK2I,kBACL3I,KAAKoJ,MACP,OAASC,GACPJ,QAAQK,KAAK,wBAAyB1I,MAAOyI,EAC/C,CACF,CAEA,IAAAD,GACEpJ,KAAKiI,YAAYvG,MAAQ,CACvB6F,MAAOvH,KAAKuH,MACZC,OAAQxH,KAAKwH,OACb1C,KAAM9E,KAAK8E,KAAKxE,IAAK6F,GAAMA,EAAE/D,UAC7B2C,UAAW/E,KAAK+E,UAAUzE,IAAKgG,GAAMA,EAAElE,UACvC4C,MAAOhF,KAAKgF,MAAM1E,IAAKsF,GAAMA,EAAExD,UAEnC,CAEA,QAAAC,CAASkH,UACP,MAAMC,MAAmBf,KAAKgB,MAAMF,UACpCvJ,KAAKuH,MAAQiC,MAAMjC,MACnBvH,KAAKwH,OAASgC,MAAMhC,OACpBxH,KAAK8E,KAAO0E,MAAM1E,KAAKxE,IAAK6F,GAAMpE,IAAIM,SAAS8D,IAC/CnG,KAAK+E,UAAYyE,MAAMzE,UAAUzE,IAAKgG,GAAMnD,SAASd,SAASiE,IAC9DtG,KAAKgF,MAAQwE,MAAMxE,MAAM1E,IAAKsF,GAAMxC,KAAKf,SAASuD,IAClD5F,KAAK+H,QAAQ9C,QAAQjF,KAAK8E,KAAM9E,KAAK+E,UAAW/E,KAAKgF,MACvD,CAEA,MAAA5C,GACE,OAAOqG,KAAKC,UAAU,CACpBnB,MAAOvH,KAAKuH,MACZC,OAAQxH,KAAKwH,OACb1C,KAAM9E,KAAK8E,KAAKxE,IAAK6F,GAAMA,EAAE/D,UAC7B2C,UAAW/E,KAAK+E,UAAUzE,IAAKgG,GAAMA,EAAElE,UACvC4C,MAAOhF,KAAKgF,MAAM1E,IAAKsF,GAAMA,EAAExD,WAEnC,CAEA,eAAAsH,GACE,MAAMF,MAAQxJ,KAAKoC,SACfoH,QAAUxJ,KAAK4H,UAAU5H,KAAK4H,UAAUlE,OAAS,IACnD1D,KAAK4H,UAAUlD,KAAK8E,MAExB,CAEA,IAAAG,GACE,GAAI3J,KAAK4H,UAAUlE,QAAU,EAAG,CAC9B,MAAMkG,aAAe5J,KAAK4H,UAAUnD,MACpCzE,KAAKqC,SAASrC,KAAK4H,UAAU5H,KAAK4H,UAAUlE,OAAS,IACrD1D,KAAK6H,UAAUnD,KAAKkF,cACpB5J,KAAK2I,kBACL3I,KAAKoJ,OACLpJ,KAAKW,SAAS,mBAAe,GAAW,EAC1C,CACF,CAEA,IAAAkJ,GACE,GAAI7J,KAAK6H,UAAUnE,OAAS,EAAG,CAC7B,MAAM8F,MAAQxJ,KAAK6H,UAAUpD,MAC7BzE,KAAKqC,SAASmH,OACdxJ,KAAK4H,UAAUlD,KAAK8E,OACpBxJ,KAAK2I,kBACL3I,KAAKoJ,OACLpJ,KAAKW,SAAS,mBAAe,GAAW,EAC1C,CACF,CAEA,WAAAmJ,GACE,IAAA,MAAWxF,QAAQtE,KAAKgF,MAAOV,KAAKrC,OAAS,QAC7C,IAAA,MAAWkD,OAAOnF,KAAK8E,KAAMK,IAAIlD,OAAS,OAC5C,CAEA,eAAA0G,GACE3I,KAAK8J,cAEL,IAAA,IAASC,KAAO,EAAGA,KAAO,GAAIA,OAC5B,IAAA,MAAWzF,QAAQtE,KAAKgF,MAAO,CAC7B,MAAMyB,MAAQnC,KAAKtC,IAAI,GACjB2C,KAAOL,KAAKtC,IAAIsC,KAAKtC,IAAI0B,OAAS,GAElCgD,GAAK1G,KAAK+H,QAAQ7C,WAAWuB,MAAM,GAAIA,MAAM,IAC7CE,GAAK3G,KAAK+H,QAAQ7C,WAAWP,KAAK,GAAIA,KAAK,IACjD,IAAK+B,KAAOC,GAAI,SAEhB,MAAMqD,GAAKtD,GAAGxE,MACR+H,GAAKtD,GAAGzE,MAEH,UAAP8H,IAAyB,UAAPC,GAChBD,KAAOC,KAAI3F,KAAKrC,OAAS+H,IACb,UAAPA,IAAyB,UAAPC,GAC3B3F,KAAKrC,OAAS,QAEH,UAAP+H,IACF1F,KAAKrC,OAAS+H,GACVrD,cAAc5E,MAAK4E,GAAGzE,MAAQ8H,KAClB,UAAPC,KACT3F,KAAKrC,OAASgI,GACVvD,cAAc3E,MAAK2E,GAAGxE,MAAQ+H,IAGxC,CAGFjK,KAAKW,SAAS,mBAAe,GAAW,GAExC,IAAIK,WAAY,EAIhB,IAAA,MAAWoE,QAAQpF,KAAK+E,UAAW,CAEnB,IADA/E,KAAK+H,QAAQ1C,gBAAgBD,KAAKpD,IAAI,GAAIoD,KAAKpD,IAAI,IAAI0B,SACpD1C,WAAY,EAC/B,CAEA,IAAA,MAAWmE,OAAOnF,KAAK8E,KAAM,CAEb,IADA9E,KAAK+H,QAAQ1C,gBAAgBF,IAAInD,IAAI,GAAImD,IAAInD,IAAI,IAAI0B,QACjC,UAAfyB,IAAIlD,SAAoBjB,WAAY,EACzD,CAEAhB,KAAKW,SAAS,gBAAiB,CAAEC,MAAOZ,KAAKoI,aAAcpH,sBAAa,EAC1E,CAEA,YAAAkJ,CAAaC,QACPnK,KAAK+H,QAAQvB,mBAAmB2D,UAClCnK,KAAK0J,kBACL1J,KAAK2I,kBACL3I,KAAKoJ,QAEPpJ,KAAKW,SAAS,mBAAe,GAAW,EAC1C,GA3LQW,kBAAA,CADPC,iBAAiB,CAACG,MAAO,GAAIF,KAAM4I,UAdzB9C,KAeH3F,UAAA,eAAA,GAGAL,kBAAA,CADPC,iBAAiB,CAACC,KAAMoD,QAASyF,KAAM,QAjB7B/C,KAkBH3F,UAAA,UAAA,GAGAL,kBAAA,CADPgJ,SAASpC,QAAE,CAACC,IAAK,mBAAoBzG,MAAO,CAAA,EAAI2G,QAAS,YApB/Cf,KAqBH3F,UAAA,cAAA,GArBG2F,KAANhG,kBAAA,CADNM,UACY0F,2RCKN,MAAMiD,MACXC,OAAsC,CAAA,EACtCC,YAAc,EACdC,aAAe,EACfC,UAAY,EACZC,WAAa,EACbC,SAAW,EACXC,YAAc,EACdC,YAAc,EACdC,aAAe,EAGf,IAAAX,CAAKY,UACHjL,KAAKwK,OAAS,CAAA,EACd,IAAA,MAAWU,QAAQD,SAAU,CAC3B,MAAME,QAASF,SAASC,MAClBE,IAAMD,QAAOE,WAAW,MAC9BrL,KAAKwK,OAAOU,MAAQ,CAAEC,OAAAA,QAAQC,QAChC,CACF,CAGA,QAAAE,CACEC,UACAC,WACAC,eACAC,iBAEA1L,KAAKyK,YAAcgB,eACnBzL,KAAK0K,aAAegB,gBACpB,MAAMC,IAAMC,OAAOC,kBAAoB,EAEvC,IAAA,MAAWX,QAAQlL,KAAKwK,OAAQ,CAC9B,MAAQW,OAAAA,SAAWnL,KAAKwK,OAAOU,MAC/BC,QAAO5D,MAAQvH,KAAKyK,YAAckB,IAClCR,QAAO3D,OAASxH,KAAK0K,aAAeiB,IACpCR,QAAOW,MAAMvE,MAAQvH,KAAKyK,YAAc,KACxCU,QAAOW,MAAMtE,OAASxH,KAAK0K,aAAe,KAC1C1K,KAAKwK,OAAOU,MAAME,IAAIW,aAAaJ,IAAK,EAAG,EAAGA,IAAK,EAAG,EACxD,CAEA3L,KAAK2K,UAAYY,UACjBvL,KAAK4K,WAAaY,WAIhBxL,KAAK0K,aAAe1K,KAAK4K,WACzB5K,KAAKyK,YAAczK,KAAK2K,UAExB3K,KAAK6K,SAAW7K,KAAKyK,aAAezK,KAAK2K,UAAY,GAErD3K,KAAK6K,SAAW7K,KAAK0K,cAAgB1K,KAAK4K,WAAa,GAGzD5K,KAAK8K,aAAe9K,KAAKyK,YAAczK,KAAK6K,SAAW7K,KAAK2K,WAAa,EACzE3K,KAAK+K,aACF/K,KAAK0K,aAAe1K,KAAK6K,SAAW7K,KAAK4K,YAAc,EAG1D,MAAMQ,IAAMpL,KAAKwK,OAAOwB,KAAKZ,IAC7BA,IAAIa,UAAU,EAAG,EAAGjM,KAAKyK,YAAazK,KAAK0K,cAE3CU,IAAIc,UAAY,wBAChBd,IAAIe,SACFnM,KAAK8K,YACL9K,KAAK+K,YACL/K,KAAK2K,UAAY3K,KAAK6K,SACtB7K,KAAK4K,WAAa5K,KAAK6K,UAGzBO,IAAIgB,YAAc,wBAClBhB,IAAIiB,UAAY,EAEhB,IAAA,IAAS5I,EAAI,EAAGA,GAAK8H,UAAW9H,IAAK,CACnC,MAAMS,EAAIT,EAAIzD,KAAK6K,SAAW7K,KAAK8K,YACnCM,IAAIkB,YACJlB,IAAImB,OAAOrI,EAAGlE,KAAK+K,aACnBK,IAAIoB,OAAOtI,EAAGlE,KAAK4K,WAAa5K,KAAK6K,SAAW7K,KAAK+K,aACrDK,IAAIqB,QACN,CAEA,IAAA,IAASlI,EAAI,EAAGA,GAAKiH,WAAYjH,IAAK,CACpC,MAAMJ,EAAII,EAAIvE,KAAK6K,SAAW7K,KAAK+K,YACnCK,IAAIkB,YACJlB,IAAImB,OAAOvM,KAAK8K,YAAa3G,GAC7BiH,IAAIoB,OAAOxM,KAAK2K,UAAY3K,KAAK6K,SAAW7K,KAAK8K,YAAa3G,GAC9DiH,IAAIqB,QACN,CAEAzM,KAAKgL,aAAkC,GAAnBhL,KAAKyK,WAC3B,CAKA,MAAAtJ,CAAO2D,KAAaC,UAAuBC,OACzC,MAAM0H,KAAO1M,KAAKwK,OAAOmC,QAAQvB,IAC3BwB,KAAO5M,KAAKwK,OAAOqC,QAAQzB,IACjC,GAAKsB,MAASE,KAAd,CAEAF,KAAKT,UAAU,EAAG,EAAGjM,KAAKyK,YAAazK,KAAK0K,cAC5CkC,KAAKX,UAAU,EAAG,EAAGjM,KAAKyK,YAAazK,KAAK0K,cAE5C,IAAA,MAAWpG,QAAQU,MAAOhF,KAAK8M,gBAAgBxI,MAC/C,IAAA,MAAWa,OAAOL,KAAM9E,KAAK+M,eAAe5H,KAC5C,IAAA,MAAWC,QAAQL,UAAW/E,KAAKgN,oBAAoB5H,MAEvD,IAAA,MAAWd,QAAQU,MACjBhF,KAAKiN,cAAc3I,KAAMA,KAAKrC,QAEhC,IAAA,MAAWkD,OAAOL,KAChB9E,KAAKkN,aAAa/H,IAAKA,IAAIlD,QAC7B,IAAA,MAAWmD,QAAQL,UACjB/E,KAAKmN,kBAAkB/H,KAAMA,KAAKlD,MAfhB,CAgBtB,CAIAkL,sBACE,CACE,EAAC,GAAK,SACN,EAAG,UAGC,WAAAC,CAAY/I,MAClB,MAAMgJ,UAA0B,IAAfhJ,KAAKjB,MAChBkK,UAAYhD,MAAMiD,eAAelJ,KAAKjB,QAAU,SAChD+H,IAAMpL,KAAKwK,OAAO+C,YAAYnC,KAAOpL,KAAKwK,OAAOqC,OAAOzB,IAC9D,IAAIqC,OAASzN,KAAK6K,SAAW,EACzB6C,QAAU,EACVC,YAAc,gBACdC,QAAU,EASd,OAPIN,WACFG,QAAU,IACVC,SAAW,EACXC,YAAc,yBACdC,QAAU,KAGL,CACLxC,QACAqC,cACAC,gBACAC,wBACAC,gBAEJ,CAEQ,cAAAC,CACNzC,IACA0C,WAEA1C,IAAIkB,YACJ,IAAA,IAAS7I,EAAI,EAAGA,EAAIqK,UAAUpK,OAAQD,IAAK,CACzC,MAAMS,EAAI4J,UAAUrK,GAAG,GAAKzD,KAAK6K,SAAW7K,KAAK8K,YAC3C3G,EAAI2J,UAAUrK,GAAG,GAAKzD,KAAK6K,SAAW7K,KAAK+K,YACvC,IAANtH,EAAS2H,IAAImB,OAAOrI,EAAGC,GACtBiH,IAAIoB,OAAOtI,EAAGC,EACrB,CACF,CAEQ,eAAA2I,CAAgBxI,MACtB,GAAIA,KAAKtC,IAAI0B,OAAS,EAAG,OACzB,MAAMyC,EAAInG,KAAKqN,YAAY/I,MAC3B6B,EAAEiF,IAAIhC,OACNjD,EAAEiF,IAAI2C,YAAc5H,EAAEyH,QACtBzH,EAAEiF,IAAI4C,QAAU,QAChB7H,EAAEiF,IAAI6C,SAAW,QACjBjO,KAAK6N,eAAe1H,EAAEiF,IAAK9G,KAAKtC,KAChCmE,EAAEiF,IAAIgB,YAAcjG,EAAEwH,YACtBxH,EAAEiF,IAAIiB,UAAYlG,EAAEsH,OAAqB,EAAZtH,EAAEuH,QAC/BvH,EAAEiF,IAAIqB,SACNtG,EAAEiF,IAAI8C,SACR,CAEQ,aAAAjB,CAAc3I,KAAYpC,OAChC,GAAIoC,KAAKtC,IAAI0B,OAAS,EAAG,OACzB,MAAMyC,EAAInG,KAAKqN,YAAY/I,MAC3B6B,EAAEiF,IAAIhC,OACNjD,EAAEiF,IAAI2C,YAAc5H,EAAEyH,QACtBzH,EAAEiF,IAAI4C,QAAU,QAChB7H,EAAEiF,IAAI6C,SAAW,QACjBjO,KAAK6N,eAAe1H,EAAEiF,IAAK9G,KAAKtC,KAChCmE,EAAEiF,IAAIgB,YAAc+B,gBAAOjM,QAAU,OACrCiE,EAAEiF,IAAIiB,UAAYlG,EAAEsH,OACpBtH,EAAEiF,IAAIqB,SACNtG,EAAEiF,IAAI8C,SACR,CAIQ,cAAAnB,CAAe5H,KACrB,MAAMiG,IAAMpL,KAAKwK,OAAOqC,OAAOzB,IACzBgD,GAAKjJ,IAAInD,IAAI,GAAKhC,KAAK6K,SAAW7K,KAAK8K,YACvCuD,GAAKlJ,IAAInD,IAAI,GAAKhC,KAAK6K,SAAW7K,KAAK+K,YACvCuD,EAAItO,KAAK6K,SAAW,EAE1BO,IAAIkB,YACJlB,IAAImD,IAAIH,GAAIC,GAAIC,EAFL,EAEa,EAAa,EAAVvK,KAAKyK,IAChCpD,IAAIc,UAAY,gBAChBd,IAAIqD,MACN,CAEQ,YAAAvB,CAAa/H,IAAUjD,OAC7B,MAAMkJ,IAAMpL,KAAKwK,OAAOqC,OAAOzB,IACzBgD,GAAKjJ,IAAInD,IAAI,GAAKhC,KAAK6K,SAAW7K,KAAK8K,YACvCuD,GAAKlJ,IAAInD,IAAI,GAAKhC,KAAK6K,SAAW7K,KAAK+K,YACvCuD,EAAItO,KAAK6K,SAAW,EAC1BO,IAAIkB,YACJlB,IAAImD,IAAIH,GAAIC,GAAIC,EAAG,EAAa,EAAVvK,KAAKyK,IAC3BpD,IAAIc,UAAYiC,gBAAOjM,QAAU,OACjCkJ,IAAIqD,MACN,CAIQ,mBAAAzB,CAAoB0B,UAC1B,MAAMtD,IAAMpL,KAAKwK,OAAOqC,OAAOzB,IACzBgD,GAAKM,SAAS1M,IAAI,GAAKhC,KAAK6K,SAAW7K,KAAK8K,YAC5CuD,GAAKK,SAAS1M,IAAI,GAAKhC,KAAK6K,SAAW7K,KAAK+K,YAC5CuD,EAAItO,KAAK6K,SAAW,EAE1BO,IAAIc,UAAY,gBAChBd,IAAIe,SAASiC,GAAKE,EAFP,EAEeD,GAAKC,EAFpB,EAEuC,GAAVA,EAF7B,GAEqD,GAAVA,EAF3C,GAGb,CAEQ,iBAAAnB,CAAkBuB,SAAoBxM,OAC5C,MAAMkJ,IAAMpL,KAAKwK,OAAOqC,OAAOzB,IACzBgD,GAAKM,SAAS1M,IAAI,GAAKhC,KAAK6K,SAAW7K,KAAK8K,YAC5CuD,GAAKK,SAAS1M,IAAI,GAAKhC,KAAK6K,SAAW7K,KAAK+K,YAC5CuD,EAAItO,KAAK6K,SAAW,EAC1BO,IAAIc,UAAYiC,gBAAOjM,QAAU,OACjCkJ,IAAIe,SAASiC,GAAKE,EAAGD,GAAKC,EAAO,EAAJA,EAAW,EAAJA,EACtC,CAIA,UAAAK,CAAWC,OAAgBC,QACzB,MAAMzD,IAAMpL,KAAKwK,OAAOsE,KAAK1D,IAC7B,IAAKA,IAAK,OACVA,IAAIa,UAAU,EAAG,EAAGjM,KAAKyK,YAAazK,KAAK0K,cAC3C,MAAM0D,GAAKQ,OAAS5O,KAAK6K,SAAW7K,KAAK8K,YACnCuD,GAAKQ,OAAS7O,KAAK6K,SAAW7K,KAAK+K,YACzCK,IAAIkB,YACJlB,IAAImD,IAAIH,GAAIC,GAAIrO,KAAKgL,aAAc,EAAa,EAAVjH,KAAKyK,IAC3CpD,IAAIc,UAAY,yBAChBd,IAAIqD,MACN,CAEA,UAAAM,GACE,MAAM3D,IAAMpL,KAAKwK,OAAOsE,KAAK1D,IACxBA,KACLA,IAAIa,UAAU,EAAG,EAAGjM,KAAKyK,YAAazK,KAAK0K,aAC7C,EAYK,MAAMsE,sBAAsBxP,UACjC,gBAAWC,GACT,MAAiB,sWAiBnB,CAEA,oBAAWwP,GACT,MAAO,CACLC,YAAa,gBACb,kBAAmB,kBACnB,cAAe,eAEnB,CASQC,QAAU,EACVC,QAAU,EACVC,OAAS,EACTC,OAAS,EACTC,UAAY,EACZC,UAAY,EACZC,OAAQ,EACRC,UAAY,EAEpB,WAAAvN,CAAYwN,KAA2B,IACrCC,MAAMD,KACR,CAEA,KAAA5P,GACEC,KAAKE,SACP,CAEA,OAAAA,GACEF,KAAKmB,OAAO,CACVgK,OAAO,CAAEvL,GAAI,OAAQkM,MAAO,CAAE+D,OAAQ,SACtC1E,OAAO,CAAEvL,GAAI,SAAUkM,MAAO,CAAE+D,OAAQ,SACxC1E,OAAO,CAAEvL,GAAI,SAAUkM,MAAO,CAAE+D,OAAQ,SACxC1E,OAAO,CAAEvL,GAAI,MAAOkM,MAAO,CAAE+D,OAAQ,WAEvC7P,KAAK8P,YACP,CAEA,SAAAC,GACE/P,KAAK8P,YACP,CAEQ,UAAAA,GACN,MAAM9D,KAAOhM,KAAKgQ,cAAc,SAC1BrD,OAAS3M,KAAKgQ,cAAc,WAC5BnD,OAAS7M,KAAKgQ,cAAc,WAC5BlB,IAAM9O,KAAKgQ,cAAc,QAC/B,KAAKhE,MAASW,QAAWE,QAAWiC,KAAK,OAEzC9O,KAAKiQ,MAAM5F,KAAK,CAAE2B,UAAMW,cAAQE,cAAQiC,UAExC,MAAMoB,KAAOlQ,KAAKmQ,wBACC,IAAfD,KAAK3I,OAA+B,IAAhB2I,KAAK1I,QAEzBxH,KAAKoQ,OACPpQ,KAAKiQ,MAAM3E,SACTtL,KAAKoQ,KAAK7I,MACVvH,KAAKoQ,KAAK5I,OACV0I,KAAK3I,MACL2I,KAAK1I,QAEPxH,KAAKiQ,MAAM9O,OACTnB,KAAKoQ,KAAKtL,KACV9E,KAAKoQ,KAAKrL,UACV/E,KAAKoQ,KAAKpL,OAGhB,CAEA,WAAAqL,GACErQ,KAAK8P,YACP,CAEA,eAAAQ,GACE,MAAMJ,KAAOlQ,KAAKmQ,wBACC,IAAfD,KAAK3I,OAA+B,IAAhB2I,KAAK1I,SAC7BxH,KAAKiQ,MAAM3E,SACTtL,KAAKoQ,KAAK7I,MACVvH,KAAKoQ,KAAK5I,OACV0I,KAAK3I,MACL2I,KAAK1I,QAEPxH,KAAKiQ,MAAM9O,OACTnB,KAAKoQ,KAAKtL,KACV9E,KAAKoQ,KAAKrL,UACV/E,KAAKoQ,KAAKpL,OAEd,CACA,YAAAuL,GACEvQ,KAAKiQ,MAAM9O,OACTnB,KAAKoQ,KAAKtL,KACV9E,KAAKoQ,KAAKrL,UACV/E,KAAKoQ,KAAKpL,MAEd,CAEA,aAAAwL,CAAcC,OACZA,MAAMC,iBACN1Q,KAAK2Q,kBAAkBF,MAAMG,WAC7B5Q,KAAK6Q,iBAAiB,cAAe7Q,KAAK8Q,eAC1C9Q,KAAK6Q,iBAAiB,YAAa7Q,KAAK+Q,aAExC/Q,KAAK0P,UAAY3L,KAAKiN,MAAsB,IAAhBjN,KAAKkN,UACjCjR,KAAKyP,OAAQ,EACbzP,KAAKkR,cAAcT,OACnBzQ,KAAKiQ,MAAMtB,WAAW3O,KAAKmP,QAASnP,KAAKoP,SAEpCpP,KAAKoQ,OAEiB,QAAvBpQ,KAAKoQ,KAAK3I,UACZzH,KAAKoQ,KAAKrI,QAAQhC,OAAO/F,KAAK0P,UAAW1P,KAAKqP,OAAQrP,KAAKsP,QAElC,aAAvBtP,KAAKoQ,KAAK3I,UACZzH,KAAKoQ,KAAKrI,QAAQ/B,YAChBhG,KAAK0P,UACL1P,KAAKqP,OACLrP,KAAKsP,OACLtP,KAAKoQ,KAAK1I,WAGa,SAAvB1H,KAAKoQ,KAAK3I,UACZzH,KAAKoQ,KAAKrI,QAAQlB,eAChB7G,KAAK0P,UACL1P,KAAKqP,OACLrP,KAAKsP,OACLtP,KAAKoQ,KAAKzI,WAGa,WAAvB3H,KAAKoQ,KAAK3I,UACZzH,KAAKoQ,KAAKrI,QAAQoJ,OAAOnR,KAAKqP,OAAQrP,KAAKsP,QAE/C,CAEA,aAAAwB,CAAcL,OAKZ,GAJAA,MAAMC,iBACN1Q,KAAKoR,gBAAgBX,OACrBzQ,KAAKiQ,MAAMtB,WAAW3O,KAAKqP,OAAQrP,KAAKsP,QAEnCtP,KAAKoQ,MAGe,SAAvBpQ,KAAKoQ,KAAK3I,UACVzH,KAAKyP,QACJzP,KAAKqP,SAAWrP,KAAKuP,WAAavP,KAAKsP,SAAWtP,KAAKwP,WACxD,CACA,MAAMrI,QAAEA,SAAYnH,KAAKoQ,KAAKrI,QAAQlB,eACpC7G,KAAK0P,UACL1P,KAAKqP,OACLrP,KAAKsP,OACLtP,KAAKoQ,KAAKzI,WAERR,eAAcsI,OAAQ,EAC5B,CACF,CAEA,WAAAsB,CAAYN,OACVA,MAAMC,iBACN1Q,KAAKqR,sBAAsBZ,MAAMG,WACjC5Q,KAAKsR,oBAAoB,cAAetR,KAAK8Q,eAC7C9Q,KAAKsR,oBAAoB,YAAatR,KAAK+Q,aAE3C/Q,KAAKyP,OAAQ,EACbzP,KAAKiQ,MAAMlB,aAEN/O,KAAKoQ,MAEVpQ,KAAKoQ,KAAKlG,aAAalK,KAAK0P,UAC9B,CAEQ,aAAAwB,CAAcT,OACpB,MAAMP,KAAOlQ,KAAKmQ,wBAElBnQ,KAAKmP,SACFsB,MAAMc,QAAUrB,KAAKsB,KAAOxR,KAAKiQ,MAAMnF,aACxC9K,KAAKiQ,MAAMpF,SACb7K,KAAKoP,SACFqB,MAAMgB,QAAUvB,KAAKpB,IAAM9O,KAAKiQ,MAAMlF,aAAe/K,KAAKiQ,MAAMpF,SAEnE7K,KAAKqP,OAAStL,KAAK2N,MAAM1R,KAAKmP,SAC9BnP,KAAKsP,OAASvL,KAAK2N,MAAM1R,KAAKoP,SAC9BpP,KAAKuP,UAAYvP,KAAKqP,OACtBrP,KAAKwP,UAAYxP,KAAKsP,MACxB,CAEQ,eAAA8B,CAAgBX,OACtB,MAAMP,KAAOlQ,KAAKmQ,wBAElBnQ,KAAKmP,SACFsB,MAAMc,QAAUrB,KAAKsB,KAAOxR,KAAKiQ,MAAMnF,aACxC9K,KAAKiQ,MAAMpF,SACb7K,KAAKoP,SACFqB,MAAMgB,QAAUvB,KAAKpB,IAAM9O,KAAKiQ,MAAMlF,aAAe/K,KAAKiQ,MAAMpF,SAEnE,MAAM8G,SAAW5N,KAAK6N,KACpB7N,KAAK8N,IAAI7R,KAAKmP,QAAUpL,KAAK2N,MAAM1R,KAAKmP,SAAU,GAChDpL,KAAK8N,IAAI7R,KAAKoP,QAAUrL,KAAK2N,MAAM1R,KAAKoP,SAAU,IAGjDpP,KAAKoQ,MAGRuB,SAAW,IACX3R,KAAKmP,SAAWnP,KAAKoQ,KAAK7I,MAAQ,IAClCvH,KAAKoP,SAAWpP,KAAKoQ,KAAK5I,OAAS,IACnCxH,KAAKmP,cACLnP,KAAKoP,eAELpP,KAAKuP,UAAYvP,KAAKqP,OACtBrP,KAAKwP,UAAYxP,KAAKsP,OAEtBtP,KAAKqP,OAAStL,KAAK2N,MAAM1R,KAAKmP,SAC9BnP,KAAKsP,OAASvL,KAAK2N,MAAM1R,KAAKoP,SAE1BpP,KAAKqP,OAASrP,KAAKuP,YAAWvP,KAAKqP,OAASrP,KAAKuP,UAAY,GAC7DvP,KAAKqP,OAASrP,KAAKuP,YAAWvP,KAAKqP,OAASrP,KAAKuP,UAAY,GAC7DvP,KAAKsP,OAAStP,KAAKwP,YAAWxP,KAAKsP,OAAStP,KAAKwP,UAAY,GAC7DxP,KAAKsP,OAAStP,KAAKwP,YAAWxP,KAAKsP,OAAStP,KAAKwP,UAAY,GAErE,EArNQlO,kBAAA,CADPC,iBAAiB,CAAEC,KAAM8F,QA7Bf0H,cA8BHrN,UAAA,QAGAL,kBAAA,CADPC,iBAAiB,CAAEC,KAAM+I,MAAOF,KAAM,QAhC5B2E,cAiCHrN,UAAA,SAoNVC,SAASoN,oSCphBF,MAAM8C,qBAAqBtS,UAChC,gBAAWC,GACT,MAAgB,mPAalB,CAEA,oBAAWwP,GACT,MAAO,CACL,gBAAiB,iBAErB,CAQA8C,WAAmE,KAEnE,WAAA5P,CAAYwN,MAA2BC,MAAMD,KAAM,CAEnD,KAAA5P,GACEC,KAAKE,SACP,CAEA,cAAA8R,CAAevB,OACTzQ,KAAK+R,YAAY/R,KAAK+R,WAAWtB,MAAMwB,OAAOrR,MAAO6P,MAAMwB,OAAOjR,UACxE,CAEA,OAAAd,GD4e2B,IAAUgS,KC3enClS,KAAKmB,OAAO,CACVgR,IAAI,CAACC,MAAO,gBAAiB,CAC3BC,SAAS,CAAC9R,MAAO,OAAQG,OAAQV,KAAKsS,SACtCD,SAAS,CAAC9R,MAAO,OAAQG,OAAQV,KAAKuS,SACtCF,SAAS,CAAC9R,MAAO,QAASG,OAAQV,KAAKwS,UACvCH,SAAS,CAAC9R,MAAO,OAAQG,OAAQV,KAAKyS,SACtCJ,SAAS,CAAC9R,MAAO,OAAQG,OAAQV,KAAK0S,YDqePR,KCnenB,CAACtS,GAAI,QAASwQ,KAAMpQ,KAAKoQ,MDoepCpB,cAAclN,aAAaoQ,QClelC,CAEA,YAAAS,GACE3S,KAAKoQ,KAAKhI,aAAepI,KAAKY,MAC9B,MAAMgS,MAAQ5S,KAAKgQ,cAAc,kBAC7B4C,OAAQA,MAAcvC,aAC5B,CAEA,MAAAiC,GACEtS,KAAKoQ,KAAKzG,MACZ,CAEA,MAAA8I,GACEzS,KAAKoQ,KAAKvG,MACZ,CAEA,OAAA2I,GACExS,KAAKoQ,KAAKtH,QACZ,CAEA,MAAAyJ,GACEvS,KAAKE,SACP,CAEA,MAAAwS,GACE1S,KAAKW,SAAS,sBAAkB,GAAW,EAC7C,EAtDQW,kBAAA,CADPC,iBAAiB,CAACG,MAAO,GAAIF,KAAM4I,UAvBzB0H,aAwBHnQ,UAAA,SAGAL,kBAAA,CADPC,iBAAiB,CAACC,KAAM8F,KAAM+C,KAAM,QA1B1ByH,aA2BHnQ,UAAA,QAsDVC,SAASkQ,qECrFF,IAAMe,eAAN,cAA6BrT,UAClC,gBAAWC,GACT,MAAiB,oZAkBnB,CAEA,KAAAM,GACEC,KAAKE,SACP,CAEA,OAAAA,GACEF,KAAKmB,OAAO,CACVkR,SAAS,CAAE9R,MAAO,MAAOG,OAAQ,IAAMV,KAAK8S,QAAQ,MAAO,cACxDxK,OAAOC,KAAKhG,iBAAiBjC,IAAKyS,GACnCV,SAAS,CAAE9R,MAAOwS,EAAGrS,OAAQ,IAAMV,KAAK8S,QAAQ,WAAYC,MAE9DV,SAAS,CACP9R,MAAO,aACPG,OAAQ,IAAMV,KAAKW,SAAS,gBAAiB,CAAEqS,KAAM,OAAQ3P,MAAO,IAAK,KAE3EgP,SAAS,CACP9R,MAAO,gBACPG,OAAQ,IAAMV,KAAKW,SAAS,gBAAiB,CAAEqS,KAAM,OAAQ3P,OAAO,IAAM,KAE5EgP,SAAS,CAAE9R,MAAO,SAAUG,OAAQ,IAAMV,KAAK8S,QAAQ,SAAU,UAErE,CAEQ,OAAAA,CAAQE,KAAgB9Q,OAC9BlC,KAAKW,SAAS,gBAAiB,CAAEqS,UAAM9Q,cAAS,EAClD,GA9CW2Q,6OAANvR,CAAA,CADNM,UACYiR,gBAiDN,MAAMI,eAAiBJ,eAAe/Q,4ZCzC7CoG,QAAEgL,SACF,MAAMC,OAASjL,QAAE,CAAEC,IAAK,QAASE,QAAS,OAAQ3G,MAAO,KACnD0R,WAAalL,QAAE,CACnBC,IAAK,qBACLE,QAAS,QACT3G,MAAO,OAIF,IAAM2R,YAAN,cAA0B7T,UAC/B,gBAAWC,GACT,MAAiB,mUAanB,CAKA,oBAAWwP,GACT,MAAO,CACL,eAAgB,gBAChB,gBAAiB,iBAErB,CAEA,KAAAlP,GACE,MAAMM,aAAeL,KAAKsT,mBF0CF,IAASpB,KEzCjClS,KAAKmB,OAAO,CACVoS,QAAQ,CACNC,MAAO,IAAIC,MAAM,CACfjS,KAAM,QACNkS,SAAU,CACR,CAAElS,KAAM,QAASmS,KAAM,YAAaC,KAAM,CAAC,CAAEhU,GAAI,YACjD,CAAE4B,KAAM,QAASmS,KAAM,WAAYC,KAAM,CAAC,CAAEhU,GAAI,UAChD,CAAE4B,KAAM,QAASmS,KAAM,YAAaC,KAAM,CAAC,CAAEhU,GAAI,eAGrDiU,SAAU,CACRhS,eAAe,CAAEjC,GAAI,SAAUqB,gBAAiBZ,gBF8BrB6R,KE1Bd,CAAEtS,GAAI,OAAQgB,MAAOuS,OAAQ/C,KAAMpQ,KAAKoQ,MF2BtD0B,aAAahQ,aAAaoQ,OE1BzBe,eAAe,CAAErT,GAAI,gBAI3B,MAAMkU,OAAS9T,KAAKgQ,cAAc,SAG9B8D,SACFA,OAAO/B,WAAa,CAACnR,MAAeI,YAClChB,KAAK+T,gBAAgBnT,MAAOI,WAElC,CAEQ,gBAAAsS,GACN,IACE,OAAO7K,KAAKgB,MAAM2J,WAAW1R,OAAS,KACxC,CAAA,MACE,MAAO,EACT,CACF,CAEQ,gBAAAsS,CAAiBC,KACvBb,WAAW1R,MAAQ+G,KAAKC,UAAUuL,IACpC,CAEA,eAAAF,CAAgBnT,MAAeI,WAC7B,IAAKA,UAAW,OAChB,MAAMiT,IAAMjU,KAAKsT,mBACjB,GAAIW,IAAIxT,SAASG,OAAQ,OACzBZ,KAAKgU,iBAAiB,IAAIC,IAAKrT,QAC/B,MAAMsT,SAAWlU,KAAKgQ,cAAc,WAChCkE,UAAUhT,kBACZgT,SAAShT,iBAAiBlB,KAAKsT,mBACnC,CAEA,cAAAa,CAAe1D,OACbA,MAAM2D,kBACN,MAAMpB,KAAEA,KAAA9Q,MAAMA,MAAAmB,MAAOA,OAAUoN,MAAMwB,OACrCjS,KAAKoQ,KAAK3I,SAAWuL,KACR,SAATA,WAA6B,IAAV3P,MACrBrD,KAAKoQ,KAAKzI,UAAYtE,WACH,IAAVnB,QACTlC,KAAKoQ,KAAK1I,UAAYxF,OAExBlC,KAAKE,SACP,CAEA,aAAAmU,CAAc5D,OACZA,MAAM2D,kBACN,MAAMxT,MAAEA,OAAU6P,MAAMwB,OACxBkB,OAAOzR,MAAQd,KACjB,GA9EQU,gBAAA,CADPC,iBAAiB,CAAEC,KAAM8F,KAAM+C,KAAM,QAjB3BgJ,YAkBH1R,UAAA,OAAA,GAlBG0R,YAAN/R,gBAAA,CADNM,UACYyR"}