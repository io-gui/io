<!doctype html>
<html lang="en" data-library="io">
  <head>
    <meta charset="utf-8" />
    <title>Io â€¢ Circuits</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: sans-serif;
        background-color: var(--io_bgColor);
      }
      io-split {
        height: 100%;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <script type="module">
      import { circuitsBoard, Game, COLORS } from "./dist/index.js";
      import { Storage as $, div } from "@io-gui/core";
      import { ioSplit, Split } from "@io-gui/layout";
      import { ioButton } from "@io-gui/inputs";
      import { ioMenuTree, MenuOption } from "@io-gui/menus";

      $.permit();
      const $level = $({ key: "level", storage: "hash", value: "lvl_0101" });

      const game = new Game({ level: $level });

      const levelOptions = new MenuOption({});
      const loadLevels = async () => {
        const response = await fetch("./public/levels/index.json");
        const levelIds = await response.json();
        levelOptions.options = levelIds.map((id) => new MenuOption({ id }));
      };
      loadLevels();
      levelOptions.addEventListener("selectedID-changed", () => {
        $level.value = levelOptions.selectedID;
      });

      function modeSelect(mode, layer) {
        game.drawMode = mode;
        if (mode === "line" && layer !== undefined) {
          game.drawLayer = layer;
        }
      }

      const split = new IoSplit({
        split: new Split({
          type: "split",
          children: [
            { type: "panel", flex: "0 0 110px", tabs: [{ id: "levels" }] },
            { type: "panel", flex: "1 1 800px", tabs: [{ id: "game" }] },
            { type: "panel", flex: "0 0 120px", tabs: [{ id: "editor" }] },
          ],
        }),
        elements: [
          ioMenuTree({ id: "levels", option: levelOptions }),
          circuitsBoard({ id: "game", game: game }),
          div({ id: "editor" }, [
            ioButton({ label: "Pad", action: () => modeSelect("pad") }),
            ...Object.keys(COLORS).map((c) =>
              ioButton({
                label: c,
                action: () => modeSelect("terminal", c),
              }),
            ),
            ioButton({
              label: "Line (top)",
              action: () => modeSelect("line", 0),
            }),
            ioButton({
              label: "Line (bottom)",
              action: () => modeSelect("line", -1),
            }),
            ioButton({
              label: "Delete",
              action: () => modeSelect("delete"),
            }),
          ]),
        ],
      });

      document.body.appendChild(split);
    </script>
  </body>
</html>
