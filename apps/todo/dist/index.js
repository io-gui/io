const bothAreNaNs=function(value,oldValue){return"number"==typeof value&&isNaN(value)&&"number"==typeof oldValue&&isNaN(oldValue)};class Binding{node;property;targets=/* @__PURE__ */new Set;targetProperties=/* @__PURE__ */new WeakMap;constructor(node,property){node._isNode||node._isIoElement||console.warn("Source node is not a ReactiveNode or IoElement instance!"),node._reactiveProperties.has(property)||console.warn(`Source node does not have a reactive property "${property}"!`),this.node=node,this.property=property,this.onSourceChanged=this.onSourceChanged.bind(this),this.onTargetChanged=this.onTargetChanged.bind(this),this.node.addEventListener(`${this.property}-changed`,this.onSourceChanged)}set value(value){this.node[this.property]=value}get value(){return this.node[this.property]}addTarget(target,property){const targetProps=this.getTargetProperties(target);if(target._isNode||target._isIoElement||console.warn("Target node is not a ReactiveNode or IoElement instance!"),target._reactiveProperties.has(property)||console.warn(`Target node does not have a reactive property "${property}"!`),-1!==targetProps.indexOf(property)&&console.error(`Target property "${property}" already added!`),this.targets.has(target)||this.targets.add(target),-1===targetProps.indexOf(property)){targetProps.push(property);const targetP=target._reactiveProperties.get(property);targetP.binding&&targetP.binding!==this&&(console.warn("Improper usage detected!"),console.info("Target property is already a target of another binding. Undinding previous binding!"),targetP.binding.removeTarget(target,property)),targetP.binding=this;{const srcP=this.node._reactiveProperties.get(this.property),valueMismatch=void 0!==srcP.value&&void 0!==targetP.value&&typeof srcP.value!=typeof targetP.value,typeMismatch=void 0!==srcP.type&&void 0!==targetP.type&&(type1=srcP.type,type2=targetP.type,!(type1===type2||"function"==typeof type1&&"function"==typeof type2&&(type1.prototype instanceof type2||type2.prototype instanceof type1)));(valueMismatch||typeMismatch)&&(console.warn(`Source property "${this.property}" does not match type of target property "${property}"!`),console.info(`Source "${this.property}" value: ${srcP.value} type: ${srcP.type} typeof: ${typeof srcP.value}`),console.info(`Target "${property}" value: ${targetP.value} type: ${targetP.type} typeof: ${typeof targetP.value}`))}target.addEventListener(`${property}-changed`,this.onTargetChanged),target.setProperty(property,this.value,!0)}var type1,type2}removeTarget(target,property){const targetProperties=this.getTargetProperties(target);if(property){const i=targetProperties.indexOf(property);-1===i&&console.error("Target property not found!"),targetProperties.splice(i,1);const propertyInstance=target._reactiveProperties.get(property);propertyInstance.binding!==this&&console.error("Target property has a different binding!"),propertyInstance.binding=void 0,target.removeEventListener(`${property}-changed`,this.onTargetChanged)}else{for(let i=targetProperties.length;i--;){const prop=targetProperties[i],propertyInstance=target._reactiveProperties.get(prop);propertyInstance.binding!==this&&console.error("Target property has a different binding!"),propertyInstance.binding=void 0,target.removeEventListener(`${prop}-changed`,this.onTargetChanged)}targetProperties.length=0}0===targetProperties.length&&this.targets.delete(target)}onTargetChanged(event){this.targets.has(event.target)||console.error("onTargetChanged() should never fire if target is not accounted for!");const oldValue=this.value,value=event.detail.value;if(oldValue!==value){if(bothAreNaNs(value,oldValue))return;this.node[this.property]=value}}onSourceChanged(event){event.target!==this.node&&console.error("onSourceChanged() should always originate form source node!");const value=event.detail.value;for(const target of this.targets){const targetProperties=this.getTargetProperties(target);for(let j=targetProperties.length;j--;){const propName=targetProperties[j],oldValue=target[propName];if(oldValue!==value){if(bothAreNaNs(value,oldValue))continue;target[propName]=value}}}}getTargetProperties(target){return this.targetProperties.has(target)||this.targetProperties.set(target,[]),this.targetProperties.get(target)}toJSON(){const targetProperties=[],targetNames=[];for(const target of this.targets)targetNames.push(target.constructor.name),targetProperties.push(this.getTargetProperties(target));return{node:this.node.constructor.name,property:this.property,targets:targetNames,targetProperties:targetProperties}}dispose(){this.node.removeEventListener(`${this.property}-changed`,this.onSourceChanged);for(const target of this.targets)this.removeTarget(target);this.targets.clear(),delete this.node,delete this.property,delete this.targets,delete this.targetProperties}}class ChangeQueue{dispatchedChange=!1;dispatching=!1;constructor(node){this.changes=[],this.node=node,Object.defineProperty(this,"dispatch",{value:this.dispatch.bind(this),enumerable:!1,writable:!1,configurable:!1})}queue(property,value,oldValue){value===oldValue&&console.warn("ChangeQueue: queuing change with same value and oldValue!");const i=this.changes.findIndex(change=>change.property===property);-1===i?this.changes.push({property:property,value:value,oldValue:oldValue}):value===this.changes[i].oldValue?this.changes.splice(i,1):this.changes[i].value=value}dispatch(){if(!0===this.dispatching)return void console.error("ChangeQueue: dispatching already in progress!");this.dispatching=!0;const properties=[];let i=0;for(;i<this.changes.length;){const change=this.changes[i],property=change.property;if(change.value!==change.oldValue){this.dispatchedChange=!0;const handlerName=property+"Changed";if(this.node[handlerName])try{this.node[handlerName](change)}catch(error){console.error(`Error in ${this.node.constructor.name}.${handlerName}():`,error)}this.node.dispatch(property+"-changed",change),properties.push(property)}i++}if(this.changes.length=0,this.dispatchedChange){try{this.node.changed()}catch(error){console.error(`Error in ${this.node.constructor.name}.changed():`,error)}this.node._isNode&&this.node.dispatchMutation(this.node,properties)}this.dispatchedChange=!1,this.dispatching=!1}dispose(){this.changes.length=0,delete this.node,delete this.changes}}const hardenListenerDefinition=listenerDefinition=>Array.isArray(listenerDefinition)?listenerDefinition:[listenerDefinition],LISTENER_OPTIONS=["capture","passive"],listenerFromDefinition=(node,def)=>{const handlerDef=def[0],options=def[1];if("string"!=typeof handlerDef&&"function"!=typeof handlerDef&&console.error("listenerFromDefinition: Listener must be a function or method name"),options)if("object"!=typeof options)console.error("listenerFromDefinition: Listener options must be an object");else{const invalidOptions=Object.keys(options).filter(k=>!LISTENER_OPTIONS.includes(k));invalidOptions.length>0&&console.error(`listenerFromDefinition: Invalid listener options: ${invalidOptions.join(", ")}`)}"string"!=typeof handlerDef||handlerDef in node||console.error(`listenerFromDefinition: Method "${handlerDef}" not found on node`);const handler="string"==typeof handlerDef?node[handlerDef]:handlerDef;return options?[handler,options]:[handler]};class EventDispatcher{node;nodeIsEventTarget;protoListeners={};propListeners={};addedListeners={};constructor(node){this.node=node,this.nodeIsEventTarget=node instanceof EventTarget,this.setProtoListeners(node)}setProtoListeners(node){for(const name in node._protochain?.listeners){for(let i=0;i<node._protochain.listeners[name].length;i++){const listener=listenerFromDefinition(node,node._protochain.listeners[name][i]);this.protoListeners[name]=[listener]}if(this.nodeIsEventTarget&&this.protoListeners[name]){const listener=this.protoListeners[name][0];EventTarget.prototype.addEventListener.call(this.node,name,listener[0],listener[1])}}}applyPropListeners(properties){const newPropListeners={};for(const prop in properties){if(!prop.startsWith("@"))continue;const name=prop.slice(1),definition=hardenListenerDefinition(properties[prop]),listener=listenerFromDefinition(this.node,definition);newPropListeners[name]=[listener]}const propListeners=this.propListeners;for(const name in propListeners)if(!newPropListeners[name]){if(this.nodeIsEventTarget){const listener=propListeners[name][0];EventTarget.prototype.removeEventListener.call(this.node,name,listener[0],listener[1])}delete propListeners[name]}for(const name in newPropListeners){if(this.nodeIsEventTarget){const newListener=newPropListeners[name][0];if(propListeners[name]){const oldListener=propListeners[name][0];(oldListener!==newListener||newListener[1]&&JSON.stringify(oldListener[1])!==JSON.stringify(newListener[1]))&&EventTarget.prototype.removeEventListener.call(this.node,name,oldListener[0],oldListener[1])}EventTarget.prototype.addEventListener.call(this.node,name,newListener[0],newListener[1])}propListeners[name]=newPropListeners[name]}}addEventListener(name,listener,options){if("function"!=typeof listener&&console.error("EventDispatcher.addEventListener: Invalid listener type - must be a function"),options)if("object"!=typeof options)console.error("EventDispatcher.addEventListener: Invalid listener options type - must be an object");else{const invalidOptions=Object.keys(options).filter(k=>!LISTENER_OPTIONS.includes(k));invalidOptions.length>0&&console.warn(`EventDispatcher.addEventListener: Invalid listener options: ${invalidOptions.join(", ")}`)}this.addedListeners[name]||(this.addedListeners[name]=[]);if(-1!==this.addedListeners[name].findIndex(l=>l[0]===listener))return void console.warn(`EventDispatcher.addEventListener: Listener for '${name}' event already added`,this.node);const listenerTuple=options?[listener,options]:[listener];this.addedListeners[name].push(listenerTuple),this.nodeIsEventTarget&&EventTarget.prototype.addEventListener.call(this.node,name,listener,options)}removeEventListener(name,listener,options){if(listener&&"function"!=typeof listener&&console.error("EventDispatcher.removeEventListener: Invalid listener type!"),options)if("object"!=typeof options)console.error("EventDispatcher.removeEventListener: Invalid listener options type - must be an object");else{const invalidOptions=Object.keys(options).filter(k=>!LISTENER_OPTIONS.includes(k));invalidOptions.length>0&&console.warn(`EventDispatcher.removeEventListener: Invalid listener options: ${invalidOptions.join(", ")}`)}if(this.addedListeners[name]||console.error(`EventDispatcher.removeEventListener: Listener ${name} not found!`),this.addedListeners[name]){if(listener){const index=this.addedListeners[name].findIndex(item=>item[0]===listener);-1===index&&console.error(`EventDispatcher.removeEventListener: Listener ${name} not found!`),-1!==index&&(this.addedListeners[name].splice(index,1),this.nodeIsEventTarget&&EventTarget.prototype.removeEventListener.call(this.node,name,listener,options))}else{for(let i=0;i<this.addedListeners[name].length;i++)if(this.nodeIsEventTarget){const listener2=this.addedListeners[name][i];EventTarget.prototype.removeEventListener.call(this.node,name,listener2[0],listener2[1])}this.addedListeners[name].length=0}0===this.addedListeners[name].length&&delete this.addedListeners[name]}}dispatchEvent(name,detail,bubbles=!0,node=this.node,path=[],visited=/* @__PURE__ */new Set){if(!this.node._disposed&&!visited.has(node))if(visited.add(node),path=[...path,node],node instanceof EventTarget){const bubblesNative=bubbles&&!((node,visited)=>{if(!(node instanceof Node))return!1;let current=node.parentNode;for(;current;){if(visited.has(current))return!0;current=current.parentNode}return!1})(node,visited);EventTarget.prototype.dispatchEvent.call(node,new CustomEvent(name,{detail:detail,bubbles:bubblesNative,composed:!0,cancelable:!0}))}else{const payload={detail:detail,target:node,path:path};if(this.protoListeners[name])for(let i=0;i<this.protoListeners[name].length;i++){this.protoListeners[name][i][0].call(node,payload)}if(this.propListeners[name]){this.propListeners[name].length>1&&console.error(`EventDispatcher.dispathEvent: PropListeners[${name}] array too long!`);this.propListeners[name][0][0].call(node,payload)}if(this.addedListeners[name])for(let i=0;i<this.addedListeners[name].length;i++){this.addedListeners[name][i][0].call(node,payload)}if(bubbles)for(const parent of node._parents)!parent._isNode&&!parent._isIoElement||parent._disposed||visited.has(parent)||parent._eventDispatcher.dispatchEvent(name,detail,bubbles,parent,path,visited)}}dispose(){for(const name in this.protoListeners){if(this.nodeIsEventTarget)for(let i=0;i<this.protoListeners[name].length;i++){const listener=this.protoListeners[name][i];EventTarget.prototype.removeEventListener.call(this.node,name,listener[0],listener[1])}this.protoListeners[name].length=0,delete this.protoListeners[name]}for(const name in this.propListeners){if(this.nodeIsEventTarget){const listener=this.propListeners[name][0];EventTarget.prototype.removeEventListener.call(this.node,name,listener[0],listener[1])}this.propListeners[name].length=0,delete this.propListeners[name]}for(const name in this.addedListeners){if(this.nodeIsEventTarget)for(let i=this.addedListeners[name].length;i--;){const listener=this.addedListeners[name][i];EventTarget.prototype.removeEventListener.call(this.node,name,listener[0],listener[1])}this.addedListeners[name].length=0,delete this.addedListeners[name]}delete this.node,delete this.protoListeners,delete this.propListeners,delete this.addedListeners}}class NodeArray extends Array{constructor(node,...args){super(...args),this.node=node,this.itemMutated=this.itemMutated.bind(this),this.dispatchMutation=this.dispatchMutation.bind(this),this._observers.add(node),node._isNode||node._isIoElement||console.error("NodeArray constructor called with non-node!");const self=this,proxy=new Proxy(this,{get(target,property){if("symbol"==typeof property)return target[property];const index=Number(property);return!isNaN(index)&&index>=0?target[index]:target[property]},set(target,property,value){if("length"===property){if(!self._isInternalOperation){const oldLength=target.length,newLength=Number(value);if(newLength<oldLength)for(let i=newLength;i<oldLength;i++){const item=target[i];item._isNode&&(item.removeEventListener("io-object-mutation",self.itemMutated),item.removeParent(self.node))}else if(newLength>oldLength)return console.warn("NodeArray: cannot extend array with empty slots"),!0}return target[property]=value,self._isInternalOperation||self.dispatchMutation(),!0}const index=Number(property);if(!isNaN(index)&&index>=0){const oldValue=target[index];return void 0!==oldValue&&oldValue._isNode&&!self._isInternalOperation&&(oldValue.removeEventListener("io-object-mutation",self.itemMutated),oldValue.removeParent(self.node)),target[property]=value,value._isNode&&!self._isInternalOperation&&(value.addEventListener("io-object-mutation",self.itemMutated),value.addParent(self.node)),self._isInternalOperation||self.dispatchMutation(),!0}return target[property]=value,!0}});return Object.defineProperty(this,"proxy",{value:proxy,enumerable:!1,configurable:!1}),proxy}_isInternalOperation=!1;_observers=/* @__PURE__ */new Set;static get[Symbol.species](){return Array}withInternalOperation(operation){this._isInternalOperation=!0;try{return operation()}finally{this._isInternalOperation=!1}}splice(start,deleteCount,...items){return this.withInternalOperation(()=>{for(let i=start;i<start+deleteCount;i++){const item=this[i];item._isNode&&(item.removeEventListener("io-object-mutation",this.itemMutated),item.removeParent(this.node))}const result=super.splice(start,deleteCount,...items);for(let i=start;i<start+items.length;i++){const item=this[i];item._isNode&&(item.addEventListener("io-object-mutation",this.itemMutated),item.addParent(this.node))}return(deleteCount||items.length)&&this.dispatchMutation(),result})}push(...items){return this.withInternalOperation(()=>{const result=super.push(...items);for(const item of items)item._isNode&&(item.addEventListener("io-object-mutation",this.itemMutated),item.addParent(this.node));return items.length&&this.dispatchMutation(),result})}unshift(...items){return this.withInternalOperation(()=>{const result=super.unshift(...items);for(const item of items)item._isNode&&(item.addEventListener("io-object-mutation",this.itemMutated),item.addParent(this.node));return items.length&&this.dispatchMutation(),result})}pop(){return this.withInternalOperation(()=>{const item=super.pop();return void 0!==item&&item._isNode&&(item.removeEventListener("io-object-mutation",this.itemMutated),item.removeParent(this.node)),void 0!==item&&this.dispatchMutation(),item})}shift(){return this.withInternalOperation(()=>{const item=super.shift();return void 0!==item&&item._isNode&&(item.removeEventListener("io-object-mutation",this.itemMutated),item.removeParent(this.node)),void 0!==item&&this.dispatchMutation(),item})}reverse(){return this.withInternalOperation(()=>{const result=super.reverse();return result.length&&this.dispatchMutation(),result})}sort(compareFn){return this.withInternalOperation(()=>{const result=super.sort(compareFn);return result.length&&this.dispatchMutation(),result})}fill(value,start,end){return this.withInternalOperation(()=>{const len=this.length,relativeStart=start??0,relativeEnd=end??len,actualStart=relativeStart<0?Math.max(len+relativeStart,0):Math.min(relativeStart,len),actualEnd=relativeEnd<0?Math.max(len+relativeEnd,0):Math.min(relativeEnd,len);for(let i=actualStart;i<actualEnd;i++){const oldItem=this[i];void 0!==oldItem&&oldItem._isNode&&(oldItem.removeEventListener("io-object-mutation",this.itemMutated),oldItem.removeParent(this.node))}super.fill(value,actualStart,actualEnd);for(let i=actualStart;i<actualEnd;i++)value._isNode&&(value.addEventListener("io-object-mutation",this.itemMutated),value.addParent(this.node));return actualEnd>actualStart&&this.dispatchMutation(),this})}copyWithin(target,start,end){return this.withInternalOperation(()=>{const len=this.length,relativeTarget=target,relativeStart=start??0,relativeEnd=end??len,actualTarget=relativeTarget<0?Math.max(len+relativeTarget,0):Math.min(relativeTarget,len),actualStart=relativeStart<0?Math.max(len+relativeStart,0):Math.min(relativeStart,len),actualEnd=relativeEnd<0?Math.max(len+relativeEnd,0):Math.min(relativeEnd,len),count=Math.min(actualEnd-actualStart,len-actualTarget);if(count<=0)return this;for(let i=actualTarget;i<actualTarget+count;i++){const oldItem=this[i];void 0!==oldItem&&oldItem._isNode&&(oldItem.removeEventListener("io-object-mutation",this.itemMutated),oldItem.removeParent(this.node))}super.copyWithin(actualTarget,actualStart,actualEnd);for(let i=actualTarget;i<actualTarget+count;i++){const item=this[i];item._isNode&&(item.addEventListener("io-object-mutation",this.itemMutated),item.addParent(this.node))}return this.dispatchMutation(),this})}addObserver(node){this._observers.add(node)}removeObserver(node){this._observers.delete(node)}itemMutated(event){for(const observer of this._observers)observer.dispatch("io-object-mutation",{object:this.proxy,property:event.detail.index})}dispatchMutation(){for(const observer of this._observers)observer.dispatch("io-object-mutation",{object:this.proxy})}}class ReactiveProtoProperty{constructor(def){if(null==def)this.value=def;else if("function"==typeof def)this.type=def;else if(def instanceof Binding)this.value=def.value,this.binding=def;else if(def&&def.constructor===Object){const d=def;Object.hasOwn(d,"value")&&(this.value=d.value),Object.hasOwn(d,"type")&&(this.type=d.type),d.binding instanceof Binding&&(this.binding=d.binding,this.value=this.binding.value),Object.hasOwn(d,"reflect")&&(this.reflect=d.reflect),Object.hasOwn(d,"init")&&(this.init=d.init)}else def&&def.constructor===Object||(this.value=def)}assign(protoProp){Object.hasOwn(protoProp,"value")&&(this.value=protoProp.value),Object.hasOwn(protoProp,"type")&&(this.type=protoProp.type),Object.hasOwn(protoProp,"reflect")&&(this.reflect=protoProp.reflect),Object.hasOwn(protoProp,"init")&&(this.init=protoProp.init),Object.hasOwn(protoProp,"binding")&&(this.binding=protoProp.binding)}toJSON(){const json={value:this.value,type:this.type,reflect:this.reflect,init:this.init,binding:this.binding};return json.value&&"object"==typeof json.value&&(json.value=json.value.constructor.name),json.type&&"function"==typeof json.type&&(json.type=json.type.name),json}}function decodeInitArgument(item,node){if("this"===item)return node;if("string"!=typeof item||!item.startsWith("this."))return item;{const keys=item.split(".");let target=node;for(let i=1;i<keys.length;i++)target=target[keys[i]];if(target)return target;console.error(`ReactivePropertyInstance: Invalid path ${item}`)}}function isIoValue(value){return"object"==typeof value&&null!==value&&(value._isNode||value._isIoElement)}class Observer{type="none";observing=!1;constructor(node){Object.defineProperty(this,"node",{enumerable:!1,configurable:!1,writable:!1,value:node}),Object.defineProperty(this,"_hasSelfMutationListener",{enumerable:!1,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_hasWindowMutationListener",{enumerable:!1,configurable:!0,writable:!0,value:!1})}start(value){this.observing||value&&"object"==typeof value&&(isIoValue(value)?(this.type="io",this.observing=!0,value.addEventListener("io-object-mutation",this.node.onPropertyMutated)):value instanceof NodeArray?(this.type="nodearray",this.observing=!0,value.addObserver(this.node),this._hasSelfMutationListener||(this._hasSelfMutationListener=!0,this.node.addEventListener("io-object-mutation",this.node.onPropertyMutated))):(this.type="object",this.observing=!0,this._hasWindowMutationListener||(this._hasWindowMutationListener=!0,window.addEventListener("io-object-mutation",this.node.onPropertyMutated))))}stop(value){isIoValue(value)&&!value._disposed?value.removeEventListener("io-object-mutation",this.node.onPropertyMutated):value instanceof NodeArray&&value.removeObserver(this.node),this.observing=!1}dispose(){this._hasSelfMutationListener&&(this.node.removeEventListener("io-object-mutation",this.node.onPropertyMutated),this._hasSelfMutationListener=!1),this._hasWindowMutationListener&&(window.removeEventListener("io-object-mutation",this.node.onPropertyMutated),this._hasWindowMutationListener=!1)}}class ReactivePropertyInstance{value;type;binding;reflect=!1;init=void 0;observer;constructor(node,propDef){if(Object.keys(propDef).forEach(key=>{-1===["value","type","reflect","init","binding"].indexOf(key)&&console.warn(`ReactiveProtoProperty: Invalid field ${key}`)}),void 0!==propDef.type&&"function"!=typeof propDef.type&&console.warn('Incorrect type for "type" field'),propDef.type===NodeArray&&"this"!==propDef.init&&console.warn('NodeArray property should be initialized with "this"'),void 0!==propDef.binding&&propDef.binding.constructor!==Binding&&console.warn('Incorrect type for "binding" field'),void 0!==propDef.reflect&&"boolean"!=typeof propDef.reflect&&console.error(`Invalid reflect field ${propDef.reflect}!`),this.value=propDef.value,this.type=propDef.type,this.binding=propDef.binding,"boolean"==typeof propDef.reflect&&(this.reflect=propDef.reflect),void 0!==propDef.init&&(this.init=propDef.init),this.binding instanceof Binding)this.value=this.binding.value;else if(void 0===this.value)if(this.type===Boolean)this.value=!1;else if(this.type===String)this.value="";else if(this.type===Number)this.value=0;else if("function"==typeof this.type&&void 0!==this.init)if(this.init instanceof Array){const args=this.init.map(item=>decodeInitArgument(item,node));this.value=new this.type(...args)}else if(this.init instanceof Object){const args={};Object.keys(this.init).forEach(key=>{args[key]=decodeInitArgument(this.init[key],node)}),this.value=new this.type(args)}else if(null===this.init)this.value=new this.type;else{const argument=decodeInitArgument(this.init,node);this.value=new this.type(argument)}this.observer=new Observer(node),this.observer.start(this.value),void 0!==this.value&&void 0!==this.init&&(-1!==[String,Number,Boolean].indexOf(this.type)?(this.type===Boolean&&"boolean"!=typeof this.value||this.type===Number&&"number"!=typeof this.value||this.type===String&&"string"!=typeof this.value)&&console.warn(`Property: Uninitialized value for type "${this.type.name}"!`):"function"!=typeof this.type||this.value instanceof this.type||console.warn(`Property: Incorrect value "${this.value}" for type "${this.type.name}"!`))}}const propertyDecorators=/* @__PURE__ */new WeakMap,reactivePropertyDecorators=/* @__PURE__ */new WeakMap;function ReactiveProperty(defLoose={}){return(target,propertyName)=>{const constructor=target.constructor,properties=reactivePropertyDecorators.get(constructor)||{};reactivePropertyDecorators.set(constructor,properties),properties[propertyName]=defLoose}}const styleDecorators=/* @__PURE__ */new WeakMap;class ProtoChain{constructors=[];properties={};reactiveProperties={};listeners={};style="";handlers=[];constructor(ioNodeConstructor){let proto=ioNodeConstructor.prototype;for(;proto&&ioNodeConstructor!==HTMLElement&&ioNodeConstructor!==Object;)this.constructors.push(ioNodeConstructor),proto=Object.getPrototypeOf(proto),ioNodeConstructor=proto.constructor;let reactivePropertyHash="",propertyHash="";for(let i=this.constructors.length;i--;)ioNodeConstructor=this.constructors[i],this.addPropertiesFromDecorators(ioNodeConstructor),propertyHash=this.addProperties(ioNodeConstructor.Properties,propertyHash),this.addReactivePropertiesFromDecorators(ioNodeConstructor),reactivePropertyHash=this.addReactiveProperties(ioNodeConstructor.ReactiveProperties,reactivePropertyHash),this.addListeners(ioNodeConstructor.Listeners),this.addStyle(ioNodeConstructor.Style),this.addStyleFromDecorators(ioNodeConstructor),this.addHandlers(ioNodeConstructor.prototype);this.validateReactiveProperties(),Object.freeze(this.constructors),Object.freeze(this.properties),Object.freeze(this.reactiveProperties),Object.freeze(this.listeners),Object.freeze(this.handlers)}init(node){if(this.constructors[0]!==node.constructor)throw new Error(`${node.constructor.name} not registered! Use @Register decorator before using ${node.constructor.name} class.`);for(let i=this.handlers.length;i--;)Object.defineProperty(node,this.handlers[i],{value:node[this.handlers[i]].bind(node),writable:!0,configurable:!0})}addPropertiesFromDecorators(ioNodeConstructor){const props=propertyDecorators.get(ioNodeConstructor);if(props)for(const name in props)this.properties[name]=props[name]}addProperties(properties={},prevHash=""){const newHash=JSON.stringify(properties);if(newHash!==prevHash){for(const name in properties)this.properties[name]=properties[name];prevHash=newHash}return prevHash}addReactivePropertiesFromDecorators(ioNodeConstructor){const props=reactivePropertyDecorators.get(ioNodeConstructor);if(props)for(const name in props){const protoProperty=new ReactiveProtoProperty(props[name]);this.reactiveProperties[name]||(this.reactiveProperties[name]=protoProperty),this.reactiveProperties[name].assign(protoProperty)}}addReactiveProperties(properties={},prevHash=""){const reativeProtoProperties={};for(const name in properties)reativeProtoProperties[name]=new ReactiveProtoProperty(properties[name]);const newHash=JSON.stringify(reativeProtoProperties);if(newHash!==prevHash){for(const name in properties)this.reactiveProperties[name]?this.reactiveProperties[name].assign(reativeProtoProperties[name]):this.reactiveProperties[name]=reativeProtoProperties[name];prevHash=newHash}return prevHash}addListeners(listenerDefs){for(const name in listenerDefs)if(listenerDefs[name]){const lsnDef=hardenListenerDefinition(listenerDefs[name]),listeners=this.listeners[name]=this.listeners[name]||[],i=listeners.findIndex(def=>def[0]===lsnDef[0]);-1!==i?listeners[i][1]?listeners[i][1]=Object.assign(listeners[i][1],lsnDef[1]):lsnDef[1]&&(listeners[i][1]=lsnDef[1]):listeners.push(lsnDef)}}addStyle(style){style&&-1===this.style.indexOf(style)&&(this.style=this.style?this.style+"\n"+style:style)}addStyleFromDecorators(ioNodeConstructor){const style=styleDecorators.get(ioNodeConstructor);style&&(this.style=this.style?this.style+"\n"+style:style)}addHandlers(proto){const names=Object.getOwnPropertyNames(proto);for(let j=0;j<names.length;j++){const fn=names[j];if(/^on[A-Z]/.test(fn)||/^_on[A-Z]/.test(fn)||fn.endsWith("Changed")||fn.endsWith("Mutated")||fn.endsWith("Debounced")||fn.endsWith("Throttled")||"changed"===fn){const propDesr=Object.getOwnPropertyDescriptor(proto,fn);if(void 0===propDesr||propDesr.get||propDesr.set)continue;"function"==typeof proto[fn]&&-1===this.handlers.indexOf(fn)&&this.handlers.push(fn)}}}validateReactiveProperties(){for(const name in this.reactiveProperties){const prop=this.reactiveProperties[name];if(-1!==[String,Number,Boolean].indexOf(prop.type))(prop.type===Boolean&&void 0!==prop.value&&"boolean"!=typeof prop.value||prop.type===Number&&void 0!==prop.value&&"number"!=typeof prop.value||prop.type===String&&void 0!==prop.value&&"string"!=typeof prop.value)&&console.warn(`Reactive property "${name}" value "${prop.value}" type for ${prop.type.name} property!`);else{const isNull=null===prop.value,isUndefined=void 0===prop.value;"function"!=typeof prop.type||prop.value instanceof prop.type||isNull||isUndefined||console.warn(`Reactive property "${name}" value "${prop.value}" type for ${prop.type.name} property!`)}}}}let currentFrame=0;const queue0=/* @__PURE__ */new Map,queue1=/* @__PURE__ */new Map;let queue=queue0;const keysByNode=/* @__PURE__ */new WeakMap,keysByFunc=/* @__PURE__ */new Map,throttleNextFrame=/* @__PURE__ */new WeakMap,throttleNextFrameGlobal=/* @__PURE__ */new Map;function getKey(func,node){if(node){let funcMap=keysByNode.get(node);funcMap||(funcMap=/* @__PURE__ */new Map,keysByNode.set(node,funcMap));let key=funcMap.get(func);return key||(key={node:node,func:func},funcMap.set(func,key)),key}{let key=keysByFunc.get(func);return key||(key={node:void 0,func:func},keysByFunc.set(func,key)),key}}function throttle(func,arg,node,delay=1){if(node?._disposed)return;const key=getKey(func,node);let nextAllowed;if(nextAllowed=node?throttleNextFrame.get(node)?.get(func)??-Infinity:throttleNextFrameGlobal.get(func)??-Infinity,currentFrame>=nextAllowed){if(node){let funcMap=throttleNextFrame.get(node);funcMap||(funcMap=/* @__PURE__ */new Map,throttleNextFrame.set(node,funcMap)),funcMap.set(func,currentFrame+delay)}else throttleNextFrameGlobal.set(func,currentFrame+delay);try{void 0!==arg?func(arg):func()}catch(e){console.error(e)}queue.set(key,{arg:arg,frame:currentFrame+delay})}else{const existing=queue.get(key);existing&&(existing.arg=arg)}}function debounce(func,arg,node,delay=1){const key=getKey(func,node);queue.set(key,{arg:arg,frame:currentFrame+delay})}requestAnimationFrame(function executeQueue(){currentFrame++;const activeQueue=queue;queue=queue===queue0?queue1:queue0;for(const[key,options]of activeQueue)if(options.frame>currentFrame)queue.has(key)||queue.set(key,options);else if(!key.node?._disposed)try{void 0!==options.arg?key.func(options.arg):key.func()}catch(e){console.error(e)}activeQueue.clear(),requestAnimationFrame(executeQueue)});const defaultPropsMap=/* @__PURE__ */new WeakMap,applyNativeElementProps=function(element,props){const defaultPropValues=defaultPropsMap.get(element)||{};defaultPropsMap.set(element,defaultPropValues);for(const _p in props){const p=_p,prop=props[p];if(prop instanceof Binding&&console.warn(`VDOM: Cannot set binding on "${element.localName}.${_p}"`),Object.hasOwn(defaultPropValues,p)||(defaultPropValues[p]=element[p]),"style"===p)for(const s in prop)element.style.setProperty(s,prop[s]);else"class"===p?element.className=prop:p.startsWith("data-")?void 0===prop?element.removeAttribute(p):element.setAttribute(p,prop):element[p]=void 0===prop?defaultPropValues[p]:prop;(void 0===prop||prop===defaultPropValues[p])&&element.removeAttribute(p)}for(const _p in defaultPropValues){const p=_p;Object.hasOwn(props,p)||(element[p]=defaultPropValues[p],element.removeAttribute(p))}element._eventDispatcher||Object.defineProperty(element,"_eventDispatcher",{enumerable:!1,configurable:!0,value:new EventDispatcher(element)}),element._eventDispatcher.applyPropListeners(props)},constructElement=function(vDOMElement){const props=vDOMElement.props||{},ConstructorClass=window.customElements?window.customElements.get(vDOMElement.tag):null;if(ConstructorClass&&ConstructorClass.prototype?._isIoElement)return new ConstructorClass(props);const element=document.createElement(vDOMElement.tag);return applyNativeElementProps(element,props),element},disposeChildren=function(element){requestAnimationFrame(()=>{const elements=Array.from(element.querySelectorAll("*")).concat([element]);for(let i=elements.length;i--;)"function"==typeof elements[i].dispose?elements[i].dispose():elements[i]._eventDispatcher&&(elements[i]._eventDispatcher.dispose(),delete elements[i]._eventDispatcher)})},vDOMAttributes=function(element){const attributes={};for(let i=0;i<element.attributes.length;i++){const name=element.attributes[i].name,value=element.getAttribute(name);null!==value&&(attributes[name]=value)}return attributes},toVDOMChildren=function(htmlCollection){const children=[];for(let i=0;i<htmlCollection.length;i++)children.push(toVDOM(htmlCollection[i]));return children},toVDOM=function(element){return{tag:element.localName,props:vDOMAttributes(element),children:element.children.length>0?toVDOMChildren(element.children):element.textContent}};function Register(ioNodeConstructor){ioNodeConstructor.prototype.Register(ioNodeConstructor)}const mixinRecord={},commentsRegex=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/)","gi"),keyframeRegex=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi"),mediaQueryRegex=new RegExp("((@media [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi"),mixinRegex=new RegExp("(( --[\\s\\S]*?): {([\\s\\S]*?)})","gi"),applyRegex=new RegExp("(@apply\\s.*?;)","gi"),cssRegex=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");var __defProp$c=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$c=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$5(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$c(target,key,result),result};const resizeObserver=new ResizeObserver(entries=>{for(const entry of entries)entry.target.onResized()});let IoElement=class extends HTMLElement{static get Style(){return"\n      :host {\n        display: block;\n        box-sizing: border-box;\n        -webkit-touch-callout: none;\n      }\n      :host[hidden] {\n        display: none;\n      }\n      --unselectable: {\n        user-select: none;\n        -webkit-user-select: none;\n        -webkit-touch-callout: none;\n        -webkit-tap-highlight-color: transparent;\n      }\n      --io_focus: {\n        border-color: var(--io_colorWhite) !important;\n        outline: var(--io_borderWidth) solid var(--io_borderColorBlue) !important;\n        z-index: 1;\n      }\n    "}static get ReactiveProperties(){return{}}static get Properties(){return{}}static get Listeners(){return{}}constructor(args={}){super(),this._protochain.init(this),Object.defineProperty(this,"_changeQueue",{enumerable:!1,configurable:!0,value:new ChangeQueue(this)}),Object.defineProperty(this,"_reactiveProperties",{enumerable:!1,configurable:!0,value:/* @__PURE__ */new Map}),Object.defineProperty(this,"_bindings",{enumerable:!1,configurable:!0,value:/* @__PURE__ */new Map}),Object.defineProperty(this,"_eventDispatcher",{enumerable:!1,configurable:!0,value:new EventDispatcher(this)}),Object.defineProperty(this,"_hasWindowMutationListener",{enumerable:!1,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_hasSelfMutationListener",{enumerable:!1,configurable:!0,writable:!0,value:!1}),this.init(),initReactiveProperties(this),initProperties(this),this.applyProperties(args,!0),this.ready(),this.dispatchQueue()}applyProperties(props,skipDispatch=!1){for(const name in props)if(this._reactiveProperties.has(name))this.setProperty(name,props[name],!0);else if("class"===name)this.className=props[name];else if("style"===name)for(const s in props[name])this.style[s]=props[name][s];else name.startsWith("data-")?void 0===props[name]?this.removeAttribute(name):this.setAttribute(name,props[name]):name.startsWith("@")||(props[name]instanceof Binding&&console.warn(`IoElement: Not a ReactiveProperty! Cannot set binding to "${name}" property on element "${this.localName}"`),this[name]=props[name],void 0===props[name]&&this.hasAttribute(name)&&this.removeAttribute(name));this._eventDispatcher.applyPropListeners(props),skipDispatch||this.dispatchQueue()}setProperties(props){setProperties(this,props)}setProperty(name,value,debounce2=!1){if(this._disposed)return;setProperty(this,name,value,debounce2);this._reactiveProperties.get(name).reflect&&this.setAttribute(name.toLowerCase(),value)}init(){}ready(){}changed(){}get[Symbol.toStringTag](){return this.constructor.name}queue(name,value,oldValue){this._changeQueue.queue(name,value,oldValue)}dispatchQueue(debounce2=!1){dispatchQueue(this,debounce2)}throttle(func,arg,timeout=1){throttle(func,arg,this,timeout)}debounce(func,arg,timeout=1){debounce(func,arg,this,timeout)}onPropertyMutated(event){return onPropertyMutated(this,event)}dispatchMutation(object=this,properties=[]){dispatchMutation(this,object,properties)}bind(name){return bind(this,name)}unbind(name){unbind(this,name)}addEventListener(type,listener,options){this._disposed||this._eventDispatcher.addEventListener(type,listener,options)}removeEventListener(type,listener,options){this._disposed||this._eventDispatcher.removeEventListener(type,listener,options)}dispatch(type,detail=void 0,bubbles=!1,src){this._disposed||this._eventDispatcher.dispatchEvent(type,detail,bubbles,src)}dispose(){dispose(this)}connectedCallback(){"function"==typeof this.onResized&&resizeObserver.observe(this)}disconnectedCallback(){"function"==typeof this.onResized&&resizeObserver.unobserve(this)}render(vDOMElements,host,noDispose){host=host||this;const vDOMElementsOnly=vDOMElements.filter(item=>null!==item);this.$={},this.traverse(vDOMElementsOnly,host,noDispose)}traverse(vChildren,host,noDispose){const children=host.children;for(;children.length>vChildren.length;){const child=children[children.length-1];host.removeChild(child),noDispose||disposeChildren(child)}for(let i=0;i<children.length;i++){const child=children[i];if(child.localName!==vChildren[i].tag||noDispose){const oldElement=child,element=constructElement(vChildren[i]);host.insertBefore(element,oldElement),host.removeChild(oldElement),noDispose||disposeChildren(oldElement)}else child.removeAttribute("className"),child.removeAttribute("style"),vChildren[i].props&&(child._isIoElement?child.applyProperties(vChildren[i].props):applyNativeElementProps(child,vChildren[i].props))}if(children.length<vChildren.length){const frag=document.createDocumentFragment();for(let i=children.length;i<vChildren.length;i++){const element=constructElement(vChildren[i]);frag.appendChild(element)}host.appendChild(frag)}for(let i=0;i<vChildren.length;i++){const vChild=vChildren[i],child=children[i];if(vChild.props?.id&&(void 0!==this.$[vChild.props.id]&&console.warn(`IoElement: Duplicate id in template. "${vChild.props.id}"`),this.$[vChild.props.id]=child),void 0!==vChild.children){if("string"==typeof vChild.children)this._flattenTextNode(child),child._textNode.nodeValue=String(vChild.children);else if(vChild.children instanceof Array&&!child._isIoElement){const vDOMElementsOnly=vChild.children.filter(item=>null!==item);this.traverse(vDOMElementsOnly,child,noDispose)}}else child._isIoElement||(child.textContent="")}}_flattenTextNode(element){if(0===element.childNodes.length&&element.appendChild(document.createTextNode("")),"#text"!==element.childNodes[0].nodeName&&(element.innerHTML="",element.appendChild(document.createTextNode(""))),element._textNode=element.childNodes[0],element.childNodes.length>1){const textContent=element.textContent;for(let i=element.childNodes.length;i--;)0!==i&&element.removeChild(element.childNodes[i]);element._textNode.nodeValue=textContent}}setAttribute(attr,value){!0===value?HTMLElement.prototype.setAttribute.call(this,attr,""):!1===value||""===value?this.removeAttribute(attr):"string"!=typeof value&&"number"!=typeof value||this.getAttribute(attr)!==String(value)&&HTMLElement.prototype.setAttribute.call(this,attr,String(value))}toVDOM(){return toVDOM(this)}Register(ioNodeConstructor){Object.defineProperty(ioNodeConstructor.prototype,"_protochain",{value:new ProtoChain(ioNodeConstructor)});const localName=ioNodeConstructor.name.replace(/([a-z])([A-Z,0-9])/g,"$1-$2").toLowerCase();Object.defineProperty(ioNodeConstructor.prototype,"localName",{value:localName}),Object.defineProperty(ioNodeConstructor.prototype,"_isIoElement",{enumerable:!1,value:!0,writable:!1}),Object.defineProperty(window,ioNodeConstructor.name,{value:ioNodeConstructor}),window.customElements.define(localName,ioNodeConstructor),function applyElementStyleToDocument(localName,style){let mixinsString="";const mixins=style.match(mixinRegex);if(mixins)for(let i=0;i<mixins.length;i++){const m=mixins[i].split(": {"),name=m[0].replace(" --","--"),value=m[1].replace(/}/g,"").trim().replace(/^ +/gm,"");mixinRecord[name]=value,mixinsString+=mixins[i].replace(" --",".").replace(": {"," {")}const apply=(style=style.replace(mixinRegex,"")).match(applyRegex);if(apply)for(let i=0;i<apply.length;i++){const name=apply[i].split("@apply ")[1].replace(";","");mixinRecord[name]?style=style.replace(apply[i],mixinRecord[name]):console.warn("IoElement: cound not find mixin:",name)}{let styleStripped=style;styleStripped=styleStripped.replace(commentsRegex,""),styleStripped=styleStripped.replace(keyframeRegex,""),styleStripped=styleStripped.replace(mediaQueryRegex,"");const match=styleStripped.match(cssRegex);match&&match.forEach(selector=>{(selector=selector.trim()).startsWith(":host")||(console.warn(localName+': CSS Selector not prefixed with ":host"! This will cause style leakage!'),console.warn(selector))})}style=mixinsString+style.replace(new RegExp(":host","g"),localName);const styleElement=document.createElement("style");styleElement.innerHTML=style,styleElement.setAttribute("id","io-style-"+localName.replace("io-","")),document.head.appendChild(styleElement)}(localName,ioNodeConstructor.prototype._protochain.style),Object.defineProperty(ioNodeConstructor,"vConstructor",{value:function(arg0,arg1){const vDOMElement={tag:localName};return void 0!==arg0&&("string"==typeof arg0||arg0 instanceof Array?vDOMElement.children=arg0:"object"==typeof arg0&&(vDOMElement.props=arg0),void 0!==arg1&&("string"==typeof arg1||arg1 instanceof Array)&&(vDOMElement.children=arg1)),vDOMElement}})}};__decorateClass$c([ReactiveProperty({type:String,value:"immediate"})],IoElement.prototype,"reactivity",2),__decorateClass$c([function Property(initialValue=void 0){return(target,propertyName)=>{const constructor=target.constructor,properties=propertyDecorators.get(constructor)||{};propertyDecorators.set(constructor,properties),properties[propertyName]=initialValue}}(Object)],IoElement.prototype,"$",2),IoElement=__decorateClass$c([Register],IoElement),IoElement.vConstructor;var __defProp$b=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$b=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$4(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$b(target,key,result),result};const NODES={active:/* @__PURE__ */new Set,disposed:/* @__PURE__ */new WeakSet};function hasValueAtOtherProperty(node,prop,value){let found=!1;return node._reactiveProperties.forEach(p=>{p!==prop&&p.value===value&&(found=!0)}),found}let ReactiveNode=class extends Object{static get ReactiveProperties(){return{}}static get Properties(){return{}}static get Listeners(){return{}}constructor(args){super(),this._protochain.init(this),Object.defineProperty(this,"_changeQueue",{enumerable:!1,configurable:!0,value:new ChangeQueue(this)}),Object.defineProperty(this,"_reactiveProperties",{enumerable:!1,configurable:!0,value:/* @__PURE__ */new Map}),Object.defineProperty(this,"_bindings",{enumerable:!1,configurable:!0,value:/* @__PURE__ */new Map}),Object.defineProperty(this,"_eventDispatcher",{enumerable:!1,configurable:!0,value:new EventDispatcher(this)}),Object.defineProperty(this,"_parents",{enumerable:!1,configurable:!0,value:[]}),this.init(),initReactiveProperties(this),initProperties(this),this.applyProperties("object"==typeof args?args:{},!0),NODES.active.add(this),this.ready(),this.dispatchQueue()}applyProperties(props,skipDispatch=!1){for(const name in props)this._reactiveProperties.has(name)?this.setProperty(name,props[name],!0):name.startsWith("@")||(this[name]=props[name],props[name]instanceof Binding&&console.warn(`IoElement: Not a ReactiveProperty! Cannot set binding to "${name}" property on "${this.constructor.name}"`));this._eventDispatcher.applyPropListeners(props),skipDispatch||this.dispatchQueue()}setProperties(props){setProperties(this,props)}setProperty(name,value,debounce2=!1){this._disposed||setProperty(this,name,value,debounce2)}init(){}ready(){}changed(){}get[Symbol.toStringTag](){return this.constructor.name}queue(name,value,oldValue){this._changeQueue.queue(name,value,oldValue)}dispatchQueue(debounce2=!1){dispatchQueue(this,debounce2)}throttle(func,arg,timeout=1){throttle(func,arg,this,timeout)}debounce(func,arg,timeout=1){debounce(func,arg,this,timeout)}onPropertyMutated(event){return onPropertyMutated(this,event)}dispatchMutation(object=this,properties=[]){dispatchMutation(this,object,properties)}bind(name){return bind(this,name)}unbind(name){unbind(this,name)}addEventListener(type,listener,options){this._eventDispatcher.addEventListener(type,listener,options)}removeEventListener(type,listener,options){this._eventDispatcher.removeEventListener(type,listener,options)}dispatch(type,detail=void 0,bubbles=!1,src){this._eventDispatcher.dispatchEvent(type,detail,bubbles,src)}addParent(parent){(parent._isNode||parent._isIoElement)&&this._parents.push(parent)}removeParent(parent){if(!this._disposed&&(parent._isNode||parent._isIoElement)){const index=this._parents.indexOf(parent);-1!==index?this._parents.splice(index,1):console.warn("ReactiveNode.removeParent(): Parent not found!",this,parent)}}dispose(){dispose(this),NODES.active.delete(this),NODES.disposed.add(this)}Register(ioNodeConstructor){Object.defineProperty(ioNodeConstructor.prototype,"_isNode",{enumerable:!1,value:!0,writable:!1}),Object.defineProperty(ioNodeConstructor.prototype,"_isIoElement",{enumerable:!1,value:!1,writable:!1}),Object.defineProperty(ioNodeConstructor.prototype,"_protochain",{value:new ProtoChain(ioNodeConstructor)})}};function initReactiveProperties(node){for(const name in node._protochain.reactiveProperties){Object.defineProperty(node,name,{get:function(){return node._reactiveProperties.get(name).value},set:function(value){node.setProperty(name,value)},configurable:!0,enumerable:!0});const property=new ReactivePropertyInstance(node,node._protochain.reactiveProperties[name]);node._reactiveProperties.set(name,property),property.binding&&property.binding.addTarget(node,name),property.observer.start(property.value),property.value?._isNode&&property.value.addParent(node),node instanceof IoElement&&property.reflect&&void 0!==property.value&&null!==property.value&&node.setAttribute(name,property.value)}}function initProperties(node){for(const name in node._protochain.properties){let initialValue=node._protochain.properties[name];"function"==typeof initialValue?initialValue=new initialValue:initialValue instanceof Array?initialValue=initialValue.slice():"object"==typeof initialValue&&(initialValue=Object.assign({},initialValue)),node[name]=initialValue}}function setProperties(node,props){for(const name in props)node._reactiveProperties.has(name)?node.setProperty(name,props[name],!0):console.warn(`Property "${name}" is not defined`,node);node.dispatchQueue()}function setProperty(node,name,value,debounce2=!1){const prop=node._reactiveProperties.get(name),oldValue=prop.value;if(value!==oldValue){const binding=value instanceof Binding?value:null;if(binding){const oldBinding=prop.binding;return binding!==oldBinding?(oldBinding&&oldBinding.removeTarget(node,name),void binding.addTarget(node,name)):void 0}if(prop.type===NodeArray&&value.constructor===Array){const nodeArray=prop.value;return value.some(item=>!item._isNode)&&console.error(`Node: Property "${name}" should be assigned as an Array of nodes!`,value),nodeArray.constructor!==NodeArray&&console.error(`Node: Property "${name}" should be initialized as a NodeArray!`,nodeArray),void nodeArray.withInternalOperation(()=>{nodeArray.length=0,nodeArray.push(...value),0===value.length&&nodeArray.dispatchMutation()})}hasValueAtOtherProperty(node,prop,oldValue)?prop.observer.observing=!1:(prop.observer.stop(oldValue),oldValue?._isNode&&!oldValue._disposed&&oldValue.removeParent(node)),prop.value=value,hasValueAtOtherProperty(node,prop,value)||(prop.observer.start(value),value?._isNode&&value.addParent(node)),prop.type===String?"string"!=typeof value&&console.warn(`Wrong type of property "${name}". Value: "${value}". Expected type: ${prop.type.name}`,node):prop.type===Number?"number"!=typeof value&&console.warn(`Wrong type of property "${name}". Value: "${value}". Expected type: ${prop.type.name}`,node):prop.type===Boolean?"boolean"!=typeof value&&console.warn(`Wrong type of property "${name}". Value: "${value}". Expected type: ${prop.type.name}`,node):prop.type===Array?value instanceof Array||console.warn(`Wrong type of property "${name}". Value: "${value}". Expected type: ${prop.type.name}`,node):prop.type===Object?value instanceof Array&&console.warn(`Wrong type of property "${name}". Value: "${value}". Expected type: ${prop.type.name}`,node):prop.type===NodeArray?(value instanceof NodeArray||console.error(`Wrong type of property "${name}". Value: "${value}". Expected type: ${prop.type.name}`,node),value.some(item=>!item._isNode)&&console.error(`Wrong type of property "${name}". NodeArray items should be nodes!`,value)):"function"==typeof prop.type&&(value instanceof prop.type||console.warn(`Wrong type of property "${name}". Value: "${value}". Expected type: ${prop.type.name}`,node)),oldValue!==value&&(node.queue(name,value,oldValue),node.dispatchQueue(debounce2))}}function dispatchQueue(node,debounce2=!1){"debounced"===node.reactivity||debounce2||node._changeQueue.dispatching?node.debounce(node._changeQueue.dispatch):"throttled"===node.reactivity?node.throttle(node._changeQueue.dispatch):"immediate"===node.reactivity&&node._changeQueue.dispatch(),-1===["immediate","throttled","debounced"].indexOf(node.reactivity)&&console.warn(`ReactiveNode.dispatchQueue(): Invalid reactivity property value: "${node.reactivity}".\n      Expected one of: "immediate", "throttled", "debounced".`)}function dispatchMutation(node,object,properties){!function isIoObject(value){return"object"==typeof value&&null!==value&&(value._isNode||value._isIoElement)}(object)?node.dispatch("io-object-mutation",{object:object,properties:properties},!1,window):node.dispatch("io-object-mutation",{object:object,properties:properties})}function onPropertyMutated(node,event){const object=event.detail.object;let hasMutated=!1;return node._reactiveProperties.forEach((prop,name)=>{if(prop.observer.observing&&prop.value===object){const handlerName=name+"Mutated";"function"==typeof node[handlerName]&&node[handlerName](event),hasMutated=!0}}),hasMutated}function bind(node,name){return node._reactiveProperties.has(name)||console.warn(`IoGUI Node: cannot bind to ${name} property. Does not exist!`),node._bindings.has(name)||node._bindings.set(name,new Binding(node,name)),node._bindings.get(name)}function unbind(node,name){const binding=node._bindings.get(name);binding&&(binding.dispose(),node._bindings.delete(name));const property=node._reactiveProperties.get(name);property?.binding?.removeTarget(node,name)}function dispose(node){if(node._disposed&&console.warn("ReactiveNode.dispose(): Already disposed!",node.constructor.name),!node._disposed){node._bindings.forEach((binding,name)=>{binding.dispose(),node._bindings.delete(name)}),delete node._bindings,node._changeQueue.dispose(),delete node._changeQueue,node._reactiveProperties.forEach((property,name)=>{property.binding?.removeTarget(node,name),property.observer.stop(property.value),property.observer.dispose()});for(const name in node._protochain.properties)delete node[name];delete node._protochain,node._eventDispatcher.dispose(),delete node._eventDispatcher,delete node._reactiveProperties,node._parents&&(node._parents.length=0,delete node._parents),Object.defineProperty(node,"_disposed",{value:!0})}}__decorateClass$b([ReactiveProperty({type:String,value:"immediate"})],ReactiveNode.prototype,"reactivity",2),ReactiveNode=__decorateClass$b([Register],ReactiveNode);var __defProp$a=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$a=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$3(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$a(target,key,result),result};const localStorage=new class EmulatedLocalStorage{constructor(){Object.defineProperty(this,"store",{value:/* @__PURE__ */new Map}),Object.defineProperty(this,"warned",{value:!1,writable:!0})}get permitted(){try{return"true"===self.localStorage.getItem("Storage:user-permitted")}catch(error){console.warn("Storage: Cannot access localStorage. Check browser privacy settings!"),console.warn(error)}return!1}set permitted(permitted){try{permitted?(console.info("Storage: localStorage permission granted."),this.store.set("Storage:user-permitted",String(permitted)),this.store.forEach((value,key)=>{self.localStorage.setItem(key,String(value)),this.store.delete(key)})):(console.info("Storage: localStorage permission revoked."),self.localStorage.setItem("Storage:user-permitted",String(permitted)),new Map(Object.entries(self.localStorage)).forEach((value,key)=>{this.store.set(key,value)}),self.localStorage.clear())}catch(error){console.warn("Storage: Cannot access localStorage. Check browser privacy settings!"),console.warn(error)}}setItem(key,value){const strValue="object"==typeof value?JSON.stringify(value):String(value);"Storage:user-permitted"!==key?this.permitted?self.localStorage.setItem(key,strValue):(this.store.set(key,strValue),this.warned||this.permitted||(console.warn("Storage: localStorage permission not set."),this.warned=!0)):this.permitted="true"===value}getItem(key){return this.permitted?self.localStorage.getItem(key):this.store.has(key)?this.store.get(key):null}removeItem(key){if(this.permitted)return self.localStorage.removeItem(key);this.store.delete(key)}clear(){if(this.permitted)return self.localStorage.clear();this.store.clear()}},nodes={local:/* @__PURE__ */new Map,hash:/* @__PURE__ */new Map,none:/* @__PURE__ */new Map};let hashValues={},StorageNode=class extends ReactiveNode{constructor(props){if("object"!=typeof props?console.warn("Ivalid Storage arguments!"):("string"==typeof props.key&&props.key||console.warn("Ivalid Storage key!"),props.storage&&-1===["hash","local","none"].indexOf(props.storage)&&console.warn(`Ivalid storage type! ${props.storage}`)),void 0===props.storage&&(props.storage="local"),nodes[props.storage].has(props.key))return nodes[props.storage].get(props.key);{let def,constructor;"object"==typeof props.value&&null!==props.value?(constructor=props.value.constructor,def=JSON.stringify(props.value)):def=props.value,props.default=def;let storedValue=null;switch(props.storage){case"hash":storedValue=function getValueFromHash(key){return hashValues=parseHash(self.location.hash),hashValues[key]||null}(props.key);break;case"local":storedValue=localStorage.getItem("Storage:"+props.key)}if(null!==storedValue)try{const value=JSON.parse(storedValue);props.value=constructor?new constructor(value):value}catch{props.value=storedValue}return super(props),this.binding=this.bind("value"),this.binding.dispose=()=>{this.clearStorage()},"__proto__"!==props.key&&nodes[props.storage].set(props.key,this),this}}dispose(){this.clearStorage(),super.dispose()}clearStorage(){switch(this.storage){case"hash":this.removeValueToHash();break;case"local":localStorage.removeItem("Storage:"+this.key)}const s=this.storage;nodes[s].delete(this.key)}valueMutated(){this.debounce(this.changed)}valueChanged(){this.changed()}changed(){switch(this.storage){case"hash":this.saveValueToHash();break;case"local":this.value===this.default||null===this.value||void 0===this.value?localStorage.removeItem("Storage:"+this.key):"object"!=typeof this.value?"string"==typeof this.value?localStorage.setItem("Storage:"+this.key,`"${this.value}"`):"number"==typeof this.value&&localStorage.setItem("Storage:"+this.key,this.value):localStorage.setItem("Storage:"+this.key,JSON.stringify(this.value))}}removeValueToHash(){hashValues=parseHash(self.location.hash),delete hashValues[this.key];let hashString="";for(const h in hashValues)hashString+=h+"="+hashValues[h]+"&";hashString?(hashString=hashString.slice(0,-1),self.location.hash=hashString):history.replaceState("",document.title,self.location.pathname+self.location.search)}saveValueToHash(){hashValues=parseHash(self.location.hash);const value=this.value;value===this.default||null==value?delete hashValues[this.key]:"string"==typeof value?isNaN(value)?hashValues[this.key]=String(value):hashValues[this.key]='"'+value+'"':"number"==typeof value||"boolean"==typeof value?hashValues[this.key]=String(value):console.warn("Storage: Cannot serialize value to hash!",value);let hashString="";for(const h in hashValues)hashString+=h+"="+hashValues[h]+"&";hashString?(hashString=hashString.slice(0,-1),self.location.hash=hashString):history.replaceState("",document.title,self.location.pathname+self.location.search)}};__decorateClass$a([ReactiveProperty({value:"",type:String})],StorageNode.prototype,"key",2),__decorateClass$a([ReactiveProperty()],StorageNode.prototype,"value",2),__decorateClass$a([ReactiveProperty({value:"local",type:String})],StorageNode.prototype,"storage",2),StorageNode=__decorateClass$a([Register],StorageNode);const Storage=Object.assign(props=>new StorageNode(props).binding,{permit(){localStorage.permitted=!0},unpermit(){localStorage.permitted=!1}});function parseHash(hash){return hash.substring(1).split("&").reduce(function(result,item){const parts=item.split("=");return parts[0]&&parts[1]&&(result[parts[0]]=parts[1].replace(/%22/g,'"').replace(/%20/g," ")),result},{})}function updateAllFromHash(){hashValues=parseHash(self.location.hash);for(const h in hashValues)if(nodes.hash.has(h)){const node=nodes.hash.get(h);try{node.value=JSON.parse(hashValues[h])}catch{node.value=hashValues[h]}}for(const[key,node]of nodes.hash.entries())void 0===hashValues[key]&&(node.value=node.default)}self.addEventListener("hashchange",updateAllFromHash,!1),updateAllFromHash();var __defProp$9=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$9=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$2(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$9(target,key,result),result};const styleElement=document.createElement("style");styleElement.setAttribute("id","io-theme-variables-v0.11"),document.head.appendChild(styleElement);class Color{r;g;b;a;constructor(r,g,b,a){this.r=r,this.g=g,this.b=b,this.a=a}toCss(){const r=Math.floor(255*this.r),g=Math.floor(255*this.g),b=Math.floor(255*this.b);return void 0!==this.a&&1!==this.a?`rgba(${r}, ${g}, ${b}, ${this.a})`:`rgb(${r}, ${g}, ${b})`}}const LIGHT_THEME={spacing:2,spacing2:0,spacing3:0,spacing5:0,spacing8:0,lineHeight:20,fontSize:14,fieldHeight:0,borderRadius:2,borderWidth:1,borderColor:new Color(.2,.2,.2,1),borderColorLight:new Color(.3,.3,.3,1),borderColorStrong:new Color(.6,.6,.6,1),borderColorRed:new Color(1,.35,.15,1),borderColorGreen:new Color(.1,.7,.2,1),borderColorBlue:new Color(.2,.4,.95,1),bgColor:new Color(.85,.85,.85,1),bgColorStrong:new Color(.9,.9,.9,1),bgColorLight:new Color(.8,.8,.8,1),bgColorRed:new Color(1,.5,.3,1),bgColorGreen:new Color(.2,.9,.3,1),bgColorBlue:new Color(.2,.5,.9,1),bgColorInput:new Color(.95,.96,.95,1),color:new Color(.25,.25,.2,1),colorStrong:new Color(0,0,0,1),colorLight:new Color(.6,.6,.6,1),colorRed:new Color(1,.2,0,1),colorGreen:new Color(0,.6,.1,1),colorBlue:new Color(.2,.3,1,1),colorWhite:new Color(1,1,1,1),colorInput:new Color(0,.05,.02,1),gradientColorStart:new Color(.9,.9,.9,1),gradientColorEnd:new Color(.75,.75,.75,1),shadowColor:new Color(0,0,0,.2)},DARK_THEME={spacing:2,spacing2:0,spacing3:0,spacing5:0,spacing8:0,lineHeight:20,fontSize:14,fieldHeight:0,borderRadius:2,borderWidth:1,borderColor:new Color(.5,.5,.5,1),borderColorLight:new Color(.3,.3,.3,1),borderColorStrong:new Color(0,0,0,1),borderColorRed:new Color(1,.2,0,1),borderColorBlue:new Color(.4,.5,.9,1),borderColorGreen:new Color(0,.6,.1,1),bgColor:new Color(.2,.2,.2,1),bgColorStrong:new Color(.15,.15,.15,1),bgColorLight:new Color(.25,.25,.25,1),bgColorRed:new Color(.7,.2,.1,1),bgColorGreen:new Color(.1,.5,.2,1),bgColorBlue:new Color(.2,.4,.8,1),bgColorInput:new Color(.02,.02,.02,1),color:new Color(.6,.6,.6,1),colorStrong:new Color(.86,.86,.86,1),colorLight:new Color(.3,.3,.3,1),colorRed:new Color(1,.4,.4,1),colorGreen:new Color(.4,.95,.3,1),colorBlue:new Color(.6,.9,1,1),colorWhite:new Color(1,1,1,1),colorInput:new Color(.65,.7,.68,1),gradientColorStart:new Color(.45,.45,.45,1),gradientColorEnd:new Color(.2,.2,.2,1),shadowColor:new Color(0,0,0,.2)},$ThemeID=Storage({value:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",storage:"local",key:"theme-v0.11"}),$Themes=Storage({value:{},storage:"local",key:"io-themes-v0.11"});let Theme=class extends ReactiveNode{static get ReactiveProperties(){const props={};for(const p in LIGHT_THEME){const prop=LIGHT_THEME[p];props[p]=prop instanceof Object?{value:prop,type:Color,init:null}:prop}return props}ready(){this.registerTheme("light",LIGHT_THEME),this.registerTheme("dark",DARK_THEME),this.themeIDChanged()}registerTheme(themeID,theme){this.themeDefaults[themeID]=theme,this.setProperty("themeDefaults",JSON.parse(JSON.stringify(this.themeDefaults)),!0),$Themes.value[themeID]=$Themes.value[themeID]||theme,$Themes.value=JSON.parse(JSON.stringify($Themes.value))}reset(){$Themes.value=JSON.parse(JSON.stringify(this.themeDefaults)),this.themeIDChanged()}themeIDChanged(){const values=$Themes.value[this.themeID];for(const p in values)values[p]instanceof Object&&'["r","g","b","a"]'===JSON.stringify(Object.keys(values[p]))&&(values[p]=new Color(values[p].r,values[p].g,values[p].b,values[p].a));this.setProperties(values)}onPropertyMutated(event){return!!super.onPropertyMutated(event)&&(this.changed(),this.dispatchMutation(),!0)}fontSizeChanged(){this.lineHeight=Math.max(this.fontSize,this.lineHeight)}lineHeightChanged(){this.fontSize=Math.min(this.lineHeight,this.fontSize)}changed(){this.fieldHeight=this.lineHeight+2*(this.spacing+this.borderWidth),this.spacing2=2*this.spacing,this.spacing3=3*this.spacing,this.spacing5=5*this.spacing,this.spacing8=8*this.spacing;const propertyVariables=Array.from(Object.keys(LIGHT_THEME)).reduce((result,prop)=>($Themes.value[this.themeID][prop]=this[prop],"object"==typeof this[prop]?`${result}--io_${prop}: ${this[prop].toCss()};\n    `:`${result}--io_${prop}: ${this[prop]}px;\n    `),"");styleElement.innerHTML=`body {\n  ${propertyVariables}\n}\n\n  body {\n    --io_border: var(--io_borderWidth) solid var(--io_borderColor);\n    --io_borderColorInset: var(--io_borderColorStrong) var(--io_borderColorLight) var(--io_borderColorLight) var(--io_borderColorStrong);\n    --io_borderColorOutset: var(--io_borderColorLight) var(--io_borderColorStrong) var(--io_borderColorStrong) var(--io_borderColorLight);\n    --io_gradientOutset: linear-gradient(180deg, var(--io_gradientColorStart), var(--io_gradientColorEnd) 100%);\n    --io_gradientInset: linear-gradient(0deg, var(--io_gradientColorStart), var(--io_gradientColorEnd) 150%);\n    --io_shadow: 2px 2px 6px var(--io_shadowColor), 1px 1px 1px var(--io_shadowColor);\n    --io_shadowInset: 0.75px 0.75px 2px inset var(--io_shadowColor);\n    --io_shadowOutset: 1px 1px 2px var(--io_shadowColor);\n  }\n`,this.debounce(this.onSaveTheme,void 0,60)}onSaveTheme(){$Themes.value=JSON.parse(JSON.stringify($Themes.value))}};__decorateClass$9([ReactiveProperty({type:Object,init:null})],Theme.prototype,"themeDefaults",2),__decorateClass$9([ReactiveProperty({type:String,binding:$ThemeID})],Theme.prototype,"themeID",2),__decorateClass$9([ReactiveProperty("debounced")],Theme.prototype,"reactivity",2),Theme=__decorateClass$9([Register],Theme);const ThemeSingleton=new Theme,glsl_saturate="\n  #ifndef saturate\n    #define saturate(v) clamp(v, 0., 1.)\n  #endif\n",glsl_translate="\n  vec2 translate(vec2 samplePosition, vec2 xy){\n    return samplePosition - vec2(xy.x, xy.y);\n  }\n  vec2 translate(vec2 samplePosition, float x, float y){\n    return samplePosition - vec2(x, y);\n  }\n",glsl_circle="\n  float circle(vec2 samplePosition, float radius){\n    return saturate((length(samplePosition) - radius) * uPxRatio);\n  }\n",glsl_rectangle="\n  float rectangle(vec2 samplePosition, vec2 halfSize){\n    vec2 edgeDistance = abs(samplePosition) - halfSize;\n    float outside = length(max(edgeDistance, 0.));\n    float inside = min(max(edgeDistance.x, edgeDistance.y), 0.);\n    return 1.0 - saturate((outside + inside) * 1000000.0);\n  }\n",glsl_paintDerivativeGrid2D="\n  float paintDerivativeGrid2D(vec2 samplePosition, vec2 gridWidth, float lineWidth) {\n    vec2 sp = samplePosition / gridWidth;\n    float fractx = abs(fract(sp.x - 0.5) - 0.5) * 2.0;\n    float fracty = abs(fract(sp.y - 0.5) - 0.5) * 2.0;\n\n    float sx = ((sp.x - 0.5) - 0.5) * 2.0;\n    float sy = ((sp.y - 0.5) - 0.5) * 2.0;\n    \n    float absx = abs(max(dFdx(sx), dFdy(sx)));\n    float absy = abs(max(dFdy(sy), dFdx(sy)));\n\n    float fadeX = 1.0 - dFdx(sx);\n    float fadeY = 1.0 - dFdy(sx);\n    if (fadeX <= 0.0 || fadeY <= 0.0) return 1.0;\n\n    float linex = fractx / absx - (0.5 * max(uPxRatio, 2.0) * lineWidth - 1.0) - 0.5;\n    float liney = fracty / absy - (0.5 * max(uPxRatio, 2.0) * lineWidth - 1.0) - 0.5;\n\n    return (1.0 - saturate(min(linex, liney)));\n  }\n",glsl_lineVertical="\n  float lineVertical(vec2 samplePosition, float lineWidth) {\n    return (abs(samplePosition.x) * 2.0 > lineWidth) ? 0.0 : 1.0;\n  }\n",glsl_lineHorizontal="\n  float lineHorizontal(vec2 samplePosition, float lineWidth) {\n    return (abs(samplePosition.y) * 2.0 > lineWidth) ? 0.0 : 1.0;\n  }\n",glsl_lineCross2d="\n  float lineCross2d(vec2 samplePosition, float lineWidth) {\n    return (min(abs(samplePosition.x), abs(samplePosition.y)) * 2.0 > lineWidth) ? 0.0 : 1.0;\n  }\n",glsl_checker="\n  float checker(vec2 samplePosition, float size) {\n    vec2 checkerPos = floor(samplePosition / size);\n    float checkerMask = mod(checkerPos.x + mod(checkerPos.y, 2.0), 2.0);\n    return checkerMask;\n  }\n",glsl_checkerX="\n  float checkerX(vec2 samplePosition, float size) {\n    vec2 checkerPos = floor(samplePosition / size);\n    float checkerMask = mod(checkerPos.x, 2.0);\n    return checkerMask;\n  }\n",glsl_checkerY="\n  float checkerY(vec2 samplePosition, float size) {\n    vec2 checkerPos = floor(samplePosition / size);\n    float checkerMask = mod(checkerPos.y, 2.0);\n    return checkerMask;\n  }\n",glsl_compose="\n  vec3 compose(vec3 dst, vec4 src) {\n    return mix(dst, src.rgb, src.a);\n  }\n";var _needsResize,_canvas,_ctx,_vecLengths,_shader,__defProp$8=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__typeError=msg=>{throw TypeError(msg)},__decorateClass$8=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc$1(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$8(target,key,result),result},__accessCheck=(obj,member,msg)=>member.has(obj)||__typeError("Cannot "+msg),__privateGet=(obj,member,getter)=>(__accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),__privateAdd=(obj,member,value)=>member.has(obj)?__typeError("Cannot add the same private member more than once"):member instanceof WeakSet?member.add(obj):member.set(obj,value),__privateSet=(obj,member,value,setter)=>(__accessCheck(obj,member,"write to private field"),member.set(obj,value),value);const canvas=document.createElement("canvas"),gl=canvas.getContext("webgl",{antialias:!1,premultipliedAlpha:!1});gl.getExtension("OES_standard_derivatives"),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.disable(gl.DEPTH_TEST);const positionBuff=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,positionBuff),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,1,0,-1,-1,0,1,-1,0,1,1,0]),gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,null);const uvBuff=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,uvBuff),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,null);const indexBuff=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexBuff),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([3,2,1,3,1,0]),gl.STATIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexBuff);const shadersCache=/* @__PURE__ */new WeakMap;let currentProgram,IoGl=class extends IoElement{constructor(args={}){super(args),__privateAdd(this,_needsResize,!1),__privateAdd(this,_canvas),__privateAdd(this,_ctx),__privateAdd(this,_vecLengths),__privateAdd(this,_shader),__privateSet(this,_canvas,document.createElement("canvas")),this.appendChild(__privateGet(this,_canvas)),__privateSet(this,_ctx,__privateGet(this,_canvas).getContext("2d",{alpha:!0})),__privateSet(this,_vecLengths,{}),this.theme._reactiveProperties.forEach((property,name)=>{property.type===Color&&(__privateGet(this,_vecLengths)["io_"+name]=4)}),this._reactiveProperties.forEach((property,name)=>{const uname="u"+name.charAt(0).toUpperCase()+name.slice(1);property.type===Array&&(__privateGet(this,_vecLengths)[uname]=property.value.length)}),shadersCache.has(this.constructor)?__privateSet(this,_shader,shadersCache.get(this.constructor)):(__privateSet(this,_shader,this.initShader()),shadersCache.set(this.constructor,__privateGet(this,_shader))),gl.linkProgram(__privateGet(this,_shader));const position=gl.getAttribLocation(__privateGet(this,_shader),"position");gl.bindBuffer(gl.ARRAY_BUFFER,positionBuff),gl.vertexAttribPointer(position,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(position);const uv=gl.getAttribLocation(__privateGet(this,_shader),"uv");gl.bindBuffer(gl.ARRAY_BUFFER,uvBuff),gl.vertexAttribPointer(uv,2,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(uv),this.updateThemeUniforms()}static get Style(){return"\n      :host {\n        position: relative;\n        overflow: hidden !important;\n        @apply --unselectable;\n      }\n      :host > canvas {\n        position: absolute;\n        pointer-events: none;\n        image-rendering: pixelated;\n      }\n      :host > span {\n        position: absolute;\n        text-shadow: 0 0 3px var(--io_bgColorStrong), 0 0 3px var(--io_bgColorStrong), 0 0 3px var(--io_bgColorStrong);\n        left: 3px;\n        pointer-events: none;\n        color: var(--io_colorStrong);\n      }\n    "}static get Vert(){return"\n      attribute vec3 position;\n      attribute vec2 uv;\n      varying vec2 vUv;\n\n      void main(void) {\n        vUv = uv;\n        gl_Position = vec4(position, 1.0);\n      }\n\n"}static get GlUtils(){return`\n      ${glsl_saturate}\n      ${glsl_translate}\n      ${glsl_circle}\n      ${glsl_rectangle}\n      ${glsl_paintDerivativeGrid2D}\n      ${glsl_lineVertical}\n      ${glsl_lineHorizontal}\n      ${glsl_lineCross2d}\n      ${glsl_checker}\n      ${glsl_checkerX}\n      ${glsl_checkerY}\n      ${glsl_compose}\n    `}static get Frag(){return"\n      void main(void) {\n        gl_FragColor = io_color;\n      }\n\n"}initPropertyUniform(name,property){switch(property.value.constructor){case Boolean:return"uniform int "+name+";\n";case Number:return"uniform float "+name+";\n";case Array:return __privateGet(this,_vecLengths)[name]=property.value.length,"uniform vec"+property.value.length+" "+name+";\n";case Color:return __privateGet(this,_vecLengths)[name]=4,"uniform vec4 "+name+";\n"}return""}initShader(){let frag="\n    #extension GL_OES_standard_derivatives : enable\n    precision highp float;\n";this.theme._reactiveProperties.forEach((property,name)=>{frag+=this.initPropertyUniform("io_"+name,property)}),frag+="\n",this._reactiveProperties.forEach((property,prop)=>{const name="u"+prop.charAt(0).toUpperCase()+prop.slice(1);frag+=this.initPropertyUniform(name,property)}),frag+=this.constructor.prototype._glUtils;const vertShader=gl.createShader(gl.VERTEX_SHADER);if(gl.shaderSource(vertShader,this.constructor.Vert),gl.compileShader(vertShader),!gl.getShaderParameter(vertShader,gl.COMPILE_STATUS)){const compilationLog=gl.getShaderInfoLog(vertShader);console.error("IoGl [Vertex Shader] "+this.localName+" error:"),console.warn(compilationLog)}const fragShader=gl.createShader(gl.FRAGMENT_SHADER);if(gl.shaderSource(fragShader,frag+this.constructor.Frag),gl.compileShader(fragShader),!gl.getShaderParameter(fragShader,gl.COMPILE_STATUS)){const compilationLog=gl.getShaderInfoLog(fragShader);console.error("IoGl [Frament Shader] "+this.localName+" error:"),console.warn(compilationLog)}const program=gl.createProgram();return gl.attachShader(program,vertShader),gl.attachShader(program,fragShader),program}onResized(){const pxRatio=window.devicePixelRatio,rect=this.getBoundingClientRect(),style=window.getComputedStyle(this),bw=parseInt(style.borderRightWidth)+parseInt(style.borderLeftWidth),bh=parseInt(style.borderTopWidth)+parseInt(style.borderBottomWidth),width=Math.max(0,Math.floor(rect.width-bw)),height=Math.max(0,Math.floor(rect.height-bh));(width!==this.size[0]||height!==this.size[1]||pxRatio!==this.pxRatio)&&(__privateGet(this,_canvas).style.width=Math.floor(width)+"px",__privateGet(this,_canvas).style.height=Math.floor(height)+"px",__privateSet(this,_needsResize,!0),this.setProperties({size:[width,height],pxRatio:pxRatio}))}get ctx(){return __privateGet(this,_ctx)}themeMutated(){this.updateThemeUniforms(),this.debounce(this.onRender)}changed(){this.debounce(this.onRender)}onRender(){const width=Math.floor(this.size[0]*this.pxRatio),height=Math.floor(this.size[1]*this.pxRatio);width&&height&&(this.setShaderProgram(),this._reactiveProperties.forEach((property,name)=>{const uname="u"+name.charAt(0).toUpperCase()+name.slice(1);this.updatePropertyUniform(uname,property)}),__privateGet(this,_needsResize)&&(__privateGet(this,_canvas).width=width,__privateGet(this,_canvas).height=height,__privateSet(this,_needsResize,!1)),canvas.width=width,canvas.height=height,gl.viewport(0,0,width,height),gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT),__privateGet(this,_ctx).clearRect(0,0,width,height),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0),__privateGet(this,_ctx).drawImage(canvas,0,0))}setShaderProgram(){currentProgram!==__privateGet(this,_shader)&&(currentProgram=__privateGet(this,_shader),gl.useProgram(__privateGet(this,_shader)))}updatePropertyUniform(name,property){this.setShaderProgram(),this.setUniform(name,property.value)}updateThemeUniforms(){this.theme._reactiveProperties.forEach((property,name)=>{this.updatePropertyUniform("io_"+name,property)})}setUniform(name,value){const uniform=gl.getUniformLocation(__privateGet(this,_shader),name);if(null===uniform)return;let _c,type=typeof value;switch(value instanceof Array&&(type="array"),type){case"boolean":gl.uniform1i(uniform,value?1:0);break;case"number":gl.uniform1f(uniform,value??1);break;case"object":case"array":switch(_c=[0,1,2,3],"object"==typeof value&&(void 0!==value.x?_c=["x","y","z","w"]:void 0!==value.r?_c=["r","g","b","a"]:void 0!==value.h?_c=["h","s","v","a"]:void 0!==value.c&&(_c=["c","m","y","k"])),__privateGet(this,_vecLengths)[name]){case 2:if(void 0===value){gl.uniform2f(uniform,0,0);break}gl.uniform2f(uniform,value[_c[0]]??1,value[_c[1]]??1);break;case 3:if(void 0===value){gl.uniform3f(uniform,0,0,0);break}gl.uniform3f(uniform,value[_c[0]]??1,value[_c[1]]??1,value[_c[2]]??1);break;case 4:if(void 0===value){gl.uniform4f(uniform,0,0,0,0);break}gl.uniform4f(uniform,value[_c[0]]??1,value[_c[1]]??1,value[_c[2]]??1,value[_c[3]]??1)}}}Register(ioNodeConstructor){super.Register(ioNodeConstructor);let _glUtils="";const constructors=ioNodeConstructor.prototype._protochain.constructors;for(let i=constructors.length;i--;){const constructor=constructors[i],glUtilsProp=Object.getOwnPropertyDescriptor(constructor,"GlUtils");glUtilsProp&&glUtilsProp.get&&(_glUtils+=constructor.GlUtils)}Object.defineProperty(ioNodeConstructor.prototype,"_glUtils",{enumerable:!1,value:_glUtils})}};_needsResize=new WeakMap,_canvas=new WeakMap,_ctx=new WeakMap,_vecLengths=new WeakMap,_shader=new WeakMap,__decorateClass$8([ReactiveProperty({type:ReactiveNode,value:ThemeSingleton})],IoGl.prototype,"theme",2),__decorateClass$8([ReactiveProperty({type:Array,init:[0,0]})],IoGl.prototype,"size",2),__decorateClass$8([ReactiveProperty({type:Number,value:1})],IoGl.prototype,"pxRatio",2),IoGl=__decorateClass$8([Register],IoGl);const nativeVDOMConstructors={};["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","head","header","hgroup","h1","h2","h3","h4","h5","h6","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"].forEach(element=>{nativeVDOMConstructors[element]=function(arg0,arg1){const vDOMElement={tag:element};return void 0!==arg0&&("string"==typeof arg0||arg0 instanceof Array?vDOMElement.children=arg0:"object"==typeof arg0&&(vDOMElement.props=arg0),void 0!==arg1&&("string"==typeof arg1||arg1 instanceof Array)&&(vDOMElement.children=arg1)),vDOMElement}});const{a:a,button:button,div:div,header:header,h1:h1,input:input,label:label,li:li,p:p,section:section,span:span,ul:ul}=nativeVDOMConstructors;var __defProp$7=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass$7=(decorators,target,key,kind)=>{for(var decorator,result=kind>1?void 0:kind?__getOwnPropDesc(target,key):target,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$7(target,key,result),result};let focusRestoreTarget=null,IoOverlay=class extends IoElement{static get Style(){return"\n      :host {\n        display: block;\n        position: fixed;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        right: 0;\n        z-index: 100000;\n        overflow: hidden;\n        pointer-events: none;\n        touch-action: none;\n        background: transparent;\n        @apply --unselectable;\n      }\n      :host[expanded] {\n        background: rgba(0, 0, 0, 0.25);\n        pointer-events: all;\n      }\n      :host > * {\n        position: absolute !important;\n        box-shadow: var(--io_shadow);\n      }\n    "}static get Listeners(){return{pointerdown:["stopPropagation",{passive:!1}],pointermove:["stopPropagation",{passive:!1}],pointerup:"onPointerup",contextmenu:"onContextmenu",mousedown:["stopPropagation",{passive:!1}],mousemove:["stopPropagation",{passive:!1}],mouseup:["stopPropagation",{passive:!1}],touchstart:["stopPropagation",{passive:!1}],touchmove:["stopPropagation",{passive:!1}],touchend:["stopPropagation",{passive:!1}],keydown:["stopPropagation",{passive:!1}],keyup:["stopPropagation",{passive:!1}],focusin:["stopPropagation",{passive:!1}],blur:["stopPropagation",{passive:!1}],scroll:"onScroll",wheel:["onScroll",{passive:!1}]}}constructor(args={}){super(args)}init(){this.expandAsChildren=this.expandAsChildren.bind(this)}stopPropagation(event){event.stopPropagation()}onPointerup(event){event.composedPath()[0]===this&&this.collapse(),event.stopPropagation()}onContextmenu(event){event.preventDefault(),event.stopPropagation()}onScroll(event){event.composedPath()[0]===this&&this.collapse()}onResized(){this.collapse()}appendChild(child){return super.appendChild(child),child.addEventListener("expanded-changed",this.onChildExpandedChanged),this.debounce(this.expandAsChildren),child}removeChild(child){return super.removeChild(child),child.removeEventListener("expanded-changed",this.onChildExpandedChanged),this.debounce(this.expandAsChildren),child}onChildExpandedChanged(){this.debounce(this.expandAsChildren)}collapse(){for(let i=this.children.length;i--;)this.expanded=!1;this.expanded=!1}expandAsChildren(){for(let i=this.children.length;i--;)if(this.children[i].expanded)return void(this.expanded=!0);this.expanded=!1}expandedChanged(){if(!this.expanded){for(let i=this.children.length;i--;)this.children[i].expanded=!1;focusRestoreTarget&&focusRestoreTarget.focus()}}};__decorateClass$7([ReactiveProperty({value:!1,type:Boolean,reflect:!0})],IoOverlay.prototype,"expanded",2),IoOverlay=__decorateClass$7([Register],IoOverlay);const IoOverlaySingleton=new IoOverlay;setTimeout(()=>{document.body.appendChild(IoOverlaySingleton)},100),window.addEventListener("focusin",()=>{focusRestoreTarget=document.activeElement},{capture:!1}),window.addEventListener("blur",()=>{setTimeout(()=>{IoOverlaySingleton.expanded||document.activeElement!==document.body||(focusRestoreTarget=null)})},{capture:!0});let focusBacktrack=/* @__PURE__ */new WeakMap;const backtrackDir={ArrowLeft:"ArrowRight",ArrowRight:"ArrowLeft",ArrowDown:"ArrowUp",ArrowUp:"ArrowDown"};function setFocusBacktrack(element,dir,source){focusBacktrack.set(element,{dir:backtrackDir[dir],source:source})}function getRectDistance(rect1,rect2,dirBias=1){if(rect1.right>rect2.left&&rect2.right>rect1.left&&rect1.bottom>rect2.top&&rect2.bottom>rect1.top)return 0;let dx=0,dy=0;const MIN_DISTANCE=ThemeSingleton.fieldHeight/2;return rect1.right<rect2.left?dx=Math.max(MIN_DISTANCE,rect2.left-rect1.right):rect2.right<rect1.left&&(dx=Math.max(MIN_DISTANCE,rect1.left-rect2.right)),rect1.bottom<rect2.top?dy=Math.max(MIN_DISTANCE,rect2.top-rect1.bottom):rect2.bottom<rect1.top&&(dy=Math.max(MIN_DISTANCE,rect1.top-rect2.bottom)),dx*=dirBias,dy/=dirBias,(dx**2+dy**2)**.5}function getCenterDistance(rect1,rect2,dirBias=1){const c1_x=rect1.x+rect1.width/2,c1_y=rect1.y+rect1.height/2;let dx=c1_x-(rect2.x+rect2.width/2),dy=c1_y-(rect2.y+rect2.height/2);return dx*=dirBias,dy/=dirBias,(dx**2+dy**2)**.5}document.addEventListener("io-focus-to",function onIoFocusTo(event){const src=event.detail.source,srcRect=src.getBoundingClientRect(),cmd=event.detail.command,inoverlay=IoOverlaySingleton.contains(src);let closestElement=src,closestDistance=Infinity,closestCenterDistance=Infinity;const backtrack=focusBacktrack.get(src);if(backtrack&&backtrack.dir===cmd){const source=backtrack.source;let visible=!0;if(source.offsetParent&&source!==src){const sStyle=window.getComputedStyle(source);"visible"===sStyle.visibility&&"none"!==sStyle.display||(visible=!1)}else visible=!1;if(visible)return source.focus(),void setFocusBacktrack(source,cmd,src)}const root=inoverlay?IoOverlaySingleton:document;let focusableCandidates=Array.from(root.querySelectorAll(`[tabIndex="${src.tabIndex||0}"]:not([disabled]):not([inert]):not([hidden])`));const focusableSiblingCandidates=Array.from(src.parentElement.querySelectorAll(`[tabIndex="${src.tabIndex||0}"]:not([disabled]):not([inert]):not([hidden])`));if(focusableCandidates=focusableCandidates.filter(el=>null!==el.offsetParent),focusableCandidates=focusableCandidates.filter(el=>{const style=window.getComputedStyle(el);return"none"!==style.display&&"hidden"!==style.visibility&&"0"!==style.opacity}),"Tab"===cmd){const index=focusableCandidates.indexOf(src);return void(-1!==index&&focusableCandidates[(index+1)%focusableCandidates.length].focus())}if("Home"!==cmd)if("End"!==cmd)if("PageUp"!==cmd)if("PageDown"!==cmd){if(["ArrowLeft","ArrowRight","ArrowDown","ArrowUp"].includes(cmd)){for(let i=focusableCandidates.length;i--;){const candidate=focusableCandidates[i];if(!candidate.offsetParent||candidate===src)continue;const sStyle=window.getComputedStyle(candidate);if("visible"!==sStyle.visibility||"none"===sStyle.display)continue;const rect=candidate.getBoundingClientRect();if("ArrowRight"===cmd&&rect.left<srcRect.right)continue;if("ArrowLeft"===cmd&&rect.right>srcRect.left)continue;if("ArrowDown"===cmd&&rect.top<srcRect.bottom)continue;if("ArrowUp"===cmd&&rect.bottom>srcRect.top)continue;const biasMagnitude=4,dirBias="ArrowLeft"===cmd||"ArrowRight"===cmd?1/biasMagnitude:biasMagnitude,distance=getRectDistance(srcRect,rect,dirBias),centerDistance=getCenterDistance(srcRect,rect,dirBias);distance<closestDistance?(closestDistance=distance,closestCenterDistance=centerDistance,closestElement=candidate):distance===closestDistance&&centerDistance<closestCenterDistance&&(closestCenterDistance=centerDistance,closestElement=candidate)}closestElement!==src&&(closestElement.focus(),setFocusBacktrack(closestElement,cmd,src))}}else focusableSiblingCandidates[focusableSiblingCandidates.length-1].focus();else focusableSiblingCandidates[0].focus();else focusableCandidates[focusableCandidates.length-1].focus();else focusableCandidates[0].focus()});var __defProp$6=Object.defineProperty,__decorateClass$6=(decorators,target,key,kind)=>{for(var decorator,result=void 0,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$6(target,key,result),result};class TodoItemModel extends ReactiveNode{toggle=()=>{this.completed=!this.completed};delete=()=>{this.dispatch("delete-item",{item:this},!0)};toJSON(){return{title:this.title,completed:this.completed}}fromJSON(json){return this.setProperties({title:json.title??"",completed:json.completed??!1}),this}}__decorateClass$6([ReactiveProperty({type:String})],TodoItemModel.prototype,"title"),__decorateClass$6([ReactiveProperty({type:Boolean})],TodoItemModel.prototype,"completed"),Register(TodoItemModel);var __defProp$5=Object.defineProperty;class TodoListModel extends ReactiveNode{static get Listeners(){return{"delete-item":"onDeleteItem"}}onDeleteItem(event){const item=event.path[0],index=this.items.indexOf(item);this.items.splice(index,1)}get filters(){return{all:()=>!0,active:item=>!item.completed,completed:item=>item.completed}}get count(){return this.items.length}get completedCount(){return this.items.filter(item=>item.completed).length}get activeCount(){return this.items.filter(item=>!item.completed).length}get allCompleted(){return this.items.every(item=>item.completed)}constructor(args){(args={...args}).items=args.items.map(item=>new TodoItemModel({...item})),super(args)}completeAll=()=>{this.items.forEach(item=>item.completed=!0)};clearCompleted=()=>{this.items=this.items.filter(item=>!item.completed)};itemsMutated(){this.dispatchMutation()}toJSON(){return{items:this.items.map(item=>item.toJSON())}}fromJSON(json){return this.setProperties({items:json.items.map(item=>new TodoItemModel(item))}),this}}((decorators,target,key)=>{for(var decorator,result=void 0,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);result&&__defProp$5(target,key,result)})([ReactiveProperty({type:NodeArray,init:"this"})],TodoListModel.prototype,"items"),Register(TodoListModel);var __defProp$4=Object.defineProperty;class TodoInput extends IoElement{static get Style(){return"\n    :host {\n      display: contents;\n    }\n    "}constructor(args={}){super(args)}onInputKey(event){if("Enter"===event.key){const inputElement=this.$.input,title=String(inputElement.value).trim();title&&this.model.items.push(new TodoItemModel({title:title,completed:!1})),inputElement.value="",inputElement.focus()}if("Escape"===event.key){const inputElement=this.$.input;inputElement.value="",inputElement.focus()}}changed(){this.render([input({id:"input",class:"new-todo",placeholder:"What needs to be done?","@keyup":this.onInputKey,autofocus:!0})])}}((decorators,target,key)=>{for(var decorator,result=void 0,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);result&&__defProp$4(target,key,result)})([ReactiveProperty({type:TodoListModel})],TodoInput.prototype,"model"),Register(TodoInput);var __defProp$3=Object.defineProperty,__decorateClass$3=(decorators,target,key,kind)=>{for(var decorator,result=void 0,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$3(target,key,result),result};class TodoItem extends IoElement{static get Style(){return"\n    :host {\n      display: contents;\n    }\n    "}$input;_originalTitle;constructor(args={}){super(args)}itemMutated(){this.changed()}changed(){this.render([li({class:"todo "+(this.item.completed?"completed ":"")+(this.editing?"editing":"")},[div({class:"view"},[input({type:"checkbox",class:"toggle",checked:this.item.completed,"@click":this.item.toggle}),label({"@dblclick":this.onStartEdit},this.item.title),button({class:"destroy","@click":this.item.delete})]),input({id:"input-"+this.item.title,class:"edit",value:this.item.title,"@blur":this.onBlur,"@keyup":this.onInputKey})])]),this.$input=this.querySelector("input.edit")}onStartEdit(){this.editing=!0,this._originalTitle=this.item.title,this.$input.focus()}onBlur(){const title=String(this.$input.value).trim();this.item.title=title||this._originalTitle,this.editing=!1}onInputKey(event){const keyboardEvent=event.detail;["Enter","Escape"].includes(keyboardEvent.key)&&this.$input.blur()}}__decorateClass$3([ReactiveProperty({type:TodoItemModel})],TodoItem.prototype,"item"),__decorateClass$3([ReactiveProperty({type:TodoListModel})],TodoItem.prototype,"model"),__decorateClass$3([ReactiveProperty({value:!1})],TodoItem.prototype,"editing"),Register(TodoItem);var __defProp$2=Object.defineProperty,__decorateClass$2=(decorators,target,key,kind)=>{for(var decorator,result=void 0,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$2(target,key,result),result};class TodoList extends IoElement{static get Style(){return"\n      :host {\n        flex-direction: column;\n      }\n    "}constructor(args={}){super(args)}modelMutated(){this.changed()}changed(){const itemsInRoute=this.model.items.filter(this.model.filters[this.route]);this.render([section({class:"main"},[input({type:"checkbox",id:"toggle-all",class:"toggle-all",checked:this.model.allCompleted}),this.model.items.length&&!this.model.allCompleted?label({for:"toggle-all","@click":this.model.completeAll},"Mark all as complete"):null,ul({class:"todo-list"},itemsInRoute.map(item=>{return arg0={item:item,model:this.model},TodoItem.vConstructor(arg0);var arg0}))])])}}__decorateClass$2([ReactiveProperty({type:TodoListModel})],TodoList.prototype,"model"),__decorateClass$2([ReactiveProperty({value:"all"})],TodoList.prototype,"route"),Register(TodoList);const todoList=function(arg0){return TodoList.vConstructor(arg0)};var __defProp$1=Object.defineProperty,__decorateClass$1=(decorators,target,key,kind)=>{for(var decorator,result=void 0,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$1(target,key,result),result};class TodoFooter extends IoElement{static get Style(){return"\n      :host a {\n        cursor: pointer;\n      }\n    "}constructor(args={}){super(args)}onRouteClicked(event){const target=event.target;this.route=target.innerText.toLowerCase()}modelMutated(){this.changed()}changed(){this.render([span({class:"todo-count"},String(this.model.activeCount)+(1===this.model.activeCount?" item":" items")+" left"),ul({class:"filters"},[li([a({"@click":this.onRouteClicked,class:"all"===this.route?"selected":""},"All")]),li([a({"@click":this.onRouteClicked,class:"active"===this.route?"selected":""},"Active")]),li([a({"@click":this.onRouteClicked,class:"completed"===this.route?"selected":""},"Completed")])]),this.model.completedCount?button({class:"clear-completed","@click":this.model.clearCompleted},"Clear completed"):null])}}__decorateClass$1([ReactiveProperty({type:TodoListModel})],TodoFooter.prototype,"model"),__decorateClass$1([ReactiveProperty({value:"all"})],TodoFooter.prototype,"route"),Register(TodoFooter);const todoFooter=function(arg0){return TodoFooter.vConstructor(arg0)};var __defProp=Object.defineProperty,__decorateClass=(decorators,target,key,kind)=>{for(var decorator,result=void 0,i=decorators.length-1;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp(target,key,result),result};Storage.permit();const $route=Storage({key:"route",storage:"hash",value:"all"}),$model=Storage({key:"model",storage:"local",value:new TodoListModel({items:[]})});class TodoApp extends IoElement{ready(){this.changed()}modelMutated(){this.changed()}changed(){var arg0;this.render([section({class:"todoapp"},[header({class:"header"},[h1("todos"),(arg0={model:this.model},TodoInput.vConstructor(arg0))]),todoList({class:"todo-list",model:this.model,route:this.route}),this.model.count?todoFooter({class:"footer",model:this.model,route:this.bind("route")}):null]),div({class:"info"},[p("Double-click to edit a todo"),p([span("Created with "),a({href:"https://iogui.dev",target:"_blank"},"Io-Gui")]),p([span("Part of "),a({href:"http://todomvc.com/",target:"_blank"},"TodoMVC")])])])}}__decorateClass([ReactiveProperty($model)],TodoApp.prototype,"model"),__decorateClass([ReactiveProperty($route)],TodoApp.prototype,"route"),Register(TodoApp);
//# sourceMappingURL=index.js.map
