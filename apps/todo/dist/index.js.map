{"version":3,"file":"index.js","sources":["../../../packages/core/src/core/Binding.ts","../../../packages/core/src/core/ChangeQueue.ts","../../../packages/core/src/core/EventDispatcher.ts","../../../packages/core/src/core/NodeArray.ts","../../../packages/core/src/core/ReactiveProperty.ts","../../../packages/core/src/decorators/Property.ts","../../../packages/core/src/decorators/Style.ts","../../../packages/core/src/core/ProtoChain.ts","../../../packages/core/src/core/Queue.ts","../../../packages/core/src/vdom/VDOM.ts","../../../packages/core/src/decorators/Register.ts","../../../packages/core/src/core/Style.ts","../../../packages/core/src/elements/IoElement.ts","../../../packages/core/src/nodes/ReactiveNode.ts","../../../packages/core/src/nodes/Storage.ts","../../../packages/core/src/nodes/Theme.ts","../../../packages/core/src/elements/IoGL.glsl.ts","../../../packages/core/src/elements/IoGL.ts","../../../packages/core/src/elements/IoNative.ts","../../../packages/core/src/elements/IoOverlay.ts","../../../packages/core/src/utils/Focus.ts","../src/TodoItemModel.ts","../src/TodoListModel.ts","../src/TodoInput.ts","../src/TodoItem.ts","../src/TodoList.ts","../src/TodoFooter.ts","../src/TodoApp.ts"],"sourcesContent":["import { ChangeEvent } from './ChangeQueue.js'\nimport { ReactiveNode } from '../nodes/ReactiveNode.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: Improve types!\ntype Properties = string[]\ntype TargetProperties = WeakMap<ReactiveNode | IoElement, Properties>\n\n// This helper checks if both values are NaN because NaN === NaN is false.\nconst bothAreNaNs = function(value: any, oldValue: any) {\n  return typeof value === 'number' && isNaN(value) && typeof oldValue === 'number' && isNaN(oldValue)\n}\n\nconst isTypeCompatible = (type1: any, type2: any) => {\n  // Handle primitive types\n  if (type1 === type2) return true\n  // Handle class inheritance\n  if (typeof type1 === 'function' && typeof type2 === 'function') {\n    return type1.prototype instanceof type2 || type2.prototype instanceof type1\n  }\n  return false\n}\n/**\n * This class is used internally by the framework to enable two-way data synchronization between reactive properties.\n * It manages bindings between a source node's reactive property and one or more target nodes and reactive properties.\n * It uses hub-and-spoke pub/sub event system and maintains data consistency by automatically propagating changes to all bound nodes and properties.\n *\n * Key features:\n * - Listens for `[propName]-changed` events to detect changes\n * - Supports one-to-many property bindings\n * - Prevents circular update loops\n * - Automatically cleans up listeners when disposed\n *\n * @example\n * const binding = new Binding(nodeA, 'value');\n * binding.addTarget(nodeB, 'value');\n */\nexport class Binding {\n  readonly node: ReactiveNode | IoElement\n  readonly property: string\n  readonly targets: Set<ReactiveNode | IoElement> = new Set()\n  readonly targetProperties: TargetProperties = new WeakMap()\n  /**\n   * Creates a binding object for specified source `node` and `property`.\n   * It attaches a `[propName]-changed` listener to the source node.\n   * @param {ReactiveNode | IoElement} node - Source node\n   * @param {string} property - Name of the sourceproperty\n   */\n  constructor(node: ReactiveNode | IoElement, property: string) {\n    debug: {\n      if (!(node as ReactiveNode)._isNode && !(node as IoElement)._isIoElement) console.warn('Source node is not a ReactiveNode or IoElement instance!')\n      if (!node._reactiveProperties.has(property)) console.warn(`Source node does not have a reactive property \"${property}\"!`)\n    }\n    this.node = node\n    this.property = property\n    this.onSourceChanged = this.onSourceChanged.bind(this)\n    this.onTargetChanged = this.onTargetChanged.bind(this)\n    this.node.addEventListener(`${this.property}-changed`, this.onSourceChanged)\n  }\n  set value(value: any) {\n    (this.node as any)[this.property] = value\n  }\n  get value(): any {\n    return (this.node as any)[this.property]\n  }\n  /**\n   * Adds a target node and property.\n   * Sets itself as the binding reference on the target `ReactivePropertyInstance`.\n   * Adds a `[propName]-changed` listener to the target node.\n   * @param {ReactiveNode | IoElement} target - Target node\n   * @param {string} property - Target property\n   */\n  addTarget(target: ReactiveNode | IoElement, property: string) {\n    const targetProps = this.getTargetProperties(target)\n\n    debug: {\n      if (!(target as ReactiveNode)._isNode && !(target as IoElement)._isIoElement) console.warn('Target node is not a ReactiveNode or IoElement instance!')\n      if (!target._reactiveProperties.has(property)) console.warn(`Target node does not have a reactive property \"${property}\"!`)\n      if (targetProps.indexOf(property) !== -1) console.error(`Target property \"${property}\" already added!`)\n    }\n\n    if (!this.targets.has(target)) this.targets.add(target)\n    if (targetProps.indexOf(property) === -1) {\n      targetProps.push(property)\n\n      const targetP = target._reactiveProperties.get(property)!\n      if (targetP.binding && targetP.binding !== this) {\n        debug: {\n          console.warn('Improper usage detected!')\n          console.info('Target property is already a target of another binding. Undinding previous binding!')\n        }\n        targetP.binding.removeTarget(target, property)\n      }\n      targetP.binding = this\n\n      debug: {\n        const srcP = this.node._reactiveProperties.get(this.property)!\n        const valueMismatch = srcP.value !== undefined && targetP.value !== undefined && typeof srcP.value !== typeof targetP.value\n        const typeMismatch = srcP.type !== undefined && targetP.type !== undefined && !isTypeCompatible(srcP.type, targetP.type)\n        if (valueMismatch || typeMismatch) {\n          console.warn(`Source property \"${this.property}\" does not match type of target property \"${property}\"!`)\n          console.info(`Source \"${this.property}\" value: ${srcP.value} type: ${srcP.type} typeof: ${typeof srcP.value}`)\n          console.info(`Target \"${property}\" value: ${targetP.value} type: ${targetP.type} typeof: ${typeof targetP.value}`)\n        }\n      }\n\n      target.addEventListener(`${property}-changed`, this.onTargetChanged)\n      target.setProperty(property, this.value, true)\n    }\n  }\n  /**\n   * Removes target node and property.\n   * If `property` is not specified, it removes all target properties.\n   * Removes binding reference from the target `ReactivePropertyInstance`.\n   * Removes `[propName]-changed` listener from the target node.\n   * @param {ReactiveNode | IoElement} target - Target node\n   * @param {string} property - Target property\n   */\n  removeTarget(target: ReactiveNode | IoElement, property?: string) {\n    const targetProperties = this.getTargetProperties(target)\n\n    if (property) {\n\n      const i = targetProperties.indexOf(property)\n      debug: if (i === -1) {\n        console.error('Target property not found!')\n      }\n      targetProperties.splice(i, 1)\n\n      const propertyInstance = target._reactiveProperties.get(property)!\n      debug: if (propertyInstance.binding !== this) {\n        console.error('Target property has a different binding!')\n      }\n      propertyInstance.binding = undefined\n      target.removeEventListener(`${property}-changed`, this.onTargetChanged)\n\n    } else {\n\n      for (let i = targetProperties.length; i--;) {\n        const prop = targetProperties[i]\n        const propertyInstance = target._reactiveProperties.get(prop)!\n        debug: if (propertyInstance.binding !== this) {\n          console.error('Target property has a different binding!')\n        }\n        propertyInstance.binding = undefined\n        target.removeEventListener(`${prop}-changed`, this.onTargetChanged)\n      }\n      targetProperties.length = 0\n\n    }\n\n    if (targetProperties.length === 0) this.targets.delete(target)\n  }\n  /**\n   * Event handler that updates source property when one of the targets emits `[propName]-changed` event.\n   * @param {ChangeEvent} event - Property change event.\n   */\n  onTargetChanged(event: ChangeEvent){\n    debug: if (!this.targets.has(event.target as ReactiveNode | IoElement)) {\n      console.error('onTargetChanged() should never fire if target is not accounted for!')\n    }\n    const oldValue = this.value\n    const value = event.detail.value\n    if (oldValue !== value) {\n      if (bothAreNaNs(value, oldValue)) return;\n      (this.node as any)[this.property] = value\n    }\n  }\n  /**\n   * Event handler that updates bound properties on target nodes when source node emits `[propName]-changed` event.\n   * @param {ChangeEvent} event - Property change event.\n   */\n  onSourceChanged(event: ChangeEvent) {\n    debug: if (event.target !== this.node) {\n      console.error('onSourceChanged() should always originate form source node!')\n    }\n    const value = event.detail.value\n    for (const target of this.targets) {\n      const targetProperties = this.getTargetProperties(target)\n      for (let j = targetProperties.length; j--;) {\n        const propName = targetProperties[j]\n        const oldValue = (target as any)[propName]\n        if (oldValue !== value) {\n          if (bothAreNaNs(value, oldValue)) continue;\n          (target as any)[propName] = value\n        }\n      }\n    }\n  }\n  /**\n   * Returns a list of target properties for specified target node.\n   * @param {ReactiveNode | IoElement} target - Target node.\n   * @return {Properties} list of target property names.\n   */\n  getTargetProperties(target: ReactiveNode | IoElement): Properties {\n    if (!this.targetProperties.has(target)) this.targetProperties.set(target, [])\n    return this.targetProperties.get(target)!\n  }\n  /**\n   * Returns a JSON representation of the binding.\n   * This is required for `JSON.stringify(protoProperties)` in `ProtoChain`.\n   * @return {string} JSON representation of the binding.\n   */\n  toJSON() {\n    const targetProperties: Properties[] = []\n    const targetNames: string[] = []\n    for (const target of this.targets) {\n      targetNames.push(target.constructor.name)\n      targetProperties.push(this.getTargetProperties(target))\n    }\n    return {\n      node: this.node.constructor.name,\n      property: this.property,\n      targets: targetNames,\n      targetProperties: targetProperties,\n    }\n  }\n  /**\n   * Disposes the binding and removes all targets and listeners.\n   */\n  dispose() {\n    this.node.removeEventListener(`${this.property}-changed`, this.onSourceChanged)\n    for (const target of this.targets) {\n      this.removeTarget(target)\n    }\n    this.targets.clear()\n    delete (this as any).node\n    delete (this as any).property\n    delete (this as any).targets\n    delete (this as any).targetProperties\n  }\n}\n","import { ReactiveNode } from '../nodes/ReactiveNode.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: Improve types!\n\nexport interface Change<T = any> {\n  property: string\n  value: T\n  oldValue: T\n}\n\nexport interface Changes {\n  [property: string]: Change\n}\n\nexport interface ChangeEvent extends Omit<CustomEvent<Change>, 'target'> {\n  readonly target: ReactiveNode | IoElement\n  readonly detail: Change\n  readonly path: ReactiveNode[]\n}\n\n/**\n * This class is used internally by the framework to manage property changes in `ReactiveNode` and `IoElement` nodes.\n *\n * This class implements a First-In-First-Out (FIFO) queue that:\n * - Collects property changes and their associated values\n * - Coalesces multiple changes to the same property\n * - Dispatches change events (e.g., '[propName]-changed')\n * - Invokes corresponding change handlers (e.g., [propName]Changed())\n * - Triggers a final 'changed()' handler after processing all changes\n * - Triggers a final 'dispatchMutation()' handler after processing all changes\n *\n * The queue helps optimize performance by batching multiple property changes\n * and preventing redundant updates when the same property changes multiple\n * times within a single execution cycle.\n *\n * @example\n * const node = new ReactiveNode();\n * const changeQueue = new ChangeQueue(node);\n * changeQueue.queue('prop1', 1, 0);\n * changeQueue.queue('prop1', 2, 1);\n * changeQueue.dispatch();\n */\nexport class ChangeQueue {\n  declare readonly node: ReactiveNode | IoElement\n  declare changes: Change[]\n  dispatchedChange = false\n  dispatching = false\n  /**\n   * Creates change queue for the specified owner instance of `ReactiveNode`.\n   * @param {ReactiveNode} node - Owner node.\n   */\n  constructor(node: ReactiveNode | IoElement) {\n    this.changes = []\n    this.node = node\n    Object.defineProperty(this, 'dispatch', {\n      value: this.dispatch.bind(this),\n      enumerable: false,\n      writable: false,\n      configurable: false,\n    })\n  }\n  /**\n   * Adds property change payload to the queue by specifying property name, previous and the new value.\n   * If the change is already in the queue, the new value is updated in-queue.\n   * If the new value is the same as the original value, the change is removed from the queue.\n   * @param {string} property - Property name.\n   * @param {any} value Property value.\n   * @param {any} oldValue Old property value.\n   */\n  queue(property: string, value: any, oldValue: any) {\n    debug: if (value === oldValue) {\n      console.warn('ChangeQueue: queuing change with same value and oldValue!')\n    }\n    const i = this.changes.findIndex(change => change.property === property)\n    if (i === -1) {\n      this.changes.push({property, value, oldValue})\n    } else if (value === this.changes[i].oldValue) {\n      this.changes.splice(i, 1)\n    } else {\n      this.changes[i].value = value\n    }\n  }\n  /**\n   * Dispatches and clears the queue.\n   * For each property change in the queue:\n   *  - It executes node's `[propName]Changed(change)` change handler function if it is defined.\n   *  - It fires the `'[propName]-changed'` `ChangeEvent` from the owner node with `Change` data as `event.detail`.\n   * After all changes are dispatched it invokes `.changed()` function of the owner node instance and fires `'changed'` event.\n   */\n  dispatch() {\n    if (this.dispatching === true) {\n      debug: console.error('ChangeQueue: dispatching already in progress!')\n      return\n    }\n    this.dispatching = true\n    const properties = []\n    let i = 0\n    while (i < this.changes.length) {\n      const change = this.changes[i]\n      const property = change.property\n      if (change.value !== change.oldValue) {\n        this.dispatchedChange = true\n        const handlerName = property + 'Changed'\n        if ((this.node as any)[handlerName]) {\n          try {\n            (this.node as any)[handlerName](change)\n          } catch (error) {\n            console.error(`Error in ${this.node.constructor.name}.${handlerName}():`, error)\n          }\n        }\n        this.node.dispatch(property + '-changed' as any, change)\n        properties.push(property)\n      }\n      i++\n    }\n    this.changes.length = 0\n    if (this.dispatchedChange) {\n      try {\n        this.node.changed()\n      } catch (error) {\n        console.error(`Error in ${this.node.constructor.name}.changed():`, error)\n      }\n      if ((this.node as ReactiveNode)._isNode) {\n        (this.node as ReactiveNode).dispatchMutation(this.node, properties)\n      }\n    }\n    this.dispatchedChange = false\n    this.dispatching = false\n  }\n  /**\n   * Clears the queue and removes the node reference for garbage collection.\n   * Use this when node queue is no longer needed.\n   */\n  dispose() {\n    this.changes.length = 0\n    delete (this as any).node\n    delete (this as any).changes\n  }\n}","import { ChangeEvent } from './ChangeQueue.js'\nimport { ReactiveNode } from '../nodes/ReactiveNode.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: Improve types!\n\n/**\n * Event listener types.\n */\nexport interface KeyboardEventListener { (event: KeyboardEvent): void }\nexport interface PointerEventListener { (event: PointerEvent): void }\nexport interface CustomEventListener { (event: CustomEvent): void }\nexport interface FocusEventListener { (event: FocusEvent): void }\nexport interface TouchEventListener { (event: TouchEvent): void }\nexport interface ChangeEventListener { (event: ChangeEvent): void }\nexport interface IoEventListener { (event: {detail: any; target: ReactiveNode | IoElement | EventTarget; path: Array<ReactiveNode | IoElement | EventTarget>}): void }\nexport type AnyEventListener = EventListener |\n                               KeyboardEventListener |\n                               PointerEventListener |\n                               CustomEventListener |\n                               FocusEventListener |\n                               TouchEventListener |\n                               ChangeEventListener |\n                               IoEventListener |\n                               EventListenerOrEventListenerObject\n/**\n * Listener definition type.\n * The first item is a string (function name) or an event listener function.\n * The second item is an optional object of event listener options.\n */\nexport type ListenerDefinition = [string | AnyEventListener, AddEventListenerOptions?]\n\n/**\n * Loose listener definition type.\n * It can be a string (function name), an event AnyEventListener function or a ListenerDefinition array.\n */\nexport type ListenerDefinitionLoose = string | AnyEventListener | ListenerDefinition\n\nexport type Listener = [AnyEventListener, AddEventListenerOptions?]\nexport type Listeners = Record<string, Listener[]>\n\n/**\n * Converts a loose listener definition into a strongly typed ListenerDefinition array format.\n * This ensures consistent handling of listeners regardless of how they were initially defined.\n *\n * @param {ListenerDefinitionLoose} listenerDefinition - Loosely typed listener definition\n * @return {ListenerDefinition} Normalized listener definition in [string | listener, options?] format\n */\nexport const hardenListenerDefinition = (listenerDefinition: ListenerDefinitionLoose): ListenerDefinition => {\n  return Array.isArray(listenerDefinition) ? listenerDefinition : [listenerDefinition]\n}\n\nconst LISTENER_OPTIONS = ['capture', 'passive']\n\n/**\n * Converts a listener definition into a normalized Listener tuple.\n * If the first item is a string, it looks up the method on the node.\n *\n * @param {ReactiveNode | IoElement | EventTarget} node - The node instance containing potential method references\n * @param {ListenerDefinition} def - The listener definition to normalize\n * @return {Listener} Normalized [listener, options?] tuple\n */\nexport const listenerFromDefinition = (node: ReactiveNode | IoElement | EventTarget, def: ListenerDefinition): Listener => {\n  const handlerDef = def[0]\n  const options = def[1]\n\n  debug: {\n    if (typeof handlerDef !== 'string' && typeof handlerDef !== 'function') {\n      console.error('listenerFromDefinition: Listener must be a function or method name')\n    }\n    if (options) {\n      if (typeof options !== 'object') {\n        console.error('listenerFromDefinition: Listener options must be an object')\n      } else {\n        const invalidOptions = Object.keys(options).filter(k => !LISTENER_OPTIONS.includes(k))\n        if (invalidOptions.length > 0) {\n          console.error(`listenerFromDefinition: Invalid listener options: ${invalidOptions.join(', ')}`)\n        }\n      }\n    }\n    if (typeof handlerDef === 'string' && !(handlerDef in node)) {\n      console.error(`listenerFromDefinition: Method \"${handlerDef}\" not found on node`)\n    }\n  }\n\n  const handler = typeof handlerDef === 'string' ? (node as unknown as Record<string, AnyEventListener>)[handlerDef] : handlerDef\n\n  return options ? [handler, options] : [handler]\n}\n\n/**\n * Internal utility class responsible for handling listeners and dispatching events.\n * It makes events of all `ReactiveNode` class instances compatible with DOM events.\n * It maintains three independent lists of listeners:\n *  - `protoListeners` specified as `get Listeners()` return value of class.\n *  - `propListeners` specified as inline properties prefixed with \"@\".\n *  - `addedListeners` explicitly added/removed using `addEventListener()` and `removeEventListener()`.\n */\nexport class EventDispatcher {\n  readonly node: ReactiveNode | IoElement | EventTarget\n  readonly nodeIsEventTarget: boolean\n  readonly protoListeners: Listeners = {}\n  readonly propListeners: Listeners = {}\n  readonly addedListeners: Listeners = {}\n  /**\n   * Creates an instance of `EventDispatcher` for specified `ReactiveNode` instance.\n   * It initializes `protoListeners` from `ProtoChain`.\n   * @param {ReactiveNode | IoElement | EventTarget} node owner ReactiveNode\n   */\n  constructor(node: ReactiveNode | IoElement | EventTarget) {\n    this.node = node\n    this.nodeIsEventTarget = node instanceof EventTarget\n    this.setProtoListeners(node as ReactiveNode)\n  }\n\n  /**\n   * Sets `protoListeners` specified as `get Listeners()` class definitions.\n   * Definitions from subclass replace the ones from parent class.\n   * @param {ReactiveNode | IoElement} node owner ReactiveNode\n   */\n  setProtoListeners(node: ReactiveNode | IoElement) {\n    for (const name in node._protochain?.listeners) {\n      for (let i = 0; i < node._protochain.listeners[name].length; i++) {\n        const listener = listenerFromDefinition(node, node._protochain.listeners[name][i])\n        this.protoListeners[name] = [listener]\n      }\n      if (this.nodeIsEventTarget && this.protoListeners[name]) {\n        const listener = this.protoListeners[name][0]\n        EventTarget.prototype.addEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n      }\n    }\n  }\n  /**\n   * Sets `propListeners` specified as inline properties prefixed with \"@\".\n   * It removes existing `propListeners` that are no longer specified and it replaces the ones that changed.\n   * @param {Record<string, any>} properties - Inline properties\n   */\n  applyPropListeners(properties: Record<string, any>) {\n    // Create and object with new listeners\n    const newPropListeners: Listeners = {}\n    for (const prop in properties) {\n      if (!prop.startsWith('@')) continue\n\n      const name = prop.slice(1)\n      const definition = hardenListenerDefinition(properties[prop])\n      const listener = listenerFromDefinition(this.node, definition)\n      newPropListeners[name] = [listener]\n    }\n\n    // Remove listeners that are no longer specified\n    const propListeners = this.propListeners\n    for (const name in propListeners) {\n      if (!newPropListeners[name]) {\n        if (this.nodeIsEventTarget) {\n          const listener = propListeners[name][0]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n        delete propListeners[name]\n      }\n    }\n\n    // Add new listeners and remove old ones if they are different\n    for (const name in newPropListeners) {\n      if (this.nodeIsEventTarget) {\n        const newListener = newPropListeners[name][0]\n        if (propListeners[name]) {\n          const oldListener = propListeners[name][0]\n          if ((oldListener !== newListener || newListener[1] && (JSON.stringify(oldListener[1]) !== JSON.stringify(newListener[1])))) {\n            EventTarget.prototype.removeEventListener.call(this.node, name, oldListener[0] as EventListener, oldListener[1])\n          }\n        }\n        EventTarget.prototype.addEventListener.call(this.node, name, newListener[0] as EventListener, newListener[1])\n      }\n      propListeners[name] = newPropListeners[name]\n    }\n  }\n  /**\n   * Proxy for `addEventListener` method.\n   * Adds an event listener to the node's `addedListeners` collection.\n   * If the node is an EventTarget, also registers the listener with the DOM.\n   * @param {string} name - Name of the event\n   * @param {AnyEventListener} listener - Event listener handler\n   * @param {AddEventListenerOptions} [options] - Event listener options\n   */\n  addEventListener(name: string, listener: AnyEventListener, options?: AddEventListenerOptions) {\n    debug: {\n      if (typeof listener !== 'function') {\n        console.error('EventDispatcher.addEventListener: Invalid listener type - must be a function')\n      }\n      if (options) {\n        if (typeof options !== 'object') {\n          console.error('EventDispatcher.addEventListener: Invalid listener options type - must be an object')\n        } else {\n          const invalidOptions = Object.keys(options).filter(k => !LISTENER_OPTIONS.includes(k))\n          if (invalidOptions.length > 0) {\n            console.warn(`EventDispatcher.addEventListener: Invalid listener options: ${invalidOptions.join(', ')}`)\n          }\n        }\n      }\n    }\n\n    // Initialize listener array if needed\n    if (!this.addedListeners[name]) {\n      this.addedListeners[name] = []\n    }\n\n    // Check for duplicate listener\n    const existingIndex = this.addedListeners[name].findIndex(l => l[0] === listener)\n    if (existingIndex !== -1) {\n      debug: console.warn(`EventDispatcher.addEventListener: Listener for '${name}' event already added`, this.node)\n      return\n    }\n\n    // Create and store listener tuple\n    const listenerTuple: Listener = options ? [listener, options] : [listener]\n    this.addedListeners[name].push(listenerTuple)\n\n    if (this.nodeIsEventTarget) {\n      EventTarget.prototype.addEventListener.call(this.node, name, listener as EventListener, options)\n    }\n  }\n\n  /**\n   * Proxy for `removeEventListener` method.\n   * Removes an event listener from the node's `addedListeners` collection.\n   * If `listener` is not specified it removes all listeners for specified `type`.\n   * @param {string} name - Name of the event\n   * @param {AnyEventListener} listener - Event listener handler\n   * @param {AddEventListenerOptions} [options] - Event listener options\n  */\n  removeEventListener(name: string, listener?: AnyEventListener, options?: AddEventListenerOptions) {\n    debug: {\n      if (listener && typeof listener !== 'function') {\n        console.error('EventDispatcher.removeEventListener: Invalid listener type!')\n      }\n      if (options) {\n        if (typeof options !== 'object') {\n          console.error('EventDispatcher.removeEventListener: Invalid listener options type - must be an object')\n        } else {\n          const invalidOptions = Object.keys(options).filter(k => !LISTENER_OPTIONS.includes(k))\n          if (invalidOptions.length > 0) {\n            console.warn(`EventDispatcher.removeEventListener: Invalid listener options: ${invalidOptions.join(', ')}`)\n          }\n        }\n\n      }\n      if (!this.addedListeners[name]) {\n        console.error(`EventDispatcher.removeEventListener: Listener ${name} not found!`)\n      }\n    }\n\n    if (!this.addedListeners[name]) return\n\n    if (!listener) {\n      for (let i = 0; i < this.addedListeners[name].length; i ++) {\n        if (this.nodeIsEventTarget) {\n          const listener = this.addedListeners[name][i]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n      }\n      this.addedListeners[name].length = 0\n    } else {\n      const index = this.addedListeners[name].findIndex(item => item[0] === listener)\n      debug: if (index === -1) {\n        console.error(`EventDispatcher.removeEventListener: Listener ${name} not found!`)\n      }\n      if (index !== -1) {\n        this.addedListeners[name].splice(index, 1)\n        if (this.nodeIsEventTarget) {\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener as EventListener, options)\n        }\n      }\n    }\n\n    if (this.addedListeners[name].length === 0) {\n      delete this.addedListeners[name]\n    }\n  }\n  /**\n   * Shorthand for custom event dispatch.\n   * @param {string} name - Name of the event\n   * @param {any} detail - Event detail data\n   * @param {boolean} [bubbles] - Makes event bubble\n   * @param {ReactiveNode | IoElement | EventTarget} [node] - Event target override to dispatch the event from\n   */\n  dispatchEvent(name: string, detail?: any, bubbles = true, node: ReactiveNode | IoElement | EventTarget = this.node, path: Array<ReactiveNode | IoElement | EventTarget> = []) {\n    if ((this.node as ReactiveNode)._disposed) return\n\n    path = [...path, node]\n\n    if ((node instanceof EventTarget)) {\n      EventTarget.prototype.dispatchEvent.call(node, new CustomEvent(name, {detail: detail, bubbles: bubbles, composed: true, cancelable: true}))\n    } else {\n      const payload = {detail: detail, target: node, path: path}\n      if (this.protoListeners[name]) {\n        for (let i = 0; i < this.protoListeners[name].length; i ++) {\n          const handler = this.protoListeners[name][i][0] as IoEventListener\n          handler.call(node, payload)\n        }\n      }\n      if (this.propListeners[name]) {\n        debug: if (this.propListeners[name].length > 1) {\n          console.error(`EventDispatcher.dispathEvent: PropListeners[${name}] array too long!`)\n        }\n        const handler = this.propListeners[name][0][0] as IoEventListener\n        handler.call(node, payload)\n      }\n      if (this.addedListeners[name]) {\n        for (let i = 0; i < this.addedListeners[name].length; i ++) {\n          const handler = this.addedListeners[name][i][0] as IoEventListener\n          handler.call(node, payload)\n        }\n      }\n      if (bubbles) {\n        for (const parent of node._parents) {\n          if (((parent as ReactiveNode)._isNode || (parent as IoElement)._isIoElement) && !parent._disposed) {\n            // TODO: prevent event multiplication when children contain multiple instances of the same node.\n            // TODO: implement stopPropagation() and stopImmediatePropagation()\n            parent._eventDispatcher.dispatchEvent(name, detail, bubbles, parent, path)\n          }\n        }\n      }\n    }\n  }\n  /**\n   * Disconnects all event listeners and removes all references for garbage collection.\n   * Use this when node is discarded.\n   */\n  dispose() {\n    for (const name in this.protoListeners) {\n      if (this.nodeIsEventTarget) {\n        for (let i = 0; i < this.protoListeners[name].length; i++) {\n          const listener = this.protoListeners[name][i]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n      }\n      this.protoListeners[name].length = 0\n      delete this.protoListeners[name]\n    }\n    for (const name in this.propListeners) {\n      if (this.nodeIsEventTarget) {\n        const listener = this.propListeners[name][0]\n        EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n      }\n      this.propListeners[name].length = 0\n      delete this.propListeners[name]\n    }\n    for (const name in this.addedListeners) {\n      if (this.nodeIsEventTarget) {\n        for (let i = this.addedListeners[name].length; i--;) {\n          const listener = this.addedListeners[name][i]\n          EventTarget.prototype.removeEventListener.call(this.node, name, listener[0] as EventListener, listener[1])\n        }\n      }\n      this.addedListeners[name].length = 0\n      delete this.addedListeners[name]\n    }\n    delete (this as any).node\n    delete (this as any).protoListeners\n    delete (this as any).propListeners\n    delete (this as any).addedListeners\n  }\n}","import { ReactiveNode } from '../nodes/ReactiveNode.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: test!!!\nexport class NodeArray<N extends ReactiveNode> extends Array<N> {\n  declare private proxy: typeof Proxy\n  private _isInternalOperation = false\n  private _observers = new Set<ReactiveNode | IoElement>()\n\n  static get [Symbol.species]() { return Array }\n\n  constructor(public node: ReactiveNode | IoElement, ...args: any[]) {\n    super(...args)\n    // TODO: Avoid creating empty NodeArrays in models!\n    // TODO: Test thoroughly! Check initializations with items!\n    // console.log('NodeArray constructor', args);\n    this.itemMutated = this.itemMutated.bind(this)\n    this.dispatchMutation = this.dispatchMutation.bind(this)\n\n    // Owner is the primary observer\n    this._observers.add(node)\n\n    debug: if (!(node as ReactiveNode)._isNode && !(node as IoElement)._isIoElement) {\n      console.error('NodeArray constructor called with non-node!')\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const self = this\n    const proxy = new Proxy(this, {\n      get(target: NodeArray<N>, property: string | symbol) {\n        if (typeof property === 'symbol') {\n          return target[property as any]\n        }\n        const index = Number(property)\n        if (!isNaN(index) && index >= 0) {\n          return target[index]\n        }\n        return target[property as any]\n      },\n      set(target: NodeArray<N>, property: string | symbol, value: any) {\n        if (property === 'length') {\n          if (!self._isInternalOperation) {\n            const oldLength = target.length\n            const newLength = Number(value)\n            if (newLength < oldLength) {\n              for (let i = newLength; i < oldLength; i++) {\n                const item = target[i]\n                if (item._isNode) {\n                  item.removeEventListener('io-object-mutation', self.itemMutated)\n                  item.removeParent(self.node as ReactiveNode)\n                }\n              }\n            } else if (newLength > oldLength) {\n              console.warn('NodeArray: cannot extend array with empty slots')\n              return true\n            }\n          }\n          target[property] = value\n          if (!self._isInternalOperation) self.dispatchMutation()\n          return true\n        }\n        const index = Number(property)\n        if (!isNaN(index) && index >= 0) {\n          // TODO Prevent adding to index greater than length?\n          const oldValue = target[index]\n          if (oldValue !== undefined && oldValue._isNode && !self._isInternalOperation) {\n            oldValue.removeEventListener('io-object-mutation', self.itemMutated)\n            oldValue.removeParent(self.node as ReactiveNode)\n          }\n          target[property as any] = value\n          if (value._isNode && !self._isInternalOperation) {\n            value.addEventListener('io-object-mutation', self.itemMutated)\n            value.addParent(self.node as ReactiveNode)\n          }\n          if (!self._isInternalOperation) self.dispatchMutation()\n          return true\n        }\n        target[property as any] = value\n        return true\n      }\n    })\n    Object.defineProperty(this, 'proxy', {value: proxy, enumerable: false, configurable: false})\n    return proxy\n  }\n  // TODO: test!\n  withInternalOperation<T>(operation: () => T): T {\n    this._isInternalOperation = true\n    try {\n      return operation()\n    } finally {\n      this._isInternalOperation = false\n    }\n  }\n  splice(start: number, deleteCount: number, ...items: N[]): N[] {\n    return this.withInternalOperation(() => {\n      for (let i = start; i < start + deleteCount; i++) {\n        const item = this[i]\n        if (item._isNode) {\n          item.removeEventListener('io-object-mutation', this.itemMutated)\n          item.removeParent(this.node as ReactiveNode)\n        }\n      }\n      const result = super.splice(start, deleteCount, ...items)\n      for (let i = start; i < start + items.length; i++) {\n        const item = this[i]\n        if (item._isNode) {\n          item.addEventListener('io-object-mutation', this.itemMutated)\n          item.addParent(this.node as ReactiveNode)\n        }\n      }\n      if (deleteCount || items.length) this.dispatchMutation()\n      return result\n    })\n  }\n  push(...items: N[]): number {\n    return this.withInternalOperation(() => {\n      const result = super.push(...items)\n      for (const item of items) {\n        if (item._isNode) {\n          item.addEventListener('io-object-mutation', this.itemMutated)\n          item.addParent(this.node as ReactiveNode)\n        }\n      }\n      if (items.length) this.dispatchMutation()\n      return result\n    })\n  }\n  unshift(...items: N[]): number {\n    return this.withInternalOperation(() => {\n      const result = super.unshift(...items)\n      for (const item of items) {\n        if (item._isNode) {\n          item.addEventListener('io-object-mutation', this.itemMutated)\n          item.addParent(this.node as ReactiveNode)\n        }\n      }\n      if (items.length) this.dispatchMutation()\n      return result\n    })\n  }\n  pop(): N | undefined {\n    return this.withInternalOperation(() => {\n      const item = super.pop()\n      if (item !== undefined && item._isNode) {\n        item.removeEventListener('io-object-mutation', this.itemMutated)\n        item.removeParent(this.node as ReactiveNode)\n      }\n      if (item !== undefined) this.dispatchMutation()\n      return item\n    })\n  }\n  shift(): N | undefined {\n    return this.withInternalOperation(() => {\n      const item = super.shift()\n      if (item !== undefined && item._isNode) {\n        item.removeEventListener('io-object-mutation', this.itemMutated)\n        item.removeParent(this.node as ReactiveNode)\n      }\n      if (item !== undefined) this.dispatchMutation()\n      return item\n    })\n  }\n  reverse() {\n    return this.withInternalOperation(() => {\n      const result = super.reverse()\n      if (result.length) this.dispatchMutation()\n      return result\n    })\n  }\n  sort(compareFn?: (a: N, b: N) => number) {\n    return this.withInternalOperation(() => {\n      const result = super.sort(compareFn)\n      if (result.length) this.dispatchMutation()\n      return result\n    })\n  }\n  fill(value: N, start?: number, end?: number): this {\n    return this.withInternalOperation(() => {\n      const len = this.length\n      const relativeStart = start ?? 0\n      const relativeEnd = end ?? len\n\n      const actualStart = relativeStart < 0\n        ? Math.max(len + relativeStart, 0)\n        : Math.min(relativeStart, len)\n      const actualEnd = relativeEnd < 0\n        ? Math.max(len + relativeEnd, 0)\n        : Math.min(relativeEnd, len)\n\n      for (let i = actualStart; i < actualEnd; i++) {\n        const oldItem = this[i]\n        if (oldItem !== undefined && oldItem._isNode) {\n          oldItem.removeEventListener('io-object-mutation', this.itemMutated)\n          oldItem.removeParent(this.node as ReactiveNode)\n        }\n      }\n\n      super.fill(value, actualStart, actualEnd)\n\n      for (let i = actualStart; i < actualEnd; i++) {\n        if (value._isNode) {\n          value.addEventListener('io-object-mutation', this.itemMutated)\n          value.addParent(this.node as ReactiveNode)\n        }\n      }\n\n      if (actualEnd > actualStart) this.dispatchMutation()\n      return this\n    })\n  }\n  copyWithin(target: number, start?: number, end?: number): this {\n    return this.withInternalOperation(() => {\n      const len = this.length\n      const relativeTarget = target\n      const relativeStart = start ?? 0\n      const relativeEnd = end ?? len\n\n      const actualTarget = relativeTarget < 0\n        ? Math.max(len + relativeTarget, 0)\n        : Math.min(relativeTarget, len)\n      const actualStart = relativeStart < 0\n        ? Math.max(len + relativeStart, 0)\n        : Math.min(relativeStart, len)\n      const actualEnd = relativeEnd < 0\n        ? Math.max(len + relativeEnd, 0)\n        : Math.min(relativeEnd, len)\n\n      const count = Math.min(actualEnd - actualStart, len - actualTarget)\n      if (count <= 0) return this\n\n      for (let i = actualTarget; i < actualTarget + count; i++) {\n        const oldItem = this[i]\n        if (oldItem !== undefined && oldItem._isNode) {\n          oldItem.removeEventListener('io-object-mutation', this.itemMutated)\n          oldItem.removeParent(this.node as ReactiveNode)\n        }\n      }\n\n      super.copyWithin(actualTarget, actualStart, actualEnd)\n\n      for (let i = actualTarget; i < actualTarget + count; i++) {\n        const item = this[i]\n        if (item._isNode) {\n          item.addEventListener('io-object-mutation', this.itemMutated)\n          item.addParent(this.node as ReactiveNode)\n        }\n      }\n\n      this.dispatchMutation()\n      return this\n    })\n  }\n  addObserver(node: ReactiveNode | IoElement) {\n    this._observers.add(node)\n  }\n  removeObserver(node: ReactiveNode | IoElement) {\n    this._observers.delete(node)\n  }\n  itemMutated(event: CustomEvent) {\n    for (const observer of this._observers) {\n      observer.dispatch('io-object-mutation', {object: this.proxy, property: event.detail.index})\n    }\n  }\n  dispatchMutation() {\n    for (const observer of this._observers) {\n      observer.dispatch('io-object-mutation', {object: this.proxy})\n    }\n  }\n}","import { Binding } from './Binding.js'\nimport { AnyConstructor, ReactiveNode } from '../nodes/ReactiveNode.js'\nimport { IoElement } from '../elements/IoElement.js'\nimport { NodeArray } from '../core/NodeArray.js'\n\n/**\n * Configuration for a property of a ReactiveNode class.\n * @typedef {Object} ReactivePropertyDefinition\n * @property {*} [value] The property's value. Can be any type unless `type` is specified.\n * @property {AnyConstructor} [type] Constructor function defining the property's type.\n * @property {Binding} [binding] Binding object for two-way data synchronization.\n * @property {boolean} [reflect] Whether to reflect the property to an HTML attribute.\n * @property {*} [init] Initialization arguments for constructing initial value.\n */\nexport type ReactivePropertyDefinition= {\n  value?: any\n  type?: AnyConstructor\n  binding?: Binding\n  reflect?: boolean\n  init?: any\n}\n\n/**\n * Allows loose definition of properties by specifying only partial definitions, such as default value, type or a binding object.\n * @typedef {(string|number|boolean|Array<*>|null|undefined|AnyConstructor|Binding|ReactivePropertyDefinition)} ReactivePropertyDefinitionLoose\n */\nexport type ReactivePropertyDefinitionLoose = string | number | boolean | Array<any> | null | undefined | AnyConstructor | Binding | ReactivePropertyDefinition\n\n/**\n * Instantiates a property definition object from a loosely or strongly typed property definition.\n * It facilitates merging of inherited property definitions from the prototype chain.\n * @class\n * @property {*} [value] The property's value. Can be any type.\n * @property {AnyConstructor} [type] Constructor function defining the property's type.\n * @property {Binding} [binding] Binding object for two-way data synchronization.\n * @property {boolean} [reflect] Whether to reflect the property to an HTML attribute.\n * @property {*} [init] Initialization arguments for constructing initial values.\n */\nexport class ReactiveProtoProperty {\n  declare value?: any\n  declare type?: AnyConstructor\n  declare binding?: Binding\n  declare reflect?: boolean\n  declare init?: any\n  /**\n   * Creates a property definition from various input types.\n   * @param {ReactivePropertyDefinitionLoose} def Input definition which can be:\n   * - `undefined` or `null`: Sets as value\n   * - `AnyConstructor`: Sets as type\n   * - `Binding`: Sets value from binding and stores binding reference\n   * - `ReactivePropertyDefinition`: Copies all defined fields\n   * - Other values: Sets as value\n   * @example\n   * new ReactiveProtoProperty(String) // {type: String}\n   * new ReactiveProtoProperty('hello') // {value: 'hello'}\n   * new ReactiveProtoProperty({value: 42, type: Number}) // {value: 42, type: Number}\n   * new ReactiveProtoProperty(new Binding(node, 'value')) // {value: node.value, binding: ...}\n   */\n  constructor(def: ReactivePropertyDefinitionLoose) {\n    if (def === undefined || def === null) {\n      this.value = def\n    } else if (typeof def === 'function') {\n      this.type = def as AnyConstructor\n    } else if (def instanceof Binding) {\n      this.value = def.value\n      this.binding = def\n    } else if (def && def.constructor === Object) {\n      const d = def as ReactivePropertyDefinition\n      if (Object.hasOwn(d, 'value')) this.value = d.value\n      if (Object.hasOwn(d, 'type')) this.type = d.type\n      if (d.binding instanceof Binding) {\n        this.binding = d.binding\n        this.value = this.binding.value\n      }\n      if (Object.hasOwn(d, 'reflect')) this.reflect = d.reflect\n      if (Object.hasOwn(d, 'init')) this.init = d.init\n    } else if (!(def && def.constructor === Object)) {\n      this.value = def\n    }\n  }\n  /**\n   * Assigns values of another ReactiveProtoProperty to itself, unless they are default values.\n   * @param {ReactiveProtoProperty} protoProp Source ReactiveProtoProperty\n   */\n  assign(protoProp: ReactiveProtoProperty) {\n    if (Object.hasOwn(protoProp, 'value')) this.value = protoProp.value\n    if (Object.hasOwn(protoProp, 'type')) this.type = protoProp.type\n    if (Object.hasOwn(protoProp, 'reflect')) this.reflect = protoProp.reflect\n    if (Object.hasOwn(protoProp, 'init')) this.init = protoProp.init\n    if (Object.hasOwn(protoProp, 'binding')) this.binding = protoProp.binding\n  }\n  /**\n   * Creates a serializable representation of the property definition.\n   * Handles special cases for better JSON serialization:\n   * - Converts object values to their constructor names\n   * - Converts function types to their names\n   * - Only includes defined fields\n   * @returns {object} A plain object suitable for JSON serialization\n   */\n  toJSON() {\n    const json: any = {\n      value: this.value,\n      type: this.type,\n      reflect: this.reflect,\n      init: this.init,\n      binding: this.binding,\n    }\n    if (json.value && typeof json.value === 'object') {\n      json.value = json.value.constructor.name\n    }\n    if (json.type && typeof json.type === 'function') {\n      json.type = json.type.name\n    }\n    return json\n  }\n}\n\nfunction decodeInitArgument(item: any, node: ReactiveNode | IoElement) {\n  if (item === 'this') {\n    return node\n  } else if (typeof item === 'string' && item.startsWith('this.')) {\n    const keys = item.split('.')\n    let target: any = node\n    for (let i = 1; i < keys.length; i++) {\n      target = target[keys[i]]\n    }\n    if (target) return target\n    console.error(`ReactivePropertyInstance: Invalid path ${item}`)\n  } else return item\n}\n\nexport type ObservationType = 'none' | 'io' | 'object' | 'nodearray'\n\nfunction isIoValue(value: any): boolean {\n  return typeof value === 'object' && value !== null && (value._isNode || value._isIoElement)\n}\n\n/**\n * Manages mutation observation state for a reactive property.\n * - 'none': Primitives (String, Number, Boolean) - no mutation observation\n * - 'io': Io types (ReactiveNode, IoElement subclasses) - observe on the value itself\n * - 'nodearray': NodeArray - registers as observer, receives mutations via self-listener\n * - 'object': Non-Io objects (Object, Array, etc.) - observe via window (global event bus)\n */\nexport class Observer {\n  declare private readonly node: ReactiveNode | IoElement\n  declare private _hasSelfMutationListener: boolean\n  declare private _hasWindowMutationListener: boolean\n  type: ObservationType = 'none'\n  observing = false\n\n  constructor(node: ReactiveNode | IoElement) {\n    Object.defineProperty(this, 'node', {enumerable: false, configurable: false, writable: false, value: node})\n    Object.defineProperty(this, '_hasSelfMutationListener', {enumerable: false, configurable: true, writable: true, value: false})\n    Object.defineProperty(this, '_hasWindowMutationListener', {enumerable: false, configurable: true, writable: true, value: false})\n  }\n\n  start(value: any) {\n    if (this.observing) return\n    if (!value || typeof value !== 'object') return\n\n    if (isIoValue(value)) {\n      this.type = 'io'\n      this.observing = true\n      value.addEventListener('io-object-mutation', this.node.onPropertyMutated)\n    } else if (value instanceof NodeArray) {\n      this.type = 'nodearray'\n      this.observing = true\n      // Register this node as an observer of the NodeArray\n      value.addObserver(this.node)\n      // Also need self-listener to handle the dispatched events\n      if (!this._hasSelfMutationListener) {\n        this._hasSelfMutationListener = true\n        this.node.addEventListener('io-object-mutation', this.node.onPropertyMutated)\n      }\n    } else {\n      this.type = 'object'\n      this.observing = true\n      if (!this._hasWindowMutationListener) {\n        this._hasWindowMutationListener = true\n        window.addEventListener('io-object-mutation', this.node.onPropertyMutated as unknown as EventListener)\n      }\n    }\n  }\n\n  stop(value: any) {\n    // TODO: Reconsider\n    // if (!this.observing) return\n    // if (this.type === 'io' && !value._disposed) {\n    if (isIoValue(value) && !value._disposed) {\n      value.removeEventListener('io-object-mutation', this.node.onPropertyMutated)\n    } else if (value instanceof NodeArray) {\n      value.removeObserver(this.node)\n    }\n    this.observing = false\n    // Note: Window and self listeners are removed at dispose time, not here\n  }\n\n  dispose() {\n    if (this._hasSelfMutationListener) {\n      this.node.removeEventListener('io-object-mutation', this.node.onPropertyMutated)\n      this._hasSelfMutationListener = false\n    }\n    if (this._hasWindowMutationListener) {\n      window.removeEventListener('io-object-mutation', this.node.onPropertyMutated as unknown as EventListener)\n      this._hasWindowMutationListener = false\n    }\n  }\n}\n\n/**\n * ReactivePropertyInstance object constructed from `ReactiveProtoProperty`.\n */\nexport class ReactivePropertyInstance {\n  // Property value.\n  value?: any\n  // Constructor of the property value.\n  type?: AnyConstructor\n  // Binding object.\n  binding?: Binding\n  // Reflects to HTML attribute.\n  reflect = false\n  // Initialize property with provided constructor arguments. `null` prevents initialization.\n  init?: any = undefined\n  // Mutation observation state for this property.\n  readonly observer: Observer\n  /**\n   * Creates the property configuration object and copies values from `ReactiveProtoProperty`.\n   * @param node owner ReactiveNode instance\n   * @param propDef ReactiveProtoProperty object\n   */\n  constructor(node: ReactiveNode | IoElement, propDef: ReactiveProtoProperty) {\n    debug: {\n      Object.keys(propDef).forEach(key => {\n        if (['value', 'type', 'reflect', 'init', 'binding'].indexOf(key) === -1) {\n          console.warn(`ReactiveProtoProperty: Invalid field ${key}`)\n        }\n      })\n      if (propDef.type !== undefined) {\n        if (typeof propDef.type !== 'function') console.warn('Incorrect type for \"type\" field')\n      }\n      if (propDef.type === NodeArray && propDef.init !== 'this') {\n        console.warn('NodeArray property should be initialized with \"this\"')\n      }\n      if (propDef.binding !== undefined && propDef.binding.constructor !== Binding) console.warn('Incorrect type for \"binding\" field')\n      if (propDef.reflect !== undefined && typeof propDef.reflect !== 'boolean') console.error(`Invalid reflect field ${propDef.reflect}!`)\n    }\n\n    this.value = propDef.value\n    this.type = propDef.type\n    this.binding = propDef.binding\n    if (typeof propDef.reflect === 'boolean') this.reflect = propDef.reflect\n    if (propDef.init !== undefined) this.init = propDef.init\n\n    if (this.binding instanceof Binding) {\n      this.value = this.binding.value\n    } else if (this.value === undefined) {\n      if (this.type === Boolean) this.value = false\n      else if (this.type === String) this.value = ''\n      else if (this.type === Number) this.value = 0\n      else if (typeof this.type === 'function') {\n        if (this.init !== undefined) {\n          if (this.init instanceof Array) {\n            const args = this.init.map(item => decodeInitArgument(item, node))\n            this.value = new this.type(...args)\n          } else if (this.init instanceof Object) {\n            const args: any = {}\n            Object.keys(this.init).forEach(key => {\n              args[key] = decodeInitArgument(this.init[key], node)\n            })\n            this.value = new this.type(args)\n          } else if (this.init === null) {\n            this.value = new this.type()\n          } else {\n            const argument = decodeInitArgument(this.init, node)\n            this.value = new this.type(argument)\n          }\n        }\n      }\n    }\n\n    this.observer = new Observer(node)\n    this.observer.start(this.value)\n\n    debug: {\n      if (this.value !== undefined && this.init !== undefined) {\n        if ([String, Number, Boolean].indexOf(this.type as any) !== -1) {\n          if (this.type === Boolean && typeof this.value !== 'boolean' ||\n              this.type === Number && typeof this.value !== 'number' ||\n              this.type === String && typeof this.value !== 'string') {\n            console.warn(`Property: Uninitialized value for type \"${this.type.name}\"!`)\n          }\n        } else {\n          if (typeof this.type === 'function' && !(this.value instanceof this.type)) {\n            console.warn(`Property: Incorrect value \"${this.value}\" for type \"${this.type.name}\"!`)\n          }\n        }\n      }\n    }\n  }\n}","import { ReactivePropertyDefinitionLoose } from '../core/ReactiveProperty.js'\nimport { ReactiveNode, AnyConstructor, ReactivePropertyDefinitions } from '../nodes/ReactiveNode.js'\nimport { IoElement } from '../elements/IoElement.js'\n\nexport const propertyDecorators: WeakMap<AnyConstructor, Record<string, any>> = new WeakMap()\nexport const reactivePropertyDecorators: WeakMap<AnyConstructor, ReactivePropertyDefinitions> = new WeakMap()\n\n/**\n * Declares a property and an initial value for a property.\n * @decorator\n * @param {any} initialValue - Initial value.\n * @returns {Function} Property decorator function.\n *\n * @example\n * \\@Register\n * class MyClass extends ReactiveNode {\n *   \\@Property('default text')\n *   declare title: string;\n * }\n */\nexport function Property(initialValue: any = undefined) {\n  return (target: ReactiveNode | IoElement, propertyName: string) => {\n    const constructor = target.constructor as AnyConstructor\n    const properties = propertyDecorators.get(constructor) || {}\n    propertyDecorators.set(constructor, properties)\n    properties[propertyName] = initialValue\n  }\n};\n\n/**\n * Declares a reactive property and defines its inital value and behavior using a loose or strict definition.\n * @decorator\n * @param {ReactivePropertyDefinitionLoose} defLoose - Property definition.\n * @returns {Function} Property decorator function.\n *\n * @example\n * \\@Register\n * class MyClass extends ReactiveNode {\n *   \\@ReactiveProperty({type: String, value: 'default text', reflect: true})\n *   declare title: string;\n * }\n *\n * @example\n * \\@Register\n * class MyClass extends ReactiveNode {\n *   \\@ReactiveProperty({type: Array, init: [0, 0]})\n *   declare size: [number, number];\n * }\n */\nexport function ReactiveProperty(defLoose: ReactivePropertyDefinitionLoose = {}) {\n  return (target: ReactiveNode | IoElement, propertyName: string) => {\n    const constructor = target.constructor as AnyConstructor\n    const properties = reactivePropertyDecorators.get(constructor) || {}\n    reactivePropertyDecorators.set(constructor, properties)\n    properties[propertyName] = defLoose\n  }\n};","import { AnyConstructor } from '../nodes/ReactiveNode.js'\n\nexport const styleDecorators: WeakMap<AnyConstructor, string> = new WeakMap()\n\nexport function Style(style: string) {\n  return (target: AnyConstructor) => {\n    // Add the Style static property to the class\n    Object.defineProperty(target, 'Style', {\n      get() {\n        return style\n      },\n      configurable: true,\n      enumerable: true\n    })\n\n    // Also store in WeakMap for potential future use\n    styleDecorators.set(target, style)\n  }\n}","import { ReactiveProtoProperty } from './ReactiveProperty.js'\nimport { ListenerDefinition, hardenListenerDefinition } from './EventDispatcher.js'\nimport { ReactiveNode, ReactiveNodeConstructor, ReactivePropertyDefinitions, ListenerDefinitions, AnyConstructor } from '../nodes/ReactiveNode.js'\nimport { reactivePropertyDecorators } from '../decorators/Property.js'\nimport { propertyDecorators } from '../decorators/Property.js'\nimport { styleDecorators } from '../decorators/Style.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n// TODO: Improve types!\n\ntype ProtoConstructors = Array<ReactiveNodeConstructor>\ntype ProtoHandlers = string[]\ntype ReactiveProtoProperties = { [property: string]: ReactiveProtoProperty }\ntype ProtoListeners = { [property: string]: ListenerDefinition[] }\n\n/**\n * ProtoChain manages class inheritance metadata and configuration.\n *\n * This utility class traverses the prototype chain during class registration to:\n * - Aggregate property configurations\n * - Aggregate event listeners\n * - Aggregate CSS styles strings\n * - Auto-bind event handlers to maintain proper 'this' context\n *\n * This class is internal and instantiated during the `Register()` process.\n */\nexport class ProtoChain {\n  /**\n   * Array of inherited class constructors\n   */\n  constructors: ProtoConstructors = []\n  /**\n   * Aggregated initial value for properties declared in `static get Properties()` or @Property() decorators\n  */\n  properties: Record<string, any> = {}\n  /**\n   * Aggregated reactive property definition declared in `static get ReactiveProperties()` or @ReactiveProperty() decorators\n   */\n  reactiveProperties: ReactiveProtoProperties = {}\n  /**\n   * Aggregated listener definition declared in `static get Listeners()`\n   */\n  listeners: ProtoListeners = {}\n  /**\n   * Aggregated CSS style definition declared in `static get Style()`\n   */\n  style: string = ''\n  /**\n   * Array of function names that start with \"on[A-Z]\" or \"_on[A-Z]\" for auto-binding.\n   */\n  handlers: ProtoHandlers = []\n  /**\n   * Creates an instance of `ProtoChain` for specified class constructor.\n   * @param {ReactiveNodeConstructor} ioNodeConstructor - Owner `ReactiveNode` constructor.\n   */\n  constructor(ioNodeConstructor: ReactiveNodeConstructor) {\n    let proto = ioNodeConstructor.prototype\n    // Iterate through the prototype chain to aggregate constructors.\n    // Terminates at `HTMLElement`, `Object` or `Array`.\n    while (\n      proto\n      && (ioNodeConstructor) !== HTMLElement\n      && (ioNodeConstructor) !== Object) {\n        this.constructors.push(ioNodeConstructor)\n        proto = Object.getPrototypeOf(proto)\n        ioNodeConstructor = proto.constructor\n    }\n\n    // Iterate through the prototype chain in reverse to aggregate inherited properties and listeners.\n    let reactivePropertyHash = ''\n    let propertyHash = ''\n    for (let i = this.constructors.length; i--;) {\n      ioNodeConstructor = this.constructors[i]\n      this.addPropertiesFromDecorators(ioNodeConstructor)\n      propertyHash = this.addProperties(ioNodeConstructor.Properties, propertyHash)\n      this.addReactivePropertiesFromDecorators(ioNodeConstructor)\n      reactivePropertyHash = this.addReactiveProperties(ioNodeConstructor.ReactiveProperties, reactivePropertyHash)\n      this.addListeners(ioNodeConstructor.Listeners)\n      this.addStyle(ioNodeConstructor.Style)\n      this.addStyleFromDecorators(ioNodeConstructor)\n      this.addHandlers(ioNodeConstructor.prototype as ReactiveNode | IoElement)\n    }\n    debug: this.validateReactiveProperties()\n\n    // Freeze aggregated properties to prevent accidental modifications\n    Object.freeze(this.constructors)\n    Object.freeze(this.properties)\n    Object.freeze(this.reactiveProperties)\n    Object.freeze(this.listeners)\n    Object.freeze(this.handlers)\n  }\n  /**\n   * Auto-binds event handler methods (starting with 'on[A-Z]' or '_on[A-Z]') to preserve their 'this' context.\n   * NOTE: Defining handlers as arrow functions will not work because they are not defined before constructor has finished.\n   * @param {ReactiveNode | IoElement} node - Target node instance\n   */\n  init(node: ReactiveNode | IoElement) {\n    if (this.constructors[0] !== node.constructor) {\n      throw new Error(`${node.constructor.name} not registered! Use @Register decorator before using ${node.constructor.name} class.`)\n    }\n    for (let i = this.handlers.length; i--;) {\n      Object.defineProperty(node, this.handlers[i], {\n        value: (node as any)[this.handlers[i]].bind(node),\n        writable: true,\n        configurable: true\n      })\n    }\n  }\n  /**\n   * Adds properties defined in decorators to the properties array.\n   * @param {ReactiveNodeConstructor} ioNodeConstructor - Owner `ReactiveNode` constructor.\n   */\n  addPropertiesFromDecorators(ioNodeConstructor: ReactiveNodeConstructor) {\n    const props = propertyDecorators.get(ioNodeConstructor as AnyConstructor)\n    if (props) for (const name in props) {\n      this.properties[name] = props[name]\n    }\n  }\n  addProperties(properties: Record<string, any> = {}, prevHash = ''): string {\n    const newHash = JSON.stringify(properties)\n    if (newHash !== prevHash) {\n      for (const name in properties) {\n        this.properties[name] = properties[name]\n      }\n      prevHash = newHash\n    }\n    return prevHash\n  }\n  /**\n   * Adds reactive properties defined in decorators to the properties array.\n   * @param {ReactiveNodeConstructor} ioNodeConstructor - Owner `ReactiveNode` constructor.\n   */\n  addReactivePropertiesFromDecorators(ioNodeConstructor: ReactiveNodeConstructor) {\n    const props = reactivePropertyDecorators.get(ioNodeConstructor as AnyConstructor)\n    if (props) for (const name in props) {\n      const protoProperty = new ReactiveProtoProperty(props[name])\n      if (!this.reactiveProperties[name]) this.reactiveProperties[name] = protoProperty\n      this.reactiveProperties[name].assign(protoProperty)\n    }\n  }\n  /**\n   * Adds reactive properties from `static get ReactiveProperties()` to the properties array.\n   * Only process properties if they differ from superclass.\n   * This prevents 'static get ReactiveProperties()' from overriding subclass properties defined in decorators.\n   * @param {ReactivePropertyDefinitions} properties - Properties to add\n   * @param {string} prevHash - Previous properties hash\n   * @returns {string} - Updated properties hash\n   */\n  addReactiveProperties(properties: ReactivePropertyDefinitions = {}, prevHash = ''): string {\n    const reativeProtoProperties: Record<string, ReactiveProtoProperty> = {}\n    for (const name in properties) {\n      reativeProtoProperties[name] = new ReactiveProtoProperty(properties[name])\n    }\n    const newHash = JSON.stringify(reativeProtoProperties)\n    if (newHash !== prevHash) {\n      for (const name in properties) {\n        if (!this.reactiveProperties[name]) this.reactiveProperties[name] = reativeProtoProperties[name]\n        else this.reactiveProperties[name].assign(reativeProtoProperties[name])\n      }\n      prevHash = newHash\n    }\n    return prevHash\n  }\n  /**\n   * Merges or appends a listener definitions to the existing listeners array.\n   * @param {ListenerDefinitions} listenerDefs - Listener definitions to add\n   */\n  addListeners(listenerDefs?: ListenerDefinitions) {\n    for (const name in listenerDefs) {\n      if (listenerDefs[name]) {\n        const lsnDef = hardenListenerDefinition(listenerDefs[name])\n        const listeners = this.listeners[name] = this.listeners[name] || []\n        const i = listeners.findIndex(def => def[0] === lsnDef[0])\n        if (i !== -1) {\n          if (listeners[i][1]) listeners[i][1] = Object.assign(listeners[i][1] as ListenerDefinition, lsnDef[1])\n          else if (lsnDef[1]) listeners[i][1] = lsnDef[1]\n        } else {\n          listeners.push(lsnDef)\n        }\n      }\n    }\n  }\n  /**\n   * Adds a style string to the styles array.\n   * @param {string} style - Style string to add\n   */\n  addStyle(style?: string) {\n    if (style && this.style.indexOf(style) === -1) {\n      this.style = this.style ? this.style + '\\n' + style : style\n    }\n  };\n  /**\n   * Adds style defined in decorators to the style string.\n   * @param {ReactiveNodeConstructor} ioNodeConstructor - Owner `ReactiveNode` constructor.\n   */\n  addStyleFromDecorators(ioNodeConstructor: ReactiveNodeConstructor) {\n    const style = styleDecorators.get(ioNodeConstructor as AnyConstructor)\n    if (style) {\n      this.style = this.style ? this.style + '\\n' + style : style\n    }\n  }\n  /**\n   * Adds function names that start with \"on[A-Z]\" or \"_on[A-Z]\" to the handlers array.\n   * @param {ReactiveNode} proto - Prototype object to search for handlers\n   */\n  addHandlers(proto: ReactiveNode | IoElement) {\n    const names = Object.getOwnPropertyNames(proto)\n    for (let j = 0; j < names.length; j++) {\n      const fn = names[j]\n      if (/^on[A-Z]/.test(fn) || /^_on[A-Z]/.test(fn) || fn.endsWith('Changed') || fn.endsWith('Mutated') || fn.endsWith('Debounced') || fn.endsWith('Throttled') || fn === 'changed') {\n        const propDesr = Object.getOwnPropertyDescriptor(proto, fn)\n        if (propDesr === undefined || propDesr.get || propDesr.set) continue\n        if (typeof (proto as any)[fn] === 'function') {\n          if (this.handlers.indexOf(fn) === -1) {\n            this.handlers.push(fn)\n          }\n        }\n      }\n    }\n  };\n  /**\n   * Validates reactive property definitions in debug mode.\n   * Logs warnings for incorrect property definitions.\n   * @returns {void}\n   */\n  validateReactiveProperties() {\n    for (const name in this.reactiveProperties) {\n      const prop = this.reactiveProperties[name]\n      if ([String, Number, Boolean].indexOf(prop.type as any) !== -1) {\n        if (prop.type === Boolean && prop.value !== undefined && typeof prop.value !== 'boolean' ||\n            prop.type === Number && prop.value !== undefined && typeof prop.value !== 'number' ||\n            prop.type === String && prop.value !== undefined && typeof prop.value !== 'string') {\n          console.warn(`Reactive property \"${name}\" value \"${prop.value}\" type for ${prop.type.name} property!`)\n        }\n      } else {\n        const isNull = prop.value === null\n        const isUndefined = prop.value === undefined\n        if (typeof prop.type === 'function' && !(prop.value instanceof prop.type) && !isNull && !isUndefined) {\n            console.warn(`Reactive property \"${name}\" value \"${prop.value}\" type for ${prop.type.name} property!`)\n        }\n      }\n    }\n  }\n}\n","import { ReactiveNode } from '../nodes/ReactiveNode.js'\nimport { IoElement } from '../elements/IoElement.js'\n\nexport type CallbackFunction = (arg?: any) => void\n\ninterface QueueOptions {\n  arg: any\n  frame: number\n}\n\ntype QueueKey = { node: ReactiveNode | IoElement | undefined; func: CallbackFunction }\n\nlet currentFrame = 0\n\nconst queue0: Map<QueueKey, QueueOptions> = new Map()\nconst queue1: Map<QueueKey, QueueOptions> = new Map()\nlet queue = queue0\n\n// Key registry - shared across both buffers\nconst keysByNode: WeakMap<ReactiveNode | IoElement, Map<CallbackFunction, QueueKey>> = new WeakMap()\nconst keysByFunc: Map<CallbackFunction, QueueKey> = new Map()\n\n// Throttle: tracks when each node+func can next execute immediately\nconst throttleNextFrame: WeakMap<ReactiveNode | IoElement, Map<CallbackFunction, number>> = new WeakMap()\nconst throttleNextFrameGlobal: Map<CallbackFunction, number> = new Map()\n\nfunction getKey(func: CallbackFunction, node?: ReactiveNode | IoElement): QueueKey {\n  if (node) {\n    let funcMap = keysByNode.get(node)\n    if (!funcMap) {\n      funcMap = new Map()\n      keysByNode.set(node, funcMap)\n    }\n    let key = funcMap.get(func)\n    if (!key) {\n      key = { node, func }\n      funcMap.set(func, key)\n    }\n    return key\n  } else {\n    let key = keysByFunc.get(func)\n    if (!key) {\n      key = { node: undefined, func }\n      keysByFunc.set(func, key)\n    }\n    return key\n  }\n}\n\n/**\n * Returns a promise that resolves when the next frame is rendered.\n * @returns {Promise<void>}\n */\nexport async function nextQueue(): Promise<void> {\n  return new Promise((resolve) => {\n    const key = getKey(resolve, undefined)\n    queue.set(key, { arg: undefined, frame: currentFrame + 1 })\n  })\n}\n\n/**\n * Throttles function execution with leading + trailing edge semantics.\n * - Executes immediately on first call (leading edge)\n * - Queues trailing call with latest argument\n * - Respects delay between executions\n */\nexport function throttle(func: CallbackFunction, arg?: any, node?: ReactiveNode | IoElement, delay = 1) {\n  if (node?._disposed) return\n\n  const key = getKey(func, node)\n\n  // Check if we can execute immediately (leading edge)\n  let nextAllowed: number\n  if (node) {\n    nextAllowed = throttleNextFrame.get(node)?.get(func) ?? -Infinity\n  } else {\n    nextAllowed = throttleNextFrameGlobal.get(func) ?? -Infinity\n  }\n\n  if (currentFrame >= nextAllowed) {\n    if (node) {\n      let funcMap = throttleNextFrame.get(node)\n      if (!funcMap) {\n        funcMap = new Map()\n        throttleNextFrame.set(node, funcMap)\n      }\n      funcMap.set(func, currentFrame + delay)\n    } else {\n      throttleNextFrameGlobal.set(func, currentFrame + delay)\n    }\n\n    try {\n      if (arg !== undefined) func(arg)\n      else func()\n    } catch (e) {\n      console.error(e)\n    }\n\n    // Queue trailing call (will execute after delay)\n    queue.set(key, { arg, frame: currentFrame + delay })\n  } else {\n    // Within delay period - only update arg, don't postpone\n    const existing = queue.get(key)\n    if (existing) {\n      existing.arg = arg\n    }\n  }\n}\n\nexport function debounce(func: CallbackFunction, arg?: any, node?: ReactiveNode | IoElement, delay = 1) {\n  const key = getKey(func, node)\n  queue.set(key, { arg, frame: currentFrame + delay })\n}\n\nfunction executeQueue() {\n  currentFrame++\n\n  const activeQueue = queue\n  queue = queue === queue0 ? queue1 : queue0\n\n  for (const [key, options] of activeQueue) {\n    // Re-queue if target frame not reached\n    if (options.frame > currentFrame) {\n      if (!queue.has(key)) {\n        queue.set(key, options)\n      }\n      continue\n    }\n\n    if (key.node?._disposed) continue\n\n    try {\n      if (options.arg !== undefined) key.func(options.arg)\n      else key.func()\n    } catch (e) {\n      console.error(e)\n    }\n  }\n\n  activeQueue.clear()\n  requestAnimationFrame(executeQueue)\n}\nrequestAnimationFrame(executeQueue)\n","import { EventDispatcher } from '../core/EventDispatcher.js'\nimport { IoElement } from '../elements/IoElement.js'\nimport { Binding } from '../core/Binding.js'\n\nexport type VDOMElement = {\n  tag: string\n  props?: Record<string, any>\n  children?: Array<VDOMElement | null> | string\n}\n\ntype IntegerNumeric = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 |\n  21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 30 | 31 | 32\ntype IntegerString = `${IntegerNumeric}`\ntype IntegerAny = IntegerNumeric | IntegerString\ntype Boolean = boolean | 'true' | 'false'\ntype Lang = 'ab'|'aa'|'af'|'ak'|'sq'|'am'|'ar'|'an'|'hy'|'as'|'av'|'ae'|'ay'|'az'|'bm'|'ba'|'eu'|'be'|'bn'|'bh'|\n  'bi'|'bs'|'br'|'bg'|'my'|'ca'|'ch'|'ce'|'ny'|'zh'|'zh-ans'|'zh-ant'|'cv'|'kw'|'co'|'cr'|'hr'|'cs'|'da'|'dv'|'nl'|\n  'dz'|'en'|'eo'|'et'|'ee'|'fo'|'fj'|'fi'|'fr'|'ff'|'gl'|'gd'|'ka'|'de'|'el'|'kl'|'gn'|'gu'|'ht'|'ha'|'he'|'hz'|'hi'|\n  'ho'|'hu'|'is'|'io'|'ig'|'id in'|'ia'|'ie'|'iu'|'ik'|'ga'|'it'|'ja'|'jv'|'kn'|'kr'|'ks'|'kk'|'km'|'ki'|'rw'|'rn'|\n  'ky'|'kv'|'kg'|'ko'|'ku'|'kj'|'lo'|'la'|'lv'|'li'|'ln'|'lt'|'lu'|'lg'|'lb'|'gv'|'mk'|'mg'|'ms'|'ml'|'mt'|'mi'|'mr'|\n  'mh'|'mo'|'mn'|'na'|'nv'|'ng'|'nd'|'ne'|'no'|'nb'|'nn'|'oc'|'oj'|'cu'|'or'|'om'|'os'|'pi'|'ps'|'fa'|'pl'|'pt'|'pa'|\n  'qu'|'rm'|'ro'|'ru'|'se'|'sm'|'sg'|'sa'|'sr'|'sh'|'st'|'tn'|'sn'|'ii'|'sd'|'si'|'ss'|'sk'|'sl'|'so'|'nr'|'es'|'su'|\n  'sw'|'sv'|'tl'|'ty'|'tg'|'ta'|'tt'|'te'|'th'|'bo'|'ti'|'to'|'ts'|'tr'|'tk'|'tw'|'ug'|'uk'|'ur'|'uz'|'ve'|'vi'|'vo'|\n  'wa'|'cy'|'wo'|'fy'|'xh'|'yi'|'ji'|'yo'|'za'|'zu'\n\ntype PropsWithUndefined<T> = {[K in keyof T]: T[K] | undefined}\n\nexport type AriaProps = PropsWithUndefined<{\n  role?: 'alert'|'alertdialog'|'application'|'article'|'banner'|'button'|'cell'|'checkbox'|'columnheader'|'combobox'|\n    'complementary'|'contentinfo'|'definition'|'dialog'|'directory'|'document'|'feed'|'figure'|'form'|'grid'|\n    'gridcell'|'group'|'heading'|'img'|'link'|'list'|'listbox'|'listitem'|'log'|'main'|'marquee'|'math'|'menu'|\n    'menubar'|'menuitem'|'menuitemcheckbox'|'menuitemradio'|'navigation'|'none'|'note'|'option'|'presentation'|\n    'progressbar'|'radio'|'radiogroup'|'region'|'row'|'rowgroup'|'rowheader'|'scrollbar'|'search'|'searchbox'|\n    'separator'|'slider'|'spinbutton'|'status'|'switch'|'tab'|'table'|'tablist'|'tabpanel'|'term'|'textbox'|'timer'|\n    'toolbar'|'tooltip'|'tree'|'treegrid'|'treeitem'\n  ariaAtomic?: Boolean\n  ariaAutoComplete?: 'inline' | 'list' | 'both' | 'none'\n  ariaBusy?: Boolean\n  ariaBrailleLabel?: string\n  ariaBrailleRoleDescription?: string\n  ariaChecked?: Boolean | 'mixed'\n  ariaColCount?: IntegerAny\n  ariaColIndex?: IntegerAny\n  ariaColSpan?: IntegerAny\n  ariaCurrent?: Boolean | 'page' | 'step' | 'location' | 'date' | 'time' | 'true' | 'false'\n  ariaDescription?: string\n  ariaDisabled?: Boolean\n  ariaExpanded?: Boolean | 'undefined'\n  ariaHasPopup?: Boolean | 'menu' | 'listbox' | 'tree' | 'grid' | 'dialog'\n  ariaHidden?: Boolean | 'undefined'\n  ariaInvalid?: Boolean | 'grammar' | 'spelling'\n  ariaKeyShortcuts?: string\n  ariaLabel?: string\n  ariaLevel?: IntegerAny\n  ariaLive?: 'assertive' | 'polite' | 'off'\n  ariaModal?: Boolean\n  ariaMultiLine?: Boolean\n  ariaMultiSelectable?: Boolean\n  ariaOrientation?: 'horizontal' | 'vertical' | 'undefined'\n  ariaPlaceholder?: string\n  ariaPosInSet?: IntegerAny\n  ariaPressed?: Boolean | 'mixed' | 'undefined'\n  ariaReadOnly?: Boolean\n  ariaRequired?: Boolean\n  ariaRelevant?: 'additions' | 'all' | 'removals' | 'text'\n  ariaRoleDescription?: string\n  ariaRowCount?: IntegerAny\n  ariaRowIndex?: IntegerAny\n  ariaRowSpan?: IntegerAny\n  ariaSelected?: Boolean | 'undefined'\n  ariaSetSize?: IntegerAny\n  ariaSort?: 'none' | 'ascending' | 'descending' | 'other'\n  ariaValueMax?: number | `${number}`\n  ariaValueMin?: number | `${number}`\n  ariaValueNow?: number | `${number}`\n  ariaValueText?: string\n  ariaColIndexText?: string\n  ariaRowIndexText?: string\n  // TODO: Implement and test in VDOM!\n  ariaActiveDescendantElement?: HTMLElement\n  ariaControlsElements?: HTMLElement\n  ariaDescribedByElements?: HTMLElement\n  ariaDetailsElements?: HTMLElement\n  ariaErrorMessageElements?: HTMLElement\n  ariaFlowToElements?: HTMLElement\n  ariaLabelledByElements?: HTMLElement\n}>\n\nexport type OtherHTMLElementProps = PropsWithUndefined<{\n  target?: '_blank' | '_self' | '_parent' | '_top' | string\n  download?: string\n  ping?: string\n  rel?: string\n  relList?: DOMTokenList\n  hreflang?: Lang\n  type?: string\n  referrerPolicy?: 'no-referrer' | 'no-referrer-when-downgrade' | 'origin' | 'origin-when-cross-origin' |\n    'same-origin' | 'strict-origin' | 'strict-origin-when-cross-origin' | 'unsafe-url'\n  text?: string\n  coords?: string\n  charset?: string\n  name?: string\n  rev?: string\n  shape?: 'rect' | 'circle' | 'poly' | 'default'\n  protocol?: string\n  username?: string\n  password?: string\n  host?: string\n  hostname?: string\n  port?: string\n  pathname?: string\n  search?: string\n  hash?: string\n  href?: string\n  attributionSrc?: string\n  alt?: string\n  noHref?: boolean\n  cite?: string\n  clear?: 'left' | 'right' | 'both' | 'all' | 'none'\n  disabled?: boolean\n  formAction?: string\n  formEnctype?: 'application/x-www-form-urlencoded' | 'multipart/form-data' | 'text/plain'\n  formMethod?: 'get' | 'post' | 'dialog'\n  formNoValidate?: boolean\n  formTarget?: '_blank' | '_self' | '_parent' | '_top' | string\n  value?: string | number\n  commandForElement?: string\n  command?: string\n  width?: number | string\n  height?: number | string\n  span?: number\n  ch?: string\n  chOff?: string\n  vAlign?: 'top' | 'middle' | 'bottom' | 'baseline'\n  dateTime?: string\n  open?: boolean\n  returnValue?: string\n  closedBy?: string\n  compact?: boolean\n  src?: string\n  color?: string\n  face?: string\n  size?: number | string\n  acceptCharset?: string\n  action?: string\n  autocomplete?: 'on' | 'off'\n  enctype?: 'application/x-www-form-urlencoded' | 'multipart/form-data' | 'text/plain'\n  encoding?: string\n  method?: 'get' | 'post' | 'dialog'\n  noValidate?: boolean\n  scrolling?: 'yes' | 'no' | 'auto'\n  frameBorder?: '0' | '1'\n  longDesc?: string\n  noResize?: boolean\n  marginHeight?: number | string\n  marginWidth?: number | string\n  cols?: number | string\n  rows?: number | string\n  noShade?: boolean\n  version?: string\n  srcdoc?: string\n  sandbox?: string\n  allowFullscreen?: boolean\n  csp?: string\n  allow?: string\n  loading?: 'eager' | 'lazy'\n  credentialless?: boolean\n  allowPaymentRequest?: boolean\n  privateToken?: boolean\n  browsingTopics?: boolean\n  adAuctionHeaders?: boolean\n  sharedStorageWritable?: boolean\n  srcset?: string\n  sizes?: string\n  crossOrigin?: 'anonymous' | 'use-credentials' | ''\n  useMap?: string\n  isMap?: boolean\n  decoding?: 'sync' | 'async' | 'auto'\n  fetchPriority?: 'high' | 'low' | 'auto'\n  lowsrc?: string\n  hspace?: number | string\n  vspace?: number | string\n  border?: number | string\n  accept?: string\n  defaultChecked?: boolean\n  checked?: boolean\n  dirName?: string\n  files?: FileList\n  indeterminate?: boolean\n  max?: number | string\n  maxLength?: number\n  min?: number | string\n  minLength?: number\n  multiple?: boolean\n  pattern?: string\n  placeholder?: string\n  readOnly?: boolean\n  required?: boolean\n  step?: number | string\n  defaultValue?: string\n  valueAsDate?: Date | null\n  valueAsNumber?: number\n  selectionStart?: number\n  selectionEnd?: number\n  selectionDirection?: 'forward' | 'backward' | 'none'\n  webkitdirectory?: boolean\n  incremental?: boolean\n  htmlFor?: string\n  media?: string\n  as?: string\n  imageSrcset?: string\n  imageSizes?: string\n  integrity?: string\n  blocking?: boolean\n  httpEquiv?: string\n  content?: string\n  scheme?: string\n  low?: number | string\n  high?: number | string\n  optimum?: number | string\n  data?: string\n  archive?: string\n  code?: string\n  declare?: boolean\n  standby?: string\n  codeBase?: string\n  codeType?: string\n  reversed?: boolean\n  start?: number\n  label?: string\n  defaultSelected?: boolean\n  selected?: boolean\n  valueType?: string\n  noModule?: boolean\n  async?: boolean\n  defer?: boolean\n  event?: string\n  length?: number\n  selectedIndex?: number\n  caption?: string\n  tHead?: string\n  tFoot?: string\n  frame?: string\n  rules?: string\n  summary?: string\n  cellPadding?: string\n  cellSpacing?: string\n  colSpan?: number\n  rowSpan?: number\n  headers?: string\n  axis?: string\n  noWrap?: boolean\n  abbr?: string\n  scope?: 'row' | 'col' | 'rowgroup' | 'colgroup'\n  shadowRootMode?: 'open' | 'closed'\n  shadowRootDelegatesFocus?: boolean\n  shadowRootClonable?: boolean\n  shadowRootSerializable?: boolean\n  wrap?: 'soft' | 'hard'\n  kind?: string\n  srclang?: Lang\n  default?: boolean\n  poster?: string\n  playsInline?: boolean\n  disablePictureInPicture?: boolean\n}>\n\ntype prefix<TKey, TPrefix extends string> = TKey extends string ? `${TPrefix}${TKey}` : never\ntype AnyEventHandler = ((event: CustomEvent<any>) => void) |\n  ((event: PointerEvent) => void) |\n  ((event: KeyboardEvent) => void) |\n  ((event: MouseEvent) => void) |\n  ((event: TouchEvent) => void) |\n  ((event: WheelEvent) => void) |\n  ((event: InputEvent) => void) |\n  ((event: ClipboardEvent) => void) |\n  ((event: DragEvent) => void) |\n  ((event: FocusEvent) => void) |\n  ((event: TransitionEvent) => void) |\n  ((event: AnimationEvent) => void) |\n  ((event: ErrorEvent) => void) |\n  ((event: Event) => void)\n\nexport type NativeElementProps = AriaProps & PropsWithUndefined<{\n  [key: prefix<string, '@'>]: string | AnyEventHandler\n  title?: string\n  lang?: Lang\n  translate?: any\n  dir?: any\n  hidden?: any\n  inert?: any\n  accessKey?: any\n  draggable?: any\n  spellcheck?: boolean\n  autocapitalize?: any\n  contentEditable?: Boolean\n  enterKeyHint?: 'enter' | 'done' | 'go' | 'next' | 'previous' | 'search' | 'send'\n  inputMode?: 'decimal' | 'email' | 'numeric' | 'tel' | 'search' | 'url' | 'text'\n  virtualKeyboardPolicy?: 'manual' | 'auto'\n  // offsetParent?: any,\n  innerText?: string\n  outerText?: string\n  writingSuggestions?: Boolean\n  autofocus?: boolean\n  tabIndex?: IntegerAny | -1 | '-1'\n  style?: Record<string, string>\n  id?: string\n  class?: string // Shorthand for className\n  innerHTML?: string\n  outerHTML?: string\n  scrollTop?: number\n  scrollLeft?: number\n  scrollWidth?: number\n  scrollHeight?: number\n  textContent?: string\n}>\n\nconst defaultPropsMap = new WeakMap<HTMLElement, NativeElementProps>()\n\n// TODO: Fix types. Remove any.\n\n/**\n * Sets native element's properties and attributes.\n * - style: formatted as Object.\n * - class: shorthand for className.\n * - \"@\" + event: name for event listener.\n * @param {HTMLElement} element - Native HTMLElement to apply properties to.\n * @param {Object} props - Element properties.\n */\nexport const applyNativeElementProps = function(element: HTMLElement, props: NativeElementProps) {\n\n  const defaultPropValues: any = defaultPropsMap.get(element) || {}\n\n  defaultPropsMap.set(element, defaultPropValues)\n\n  for (const _p in props) {\n    const p = _p as keyof HTMLElement\n    const prop = props[p as keyof NativeElementProps]\n\n    debug: if (prop instanceof Binding) {\n      console.warn(`VDOM: Cannot set binding on \"${element.localName}.${_p}\"`)\n    }\n\n    if (!Object.hasOwn(defaultPropValues, p)) defaultPropValues[p] = element[p]\n\n    if (p === 'style') {\n      for (const s in prop) {\n        // TODO: Consider supporting importance\n        element.style.setProperty(s, prop[s])\n      }\n    } else if ((p as any) === 'class') {\n      element['className'] = prop\n    } else if (p.startsWith('data-')) {\n      // TODO: Test this!\n      if (prop === undefined) {\n        element.removeAttribute(p)\n      } else {\n        element.setAttribute(p, prop)\n      }\n    } else {\n      if (prop === undefined) {\n        (element as any)[p] = defaultPropValues[p]\n      } else {\n        (element as any)[p] = prop\n      }\n    }\n\n    if (prop === undefined) element.removeAttribute(p)\n    else if (prop === defaultPropValues[p]) element.removeAttribute(p)\n  }\n  // Reset properties to defaults if they are not in the props.\n  for (const _p in defaultPropValues) {\n    const p = _p as keyof NativeElementProps\n    if (!Object.hasOwn(props, p)) {\n      (element as any)[p] = defaultPropValues[p]\n      element.removeAttribute(p)\n    }\n  }\n  if (!(element as IoElement)._eventDispatcher) {\n    Object.defineProperty(\n      element,\n      '_eventDispatcher',\n      {enumerable: false, configurable: true, value: new EventDispatcher(element as unknown as IoElement)}\n    )\n  }\n  (element as IoElement)._eventDispatcher.applyPropListeners(props)\n}\n\n/**\n * Creates an element from a virtual DOM object.\n * @param {VDOMElement} vDOMElement - Virtual DOM object.\n * @return {HTMLElement} - Created element.\n */\nexport const constructElement = function(vDOMElement: VDOMElement) {\n  const props = vDOMElement.props || {}\n  // IoElement classes constructed with constructor.\n  const ConstructorClass = window.customElements ? window.customElements.get(vDOMElement.tag) : null\n  if (ConstructorClass && (ConstructorClass as any).prototype?._isIoElement) {\n    return new ConstructorClass(props)\n  }\n  // Other element classes constructed with document.createElement.\n  const element = document.createElement(vDOMElement.tag)\n  applyNativeElementProps(element, props)\n  return element\n}\n\n/**\n * Disposes the element's children.\n * @param {IoElement} element - Element to dispose children of.\n */\nexport const disposeChildren = function(element: IoElement) {\n  // NOTE: This rAF ensures that element's change queue is emptied before disposing.\n  requestAnimationFrame(() => {\n    const elements = Array.from(element.querySelectorAll('*')).concat([element]) as IoElement[]\n    for (let i = elements.length; i--;) {\n      if (typeof elements[i].dispose === 'function') {\n        elements[i].dispose()\n      } else if (elements[i]._eventDispatcher) {\n        elements[i]._eventDispatcher.dispose()\n        delete (elements[i] as any)._eventDispatcher\n      }\n    }\n  })\n}\n\nconst vDOMAttributes = function(element: IoElement | HTMLElement): Record<string, any> {\n  const attributes: Record<string, any> = {}\n  for (let i = 0; i < element.attributes.length; i++) {\n    const name = element.attributes[i].name\n    const value = element.getAttribute(name)\n    if (value !== null) attributes[name] = value\n  }\n  return attributes\n}\n\nconst toVDOMChildren = function(htmlCollection: [IoElement | HTMLElement]): VDOMElement[] {\n  const children = []\n  for (let i = 0; i < htmlCollection.length; i++) {\n    children.push(toVDOM(htmlCollection[i]))\n  }\n  return children\n}\n\n/**\n * Converts an element to a virtual dom object.\n * NODE: This vDOM contains elements only attributes (not properties).\n * Used for testing but might be useful for other things.\n * @param {IoElement | HTMLElement} element - Element to convert.\n * @return {VDOMElement} - Virtual dom object.\n */\nexport const toVDOM = function(element: IoElement | HTMLElement): VDOMElement {\n  return {\n    tag: element.localName,\n    props: vDOMAttributes(element),\n    children: element.children.length > 0 ? toVDOMChildren((element as any).children) : element.textContent as string\n  }\n}","import { ReactiveNode } from '../nodes/ReactiveNode.js'\nimport { IoElement } from '../elements/IoElement.js'\n\n/**\n * Registers a new ReactiveNode or IoElement subclass. This needs to be called for each new class that extends ReactiveNode or IoElement.\n * @param {ReactiveNode | IoElement} ioNodeConstructor - ReactiveNode class to register.\n *\n * @example\n * // Creating a new ReactiveNode subclass.\n * \\@Register\n * class MyNode extends ReactiveNode {\n * }\n *\n * @example\n * // Creating a new IoElement subclass.\n * \\@Register\n * class MyIoElement extends IoElement {\n * }\n *\n * @example\n * //Javascript without decorator syntax.\n * class MyNode extends ReactiveNode {\n * }\n * Register(MyNode);\n*/\nexport function Register(ioNodeConstructor: typeof ReactiveNode | typeof IoElement) {\n  (ioNodeConstructor as any).prototype.Register(ioNodeConstructor)\n}","// Global mixin record\nconst mixinRecord: Record<string, string> = {}\n\n// Regular expressions for style string processing.\nconst commentsRegex =  new RegExp('(\\\\/\\\\*[\\\\s\\\\S]*?\\\\*\\\\/)', 'gi')\nconst keyframeRegex =  new RegExp('((@.*?keyframes [\\\\s\\\\S]*?){([\\\\s\\\\S]*?}\\\\s*?)})', 'gi')\nconst mediaQueryRegex =  new RegExp('((@media [\\\\s\\\\S]*?){([\\\\s\\\\S]*?}\\\\s*?)})', 'gi')\nconst mixinRegex = new RegExp('(( --[\\\\s\\\\S]*?): {([\\\\s\\\\S]*?)})', 'gi')\nconst applyRegex = new RegExp('(@apply\\\\s.*?;)', 'gi')\nconst cssRegex =  new RegExp('((\\\\s*?(?:\\\\/\\\\*[\\\\s\\\\S]*?\\\\*\\\\/)?\\\\s*?@media[\\\\s\\\\S]*?){([\\\\s\\\\S]*?)}\\\\s*?})|(([\\\\s\\\\S]*?){([\\\\s\\\\S]*?)})', 'gi')\n\nexport function applyElementStyleToDocument(localName: string, style: string) {\n  let mixinsString = ''\n    const mixins = style.match(mixinRegex)\n    if (mixins) {\n      for (let i = 0; i < mixins.length; i++) {\n        // TODO: improve mixing regex and string handling.\n        const m = mixins[i].split(': {')\n        const name = m[0].replace(' --', '--')\n        const value = m[1].replace(/}/g, '').trim().replace(/^ +/gm, '')\n        mixinRecord[name] = value\n        mixinsString += mixins[i].replace(' --', '.').replace(': {', ' {')\n      }\n    }\n\n    // Remove mixins\n    style = style.replace(mixinRegex, '')\n\n    // Apply mixins\n    const apply = style.match(applyRegex)\n    if (apply) {\n      for (let i = 0; i < apply.length; i++) {\n        const name = apply[i].split('@apply ')[1].replace(';', '')\n        if (mixinRecord[name]) {\n          style = style.replace(apply[i], mixinRecord[name])\n        } else {\n          console.warn('IoElement: cound not find mixin:', name)\n        }\n      }\n    }\n\n    debug: {\n      let styleStripped = style\n      styleStripped = styleStripped.replace(commentsRegex, '')\n      styleStripped = styleStripped.replace(keyframeRegex, '')\n      styleStripped = styleStripped.replace(mediaQueryRegex, '')\n      const match = styleStripped.match(cssRegex)\n      if (match) {\n        match.forEach((selector: any) => {\n          selector = selector.trim()\n          if (!selector.startsWith(':host')) {\n            console.warn(localName + ': CSS Selector not prefixed with \":host\"! This will cause style leakage!')\n            console.warn(selector)\n          }\n        })\n      }\n    }\n\n    // Replace `:host` with element tag and add mixin CSS variables.\n    style = mixinsString + style.replace(new RegExp(':host', 'g'), localName)\n\n    const styleElement = document.createElement('style')\n    styleElement.innerHTML = style\n    styleElement.setAttribute('id', 'io-style-' + localName.replace('io-', ''))\n    document.head.appendChild(styleElement)\n}","import { Property, ReactiveProperty } from '../decorators/Property.js'\nimport { Register } from '../decorators/Register.js'\nimport { ProtoChain } from '../core/ProtoChain.js'\nimport { applyNativeElementProps, constructElement, disposeChildren, VDOMElement, toVDOM, NativeElementProps } from '../vdom/VDOM.js'\nimport { ReactiveNode, ReactivityType, dispose, bind, unbind, dispatchMutation, onPropertyMutated, setProperty, dispatchQueue, setProperties, initReactiveProperties, initProperties, ReactivePropertyDefinitions, ListenerDefinitions } from '../nodes/ReactiveNode.js'\nimport { Binding } from '../core/Binding.js'\nimport { applyElementStyleToDocument } from '../core/Style.js'\nimport { EventDispatcher, AnyEventListener } from '../core/EventDispatcher.js'\nimport { ChangeQueue } from '../core/ChangeQueue.js'\nimport { ReactivePropertyInstance } from '../core/ReactiveProperty.js'\nimport { throttle, debounce, CallbackFunction } from '../core/Queue.js'\n\nconst resizeObserver = new ResizeObserver(entries => {\n  for (const entry of entries) {\n    (entry.target as any).onResized()\n  }\n})\n\ntype prefix<TKey, TPrefix extends string> = TKey extends string ? `${TPrefix}${TKey}` : never\ntype AnyEventHandler = ((event: CustomEvent<any>) => void) |\n  ((event: PointerEvent) => void) |\n  ((event: KeyboardEvent) => void) |\n  ((event: MouseEvent) => void) |\n  ((event: TouchEvent) => void) |\n  ((event: WheelEvent) => void) |\n  ((event: InputEvent) => void) |\n  ((event: ClipboardEvent) => void) |\n  ((event: DragEvent) => void) |\n  ((event: FocusEvent) => void) |\n  ((event: TransitionEvent) => void) |\n  ((event: AnimationEvent) => void) |\n  ((event: ErrorEvent) => void) |\n  ((event: Event) => void)\n\nexport type IoElementProps = NativeElementProps & {\n  reactivity?: ReactivityType\n  [key: prefix<string, '@'>]: string | AnyEventHandler\n}\n\n@Register\nexport class IoElement extends HTMLElement {\n  declare static vConstructor: (arg0?: IoElementProps |\n    Array<VDOMElement | null> |\n    string, arg1?: Array<VDOMElement | null> |\n    string) => VDOMElement\n  static get Style() {\n    return /* css */`\n      :host {\n        display: block;\n        box-sizing: border-box;\n        -webkit-touch-callout: none;\n      }\n      :host[hidden] {\n        display: none;\n      }\n      --unselectable: {\n        user-select: none;\n        -webkit-user-select: none;\n        -webkit-touch-callout: none;\n        -webkit-tap-highlight-color: transparent;\n      }\n      --io_focus: {\n        border-color: var(--io_colorWhite) !important;\n        outline: var(--io_borderWidth) solid var(--io_borderColorBlue) !important;\n        z-index: 1;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: String, value: 'immediate'})\n  declare reactivity: ReactivityType\n\n  @Property(Object)\n  declare $: Record<string, HTMLElement | IoElement>\n\n  static get ReactiveProperties(): ReactivePropertyDefinitions {\n    return {}\n  }\n\n  static get Properties(): Record<string, any> {\n    return {}\n  }\n\n  static get Listeners(): ListenerDefinitions {\n    return {}\n  }\n\n  declare readonly _protochain: ProtoChain\n  declare readonly _reactiveProperties: Map<string, ReactivePropertyInstance>\n  declare readonly _bindings: Map<string, Binding>\n  declare readonly _changeQueue: ChangeQueue\n  declare readonly _eventDispatcher: EventDispatcher\n  declare _hasWindowMutationListener: boolean\n  declare _hasSelfMutationListener: boolean\n  declare readonly _isIoElement: boolean\n  declare _disposed: boolean\n  declare _textNode: Text\n\n  constructor(args: IoElementProps = {}) {\n    super()\n    this._protochain.init(this)\n\n    Object.defineProperty(this, '_changeQueue', {enumerable: false, configurable: true, value: new ChangeQueue(this)})\n    Object.defineProperty(this, '_reactiveProperties', {enumerable: false, configurable: true, value: new Map()})\n    Object.defineProperty(this, '_bindings', {enumerable: false, configurable: true, value: new Map()})\n    Object.defineProperty(this, '_eventDispatcher', {enumerable: false, configurable: true, value: new EventDispatcher(this)})\n    Object.defineProperty(this, '_hasWindowMutationListener', {enumerable: false, configurable: true, writable: true, value: false})\n    Object.defineProperty(this, '_hasSelfMutationListener', {enumerable: false, configurable: true, writable: true, value: false})\n    // Object.defineProperty(this, '_parents', {enumerable: false, configurable: true, value: []});\n\n    this.init()\n\n    initReactiveProperties(this)\n    initProperties(this)\n\n    this.applyProperties(args, true)\n\n    this.ready()\n    this.dispatchQueue()\n  }\n  // TODO: add types\n  applyProperties(props: any, skipDispatch = false) {\n    for (const name in props) {\n      if (this._reactiveProperties.has(name)) {\n        this.setProperty(name, props[name], true)\n      } else {\n        if (name === 'class') {\n          this.className = props[name]\n        } else if (name === 'style') {\n          for (const s in props[name]) {\n            // TODO: Consider supporting importance\n            this.style[s as any] = props[name][s]\n          }\n        } else if (name.startsWith('data-')) {\n          // TODO: Test this!\n          if (props[name] === undefined) {\n            this.removeAttribute(name)\n          } else {\n            this.setAttribute(name, props[name])\n          }\n        } else if (!name.startsWith('@')) {\n          debug: if (props[name] as any instanceof Binding) {\n            console.warn(`IoElement: Not a ReactiveProperty! Cannot set binding to \"${name}\" property on element \"${this.localName}\"`)\n          }\n          this[name as keyof this] = props[name]\n          // TODO: test and check if type can be attribute.\n          if (props[name] === undefined && this.hasAttribute(name)) {\n            this.removeAttribute(name)\n          }\n        }\n      }\n    }\n    this._eventDispatcher.applyPropListeners(props)\n    if (!skipDispatch) this.dispatchQueue()\n  }\n  // TODO: add types\n  setProperties(props: any) {\n    setProperties(this, props)\n  }\n  setProperty(name: string, value: any, debounce = false) {\n    if (this._disposed) return\n    setProperty(this, name, value, debounce)\n    const prop = this._reactiveProperties.get(name)!\n    if (prop.reflect) this.setAttribute(name.toLowerCase(), value)\n  }\n  init() {}\n  ready() {}\n  changed() {}\n  get [Symbol.toStringTag]() {\n    return this.constructor.name\n  }\n  queue(name: string, value: any, oldValue: any) {\n    this._changeQueue.queue(name, value, oldValue)\n  }\n  dispatchQueue(debounce = false) {\n    dispatchQueue(this, debounce)\n  }\n  throttle(func: CallbackFunction, arg?: any, timeout = 1) {\n    throttle(func, arg, this, timeout)\n  }\n  debounce(func: CallbackFunction, arg?: any, timeout = 1) {\n    debounce(func, arg, this, timeout)\n  }\n  onPropertyMutated(event: CustomEvent) {\n    return onPropertyMutated(this, event)\n  };\n  dispatchMutation(object: object | ReactiveNode = this, properties: string[] = []) {\n    dispatchMutation(this, object, properties)\n  }\n  bind(name: string): Binding {\n    return bind(this, name)\n  }\n  unbind(name: string): void {\n    unbind(this, name)\n  }\n  addEventListener(type: string, listener: AnyEventListener, options?: AddEventListenerOptions) {\n    if (this._disposed) return\n    this._eventDispatcher.addEventListener(type, listener as EventListener, options)\n  }\n  removeEventListener(type: string, listener?: AnyEventListener, options?: AddEventListenerOptions) {\n    if (this._disposed) return\n    this._eventDispatcher.removeEventListener(type, listener as EventListener, options)\n  }\n  dispatch(type: string, detail: any = undefined, bubbles = false, src?: ReactiveNode | HTMLElement | Document | Window) {\n    if (this._disposed) return\n    this._eventDispatcher.dispatchEvent(type, detail, bubbles, src)\n  }\n  dispose() {\n    dispose(this)\n  }\n\n  connectedCallback() {\n    if (typeof (this as any).onResized === 'function') {\n      resizeObserver.observe(this)\n    }\n  }\n  disconnectedCallback() {\n    if (typeof (this as any).onResized === 'function') {\n      resizeObserver.unobserve(this)\n    }\n  }\n\n  /**\n   * Renders DOM from virtual DOM arrays.\n   * @param {Array} vDOMElements - Array of VDOMElement[] children.\n   * @param {HTMLElement} [host] - Optional template target.\n   * @param {boolean} [noDispose] - Skip disposal of existing elements.\n   */\n  render(vDOMElements: Array<VDOMElement | null>, host?: HTMLElement | IoElement, noDispose?: boolean) {\n    host = (host || this) as any\n    const vDOMElementsOnly = vDOMElements.filter(item => item !== null)\n    this.$ = {}\n    this.traverse(vDOMElementsOnly, host as HTMLElement, noDispose)\n  }\n  /**\n   * Recurively traverses virtual DOM elements.\n   * TODO: test element.traverse() function!\n   * @param {Array} vDOMElements - Array of VDOMElements elements.\n   * @param {HTMLElement} [host] - Optional template target.\n   * @param {boolean} [noDispose] - Skip disposal of existing elements.\n   */\n  traverse(vChildren: VDOMElement[], host: HTMLElement | IoElement, noDispose?: boolean) {\n    const children = host.children\n    // remove trailing elements\n    while (children.length > vChildren.length) {\n      const child = children[children.length - 1]\n      host.removeChild(child)\n      if (!noDispose) disposeChildren(child as IoElement)\n    }\n    // replace elements\n    for (let i = 0; i < children.length; i++) {\n      const child = children[i] as HTMLElement | IoElement\n      // replace existing elements\n      if (child.localName !== vChildren[i].tag || noDispose) {\n        const oldElement = child as HTMLElement\n        const element = constructElement(vChildren[i])\n        host.insertBefore(element, oldElement)\n        host.removeChild(oldElement)\n        if (!noDispose) disposeChildren(oldElement as IoElement)\n      // update existing elements\n      } else {\n        // TODO: improve setting/removal/cleanup of native element properties/attributes.\n        child.removeAttribute('className')\n        child.removeAttribute('style')\n        if (vChildren[i].props) {\n          if ((child as IoElement)._isIoElement) {\n            // Set IoElement element properties\n            (child as IoElement).applyProperties(vChildren[i].props as Record<keyof this, any>)\n          } else {\n            // Set native HTML element properties\n            applyNativeElementProps(child as HTMLElement, vChildren[i].props!)\n          }\n        }\n      }\n    }\n    // TODO: doing this before \"replace elements\" cached (noDispose) elements to be created twice.\n    // TODO: rename nodispose to dispose.\n    // TODO: test\n    // create new elements after existing\n    if (children.length < vChildren.length) {\n      const frag = document.createDocumentFragment()\n      for (let i = children.length; i < vChildren.length; i++) {\n        const element = constructElement(vChildren[i])\n        frag.appendChild(element)\n      }\n      host.appendChild(frag)\n    }\n    for (let i = 0; i < vChildren.length; i++) {\n      const vChild = vChildren[i]\n      const child = children[i] as HTMLElement | IoElement\n      if (vChild.props?.id) {\n        // Update this.$ map of ids.\n        debug: {\n          if (this.$[vChild.props!.id] !== undefined) {\n            console.warn(`IoElement: Duplicate id in template. \"${vChild.props!.id}\"`)\n          }\n        }\n        this.$[vChild.props!.id] = child\n      }\n      if (vChild.children !== undefined) {\n        if (typeof vChild.children === 'string') {\n          // Set textNode value.\n          this._flattenTextNode(child as HTMLElement);\n          (child as IoElement)._textNode.nodeValue = String(vChild.children)\n        } else if (vChild.children instanceof Array) {\n          if (!(child as IoElement)._isIoElement) {\n            const vDOMElementsOnly = (vChild.children as Array<VDOMElement | null>).filter(item => item !== null)\n            this.traverse(vDOMElementsOnly, child as HTMLElement, noDispose)\n          }\n        }\n      } else if (!(child as IoElement)._isIoElement) {\n        // Clear children for native elements. IoElements manage their own children by design\n        child.textContent = ''\n      }\n    }\n  }\n\n  /**\n  * Helper function to flatten textContent into a single TextNode.\n  * Update textContent via TextNode is better for layout performance.\n  * TODO: Consider using normalize()? Is it the same function?\n  * @param {HTMLElement} element - Element to flatten.\n  */\n  _flattenTextNode(element: HTMLElement | IoElement) {\n    if (element.childNodes.length === 0) {\n      element.appendChild(document.createTextNode(''))\n    }\n    if (element.childNodes[0].nodeName !== '#text') {\n      element.innerHTML = ''\n      element.appendChild(document.createTextNode(''))\n    }\n    (element as IoElement)._textNode = element.childNodes[0] as Text\n    if (element.childNodes.length > 1) {\n      const textContent = element.textContent\n      for (let i = element.childNodes.length; i--;) {\n        if (i !== 0) element.removeChild(element.childNodes[i])\n      }\n      (element as IoElement)._textNode.nodeValue = textContent\n    }\n  }\n  /**\n  * Alias for HTMLElement setAttribute where falsey values remove the attribute.\n  * @param {string} attr - Attribute name.\n  * @param {*} value - Attribute value.\n  */\n  setAttribute(attr: string, value: boolean | number | string) {\n    if (value === true) {\n      HTMLElement.prototype.setAttribute.call(this, attr, '')\n    } else if (value === false || value === '') {\n      this.removeAttribute(attr)\n    } else if (typeof value === 'string' || typeof value === 'number') {\n      if (this.getAttribute(attr) !== String(value)) HTMLElement.prototype.setAttribute.call(this, attr, String(value))\n    }\n  }\n  /**\n   * Returns a vDOM-like representation of the element with children and attributes. This feature is used in testing.\n   */\n  toVDOM() {\n    return toVDOM(this)\n  }\n  Register(ioNodeConstructor: typeof IoElement) {\n    Object.defineProperty(ioNodeConstructor.prototype, '_protochain', {value: new ProtoChain(ioNodeConstructor)})\n\n    const localName = ioNodeConstructor.name.replace(/([a-z])([A-Z,0-9])/g, '$1-$2').toLowerCase()\n\n    Object.defineProperty(ioNodeConstructor.prototype, 'localName', {value: localName})\n    Object.defineProperty(ioNodeConstructor.prototype, '_isIoElement', {enumerable: false, value: true, writable: false})\n    Object.defineProperty(window, ioNodeConstructor.name, {value: ioNodeConstructor})\n\n    window.customElements.define(localName, ioNodeConstructor as unknown as CustomElementConstructor)\n\n    applyElementStyleToDocument(localName, ioNodeConstructor.prototype._protochain.style)\n\n    // TODO: Define all overloads with type guards.\n    // TODO: Add runtime debug type checks.\n    // TODO: Test thoroughly.\n    Object.defineProperty(ioNodeConstructor, 'vConstructor', {\n        value: function(arg0?: IoElementProps | Array<VDOMElement | null> | string,\n        arg1?: Array<VDOMElement | null> | string): VDOMElement {\n      const vDOMElement: VDOMElement = {tag: localName}\n      if (arg0 !== undefined) {\n        if (typeof arg0 === 'string') {\n          vDOMElement.children = arg0\n        } else if (arg0 instanceof Array) {\n          vDOMElement.children = arg0\n        } else if (typeof arg0 === 'object') {\n          vDOMElement.props = arg0\n        }\n        if (arg1 !== undefined) {\n          if (typeof arg1 === 'string') {\n            vDOMElement.children = arg1\n          } else if (arg1 instanceof Array) {\n            vDOMElement.children = arg1\n          }\n        }\n      }\n      return vDOMElement\n    }})\n  }\n}\n\nexport const ioElement = IoElement.vConstructor","import { Register } from '../decorators/Register.js'\nimport { ProtoChain } from '../core/ProtoChain.js'\nimport { Binding } from '../core/Binding.js'\nimport { ChangeQueue } from '../core/ChangeQueue.js'\nimport { ReactivePropertyInstance, ReactivePropertyDefinitionLoose } from '../core/ReactiveProperty.js'\nimport { EventDispatcher, ListenerDefinitionLoose, AnyEventListener } from '../core/EventDispatcher.js'\nimport { NodeArray } from '../core/NodeArray.js'\nimport { throttle, debounce, CallbackFunction } from '../core/Queue.js'\nimport { ReactiveProperty } from '../decorators/Property.js'\nimport { IoElement } from '../elements/IoElement.js'\n\nexport type AnyConstructor = new (...args: any[]) => unknown\nexport type ReactivePropertyDefinitions = Record<string, ReactivePropertyDefinitionLoose>\n\nexport type ListenerDefinitions = {\n  [key: string]: ListenerDefinitionLoose\n}\nexport interface ReactiveNodeConstructor {\n  ReactiveProperties?: ReactivePropertyDefinitions\n  Properties?: Record<string, any>\n  Listeners?: ListenerDefinitions\n  Style?: string\n  name?: string\n  prototype: ReactiveNodeConstructor | object | HTMLElement\n}\n\nexport const NODES = {\n  active: new Set<ReactiveNode>(),\n  disposed: new WeakSet<ReactiveNode>(),\n}\n\nexport type ReactivityType = 'immediate' | 'throttled' | 'debounced'\n\n// Utility type to add Binding to all properties of a type\nexport type WithBinding<T> = T | Binding\n\ntype prefix<TKey, TPrefix extends string> = TKey extends string ? `${TPrefix}${TKey}` : never\ntype AnyEventHandler = (\n  (event: CustomEvent<any>) => void) |\n  ((event: PointerEvent) => void) |\n  ((event: KeyboardEvent) => void) |\n  ((event: MouseEvent) => void) |\n  ((event: TouchEvent) => void) |\n  ((event: WheelEvent) => void) |\n  ((event: InputEvent) => void) |\n  ((event: ClipboardEvent) => void) |\n  ((event: DragEvent) => void) |\n  ((event: FocusEvent) => void) |\n  ((event: TransitionEvent) => void) |\n  ((event: AnimationEvent) => void) |\n  ((event: ErrorEvent) => void) |\n  ((event: Event) => void)\n\nexport type ReactiveNodeProps = {\n  reactivity?: ReactivityType\n  [key: prefix<string, '@'>]: string | AnyEventHandler\n}\n\n\nfunction isIoObject(value: any) {\n  return (typeof value === 'object' && value !== null && (value._isNode || value._isIoElement))\n}\n\nfunction hasValueAtOtherProperty(node: ReactiveNode | IoElement, prop: ReactivePropertyInstance, value: any): boolean {\n  let found = false\n  node._reactiveProperties.forEach((p) => {\n    if (p !== prop && p.value === value) found = true\n  })\n  return found\n}\n\n@Register\nexport class ReactiveNode extends Object {\n\n  @ReactiveProperty({type: String, value: 'immediate'})\n  declare reactivity: ReactivityType\n\n  static get ReactiveProperties(): ReactivePropertyDefinitions {\n    return {}\n  }\n\n  static get Properties(): Record<string, any> {\n    return {}\n  }\n\n  static get Listeners(): ListenerDefinitions {\n    return {}\n  }\n\n  declare readonly _protochain: ProtoChain\n  declare readonly _reactiveProperties: Map<string, ReactivePropertyInstance>\n  declare readonly _bindings: Map<string, Binding>\n  declare readonly _changeQueue: ChangeQueue\n  declare readonly _eventDispatcher: EventDispatcher\n  declare readonly _parents: Array<ReactiveNode | IoElement>\n  declare readonly _isNode: boolean\n  declare readonly _isIoElement: boolean\n  declare _disposed: boolean\n\n  constructor(args?: any) {\n    super()\n    this._protochain.init(this)\n\n    Object.defineProperty(this, '_changeQueue', {enumerable: false, configurable: true, value: new ChangeQueue(this)})\n    Object.defineProperty(this, '_reactiveProperties', {enumerable: false, configurable: true, value: new Map()})\n    Object.defineProperty(this, '_bindings', {enumerable: false, configurable: true, value: new Map()})\n    Object.defineProperty(this, '_eventDispatcher', {enumerable: false, configurable: true, value: new EventDispatcher(this)})\n    Object.defineProperty(this, '_parents', {enumerable: false, configurable: true, value: []})\n\n    this.init()\n\n    initReactiveProperties(this)\n    initProperties(this)\n\n    this.applyProperties(typeof args === 'object' ? args : {}, true)\n\n    NODES.active.add(this)\n\n    this.ready()\n    this.dispatchQueue()\n  }\n  // TODO: add types\n  applyProperties(props: any, skipDispatch = false) {\n    for (const name in props) {\n      if (this._reactiveProperties.has(name)) {\n        this.setProperty(name, props[name], true)\n      } else {\n        if (!name.startsWith('@')) {\n          this[name as keyof this] = props[name]\n          debug: if (props[name] instanceof Binding) {\n            console.warn(`IoElement: Not a ReactiveProperty! Cannot set binding to \"${name}\" property on \"${this.constructor.name}\"`)\n          }\n        }\n      }\n    }\n    this._eventDispatcher.applyPropListeners(props)\n    if (!skipDispatch) this.dispatchQueue()\n  }\n  // TODO: add types\n  setProperties(props: any) {\n    setProperties(this, props)\n  }\n  setProperty(name: string, value: any, debounce = false) {\n    if (this._disposed) return\n    setProperty(this, name, value, debounce)\n  }\n  init() {}\n  ready() {}\n  changed() {}\n  get [Symbol.toStringTag]() {\n    return this.constructor.name\n  }\n  queue(name: string, value: any, oldValue: any) {\n    this._changeQueue.queue(name, value, oldValue)\n  }\n  dispatchQueue(debounce = false) {\n    dispatchQueue(this, debounce)\n  }\n  throttle(func: CallbackFunction, arg?: any, timeout = 1) {\n    throttle(func, arg, this, timeout)\n  }\n  debounce(func: CallbackFunction, arg?: any, timeout = 1) {\n    debounce(func, arg, this, timeout)\n  }\n  onPropertyMutated(event: CustomEvent) {\n    return onPropertyMutated(this, event)\n  }\n  dispatchMutation(object: object | ReactiveNode = this, properties: string[] = []) {\n    dispatchMutation(this, object, properties)\n  }\n  bind(name: string): Binding {\n    return bind(this, name)\n  }\n  unbind(name: string): void {\n    unbind(this, name)\n  }\n  addEventListener(type: string, listener: AnyEventListener, options?: AddEventListenerOptions) {\n    this._eventDispatcher.addEventListener(type, listener as EventListener, options)\n  }\n  removeEventListener(type: string, listener?: AnyEventListener, options?: AddEventListenerOptions) {\n    this._eventDispatcher.removeEventListener(type, listener as EventListener, options)\n  }\n  dispatch(type: string, detail: any = undefined, bubbles = false, src?: ReactiveNode | HTMLElement | Document | Window) {\n    this._eventDispatcher.dispatchEvent(type, detail, bubbles, src)\n  }\n  addParent(parent: ReactiveNode | IoElement) {\n    if ((parent as ReactiveNode)._isNode || (parent as IoElement)._isIoElement) {\n      this._parents.push(parent)\n    }\n  }\n  removeParent(parent: ReactiveNode | IoElement) {\n    if (this._disposed) return\n    if ((parent as ReactiveNode)._isNode || (parent as IoElement)._isIoElement) {\n      const index = this._parents.indexOf(parent)\n      if (index !== -1) {\n        this._parents.splice(index, 1)\n      } else {\n        debug: console.warn('ReactiveNode.removeParent(): Parent not found!', this, parent)\n      }\n    }\n  }\n  dispose() {\n    dispose(this)\n    NODES.active.delete(this)\n    NODES.disposed.add(this)\n  }\n  Register(ioNodeConstructor: typeof ReactiveNode) {\n    Object.defineProperty(ioNodeConstructor.prototype, '_isNode', {enumerable: false, value: true, writable: false})\n    Object.defineProperty(ioNodeConstructor.prototype, '_isIoElement', {enumerable: false, value: false, writable: false})\n    Object.defineProperty(ioNodeConstructor.prototype, '_protochain', {value: new ProtoChain(ioNodeConstructor)})\n  }\n}\n\nexport function initReactiveProperties(node: ReactiveNode | IoElement) {\n  for (const name in node._protochain.reactiveProperties) {\n    Object.defineProperty(node, name, {\n      get: function() {\n        return node._reactiveProperties.get(name)!.value\n      },\n      set: function(value) {\n        node.setProperty(name, value)\n      },\n      configurable: true,\n      enumerable: true,\n    })\n    const property = new ReactivePropertyInstance(node, node._protochain.reactiveProperties[name])\n    node._reactiveProperties.set(name, property)\n    if (property.binding) property.binding.addTarget(node, name)\n\n    property.observer.start(property.value)\n    if (property.value?._isNode) {\n      property.value.addParent(node)\n    }\n\n    if (node instanceof IoElement) {\n      if (property.reflect && property.value !== undefined && property.value !== null) {\n        node.setAttribute(name, property.value)\n      }\n    }\n  }\n}\nexport function initProperties(node: ReactiveNode | IoElement) {\n  for (const name in node._protochain.properties) {\n    let initialValue = node._protochain.properties[name]\n    if (typeof initialValue === 'function') {\n      initialValue = new initialValue()\n    } else if (initialValue instanceof Array) {\n      initialValue = initialValue.slice()\n    } else if (typeof initialValue === 'object') {\n      initialValue = Object.assign({}, initialValue)\n    }\n    (node as any)[name] = initialValue\n  }\n}\nexport function setProperties(node: ReactiveNode | IoElement, props: any) {\n  for (const name in props) {\n    if (!node._reactiveProperties.has(name)) {\n      debug: console.warn(`Property \"${name}\" is not defined`, node)\n      continue\n    }\n    node.setProperty(name, props[name], true)\n  }\n  node.dispatchQueue()\n}\nexport function setProperty(node: ReactiveNode | IoElement, name: string, value: any, debounce = false) {\n  const prop = node._reactiveProperties.get(name)!\n  const oldValue = prop.value\n\n  if (value !== oldValue) {\n    const binding = (value instanceof Binding) ? value : null\n    if (binding) {\n      const oldBinding = prop.binding\n      if (binding !== oldBinding) {\n        if (oldBinding) {\n          oldBinding.removeTarget(node, name)\n        }\n        binding.addTarget(node, name)\n        // NOTE: We return here because binding.setTarget() will trigger execution of setProperty() again.\n        return\n      } else {\n        // NOTE: This was a remedy for an old bug that might not be relevant anymore.\n        // Whenusing change() > template() > setProperties() to batch-set multiple properties with bindings,\n        // it used to cause all but one of those properties to be reset to original value once parent changed.\n        // This ugly hack fixed the bug by setting binding value from target when binding already exists.\n        // TODO: keep an eye on this and remove if not needed.\n        // binding.value = value = prop.value;\n        return\n      }\n    }\n\n    // TODO: test!\n    // TODO: Document magic!\n    if (prop.type === NodeArray && value.constructor === Array) {\n      const nodeArray = prop.value as NodeArray<ReactiveNode>\n\n      debug: if ((value as Array<any>).some(item => !item._isNode)) {\n        console.error(`Node: Property \"${name}\" should be assigned as an Array of nodes!`, value)\n      }\n      debug: if (nodeArray.constructor !== NodeArray) {\n        console.error(`Node: Property \"${name}\" should be initialized as a NodeArray!`, nodeArray)\n      }\n\n      // TODO: test, benchmark!\n      nodeArray.withInternalOperation(() => {\n        nodeArray.length = 0\n        nodeArray.push(...value as Array<ReactiveNode>)\n        if (value.length === 0) {\n          nodeArray.dispatchMutation()\n        }\n      })\n      return\n    }\n\n    // TODO: Untangle and redesign this mess! P0\n    const oldValueShared = hasValueAtOtherProperty(node, prop, oldValue)\n    if (!oldValueShared) {\n      prop.observer.stop(oldValue)\n      if (oldValue?._isNode && !oldValue._disposed) {\n        oldValue.removeParent(node)\n      }\n    } else {\n      prop.observer.observing = false\n    }\n\n    prop.value = value\n\n    if (!hasValueAtOtherProperty(node, prop, value)) {\n      prop.observer.start(value)\n      if (value?._isNode) {\n        value.addParent(node)\n      }\n    }\n\n    debug: {\n      if (prop.type === String) {\n        if (typeof value !== 'string') {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      } else if (prop.type === Number) {\n        if (typeof value !== 'number') {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      } else if (prop.type === Boolean) {\n        if (typeof value !== 'boolean') {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      } else if (prop.type === Array) {\n        if (!(value instanceof Array)) {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      } else if (prop.type === Object) {\n        if (value instanceof Array) {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      } else if (prop.type === NodeArray) {\n        if (!(value instanceof NodeArray)) {\n          console.error(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n        if ((value as Array<any>).some(item => !item._isNode)) {\n          console.error(`Wrong type of property \"${name}\". NodeArray items should be nodes!`, value)\n        }\n      } else if (typeof prop.type === 'function') {\n        if (!(value instanceof prop.type)) {\n          console.warn(`Wrong type of property \"${name}\". Value: \"${value}\". Expected type: ${prop.type.name}`, node)\n        }\n      }\n    }\n    if (oldValue !== value) {\n      node.queue(name, value, oldValue)\n      node.dispatchQueue(debounce)\n    }\n  }\n}\nexport function dispatchQueue(node: ReactiveNode | IoElement, debounce = false) {\n  if (node.reactivity === 'debounced' || debounce || node._changeQueue.dispatching) {\n    node.debounce(node._changeQueue.dispatch)\n  } else if (node.reactivity === 'throttled') {\n    node.throttle(node._changeQueue.dispatch)\n  } else if (node.reactivity === 'immediate') {\n    node._changeQueue.dispatch()\n  }\n  debug: if (['immediate', 'throttled', 'debounced'].indexOf(node.reactivity) === -1) {\n    console.warn(`ReactiveNode.dispatchQueue(): Invalid reactivity property value: \"${node.reactivity}\".\n      Expected one of: \"immediate\", \"throttled\", \"debounced\".`)\n  }\n}\n\n// TODO: Consider using global event bus for all mutation events!\nexport function dispatchMutation(node: ReactiveNode | IoElement, object: object | ReactiveNode, properties: string[]) {\n  if (isIoObject(object)) {\n    node.dispatch('io-object-mutation', {object, properties})\n  } else {\n    node.dispatch('io-object-mutation', {object, properties}, false, window)\n  }\n}\nexport function onPropertyMutated(node: ReactiveNode | IoElement, event: CustomEvent) {\n  const object = event.detail.object\n\n  let hasMutated = false\n  node._reactiveProperties.forEach((prop, name) => {\n    if (prop.observer.observing && prop.value === object) {\n      const handlerName = name + 'Mutated' as keyof ReactiveNode\n      if (typeof (node as ReactiveNode)[handlerName] === 'function') {\n        (node as any)[handlerName](event)\n      }\n      hasMutated = true\n    }\n  })\n  return hasMutated\n}\nexport function bind(node: ReactiveNode | IoElement, name: string) {\n  debug: if (!node._reactiveProperties.has(name)) {\n    console.warn(`IoGUI Node: cannot bind to ${name} property. Does not exist!`)\n  }\n  if (!node._bindings.has(name)) {\n    node._bindings.set(name, new Binding(node, name))\n  }\n  return node._bindings.get(name)! as Binding\n}\nexport function unbind(node: ReactiveNode | IoElement, name: string) {\n  const binding = node._bindings.get(name)\n  if (binding) {\n    binding.dispose()\n    node._bindings.delete(name)\n  }\n  const property = node._reactiveProperties.get(name)\n  property?.binding?.removeTarget(node, name)\n}\nexport function dispose(node: ReactiveNode | IoElement) {\n  debug: if (node._disposed) {\n    console.warn('ReactiveNode.dispose(): Already disposed!', node.constructor.name)\n  }\n\n  if (node._disposed) return\n\n  node._bindings.forEach((binding, name) => {\n    binding.dispose()\n    node._bindings.delete(name)\n  })\n  delete (node as any)._bindings\n\n  node._changeQueue.dispose()\n  delete (node as any)._changeQueue\n\n  node._reactiveProperties.forEach((property, name) => {\n    property.binding?.removeTarget(node, name)\n    property.observer.stop(property.value)\n    property.observer.dispose()\n  })\n\n  for (const name in node._protochain.properties) {\n    delete (node as ReactiveNode)[name as keyof ReactiveNode]\n  }\n  delete (node as any)._protochain\n\n  // NOTE: _eventDispatcher.dispose must happen AFTER disposal of bindings!\n  node._eventDispatcher.dispose()\n  delete (node as any)._eventDispatcher\n  delete (node as any)._reactiveProperties\n\n  if ((node as any)._parents) {\n    (node as any)._parents.length = 0\n    delete (node as any)._parents\n  }\n\n  Object.defineProperty(node, '_disposed', {value: true})\n};","import { ReactiveProperty } from '../decorators/Property.js'\nimport { Register } from '../decorators/Register.js'\nimport { Binding } from '../core/Binding.js'\nimport { ReactiveNode, ReactiveNodeProps, AnyConstructor } from '../nodes/ReactiveNode.js'\n\nclass EmulatedLocalStorage {\n  declare store: Map<string, unknown>\n  declare warned: boolean\n  constructor() {\n    Object.defineProperty(this, 'store', {value: new Map()})\n    Object.defineProperty(this, 'warned', {value: false, writable: true})\n  }\n  get permitted(): boolean {\n    try {\n      return self.localStorage.getItem('Storage:user-permitted') === 'true'\n    } catch (error) {\n      console.warn('Storage: Cannot access localStorage. Check browser privacy settings!')\n      console.warn(error)\n    }\n    return false\n  }\n  set permitted(permitted: boolean) {\n    try {\n      if (permitted) {\n        console.info('Storage: localStorage permission granted.')\n        this.store.set('Storage:user-permitted', String(permitted))\n        this.store.forEach((value: unknown, key: string) => {\n          self.localStorage.setItem(key, String(value))\n          this.store.delete(key)\n        })\n      } else {\n        console.info('Storage: localStorage permission revoked.')\n        self.localStorage.setItem('Storage:user-permitted', String(permitted))\n        new Map(Object.entries(self.localStorage)).forEach((value: unknown, key: string) => {\n          this.store.set(key, value)\n        })\n        self.localStorage.clear()\n      }\n    } catch (error) {\n      console.warn('Storage: Cannot access localStorage. Check browser privacy settings!')\n      console.warn(error)\n    }\n  }\n  setItem(key: string, value: unknown) {\n    const strValue = typeof value === 'object' ? JSON.stringify(value) : String(value)\n    if (key === 'Storage:user-permitted') {\n      this.permitted = value === 'true'\n      return\n    }\n    if (this.permitted) {\n      self.localStorage.setItem(key, strValue)\n    } else {\n      this.store.set(key, strValue)\n      if (!this.warned && !this.permitted) {\n        console.warn('Storage: localStorage permission not set.')\n        this.warned = true\n      }\n    }\n  }\n  getItem(key: string): string | null {\n    if (this.permitted) {\n      return self.localStorage.getItem(key)\n    } else if (this.store.has(key)) {\n      return this.store.get(key) as string\n    }\n    return null\n  }\n  removeItem(key: string) {\n    if (this.permitted) {\n      return self.localStorage.removeItem(key)\n    } else {\n      this.store.delete(key)\n    }\n  }\n  clear() {\n    if (this.permitted) {\n      return self.localStorage.clear()\n    } else {\n      this.store.clear()\n    }\n  }\n}\n\nconst localStorage = new EmulatedLocalStorage()\n\ntype StorageNodes = {\n  local: Map<string, StorageNode>\n  hash: Map<string, StorageNode>\n  none: Map<string, StorageNode>\n}\n\nconst nodes: StorageNodes = {\n  local: new Map(),\n  hash: new Map(),\n  none: new Map(),\n}\n\nlet hashValues: Record<string, any> = {}\n\nexport type StorageProps = ReactiveNodeProps & {\n  key: string\n  value: any\n  default?: any\n  storage?: 'hash' | 'local' | 'none'\n}\n\n@Register\nexport class StorageNode extends ReactiveNode {\n\n  @ReactiveProperty({value: '', type: String})\n  declare key: string\n\n  @ReactiveProperty()\n  declare value: any\n\n  @ReactiveProperty({value: 'local', type: String})\n  declare storage: 'hash' | 'local' | 'none'\n\n  declare binding: Binding\n\n  declare default: any\n\n  constructor(props: StorageProps) {\n    debug: {\n      if (typeof props !== 'object') {\n        console.warn('Ivalid Storage arguments!')\n      } else {\n        if (typeof props.key !== 'string' || !props.key)\n          console.warn('Ivalid Storage key!')\n        if (props.storage && ['hash', 'local', 'none'].indexOf(props.storage) === -1)\n          console.warn(`Ivalid storage type! ${props.storage}`)\n      }\n    }\n\n    if (props.storage === undefined) props.storage = 'local'\n    if (nodes[props.storage].has(props.key)) {\n      return nodes[props.storage].get(props.key)!\n    } else {\n      let def: any\n      // TODO: test!\n      let constructor: AnyConstructor | undefined\n      if (typeof props.value === 'object' && props.value !== null) {\n        constructor = props.value.constructor as AnyConstructor\n        def = JSON.stringify(props.value)\n      } else {\n        def = props.value\n      }\n\n      props.default = def\n\n      let storedValue: string | null = null\n      switch (props.storage) {\n        case 'hash':\n          storedValue = getValueFromHash(props.key)\n          break\n        case 'local':\n          storedValue = localStorage.getItem('Storage:' + props.key)\n          break\n      }\n      if (storedValue !== null) {\n        try {\n          const value = JSON.parse(storedValue)\n          props.value = constructor ? new constructor(value) : value\n        } catch {\n          props.value = storedValue\n        }\n      }\n\n      super(props)\n\n      this.binding = this.bind('value')\n      this.binding.dispose = () => {\n        this.clearStorage()\n      }\n\n      if (props.key !== '__proto__') { // TODO: Why is this here ffs?\n        nodes[props.storage].set(props.key, this)\n      }\n\n      return this\n    }\n  }\n  dispose() {\n    this.clearStorage()\n    super.dispose()\n  }\n  clearStorage() {\n    switch (this.storage) {\n      case 'hash': {\n        this.removeValueToHash()\n        break\n      }\n      case 'local': {\n        localStorage.removeItem('Storage:' + this.key)\n        break\n      }\n    }\n    const s = (this.storage) as keyof StorageNodes\n    nodes[s].delete(this.key)\n  }\n  valueMutated() {\n    this.debounce(this.changed)\n    // this.changed()\n  }\n  valueChanged() {\n    this.changed()\n  }\n  changed() {\n    switch (this.storage) {\n      case 'hash': {\n        this.saveValueToHash()\n        break\n      }\n      case 'local': {\n        if (this.value === this.default || this.value === null || this.value === undefined) {\n          localStorage.removeItem('Storage:' + this.key)\n        } else {\n          if (typeof this.value !== 'object') {\n            if (typeof this.value === 'string') {\n              localStorage.setItem('Storage:' + this.key, `\"${this.value}\"`)\n            } else if (typeof this.value === 'number') {\n              localStorage.setItem('Storage:' + this.key, this.value)\n            }\n          } else {\n            localStorage.setItem('Storage:' + this.key, JSON.stringify(this.value))\n          }\n        }\n        break\n      }\n    }\n  }\n  removeValueToHash() {\n    hashValues = parseHash(self.location.hash)\n    delete hashValues[this.key]\n\n    let hashString = ''\n    for (const h in hashValues) {\n      hashString += h + '=' + hashValues[h] + '&'\n    }\n    if (hashString) {\n      hashString = hashString.slice(0, -1)\n      self.location.hash = hashString\n    } else {\n      history.replaceState('', document.title, self.location.pathname + self.location.search)\n    }\n  }\n  saveValueToHash() {\n    hashValues = parseHash(self.location.hash)\n\n    const value = this.value\n\n    if (value === this.default || value === null || value === undefined) {\n      delete hashValues[this.key]\n    } else {\n      if (typeof value === 'string') {\n        if (isNaN(value as unknown as number)) {\n          hashValues[this.key] = String(value)\n        } else {\n          hashValues[this.key] = '\"' + value + '\"'\n        }\n      } else if (typeof value === 'number') {\n        hashValues[this.key] = String(value)\n      } else if (typeof value === 'boolean') {\n        hashValues[this.key] = String(value)\n      } else {\n        debug: {\n          console.warn('Storage: Cannot serialize value to hash!', value)\n        }\n      }\n    }\n\n    let hashString = ''\n    for (const h in hashValues) {\n      hashString += h + '=' + hashValues[h] + '&'\n    }\n    if (hashString) {\n      hashString = hashString.slice(0, -1)\n      self.location.hash = hashString\n    } else {\n      history.replaceState('', document.title, self.location.pathname + self.location.search)\n    }\n  }\n}\n\n\nexport const Storage = Object.assign(\n  (props: StorageProps) => {\n    const storageNode = new StorageNode(props)\n    return storageNode.binding\n  }, {\n    permit() {\n      localStorage.permitted = true\n    },\n    unpermit() {\n      localStorage.permitted = false\n    }\n  }\n)\n\n// TODO: unhack and test\nfunction parseHash(hash: string) {\n  return hash.substring(1).split('&').reduce(function (result: Record<string, string>, item) {\n    const parts = item.split('=')\n    if (parts[0] && parts[1]) {\n      result[parts[0]] = parts[1].replace(/%22/g, '\"').replace(/%20/g, ' ')\n    }\n    return result\n  }, {})\n}\n\nfunction getValueFromHash(key: string) {\n  hashValues = parseHash(self.location.hash)\n  return hashValues[key] || null\n}\n\nfunction updateAllFromHash() {\n  hashValues = parseHash(self.location.hash)\n  for (const h in hashValues) {\n    if (nodes.hash.has(h)) {\n      const node = nodes.hash.get(h) as StorageNode\n      try {\n        node.value = JSON.parse(hashValues[h])\n      } catch {\n        node.value = hashValues[h]\n      }\n    }\n  }\n\n  for (const [key, node] of nodes.hash.entries()) {\n    if (hashValues[key] === undefined) {\n      node.value = node.default\n    }\n  }\n}\n\nself.addEventListener('hashchange', updateAllFromHash, false)\nupdateAllFromHash()\n","import { Register } from '../decorators/Register.js'\nimport { ReactiveProperty } from '../decorators/Property.js'\nimport { ReactivePropertyDefinitions, ReactiveNode, ReactivityType } from '../nodes/ReactiveNode.js'\nimport { Storage as $ } from '../nodes/Storage.js'\n\nconst THEME_VERSION = 'v0.11'\nconst styleElement = document.createElement('style')\nstyleElement.setAttribute('id', 'io-theme-variables-' + THEME_VERSION)\ndocument.head.appendChild(styleElement)\n\nexport class Color {\n  r: number\n  g: number\n  b: number\n  a: number\n  constructor(r: number, g: number, b: number, a: number) {\n    this.r = r\n    this.g = g\n    this.b = b\n    this.a = a\n  }\n  toCss() {\n    const r = Math.floor(this.r * 255)\n    const g = Math.floor(this.g * 255)\n    const b = Math.floor(this.b * 255)\n    if (this.a !== undefined && this.a !== 1) {\n      return `rgba(${r}, ${g}, ${b}, ${this.a})`\n    } else {\n      return `rgb(${r}, ${g}, ${b})`\n    }\n  }\n}\n\nexport type ThemeVars = {\n  spacing: number\n  spacing2: number\n  spacing3: number\n  spacing5: number\n  spacing8: number\n\n  fontSize: number\n  lineHeight: number\n  fieldHeight: number\n\n  borderRadius: number\n  borderWidth: number\n  borderColor: Color\n  borderColorLight: Color\n  borderColorStrong: Color\n  borderColorRed: Color\n  borderColorBlue: Color\n  borderColorGreen: Color\n\n  bgColor: Color\n  bgColorStrong: Color\n  bgColorLight: Color\n  bgColorRed: Color\n  bgColorGreen: Color\n  bgColorBlue: Color\n  bgColorInput: Color\n\n  color: Color\n  colorStrong: Color\n  colorLight: Color\n  colorRed: Color\n  colorGreen: Color\n  colorBlue: Color\n  colorWhite: Color\n  colorInput: Color\n\n  gradientColorStart: Color\n  gradientColorEnd: Color\n\n  shadowColor: Color\n}\n\nexport const LIGHT_THEME: ThemeVars = {\n  spacing: 2,\n  spacing2: 0,\n  spacing3: 0,\n  spacing5: 0,\n  spacing8: 0,\n\n  lineHeight: 20,\n  fontSize: 14,\n  fieldHeight: 0,\n\n  borderRadius: 2,\n  borderWidth: 1,\n  borderColor: new Color(0.2, 0.2, 0.2, 1),\n  borderColorLight: new Color(0.3, 0.3, 0.3, 1),\n  borderColorStrong: new Color(0.6, 0.6, 0.6, 1),\n  borderColorRed: new Color(1, 0.35, 0.15, 1),\n  borderColorGreen: new Color(0.1, 0.7, 0.2, 1),\n  borderColorBlue: new Color(0.2, 0.4, 0.95, 1),\n\n  bgColor: new Color(0.85, 0.85, 0.85, 1),\n  bgColorStrong: new Color(0.9, 0.9, 0.9, 1),\n  bgColorLight: new Color(0.8, 0.8, 0.8, 1),\n  bgColorRed: new Color(1, 0.5, 0.3, 1),\n  bgColorGreen: new Color(0.2, 0.9, 0.3, 1),\n  bgColorBlue: new Color(0.2, 0.5, 0.9, 1),\n  bgColorInput: new Color(0.95, 0.96, 0.95, 1),\n\n  color: new Color(0.25, 0.25, 0.2, 1),\n  colorStrong: new Color(0, 0, 0, 1),\n  colorLight: new Color(0.6, 0.6, 0.6, 1),\n  colorRed: new Color(1, 0.2, 0.0, 1),\n  colorGreen: new Color(0, 0.6, 0.1, 1),\n  colorBlue: new Color(0.2, 0.3, 1, 1),\n  colorWhite: new Color(1, 1, 1, 1),\n  colorInput: new Color(0, 0.05, 0.02, 1),\n\n  gradientColorStart: new Color(0.9, 0.9, 0.9, 1),\n  gradientColorEnd: new Color(0.75, 0.75, 0.75, 1),\n\n  shadowColor: new Color(0, 0, 0, 0.2),\n}\n\nexport const DARK_THEME: ThemeVars = {\n  spacing: 2,\n  spacing2: 0,\n  spacing3: 0,\n  spacing5: 0,\n  spacing8: 0,\n\n  lineHeight: 20,\n  fontSize: 14,\n  fieldHeight: 0,\n\n  borderRadius: 2,\n  borderWidth: 1,\n  borderColor: new Color(0.5, 0.5, 0.5, 1),\n  borderColorLight: new Color(0.3, 0.3, 0.3, 1),\n  borderColorStrong: new Color(0, 0, 0, 1),\n  borderColorRed: new Color(1, 0.2, 0.0, 1),\n  borderColorBlue: new Color(0.4, 0.5, 0.9, 1),\n  borderColorGreen: new Color(0, 0.6, 0.1, 1),\n\n  bgColor: new Color(0.2, 0.2, 0.2, 1),\n  bgColorStrong: new Color(0.15, 0.15, 0.15, 1),\n  bgColorLight: new Color(0.25, 0.25, 0.25, 1),\n  bgColorRed: new Color(0.7, 0.2, 0.1, 1),\n  bgColorGreen: new Color(0.1, 0.5, 0.2, 1),\n  bgColorBlue: new Color(0.2, 0.4, 0.8, 1),\n  bgColorInput: new Color(0.02, 0.02, 0.02, 1),\n\n  color: new Color(0.6, 0.6, 0.6, 1),\n  colorStrong: new Color(0.86, 0.86, 0.86, 1),\n  colorLight: new Color(0.3, 0.3, 0.3, 1),\n  colorRed: new Color(1, 0.4, 0.4, 1),\n  colorGreen: new Color(0.4, 0.95, 0.3, 1),\n  colorBlue: new Color(0.6, 0.9, 1, 1),\n  colorWhite: new Color(1, 1, 1, 1),\n  colorInput: new Color(0.65, 0.7, 0.68, 1),\n\n  gradientColorStart: new Color(0.45, 0.45, 0.45, 1),\n  gradientColorEnd: new Color(0.2, 0.2, 0.2, 1),\n\n  shadowColor: new Color(0, 0, 0, 0.2),\n}\n\nconst $ThemeID = $({\n  value: window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light',\n  storage: 'local',\n  key: 'theme-' + THEME_VERSION\n})\n\nconst $Themes = $({\n  value: {},\n  storage: 'local',\n  key: 'io-themes-' + THEME_VERSION\n})\n\nconst compositeVariables = /* css */`\n  body {\n    --io_border: var(--io_borderWidth) solid var(--io_borderColor);\n    --io_borderColorInset: var(--io_borderColorStrong) var(--io_borderColorLight) var(--io_borderColorLight) var(--io_borderColorStrong);\n    --io_borderColorOutset: var(--io_borderColorLight) var(--io_borderColorStrong) var(--io_borderColorStrong) var(--io_borderColorLight);\n    --io_gradientOutset: linear-gradient(180deg, var(--io_gradientColorStart), var(--io_gradientColorEnd) 100%);\n    --io_gradientInset: linear-gradient(0deg, var(--io_gradientColorStart), var(--io_gradientColorEnd) 150%);\n    --io_shadow: 2px 2px 6px var(--io_shadowColor), 1px 1px 1px var(--io_shadowColor);\n    --io_shadowInset: 0.75px 0.75px 2px inset var(--io_shadowColor);\n    --io_shadowOutset: 1px 1px 2px var(--io_shadowColor);\n  }\n`\n\n/**\n * `Theme` is designed to be used as `ThemeSingleton`. It holds top-level CSS variables for Io-Gui design system.\n * CSS Variables are grouped in different themes and can be collectively switched by changing `theme` property.\n *\n * ```javascript\n * ThemeSingleton.themeID = 'dark';\n * ```\n *\n * CSS color variables such as `'--io_color'` and `'--io_bgColor'` are mapped to numeric properties `io_color` and `io_bgColor`.\n */\n@Register\nexport class Theme extends ReactiveNode {\n  static get ReactiveProperties(): ReactivePropertyDefinitions {\n    const props: ReactivePropertyDefinitions = {}\n    for (const p in LIGHT_THEME) {\n      const prop = LIGHT_THEME[p as keyof typeof LIGHT_THEME]\n      if (prop instanceof Object) {\n        props[p] = {value: prop, type: Color, init: null}\n      } else {\n        props[p] = prop\n      }\n    }\n    return props\n  }\n\n  declare spacing: number\n  declare spacing2: number\n  declare spacing3: number\n  declare spacing5: number\n  declare spacing8: number\n  declare lineHeight: number\n  declare fontSize: number\n  declare fieldHeight: number\n  declare borderRadius: number\n  declare borderWidth: number\n  declare borderColor: Color\n  declare borderColorLight: Color\n  declare borderColorStrong: Color\n  declare borderColorRed: Color\n  declare borderColorGreen: Color\n  declare borderColorBlue: Color\n  declare bgColor: Color\n  declare bgColorStrong: Color\n  declare bgColorLight: Color\n  declare bgColorRed: Color\n  declare bgColorGreen: Color\n  declare bgColorBlue: Color\n  declare bgColorInput: Color\n  declare color: Color\n  declare colorStrong: Color\n  declare colorLight: Color\n  declare colorRed: Color\n  declare colorGreen: Color\n  declare colorBlue: Color\n  declare colorWhite: Color\n  declare colorInput: Color\n  declare gradientColorStart: Color\n  declare gradientColorEnd: Color\n  declare shadowColor: Color\n\n  // Default theme values\n  @ReactiveProperty({type: Object, init: null})\n  declare themeDefaults: Record<string, ThemeVars>\n\n  @ReactiveProperty({type: String, binding: $ThemeID})\n  declare themeID: string\n\n  @ReactiveProperty('debounced')\n  declare reactivity: ReactivityType\n\n  ready() {\n    this.registerTheme('light', LIGHT_THEME)\n    this.registerTheme('dark', DARK_THEME)\n    this.themeIDChanged()\n  }\n  registerTheme(themeID: string, theme: ThemeVars) {\n    // Save default theme\n    this.themeDefaults[themeID] = theme\n    this.setProperty('themeDefaults', JSON.parse(JSON.stringify(this.themeDefaults)), true)\n    // Save persistant theme\n    $Themes.value[themeID] = $Themes.value[themeID] || theme\n    $Themes.value = JSON.parse(JSON.stringify($Themes.value))\n  }\n  reset() {\n    // Load persistant themes from default themes\n    $Themes.value = JSON.parse(JSON.stringify(this.themeDefaults))\n    this.themeIDChanged()\n  }\n  themeIDChanged() {\n    const values = $Themes.value[this.themeID]\n    for (const p in values) {\n      if (values[p] instanceof Object && JSON.stringify(Object.keys(values[p])) === '[\"r\",\"g\",\"b\",\"a\"]') {\n         values[p] = new Color(values[p].r, values[p].g, values[p].b, values[p].a)\n      }\n    }\n    this.setProperties(values)\n  }\n\n  onPropertyMutated(event: CustomEvent) {\n    // TODO: Add properties to mutation handler.\n    const mutated = super.onPropertyMutated(event)\n    if (mutated) {\n      this.changed()\n      this.dispatchMutation()\n      return true\n    }\n    return false\n  }\n  fontSizeChanged() {\n    this.lineHeight = Math.max(this.fontSize, this.lineHeight)\n  }\n  lineHeightChanged() {\n    this.fontSize = Math.min(this.lineHeight, this.fontSize)\n  }\n  changed() {\n    this.fieldHeight = this.lineHeight + 2 * (this.spacing + this.borderWidth)\n\n    this.spacing2 = this.spacing * 2\n    this.spacing3 = this.spacing * 3\n    this.spacing5 = this.spacing * 5\n    this.spacing8 = this.spacing * 8\n\n    const propertyVariables = Array.from(Object.keys(LIGHT_THEME) as Array<keyof ThemeVars>).reduce(\n      (result, prop) => {\n        $Themes.value[this.themeID][prop] = this[prop]\n        if (typeof this[prop] === 'object') {\n          return `${result}--io_${prop}: ${this[prop].toCss()};\\n    `\n        } else {\n          return `${result}--io_${prop}: ${this[prop]}px;\\n    `\n        }\n      }, '')\n\n      styleElement.innerHTML = /* css */`body {\\n  ${propertyVariables}\\n}\\n${compositeVariables}`\n      this.debounce(this.onSaveTheme, undefined, 60)\n  }\n  onSaveTheme() {\n    $Themes.value = JSON.parse(JSON.stringify($Themes.value))\n  }\n}\n\nconst ThemeSingleton = new Theme()\nexport { ThemeSingleton }","const saturate = /* glsl */`\n  #ifndef saturate\n    #define saturate(v) clamp(v, 0., 1.)\n  #endif\n`\n\n// Transform functions\nconst translate = /* glsl */`\n  vec2 translate(vec2 samplePosition, vec2 xy){\n    return samplePosition - vec2(xy.x, xy.y);\n  }\n  vec2 translate(vec2 samplePosition, float x, float y){\n    return samplePosition - vec2(x, y);\n  }\n`\n\n// SDF functions\nconst circle = /* glsl */`\n  float circle(vec2 samplePosition, float radius){\n    return saturate((length(samplePosition) - radius) * uPxRatio);\n  }\n`\nconst rectangle = /* glsl */`\n  float rectangle(vec2 samplePosition, vec2 halfSize){\n    vec2 edgeDistance = abs(samplePosition) - halfSize;\n    float outside = length(max(edgeDistance, 0.));\n    float inside = min(max(edgeDistance.x, edgeDistance.y), 0.);\n    return 1.0 - saturate((outside + inside) * 1000000.0);\n  }\n`\nconst paintDerivativeGrid2D = /* glsl*/`\n  float paintDerivativeGrid2D(vec2 samplePosition, vec2 gridWidth, float lineWidth) {\n    vec2 sp = samplePosition / gridWidth;\n    float fractx = abs(fract(sp.x - 0.5) - 0.5) * 2.0;\n    float fracty = abs(fract(sp.y - 0.5) - 0.5) * 2.0;\n\n    float sx = ((sp.x - 0.5) - 0.5) * 2.0;\n    float sy = ((sp.y - 0.5) - 0.5) * 2.0;\n    \n    float absx = abs(max(dFdx(sx), dFdy(sx)));\n    float absy = abs(max(dFdy(sy), dFdx(sy)));\n\n    float fadeX = 1.0 - dFdx(sx);\n    float fadeY = 1.0 - dFdy(sx);\n    if (fadeX <= 0.0 || fadeY <= 0.0) return 1.0;\n\n    float linex = fractx / absx - (0.5 * max(uPxRatio, 2.0) * lineWidth - 1.0) - 0.5;\n    float liney = fracty / absy - (0.5 * max(uPxRatio, 2.0) * lineWidth - 1.0) - 0.5;\n\n    return (1.0 - saturate(min(linex, liney)));\n  }\n`\nconst lineVertical = /* glsl*/`\n  float lineVertical(vec2 samplePosition, float lineWidth) {\n    return (abs(samplePosition.x) * 2.0 > lineWidth) ? 0.0 : 1.0;\n  }\n`\nconst lineHorizontal = /* glsl*/`\n  float lineHorizontal(vec2 samplePosition, float lineWidth) {\n    return (abs(samplePosition.y) * 2.0 > lineWidth) ? 0.0 : 1.0;\n  }\n`\nconst lineCross2d = /* glsl*/`\n  float lineCross2d(vec2 samplePosition, float lineWidth) {\n    return (min(abs(samplePosition.x), abs(samplePosition.y)) * 2.0 > lineWidth) ? 0.0 : 1.0;\n  }\n`\nconst checker = /* glsl*/`\n  float checker(vec2 samplePosition, float size) {\n    vec2 checkerPos = floor(samplePosition / size);\n    float checkerMask = mod(checkerPos.x + mod(checkerPos.y, 2.0), 2.0);\n    return checkerMask;\n  }\n`\nconst checkerX = /* glsl*/`\n  float checkerX(vec2 samplePosition, float size) {\n    vec2 checkerPos = floor(samplePosition / size);\n    float checkerMask = mod(checkerPos.x, 2.0);\n    return checkerMask;\n  }\n`\nconst checkerY = /* glsl*/`\n  float checkerY(vec2 samplePosition, float size) {\n    vec2 checkerPos = floor(samplePosition / size);\n    float checkerMask = mod(checkerPos.y, 2.0);\n    return checkerMask;\n  }\n`\n\n// Compositing functions\nconst compose = /* glsl*/`\n  vec3 compose(vec3 dst, vec4 src) {\n    return mix(dst, src.rgb, src.a);\n  }\n`\n\n/**\n * GLSL Color Functions\n */\n\nconst hue2rgb = /* glsl*/`\n  vec3 hue2rgb(float hue) {\n    hue = fract(hue);\n    float R = abs(hue * 6. - 3.) - 1.;\n    float G = 2. - abs(hue * 6. - 2.);\n    float B = 2. - abs(hue * 6. - 4.);\n    return saturate(vec3(R,G,B));\n  }\n`\n\nconst hsv2rgb = /* glsl*/`\n  vec3 hsv2rgb(vec3 hsv) {\n    vec3 rgb = hue2rgb(hsv.r);\n    return ((rgb - 1.) * hsv.g + 1.) * hsv.b;\n  }\n`\n\nconst hsl2rgb = /* glsl*/`\n  vec3 hsl2rgb(vec3 hsl) {\n    vec3 rgb = hue2rgb(hsl.x);\n    float C = (1. - abs(2. * hsl.z - 1.)) * hsl.y;\n    return (rgb - 0.5) * C + hsl.z;\n  }\n`\n\nexport const glsl = {\n  saturate,\n  translate,\n  circle,\n  rectangle,\n  paintDerivativeGrid2D,\n  lineVertical,\n  lineHorizontal,\n  lineCross2d,\n  checker,\n  checkerX,\n  checkerY,\n  compose,\n  hue2rgb,\n  hsv2rgb,\n  hsl2rgb,\n}\n","import { Register } from '../decorators/Register.js'\nimport { ReactiveProperty } from '../decorators/Property.js'\nimport { ReactivePropertyInstance, ReactivePropertyDefinition } from '../core/ReactiveProperty.js'\nimport { ReactiveNode } from '../nodes/ReactiveNode.js'\nimport { ThemeSingleton, Color } from '../nodes/Theme.js'\nimport { IoElement, IoElementProps } from './IoElement.js'\nimport { glsl } from './IoGL.glsl.js'\n\nconst canvas = document.createElement('canvas')\nconst gl = canvas.getContext('webgl', {antialias: false, premultipliedAlpha: false}) as WebGLRenderingContext\n\ngl.getExtension('OES_standard_derivatives')\n\ngl.enable(gl.BLEND)\ngl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\ngl.disable(gl.DEPTH_TEST)\n\nconst positionBuff = gl.createBuffer()\ngl.bindBuffer(gl.ARRAY_BUFFER, positionBuff)\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,1,0.0,-1,-1,0.0,1,-1,0.0,1,1,0.0]), gl.STATIC_DRAW)\ngl.bindBuffer(gl.ARRAY_BUFFER, null)\n\nconst uvBuff = gl.createBuffer()\ngl.bindBuffer(gl.ARRAY_BUFFER, uvBuff)\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0,1,0,0,1,0,1,1]), gl.STATIC_DRAW)\ngl.bindBuffer(gl.ARRAY_BUFFER, null)\n\nconst indexBuff = gl.createBuffer()\ngl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuff)\ngl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array([3,2,1,3,1,0]), gl.STATIC_DRAW)\ngl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null)\n\ngl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuff)\n\nconst shadersCache = new WeakMap()\nlet currentProgram: WebGLProgram | null\n\n@Register\nexport class IoGl extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        position: relative;\n        overflow: hidden !important;\n        @apply --unselectable;\n      }\n      :host > canvas {\n        position: absolute;\n        pointer-events: none;\n        image-rendering: pixelated;\n      }\n      :host > span {\n        position: absolute;\n        text-shadow: 0 0 3px var(--io_bgColorStrong), 0 0 3px var(--io_bgColorStrong), 0 0 3px var(--io_bgColorStrong);\n        left: 3px;\n        pointer-events: none;\n        color: var(--io_colorStrong);\n      }\n    `\n  }\n\n  @ReactiveProperty({type: ReactiveNode, value: ThemeSingleton})\n  declare theme: typeof ThemeSingleton\n\n  @ReactiveProperty({type: Array, init: [0, 0]})\n  declare size: [number, number]\n\n  @ReactiveProperty({type: Number, value: 1})\n  declare pxRatio: number\n\n  // @ReactiveProperty('throttled')\n  // declare reactivity: ReactivityType\n\n  #needsResize = false\n  #canvas: HTMLCanvasElement\n  // #counter: HTMLSpanElement;\n  #ctx: CanvasRenderingContext2D\n  #vecLengths: Record<string, number>\n  #shader: WebGLProgram\n\n  static get Vert() {\n    return /* glsl */`\n      attribute vec3 position;\n      attribute vec2 uv;\n      varying vec2 vUv;\n\n      void main(void) {\n        vUv = uv;\n        gl_Position = vec4(position, 1.0);\n      }\\n\\n`\n  }\n  static get GlUtils() {\n    return /* glsl */`\n      ${glsl.saturate}\n      ${glsl.translate}\n      ${glsl.circle}\n      ${glsl.rectangle}\n      ${glsl.paintDerivativeGrid2D}\n      ${glsl.lineVertical}\n      ${glsl.lineHorizontal}\n      ${glsl.lineCross2d}\n      ${glsl.checker}\n      ${glsl.checkerX}\n      ${glsl.checkerY}\n      ${glsl.compose}\n    `\n  }\n  static get Frag() {\n    return /* glsl */`\n      void main(void) {\n        gl_FragColor = io_color;\n      }\\n\\n`\n  }\n  initPropertyUniform(name: string, property: ReactivePropertyDefinition) {\n    const type = property.value.constructor\n    switch (type) {\n      case Boolean:\n        return 'uniform int ' + name + ';\\n'\n      case Number:\n        return 'uniform float ' + name + ';\\n'\n      case Array:\n        this.#vecLengths[name] = property.value.length\n        return 'uniform vec' + property.value.length + ' ' + name + ';\\n'\n      case Color:\n        this.#vecLengths[name] = 4\n        return 'uniform vec4 ' + name + ';\\n'\n      default:\n    }\n    return ''\n  }\n  initShader() {\n    let frag = /* glsl */`\n    #extension GL_OES_standard_derivatives : enable\n    precision highp float;\\n`\n\n    this.theme._reactiveProperties.forEach((property, name) => {\n      frag += this.initPropertyUniform('io_' + name, property)\n    })\n\n    frag += '\\n'\n\n    this._reactiveProperties.forEach((property, prop) => {\n      const name = 'u' + prop.charAt(0).toUpperCase() + prop.slice(1)\n      frag += this.initPropertyUniform(name, property)\n    })\n\n    frag += this.constructor.prototype._glUtils\n\n    const vertShader = gl.createShader(gl.VERTEX_SHADER) as WebGLShader\n    gl.shaderSource(vertShader, (this.constructor as typeof IoGl).Vert)\n    gl.compileShader(vertShader)\n\n    if (!gl.getShaderParameter(vertShader, gl.COMPILE_STATUS)) {\n      const compilationLog = gl.getShaderInfoLog(vertShader)\n      console.error('IoGl [Vertex Shader] ' + this.localName + ' error:')\n      console.warn(compilationLog)\n    }\n\n    const fragShader = gl.createShader(gl.FRAGMENT_SHADER) as WebGLShader\n    gl.shaderSource(fragShader, frag + (this.constructor as typeof IoGl).Frag)\n    gl.compileShader(fragShader)\n\n    if (!gl.getShaderParameter(fragShader, gl.COMPILE_STATUS)) {\n      const compilationLog = gl.getShaderInfoLog(fragShader)\n      console.error('IoGl [Frament Shader] ' + this.localName + ' error:')\n      console.warn(compilationLog)\n    }\n\n    const program = gl.createProgram() as WebGLProgram\n    gl.attachShader(program, vertShader)\n    gl.attachShader(program, fragShader)\n\n    return program\n  }\n  constructor(args: IoElementProps = {}) {\n    super(args)\n\n    this.#canvas = document.createElement('canvas')\n    this.appendChild(this.#canvas)\n    this.#ctx = this.#canvas.getContext('2d', {alpha: true}) as CanvasRenderingContext2D\n\n    // this.#counter = document.createElement('span');\n    // this.#counter.innerText = '0';\n    // this.appendChild(this.#counter);\n\n    // TODO: improve code clarity\n    this.#vecLengths = {}\n    this.theme._reactiveProperties.forEach((property, name) => {\n      // TODO: consider making more type agnostic\n      if (property.type === Color) {\n        this.#vecLengths['io_' + name] = 4\n      }\n    })\n\n    this._reactiveProperties.forEach((property, name) => {\n      const uname = 'u' + name.charAt(0).toUpperCase() + name.slice(1)\n      if (property.type === Array) {\n        this.#vecLengths[uname] = property.value.length\n      }\n    })\n\n    if (shadersCache.has(this.constructor)) {\n      this.#shader = shadersCache.get(this.constructor)\n    } else {\n      this.#shader = this.initShader()\n      shadersCache.set(this.constructor, this.#shader)\n    }\n\n    gl.linkProgram(this.#shader)\n\n    const position = gl.getAttribLocation(this.#shader, 'position')\n    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuff)\n    gl.vertexAttribPointer(position, 3, gl.FLOAT, false, 0, 0)\n    gl.enableVertexAttribArray(position)\n\n    const uv = gl.getAttribLocation(this.#shader, 'uv')\n    gl.bindBuffer(gl.ARRAY_BUFFER, uvBuff)\n    gl.vertexAttribPointer(uv, 2, gl.FLOAT, false, 0, 0)\n    gl.enableVertexAttribArray(uv)\n\n    this.updateThemeUniforms()\n  }\n  onResized() {\n    // TODO: consider optimizing\n    const pxRatio = window.devicePixelRatio\n    const rect = this.getBoundingClientRect()\n    const style = window.getComputedStyle(this)\n    const bw = parseInt(style.borderRightWidth) + parseInt(style.borderLeftWidth)\n    const bh = parseInt(style.borderTopWidth) + parseInt(style.borderBottomWidth)\n\n    // TODO: confirm and test\n    const width = Math.max(0, Math.floor(rect.width - bw))\n    const height = Math.max(0, Math.floor(rect.height - bh))\n\n    const hasResized = (width !== this.size[0] || height !== this.size[1] || pxRatio !== this.pxRatio)\n\n    if (hasResized) {\n      // NOTE: Resizing only in inline CSS. Buffer resize postponed until `onRender()`.`\n      this.#canvas.style.width = Math.floor(width) + 'px'\n      this.#canvas.style.height = Math.floor(height) + 'px'\n      this.#needsResize = true\n\n      this.setProperties({\n        size: [width, height],\n        pxRatio: pxRatio,\n      })\n    }\n  }\n  get ctx() {\n    return this.#ctx\n  }\n  themeMutated() {\n    this.updateThemeUniforms()\n    this.debounce(this.onRender)\n  }\n  changed() {\n    this.debounce(this.onRender)\n  }\n  onRender() {\n    const width = Math.floor(this.size[0] * this.pxRatio)\n    const height = Math.floor(this.size[1] * this.pxRatio)\n\n    if (!width || !height) return\n\n    this.setShaderProgram()\n\n    // TODO: dont brute-force uniform update.\n    this._reactiveProperties.forEach((property, name) => {\n      const uname = 'u' + name.charAt(0).toUpperCase() + name.slice(1)\n      this.updatePropertyUniform(uname, property)\n    })\n\n    if (this.#needsResize) {\n      this.#canvas.width = width\n      this.#canvas.height = height\n      this.#needsResize = false\n    }\n\n    canvas.width = width\n    canvas.height = height\n    gl.viewport(0, 0, width, height)\n\n    gl.clearColor(0, 0, 0, 0)\n    gl.clear(gl.COLOR_BUFFER_BIT)\n    this.#ctx.clearRect(0, 0, width, height)\n\n    gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0)\n\n    this.#ctx.drawImage(canvas, 0, 0)\n\n    // this.#counter.innerText = String(Number(this.#counter.innerText) + 1);\n  }\n  setShaderProgram() {\n    if (currentProgram !== this.#shader) {\n      currentProgram = this.#shader\n      gl.useProgram(this.#shader)\n    }\n  }\n  updatePropertyUniform(name: string, property: ReactivePropertyInstance) {\n    this.setShaderProgram()\n    this.setUniform(name, property.value)\n  }\n  updateThemeUniforms() {\n    this.theme._reactiveProperties.forEach((property, name) => {\n      this.updatePropertyUniform('io_' + name, property)\n    })\n  }\n  setUniform(name: string, value: any) {\n    const uniform = gl.getUniformLocation(this.#shader, name)\n    if (uniform === null) return\n    let type: string = typeof value\n    if (value instanceof Array) type = 'array'\n    let _c\n    switch (type) {\n      case 'boolean':\n        gl.uniform1i(uniform, value ? 1 : 0)\n        break\n      case 'number':\n        gl.uniform1f(uniform, value ?? 1)\n        break\n      case 'object':\n      case 'array':\n        _c = [0, 1, 2, 3]\n        if (typeof value === 'object') {\n          if (value.x !== undefined) _c = ['x', 'y', 'z', 'w']\n          else if (value.r !== undefined) _c = ['r', 'g', 'b', 'a']\n          else if (value.h !== undefined) _c = ['h', 's', 'v', 'a']\n          else if (value.c !== undefined) _c = ['c', 'm', 'y', 'k']\n        }\n        switch (this.#vecLengths[name]) {\n          case 2:\n            if (value === undefined) {\n              gl.uniform2f(uniform, 0, 0)\n              break\n            }\n            gl.uniform2f(uniform,\n                value[_c[0]] ?? 1,\n                value[_c[1]] ?? 1)\n            break\n          case 3:\n            if (value === undefined) {\n              gl.uniform3f(uniform, 0, 0, 0)\n              break\n            }\n            gl.uniform3f(uniform,\n                value[_c[0]] ?? 1,\n                value[_c[1]] ?? 1,\n                value[_c[2]] ?? 1)\n            break\n          case 4:\n            if (value === undefined) {\n              gl.uniform4f(uniform, 0, 0, 0, 0)\n              break\n            }\n            gl.uniform4f(uniform,\n                value[_c[0]] ?? 1,\n                value[_c[1]] ?? 1,\n                value[_c[2]] ?? 1,\n                value[_c[3]] ?? 1)\n                break\n          default:\n        }\n        break\n      default:\n    }\n  }\n  Register(ioNodeConstructor: typeof IoElement) {\n    super.Register(ioNodeConstructor)\n    let _glUtils = ''\n    const constructors = ioNodeConstructor.prototype._protochain.constructors\n    for (let i = constructors.length; i--;) {\n      const constructor = constructors[i]\n      const glUtilsProp = Object.getOwnPropertyDescriptor(constructor, 'GlUtils')\n      if (glUtilsProp && glUtilsProp.get) {\n        _glUtils += (constructor as typeof IoGl).GlUtils\n      }\n    }\n    Object.defineProperty(ioNodeConstructor.prototype, '_glUtils', {enumerable: false, value: _glUtils})\n  }\n}","import { VDOMElement, NativeElementProps, OtherHTMLElementProps } from '../vdom/VDOM.js'\n\n/* eslint-disable @stylistic/max-len */\n\n// export const HTML_CORE_PROPERTIES: Record<string, string[]> = {\n//   Node: ['ownerDocument','parentNode','parentElement','childNodes','firstChild','lastChild','previousSibling','nextSibling','textContent'],\n//   Element: ['id','innerHTML','outerHTML','scrollTop','scrollLeft','scrollWidth','scrollHeight','clientTop','clientLeft','clientWidth','clientHeight','role','ariaAtomic','ariaAutoComplete','ariaBusy','ariaBrailleLabel','ariaBrailleRoleDescription','ariaChecked','ariaColCount','ariaColIndex','ariaColSpan','ariaCurrent','ariaDescription','ariaDisabled','ariaExpanded','ariaHasPopup','ariaHidden','ariaInvalid','ariaKeyShortcuts','ariaLabel','ariaLevel','ariaLive','ariaModal','ariaMultiLine','ariaMultiSelectable','ariaOrientation','ariaPlaceholder','ariaPosInSet','ariaPressed','ariaReadOnly','ariaRelevant','ariaRequired','ariaRoleDescription','ariaRowCount','ariaRowIndex','ariaRowSpan','ariaSelected','ariaSetSize','ariaSort','ariaValueMax','ariaValueMin','ariaValueNow','ariaValueText','children','firstElementChild','lastElementChild','childElementCount','previousElementSibling','nextElementSibling','currentCSSZoom','ariaColIndexText','ariaRowIndexText','ariaActiveDescendantElement','ariaControlsElements','ariaDescribedByElements','ariaDetailsElements','ariaErrorMessageElements','ariaFlowToElements','ariaLabelledByElements'],\n//   HTMLElement: ['title','lang','translate','dir','hidden','inert','accessKey','draggable','spellcheck','autocapitalize','contentEditable','enterKeyHint','inputMode','virtualKeyboardPolicy','offsetParent','offsetTop','offsetLeft','offsetWidth','offsetHeight','innerText','outerText','writingSuggestions','autofocus','tabIndex','style'],\n// };\n\n// export const HTML_ELEMENT_PROPERTIES: Record<string, string[]> = {\n//   a: ['target','download','ping','rel','relList','hreflang','type','referrerPolicy','text','coords','charset','name','rev','shape','protocol','username','password','host','hostname','port','pathname','search','hash','href','attributionSrc'],\n//   area: ['alt','coords','download','shape','target','ping','rel','relList','referrerPolicy','noHref','protocol','username','password','host','hostname','port','pathname','search','hash','href','attributionSrc'],\n//   base: ['href','target'],\n//   blockquote: ['cite'],\n//   br: ['clear'],\n//   button: ['disabled','formAction','formEnctype','formMethod','formNoValidate','formTarget','name','type','value','commandForElement','command'],\n//   canvas: ['width','height'],\n//   col: ['span','ch','chOff','vAlign','width'],\n//   colgroup: ['span','ch','chOff','vAlign','width'],\n//   data: ['value'],\n//   del: ['cite','dateTime'],\n//   details: ['open','name'],\n//   dialog: ['open','returnValue','closedBy'],\n//   dir: ['compact'],\n//   dl: ['compact'],\n//   embed: ['src','type','width','height','name'],\n//   fieldset: ['disabled','name'],\n//   font: ['color','face','size'],\n//   form: ['acceptCharset','action','autocomplete','enctype','encoding','method','name','noValidate','target','rel','relList'],\n//   frame: ['name','scrolling','src','frameBorder','longDesc','noResize','marginHeight','marginWidth'],\n//   frameset: ['cols','rows'],\n//   hr: ['color','noShade','size','width'],\n//   html: ['version'],\n//   iframe: ['src','srcdoc','name','sandbox','allowFullscreen','width','height','referrerPolicy','csp','allow','loading','scrolling','frameBorder','longDesc','marginHeight','marginWidth','credentialless','allowPaymentRequest','privateToken','browsingTopics','adAuctionHeaders','sharedStorageWritable'],\n//   img: ['alt','src','srcset','sizes','crossOrigin','useMap','isMap','width','height','referrerPolicy','decoding','fetchPriority','loading','name','lowsrc','hspace','vspace','longDesc','border','browsingTopics','attributionSrc','sharedStorageWritable'],\n//   input: ['accept','alt','autocomplete','defaultChecked','checked','dirName','disabled','files','formAction','formEnctype','formMethod','formNoValidate','formTarget','height','indeterminate','max','maxLength','min','minLength','multiple','name','pattern','placeholder','readOnly','required','size','src','step','type','defaultValue','value','valueAsDate','valueAsNumber','width','selectionStart','selectionEnd','selectionDirection','useMap','webkitdirectory','incremental'],\n//   ins: ['cite','dateTime'],\n//   label: ['htmlFor'],\n//   li: ['value','type'],\n//   link: ['disabled','href','crossOrigin','rel','relList','media','hreflang','type','as','referrerPolicy','sizes','fetchPriority','imageSrcset','imageSizes','charset','rev','target','integrity','blocking'],\n//   map: ['name'],\n//   menu: ['compact'],\n//   meta: ['name','httpEquiv','content','media','scheme'],\n//   meter: ['value','min','max','low','high','optimum'],\n//   object: ['data','type','name','useMap','width','height','archive','code','declare','hspace','standby','vspace','codeBase','codeType','border'],\n//   ol: ['reversed','start','type','compact'],\n//   optgroup: ['disabled','label'],\n//   option: ['disabled','label','defaultSelected','selected','value','text'],\n//   output: ['htmlFor','name','defaultValue','value'],\n//   param: ['name','value','type','valueType'],\n//   pre: ['width'],\n//   progress: ['value','max'],\n//   q: ['cite'],\n//   script: ['src','type','noModule','charset','async','defer','crossOrigin','text','referrerPolicy','fetchPriority','event','htmlFor','integrity','blocking','attributionSrc'],\n//   select: ['autocomplete','disabled','multiple','name','required','size','length','selectedIndex','value'],\n//   source: ['src','type','srcset','sizes','media','width','height'],\n//   style: ['disabled','media','type','blocking'],\n//   table: ['caption','tHead','tFoot','border','frame','rules','summary','width','cellPadding','cellSpacing'],\n//   tbody: ['ch','chOff','vAlign'],\n//   td: ['colSpan','rowSpan','headers','axis','height','width','ch','chOff','noWrap','vAlign','abbr','scope'],\n//   template: ['shadowRootMode','shadowRootDelegatesFocus','shadowRootClonable','shadowRootSerializable'],\n//   textarea: ['autocomplete','cols','dirName','disabled','maxLength','minLength','name','placeholder','readOnly','required','rows','wrap','defaultValue','value','selectionStart','selectionEnd','selectionDirection'],\n//   tfoot: ['ch','chOff','vAlign'],\n//   th: ['colSpan','rowSpan','headers','axis','height','width','ch','chOff','noWrap','vAlign','abbr','scope'],\n//   thead: ['ch','chOff','vAlign'],\n//   time: ['dateTime'],\n//   title: ['text'],\n//   tr: ['ch','chOff','vAlign'],\n//   track: ['kind','src','srclang','label','default'],\n//   ul: ['compact','type'],\n//   video: ['width','height','poster','playsInline','disablePictureInPicture']\n// };\n\nexport const HTML_ELEMENTS: string[] = [\n  'a','abbr','acronym','address','applet','area','article','aside','audio','b','base','basefont','bdi','bdo','big',\n  'blockquote','body','br','button','canvas','caption','center','cite','code','col','colgroup','data','datalist','dd',\n  'del','details','dfn','dialog','dir','div','dl','dt','em','embed','fieldset','figcaption','figure','font','footer',\n  'form','frame','frameset','head','header','hgroup','h1','h2','h3','h4','h5','h6','hr','html','i','iframe','img',\n  'input','ins','kbd','keygen','label','legend','li','link','main','map','mark','menu','menuitem','meta','meter','nav',\n  'noframes','noscript','object','ol','optgroup','option','output','p','param','picture','pre','progress','q','rp','rt',\n  'ruby','s','samp','script','section','select','small','source','span','strike','strong','style','sub','summary','sup',\n  'svg','table','tbody','td','template','textarea','tfoot','th','thead','time','title','tr','track','tt','u','ul','var',\n  'video','wbr'\n]\n\nconst nativeVDOMConstructors: Record<string, (\n  arg0?: NativeElementProps & OtherHTMLElementProps | Array<VDOMElement | null> | string,\n  arg1?: Array<VDOMElement | null> | string) => VDOMElement> = {}\n\nHTML_ELEMENTS.forEach((element) => {\n  // TODO: Add runtime debug type checks?\n  // TODO: Test thoroughly.\n  const vConstructor = function(\n    arg0?: NativeElementProps & OtherHTMLElementProps | Array<VDOMElement | null> | string,\n    arg1?: Array<VDOMElement | null> | string): VDOMElement {\n    const vDOMElement: VDOMElement = {tag: element}\n    if (arg0 !== undefined) {\n      if (typeof arg0 === 'string') {\n        vDOMElement.children = arg0\n      } else if (arg0 instanceof Array) {\n        vDOMElement.children = arg0\n      } else if (typeof arg0 === 'object') {\n        vDOMElement.props = arg0\n      }\n      if (arg1 !== undefined) {\n        if (typeof arg1 === 'string') {\n          vDOMElement.children = arg1\n        } else if (arg1 instanceof Array) {\n          vDOMElement.children = arg1\n        }\n      }\n    }\n    return vDOMElement\n\n  }\n  nativeVDOMConstructors[element] = vConstructor\n})\n\n//TODO: test element vDOM factories!\n\nexport const {\n  a, abbr, acronym, address, applet, area, article, aside, audio, b, base, basefont, bdi, bdo, big, blockquote,\n  body, br, button, canvas, caption, center, cite, code, col, colgroup, data, datalist, dd, del, details, dfn,\n  dialog, dir, div, dl, dt, em, embed, fieldset, figcaption, figure, font, footer, form, frame, frameset, head,\n  header, hgroup, h1, h2, h3, h4, h5, h6, hr, html, i, iframe, img, input, ins, kbd, keygen, label, legend, li,\n  link, main, map, mark, menu, menuitem, meta, meter, nav, noframes, noscript, object, ol, optgroup, option,\n  output, p, param, picture, pre, progress, q, rp, rt, ruby, s, samp, script, section, select, small, source,\n  span, strike, strong, style, sub, summary, sup, svg, table, tbody, td, template, textarea, tfoot, th, thead,\n  time, title, tr, track, tt, u, ul, video, wbr\n} = nativeVDOMConstructors","import { ReactiveProperty } from '../decorators/Property.js'\nimport { Register } from '../decorators/Register.js'\nimport { ListenerDefinitions } from '../nodes/ReactiveNode.js'\nimport { IoElement, IoElementProps } from './IoElement.js'\n\nlet focusRestoreTarget: Element | null = null\n\n/**\n * This element is designed to be used as a singleton `IoOverlaySingleton`.\n * It is a pointer-blocking element covering the entire window at a very high z-index.\n * It is designed to be displayed on top all other elements and contain elements like modals, popovers, floating menus etc.\n * When clicked, IoOverlay collapses all child elements by setting their `expanded` property to `false`.\n * Child elements should emmit bubbling `\"expanded\"` event when expanded/collapsed.\n **/\n@Register\nclass IoOverlay extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host {\n        display: block;\n        position: fixed;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        right: 0;\n        z-index: 100000;\n        overflow: hidden;\n        pointer-events: none;\n        touch-action: none;\n        background: transparent;\n        @apply --unselectable;\n      }\n      :host[expanded] {\n        background: rgba(0, 0, 0, 0.25);\n        pointer-events: all;\n      }\n      :host > * {\n        position: absolute !important;\n        box-shadow: var(--io_shadow);\n      }\n    `\n  }\n  @ReactiveProperty({value: false, type: Boolean, reflect: true})\n  declare expanded: boolean\n\n  static get Listeners(): ListenerDefinitions {\n    return {\n      'pointerdown': ['stopPropagation', {passive: false}],\n      'pointermove': ['stopPropagation', {passive: false}],\n      'pointerup': 'onPointerup',\n      'contextmenu': 'onContextmenu',\n      'mousedown': ['stopPropagation', {passive: false}],\n      'mousemove': ['stopPropagation', {passive: false}],\n      'mouseup': ['stopPropagation', {passive: false}],\n      'touchstart': ['stopPropagation', {passive: false}],\n      'touchmove': ['stopPropagation', {passive: false}],\n      'touchend': ['stopPropagation', {passive: false}],\n      'keydown': ['stopPropagation', {passive: false}],\n      'keyup': ['stopPropagation', {passive: false}],\n      'focusin': ['stopPropagation', {passive: false}],\n      'blur': ['stopPropagation', {passive: false}],\n      'scroll': 'onScroll',\n      'wheel': ['onScroll', {passive: false}],\n    }\n  }\n\n  constructor(args: IoElementProps = {}) { super(args) }\n\n  init() {\n    this.expandAsChildren = this.expandAsChildren.bind(this)\n  }\n  stopPropagation(event: Event) {\n    event.stopPropagation()\n  }\n  onPointerup(event: PointerEvent) {\n    if (event.composedPath()[0] === this as unknown as EventTarget) {\n      this.collapse()\n    }\n    event.stopPropagation()\n  }\n  onContextmenu(event: Event) {\n    event.preventDefault()\n    event.stopPropagation()\n  }\n  onScroll(event: Event) {\n    if (event.composedPath()[0] === this as unknown as EventTarget) {\n      this.collapse()\n    }\n  }\n  onResized() {\n    this.collapse()\n  }\n  appendChild<El extends Node>(child: El) {\n    super.appendChild(child)\n    child.addEventListener('expanded-changed', this.onChildExpandedChanged)\n    this.debounce(this.expandAsChildren)\n    return child\n  }\n  removeChild<El extends Node>(child: El) {\n    super.removeChild(child)\n    child.removeEventListener('expanded-changed', this.onChildExpandedChanged)\n    this.debounce(this.expandAsChildren)\n    return child\n  }\n  onChildExpandedChanged() {\n    this.debounce(this.expandAsChildren)\n  }\n  collapse() {\n    for (let i = this.children.length; i--;) {\n      this.expanded = false\n    }\n    this.expanded = false\n  }\n  expandAsChildren() {\n    for (let i = this.children.length; i--;) {\n      if ((this.children[i] as any).expanded) {\n        this.expanded = true\n        return\n      }\n    }\n    this.expanded = false\n  }\n  expandedChanged() {\n    if (!this.expanded) {\n      for (let i = this.children.length; i--;) {\n        (this.children[i] as any).expanded = false\n      }\n      if (focusRestoreTarget) (focusRestoreTarget as HTMLElement).focus()\n    }\n  }\n}\n\nexport const IoOverlaySingleton = new IoOverlay()\n\nsetTimeout(() => {\n  document.body.appendChild(IoOverlaySingleton as HTMLElement)\n}, 100)\n\n// TODO: Test\nwindow.addEventListener('focusin', () => {\n  focusRestoreTarget = document.activeElement\n}, {capture: false})\n\nwindow.addEventListener('blur', () => {\n  setTimeout(() => {\n    if (!IoOverlaySingleton.expanded && document.activeElement === document.body) {\n      focusRestoreTarget = null\n    }\n  })\n}, {capture: true})","import { IoElement } from '../elements/IoElement.js'\nimport { ThemeSingleton } from '../nodes/Theme.js'\nimport { IoOverlaySingleton as Overlay } from '../elements/IoOverlay.js'\n\n// TODO: improve focus algorithm\n// Note: focus string field in IoInspector demo and use arrowleft - notice focus shift is not intuitive.\n\n// TODO: Home, End, PageUp, PageDown?\n\nlet focusBacktrack = new WeakMap()\ntype Direction = 'ArrowLeft' | 'ArrowRight' | 'ArrowDown' | 'ArrowUp'\nconst backtrackDir: Record<Direction, Direction> = {\n  ArrowLeft: 'ArrowRight',\n  ArrowRight: 'ArrowLeft',\n  ArrowDown: 'ArrowUp',\n  ArrowUp: 'ArrowDown'\n}\n\nfunction setFocusBacktrack(element: HTMLElement | IoElement, dir: Direction, source: HTMLElement | IoElement) {\n  focusBacktrack.set(element, {\n    dir: backtrackDir[dir],\n    source: source\n  })\n}\n\nexport function clearFocusBacktrack() {\n  focusBacktrack = new WeakMap()\n}\n\nfunction getRectDistance(rect1: DOMRect, rect2: DOMRect, dirBias: number = 1) {\n  if (rect1.right > rect2.left && rect2.right > rect1.left && rect1.bottom > rect2.top && rect2.bottom > rect1.top) {\n    return 0\n  }\n  let dx = 0, dy = 0\n  const MIN_DISTANCE = ThemeSingleton.fieldHeight / 2\n\n  if (rect1.right < rect2.left) dx = Math.max(MIN_DISTANCE, rect2.left - rect1.right)\n  else if (rect2.right < rect1.left) dx = Math.max(MIN_DISTANCE, rect1.left - rect2.right)\n  if (rect1.bottom < rect2.top) dy = Math.max(MIN_DISTANCE, rect2.top - rect1.bottom)\n  else if (rect2.bottom < rect1.top) dy = Math.max(MIN_DISTANCE, rect1.top - rect2.bottom)\n  dx = dx * dirBias\n  dy = dy / dirBias\n  return (dx**2 + dy**2)**0.5\n}\n\nfunction getCenterDistance(rect1: DOMRect, rect2: DOMRect, dirBias: number = 1) {\n  const c1 = {x: rect1.x + rect1.width / 2, y: rect1.y + rect1.height / 2}\n  const c2 = {x: rect2.x + rect2.width / 2, y: rect2.y + rect2.height / 2}\n  let dx = c1.x - c2.x\n  let dy = c1.y - c2.y\n  dx = dx * dirBias\n  dy = dy / dirBias\n  return (dx**2 + dy**2)**0.5\n}\n\nfunction onIoFocusTo(event: CustomEvent) {\n  const src = event.detail.source\n  const srcRect = src.getBoundingClientRect()\n  const cmd = event.detail.command\n\n  const inoverlay = Overlay.contains(src)\n\n  let closestElement = src\n  let closestDistance = Infinity\n  let closestCenterDistance = Infinity\n\n  const backtrack = focusBacktrack.get(src)\n\n  if (backtrack && backtrack.dir === cmd) {\n    const source = backtrack.source\n    let visible = true\n    if (!source.offsetParent || source === src) {\n      visible = false\n    } else {\n      const sStyle = window.getComputedStyle(source)\n      if (sStyle.visibility !== 'visible' || sStyle.display === 'none') {\n        visible = false\n      }\n    }\n    if (visible) {\n      source.focus()\n      setFocusBacktrack(source, cmd, src)\n      return\n    }\n  }\n\n  const root = inoverlay ? Overlay as HTMLElement : document\n  let focusableCandidates = Array.from(root.querySelectorAll(`[tabIndex=\"${src.tabIndex || 0}\"]:not([disabled]):not([inert]):not([hidden])`)) as HTMLElement[]\n  const focusableSiblingCandidates = Array.from(src.parentElement.querySelectorAll(`[tabIndex=\"${src.tabIndex || 0}\"]:not([disabled]):not([inert]):not([hidden])`)) as HTMLElement[]\n  focusableCandidates = focusableCandidates.filter(el => el.offsetParent !== null)\n  focusableCandidates = focusableCandidates.filter(el => {\n    const style = window.getComputedStyle(el)\n    return style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0'\n  })\n\n  if (cmd === 'Tab') {\n    const index = focusableCandidates.indexOf(src)\n    if (index !== -1) {\n      focusableCandidates[(index + 1) % focusableCandidates.length].focus()\n    }\n    return\n  } else if (cmd === 'Home') {\n    focusableCandidates[0].focus()\n    return\n  } else if (cmd === 'End') {\n    focusableCandidates[focusableCandidates.length - 1].focus()\n    return\n  } else if (cmd === 'PageUp') {\n    focusableSiblingCandidates[0].focus()\n    return\n  } else if (cmd === 'PageDown') {\n    focusableSiblingCandidates[focusableSiblingCandidates.length - 1].focus()\n    return\n  } else if (['ArrowLeft', 'ArrowRight', 'ArrowDown', 'ArrowUp'].includes(cmd)) {\n    for (let i = focusableCandidates.length; i--;) {\n      const candidate = focusableCandidates[i]\n      if (!candidate.offsetParent || candidate === src) {\n        continue\n      }\n      const sStyle = window.getComputedStyle(candidate)\n      if (sStyle.visibility !== 'visible' || sStyle.display === 'none') {\n        continue\n      }\n      const rect = candidate.getBoundingClientRect()\n      if (cmd === 'ArrowRight' && rect.left < srcRect.right) continue\n      if (cmd === 'ArrowLeft' && rect.right > srcRect.left) continue\n      if (cmd === 'ArrowDown' && rect.top < srcRect.bottom) continue\n      if (cmd === 'ArrowUp' && rect.bottom > srcRect.top) continue\n\n      const biasMagnitude = 4\n      const dirBias = cmd === 'ArrowLeft' || cmd === 'ArrowRight' ? 1 / biasMagnitude : biasMagnitude\n\n      const distance = getRectDistance(srcRect, rect, dirBias)\n      const centerDistance = getCenterDistance(srcRect, rect, dirBias)\n      if (distance < closestDistance) {\n        closestDistance = distance\n        closestCenterDistance = centerDistance\n        closestElement = candidate\n      } else if (distance === closestDistance && centerDistance < closestCenterDistance) {\n        closestCenterDistance = centerDistance\n        closestElement = candidate\n      }\n    }\n    if (closestElement !== src) {\n      (closestElement as any).focus()\n      setFocusBacktrack(closestElement, cmd, src)\n    }\n  }\n}\n\ndocument.addEventListener('io-focus-to', onIoFocusTo as EventListener)\n","import { ReactiveNode, Register, ReactiveProperty } from '@io-gui/core'\n\nexport class TodoItemModel extends ReactiveNode {\n  @ReactiveProperty({type: String})\n  declare title: string\n\n  @ReactiveProperty({type: Boolean})\n  declare completed: boolean\n\n  toggle = () => {\n    this.completed = !this.completed\n  }\n\n  delete = () => {\n    this.dispatch('delete-item', {item: this}, true)\n  }\n\n  toJSON() {\n    return {\n      title: this.title,\n      completed: this.completed,\n    }\n  }\n\n  fromJSON(json: any) {\n    this.setProperties({\n      title: json.title ?? '',\n      completed: json.completed ?? false,\n    })\n    return this\n  }\n}\nRegister(TodoItemModel)","import { ReactiveNode, NodeArray, Register, ReactiveProperty } from '@io-gui/core'\nimport { TodoItemModel } from './TodoItemModel.js'\n\nexport class TodoListModel extends ReactiveNode {\n\n  @ReactiveProperty({type: NodeArray, init: 'this'})\n  declare items: TodoItemModel[]\n\n  static get Listeners() {\n    return {\n      'delete-item': 'onDeleteItem',\n    }\n  }\n\n  onDeleteItem(event: any) {\n    const item = event.path[0]\n    const index = this.items.indexOf(item)\n    this.items.splice(index, 1)\n  }\n\n  get filters() {\n    return {\n      all: () => true,\n      active: (item: TodoItemModel) => !item.completed,\n      completed: (item: TodoItemModel) => item.completed,\n    }\n  }\n\n  get count() {\n    return this.items.length\n  }\n\n  get completedCount() {\n    return this.items.filter(item => item.completed).length\n  }\n\n  get activeCount() {\n    return this.items.filter(item => !item.completed).length\n  }\n\n  get allCompleted() {\n    return this.items.every(item => item.completed)\n  }\n\n  constructor(args: any) {\n    args = { ...args }\n    args.items = args.items.map((item: any) => new TodoItemModel({...item}))\n    super(args)\n  }\n\n  completeAll = () => {\n    this.items.forEach(item => item.completed = true)\n  }\n\n  clearCompleted = () => {\n    this.items = this.items.filter(item => !item.completed)\n  }\n\n  itemsMutated() {\n    this.dispatchMutation()\n  }\n\n  toJSON() {\n    return {\n      items: this.items.map(item => item.toJSON()),\n    }\n  }\n\n  fromJSON(json: any) {\n    this.setProperties({\n      items: json.items.map((item: any) => new TodoItemModel(item)),\n    })\n    return this\n  }\n}\nRegister(TodoListModel)","import { IoElement, Register, input, ReactiveProperty, IoElementProps } from '@io-gui/core'\nimport { TodoListModel } from './TodoListModel.js'\nimport { TodoItemModel } from './TodoItemModel.js'\n\ntype TodoInputProps = IoElementProps & {\n  model?: TodoListModel\n}\n\nexport class TodoInput extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: contents;\n    }\n    `\n  }\n\n  @ReactiveProperty({type: TodoListModel})\n  declare model: TodoListModel\n\n  constructor(args: TodoInputProps = {}) { super(args) }\n\n  onInputKey(event: KeyboardEvent) {\n    if (event.key === 'Enter') {\n      const inputElement = this.$.input as HTMLInputElement\n      const title = String(inputElement.value).trim()\n      if (title) {\n        this.model.items.push(new TodoItemModel({title: title, completed: false}))\n      }\n      inputElement.value = ''\n      inputElement.focus()\n    }\n    if (event.key === 'Escape') {\n      const inputElement = this.$.input as HTMLInputElement\n      inputElement.value = ''\n      inputElement.focus()\n    }\n  }\n\n  changed() {\n    this.render([\n      input({id: 'input', class: 'new-todo', placeholder: 'What needs to be done?', '@keyup': this.onInputKey, autofocus: true}),\n    ])\n  }\n}\nRegister(TodoInput)\n\nexport const todoInput = function(arg0: TodoInputProps) {\n  return TodoInput.vConstructor(arg0)\n}","import { IoElement, Register, input, label, li, div, button, ReactiveProperty, IoElementProps } from '@io-gui/core'\nimport { TodoItemModel } from './TodoItemModel.js'\nimport { TodoListModel } from './TodoListModel.js'\n\ntype TodoItemProps = IoElementProps & {\n  item?: TodoItemModel\n  model?: TodoListModel\n}\n\nexport class TodoItem extends IoElement {\n  static get Style() {\n    return /* css */`\n    :host {\n      display: contents;\n    }\n    `\n  }\n\n  @ReactiveProperty({type: TodoItemModel})\n  declare item: TodoItemModel\n\n  @ReactiveProperty({type: TodoListModel})\n  declare model: TodoListModel\n\n  @ReactiveProperty({value: false})\n  declare editing: boolean\n\n  private $input!: HTMLInputElement\n  private _originalTitle!: string\n\n  constructor(args: TodoItemProps = {}) { super(args) }\n\n  itemMutated() {\n    this.changed()\n  }\n\n  changed() {\n    this.render([\n      li({class: 'todo ' + (this.item.completed ? 'completed ' : '') + (this.editing ? 'editing' : '')}, [\n        div({class: 'view'}, [\n          input({type: 'checkbox', class: 'toggle', checked: this.item.completed, '@click': this.item.toggle}),\n          label({'@dblclick': this.onStartEdit}, this.item.title),\n          button({class: 'destroy', '@click': this.item.delete}),\n        ]),\n        input({id: 'input-' + this.item.title, class: 'edit', value: this.item.title, '@blur': this.onBlur, '@keyup': this.onInputKey})\n      ])\n    ])\n    this.$input = this.querySelector('input.edit') as HTMLInputElement\n  }\n\n  onStartEdit() {\n    this.editing = true\n    this._originalTitle = this.item.title\n    this.$input.focus()\n  }\n\n  onBlur() {\n    const title = String(this.$input.value).trim()\n    if (title) {\n      this.item.title = title\n    } else {\n      this.item.title = this._originalTitle\n    }\n    this.editing = false\n  }\n\n  onInputKey(event: CustomEvent) {\n    const keyboardEvent = event.detail as KeyboardEvent\n    if (['Enter', 'Escape'].includes(keyboardEvent.key)) {\n      this.$input.blur()\n    }\n  }\n}\nRegister(TodoItem)\n\nexport const todoItem = function(arg0: TodoItemProps) {\n  return TodoItem.vConstructor(arg0)\n}","//@ts-nocheck\nimport { IoElement, Register, section, input, label, ul, ReactiveProperty, IoElementProps } from '@io-gui/core'\nimport { TodoListModel } from './TodoListModel.js'\nimport { todoItem } from './TodoItem.js'\n\ntype TodoListProps = IoElementProps & {\n  model?: TodoListModel\n  route?: string\n}\n\nexport class TodoList extends IoElement {\n  static get Style() {\n    return /* CSS */`\n      :host {\n        flex-direction: column;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: TodoListModel})\n  declare model: TodoListModel\n\n  @ReactiveProperty({value: 'all'})\n  declare route: string\n\n  constructor(args: TodoListProps = {}) { super(args) }\n\n  modelMutated() {\n    this.changed()\n  }\n\n  changed() {\n    const itemsInRoute = this.model.items.filter(this.model.filters[this.route as keyof typeof this.model.filters])\n    this.render([\n      section({class: 'main'}, [\n        input({type: 'checkbox', id: 'toggle-all', class: 'toggle-all', checked: this.model.allCompleted}),\n        (this.model.items.length && !this.model.allCompleted) ? label({for: 'toggle-all', '@click': this.model.completeAll}, 'Mark all as complete') : null,\n        ul({class: 'todo-list'},\n          itemsInRoute.map((item) => todoItem({item: item, model: this.model}))\n        )\n      ]),\n    ])\n  }\n}\nRegister(TodoList)\n\nexport const todoList = function(arg0: TodoListProps) {\n  return TodoList.vConstructor(arg0)\n}","import { IoElement, Register, IoElementProps, span, ul, li, a, button, ReactiveProperty, WithBinding } from '@io-gui/core'\nimport { TodoListModel } from './TodoListModel.js'\n\ntype TodoFooterProps = IoElementProps & {\n  model?: TodoListModel\n  route?: WithBinding<string>\n}\n\nexport class TodoFooter extends IoElement {\n  static get Style() {\n    return /* css */`\n      :host a {\n        cursor: pointer;\n      }\n    `\n  }\n\n  @ReactiveProperty({type: TodoListModel})\n  declare model: TodoListModel\n\n  @ReactiveProperty({value: 'all'})\n  declare route: string\n\n  constructor(args: TodoFooterProps = {}) { super(args) }\n\n  onRouteClicked(event: CustomEvent) {\n    const target = event.target as HTMLElement\n    this.route = target.innerText.toLowerCase()\n  }\n\n  modelMutated() {\n    this.changed()\n  }\n\n  changed() {\n    this.render([\n      span({class: 'todo-count'}, String(this.model.activeCount) + (this.model.activeCount === 1 ? ' item' : ' items') + ' left'),\n      ul({class: 'filters'}, [\n        li([a({'@click': this.onRouteClicked, class: this.route === 'all' ? 'selected' : ''}, 'All')]),\n        li([a({'@click': this.onRouteClicked, class: this.route === 'active' ? 'selected' : ''}, 'Active')]),\n        li([a({'@click': this.onRouteClicked, class: this.route === 'completed' ? 'selected' : ''}, 'Completed')]),\n      ]),\n      this.model.completedCount ? button({class: 'clear-completed', '@click': this.model.clearCompleted}, 'Clear completed') : null\n    ])\n  }\n}\nRegister(TodoFooter)\n\nexport const todoFooter = function(arg0: TodoFooterProps) {\n  return TodoFooter.vConstructor(arg0)\n}","import { IoElement, Register, Storage as $, section, header, h1, div, p, a, span, ReactiveProperty } from '@io-gui/core'\n\nimport { TodoListModel } from './TodoListModel.js'\nimport { todoInput } from './TodoInput.js'\nimport { todoList } from './TodoList.js'\nimport { todoFooter } from './TodoFooter.js'\n\n$.permit()\nconst $route = $({key: 'route', storage: 'hash', value: 'all'})\nconst $model = $({key: 'model', storage: 'local', value: new TodoListModel({items: []})})\n\nexport class TodoApp extends IoElement {\n  @ReactiveProperty($model)\n  declare model: TodoListModel\n\n  @ReactiveProperty($route)\n  declare route: string\n\n  ready() {\n    this.changed()\n  }\n\n  modelMutated() {\n    this.changed()\n  }\n\n  changed() {\n    this.render([\n      section({class: 'todoapp'}, [\n        header({class: 'header'}, [\n          h1('todos'),\n          todoInput({model: this.model}),\n        ]),\n        todoList({class: 'todo-list', model: this.model, route: this.route}),\n        this.model.count ? todoFooter({class: 'footer', model: this.model, route: this.bind('route')}) : null,\n      ]),\n      div({class: 'info'}, [\n        p('Double-click to edit a todo'),\n        p([\n          // TODO: implement text and DOM mixed content rendering\n          span('Created with '),\n          a({href: 'https://iogui.dev', target: '_blank'}, 'Io-Gui'),\n        ]),\n        p([\n          // TODO: implement text and DOM mixed content rendering\n          span('Part of '),\n          a({href: 'http://todomvc.com/', target: '_blank'}, 'TodoMVC')\n        ])\n      ])\n    ])\n  }\n}\nRegister(TodoApp)\nexport const todoApp = TodoApp.vConstructor"],"names":["bothAreNaNs","value","oldValue","isNaN","Binding","node","property","targets","Set","targetProperties","WeakMap","constructor","_isNode","_isIoElement","console","warn","_reactiveProperties","has","this","onSourceChanged","bind","onTargetChanged","addEventListener","addTarget","target","targetProps","getTargetProperties","indexOf","error","add","push","targetP","get","binding","info","removeTarget","srcP","valueMismatch","typeMismatch","type","type1","type2","prototype","setProperty","i","splice","propertyInstance","removeEventListener","length","prop","delete","event","detail","j","propName","set","toJSON","targetNames","name","dispose","clear","ChangeQueue","dispatchedChange","dispatching","changes","Object","defineProperty","dispatch","enumerable","writable","configurable","queue","findIndex","change","properties","handlerName","changed","dispatchMutation","hardenListenerDefinition","listenerDefinition","Array","isArray","LISTENER_OPTIONS","listenerFromDefinition","def","handlerDef","options","invalidOptions","keys","filter","k","includes","join","handler","EventDispatcher","nodeIsEventTarget","protoListeners","propListeners","addedListeners","EventTarget","setProtoListeners","_protochain","listeners","listener","call","applyPropListeners","newPropListeners","startsWith","slice","definition","newListener","oldListener","JSON","stringify","l","listenerTuple","index","item","dispatchEvent","bubbles","path","_disposed","CustomEvent","composed","cancelable","payload","parent","_parents","_eventDispatcher","NodeArray","args","super","itemMutated","_observers","self","proxy","Proxy","Number","_isInternalOperation","oldLength","newLength","removeParent","addParent","Symbol","species","withInternalOperation","operation","start","deleteCount","items","result","unshift","pop","shift","reverse","sort","compareFn","fill","end","len","relativeStart","relativeEnd","actualStart","Math","max","min","actualEnd","oldItem","copyWithin","relativeTarget","actualTarget","count","addObserver","removeObserver","observer","object","ReactiveProtoProperty","d","hasOwn","reflect","init","assign","protoProp","json","decodeInitArgument","split","isIoValue","Observer","observing","onPropertyMutated","_hasSelfMutationListener","_hasWindowMutationListener","window","stop","ReactivePropertyInstance","propDef","forEach","key","Boolean","String","map","argument","propertyDecorators","reactivePropertyDecorators","ReactiveProperty","defLoose","propertyName","styleDecorators","ProtoChain","constructors","reactiveProperties","style","handlers","ioNodeConstructor","proto","HTMLElement","getPrototypeOf","reactivePropertyHash","propertyHash","addPropertiesFromDecorators","addProperties","Properties","addReactivePropertiesFromDecorators","addReactiveProperties","ReactiveProperties","addListeners","Listeners","addStyle","Style","addStyleFromDecorators","addHandlers","validateReactiveProperties","freeze","Error","props","prevHash","newHash","protoProperty","reativeProtoProperties","listenerDefs","lsnDef","names","getOwnPropertyNames","fn","test","endsWith","propDesr","getOwnPropertyDescriptor","isNull","isUndefined","currentFrame","queue0","Map","queue1","keysByNode","keysByFunc","throttleNextFrame","throttleNextFrameGlobal","getKey","func","funcMap","throttle","arg","delay","nextAllowed","Infinity","e","frame","existing","debounce","requestAnimationFrame","executeQueue","activeQueue","defaultPropsMap","applyNativeElementProps","element","defaultPropValues","_p","p","localName","s","removeAttribute","setAttribute","constructElement","vDOMElement","ConstructorClass","customElements","tag","document","createElement","disposeChildren","elements","from","querySelectorAll","concat","vDOMAttributes","attributes","getAttribute","toVDOMChildren","htmlCollection","children","toVDOM","textContent","Register","mixinRecord","commentsRegex","RegExp","keyframeRegex","mediaQueryRegex","mixinRegex","applyRegex","cssRegex","resizeObserver","ResizeObserver","entries","entry","onResized","IoElement","initReactiveProperties","initProperties","applyProperties","ready","dispatchQueue","skipDispatch","className","hasAttribute","setProperties","toLowerCase","toStringTag","_changeQueue","timeout","unbind","src","connectedCallback","observe","disconnectedCallback","unobserve","render","vDOMElements","host","noDispose","vDOMElementsOnly","$","traverse","vChildren","child","removeChild","oldElement","insertBefore","frag","createDocumentFragment","appendChild","vChild","id","_flattenTextNode","_textNode","nodeValue","childNodes","createTextNode","nodeName","innerHTML","attr","replace","define","applyElementStyleToDocument","mixinsString","mixins","match","m","trim","apply","styleStripped","selector","styleElement","head","arg0","arg1","__decorateClass","Property","initialValue","vConstructor","NODES","active","disposed","WeakSet","hasValueAtOtherProperty","found","ReactiveNode","oldBinding","nodeArray","some","reactivity","isIoObject","hasMutated","_bindings","localStorage","EmulatedLocalStorage","permitted","getItem","store","setItem","strValue","warned","removeItem","nodes","local","hash","none","hashValues","StorageNode","storage","default","storedValue","getValueFromHash","parseHash","location","parse","clearStorage","removeValueToHash","valueMutated","valueChanged","saveValueToHash","hashString","h","history","replaceState","title","pathname","search","Storage","permit","unpermit","substring","reduce","parts","updateAllFromHash","Color","r","g","b","a","toCss","floor","LIGHT_THEME","spacing","spacing2","spacing3","spacing5","spacing8","lineHeight","fontSize","fieldHeight","borderRadius","borderWidth","borderColor","borderColorLight","borderColorStrong","borderColorRed","borderColorGreen","borderColorBlue","bgColor","bgColorStrong","bgColorLight","bgColorRed","bgColorGreen","bgColorBlue","bgColorInput","color","colorStrong","colorLight","colorRed","colorGreen","colorBlue","colorWhite","colorInput","gradientColorStart","gradientColorEnd","shadowColor","DARK_THEME","$ThemeID","matchMedia","matches","$Themes","Theme","registerTheme","themeIDChanged","themeID","theme","themeDefaults","reset","values","fontSizeChanged","lineHeightChanged","propertyVariables","onSaveTheme","ThemeSingleton","glsl","_needsResize","_canvas","_ctx","_vecLengths","_shader","canvas","gl","getContext","antialias","premultipliedAlpha","getExtension","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","disable","DEPTH_TEST","positionBuff","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","uvBuff","indexBuff","ELEMENT_ARRAY_BUFFER","Uint16Array","shadersCache","currentProgram","IoGl","__privateAdd","__privateSet","__privateGet","alpha","uname","charAt","toUpperCase","initShader","linkProgram","position","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","uv","updateThemeUniforms","Vert","GlUtils","Frag","initPropertyUniform","_glUtils","vertShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","compilationLog","getShaderInfoLog","fragShader","FRAGMENT_SHADER","program","createProgram","attachShader","pxRatio","devicePixelRatio","rect","getBoundingClientRect","getComputedStyle","bw","parseInt","borderRightWidth","borderLeftWidth","bh","borderTopWidth","borderBottomWidth","width","height","size","ctx","themeMutated","onRender","setShaderProgram","updatePropertyUniform","viewport","clearColor","COLOR_BUFFER_BIT","clearRect","drawElements","TRIANGLES","UNSIGNED_SHORT","drawImage","useProgram","setUniform","uniform","getUniformLocation","_c","uniform1i","uniform1f","x","c","uniform2f","uniform3f","uniform4f","glUtilsProp","nativeVDOMConstructors","button","div","header","h1","input","label","li","section","span","ul","focusRestoreTarget","IoOverlay","pointerdown","passive","pointermove","pointerup","contextmenu","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","keydown","keyup","focusin","blur","scroll","wheel","expandAsChildren","stopPropagation","onPointerup","composedPath","collapse","onContextmenu","preventDefault","onScroll","onChildExpandedChanged","expanded","expandedChanged","focus","IoOverlaySingleton","setTimeout","body","activeElement","capture","focusBacktrack","backtrackDir","ArrowLeft","ArrowRight","ArrowDown","ArrowUp","setFocusBacktrack","dir","source","getRectDistance","rect1","rect2","dirBias","right","left","bottom","top","dx","dy","MIN_DISTANCE","getCenterDistance","c1","y","onIoFocusTo","srcRect","cmd","command","inoverlay","Overlay","contains","closestElement","closestDistance","closestCenterDistance","backtrack","visible","offsetParent","sStyle","visibility","display","root","focusableCandidates","tabIndex","focusableSiblingCandidates","parentElement","el","opacity","candidate","biasMagnitude","distance","centerDistance","TodoItemModel","toggle","completed","fromJSON","TodoListModel","onDeleteItem","filters","all","completedCount","activeCount","allCompleted","every","completeAll","clearCompleted","itemsMutated","TodoInput","onInputKey","inputElement","model","class","placeholder","autofocus","TodoItem","$input","_originalTitle","editing","checked","onStartEdit","onBlur","querySelector","keyboardEvent","TodoList","modelMutated","itemsInRoute","route","for","todoItem","todoList","TodoFooter","onRouteClicked","innerText","todoFooter","$route","$model","TodoApp","href"],"mappings":"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"}