import{IoStorage,IoNode,html,IoElement}from"./io.js";const isDarkMode=!!window.matchMedia("(prefers-color-scheme: dark)").matches,themeSizes={cssSpacing:3,cssBorderRadius:3,cssBorderWidth:1,cssStrokeWidth:1,cssLineHeight:20,cssItemHeight:28,cssFontSize:13},themeDB={light:Object.assign({cssBackgroundColor:[.96,.96,.96,1],cssBackgroundColorLight:[1,1,1,1],cssBackgroundColorDark:[.84,.84,.84,1],cssBackgroundColorField:[.92,.92,.92,1],cssColor:[.16,.16,.16,1],cssColorError:[.91,.5,.5,1],cssColorLink:[.2,.75,.2,1],cssColorFocus:[.3,.6,1,1],cssColorField:[0,0,0,1],cssColorNumber:[.12,.64,1,1],cssColorString:[.95,.25,.1,1],cssColorBoolean:[.82,.35,.75,1],cssColorBorder:[.7,.7,.7,1],cssColorBorderLight:[1,1,1,1],cssColorBorderDark:[.72,.72,.72,1],cssColorGradientStart:[1,1,1,.5],cssColorGradientEnd:[0,0,0,.25],cssColorShadow:[0,0,0,.2]},themeSizes),dark:Object.assign({cssBackgroundColor:[.164,.164,.164,1],cssBackgroundColorLight:[.22,.22,.22,1],cssBackgroundColorDark:[.25,.25,.25,1],cssBackgroundColorField:[.137,.137,.137,1],cssColor:[.823,.823,.823,1],cssColorError:[1,.376,.062,1],cssColorLink:[.75,.9,.59,1],cssColorFocus:[.3,.82,1.4,1],cssColorField:[.75,.75,.75,1],cssColorNumber:[.125,.64,1,1],cssColorString:[.94,.25,.086,1],cssColorBoolean:[.82,.35,.75,1],cssColorBorder:[.4,.4,.4,1],cssColorBorderLight:[.5,.5,.5,1],cssColorBorderDark:[.1,.1,.1,1],cssColorGradientStart:[1,1,1,.1],cssColorGradientEnd:[0,0,0,.2],cssColorShadow:[0,0,0,.2]},themeSizes)},theme=IoStorage("theme",isDarkMode?"dark":"light"),vars=themeDB[theme.value]||themeDB.light;class IoTheme extends IoNode{static get Mixins(){return html`<style>item {display: inline-block;cursor: pointer;user-select: none;-webkit-tap-highlight-color: transparent;-webkit-user-select: none;-webkit-touch-callout: none;overflow: hidden;text-overflow: ellipsis;flex-wrap: nowrap;white-space: nowrap;box-sizing: border-box;line-height: var(--io-line-height);height: var(--io-item-height);font-size: var(--io-font-size);border-radius: var(--io-border-radius);border: var(--io-border);border-color: transparent;color: var(--io-color);background-color: transparent;background-image: none;padding: var(--io-spacing);transition: background-color 0.25s;}panel {display: flex;flex-direction: column;align-self: stretch;justify-self: stretch;align-items: flex-start;border-radius: calc(var(--io-border-radius) + var(--io-spacing));border: var(--io-border);border-color: var(--io-color-border-outset);color: var(--io-color-field);background-color: var(--io-background-color-dark);background-image: var(--io-gradient-panel);padding: var(--io-spacing);}frame {display: flex;flex-direction: column;align-self: stretch;justify-self: stretch;align-items: flex-start;border-radius: var(--io-border-radius);border: var(--io-border);border-color: var(--io-color-border-inset);color: var(--io-color);background-color: var(--io-background-color);background-image: none;padding: var(--io-spacing);box-shadow: var(--io-shadow-inset);}content {display: flex;flex-direction: column;flex: 1 1 auto;overflow-x: hidden;overflow-y: auto;-webkit-overflow-scrolling: touch;-webkit-tap-highlight-color: transparent;}row {display: flex;flex: 1 1;flex-direction: row;align-self: stretch;justify-self: stretch;}column {display: flex;flex: 1 1;flex-direction: column;align-self: stretch;justify-self: stretch;}table2 {display: grid;grid-template-columns: repeat(2, 1fr);grid-gap: var(--io-spacing);}table3 {display: grid;grid-template-columns: repeat(3, 1fr);grid-gap: var(--io-spacing);}table4 {display: grid;grid-template-columns: repeat(4, 1fr);grid-gap: var(--io-spacing);}table5 {display: grid;grid-template-columns: repeat(5, 1fr);grid-gap: var(--io-spacing);}</style>`}static get Properties(){return{theme:theme,cssSpacing:vars.cssSpacing,cssBorderRadius:vars.cssBorderRadius,cssBorderWidth:vars.cssBorderWidth,cssStrokeWidth:vars.cssStrokeWidth,cssLineHeight:vars.cssLineHeight,cssItemHeight:vars.cssItemHeight,cssFontSize:vars.cssFontSize,cssBackgroundColor:vars.cssBackgroundColor,cssBackgroundColorLight:vars.cssBackgroundColorLight,cssBackgroundColorDark:vars.cssBackgroundColorDark,cssBackgroundColorField:vars.cssBackgroundColorField,cssColor:vars.cssColor,cssColorError:vars.cssColorError,cssColorLink:vars.cssColorLink,cssColorFocus:vars.cssColorFocus,cssColorField:vars.cssColorField,cssColorNumber:vars.cssColorNumber,cssColorString:vars.cssColorString,cssColorBoolean:vars.cssColorBoolean,cssColorBorder:vars.cssColorBorder,cssColorBorderLight:vars.cssColorBorderLight,cssColorBorderDark:vars.cssColorBorderDark,cssColorGradientStart:vars.cssColorGradientStart,cssColorGradientEnd:vars.cssColorGradientEnd,cssColorShadow:vars.cssColorShadow}}constructor(e){super(e),this.mixinsElement=document.createElement("style"),this.mixinsElement.setAttribute("id","io-theme-mixins"),this.mixinsElement.innerHTML=this.mixins,document.head.appendChild(this.mixinsElement),this.variablesElement=document.createElement("style"),this.variablesElement.setAttribute("id","io-theme-variables"),document.head.appendChild(this.variablesElement)}_toCss(e){const t=Math.floor(255*e[0]),o=Math.floor(255*e[1]),i=Math.floor(255*e[2]);return void 0!==e[3]?`rgba(${t}, ${o}, ${i}, ${e[3]})`:`rgb(${t}, ${o}, ${i})`}themeChanged(){const e=themeDB[this.theme]||themeDB.light;this.setProperties({cssSpacing:e.cssSpacing,cssBorderRadius:e.cssBorderRadius,cssBorderWidth:e.cssBorderWidth,cssStrokeWidth:e.cssStrokeWidth,cssLineHeight:e.cssLineHeight,cssItemHeight:e.cssItemHeight,cssFontSize:e.cssFontSize,cssBackgroundColor:e.cssBackgroundColor,cssBackgroundColorLight:e.cssBackgroundColorLight,cssBackgroundColorDark:e.cssBackgroundColorDark,cssBackgroundColorField:e.cssBackgroundColorField,cssColor:e.cssColor,cssColorError:e.cssColorError,cssColorLink:e.cssColorLink,cssColorFocus:e.cssColorFocus,cssColorField:e.cssColorField,cssColorNumber:e.cssColorNumber,cssColorString:e.cssColorString,cssColorBoolean:e.cssColorBoolean,cssColorBorder:e.cssColorBorder,cssColorBorderLight:e.cssColorBorderLight,cssColorBorderDark:e.cssColorBorderDark,cssColorGradientStart:e.cssColorGradientStart,cssColorGradientEnd:e.cssColorGradientEnd,cssColorShadow:e.cssColorShadow}),this.dispatchEvent("object-mutated",{object:this},!1,window)}changed(){this.dispatchEvent("object-mutated",{object:this},!1,window),this.__properties.cssItemHeight.value=this.cssLineHeight+2*(this.cssSpacing+this.cssBorderWidth),this.variablesElement.innerHTML=`\n      body {\n        --io-spacing: ${this.cssSpacing}px;\n        --io-border-radius: ${this.cssBorderRadius}px;\n        --io-border-width: ${this.cssBorderWidth}px;\n        --io-stroke-width: ${this.cssStrokeWidth}px;\n        --io-line-height: ${this.cssLineHeight}px;\n        --io-item-height: ${this.cssItemHeight}px;\n        --io-font-size: ${this.cssFontSize}px;\n\n        --io-background-color: ${this._toCss(this.cssBackgroundColor)};\n        --io-background-color-light: ${this._toCss(this.cssBackgroundColorLight)};\n        --io-background-color-dark: ${this._toCss(this.cssBackgroundColorDark)};\n        --io-background-color-field: ${this._toCss(this.cssBackgroundColorField)};\n\n        --io-color: ${this._toCss(this.cssColor)};\n        --io-color-error: ${this._toCss(this.cssColorError)};\n        --io-color-link: ${this._toCss(this.cssColorLink)};\n        --io-color-focus: ${this._toCss(this.cssColorFocus)};\n        --io-color-field: ${this._toCss(this.cssColorField)};\n        --io-color-number: ${this._toCss(this.cssColorNumber)};\n        --io-color-string: ${this._toCss(this.cssColorString)};\n        --io-color-boolean: ${this._toCss(this.cssColorBoolean)};\n        --io-color-border: ${this._toCss(this.cssColorBorder)};\n        --io-color-border-light: ${this._toCss(this.cssColorBorderLight)};\n        --io-color-border-dark: ${this._toCss(this.cssColorBorderDark)};\n        --io-color-gradient-start: ${this._toCss(this.cssColorGradientStart)};\n        --io-color-gradient-end: ${this._toCss(this.cssColorGradientEnd)};\n        --io-color-shadow: ${this._toCss(this.cssColorShadow)};\n\n\n        --io-border: var(--io-border-width) solid var(--io-color-border);\n        --io-border-error: var(--io-border-width) solid var(--io-color-error);\n        --io-color-border-inset: var(--io-color-border-dark) var(--io-color-border-light) var(--io-color-border-light) var(--io-color-border-dark);\n        --io-color-border-outset: var(--io-color-border-light) var(--io-color-border-dark) var(--io-color-border-dark) var(--io-color-border-light);\n\n        --io-gradient-button: linear-gradient(180deg, var(--io-color-gradient-start), var(--io-color-gradient-end) 100%);\n        --io-gradient-panel: linear-gradient(45deg, var(--io-color-gradient-start), var(--io-color-gradient-end) 100%);\n        --io-gradient-error: repeating-linear-gradient(135deg, transparent, var(--io-color-error) 1px, var(--io-color-error) 4px, transparent 6px);\n\n        --io-shadow: 2px 2px 5px var(--io-color-shadow);\n        --io-shadow-inset: 1px 1px 1px inset var(--io-color-shadow);\n        --io-shadow-outset: -1px -1px 1px inset var(--io-color-shadow);\n      }\n    `}}IoTheme.Register=function(){IoNode.Register.call(this);let e="";for(let t=this.prototype.__protochain.length;t--;){const o=this.prototype.__protochain[t].constructor.Mixins;if(o){const t=Array.from(o.match(new RegExp(/([\s\S]*?){([\s\S]*?)}/,"g")));for(let o=0;o<t.length;o++){const i=t[o].split("{")[0].replace(/\s/g,""),r=t[o].split("{")[1].replace(/}/g,"");Object.defineProperty(this.prototype,i,{value:r}),e+=`.io-${i} {\n${r}\n}\n`}}}Object.defineProperty(this.prototype,"mixins",{value:e})},IoTheme.Register();const IoThemeSingleton=new IoTheme;IoThemeSingleton.connect();class IoItem extends IoElement{static get Style(){return html`<style>:host {${IoThemeSingleton.item};}:host[pressed] {border-color: var(--io-color-border-inset);box-shadow: var(--io-shadow-inset);}:host[hidden] {display: none;}:host[selected] {color: var(--io-color-link);background-color: var(--io-background-color-light);}:host[aria-invalid] {border: var(--io-border-error);background-image: var(--io-gradient-error);}:host:hover {background-color: var(--io-background-color-light);}:host:focus {text-overflow: inherit;border-color: var(--io-color-focus);outline-color: var(--io-color-focus);}</style>`}static get Properties(){return{value:void 0,pressed:{type:Boolean,reflect:!0},hidden:{type:Boolean,reflect:!0},selected:{type:Boolean,reflect:!0},tabindex:0}}static get Listeners(){return{focus:"_onFocus",pointerdown:"_onPointerdown",click:"_onClick"}}get textNode(){return this.flattenTextNode(this),this._textNode.nodeValue}set textNode(e){this.flattenTextNode(this),this._textNode.nodeValue=String(e)}constructor(e){super(e),Object.defineProperty(this,"_textNode",{value:document.createTextNode(""),writable:!0}),this.appendChild(this._textNode)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this.removeEventListener("keyup",this._onKeydown),this.removeEventListener("pointermove",this._onPointermove),this.removeEventListener("pointerleave",this._onPointerleave),this.removeEventListener("pointerup",this._onPointerup)}_onFocus(){this.addEventListener("blur",this._onBlur),this.addEventListener("keydown",this._onKeydown),this.addEventListener("keyup",this._onKeyup)}_onBlur(){this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this.removeEventListener("keyup",this._onKeyup)}_onPointerdown(e){e.preventDefault(),this.addEventListener("pointermove",this._onPointermove),this.addEventListener("pointerleave",this._onPointerleave),this.addEventListener("pointerup",this._onPointerup),this.pressed=!0}_onPointermove(){}_onPointerleave(){this.removeEventListener("pointermove",this._onPointermove),this.removeEventListener("pointerleave",this._onPointerleave),this.removeEventListener("pointerup",this._onPointerup),this.pressed=!1}_onPointerup(){this.removeEventListener("pointermove",this._onPointermove),this.removeEventListener("pointerleave",this._onPointerleave),this.removeEventListener("pointerup",this._onPointerup),this.pressed=!1,this.focus()}_onClick(){this.dispatchEvent("item-clicked",{value:this.value,label:this.label},!0)}_onKeydown(e){"Enter"===e.key||" "===e.key?(this.pressed=!0,e.preventDefault(),this._onClick(e)):"ArrowLeft"===e.key?(e.preventDefault(),this.focusTo("left")):"ArrowUp"===e.key?(e.preventDefault(),this.focusTo("up")):"ArrowRight"===e.key?(e.preventDefault(),this.focusTo("right")):"ArrowDown"===e.key&&(e.preventDefault(),this.focusTo("down"))}_onKeyup(){this.pressed=!1}changed(){if(this.label)this.textNode=this.label,this.title=this.label;else{let e;e=this.value&&"object"==typeof this.value?`${this.value.constructor.name}`+(this.value instanceof Array?`(${this.value.length})`:""):String(this.value),this.textNode=e,this.title=e}this.setAria()}setAria(){this.label?this.setAttribute("aria-label",this.label):this.setAttribute("aria-label",!1)}}IoItem.Register();const canvas=document.createElement("canvas"),gl=canvas.getContext("webgl",{antialias:!1,premultipliedAlpha:!0});gl.imageSmoothingEnabled=!1,gl.getExtension("OES_standard_derivatives"),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.disable(gl.DEPTH_TEST);const positionBuff=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,positionBuff),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,1,0,-1,-1,0,1,-1,0,1,1,0]),gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,null);const uvBuff=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,uvBuff),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,null);const indexBuff=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexBuff),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([3,2,1,3,1,0]),gl.STATIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexBuff);const shadersCache=new WeakMap;let currentProgram;class IoGl extends IoElement{static get Style(){return html`<style>:host {position: relative;overflow: hidden !important;-webkit-tap-highlight-color: transparent;user-select: none;box-sizing: border-box;}:host > .io-gl-canvas {position: absolute;top: 0;left: 0;border-radius: calc(var(--io-border-radius) - var(--io-border-width));pointer-events: none;/* image-rendering: pixelated; */}</style>`}static get Properties(){return{size:[0,0],color:[1,1,1,1],pxRatio:1,css:Object}}static get Vert(){return"\n      attribute vec3 position;\n      attribute vec2 uv;\n      varying vec2 vUv;\n\n      void main(void) {\n        vUv = uv;\n        gl_Position = vec4(position, 1.0);\n      }\n\n"}static get GlUtils(){return"\n    #ifndef saturate\n      #define saturate(v) clamp(v, 0., 1.)\n    #endif\n\n    vec2 translate(vec2 samplePosition, vec2 xy){\n      return samplePosition - vec2(xy.x, xy.y);\n    }\n    vec2 translate(vec2 samplePosition, float x, float y){\n      return samplePosition - vec2(x, y);\n    }\n    float circle(vec2 samplePosition, float radius){\n      return saturate((length(samplePosition) - radius) * uPxRatio);\n    }\n    float rectangle(vec2 samplePosition, vec2 halfSize){\n      vec2 edgeDistance = abs(samplePosition) - halfSize;\n      float outside = length(max(edgeDistance, 0.));\n      float inside = min(max(edgeDistance.x, edgeDistance.y), 0.);\n      return saturate((outside + inside) * uPxRatio); // TODO: check\n    }\n    float grid(vec2 samplePosition, float gridWidth, float gridHeight, float lineWidth) {\n      vec2 sp = samplePosition / vec2(gridWidth, gridHeight);\n      float linex = abs(fract(sp.x - 0.5) - 0.5) * 2.0 / abs(dFdx(sp.x)) - lineWidth;\n      float liney = abs(fract(sp.y - 0.5) - 0.5) * 2.0 / abs(dFdy(sp.y)) - lineWidth;\n      return saturate(min(linex, liney));\n    }\n    float checker(vec2 samplePosition, float size) {\n      vec2 checkerPos = floor(samplePosition / size);\n      float checkerMask = mod(checkerPos.x + mod(checkerPos.y, 2.0), 2.0);\n      return checkerMask;\n    }\n\n"}static get Frag(){return"\n      varying vec2 vUv;\n      void main(void) {\n        vec2 position = uSize * vUv;\n        float gridWidth = 8. * uPxRatio;\n        float lineWidth = 1. * uPxRatio;\n        float gridShape = grid(position, gridWidth, gridWidth, lineWidth);\n        gl_FragColor = mix(vec4(vUv, 0.0, 1.0), uColor, gridShape);\n      }\n\n"}initPropertyUniform(e,t){if(t.notify)switch(t.type){case Boolean:return"uniform int "+e+";\n";case Number:return"uniform float "+e+";\n";case Array:return this._vecLengths[e]=t.value.length,"uniform vec"+t.value.length+" "+e+";\n"}return""}initShader(){let e="\n    #extension GL_OES_standard_derivatives : enable\n    precision highp float;\n";for(let t in this.css.__properties){const o=this.css.__protoProperties[t];e+=this.initPropertyUniform(t,o)}e+="\n";for(let t in this.__properties){const o="u"+t.charAt(0).toUpperCase()+t.slice(1),i=this.__protoProperties[t];e+=this.initPropertyUniform(o,i)}for(let t=this.__protochain.length;t--;){const o=this.__protochain[t].constructor,i=Object.getOwnPropertyDescriptor(o,"GlUtils");i&&i.get&&(e+=o.GlUtils)}const t=gl.createShader(gl.VERTEX_SHADER);if(gl.shaderSource(t,this.constructor.Vert),gl.compileShader(t),!gl.getShaderParameter(t,gl.COMPILE_STATUS)){let e=gl.getShaderInfoLog(t);console.error("IoGl [Vertex Shader] "+this.localName+" error:"),console.warn(e)}const o=gl.createShader(gl.FRAGMENT_SHADER);if(gl.shaderSource(o,e+this.constructor.Frag),gl.compileShader(o),!gl.getShaderParameter(o,gl.COMPILE_STATUS)){let e=gl.getShaderInfoLog(o);console.error("IoGl [Frament Shader] "+this.localName+" error:"),console.warn(e)}const i=gl.createProgram();return gl.attachShader(i,t),gl.attachShader(i,o),i}constructor(e){super(e),this.css=IoThemeSingleton,this._vecLengths={};for(let e in this.css.__properties){const t=this.css.__protoProperties[e];t.notify&&t.type===Array&&(this._vecLengths[e]=t.value.length)}for(let e in this.__properties){const t="u"+e.charAt(0).toUpperCase()+e.slice(1),o=this.__protoProperties[e];o.notify&&o.type===Array&&(this._vecLengths[t]=o.value.length)}shadersCache.has(this.constructor)?this._shader=shadersCache.get(this.constructor):(this._shader=this.initShader(),shadersCache.set(this.constructor,this._shader)),gl.linkProgram(this._shader);const t=gl.getAttribLocation(this._shader,"position");gl.bindBuffer(gl.ARRAY_BUFFER,positionBuff),gl.vertexAttribPointer(t,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(t);const o=gl.getAttribLocation(this._shader,"uv");gl.bindBuffer(gl.ARRAY_BUFFER,uvBuff),gl.vertexAttribPointer(o,2,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(o),this.render=this.render.bind(this),this.template([["canvas",{id:"canvas",class:"io-gl-canvas"}]]),this.$.canvas.ctx=this.$.canvas.getContext("2d"),this.updateCssUniforms()}onResized(){const e=window.devicePixelRatio,t=this.getBoundingClientRect(),o=window.getComputedStyle(this),i=parseInt(o.borderRightWidth)+parseInt(o.borderLeftWidth),r=parseInt(o.borderTopWidth)+parseInt(o.borderBottomWidth),s=Math.max(0,Math.floor(t.width-i)),n=Math.max(0,Math.floor(t.height-r));(s!==this.size[0]||n!==this.size[1]||e!==this.pxRatio)&&(this.$.canvas.style.width=Math.floor(s)+"px",this.$.canvas.style.height=Math.floor(n)+"px",this.$.canvas.width=Math.floor(s*e),this.$.canvas.height=Math.floor(n*e),this.setProperties({size:[s,n],pxRatio:e}))}cssMutated(){this.updateCssUniforms(),this.requestAnimationFrameOnce(this.render)}changed(){window.ResizeObserver?this.requestAnimationFrameOnce(this.render):setTimeout(()=>{this.onResized(),this.requestAnimationFrameOnce(this.render)})}render(){const e=this.size[0]*this.pxRatio,t=this.size[1]*this.pxRatio;if(e&&t){this.setShaderProgram();for(let e in this.__properties){const t="u"+e.charAt(0).toUpperCase()+e.slice(1);this.updatePropertyUniform(t,this.__properties[e])}canvas.width=e,canvas.height=t,gl.viewport(0,0,e,t),gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0),this.$.canvas.ctx.drawImage(canvas,0,0)}}setShaderProgram(){currentProgram!==this._shader&&(currentProgram=this._shader,gl.useProgram(this._shader))}updatePropertyUniform(e,t){this.setShaderProgram(),t.notify&&this.setUniform(e,t.type,t.value)}updateCssUniforms(){for(let e in this.css.__properties)this.updatePropertyUniform(e,this.css.__properties[e])}setUniform(e,t,o){const i=gl.getUniformLocation(this._shader,e);let r;switch(t){case Boolean:gl.uniform1i(i,o?1:0);break;case Number:gl.uniform1f(i,void 0!==o?o:1);break;case Array:switch(r=[0,1,2,3],o instanceof Array||"object"!=typeof o||(void 0!==o.x?r=["x","y","z","w"]:void 0!==o.r?r=["r","g","b","a"]:void 0!==o.h?r=["h","s","v","a"]:void 0!==o.c&&(r=["c","m","y","k"])),this._vecLengths[e]){case 2:if(void 0===o){gl.uniform2f(i,0,0);break}gl.uniform2f(i,void 0!==o[r[0]]?o[r[0]]:1,void 0!==o[r[1]]?o[r[1]]:1);break;case 3:if(void 0===o){gl.uniform3f(i,0,0,0);break}gl.uniform3f(i,void 0!==o[r[0]]?o[r[0]]:1,void 0!==o[r[1]]?o[r[1]]:1,void 0!==o[r[2]]?o[r[2]]:1);break;case 4:if(void 0===o){gl.uniform4f(i,0,0,0,0);break}gl.uniform4f(i,void 0!==o[r[0]]?o[r[0]]:1,void 0!==o[r[1]]?o[r[1]]:1,void 0!==o[r[2]]?o[r[2]]:1,void 0!==o[r[3]]?o[r[3]]:1)}}}}IoGl.Register();class IoButton extends IoItem{static get Style(){return html`<style>:host {text-align: center;border: var(--io-border);border-color: var(--io-color-border-outset);background-color: var(--io-background-color-dark);background-image: var(--io-gradient-button);padding-left: calc(2 * var(--io-spacing));padding-right: calc(2 * var(--io-spacing));}:host[pressed] {border: var(--io-border);border-color: var(--io-color-border-inset);}</style>`}static get Properties(){return{action:Function,value:void 0,label:"Button",role:"button"}}_onClick(){"function"==typeof this.action&&this.action(this.value)}}IoButton.Register();class IoBoolean extends IoItem{static get Properties(){return{label:"Boolean",value:{type:Boolean,reflect:1},true:"true",false:"false",role:"switch"}}_onClick(){this.toggle()}toggle(){this.set("value",!this.value)}valueChanged(){this.setAttribute("value",Boolean(this.value))}changed(){this.setAttribute("aria-checked",String(!!this.value)),this.setAttribute("aria-invalid","boolean"!=typeof this.value&&"true"),this.setAttribute("aria-label",this.label),this.title=this.label,this.textNode=this.value?this.true:this.false}}IoBoolean.Register();const IoIconsetDB={};class IoIconset extends IoNode{registerIcons(e,t){const o=document.createElement("div");o.innerHTML=t,o.querySelectorAll("[id]").forEach(t=>{IoIconsetDB[e]=IoIconsetDB[e]||{},IoIconsetDB[e][t.id]=t.outerHTML})}getIcon(e){const t=IoIconsetDB[e.split(":")[0]];if(t){const o=e.split(":")[1];if(t[o]){return`<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet">${t[o].replace(' id="',' class="icon-id-')}</svg>`}}return'<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet"></svg>'}}IoIconset.Register();const IoIconsetSingleton=new IoIconset,icons=html`
<svg><g id="unlink"><path d="M3.2,12c0-1.9,1.5-3.4,3.4-3.4h4.3V6.6H6.6c-3,0-5.4,2.4-5.4,5.4s2.4,5.4,5.4,5.4h4.3v-2.1H6.6C4.7,15.4,3.2,13.9,3.2,12z M17.4,6.6h-4.4v2.1h4.4c1.9,0,3.4,1.5,3.4,3.4s-1.5,3.4-3.4,3.4h-4.4v2.1h4.4c3,0,5.4-2.4,5.4-5.4S20.4,6.6,17.4,6.6z"/></g><g id="link"><path d="M3.2,12c0-1.9,1.5-3.4,3.4-3.4h4.3V6.6H6.6c-3,0-5.4,2.4-5.4,5.4s2.4,5.4,5.4,5.4h4.3v-2.1H6.6C4.7,15.4,3.2,13.9,3.2,12z M7.7,13.1h8.7v-2.2H7.7V13.1z M17.4,6.6h-4.4v2.1h4.4c1.9,0,3.4,1.5,3.4,3.4s-1.5,3.4-3.4,3.4h-4.4v2.1h4.4c3,0,5.4-2.4,5.4-5.4S20.4,6.6,17.4,6.6z"/></g><g id="gear"><path d="M22.7,14.9l-2.4-1.9c0-0.4,0.1-0.7,0.1-1.1s0-0.7-0.1-1.1l2.4-1.9c0.2-0.2,0.3-0.5,0.1-0.7l-2.2-3.9c-0.1-0.2-0.4-0.3-0.7-0.2l-2.8,1.1c-0.6-0.4-1.2-0.8-1.9-1.1l-0.4-3c0-0.3-0.3-0.5-0.5-0.5H9.8C9.5,0.8,9.3,1,9.2,1.3l-0.4,3C8.1,4.5,7.5,4.9,6.9,5.3L4.1,4.2c-0.2-0.1-0.5,0-0.7,0.2L1.2,8.3C1.1,8.6,1.1,8.9,1.3,9.1l2.4,1.9c0,0.4-0.1,0.7-0.1,1.1s0,0.7,0.1,1.1l-2.4,1.9c-0.2,0.2-0.3,0.5-0.1,0.7l2.2,3.9c0.1,0.2,0.4,0.3,0.7,0.2l2.8-1.1c0.6,0.5,1.2,0.8,1.9,1.1l0.4,3c0,0.3,0.3,0.5,0.6,0.5h4.5c0.3,0,0.5-0.2,0.6-0.5l0.4-3c0.7-0.3,1.3-0.6,1.9-1.1l2.8,1.1c0.2,0.1,0.5,0,0.7-0.2l2.2-3.9C23,15.4,22.9,15.1,22.7,14.9z M12,16.1c-2.3,0-4.2-1.9-4.2-4.2S9.7,7.8,12,7.8s4.2,1.9,4.2,4.2S14.3,16.1,12,16.1z"/></g><g id="io-gui-logo-io"><ellipse fill="#83A61E" cx="4.8" cy="12" rx="3.7" ry="3.7"/><path fill="#646464" d="M16.7,18.2c-3.4,0-6.2-2.8-6.2-6.2s2.8-6.2,6.2-6.2s6.2,2.8,6.2,6.2S20.1,18.2,16.7,18.2z M16.7,8.5c-2,0-3.6,1.6-3.6,3.5s1.6,3.5,3.6,3.5s3.6-1.6,3.6-3.5S18.7,8.5,16.7,8.5z"/></g><g id="io-gui-logo"><path fill="#646464" d="M20.4,12.7c0.4-0.4,0.4-1,0-1.4l-0.7-0.7l-2.8-2.8c-0.4-0.4-0.4-1,0-1.4c0.4-0.4,1-0.4,1.4,0l4.2,4.2c0.8,0.8,0.8,2,0,2.8l-4.2,4.2c-0.4,0.4-1,0.4-1.4,0c-0.4-0.4-0.4-1,0-1.4"/><path fill="#646464" d="M3.7,12.7c-0.4-0.4-0.4-1,0-1.4l0.7-0.7l2.8-2.8c0.4-0.4,0.4-1,0-1.4C6.9,6,6.3,6,5.9,6.4l-4.2,4.2c-0.8,0.8-0.8,2,0,2.8l4.2,4.2c0.4,0.4,1,0.4,1.4,0c0.4-0.4,0.4-1,0-1.4"/><ellipse fill="#83A61E" cx="8.2" cy="12" rx="1.9" ry="1.9"/><path fill="#646464" d="M14.2,15.1c-1.7,0-3.1-1.4-3.1-3.1s1.4-3.1,3.1-3.1s3.1,1.4,3.1,3.1S15.9,15.1,14.2,15.1z M14.2,10.2c-1,0-1.8,0.8-1.8,1.8s0.8,1.8,1.8,1.8S16,13,16,12S15.2,10.2,14.2,10.2z"/></g><g id="check"><path d="M20.4,1H3.5C2.2,1,1.1,2.1,1.1,3.4v16.9c0,1.3,1.1,2.4,2.4,2.4h16.9c1.3,0,2.4-1.1,2.4-2.4V3.4C22.8,2.1,21.7,1,20.4,1z M9.6,17.9l-6-6l1.7-1.7l4.3,4.3l9.1-9.1L20.4,7L9.6,17.9z"/></g><g id="uncheck"><path d="M20.4,3.4v16.9H3.5V3.4H20.4 M20.4,1H3.5C2.2,1,1.1,2.1,1.1,3.4v16.9c0,1.3,1.1,2.4,2.4,2.4h16.9c1.3,0,2.4-1.1,2.4-2.4V3.4C22.8,2.1,21.7,1,20.4,1z"/></g></svg>`;IoIconsetSingleton.registerIcons("icons",icons);class IoBoolicon extends IoBoolean{static get Style(){return html`<style>:host {width: var(--io-item-height);height: var(--io-item-height);fill: var(--io-color, currentcolor);}:host[stroke] {stroke: var(--io-background-color, currentcolor);stroke-width: var(--io-stroke-width);}:host > svg {pointer-events: none;width: 100%;height: 100%;}:host > svg > g {transform-origin: 0px 0px;}</style>`}static get Properties(){return{true:"icons:check",false:"icons:uncheck",stroke:{value:!0,reflect:1}}}changed(){this.setAttribute("aria-checked",String(!!this.value)),this.setAttribute("aria-invalid","boolean"!=typeof this.value&&"true"),this.setAttribute("aria-label",this.label),this.title=this.label,this.innerHTML=IoIconsetSingleton.getIcon(this.value?this.true:this.false)}}IoBoolicon.Register();class IoSwitch extends IoBoolean{static get Style(){return html`<style>:host {position: relative;border: var(--io-border);border-color: var(--io-color-border-inset);color: var(--io-color-field);background-image: none;background-color: var(--io-background-color-dark);box-shadow: var(--io-shadow-inset);padding: 0;margin: var(--io-spacing);width: calc(2 * var(--io-line-height));height: var(--io-line-height);border-radius: var(--io-line-height);transition: background-color 0.4s;}:host:after {display: inline-block;position: absolute;visibility: visible;content: '';top: 0;left: 0;height: calc(var(--io-line-height) - calc(4 * var(--io-border-width)));width: calc(var(--io-line-height) - calc(4 * var(--io-border-width)));background-color: var(--io-background-color-dark);border: var(--io-border);border-color: var(--io-color-border-outset);border-radius: var(--io-line-height);transition-timing-function: ease-in-out;transition: left 0.25s;}:host[value]:after {background-color: rgba(80, 210, 355, 0.75);left: calc(calc(100% - var(--io-line-height)) + calc(2 * var(--io-border-width)));}:host:not([value]) {opacity: 0.5;}:host[aria-invalid] {border: var(--io-border-error);background-image: var(--io-gradient-error);}:host:hover,:host[display="switch"][value]:not([aria-invalid]) {background-color: var(--io-background-color);}:host:focus {border-color: var(--io-color-focus);outline-color: var(--io-color-focus);}</style>`}changed(){this.setAttribute("aria-checked",String(!!this.value)),this.setAttribute("aria-invalid","boolean"!=typeof this.value&&"true"),this.setAttribute("aria-label",this.label),this.title=this.label}}IoSwitch.Register();class IoString extends IoItem{static get Style(){return html`<style>:host {cursor: text;user-select: text;-webkit-user-select: text;-webkit-touch-callout: default;min-width: var(--io-item-height);border-color: var(--io-color-border-inset);color: var(--io-color-field);background-color: var(--io-background-color-field);box-shadow: var(--io-shadow-inset);}:host:before,:host:after {content: ' ';white-space: pre;visibility: hidden;}</style>`}static get Properties(){return{value:String,contenteditable:!0,role:"textbox"}}_setFromTextNode(){const e=this.textNode;"string"!=typeof this.value&&e===String(this.value)||this.set("value",e)}_onBlur(e){super._onBlur(e),this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this._setFromTextNode(),this.scrollTop=0,this.scrollLeft=0}_onPointerdown(){this.pressed=!0,this.addEventListener("pointermove",this._onPointermove),this.addEventListener("pointerleave",this._onPointerleave),this.addEventListener("pointerup",this._onPointerup)}_onPointermove(){}_onPointerleave(e){e.preventDefault(),this.pressed=!1}_onPointerup(){this.pressed=!1,this.removeEventListener("pointermove",this._onPointermove),this.removeEventListener("pointerleave",this._onPointerleave),this.removeEventListener("pointerup",this._onPointerup),this.focus()}_onKeydown(e){const t=window.getSelection().getRangeAt(0),o=t.startOffset,i=t.endOffset,r=this.childNodes[0]?this.childNodes[0].length:0,s=t.startContainer===t.endContainer&&(t.startContainer===this.childNodes[0]||t.startContainer===this);13==e.which?(e.preventDefault(),this._setFromTextNode()):37==e.which?(e.ctrlKey||s&&o===i&&0===o)&&(e.preventDefault(),this.focusTo("left")):38==e.which?(e.ctrlKey||s&&o===i&&0===o)&&(e.preventDefault(),this.focusTo("up")):39==e.which?(e.ctrlKey||s&&o===i&&o===r)&&(e.preventDefault(),this.focusTo("right")):40==e.which&&(e.ctrlKey||s&&o===i&&o===r)&&(e.preventDefault(),this.focusTo("down"))}changed(){this.title=this.label,this.textNode=String(this.value).replace(new RegExp(" ","g"),"Â "),this.setAttribute("aria-invalid","string"!=typeof this.value&&"true")}}IoString.Register();let lastFocus=null;window.addEventListener("focusin",()=>{lastFocus=document.activeElement},{capture:!1}),window.addEventListener("blur",()=>{setTimeout(()=>{document.activeElement===document.body&&(lastFocus=null)})},{capture:!0});class IoLayer extends IoElement{static get Style(){return html`<style>:host {display: block;visibility: hidden;position: fixed;top: 0;left: 0;bottom: 0;right: 0;z-index: 100000;user-select: none;overflow: hidden;pointer-events: none;touch-action: none;opacity: 0;transition: opacity 0.25s;background: transparent;}:host[expanded] {pointer-events: all;visibility: visible;opacity: 1;background: rgba(0,0,0,0.2);}:host > * {position: absolute;pointer-events: all;touch-action: none;}:host > *:not([expanded]) {visibility: hidden;pointer-events: none;}</style>`}static get Properties(){return{expanded:{value:!1,reflect:1},srcElement:HTMLElement}}static get Listeners(){return{pointerdown:"_onPointerdown",pointermove:"_onPointermove",pointerup:"_onPointerup",touchstart:"_preventDefault",mousedown:"_preventDefault",contextmenu:"_preventDefault",focusin:"_preventDefault"}}connectedCallback(){super.connectedCallback(),window.addEventListener("scroll",this._onWindowChange,{capture:!0,passive:!0}),window.addEventListener("wheel",this._onWindowChange,{capture:!0,passive:!0}),window.addEventListener("resize",this._onWindowChange,{capture:!0,passive:!0})}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("scroll",this._onWindowChange,{capture:!0,passive:!0}),window.removeEventListener("wheel",this._onWindowChange,{capture:!0,passive:!0}),window.removeEventListener("resize",this._onWindowChange,{capture:!0,passive:!0})}_preventDefault(e){e.stopPropagation(),e.preventDefault()}_onFocusIn(e){e.stopPropagation()}_onWindowChange(){this.expanded=!1}_onPointerdown(e){e.stopPropagation(),e.composedPath()[0]===this&&this.setPointerCapture(e.pointerId)}_onPointermove(e){e.stopPropagation(),this._x=e.clientX,this._y=e.clientY}_onPointerup(e){e.stopPropagation(),e.composedPath()[0]===this&&(this.releasePointerCapture(e.pointerId),this._collapseOrFocusSrcElement(e))}_nudgeAnimate(){if(this.expanded){this.requestAnimationFrameOnce(this._nudgeAnimate);const e=this._x,t=this._y;for(let o=this.children.length;o--;)if(this.children[o].expanded){if(void 0===e||void 0===t)continue;const i=this.children[o].getBoundingClientRect();if(!(i.top<t&&i.bottom>t&&i.left<e&&i.right>e))continue;if(i.height>window.innerHeight){let e=i.y;if(t<100&&i.top<0){const o=(100-t)/5e3,r=i.top;e=e-Math.ceil(r*o)+1}else if(t>window.innerHeight-100&&i.bottom>window.innerHeight){const o=(100-(window.innerHeight-t))/5e3,r=i.bottom-window.innerHeight;e=e-Math.ceil(r*o)-1}this.children[o].style.top=e+"px"}if(i.width>window.innerHeight){let t=i.x;if(e<100&&i.left<0){const o=(100-e)/5e3,r=i.left;t=t-Math.ceil(r*o)+1}else if(e>window.innerHeight-100&&i.right>window.innerHeight){const o=(100-(window.innerHeight-e))/5e3,r=i.right-window.innerHeight;t=t-Math.ceil(r*o)-1}this.children[o].style.left=t+"px"}}}}_collapseOrFocusSrcElement(e){const t=e.clientX,o=e.clientY;if(this.srcElement){const e=this.srcElement.getBoundingClientRect();if(t>e.x&&t<e.right&&o>e.y&&o<e.bottom)return void this.srcElement.focus()}this.expanded=!1}nudgeDown(e,t,o,i,r){return!!(o+i.height<window.innerHeight||r)&&(e.style.top=o+"px",e.style.left=Math.min(t,Math.max(0,window.innerWidth-i.width))+"px",!0)}nudgeUp(e,t,o,i,r){return!!(o-i.height>0||r)&&(e.style.top=o-i.height+"px",e.style.left=Math.min(t,Math.max(0,window.innerWidth-i.width))+"px",!0)}nudgeRight(e,t,o,i,r){return!!(t+i.width<window.innerWidth||r)&&(e.style.left=t+"px",e.style.top=Math.min(o,window.innerHeight-i.height)+"px",!0)}nudgeLeft(e,t,o,i,r){return!!(t-i.width>0||r)&&(e.style.left=t-i.width+"px",e.style.top=Math.min(o,window.innerHeight-i.height)+"px",!0)}nudgePointer(e,t,o,i){return e.style.left=Math.max(0,Math.min(t,window.innerWidth-i.width))+"px",e.style.top=Math.max(0,Math.min(o,window.innerHeight-i.height))+"px",!0}setElementPosition(e,t,o){const i=e.getBoundingClientRect();switch(t){case"top":this.nudgeUp(e,o.x,o.top,i)||this.nudgeDown(e,o.x,o.bottom,i)||this.nudgeUp(e,o.x,o.top,i,!0);break;case"left":this.nudgeLeft(e,o.x,o.top,i)||this.nudgeRight(e,o.right,o.top,i)||this.nudgeLeft(e,o.x,o.top,i,!0);break;case"bottom":this.nudgeDown(e,o.x,o.bottom,i)||this.nudgeUp(e,o.x,o.top,i)||this.nudgeDown(e,o.x,o.bottom,i,!0);break;case"right":default:this.nudgeRight(e,o.right,o.top,i)||this.nudgeLeft(e,o.x,o.top,i)||this.nudgeRight(e,o.right,o.top,i,!0)}}onChildExpanded(){this.requestAnimationFrameOnce(this.onChildExpandedDelayed)}onChildExpandedDelayed(){for(let e=this.children.length;e--;)if(this.children[e].expanded)return void(this.expanded=!0);this.expanded=!1}expandedChanged(){if(this.expanded)this.requestAnimationFrameOnce(this._nudgeAnimate);else{for(let e=this.children.length;e--;)this.children[e].expanded=!1;lastFocus&&lastFocus.focus()}}}IoLayer.Register();const IoLayerSingleton=new IoLayer;document.body.appendChild(IoLayerSingleton);let lastFocus$1=null;window.addEventListener("focusin",()=>{lastFocus$1=document.activeElement},{capture:!1}),window.addEventListener("blur",()=>{setTimeout(()=>{document.activeElement===document.body&&(lastFocus$1=null)})},{capture:!0});class IoLadderStep extends IoItem{static get Style(){return html`<style>:host {pointer-events: all;display: inline-block;cursor: ew-resize;text-align: center;background-color: var(--io-background-color-light);align-self: stretch;touch-action: none;width: 5em;}</style>`}static get Properties(){return{role:"spinbutton",type:{value:"number",reflect:1}}}_onKeydown(e){let t=0;"Escape"===e.key||" "===e.key?this.dispatchEvent("ladder-step-collapse",{},!0):"ArrowLeft"===e.key||"Backspace"===e.key?(e.preventDefault(),t=-1*this.value):"ArrowUp"===e.key?(e.preventDefault(),this.focusTo("up")):"ArrowRight"===e.key||"Enter"===e.key?(e.preventDefault(),t=1*this.value):"ArrowDown"===e.key&&(e.preventDefault(),this.focusTo("down")),0!==t&&(this.dispatchEvent("ladder-step-change",{step:Number(t.toFixed(5)),round:e.shiftKey},!0),this.setAttribute("aria-valuenow",this.parentElement.value))}_onPointerdown(e){e.preventDefault(),e.stopImmediatePropagation(),this.setPointerCapture(e.pointerId),this.addEventListener("pointermove",this._onPointermove),this.addEventListener("pointerup",this._onPointerup),this.focus(),this._startX=e.clientX}_onPointermove(e){e.preventDefault(),e.stopImmediatePropagation();const t=e.clientX-this._startX;if(Math.abs(t)>5){const o=Math.pow(t/5,3),i=t>0?Math.floor(o):Math.ceil(o);let r=this.value*i;this._startX=e.clientX,this.dispatchEvent("ladder-step-change",{step:Number(r.toFixed(5)),round:e.shiftKey},!0)}}_onPointerup(e){e.preventDefault(),e.stopImmediatePropagation(),this.releasePointerCapture(e.pointerId),this.removeEventListener("pointermove",this._onPointermove),this.removeEventListener("pointerup",this._onPointerup)}setAria(){super.setAria(),this.setAttribute("aria-valuemax",this.parentElement.max),this.setAttribute("aria-valuemin",this.parentElement.min),this.setAttribute("aria-valuenow",this.parentElement.value)}}IoLadderStep.Register();class IoLadder extends IoElement{static get Style(){return html`<style>:host {position: relative;pointer-events: none;user-select: none;-webkit-tap-highlight-color: transparent;-webkit-user-select: none;-webkit-touch-callout: none;display: flex;flex-direction: column;}:host:not([expanded]) {visibility: hidden;}:host:not([expanded]) > io-ladder-step {opacity: 0;}:host > :nth-child(-n+5) {box-shadow: 0 -1px 4px rgba(0,0,0,0.2);}:host > :nth-child(n+6) {box-shadow: 0 1px 4px rgba(0,0,0,0.2);}:host > .io-up1,:host > .io-down1{z-index: 4;transition: opacity 0.1s, transform 0.1s;}:host > .io-up2,:host > .io-down2 {z-index: 3;opacity: 0.8;transition: opacity 0.2s, transform 0.2s;}:host:not([expanded]) > .io-up4 {transform: translateY(calc(3 * var(--io-item-height)));}:host:not([expanded]) > .io-up3 {transform: translateY(calc(2 * var(--io-item-height)));}:host:not([expanded]) > .io-up2 {transform: translateY(calc(1 * var(--io-item-height)));}:host:not([expanded]) > .io-down2 {transform: translateY(calc(-1 * var(--io-item-height)));}:host:not([expanded]) > .io-down3 {transform: translateY(calc(-2 * var(--io-item-height)));}:host:not([expanded]) > .io-down4 {transform: translateY(calc(-3 * var(--io-item-height)));}:host > .io-up3,:host > .io-down3 {z-index: 2;opacity: 0.6;transition: opacity 0.4s, transform 0.4s;}:host > .io-up4,:host > .io-down4 {z-index: 1;opacity: 0.4;transition: opacity 0.8s, transform 0.8s;}:host > io-ladder-step:focus {background-color: var(--io-background-color-light);border-color: var(--io-color-focus);transition: opacity 0.2s;opacity: 1;}:host > span.hidden {visibility: hidden;}</style>`}static get Properties(){return{srcElement:HTMLElement,value:Number,conversion:1,expanded:{type:Boolean,reflect:1},min:-1/0,max:1/0,step:1e-4,role:"list"}}static get Listeners(){return{"ladder-step-change":"_onLadderStepChange","ladder-step-collapse":"_onLadderStepCollapse",focusin:"_onFocusIn"}}_onFocusIn(e){e.stopImmediatePropagation()}_onFocusTo(e){e.stopImmediatePropagation();const t=e.composedPath()[0],o=this.srcElement,i=e.detail.dir;if(o&&(t===this.querySelector(".io-up1")&&"down"===i||t===this.querySelector(".io-down1")&&"up"===i))return o.focus(),void(o.selectionStart=o.selectionEnd=o.textNode.length);super._onFocusTo(e)}_onLadderStepChange(e){e.stopImmediatePropagation();const t=e.detail.step,o=e.detail.round?Math.round(this.value/t)*t:this.value;let i=Math.min(this.max,Math.max(this.min,o+t));this.set("value",Number(i.toFixed(5)))}_onLadderStepCollapse(){event.stopImmediatePropagation(),this.set("expanded",!1)}expandedChanged(){if(this.expanded)if(this.srcElement){const e=this.srcElement.getBoundingClientRect(),t=IoLayerSingleton.getBoundingClientRect();this.style.top=e.bottom-t.top+"px",this.style.left=e.left-t.left+"px",this.style.position="absolute",this.style.marginTop="calc(-5 * var(--io-item-height))"}else this.removeAttribute("style");else this.srcElement&&"touch"!==this.srcElement._pointerType?this.srcElement.focus():lastFocus$1&&lastFocus$1.focus();this.dispatchEvent("expanded",{value:this.expanded},!0)}changed(){const e=this.max-this.min,t=["span",{class:"io-item hidden"}];let o=this.step/1e4;for(;o<.1;)o*=10;const i=1e4*o,r=1e3*o,s=100*o,n=10*o,a=1*o,l=.1*o,h=.01*o,c=.001*o,d=Number((i*this.conversion).toFixed(6)),u=Number((r*this.conversion).toFixed(6)),p=Number((s*this.conversion).toFixed(6)),g=Number((n*this.conversion).toFixed(6)),v=Number((a*this.conversion).toFixed(6)),m=Number((l*this.conversion).toFixed(6)),f=Number((h*this.conversion).toFixed(6)),b=Number((c*this.conversion).toFixed(6));this.template([e>=i?["io-ladder-step",{class:"io-up4",value:i,label:d}]:t,e>=r?["io-ladder-step",{class:"io-up3",value:r,label:u}]:t,e>=s?["io-ladder-step",{class:"io-up2",value:s,label:p}]:t,e>=n?["io-ladder-step",{class:"io-up1",value:n,label:g}]:t,t,this.step<=a?["io-ladder-step",{class:"io-down1",value:a,label:v}]:t,this.step<=l?["io-ladder-step",{class:"io-down2",value:l,label:m}]:t,this.step<=h?["io-ladder-step",{class:"io-down3",value:h,label:f}]:t,this.step<=c?["io-ladder-step",{class:"io-down4",value:c,label:b}]:t]);const x=this.querySelectorAll("io-ladder-step");for(let e=x.length;e--;)x[e].setAria()}}IoLadder.Register();const IoLadderSingleton=new IoLadder;IoLayerSingleton.appendChild(IoLadderSingleton);class IoNumber extends IoItem{static get Style(){return html`<style>:host {cursor: text;user-select: text;-webkit-user-select: text;-webkit-touch-callout: default;min-width: var(--io-item-height);border-color: var(--io-color-border-inset);color: var(--io-color-field);background-color: var(--io-background-color-field);box-shadow: var(--io-shadow-inset);}:host:before,:host:after {content: ' ';white-space: pre;visibility: hidden;}:host:before {content: '-';}:host:not([positive]):before {content: '';}</style>`}static get Properties(){return{value:Number,conversion:1,step:.001,min:-1/0,max:1/0,ladder:!1,contenteditable:!0,role:"textbox",type:{value:"number",reflect:1},pattern:{value:'pattern="[0-9]*"',reflect:1},inputmode:{value:"numeric",reflect:1},spellcheck:{value:"false",reflect:1}}}constructor(e){super(e),Object.defineProperty(this,"_pointerType",{value:"touch",writable:!0})}_onPointerdown(e){document.activeElement===this&&0===e.button||(super._onPointerdown(e),this._pointerType=e.pointerType)}_onPointerup(e){this.pressed=!1,this.removeEventListener("pointermove",this._onPointermove),this.removeEventListener("pointerleave",this._onPointerleave),this.removeEventListener("pointerup",this._onPointerup),document.activeElement===this&&0===e.button||(this.ladder||1===e.button?"touch"===this._pointerType?(e.preventDefault(),document.activeElement.blur(),this._expandLadder()):(this.focus(),setTimeout(()=>{this._expandLadder()})):this.focus())}_onFocus(e){super._onFocus(e),"touch"===this._pointerType&&(IoLadderSingleton.expanded=!1)}_onBlur(e){super._onBlur(e),this._setFromTextNode(),IoLadderSingleton.value=this.value,this.scrollTop=0,this.scrollLeft=0,setTimeout(()=>{document.activeElement.parentElement!==IoLadderSingleton&&(IoLadderSingleton.expanded=!1)})}_onValueSet(e){"value"===e.detail.property&&this.set("value",e.detail.value)}_expandLadder(){IoLayerSingleton.srcElement=this,IoLadderSingleton.setProperties({srcElement:this,min:this.min,max:this.max,step:this.step,value:this.value,conversion:this.conversion,expanded:!0,"on-value-set":this._onValueSet})}_onKeydown(e){const t=window.getSelection().getRangeAt(0),o=t.startOffset,i=t.endOffset,r=this.childNodes[0]?this.childNodes[0].length:0,s=t.startContainer===t.endContainer&&(t.startContainer===this.childNodes[0]||t.startContainer===this);if(27===e.which||13===e.which||32===e.which)e.preventDefault(),this._setFromTextNode();else if(36===e.which)this.textNode=this.min,this._setFromTextNode();else if(35===e.which)this.textNode=this.max,this._setFromTextNode();else if(33===e.which){const e=Number(this.textNode);"number"==typeof e&&!isNaN(e)&&Math.abs(e)<1/0?this.textNode=Number(this.textNode)+this.step:this.textNode=this.step,this._setFromTextNode()}else if(34===e.which){const e=Number(this.textNode);"number"==typeof e&&!isNaN(e)&&Math.abs(e)<1/0?this.textNode=Number(this.textNode)-this.step:this.textNode=-this.step,this._setFromTextNode()}else 37===e.which?(e.ctrlKey||s&&o===i&&0===o)&&(e.preventDefault(),IoLadderSingleton.srcElement=null,this.focusTo("left")):38===e.which?IoLadderSingleton.expanded?IoLadderSingleton.querySelector(".io-up1").focus():(e.ctrlKey||s&&o===i&&0===o)&&(e.preventDefault(),this.focusTo("up")):39===e.which?(e.ctrlKey||s&&o===i&&o===r)&&(e.preventDefault(),IoLadderSingleton.srcElement=null,this.focusTo("right")):40===e.which&&(IoLadderSingleton.expanded?IoLadderSingleton.querySelector(".io-down1").focus():(e.ctrlKey||s&&o===i&&o===r)&&(e.preventDefault(),this.focusTo("down")))}_onKeyup(e){17===e.which?this._expandLadder():27!==e.which&&13!==e.which&&32!==e.which||(IoLayerSingleton.expanded=!1)}_setFromTextNode(){let e=this.textNode,t=Number(e)/this.conversion;t=Math.min(this.max,Math.max(this.min,t)),t=Math.round(t/this.step)*this.step;let o=Math.max(0,Math.min(100,-Math.round(Math.log(this.step)/Math.LN10)));t=Number(t.toFixed(o)),isNaN(t)?this.textNode="NaN":this.set("value",t)}changed(){this.title=this.label;let e,t=this.value;if("number"!=typeof t||isNaN(t))e="NaN";else{t*=this.conversion;let o=-Math.round(Math.log(this.step*this.conversion)/Math.LN10);o=Math.max(0,Math.min(100,o)),t=t.toFixed(o),e=Number(String(t))}this.textNode=e,this.setAttribute("positive",this.value>=0),this.setAttribute("aria-invalid",!("number"==typeof this.value&&!isNaN(this.value))&&"true")}}IoNumber.Register();class IoSlider extends IoGl{static get Style(){return html`<style>:host {cursor: ns-resize;box-sizing: border-box;border: var(--io-border);border-radius: var(--io-border-radius);border-color: var(--io-color-border-inset);min-width: var(--io-item-height);min-height: var(--io-item-height);align-self: stretch;justify-self: stretch;touch-action: none;}:host[horizontal] {cursor: ew-resize;}:host[orientation="2d"] {cursor: move;}:host[aria-invalid] {border: var(--io-border-error);background-image: var(--io-gradient-error);}:host[aria-invalid] > .io-gl-canvas {opacity: 0.5;}:host:focus {border-color: var(--io-color-focus);outline-color: var(--io-color-focus);}</style>`}static get Properties(){return{value:0,step:.01,min:0,max:1,horizontal:{value:!0,reflect:1},role:"slider",tabindex:0}}static get Listeners(){return{focus:"_onFocus",contextmenu:"_onContextmenu",pointerdown:"_onPointerdown"}}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this.removeEventListener("pointermove",this._onPointermove),this.removeEventListener("pointerup",this._onPointerup)}_onFocus(){this.addEventListener("blur",this._onBlur),this.addEventListener("keydown",this._onKeydown)}_onBlur(){this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown)}_onContextmenu(e){e.preventDefault()}_onPointerdown(e){this.addEventListener("pointermove",this._onPointermove),this.addEventListener("pointerup",this._onPointerup),e.preventDefault(),e.stopImmediatePropagation(),this.setPointerCapture(e.pointerId),this.focus()}_onPointermove(e){e.preventDefault(),e.stopImmediatePropagation(),this.addEventListener("pointermove",this._onPointermove),this.addEventListener("pointerup",this._onPointerup),this.debounce(this._onPointermoveDebounced,e)}_onPointerup(){event.preventDefault(),event.stopImmediatePropagation(),this.releasePointerCapture(event.pointerId),this.removeEventListener("pointermove",this._onPointermove),this.removeEventListener("pointerup",this._onPointerup)}_onPointermoveDebounced(e){const t=this.getBoundingClientRect(),o=Math.max(0,Math.min(1,(e.clientX-t.x)/t.width)),i=Math.max(0,Math.min(1,1-(e.clientY-t.y)/t.height));let r=this.min*(1-o)+this.max*o;r=Math.min(this.max,Math.max(this.min,r)),r=Math.round(r/this.step)*this.step;let s=this.min*(1-i)+this.max*i;s=Math.min(this.max,Math.max(this.min,s)),s=Math.round(s/this.step)*this.step,this._setValue(this.horizontal?r:s,this.horizontal?s:r)}_setValue(e){this.set("value",Number(e.toFixed(5)))}_onKeydown(e){"ArrowLeft"===e.key?(e.preventDefault(),e.shiftKey?this._setDecrease():this.focusTo("left")):"ArrowUp"===e.key?(e.preventDefault(),e.shiftKey?this._setIncrease():this.focusTo("up")):"ArrowRight"===e.key?(e.preventDefault(),e.shiftKey?this._setIncrease():this.focusTo("right")):"ArrowDown"===e.key?(e.preventDefault(),e.shiftKey?this._setDecrease():this.focusTo("down")):"PageUp"===e.key||"+"===e.key?(e.preventDefault(),this._setIncrease()):"PageDown"===e.key||"-"===e.key?(e.preventDefault(),this._setDecrease()):"Home"===e.key?(e.preventDefault(),this._setMin()):"PageDown"===e.key&&(e.preventDefault(),this._setMax())}_setIncrease(){let e=this.value+this.step;e=Math.min(this.max,Math.max(this.min,e)),this.set("value",Number(e.toFixed(4)))}_setDecrease(){let e=this.value-this.step;e=Math.min(this.max,Math.max(this.min,e)),this.set("value",Number(e.toFixed(4)))}_setMin(){let e=this.min;e=Math.min(this.max,Math.max(this.min,e)),this.set("value",Number(e.toFixed(4)))}_setMax(){let e=this.max;e=Math.min(this.max,Math.max(this.min,e)),this.set("value",Number(e.toFixed(4)))}changed(){super.changed(),this.setAria()}setAria(){this.setAttribute("aria-invalid",!!isNaN(this.value)&&"true"),this.setAttribute("aria-valuenow",isNaN(this.value)?0:this.value),this.setAttribute("aria-valuemin",this.min),this.setAttribute("aria-valuemax",this.max)}static get GlUtils(){return"\n    vec4 paintSlider(vec2 position, vec3 color) {\n      vec4 slotColor = mix(cssColor, cssBackgroundColorField, 0.125);\n      vec4 sliderColor = vec4(0.0);\n      float slotWidth = cssStrokeWidth;\n      float stroke = cssStrokeWidth;\n      float radius = cssItemHeight * 0.125;\n\n      float strokeShape = min(\n        circle(position, radius + stroke + stroke),\n        rectangle(vec2(0., position.y), vec2(-position.x, radius + stroke + stroke))\n      );\n      sliderColor = mix(vec4(slotColor.rgb, 1.0), sliderColor, strokeShape);\n\n      float fillShape = min(\n        circle(position, radius + stroke),\n        rectangle(vec2(0., position.y), vec2(-position.x, radius + stroke))\n      );\n      sliderColor = mix(vec4(cssBackgroundColor.rgb, 1.0), sliderColor, fillShape);\n\n      float colorShape = min(\n        circle(position, radius),\n        rectangle(vec2(0., position.y), vec2(-position.x, radius))\n      );\n      sliderColor = mix(vec4(color, 1.0), sliderColor, colorShape);\n\n      return sliderColor;\n    }\n    \n\n"}static get Frag(){return"\n    #extension GL_OES_standard_derivatives : enable\n\n    varying vec2 vUv;\n\n    void main(void) {\n      vec3 finalColor = cssBackgroundColorField.rgb;\n\n      vec2 size = (uHorizontal == 1) ? uSize : uSize.yx;\n      vec2 uv = uHorizontal == 1 ? vUv.xy : vUv.yx;\n      vec2 position = size * uv;\n\n      float stepInPx = uSize.x / ((uMax - uMin) / uStep);\n      vec4 stepColorBg = mix(cssColor, cssBackgroundColorField, 0.75);\n\n      float lineWidth = cssStrokeWidth;\n      if (stepInPx > lineWidth * 2.0) {\n        float gridWidth = size.x / ((uMax - uMin) / uStep);\n        float gridOffset = mod(uMin, uStep) / (uMax - uMin) * size.x;\n        float gridShape = grid(translate(position, - gridOffset, size.y / 2.), gridWidth, size.y + lineWidth * 2.0, lineWidth);\n        finalColor.rgb = mix(stepColorBg.rgb, finalColor.rgb, gridShape);\n      }\n\n      float valueInRange = (uValue - uMin) / (uMax - uMin);\n      vec4 slotGradient = mix(cssColorFocus, cssColorLink, uv.x);\n      vec2 markerPos = translate(position, vec2(size.x * valueInRange, size.y * 0.5));\n      vec4 slider = paintSlider(markerPos, slotGradient.rgb);\n      finalColor = mix(finalColor.rgb, slider.rgb, slider.a);\n\n      gl_FragColor = vec4(finalColor, 1.0);\n    }"}}IoSlider.Register();class IoNumberSlider extends IoElement{static get Style(){return html`<style>:host {display: flex;align-self: stretch;justify-self: stretch;}:host > io-number {flex: 0 0 calc(2 * var(--io-item-height));margin-right: var(--io-spacing);}:host > io-slider {flex: 1 1 calc(2 * var(--io-item-height));min-width: calc(2 * var(--io-item-height));}</style>`}static get Properties(){return{value:0,step:.01,conversion:1,min:0,max:1}}_onNumberSet(e){this.value=e.detail.value,this.dispatchEvent("value-set",e.detail,!1)}_onSliderSet(e){e.detail.value=e.detail.value/this.conversion,this.value=e.detail.value,this.dispatchEvent("value-set",e.detail,!1)}changed(){this.template([["io-number",{id:"number",value:this.value,step:this.step,conversion:this.conversion,min:this.min,max:this.max,label:this.label,ladder:!0,"on-value-set":this._onNumberSet}],["io-slider",{id:"slider",value:this.value*this.conversion,step:this.step*this.conversion,min:this.min*this.conversion,max:this.max*this.conversion,label:this.label,"on-value-set":this._onSliderSet}]])}}IoNumberSlider.Register();class IoIcon extends IoElement{static get Style(){return html`<style>:host {${IoThemeSingleton.item};}:host {width: var(--io-item-height);height: var(--io-item-height);fill: var(--io-background-color, currentcolor);}:host[stroke] {stroke: var(--io-color, currentcolor);stroke-width: var(--io-stroke-width);}:host > svg {width: 100%;height: 100%;}:host > svg > g {pointer-events: none;transform-origin: 0px 0px;}</style>`}static get Properties(){return{icon:{value:"",reflect:-1},label:{value:"",reflect:1},stroke:{type:Boolean,reflect:1}}}iconChanged(){this.innerHTML=IoIconsetSingleton.getIcon(this.icon)}}IoIcon.Register();export{IoBoolean,IoBoolicon,IoButton,IoGl,IoIcon,IoIconsetSingleton,IoItem,IoLadderSingleton,IoLayerSingleton,IoNumber,IoNumberSlider,IoSlider,IoString,IoSwitch,IoThemeSingleton};